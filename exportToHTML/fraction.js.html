<html>
<head>
<title>fraction.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #67a37c; font-style: italic;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #cf8e6d;}
.s5 { color: #bcbec4;}
.s6 { color: #2aacb8;}
.s7 { color: #6aab73;}
.s8 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
fraction.js</font>
</center></td></tr></table>
<pre><span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@license </span><span class="s0">Fraction.js v4.3.7 31/08/2023</span>
 <span class="s0">* https://www.xarg.org/2014/03/rational-numbers-in-javascript/</span>
 <span class="s0">*</span>
 <span class="s0">* Copyright (c) 2023, Robert Eisele (robert@raw.org)</span>
 <span class="s0">* Dual licensed under the MIT or GPL Version 2 licenses.</span>
 <span class="s0">**/</span>


<span class="s0">/**</span>
 <span class="s0">*</span>
 <span class="s0">* This class offers the possibility to calculate fractions.</span>
 <span class="s0">* You can pass a fraction in different formats. Either as array, as double, as string or as an integer.</span>
 <span class="s0">*</span>
 <span class="s0">* Array/Object form</span>
 <span class="s0">* [ 0 =&gt; &lt;numerator&gt;, 1 =&gt; &lt;denominator&gt; ]</span>
 <span class="s0">* [ n =&gt; &lt;numerator&gt;, d =&gt; &lt;denominator&gt; ]</span>
 <span class="s0">*</span>
 <span class="s0">* Integer form</span>
 <span class="s0">* - Single integer value</span>
 <span class="s0">*</span>
 <span class="s0">* Double form</span>
 <span class="s0">* - Single double value</span>
 <span class="s0">*</span>
 <span class="s0">* String form</span>
 <span class="s0">* 123.456 - a simple double</span>
 <span class="s0">* 123/456 - a string fraction</span>
 <span class="s0">* 123.'456' - a double with repeating decimal places</span>
 <span class="s0">* 123.(456) - synonym</span>
 <span class="s0">* 123.45'6' - a double with repeating last place</span>
 <span class="s0">* 123.45(6) - synonym</span>
 <span class="s0">*</span>
 <span class="s0">* Example:</span>
 <span class="s0">*</span>
 <span class="s0">* var f = new Fraction(&quot;9.4'31'&quot;);</span>
 <span class="s0">* f.mul([-4, 3]).div(4.9);</span>
 <span class="s0">*</span>
 <span class="s0">*/</span>


<span class="s3">// Maximum search depth for cyclic rational numbers. 2000 should be more than enough.</span>
<span class="s3">// Example: 1/7 = 0.(142857) has 6 repeating decimal places.</span>
<span class="s3">// If MAX_CYCLE_LEN gets reduced, long cycles will not be detected and toString() only gets the first 10 digits</span>
<span class="s4">var </span><span class="s2">MAX_CYCLE_LEN </span><span class="s5">= </span><span class="s6">2000</span><span class="s5">;</span>

<span class="s3">// Parsed data to avoid calling &quot;new&quot; all the time</span>
<span class="s4">var </span><span class="s2">P </span><span class="s5">= {</span>
  <span class="s7">&quot;s&quot;</span><span class="s5">: </span><span class="s6">1</span><span class="s5">,</span>
  <span class="s7">&quot;n&quot;</span><span class="s5">: </span><span class="s6">0</span><span class="s5">,</span>
  <span class="s7">&quot;d&quot;</span><span class="s5">: </span><span class="s6">1</span>
<span class="s5">};</span>

<span class="s4">function </span><span class="s2">assign</span><span class="s5">(</span><span class="s2">n</span><span class="s5">, </span><span class="s2">s</span><span class="s5">) {</span>

  <span class="s4">if </span><span class="s5">(</span><span class="s2">isNaN</span><span class="s5">(</span><span class="s2">n </span><span class="s5">= </span><span class="s2">parseInt</span><span class="s5">(</span><span class="s2">n</span><span class="s5">, </span><span class="s6">10</span><span class="s5">))) {</span>
    <span class="s4">throw </span><span class="s2">InvalidParameter</span><span class="s5">();</span>
  <span class="s5">}</span>
  <span class="s4">return </span><span class="s2">n </span><span class="s5">* </span><span class="s2">s</span><span class="s5">;</span>
<span class="s5">}</span>

<span class="s3">// Creates a new Fraction internally without the need of the bulky constructor</span>
<span class="s4">function </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s2">n</span><span class="s5">, </span><span class="s2">d</span><span class="s5">) {</span>

  <span class="s4">if </span><span class="s5">(</span><span class="s2">d </span><span class="s5">=== </span><span class="s6">0</span><span class="s5">) {</span>
    <span class="s4">throw </span><span class="s2">DivisionByZero</span><span class="s5">();</span>
  <span class="s5">}</span>

  <span class="s4">var </span><span class="s2">f </span><span class="s5">= </span><span class="s2">Object</span><span class="s5">.</span><span class="s2">create</span><span class="s5">(</span><span class="s2">Fraction</span><span class="s5">.</span><span class="s2">prototype</span><span class="s5">);</span>
  <span class="s2">f</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] = </span><span class="s2">n </span><span class="s5">&lt; </span><span class="s6">0 </span><span class="s5">? -</span><span class="s6">1 </span><span class="s5">: </span><span class="s6">1</span><span class="s5">;</span>

  <span class="s2">n </span><span class="s5">= </span><span class="s2">n </span><span class="s5">&lt; </span><span class="s6">0 </span><span class="s5">? -</span><span class="s2">n </span><span class="s5">: </span><span class="s2">n</span><span class="s5">;</span>

  <span class="s4">var </span><span class="s2">a </span><span class="s5">= </span><span class="s2">gcd</span><span class="s5">(</span><span class="s2">n</span><span class="s5">, </span><span class="s2">d</span><span class="s5">);</span>

  <span class="s2">f</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] = </span><span class="s2">n </span><span class="s5">/ </span><span class="s2">a</span><span class="s5">;</span>
  <span class="s2">f</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] = </span><span class="s2">d </span><span class="s5">/ </span><span class="s2">a</span><span class="s5">;</span>
  <span class="s4">return </span><span class="s2">f</span><span class="s5">;</span>
<span class="s5">}</span>

<span class="s4">function </span><span class="s2">factorize</span><span class="s5">(</span><span class="s2">num</span><span class="s5">) {</span>

  <span class="s4">var </span><span class="s2">factors </span><span class="s5">= {};</span>

  <span class="s4">var </span><span class="s2">n </span><span class="s5">= </span><span class="s2">num</span><span class="s5">;</span>
  <span class="s4">var </span><span class="s2">i </span><span class="s5">= </span><span class="s6">2</span><span class="s5">;</span>
  <span class="s4">var </span><span class="s2">s </span><span class="s5">= </span><span class="s6">4</span><span class="s5">;</span>

  <span class="s4">while </span><span class="s5">(</span><span class="s2">s </span><span class="s5">&lt;= </span><span class="s2">n</span><span class="s5">) {</span>

    <span class="s4">while </span><span class="s5">(</span><span class="s2">n </span><span class="s5">% </span><span class="s2">i </span><span class="s5">=== </span><span class="s6">0</span><span class="s5">) {</span>
      <span class="s2">n</span><span class="s5">/= </span><span class="s2">i</span><span class="s5">;</span>
      <span class="s2">factors</span><span class="s5">[</span><span class="s2">i</span><span class="s5">] = (</span><span class="s2">factors</span><span class="s5">[</span><span class="s2">i</span><span class="s5">] || </span><span class="s6">0</span><span class="s5">) + </span><span class="s6">1</span><span class="s5">;</span>
    <span class="s5">}</span>
    <span class="s2">s</span><span class="s5">+= </span><span class="s6">1 </span><span class="s5">+ </span><span class="s6">2 </span><span class="s5">* </span><span class="s2">i</span><span class="s5">++;</span>
  <span class="s5">}</span>

  <span class="s4">if </span><span class="s5">(</span><span class="s2">n </span><span class="s5">!== </span><span class="s2">num</span><span class="s5">) {</span>
    <span class="s4">if </span><span class="s5">(</span><span class="s2">n </span><span class="s5">&gt; </span><span class="s6">1</span><span class="s5">)</span>
      <span class="s2">factors</span><span class="s5">[</span><span class="s2">n</span><span class="s5">] = (</span><span class="s2">factors</span><span class="s5">[</span><span class="s2">n</span><span class="s5">] || </span><span class="s6">0</span><span class="s5">) + </span><span class="s6">1</span><span class="s5">;</span>
  <span class="s5">} </span><span class="s4">else </span><span class="s5">{</span>
    <span class="s2">factors</span><span class="s5">[</span><span class="s2">num</span><span class="s5">] = (</span><span class="s2">factors</span><span class="s5">[</span><span class="s2">num</span><span class="s5">] || </span><span class="s6">0</span><span class="s5">) + </span><span class="s6">1</span><span class="s5">;</span>
  <span class="s5">}</span>
  <span class="s4">return </span><span class="s2">factors</span><span class="s5">;</span>
<span class="s5">}</span>

<span class="s4">var </span><span class="s2">parse </span><span class="s5">= </span><span class="s4">function</span><span class="s5">(</span><span class="s2">p1</span><span class="s5">, </span><span class="s2">p2</span><span class="s5">) {</span>

  <span class="s4">var </span><span class="s2">n </span><span class="s5">= </span><span class="s6">0</span><span class="s5">, </span><span class="s2">d </span><span class="s5">= </span><span class="s6">1</span><span class="s5">, </span><span class="s2">s </span><span class="s5">= </span><span class="s6">1</span><span class="s5">;</span>
  <span class="s4">var </span><span class="s2">v </span><span class="s5">= </span><span class="s6">0</span><span class="s5">, </span><span class="s2">w </span><span class="s5">= </span><span class="s6">0</span><span class="s5">, </span><span class="s2">x </span><span class="s5">= </span><span class="s6">0</span><span class="s5">, </span><span class="s2">y </span><span class="s5">= </span><span class="s6">1</span><span class="s5">, </span><span class="s2">z </span><span class="s5">= </span><span class="s6">1</span><span class="s5">;</span>

  <span class="s4">var </span><span class="s2">A </span><span class="s5">= </span><span class="s6">0</span><span class="s5">, </span><span class="s2">B </span><span class="s5">= </span><span class="s6">1</span><span class="s5">;</span>
  <span class="s4">var </span><span class="s2">C </span><span class="s5">= </span><span class="s6">1</span><span class="s5">, </span><span class="s2">D </span><span class="s5">= </span><span class="s6">1</span><span class="s5">;</span>

  <span class="s4">var </span><span class="s2">N </span><span class="s5">= </span><span class="s6">10000000</span><span class="s5">;</span>
  <span class="s4">var </span><span class="s2">M</span><span class="s5">;</span>

  <span class="s4">if </span><span class="s5">(</span><span class="s2">p1 </span><span class="s5">=== </span><span class="s2">undefined </span><span class="s5">|| </span><span class="s2">p1 </span><span class="s5">=== </span><span class="s4">null</span><span class="s5">) {</span>
    <span class="s3">/* void */</span>
  <span class="s5">} </span><span class="s4">else if </span><span class="s5">(</span><span class="s2">p2 </span><span class="s5">!== </span><span class="s2">undefined</span><span class="s5">) {</span>
    <span class="s2">n </span><span class="s5">= </span><span class="s2">p1</span><span class="s5">;</span>
    <span class="s2">d </span><span class="s5">= </span><span class="s2">p2</span><span class="s5">;</span>
    <span class="s2">s </span><span class="s5">= </span><span class="s2">n </span><span class="s5">* </span><span class="s2">d</span><span class="s5">;</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">n </span><span class="s5">% </span><span class="s6">1 </span><span class="s5">!== </span><span class="s6">0 </span><span class="s5">|| </span><span class="s2">d </span><span class="s5">% </span><span class="s6">1 </span><span class="s5">!== </span><span class="s6">0</span><span class="s5">) {</span>
      <span class="s4">throw </span><span class="s2">NonIntegerParameter</span><span class="s5">();</span>
    <span class="s5">}</span>

  <span class="s5">} </span><span class="s4">else</span>
    <span class="s4">switch </span><span class="s5">(</span><span class="s4">typeof </span><span class="s2">p1</span><span class="s5">) {</span>

      <span class="s4">case </span><span class="s7">&quot;object&quot;</span><span class="s5">:</span>
        <span class="s5">{</span>
          <span class="s4">if </span><span class="s5">(</span><span class="s7">&quot;d&quot; </span><span class="s4">in </span><span class="s2">p1 </span><span class="s5">&amp;&amp; </span><span class="s7">&quot;n&quot; </span><span class="s4">in </span><span class="s2">p1</span><span class="s5">) {</span>
            <span class="s2">n </span><span class="s5">= </span><span class="s2">p1</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">];</span>
            <span class="s2">d </span><span class="s5">= </span><span class="s2">p1</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">];</span>
            <span class="s4">if </span><span class="s5">(</span><span class="s7">&quot;s&quot; </span><span class="s4">in </span><span class="s2">p1</span><span class="s5">)</span>
              <span class="s2">n</span><span class="s5">*= </span><span class="s2">p1</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">];</span>
          <span class="s5">} </span><span class="s4">else if </span><span class="s5">(</span><span class="s6">0 </span><span class="s4">in </span><span class="s2">p1</span><span class="s5">) {</span>
            <span class="s2">n </span><span class="s5">= </span><span class="s2">p1</span><span class="s5">[</span><span class="s6">0</span><span class="s5">];</span>
            <span class="s4">if </span><span class="s5">(</span><span class="s6">1 </span><span class="s4">in </span><span class="s2">p1</span><span class="s5">)</span>
              <span class="s2">d </span><span class="s5">= </span><span class="s2">p1</span><span class="s5">[</span><span class="s6">1</span><span class="s5">];</span>
          <span class="s5">} </span><span class="s4">else </span><span class="s5">{</span>
            <span class="s4">throw </span><span class="s2">InvalidParameter</span><span class="s5">();</span>
          <span class="s5">}</span>
          <span class="s2">s </span><span class="s5">= </span><span class="s2">n </span><span class="s5">* </span><span class="s2">d</span><span class="s5">;</span>
          <span class="s4">break</span><span class="s5">;</span>
        <span class="s5">}</span>
      <span class="s4">case </span><span class="s7">&quot;number&quot;</span><span class="s5">:</span>
        <span class="s5">{</span>
          <span class="s4">if </span><span class="s5">(</span><span class="s2">p1 </span><span class="s5">&lt; </span><span class="s6">0</span><span class="s5">) {</span>
            <span class="s2">s </span><span class="s5">= </span><span class="s2">p1</span><span class="s5">;</span>
            <span class="s2">p1 </span><span class="s5">= -</span><span class="s2">p1</span><span class="s5">;</span>
          <span class="s5">}</span>

          <span class="s4">if </span><span class="s5">(</span><span class="s2">p1 </span><span class="s5">% </span><span class="s6">1 </span><span class="s5">=== </span><span class="s6">0</span><span class="s5">) {</span>
            <span class="s2">n </span><span class="s5">= </span><span class="s2">p1</span><span class="s5">;</span>
          <span class="s5">} </span><span class="s4">else if </span><span class="s5">(</span><span class="s2">p1 </span><span class="s5">&gt; </span><span class="s6">0</span><span class="s5">) { </span><span class="s3">// check for != 0, scale would become NaN (log(0)), which converges really slow</span>

            <span class="s4">if </span><span class="s5">(</span><span class="s2">p1 </span><span class="s5">&gt;= </span><span class="s6">1</span><span class="s5">) {</span>
              <span class="s2">z </span><span class="s5">= </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">pow</span><span class="s5">(</span><span class="s6">10</span><span class="s5">, </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">floor</span><span class="s5">(</span><span class="s6">1 </span><span class="s5">+ </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">log</span><span class="s5">(</span><span class="s2">p1</span><span class="s5">) / </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">LN10</span><span class="s5">));</span>
              <span class="s2">p1</span><span class="s5">/= </span><span class="s2">z</span><span class="s5">;</span>
            <span class="s5">}</span>

            <span class="s3">// Using Farey Sequences</span>
            <span class="s3">// http://www.johndcook.com/blog/2010/10/20/best-rational-approximation/</span>

            <span class="s4">while </span><span class="s5">(</span><span class="s2">B </span><span class="s5">&lt;= </span><span class="s2">N </span><span class="s5">&amp;&amp; </span><span class="s2">D </span><span class="s5">&lt;= </span><span class="s2">N</span><span class="s5">) {</span>
              <span class="s2">M </span><span class="s5">= (</span><span class="s2">A </span><span class="s5">+ </span><span class="s2">C</span><span class="s5">) / (</span><span class="s2">B </span><span class="s5">+ </span><span class="s2">D</span><span class="s5">);</span>

              <span class="s4">if </span><span class="s5">(</span><span class="s2">p1 </span><span class="s5">=== </span><span class="s2">M</span><span class="s5">) {</span>
                <span class="s4">if </span><span class="s5">(</span><span class="s2">B </span><span class="s5">+ </span><span class="s2">D </span><span class="s5">&lt;= </span><span class="s2">N</span><span class="s5">) {</span>
                  <span class="s2">n </span><span class="s5">= </span><span class="s2">A </span><span class="s5">+ </span><span class="s2">C</span><span class="s5">;</span>
                  <span class="s2">d </span><span class="s5">= </span><span class="s2">B </span><span class="s5">+ </span><span class="s2">D</span><span class="s5">;</span>
                <span class="s5">} </span><span class="s4">else if </span><span class="s5">(</span><span class="s2">D </span><span class="s5">&gt; </span><span class="s2">B</span><span class="s5">) {</span>
                  <span class="s2">n </span><span class="s5">= </span><span class="s2">C</span><span class="s5">;</span>
                  <span class="s2">d </span><span class="s5">= </span><span class="s2">D</span><span class="s5">;</span>
                <span class="s5">} </span><span class="s4">else </span><span class="s5">{</span>
                  <span class="s2">n </span><span class="s5">= </span><span class="s2">A</span><span class="s5">;</span>
                  <span class="s2">d </span><span class="s5">= </span><span class="s2">B</span><span class="s5">;</span>
                <span class="s5">}</span>
                <span class="s4">break</span><span class="s5">;</span>

              <span class="s5">} </span><span class="s4">else </span><span class="s5">{</span>

                <span class="s4">if </span><span class="s5">(</span><span class="s2">p1 </span><span class="s5">&gt; </span><span class="s2">M</span><span class="s5">) {</span>
                  <span class="s2">A</span><span class="s5">+= </span><span class="s2">C</span><span class="s5">;</span>
                  <span class="s2">B</span><span class="s5">+= </span><span class="s2">D</span><span class="s5">;</span>
                <span class="s5">} </span><span class="s4">else </span><span class="s5">{</span>
                  <span class="s2">C</span><span class="s5">+= </span><span class="s2">A</span><span class="s5">;</span>
                  <span class="s2">D</span><span class="s5">+= </span><span class="s2">B</span><span class="s5">;</span>
                <span class="s5">}</span>

                <span class="s4">if </span><span class="s5">(</span><span class="s2">B </span><span class="s5">&gt; </span><span class="s2">N</span><span class="s5">) {</span>
                  <span class="s2">n </span><span class="s5">= </span><span class="s2">C</span><span class="s5">;</span>
                  <span class="s2">d </span><span class="s5">= </span><span class="s2">D</span><span class="s5">;</span>
                <span class="s5">} </span><span class="s4">else </span><span class="s5">{</span>
                  <span class="s2">n </span><span class="s5">= </span><span class="s2">A</span><span class="s5">;</span>
                  <span class="s2">d </span><span class="s5">= </span><span class="s2">B</span><span class="s5">;</span>
                <span class="s5">}</span>
              <span class="s5">}</span>
            <span class="s5">}</span>
            <span class="s2">n</span><span class="s5">*= </span><span class="s2">z</span><span class="s5">;</span>
          <span class="s5">} </span><span class="s4">else if </span><span class="s5">(</span><span class="s2">isNaN</span><span class="s5">(</span><span class="s2">p1</span><span class="s5">) || </span><span class="s2">isNaN</span><span class="s5">(</span><span class="s2">p2</span><span class="s5">)) {</span>
            <span class="s2">d </span><span class="s5">= </span><span class="s2">n </span><span class="s5">= </span><span class="s2">NaN</span><span class="s5">;</span>
          <span class="s5">}</span>
          <span class="s4">break</span><span class="s5">;</span>
        <span class="s5">}</span>
      <span class="s4">case </span><span class="s7">&quot;string&quot;</span><span class="s5">:</span>
        <span class="s5">{</span>
          <span class="s2">B </span><span class="s5">= </span><span class="s2">p1</span><span class="s5">.</span><span class="s2">match</span><span class="s5">(</span><span class="s8">/\d+|./g</span><span class="s5">);</span>

          <span class="s4">if </span><span class="s5">(</span><span class="s2">B </span><span class="s5">=== </span><span class="s4">null</span><span class="s5">)</span>
            <span class="s4">throw </span><span class="s2">InvalidParameter</span><span class="s5">();</span>

          <span class="s4">if </span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A</span><span class="s5">] === </span><span class="s7">'-'</span><span class="s5">) {</span><span class="s3">// Check for minus sign at the beginning</span>
            <span class="s2">s </span><span class="s5">= -</span><span class="s6">1</span><span class="s5">;</span>
            <span class="s2">A</span><span class="s5">++;</span>
          <span class="s5">} </span><span class="s4">else if </span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A</span><span class="s5">] === </span><span class="s7">'+'</span><span class="s5">) {</span><span class="s3">// Check for plus sign at the beginning</span>
            <span class="s2">A</span><span class="s5">++;</span>
          <span class="s5">}</span>

          <span class="s4">if </span><span class="s5">(</span><span class="s2">B</span><span class="s5">.</span><span class="s2">length </span><span class="s5">=== </span><span class="s2">A </span><span class="s5">+ </span><span class="s6">1</span><span class="s5">) { </span><span class="s3">// Check if it's just a simple number &quot;1234&quot;</span>
            <span class="s2">w </span><span class="s5">= </span><span class="s2">assign</span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A</span><span class="s5">++], </span><span class="s2">s</span><span class="s5">);</span>
          <span class="s5">} </span><span class="s4">else if </span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">1</span><span class="s5">] === </span><span class="s7">'.' </span><span class="s5">|| </span><span class="s2">B</span><span class="s5">[</span><span class="s2">A</span><span class="s5">] === </span><span class="s7">'.'</span><span class="s5">) { </span><span class="s3">// Check if it's a decimal number</span>

            <span class="s4">if </span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A</span><span class="s5">] !== </span><span class="s7">'.'</span><span class="s5">) { </span><span class="s3">// Handle 0.5 and .5</span>
              <span class="s2">v </span><span class="s5">= </span><span class="s2">assign</span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A</span><span class="s5">++], </span><span class="s2">s</span><span class="s5">);</span>
            <span class="s5">}</span>
            <span class="s2">A</span><span class="s5">++;</span>

            <span class="s3">// Check for decimal places</span>
            <span class="s4">if </span><span class="s5">(</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">1 </span><span class="s5">=== </span><span class="s2">B</span><span class="s5">.</span><span class="s2">length </span><span class="s5">|| </span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">1</span><span class="s5">] === </span><span class="s7">'(' </span><span class="s5">&amp;&amp; </span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">3</span><span class="s5">] === </span><span class="s7">')' </span><span class="s5">|| </span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">1</span><span class="s5">] === </span><span class="s7">&quot;'&quot; </span><span class="s5">&amp;&amp; </span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">3</span><span class="s5">] === </span><span class="s7">&quot;'&quot;</span><span class="s5">) {</span>
              <span class="s2">w </span><span class="s5">= </span><span class="s2">assign</span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A</span><span class="s5">], </span><span class="s2">s</span><span class="s5">);</span>
              <span class="s2">y </span><span class="s5">= </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">pow</span><span class="s5">(</span><span class="s6">10</span><span class="s5">, </span><span class="s2">B</span><span class="s5">[</span><span class="s2">A</span><span class="s5">].</span><span class="s2">length</span><span class="s5">);</span>
              <span class="s2">A</span><span class="s5">++;</span>
            <span class="s5">}</span>

            <span class="s3">// Check for repeating places</span>
            <span class="s4">if </span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A</span><span class="s5">] === </span><span class="s7">'(' </span><span class="s5">&amp;&amp; </span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">2</span><span class="s5">] === </span><span class="s7">')' </span><span class="s5">|| </span><span class="s2">B</span><span class="s5">[</span><span class="s2">A</span><span class="s5">] === </span><span class="s7">&quot;'&quot; </span><span class="s5">&amp;&amp; </span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">2</span><span class="s5">] === </span><span class="s7">&quot;'&quot;</span><span class="s5">) {</span>
              <span class="s2">x </span><span class="s5">= </span><span class="s2">assign</span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">1</span><span class="s5">], </span><span class="s2">s</span><span class="s5">);</span>
              <span class="s2">z </span><span class="s5">= </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">pow</span><span class="s5">(</span><span class="s6">10</span><span class="s5">, </span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">1</span><span class="s5">].</span><span class="s2">length</span><span class="s5">) - </span><span class="s6">1</span><span class="s5">;</span>
              <span class="s2">A</span><span class="s5">+= </span><span class="s6">3</span><span class="s5">;</span>
            <span class="s5">}</span>

          <span class="s5">} </span><span class="s4">else if </span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">1</span><span class="s5">] === </span><span class="s7">'/' </span><span class="s5">|| </span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">1</span><span class="s5">] === </span><span class="s7">':'</span><span class="s5">) { </span><span class="s3">// Check for a simple fraction &quot;123/456&quot; or &quot;123:456&quot;</span>
            <span class="s2">w </span><span class="s5">= </span><span class="s2">assign</span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A</span><span class="s5">], </span><span class="s2">s</span><span class="s5">);</span>
            <span class="s2">y </span><span class="s5">= </span><span class="s2">assign</span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">2</span><span class="s5">], </span><span class="s6">1</span><span class="s5">);</span>
            <span class="s2">A</span><span class="s5">+= </span><span class="s6">3</span><span class="s5">;</span>
          <span class="s5">} </span><span class="s4">else if </span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">3</span><span class="s5">] === </span><span class="s7">'/' </span><span class="s5">&amp;&amp; </span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">1</span><span class="s5">] === </span><span class="s7">' '</span><span class="s5">) { </span><span class="s3">// Check for a complex fraction &quot;123 1/2&quot;</span>
            <span class="s2">v </span><span class="s5">= </span><span class="s2">assign</span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A</span><span class="s5">], </span><span class="s2">s</span><span class="s5">);</span>
            <span class="s2">w </span><span class="s5">= </span><span class="s2">assign</span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">2</span><span class="s5">], </span><span class="s2">s</span><span class="s5">);</span>
            <span class="s2">y </span><span class="s5">= </span><span class="s2">assign</span><span class="s5">(</span><span class="s2">B</span><span class="s5">[</span><span class="s2">A </span><span class="s5">+ </span><span class="s6">4</span><span class="s5">], </span><span class="s6">1</span><span class="s5">);</span>
            <span class="s2">A</span><span class="s5">+= </span><span class="s6">5</span><span class="s5">;</span>
          <span class="s5">}</span>

          <span class="s4">if </span><span class="s5">(</span><span class="s2">B</span><span class="s5">.</span><span class="s2">length </span><span class="s5">&lt;= </span><span class="s2">A</span><span class="s5">) { </span><span class="s3">// Check for more tokens on the stack</span>
            <span class="s2">d </span><span class="s5">= </span><span class="s2">y </span><span class="s5">* </span><span class="s2">z</span><span class="s5">;</span>
            <span class="s2">s </span><span class="s5">= </span><span class="s3">/* void */</span>
            <span class="s2">n </span><span class="s5">= </span><span class="s2">x </span><span class="s5">+ </span><span class="s2">d </span><span class="s5">* </span><span class="s2">v </span><span class="s5">+ </span><span class="s2">z </span><span class="s5">* </span><span class="s2">w</span><span class="s5">;</span>
            <span class="s4">break</span><span class="s5">;</span>
          <span class="s5">}</span>

          <span class="s3">/* Fall through on error */</span>
        <span class="s5">}</span>
      <span class="s4">default</span><span class="s5">:</span>
        <span class="s4">throw </span><span class="s2">InvalidParameter</span><span class="s5">();</span>
    <span class="s5">}</span>

  <span class="s4">if </span><span class="s5">(</span><span class="s2">d </span><span class="s5">=== </span><span class="s6">0</span><span class="s5">) {</span>
    <span class="s4">throw </span><span class="s2">DivisionByZero</span><span class="s5">();</span>
  <span class="s5">}</span>

  <span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] = </span><span class="s2">s </span><span class="s5">&lt; </span><span class="s6">0 </span><span class="s5">? -</span><span class="s6">1 </span><span class="s5">: </span><span class="s6">1</span><span class="s5">;</span>
  <span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] = </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">abs</span><span class="s5">(</span><span class="s2">n</span><span class="s5">);</span>
  <span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] = </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">abs</span><span class="s5">(</span><span class="s2">d</span><span class="s5">);</span>
<span class="s5">};</span>

<span class="s4">function </span><span class="s2">modpow</span><span class="s5">(</span><span class="s2">b</span><span class="s5">, </span><span class="s2">e</span><span class="s5">, </span><span class="s2">m</span><span class="s5">) {</span>

  <span class="s4">var </span><span class="s2">r </span><span class="s5">= </span><span class="s6">1</span><span class="s5">;</span>
  <span class="s4">for </span><span class="s5">(; </span><span class="s2">e </span><span class="s5">&gt; </span><span class="s6">0</span><span class="s5">; </span><span class="s2">b </span><span class="s5">= (</span><span class="s2">b </span><span class="s5">* </span><span class="s2">b</span><span class="s5">) % </span><span class="s2">m</span><span class="s5">, </span><span class="s2">e </span><span class="s5">&gt;&gt;= </span><span class="s6">1</span><span class="s5">) {</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">e </span><span class="s5">&amp; </span><span class="s6">1</span><span class="s5">) {</span>
      <span class="s2">r </span><span class="s5">= (</span><span class="s2">r </span><span class="s5">* </span><span class="s2">b</span><span class="s5">) % </span><span class="s2">m</span><span class="s5">;</span>
    <span class="s5">}</span>
  <span class="s5">}</span>
  <span class="s4">return </span><span class="s2">r</span><span class="s5">;</span>
<span class="s5">}</span>


<span class="s4">function </span><span class="s2">cycleLen</span><span class="s5">(</span><span class="s2">n</span><span class="s5">, </span><span class="s2">d</span><span class="s5">) {</span>

  <span class="s4">for </span><span class="s5">(; </span><span class="s2">d </span><span class="s5">% </span><span class="s6">2 </span><span class="s5">=== </span><span class="s6">0</span><span class="s5">;</span>
    <span class="s2">d</span><span class="s5">/= </span><span class="s6">2</span><span class="s5">) {</span>
  <span class="s5">}</span>

  <span class="s4">for </span><span class="s5">(; </span><span class="s2">d </span><span class="s5">% </span><span class="s6">5 </span><span class="s5">=== </span><span class="s6">0</span><span class="s5">;</span>
    <span class="s2">d</span><span class="s5">/= </span><span class="s6">5</span><span class="s5">) {</span>
  <span class="s5">}</span>

  <span class="s4">if </span><span class="s5">(</span><span class="s2">d </span><span class="s5">=== </span><span class="s6">1</span><span class="s5">) </span><span class="s3">// Catch non-cyclic numbers</span>
    <span class="s4">return </span><span class="s6">0</span><span class="s5">;</span>

  <span class="s3">// If we would like to compute really large numbers quicker, we could make use of Fermat's little theorem:</span>
  <span class="s3">// 10^(d-1) % d == 1</span>
  <span class="s3">// However, we don't need such large numbers and MAX_CYCLE_LEN should be the capstone,</span>
  <span class="s3">// as we want to translate the numbers to strings.</span>

  <span class="s4">var </span><span class="s2">rem </span><span class="s5">= </span><span class="s6">10 </span><span class="s5">% </span><span class="s2">d</span><span class="s5">;</span>
  <span class="s4">var </span><span class="s2">t </span><span class="s5">= </span><span class="s6">1</span><span class="s5">;</span>

  <span class="s4">for </span><span class="s5">(; </span><span class="s2">rem </span><span class="s5">!== </span><span class="s6">1</span><span class="s5">; </span><span class="s2">t</span><span class="s5">++) {</span>
    <span class="s2">rem </span><span class="s5">= </span><span class="s2">rem </span><span class="s5">* </span><span class="s6">10 </span><span class="s5">% </span><span class="s2">d</span><span class="s5">;</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">t </span><span class="s5">&gt; </span><span class="s2">MAX_CYCLE_LEN</span><span class="s5">)</span>
      <span class="s4">return </span><span class="s6">0</span><span class="s5">; </span><span class="s3">// Returning 0 here means that we don't print it as a cyclic number. It's likely that the answer is `d-1`</span>
  <span class="s5">}</span>
  <span class="s4">return </span><span class="s2">t</span><span class="s5">;</span>
<span class="s5">}</span>


<span class="s4">function </span><span class="s2">cycleStart</span><span class="s5">(</span><span class="s2">n</span><span class="s5">, </span><span class="s2">d</span><span class="s5">, </span><span class="s2">len</span><span class="s5">) {</span>

  <span class="s4">var </span><span class="s2">rem1 </span><span class="s5">= </span><span class="s6">1</span><span class="s5">;</span>
  <span class="s4">var </span><span class="s2">rem2 </span><span class="s5">= </span><span class="s2">modpow</span><span class="s5">(</span><span class="s6">10</span><span class="s5">, </span><span class="s2">len</span><span class="s5">, </span><span class="s2">d</span><span class="s5">);</span>

  <span class="s4">for </span><span class="s5">(</span><span class="s4">var </span><span class="s2">t </span><span class="s5">= </span><span class="s6">0</span><span class="s5">; </span><span class="s2">t </span><span class="s5">&lt; </span><span class="s6">300</span><span class="s5">; </span><span class="s2">t</span><span class="s5">++) { </span><span class="s3">// s &lt; ~log10(Number.MAX_VALUE)</span>
    <span class="s3">// Solve 10^s == 10^(s+t) (mod d)</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">rem1 </span><span class="s5">=== </span><span class="s2">rem2</span><span class="s5">)</span>
      <span class="s4">return </span><span class="s2">t</span><span class="s5">;</span>

    <span class="s2">rem1 </span><span class="s5">= </span><span class="s2">rem1 </span><span class="s5">* </span><span class="s6">10 </span><span class="s5">% </span><span class="s2">d</span><span class="s5">;</span>
    <span class="s2">rem2 </span><span class="s5">= </span><span class="s2">rem2 </span><span class="s5">* </span><span class="s6">10 </span><span class="s5">% </span><span class="s2">d</span><span class="s5">;</span>
  <span class="s5">}</span>
  <span class="s4">return </span><span class="s6">0</span><span class="s5">;</span>
<span class="s5">}</span>

<span class="s4">function </span><span class="s2">gcd</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

  <span class="s4">if </span><span class="s5">(!</span><span class="s2">a</span><span class="s5">)</span>
    <span class="s4">return </span><span class="s2">b</span><span class="s5">;</span>
  <span class="s4">if </span><span class="s5">(!</span><span class="s2">b</span><span class="s5">)</span>
    <span class="s4">return </span><span class="s2">a</span><span class="s5">;</span>

  <span class="s4">while </span><span class="s5">(</span><span class="s6">1</span><span class="s5">) {</span>
    <span class="s2">a</span><span class="s5">%= </span><span class="s2">b</span><span class="s5">;</span>
    <span class="s4">if </span><span class="s5">(!</span><span class="s2">a</span><span class="s5">)</span>
      <span class="s4">return </span><span class="s2">b</span><span class="s5">;</span>
    <span class="s2">b</span><span class="s5">%= </span><span class="s2">a</span><span class="s5">;</span>
    <span class="s4">if </span><span class="s5">(!</span><span class="s2">b</span><span class="s5">)</span>
      <span class="s4">return </span><span class="s2">a</span><span class="s5">;</span>
  <span class="s5">}</span>
<span class="s5">};</span>

<span class="s0">/**</span>
 <span class="s0">* Module constructor</span>
 <span class="s0">*</span>
 <span class="s0">* </span><span class="s1">@constructor</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{number|Fraction=} a</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{number=} b</span>
 <span class="s0">*/</span>
<span class="s4">export default function </span><span class="s2">Fraction</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

  <span class="s2">parse</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">);</span>

  <span class="s4">if </span><span class="s5">(</span><span class="s4">this instanceof </span><span class="s2">Fraction</span><span class="s5">) {</span>
    <span class="s2">a </span><span class="s5">= </span><span class="s2">gcd</span><span class="s5">(</span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">], </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">]); </span><span class="s3">// Abuse variable a</span>
    <span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] = </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">];</span>
    <span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] = </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] / </span><span class="s2">a</span><span class="s5">;</span>
    <span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] = </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] / </span><span class="s2">a</span><span class="s5">;</span>
  <span class="s5">} </span><span class="s4">else </span><span class="s5">{</span>
    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s2">P</span><span class="s5">[</span><span class="s7">'s'</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">], </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">]);</span>
  <span class="s5">}</span>
<span class="s5">}</span>

<span class="s4">var </span><span class="s2">DivisionByZero </span><span class="s5">= </span><span class="s4">function</span><span class="s5">() { </span><span class="s4">return new </span><span class="s2">Error</span><span class="s5">(</span><span class="s7">&quot;Division by Zero&quot;</span><span class="s5">); };</span>
<span class="s4">var </span><span class="s2">InvalidParameter </span><span class="s5">= </span><span class="s4">function</span><span class="s5">() { </span><span class="s4">return new </span><span class="s2">Error</span><span class="s5">(</span><span class="s7">&quot;Invalid argument&quot;</span><span class="s5">); };</span>
<span class="s4">var </span><span class="s2">NonIntegerParameter </span><span class="s5">= </span><span class="s4">function</span><span class="s5">() { </span><span class="s4">return new </span><span class="s2">Error</span><span class="s5">(</span><span class="s7">&quot;Parameters must be integer&quot;</span><span class="s5">); };</span>

<span class="s2">Fraction</span><span class="s5">.</span><span class="s2">prototype </span><span class="s5">= {</span>

  <span class="s7">&quot;s&quot;</span><span class="s5">: </span><span class="s6">1</span><span class="s5">,</span>
  <span class="s7">&quot;n&quot;</span><span class="s5">: </span><span class="s6">0</span><span class="s5">,</span>
  <span class="s7">&quot;d&quot;</span><span class="s5">: </span><span class="s6">1</span><span class="s5">,</span>

  <span class="s0">/**</span>
   <span class="s0">* Calculates the absolute value</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(-4).abs() =&gt; 4</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;abs&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">() {</span>

    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">], </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Inverts the sign of the current fraction</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(-4).neg() =&gt; 4</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;neg&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">() {</span>

    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(-</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">], </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Adds two rational numbers</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction({n: 2, d: 3}).add(&quot;14.9&quot;) =&gt; 467 / 30</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;add&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

    <span class="s2">parse</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">);</span>
    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span>
      <span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] + </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">],</span>
      <span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]</span>
    <span class="s5">);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Subtracts two rational numbers</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction({n: 2, d: 3}).add(&quot;14.9&quot;) =&gt; -427 / 30</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;sub&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

    <span class="s2">parse</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">);</span>
    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span>
      <span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] - </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">],</span>
      <span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]</span>
    <span class="s5">);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Multiplies two rational numbers</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(&quot;-17.(345)&quot;).mul(3) =&gt; 5776 / 111</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;mul&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

    <span class="s2">parse</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">);</span>
    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span>
      <span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">],</span>
      <span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]</span>
    <span class="s5">);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Divides two rational numbers</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(&quot;-17.(345)&quot;).inverse().div(3)</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;div&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

    <span class="s2">parse</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">);</span>
    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span>
      <span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">],</span>
      <span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">]</span>
    <span class="s5">);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Clones the actual object</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(&quot;-17.(345)&quot;).clone()</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;clone&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">() {</span>
    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'s'</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">], </span><span class="s4">this</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">]);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Calculates the modulo of two rational numbers - a more precise fmod</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction('4.(3)').mod([7, 8]) =&gt; (13/3) % (7/8) = (5/6)</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;mod&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">isNaN</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">]) || </span><span class="s2">isNaN</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">])) {</span>
      <span class="s4">return new </span><span class="s2">Fraction</span><span class="s5">(</span><span class="s2">NaN</span><span class="s5">);</span>
    <span class="s5">}</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">a </span><span class="s5">=== </span><span class="s2">undefined</span><span class="s5">) {</span>
      <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] % </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">], </span><span class="s6">1</span><span class="s5">);</span>
    <span class="s5">}</span>

    <span class="s2">parse</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">);</span>
    <span class="s4">if </span><span class="s5">(</span><span class="s6">0 </span><span class="s5">=== </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] &amp;&amp; </span><span class="s6">0 </span><span class="s5">=== </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]) {</span>
      <span class="s4">throw </span><span class="s2">DivisionByZero</span><span class="s5">();</span>
    <span class="s5">}</span>

    <span class="s3">/* 
     * First silly attempt, kinda slow 
     * 
     return that[&quot;sub&quot;]({ 
     &quot;n&quot;: num[&quot;n&quot;] * Math.floor((this.n / this.d) / (num.n / num.d)), 
     &quot;d&quot;: num[&quot;d&quot;], 
     &quot;s&quot;: this[&quot;s&quot;] 
     });*/</span>

    <span class="s3">/* 
     * New attempt: a1 / b1 = a2 / b2 * q + r 
     * =&gt; b2 * a1 = a2 * b1 * q + b1 * b2 * r 
     * =&gt; (b2 * a1 % a2 * b1) / (b1 * b2) 
     */</span>
    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span>
      <span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * (</span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">]) % (</span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]),</span>
      <span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]</span>
    <span class="s5">);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Calculates the fractional gcd of two rational numbers</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(5,8).gcd(3,7) =&gt; 1/56</span>
   <span class="s0">*/</span>
  <span class="s7">&quot;gcd&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

    <span class="s2">parse</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">);</span>

    <span class="s3">// gcd(a / b, c / d) = gcd(a, c) / lcm(b, d)</span>

    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s2">gcd</span><span class="s5">(</span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">], </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">]) * </span><span class="s2">gcd</span><span class="s5">(</span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">], </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]), </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Calculates the fractional lcm of two rational numbers</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(5,8).lcm(3,7) =&gt; 15</span>
   <span class="s0">*/</span>
  <span class="s7">&quot;lcm&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

    <span class="s2">parse</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">);</span>

    <span class="s3">// lcm(a / b, c / d) = lcm(a, c) / gcd(b, d)</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] === </span><span class="s6">0 </span><span class="s5">&amp;&amp; </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] === </span><span class="s6">0</span><span class="s5">) {</span>
      <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s6">0</span><span class="s5">, </span><span class="s6">1</span><span class="s5">);</span>
    <span class="s5">}</span>
    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">], </span><span class="s2">gcd</span><span class="s5">(</span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">], </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">]) * </span><span class="s2">gcd</span><span class="s5">(</span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">], </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]));</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Calculates the ceil of a rational number</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction('4.(3)').ceil() =&gt; (5 / 1)</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;ceil&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">places</span><span class="s5">) {</span>

    <span class="s2">places </span><span class="s5">= </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">pow</span><span class="s5">(</span><span class="s6">10</span><span class="s5">, </span><span class="s2">places </span><span class="s5">|| </span><span class="s6">0</span><span class="s5">);</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">isNaN</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">]) || </span><span class="s2">isNaN</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">])) {</span>
      <span class="s4">return new </span><span class="s2">Fraction</span><span class="s5">(</span><span class="s2">NaN</span><span class="s5">);</span>
    <span class="s5">}</span>
    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s2">Math</span><span class="s5">.</span><span class="s2">ceil</span><span class="s5">(</span><span class="s2">places </span><span class="s5">* </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] / </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]), </span><span class="s2">places</span><span class="s5">);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Calculates the floor of a rational number</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction('4.(3)').floor() =&gt; (4 / 1)</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;floor&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">places</span><span class="s5">) {</span>

    <span class="s2">places </span><span class="s5">= </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">pow</span><span class="s5">(</span><span class="s6">10</span><span class="s5">, </span><span class="s2">places </span><span class="s5">|| </span><span class="s6">0</span><span class="s5">);</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">isNaN</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">]) || </span><span class="s2">isNaN</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">])) {</span>
      <span class="s4">return new </span><span class="s2">Fraction</span><span class="s5">(</span><span class="s2">NaN</span><span class="s5">);</span>
    <span class="s5">}</span>
    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s2">Math</span><span class="s5">.</span><span class="s2">floor</span><span class="s5">(</span><span class="s2">places </span><span class="s5">* </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] / </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]), </span><span class="s2">places</span><span class="s5">);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Rounds a rational number</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction('4.(3)').round() =&gt; (4 / 1)</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;round&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">places</span><span class="s5">) {</span>

    <span class="s2">places </span><span class="s5">= </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">pow</span><span class="s5">(</span><span class="s6">10</span><span class="s5">, </span><span class="s2">places </span><span class="s5">|| </span><span class="s6">0</span><span class="s5">);</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">isNaN</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">]) || </span><span class="s2">isNaN</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">])) {</span>
      <span class="s4">return new </span><span class="s2">Fraction</span><span class="s5">(</span><span class="s2">NaN</span><span class="s5">);</span>
    <span class="s5">}</span>
    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s2">Math</span><span class="s5">.</span><span class="s2">round</span><span class="s5">(</span><span class="s2">places </span><span class="s5">* </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] / </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]), </span><span class="s2">places</span><span class="s5">);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Rounds a rational number to a multiple of another rational number</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction('0.9').roundTo(&quot;1/8&quot;) =&gt; 7 / 8</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;roundTo&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

    <span class="s3">/* 
    k * x/y  a/b &lt; (k+1) * x/y 
     k  a/b / (x/y) &lt; (k+1) 
     k = floor(a/b * y/x) 
    */</span>

    <span class="s2">parse</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">);</span>

    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'s'</span><span class="s5">] * </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">round</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">] / (</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">])) * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">], </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">]);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Gets the inverse of the fraction, means numerator and denominator are exchanged</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction([-3, 4]).inverse() =&gt; -4 / 3</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;inverse&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">() {</span>

    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">], </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">]);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Calculates the fraction to some rational exponent, if possible</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(-1,2).pow(-3) =&gt; -8</span>
   <span class="s0">*/</span>
  <span class="s7">&quot;pow&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

    <span class="s2">parse</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">);</span>

    <span class="s3">// Trivial case when exp is an integer</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">P</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">] === </span><span class="s6">1</span><span class="s5">) {</span>

      <span class="s4">if </span><span class="s5">(</span><span class="s2">P</span><span class="s5">[</span><span class="s7">'s'</span><span class="s5">] &lt; </span><span class="s6">0</span><span class="s5">) {</span>
        <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s2">Math</span><span class="s5">.</span><span class="s2">pow</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'s'</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">], </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">]), </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">pow</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">], </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">]));</span>
      <span class="s5">} </span><span class="s4">else </span><span class="s5">{</span>
        <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s2">Math</span><span class="s5">.</span><span class="s2">pow</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'s'</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">], </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">]), </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">pow</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">], </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">]));</span>
      <span class="s5">}</span>
    <span class="s5">}</span>

    <span class="s3">// Negative roots become complex</span>
    <span class="s3">//     (-a/b)^(c/d) = x</span>
    <span class="s3">// &lt;=&gt; (-1)^(c/d) * (a/b)^(c/d) = x</span>
    <span class="s3">// &lt;=&gt; (cos(pi) + i*sin(pi))^(c/d) * (a/b)^(c/d) = x         # rotate 1 by 180</span>
    <span class="s3">// &lt;=&gt; (cos(c*pi/d) + i*sin(c*pi/d)) * (a/b)^(c/d) = x       # DeMoivre's formula in Q ( https://proofwiki.org/wiki/De_Moivre%27s_Formula/Rational_Index )</span>
    <span class="s3">// From which follows that only for c=0 the root is non-complex. c/d is a reduced fraction, so that sin(c/dpi)=0 occurs for d=1, which is handled by our trivial case.</span>
    <span class="s4">if </span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'s'</span><span class="s5">] &lt; </span><span class="s6">0</span><span class="s5">) </span><span class="s4">return null</span><span class="s5">;</span>

    <span class="s3">// Now prime factor n and d</span>
    <span class="s4">var </span><span class="s2">N </span><span class="s5">= </span><span class="s2">factorize</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">]);</span>
    <span class="s4">var </span><span class="s2">D </span><span class="s5">= </span><span class="s2">factorize</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">]);</span>

    <span class="s3">// Exponentiate and take root for n and d individually</span>
    <span class="s4">var </span><span class="s2">n </span><span class="s5">= </span><span class="s6">1</span><span class="s5">;</span>
    <span class="s4">var </span><span class="s2">d </span><span class="s5">= </span><span class="s6">1</span><span class="s5">;</span>
    <span class="s4">for </span><span class="s5">(</span><span class="s4">var </span><span class="s2">k </span><span class="s4">in </span><span class="s2">N</span><span class="s5">) {</span>
      <span class="s4">if </span><span class="s5">(</span><span class="s2">k </span><span class="s5">=== </span><span class="s7">'1'</span><span class="s5">) </span><span class="s4">continue</span><span class="s5">;</span>
      <span class="s4">if </span><span class="s5">(</span><span class="s2">k </span><span class="s5">=== </span><span class="s7">'0'</span><span class="s5">) {</span>
        <span class="s2">n </span><span class="s5">= </span><span class="s6">0</span><span class="s5">;</span>
        <span class="s4">break</span><span class="s5">;</span>
      <span class="s5">}</span>
      <span class="s2">N</span><span class="s5">[</span><span class="s2">k</span><span class="s5">]*= </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">];</span>

      <span class="s4">if </span><span class="s5">(</span><span class="s2">N</span><span class="s5">[</span><span class="s2">k</span><span class="s5">] % </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">] === </span><span class="s6">0</span><span class="s5">) {</span>
        <span class="s2">N</span><span class="s5">[</span><span class="s2">k</span><span class="s5">]/= </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">];</span>
      <span class="s5">} </span><span class="s4">else return null</span><span class="s5">;</span>
      <span class="s2">n</span><span class="s5">*= </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">pow</span><span class="s5">(</span><span class="s2">k</span><span class="s5">, </span><span class="s2">N</span><span class="s5">[</span><span class="s2">k</span><span class="s5">]);</span>
    <span class="s5">}</span>

    <span class="s4">for </span><span class="s5">(</span><span class="s4">var </span><span class="s2">k </span><span class="s4">in </span><span class="s2">D</span><span class="s5">) {</span>
      <span class="s4">if </span><span class="s5">(</span><span class="s2">k </span><span class="s5">=== </span><span class="s7">'1'</span><span class="s5">) </span><span class="s4">continue</span><span class="s5">;</span>
      <span class="s2">D</span><span class="s5">[</span><span class="s2">k</span><span class="s5">]*= </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">];</span>

      <span class="s4">if </span><span class="s5">(</span><span class="s2">D</span><span class="s5">[</span><span class="s2">k</span><span class="s5">] % </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">] === </span><span class="s6">0</span><span class="s5">) {</span>
        <span class="s2">D</span><span class="s5">[</span><span class="s2">k</span><span class="s5">]/= </span><span class="s2">P</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">];</span>
      <span class="s5">} </span><span class="s4">else return null</span><span class="s5">;</span>
      <span class="s2">d</span><span class="s5">*= </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">pow</span><span class="s5">(</span><span class="s2">k</span><span class="s5">, </span><span class="s2">D</span><span class="s5">[</span><span class="s2">k</span><span class="s5">]);</span>
    <span class="s5">}</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">P</span><span class="s5">[</span><span class="s7">'s'</span><span class="s5">] &lt; </span><span class="s6">0</span><span class="s5">) {</span>
      <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s2">d</span><span class="s5">, </span><span class="s2">n</span><span class="s5">);</span>
    <span class="s5">}</span>
    <span class="s4">return </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s2">n</span><span class="s5">, </span><span class="s2">d</span><span class="s5">);</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Check if two rational numbers are the same</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(19.6).equals([98, 5]);</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;equals&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

    <span class="s2">parse</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">);</span>
    <span class="s4">return this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] === </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]; </span><span class="s3">// Same as compare() === 0</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Check if two rational numbers are the same</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(19.6).equals([98, 5]);</span>
   <span class="s0">**/</span>
  <span class="s7">&quot;compare&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

    <span class="s2">parse</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">);</span>
    <span class="s4">var </span><span class="s2">t </span><span class="s5">= (</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">] - </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]);</span>
    <span class="s4">return </span><span class="s5">(</span><span class="s6">0 </span><span class="s5">&lt; </span><span class="s2">t</span><span class="s5">) - (</span><span class="s2">t </span><span class="s5">&lt; </span><span class="s6">0</span><span class="s5">);</span>
  <span class="s5">},</span>

  <span class="s7">&quot;simplify&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">eps</span><span class="s5">) {</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">isNaN</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">]) || </span><span class="s2">isNaN</span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">])) {</span>
      <span class="s4">return this</span><span class="s5">;</span>
    <span class="s5">}</span>

    <span class="s2">eps </span><span class="s5">= </span><span class="s2">eps </span><span class="s5">|| </span><span class="s6">0.001</span><span class="s5">;</span>

    <span class="s4">var </span><span class="s2">thisABS </span><span class="s5">= </span><span class="s4">this</span><span class="s5">[</span><span class="s7">'abs'</span><span class="s5">]();</span>
    <span class="s4">var </span><span class="s2">cont </span><span class="s5">= </span><span class="s2">thisABS</span><span class="s5">[</span><span class="s7">'toContinued'</span><span class="s5">]();</span>

    <span class="s4">for </span><span class="s5">(</span><span class="s4">var </span><span class="s2">i </span><span class="s5">= </span><span class="s6">1</span><span class="s5">; </span><span class="s2">i </span><span class="s5">&lt; </span><span class="s2">cont</span><span class="s5">.</span><span class="s2">length</span><span class="s5">; </span><span class="s2">i</span><span class="s5">++) {</span>

      <span class="s4">var </span><span class="s2">s </span><span class="s5">= </span><span class="s2">newFraction</span><span class="s5">(</span><span class="s2">cont</span><span class="s5">[</span><span class="s2">i </span><span class="s5">- </span><span class="s6">1</span><span class="s5">], </span><span class="s6">1</span><span class="s5">);</span>
      <span class="s4">for </span><span class="s5">(</span><span class="s4">var </span><span class="s2">k </span><span class="s5">= </span><span class="s2">i </span><span class="s5">- </span><span class="s6">2</span><span class="s5">; </span><span class="s2">k </span><span class="s5">&gt;= </span><span class="s6">0</span><span class="s5">; </span><span class="s2">k</span><span class="s5">--) {</span>
        <span class="s2">s </span><span class="s5">= </span><span class="s2">s</span><span class="s5">[</span><span class="s7">'inverse'</span><span class="s5">]()[</span><span class="s7">'add'</span><span class="s5">](</span><span class="s2">cont</span><span class="s5">[</span><span class="s2">k</span><span class="s5">]);</span>
      <span class="s5">}</span>

      <span class="s4">if </span><span class="s5">(</span><span class="s2">Math</span><span class="s5">.</span><span class="s2">abs</span><span class="s5">(</span><span class="s2">s</span><span class="s5">[</span><span class="s7">'sub'</span><span class="s5">](</span><span class="s2">thisABS</span><span class="s5">).</span><span class="s2">valueOf</span><span class="s5">()) &lt; </span><span class="s2">eps</span><span class="s5">) {</span>
        <span class="s4">return </span><span class="s2">s</span><span class="s5">[</span><span class="s7">'mul'</span><span class="s5">](</span><span class="s4">this</span><span class="s5">[</span><span class="s7">'s'</span><span class="s5">]);</span>
      <span class="s5">}</span>
    <span class="s5">}</span>
    <span class="s4">return this</span><span class="s5">;</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Check if two rational numbers are divisible</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(19.6).divisible(1.5);</span>
   <span class="s0">*/</span>
  <span class="s7">&quot;divisible&quot;</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">) {</span>

    <span class="s2">parse</span><span class="s5">(</span><span class="s2">a</span><span class="s5">, </span><span class="s2">b</span><span class="s5">);</span>
    <span class="s4">return </span><span class="s5">!(!(</span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]) || ((</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] * </span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">]) % (</span><span class="s2">P</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">])));</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Returns a decimal representation of the fraction</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(&quot;100.'91823'&quot;).valueOf() =&gt; 100.91823918239183</span>
   <span class="s0">**/</span>
  <span class="s7">'valueOf'</span><span class="s5">: </span><span class="s4">function</span><span class="s5">() {</span>

    <span class="s4">return this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] * </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">] / </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">];</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Returns a string-fraction representation of a Fraction object</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(&quot;1.'3'&quot;).toFraction(true) =&gt; &quot;4 1/3&quot;</span>
   <span class="s0">**/</span>
  <span class="s7">'toFraction'</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">excludeWhole</span><span class="s5">) {</span>

    <span class="s4">var </span><span class="s2">whole</span><span class="s5">, </span><span class="s2">str </span><span class="s5">= </span><span class="s7">&quot;&quot;</span><span class="s5">;</span>
    <span class="s4">var </span><span class="s2">n </span><span class="s5">= </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">];</span>
    <span class="s4">var </span><span class="s2">d </span><span class="s5">= </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">];</span>
    <span class="s4">if </span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] &lt; </span><span class="s6">0</span><span class="s5">) {</span>
      <span class="s2">str</span><span class="s5">+= </span><span class="s7">'-'</span><span class="s5">;</span>
    <span class="s5">}</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">d </span><span class="s5">=== </span><span class="s6">1</span><span class="s5">) {</span>
      <span class="s2">str</span><span class="s5">+= </span><span class="s2">n</span><span class="s5">;</span>
    <span class="s5">} </span><span class="s4">else </span><span class="s5">{</span>

      <span class="s4">if </span><span class="s5">(</span><span class="s2">excludeWhole </span><span class="s5">&amp;&amp; (</span><span class="s2">whole </span><span class="s5">= </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">floor</span><span class="s5">(</span><span class="s2">n </span><span class="s5">/ </span><span class="s2">d</span><span class="s5">)) &gt; </span><span class="s6">0</span><span class="s5">) {</span>
        <span class="s2">str</span><span class="s5">+= </span><span class="s2">whole</span><span class="s5">;</span>
        <span class="s2">str</span><span class="s5">+= </span><span class="s7">&quot; &quot;</span><span class="s5">;</span>
        <span class="s2">n</span><span class="s5">%= </span><span class="s2">d</span><span class="s5">;</span>
      <span class="s5">}</span>

      <span class="s2">str</span><span class="s5">+= </span><span class="s2">n</span><span class="s5">;</span>
      <span class="s2">str</span><span class="s5">+= </span><span class="s7">'/'</span><span class="s5">;</span>
      <span class="s2">str</span><span class="s5">+= </span><span class="s2">d</span><span class="s5">;</span>
    <span class="s5">}</span>
    <span class="s4">return </span><span class="s2">str</span><span class="s5">;</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Returns a latex representation of a Fraction object</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(&quot;1.'3'&quot;).toLatex() =&gt; &quot;\frac{4}{3}&quot;</span>
   <span class="s0">**/</span>
  <span class="s7">'toLatex'</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">excludeWhole</span><span class="s5">) {</span>

    <span class="s4">var </span><span class="s2">whole</span><span class="s5">, </span><span class="s2">str </span><span class="s5">= </span><span class="s7">&quot;&quot;</span><span class="s5">;</span>
    <span class="s4">var </span><span class="s2">n </span><span class="s5">= </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">];</span>
    <span class="s4">var </span><span class="s2">d </span><span class="s5">= </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">];</span>
    <span class="s4">if </span><span class="s5">(</span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;s&quot;</span><span class="s5">] &lt; </span><span class="s6">0</span><span class="s5">) {</span>
      <span class="s2">str</span><span class="s5">+= </span><span class="s7">'-'</span><span class="s5">;</span>
    <span class="s5">}</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">d </span><span class="s5">=== </span><span class="s6">1</span><span class="s5">) {</span>
      <span class="s2">str</span><span class="s5">+= </span><span class="s2">n</span><span class="s5">;</span>
    <span class="s5">} </span><span class="s4">else </span><span class="s5">{</span>

      <span class="s4">if </span><span class="s5">(</span><span class="s2">excludeWhole </span><span class="s5">&amp;&amp; (</span><span class="s2">whole </span><span class="s5">= </span><span class="s2">Math</span><span class="s5">.</span><span class="s2">floor</span><span class="s5">(</span><span class="s2">n </span><span class="s5">/ </span><span class="s2">d</span><span class="s5">)) &gt; </span><span class="s6">0</span><span class="s5">) {</span>
        <span class="s2">str</span><span class="s5">+= </span><span class="s2">whole</span><span class="s5">;</span>
        <span class="s2">n</span><span class="s5">%= </span><span class="s2">d</span><span class="s5">;</span>
      <span class="s5">}</span>

      <span class="s2">str</span><span class="s5">+= </span><span class="s7">&quot;</span><span class="s4">\\</span><span class="s7">frac{&quot;</span><span class="s5">;</span>
      <span class="s2">str</span><span class="s5">+= </span><span class="s2">n</span><span class="s5">;</span>
      <span class="s2">str</span><span class="s5">+= </span><span class="s7">'}{'</span><span class="s5">;</span>
      <span class="s2">str</span><span class="s5">+= </span><span class="s2">d</span><span class="s5">;</span>
      <span class="s2">str</span><span class="s5">+= </span><span class="s7">'}'</span><span class="s5">;</span>
    <span class="s5">}</span>
    <span class="s4">return </span><span class="s2">str</span><span class="s5">;</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Returns an array of continued fraction elements</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(&quot;7/8&quot;).toContinued() =&gt; [0,1,7]</span>
   <span class="s0">*/</span>
  <span class="s7">'toContinued'</span><span class="s5">: </span><span class="s4">function</span><span class="s5">() {</span>

    <span class="s4">var </span><span class="s2">t</span><span class="s5">;</span>
    <span class="s4">var </span><span class="s2">a </span><span class="s5">= </span><span class="s4">this</span><span class="s5">[</span><span class="s7">'n'</span><span class="s5">];</span>
    <span class="s4">var </span><span class="s2">b </span><span class="s5">= </span><span class="s4">this</span><span class="s5">[</span><span class="s7">'d'</span><span class="s5">];</span>
    <span class="s4">var </span><span class="s2">res </span><span class="s5">= [];</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">isNaN</span><span class="s5">(</span><span class="s2">a</span><span class="s5">) || </span><span class="s2">isNaN</span><span class="s5">(</span><span class="s2">b</span><span class="s5">)) {</span>
      <span class="s4">return </span><span class="s2">res</span><span class="s5">;</span>
    <span class="s5">}</span>

    <span class="s4">do </span><span class="s5">{</span>
      <span class="s2">res</span><span class="s5">.</span><span class="s2">push</span><span class="s5">(</span><span class="s2">Math</span><span class="s5">.</span><span class="s2">floor</span><span class="s5">(</span><span class="s2">a </span><span class="s5">/ </span><span class="s2">b</span><span class="s5">));</span>
      <span class="s2">t </span><span class="s5">= </span><span class="s2">a </span><span class="s5">% </span><span class="s2">b</span><span class="s5">;</span>
      <span class="s2">a </span><span class="s5">= </span><span class="s2">b</span><span class="s5">;</span>
      <span class="s2">b </span><span class="s5">= </span><span class="s2">t</span><span class="s5">;</span>
    <span class="s5">} </span><span class="s4">while </span><span class="s5">(</span><span class="s2">a </span><span class="s5">!== </span><span class="s6">1</span><span class="s5">);</span>

    <span class="s4">return </span><span class="s2">res</span><span class="s5">;</span>
  <span class="s5">},</span>

  <span class="s0">/**</span>
   <span class="s0">* Creates a string representation of a fraction with all digits</span>
   <span class="s0">*</span>
   <span class="s0">* Ex: new Fraction(&quot;100.'91823'&quot;).toString() =&gt; &quot;100.(91823)&quot;</span>
   <span class="s0">**/</span>
  <span class="s7">'toString'</span><span class="s5">: </span><span class="s4">function</span><span class="s5">(</span><span class="s2">dec</span><span class="s5">) {</span>

    <span class="s4">var </span><span class="s2">N </span><span class="s5">= </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;n&quot;</span><span class="s5">];</span>
    <span class="s4">var </span><span class="s2">D </span><span class="s5">= </span><span class="s4">this</span><span class="s5">[</span><span class="s7">&quot;d&quot;</span><span class="s5">];</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">isNaN</span><span class="s5">(</span><span class="s2">N</span><span class="s5">) || </span><span class="s2">isNaN</span><span class="s5">(</span><span class="s2">D</span><span class="s5">)) {</span>
      <span class="s4">return </span><span class="s7">&quot;NaN&quot;</span><span class="s5">;</span>
    <span class="s5">}</span>

    <span class="s2">dec </span><span class="s5">= </span><span class="s2">dec </span><span class="s5">|| </span><span class="s6">15</span><span class="s5">; </span><span class="s3">// 15 = decimal places when no repetation</span>

    <span class="s4">var </span><span class="s2">cycLen </span><span class="s5">= </span><span class="s2">cycleLen</span><span class="s5">(</span><span class="s2">N</span><span class="s5">, </span><span class="s2">D</span><span class="s5">); </span><span class="s3">// Cycle length</span>
    <span class="s4">var </span><span class="s2">cycOff </span><span class="s5">= </span><span class="s2">cycleStart</span><span class="s5">(</span><span class="s2">N</span><span class="s5">, </span><span class="s2">D</span><span class="s5">, </span><span class="s2">cycLen</span><span class="s5">); </span><span class="s3">// Cycle start</span>

    <span class="s4">var </span><span class="s2">str </span><span class="s5">= </span><span class="s4">this</span><span class="s5">[</span><span class="s7">'s'</span><span class="s5">] &lt; </span><span class="s6">0 </span><span class="s5">? </span><span class="s7">&quot;-&quot; </span><span class="s5">: </span><span class="s7">&quot;&quot;</span><span class="s5">;</span>

    <span class="s2">str</span><span class="s5">+= </span><span class="s2">N </span><span class="s5">/ </span><span class="s2">D </span><span class="s5">| </span><span class="s6">0</span><span class="s5">;</span>

    <span class="s2">N</span><span class="s5">%= </span><span class="s2">D</span><span class="s5">;</span>
    <span class="s2">N</span><span class="s5">*= </span><span class="s6">10</span><span class="s5">;</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">N</span><span class="s5">)</span>
      <span class="s2">str</span><span class="s5">+= </span><span class="s7">&quot;.&quot;</span><span class="s5">;</span>

    <span class="s4">if </span><span class="s5">(</span><span class="s2">cycLen</span><span class="s5">) {</span>

      <span class="s4">for </span><span class="s5">(</span><span class="s4">var </span><span class="s2">i </span><span class="s5">= </span><span class="s2">cycOff</span><span class="s5">; </span><span class="s2">i</span><span class="s5">--;) {</span>
        <span class="s2">str</span><span class="s5">+= </span><span class="s2">N </span><span class="s5">/ </span><span class="s2">D </span><span class="s5">| </span><span class="s6">0</span><span class="s5">;</span>
        <span class="s2">N</span><span class="s5">%= </span><span class="s2">D</span><span class="s5">;</span>
        <span class="s2">N</span><span class="s5">*= </span><span class="s6">10</span><span class="s5">;</span>
      <span class="s5">}</span>
      <span class="s2">str</span><span class="s5">+= </span><span class="s7">&quot;(&quot;</span><span class="s5">;</span>
      <span class="s4">for </span><span class="s5">(</span><span class="s4">var </span><span class="s2">i </span><span class="s5">= </span><span class="s2">cycLen</span><span class="s5">; </span><span class="s2">i</span><span class="s5">--;) {</span>
        <span class="s2">str</span><span class="s5">+= </span><span class="s2">N </span><span class="s5">/ </span><span class="s2">D </span><span class="s5">| </span><span class="s6">0</span><span class="s5">;</span>
        <span class="s2">N</span><span class="s5">%= </span><span class="s2">D</span><span class="s5">;</span>
        <span class="s2">N</span><span class="s5">*= </span><span class="s6">10</span><span class="s5">;</span>
      <span class="s5">}</span>
      <span class="s2">str</span><span class="s5">+= </span><span class="s7">&quot;)&quot;</span><span class="s5">;</span>
    <span class="s5">} </span><span class="s4">else </span><span class="s5">{</span>
      <span class="s4">for </span><span class="s5">(</span><span class="s4">var </span><span class="s2">i </span><span class="s5">= </span><span class="s2">dec</span><span class="s5">; </span><span class="s2">N </span><span class="s5">&amp;&amp; </span><span class="s2">i</span><span class="s5">--;) {</span>
        <span class="s2">str</span><span class="s5">+= </span><span class="s2">N </span><span class="s5">/ </span><span class="s2">D </span><span class="s5">| </span><span class="s6">0</span><span class="s5">;</span>
        <span class="s2">N</span><span class="s5">%= </span><span class="s2">D</span><span class="s5">;</span>
        <span class="s2">N</span><span class="s5">*= </span><span class="s6">10</span><span class="s5">;</span>
      <span class="s5">}</span>
    <span class="s5">}</span>
    <span class="s4">return </span><span class="s2">str</span><span class="s5">;</span>
  <span class="s5">}</span>
<span class="s5">};</span>
</pre>
</body>
</html>