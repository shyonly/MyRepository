<html>
<head>
<title>mailto.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
.s5 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
mailto.js</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s2">{ </span><span class="s1">pctEncChar</span><span class="s2">, </span><span class="s1">pctDecChars</span><span class="s2">, </span><span class="s1">unescapeComponent </span><span class="s2">} </span><span class="s1">from </span><span class="s3">&quot;../uri&quot;</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">punycode from </span><span class="s3">&quot;punycode&quot;</span><span class="s2">;</span>
<span class="s0">import </span><span class="s2">{ </span><span class="s1">merge</span><span class="s2">, </span><span class="s1">subexp</span><span class="s2">, </span><span class="s1">toUpperCase</span><span class="s2">, </span><span class="s1">toArray </span><span class="s2">} </span><span class="s1">from </span><span class="s3">&quot;../util&quot;</span><span class="s2">;</span>
<span class="s0">const </span><span class="s1">O </span><span class="s2">= {};</span>
<span class="s0">const </span><span class="s1">isIRI </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
<span class="s4">//RFC 3986</span>
<span class="s0">const </span><span class="s1">UNRESERVED$$ </span><span class="s2">= </span><span class="s3">&quot;[A-Za-z0-9</span><span class="s0">\\</span><span class="s3">-</span><span class="s0">\\</span><span class="s3">.</span><span class="s0">\\</span><span class="s3">_</span><span class="s0">\\</span><span class="s3">~&quot; </span><span class="s2">+ (</span><span class="s1">isIRI </span><span class="s2">? </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">xA0-</span><span class="s0">\\</span><span class="s3">u200D</span><span class="s0">\\</span><span class="s3">u2010-</span><span class="s0">\\</span><span class="s3">u2029</span><span class="s0">\\</span><span class="s3">u202F-</span><span class="s0">\\</span><span class="s3">uD7FF</span><span class="s0">\\</span><span class="s3">uF900-</span><span class="s0">\\</span><span class="s3">uFDCF</span><span class="s0">\\</span><span class="s3">uFDF0-</span><span class="s0">\\</span><span class="s3">uFFEF&quot; </span><span class="s2">: </span><span class="s3">&quot;&quot;</span><span class="s2">) + </span><span class="s3">&quot;]&quot;</span><span class="s2">;</span>
<span class="s0">const </span><span class="s1">HEXDIG$$ </span><span class="s2">= </span><span class="s3">&quot;[0-9A-Fa-f]&quot;</span><span class="s2">; </span><span class="s4">//case-insensitive</span>
<span class="s0">const </span><span class="s1">PCT_ENCODED$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s1">subexp</span><span class="s2">(</span><span class="s3">&quot;%[EFef]&quot; </span><span class="s2">+ </span><span class="s1">HEXDIG$$ </span><span class="s2">+ </span><span class="s3">&quot;%&quot; </span><span class="s2">+ </span><span class="s1">HEXDIG$$ </span><span class="s2">+ </span><span class="s1">HEXDIG$$ </span><span class="s2">+ </span><span class="s3">&quot;%&quot; </span><span class="s2">+ </span><span class="s1">HEXDIG$$ </span><span class="s2">+ </span><span class="s1">HEXDIG$$</span><span class="s2">) + </span><span class="s3">&quot;|&quot; </span><span class="s2">+ </span><span class="s1">subexp</span><span class="s2">(</span><span class="s3">&quot;%[89A-Fa-f]&quot; </span><span class="s2">+ </span><span class="s1">HEXDIG$$ </span><span class="s2">+ </span><span class="s3">&quot;%&quot; </span><span class="s2">+ </span><span class="s1">HEXDIG$$ </span><span class="s2">+ </span><span class="s1">HEXDIG$$</span><span class="s2">) + </span><span class="s3">&quot;|&quot; </span><span class="s2">+ </span><span class="s1">subexp</span><span class="s2">(</span><span class="s3">&quot;%&quot; </span><span class="s2">+ </span><span class="s1">HEXDIG$$ </span><span class="s2">+ </span><span class="s1">HEXDIG$$</span><span class="s2">)); </span><span class="s4">//expanded</span>
<span class="s4">//RFC 5322, except these symbols as per RFC 6068: @ : / ? # [ ] &amp; ; =</span>
<span class="s4">//const ATEXT$$ = &quot;[A-Za-z0-9\\!\\#\\$\\%\\&amp;\\'\\*\\+\\-\\/\\=\\?\\^\\_\\`\\{\\|\\}\\~]&quot;;</span>
<span class="s4">//const WSP$$ = &quot;[\\x20\\x09]&quot;;</span>
<span class="s4">//const OBS_QTEXT$$ = &quot;[\\x01-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]&quot;;  //(%d1-8 / %d11-12 / %d14-31 / %d127)</span>
<span class="s4">//const QTEXT$$ = merge(&quot;[\\x21\\x23-\\x5B\\x5D-\\x7E]&quot;, OBS_QTEXT$$);  //%d33 / %d35-91 / %d93-126 / obs-qtext</span>
<span class="s4">//const VCHAR$$ = &quot;[\\x21-\\x7E]&quot;;</span>
<span class="s4">//const WSP$$ = &quot;[\\x20\\x09]&quot;;</span>
<span class="s4">//const OBS_QP$ = subexp(&quot;\\\\&quot; + merge(&quot;[\\x00\\x0D\\x0A]&quot;, OBS_QTEXT$$));  //%d0 / CR / LF / obs-qtext</span>
<span class="s4">//const FWS$ = subexp(subexp(WSP$$ + &quot;*&quot; + &quot;\\x0D\\x0A&quot;) + &quot;?&quot; + WSP$$ + &quot;+&quot;);</span>
<span class="s4">//const QUOTED_PAIR$ = subexp(subexp(&quot;\\\\&quot; + subexp(VCHAR$$ + &quot;|&quot; + WSP$$)) + &quot;|&quot; + OBS_QP$);</span>
<span class="s4">//const QUOTED_STRING$ = subexp('\\&quot;' + subexp(FWS$ + &quot;?&quot; + QCONTENT$) + &quot;*&quot; + FWS$ + &quot;?&quot; + '\\&quot;');</span>
<span class="s0">const </span><span class="s1">ATEXT$$ </span><span class="s2">= </span><span class="s3">&quot;[A-Za-z0-9</span><span class="s0">\\</span><span class="s3">!</span><span class="s0">\\</span><span class="s3">$</span><span class="s0">\\</span><span class="s3">%</span><span class="s0">\\</span><span class="s3">'</span><span class="s0">\\</span><span class="s3">*</span><span class="s0">\\</span><span class="s3">+</span><span class="s0">\\</span><span class="s3">-</span><span class="s0">\\</span><span class="s3">^</span><span class="s0">\\</span><span class="s3">_</span><span class="s0">\\</span><span class="s3">`</span><span class="s0">\\</span><span class="s3">{</span><span class="s0">\\</span><span class="s3">|</span><span class="s0">\\</span><span class="s3">}</span><span class="s0">\\</span><span class="s3">~]&quot;</span><span class="s2">;</span>
<span class="s0">const </span><span class="s1">QTEXT$$ </span><span class="s2">= </span><span class="s3">&quot;[</span><span class="s0">\\</span><span class="s3">!</span><span class="s0">\\</span><span class="s3">$</span><span class="s0">\\</span><span class="s3">%</span><span class="s0">\\</span><span class="s3">'</span><span class="s0">\\</span><span class="s3">(</span><span class="s0">\\</span><span class="s3">)</span><span class="s0">\\</span><span class="s3">*</span><span class="s0">\\</span><span class="s3">+</span><span class="s0">\\</span><span class="s3">,</span><span class="s0">\\</span><span class="s3">-</span><span class="s0">\\</span><span class="s3">.0-9</span><span class="s0">\\</span><span class="s3">&lt;</span><span class="s0">\\</span><span class="s3">&gt;A-Z</span><span class="s0">\\</span><span class="s3">x5E-</span><span class="s0">\\</span><span class="s3">x7E]&quot;</span><span class="s2">;</span>
<span class="s0">const </span><span class="s1">VCHAR$$ </span><span class="s2">= </span><span class="s1">merge</span><span class="s2">(</span><span class="s1">QTEXT$$</span><span class="s2">, </span><span class="s3">&quot;[</span><span class="s0">\\\&quot;\\\\</span><span class="s3">]&quot;</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">DOT_ATOM_TEXT$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s1">ATEXT$$ </span><span class="s2">+ </span><span class="s3">&quot;+&quot; </span><span class="s2">+ </span><span class="s1">subexp</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">.&quot; </span><span class="s2">+ </span><span class="s1">ATEXT$$ </span><span class="s2">+ </span><span class="s3">&quot;+&quot;</span><span class="s2">) + </span><span class="s3">&quot;*&quot;</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">QUOTED_PAIR$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\\\\</span><span class="s3">&quot; </span><span class="s2">+ </span><span class="s1">VCHAR$$</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">QCONTENT$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s1">QTEXT$$ </span><span class="s2">+ </span><span class="s3">&quot;|&quot; </span><span class="s2">+ </span><span class="s1">QUOTED_PAIR$</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">QUOTED_STRING$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s3">'</span><span class="s0">\\</span><span class="s3">&quot;' </span><span class="s2">+ </span><span class="s1">QCONTENT$ </span><span class="s2">+ </span><span class="s3">&quot;*&quot; </span><span class="s2">+ </span><span class="s3">'</span><span class="s0">\\</span><span class="s3">&quot;'</span><span class="s2">);</span>
<span class="s4">//RFC 6068</span>
<span class="s0">const </span><span class="s1">DTEXT_NO_OBS$$ </span><span class="s2">= </span><span class="s3">&quot;[</span><span class="s0">\\</span><span class="s3">x21-</span><span class="s0">\\</span><span class="s3">x5A</span><span class="s0">\\</span><span class="s3">x5E-</span><span class="s0">\\</span><span class="s3">x7E]&quot;</span><span class="s2">; </span><span class="s4">//%d33-90 / %d94-126</span>
<span class="s0">const </span><span class="s1">SOME_DELIMS$$ </span><span class="s2">= </span><span class="s3">&quot;[</span><span class="s0">\\</span><span class="s3">!</span><span class="s0">\\</span><span class="s3">$</span><span class="s0">\\</span><span class="s3">'</span><span class="s0">\\</span><span class="s3">(</span><span class="s0">\\</span><span class="s3">)</span><span class="s0">\\</span><span class="s3">*</span><span class="s0">\\</span><span class="s3">+</span><span class="s0">\\</span><span class="s3">,</span><span class="s0">\\</span><span class="s3">;</span><span class="s0">\\</span><span class="s3">:</span><span class="s0">\\</span><span class="s3">@]&quot;</span><span class="s2">;</span>
<span class="s0">const </span><span class="s1">QCHAR$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s1">UNRESERVED$$ </span><span class="s2">+ </span><span class="s3">&quot;|&quot; </span><span class="s2">+ </span><span class="s1">PCT_ENCODED$ </span><span class="s2">+ </span><span class="s3">&quot;|&quot; </span><span class="s2">+ </span><span class="s1">SOME_DELIMS$$</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">DOMAIN$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s1">DOT_ATOM_TEXT$ </span><span class="s2">+ </span><span class="s3">&quot;|&quot; </span><span class="s2">+ </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">[&quot; </span><span class="s2">+ </span><span class="s1">DTEXT_NO_OBS$$ </span><span class="s2">+ </span><span class="s3">&quot;*&quot; </span><span class="s2">+ </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">]&quot;</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">LOCAL_PART$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s1">DOT_ATOM_TEXT$ </span><span class="s2">+ </span><span class="s3">&quot;|&quot; </span><span class="s2">+ </span><span class="s1">QUOTED_STRING$</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">ADDR_SPEC$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s1">LOCAL_PART$ </span><span class="s2">+ </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">@&quot; </span><span class="s2">+ </span><span class="s1">DOMAIN$</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">TO$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s1">ADDR_SPEC$ </span><span class="s2">+ </span><span class="s1">subexp</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">,&quot; </span><span class="s2">+ </span><span class="s1">ADDR_SPEC$</span><span class="s2">) + </span><span class="s3">&quot;*&quot;</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">HFNAME$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s1">QCHAR$ </span><span class="s2">+ </span><span class="s3">&quot;*&quot;</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">HFVALUE$ </span><span class="s2">= </span><span class="s1">HFNAME$</span><span class="s2">;</span>
<span class="s0">const </span><span class="s1">HFIELD$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s1">HFNAME$ </span><span class="s2">+ </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">=&quot; </span><span class="s2">+ </span><span class="s1">HFVALUE$</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">HFIELDS2$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s1">HFIELD$ </span><span class="s2">+ </span><span class="s1">subexp</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">&amp;&quot; </span><span class="s2">+ </span><span class="s1">HFIELD$</span><span class="s2">) + </span><span class="s3">&quot;*&quot;</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">HFIELDS$ </span><span class="s2">= </span><span class="s1">subexp</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">?&quot; </span><span class="s2">+ </span><span class="s1">HFIELDS2$</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">MAILTO_URI </span><span class="s2">= </span><span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s3">&quot;^mailto</span><span class="s0">\\</span><span class="s3">:&quot; </span><span class="s2">+ </span><span class="s1">TO$ </span><span class="s2">+ </span><span class="s3">&quot;?&quot; </span><span class="s2">+ </span><span class="s1">HFIELDS$ </span><span class="s2">+ </span><span class="s3">&quot;?$&quot;</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">UNRESERVED </span><span class="s2">= </span><span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s1">UNRESERVED$$</span><span class="s2">, </span><span class="s3">&quot;g&quot;</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">PCT_ENCODED </span><span class="s2">= </span><span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s1">PCT_ENCODED$</span><span class="s2">, </span><span class="s3">&quot;g&quot;</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">NOT_LOCAL_PART </span><span class="s2">= </span><span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s1">merge</span><span class="s2">(</span><span class="s3">&quot;[^]&quot;</span><span class="s2">, </span><span class="s1">ATEXT$$</span><span class="s2">, </span><span class="s3">&quot;[</span><span class="s0">\\</span><span class="s3">.]&quot;</span><span class="s2">, </span><span class="s3">'[</span><span class="s0">\\</span><span class="s3">&quot;]'</span><span class="s2">, </span><span class="s1">VCHAR$$</span><span class="s2">), </span><span class="s3">&quot;g&quot;</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">NOT_DOMAIN </span><span class="s2">= </span><span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s1">merge</span><span class="s2">(</span><span class="s3">&quot;[^]&quot;</span><span class="s2">, </span><span class="s1">ATEXT$$</span><span class="s2">, </span><span class="s3">&quot;[</span><span class="s0">\\</span><span class="s3">.]&quot;</span><span class="s2">, </span><span class="s3">&quot;[</span><span class="s0">\\</span><span class="s3">[]&quot;</span><span class="s2">, </span><span class="s1">DTEXT_NO_OBS$$</span><span class="s2">, </span><span class="s3">&quot;[</span><span class="s0">\\</span><span class="s3">]]&quot;</span><span class="s2">), </span><span class="s3">&quot;g&quot;</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">NOT_HFNAME </span><span class="s2">= </span><span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s1">merge</span><span class="s2">(</span><span class="s3">&quot;[^]&quot;</span><span class="s2">, </span><span class="s1">UNRESERVED$$</span><span class="s2">, </span><span class="s1">SOME_DELIMS$$</span><span class="s2">), </span><span class="s3">&quot;g&quot;</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">NOT_HFVALUE </span><span class="s2">= </span><span class="s1">NOT_HFNAME</span><span class="s2">;</span>
<span class="s0">const </span><span class="s1">TO </span><span class="s2">= </span><span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s3">&quot;^&quot; </span><span class="s2">+ </span><span class="s1">TO$ </span><span class="s2">+ </span><span class="s3">&quot;$&quot;</span><span class="s2">);</span>
<span class="s0">const </span><span class="s1">HFIELDS </span><span class="s2">= </span><span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s3">&quot;^&quot; </span><span class="s2">+ </span><span class="s1">HFIELDS2$ </span><span class="s2">+ </span><span class="s3">&quot;$&quot;</span><span class="s2">);</span>
<span class="s0">function </span><span class="s1">decodeUnreserved</span><span class="s2">(</span><span class="s1">str</span><span class="s2">) {</span>
    <span class="s0">const </span><span class="s1">decStr </span><span class="s2">= </span><span class="s1">pctDecChars</span><span class="s2">(</span><span class="s1">str</span><span class="s2">);</span>
    <span class="s0">return </span><span class="s2">(!</span><span class="s1">decStr</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s1">UNRESERVED</span><span class="s2">) ? </span><span class="s1">str </span><span class="s2">: </span><span class="s1">decStr</span><span class="s2">);</span>
<span class="s2">}</span>
<span class="s0">const </span><span class="s1">handler </span><span class="s2">= {</span>
    <span class="s1">scheme</span><span class="s2">: </span><span class="s3">&quot;mailto&quot;</span><span class="s2">,</span>
    <span class="s1">parse</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">components</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
        <span class="s0">const </span><span class="s1">mailtoComponents </span><span class="s2">= </span><span class="s1">components</span><span class="s2">;</span>
        <span class="s0">const </span><span class="s1">to </span><span class="s2">= </span><span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">to </span><span class="s2">= (</span><span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">path </span><span class="s2">? </span><span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;,&quot;</span><span class="s2">) : []);</span>
        <span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">path </span><span class="s2">= </span><span class="s1">undefined</span><span class="s2">;</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">query</span><span class="s2">) {</span>
            <span class="s0">let </span><span class="s1">unknownHeaders </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
            <span class="s0">const </span><span class="s1">headers </span><span class="s2">= {};</span>
            <span class="s0">const </span><span class="s1">hfields </span><span class="s2">= </span><span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">query</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;&amp;&quot;</span><span class="s2">);</span>
            <span class="s0">for </span><span class="s2">(</span><span class="s0">let </span><span class="s1">x </span><span class="s2">= </span><span class="s5">0</span><span class="s2">, </span><span class="s1">xl </span><span class="s2">= </span><span class="s1">hfields</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">x </span><span class="s2">&lt; </span><span class="s1">xl</span><span class="s2">; ++</span><span class="s1">x</span><span class="s2">) {</span>
                <span class="s0">const </span><span class="s1">hfield </span><span class="s2">= </span><span class="s1">hfields</span><span class="s2">[</span><span class="s1">x</span><span class="s2">].</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;=&quot;</span><span class="s2">);</span>
                <span class="s0">switch </span><span class="s2">(</span><span class="s1">hfield</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]) {</span>
                    <span class="s0">case </span><span class="s3">&quot;to&quot;</span><span class="s2">:</span>
                        <span class="s0">const </span><span class="s1">toAddrs </span><span class="s2">= </span><span class="s1">hfield</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;,&quot;</span><span class="s2">);</span>
                        <span class="s0">for </span><span class="s2">(</span><span class="s0">let </span><span class="s1">x </span><span class="s2">= </span><span class="s5">0</span><span class="s2">, </span><span class="s1">xl </span><span class="s2">= </span><span class="s1">toAddrs</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">x </span><span class="s2">&lt; </span><span class="s1">xl</span><span class="s2">; ++</span><span class="s1">x</span><span class="s2">) {</span>
                            <span class="s1">to</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">toAddrs</span><span class="s2">[</span><span class="s1">x</span><span class="s2">]);</span>
                        <span class="s2">}</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s0">case </span><span class="s3">&quot;subject&quot;</span><span class="s2">:</span>
                        <span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">subject </span><span class="s2">= </span><span class="s1">unescapeComponent</span><span class="s2">(</span><span class="s1">hfield</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">options</span><span class="s2">);</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s0">case </span><span class="s3">&quot;body&quot;</span><span class="s2">:</span>
                        <span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">body </span><span class="s2">= </span><span class="s1">unescapeComponent</span><span class="s2">(</span><span class="s1">hfield</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">options</span><span class="s2">);</span>
                        <span class="s0">break</span><span class="s2">;</span>
                    <span class="s0">default</span><span class="s2">:</span>
                        <span class="s1">unknownHeaders </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                        <span class="s1">headers</span><span class="s2">[</span><span class="s1">unescapeComponent</span><span class="s2">(</span><span class="s1">hfield</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">options</span><span class="s2">)] = </span><span class="s1">unescapeComponent</span><span class="s2">(</span><span class="s1">hfield</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">options</span><span class="s2">);</span>
                        <span class="s0">break</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">unknownHeaders</span><span class="s2">)</span>
                <span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">headers </span><span class="s2">= </span><span class="s1">headers</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">query </span><span class="s2">= </span><span class="s1">undefined</span><span class="s2">;</span>
        <span class="s0">for </span><span class="s2">(</span><span class="s0">let </span><span class="s1">x </span><span class="s2">= </span><span class="s5">0</span><span class="s2">, </span><span class="s1">xl </span><span class="s2">= </span><span class="s1">to</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">x </span><span class="s2">&lt; </span><span class="s1">xl</span><span class="s2">; ++</span><span class="s1">x</span><span class="s2">) {</span>
            <span class="s0">const </span><span class="s1">addr </span><span class="s2">= </span><span class="s1">to</span><span class="s2">[</span><span class="s1">x</span><span class="s2">].</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;@&quot;</span><span class="s2">);</span>
            <span class="s1">addr</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s1">unescapeComponent</span><span class="s2">(</span><span class="s1">addr</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]);</span>
            <span class="s0">if </span><span class="s2">(!</span><span class="s1">options</span><span class="s2">.</span><span class="s1">unicodeSupport</span><span class="s2">) {</span>
                <span class="s4">//convert Unicode IDN -&gt; ASCII IDN</span>
                <span class="s0">try </span><span class="s2">{</span>
                    <span class="s1">addr</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] = </span><span class="s1">punycode</span><span class="s2">.</span><span class="s1">toASCII</span><span class="s2">(</span><span class="s1">unescapeComponent</span><span class="s2">(</span><span class="s1">addr</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">options</span><span class="s2">).</span><span class="s1">toLowerCase</span><span class="s2">());</span>
                <span class="s2">}</span>
                <span class="s0">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
                    <span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">error </span><span class="s2">= </span><span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">error </span><span class="s2">|| </span><span class="s3">&quot;Email address's domain name can not be converted to ASCII via punycode: &quot; </span><span class="s2">+ </span><span class="s1">e</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
            <span class="s0">else </span><span class="s2">{</span>
                <span class="s1">addr</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] = </span><span class="s1">unescapeComponent</span><span class="s2">(</span><span class="s1">addr</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">options</span><span class="s2">).</span><span class="s1">toLowerCase</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s1">to</span><span class="s2">[</span><span class="s1">x</span><span class="s2">] = </span><span class="s1">addr</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s3">&quot;@&quot;</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s0">return </span><span class="s1">mailtoComponents</span><span class="s2">;</span>
    <span class="s2">},</span>
    <span class="s1">serialize</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">mailtoComponents</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
        <span class="s0">const </span><span class="s1">components </span><span class="s2">= </span><span class="s1">mailtoComponents</span><span class="s2">;</span>
        <span class="s0">const </span><span class="s1">to </span><span class="s2">= </span><span class="s1">toArray</span><span class="s2">(</span><span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">to</span><span class="s2">);</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">to</span><span class="s2">) {</span>
            <span class="s0">for </span><span class="s2">(</span><span class="s0">let </span><span class="s1">x </span><span class="s2">= </span><span class="s5">0</span><span class="s2">, </span><span class="s1">xl </span><span class="s2">= </span><span class="s1">to</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">x </span><span class="s2">&lt; </span><span class="s1">xl</span><span class="s2">; ++</span><span class="s1">x</span><span class="s2">) {</span>
                <span class="s0">const </span><span class="s1">toAddr </span><span class="s2">= </span><span class="s1">String</span><span class="s2">(</span><span class="s1">to</span><span class="s2">[</span><span class="s1">x</span><span class="s2">]);</span>
                <span class="s0">const </span><span class="s1">atIdx </span><span class="s2">= </span><span class="s1">toAddr</span><span class="s2">.</span><span class="s1">lastIndexOf</span><span class="s2">(</span><span class="s3">&quot;@&quot;</span><span class="s2">);</span>
                <span class="s0">const </span><span class="s1">localPart </span><span class="s2">= (</span><span class="s1">toAddr</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">atIdx</span><span class="s2">)).</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">PCT_ENCODED</span><span class="s2">, </span><span class="s1">decodeUnreserved</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">PCT_ENCODED</span><span class="s2">, </span><span class="s1">toUpperCase</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">NOT_LOCAL_PART</span><span class="s2">, </span><span class="s1">pctEncChar</span><span class="s2">);</span>
                <span class="s0">let </span><span class="s1">domain </span><span class="s2">= </span><span class="s1">toAddr</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">atIdx </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">);</span>
                <span class="s4">//convert IDN via punycode</span>
                <span class="s0">try </span><span class="s2">{</span>
                    <span class="s1">domain </span><span class="s2">= (!</span><span class="s1">options</span><span class="s2">.</span><span class="s1">iri </span><span class="s2">? </span><span class="s1">punycode</span><span class="s2">.</span><span class="s1">toASCII</span><span class="s2">(</span><span class="s1">unescapeComponent</span><span class="s2">(</span><span class="s1">domain</span><span class="s2">, </span><span class="s1">options</span><span class="s2">).</span><span class="s1">toLowerCase</span><span class="s2">()) : </span><span class="s1">punycode</span><span class="s2">.</span><span class="s1">toUnicode</span><span class="s2">(</span><span class="s1">domain</span><span class="s2">));</span>
                <span class="s2">}</span>
                <span class="s0">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
                    <span class="s1">components</span><span class="s2">.</span><span class="s1">error </span><span class="s2">= </span><span class="s1">components</span><span class="s2">.</span><span class="s1">error </span><span class="s2">|| </span><span class="s3">&quot;Email address's domain name can not be converted to &quot; </span><span class="s2">+ (!</span><span class="s1">options</span><span class="s2">.</span><span class="s1">iri </span><span class="s2">? </span><span class="s3">&quot;ASCII&quot; </span><span class="s2">: </span><span class="s3">&quot;Unicode&quot;</span><span class="s2">) + </span><span class="s3">&quot; via punycode: &quot; </span><span class="s2">+ </span><span class="s1">e</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s1">to</span><span class="s2">[</span><span class="s1">x</span><span class="s2">] = </span><span class="s1">localPart </span><span class="s2">+ </span><span class="s3">&quot;@&quot; </span><span class="s2">+ </span><span class="s1">domain</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">components</span><span class="s2">.</span><span class="s1">path </span><span class="s2">= </span><span class="s1">to</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s3">&quot;,&quot;</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s0">const </span><span class="s1">headers </span><span class="s2">= </span><span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">headers </span><span class="s2">= </span><span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">headers </span><span class="s2">|| {};</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">subject</span><span class="s2">)</span>
            <span class="s1">headers</span><span class="s2">[</span><span class="s3">&quot;subject&quot;</span><span class="s2">] = </span><span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">subject</span><span class="s2">;</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">body</span><span class="s2">)</span>
            <span class="s1">headers</span><span class="s2">[</span><span class="s3">&quot;body&quot;</span><span class="s2">] = </span><span class="s1">mailtoComponents</span><span class="s2">.</span><span class="s1">body</span><span class="s2">;</span>
        <span class="s0">const </span><span class="s1">fields </span><span class="s2">= [];</span>
        <span class="s0">for </span><span class="s2">(</span><span class="s0">const </span><span class="s1">name </span><span class="s0">in </span><span class="s1">headers</span><span class="s2">) {</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">headers</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] !== </span><span class="s1">O</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]) {</span>
                <span class="s1">fields</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">name</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">PCT_ENCODED</span><span class="s2">, </span><span class="s1">decodeUnreserved</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">PCT_ENCODED</span><span class="s2">, </span><span class="s1">toUpperCase</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">NOT_HFNAME</span><span class="s2">, </span><span class="s1">pctEncChar</span><span class="s2">) +</span>
                    <span class="s3">&quot;=&quot; </span><span class="s2">+</span>
                    <span class="s1">headers</span><span class="s2">[</span><span class="s1">name</span><span class="s2">].</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">PCT_ENCODED</span><span class="s2">, </span><span class="s1">decodeUnreserved</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">PCT_ENCODED</span><span class="s2">, </span><span class="s1">toUpperCase</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">NOT_HFVALUE</span><span class="s2">, </span><span class="s1">pctEncChar</span><span class="s2">));</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">fields</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">components</span><span class="s2">.</span><span class="s1">query </span><span class="s2">= </span><span class="s1">fields</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s3">&quot;&amp;&quot;</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s0">return </span><span class="s1">components</span><span class="s2">;</span>
    <span class="s2">}</span>
<span class="s2">};</span>
<span class="s0">export default </span><span class="s1">handler</span><span class="s2">;</span>
<span class="s4">//# sourceMappingURL=mailto.js.map</span></pre>
</body>
</html>