<html>
<head>
<title>fetch.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
fetch.js</font>
</center></td></tr></table>
<pre><span class="s0">/* eslint-disable no-prototype-builtins */</span>
<span class="s2">var </span><span class="s1">g </span><span class="s3">=</span>
  <span class="s3">(</span><span class="s2">typeof </span><span class="s1">globalThis </span><span class="s3">!== </span><span class="s4">'undefined' </span><span class="s3">&amp;&amp; </span><span class="s1">globalThis</span><span class="s3">) ||</span>
  <span class="s3">(</span><span class="s2">typeof </span><span class="s1">self </span><span class="s3">!== </span><span class="s4">'undefined' </span><span class="s3">&amp;&amp; </span><span class="s1">self</span><span class="s3">) ||</span>
  <span class="s0">// eslint-disable-next-line no-undef</span>
  <span class="s3">(</span><span class="s2">typeof </span><span class="s1">global </span><span class="s3">!== </span><span class="s4">'undefined' </span><span class="s3">&amp;&amp; </span><span class="s1">global</span><span class="s3">) ||</span>
  <span class="s3">{}</span>

<span class="s2">var </span><span class="s1">support </span><span class="s3">= {</span>
  <span class="s1">searchParams</span><span class="s3">: </span><span class="s4">'URLSearchParams' </span><span class="s2">in </span><span class="s1">g</span><span class="s3">,</span>
  <span class="s1">iterable</span><span class="s3">: </span><span class="s4">'Symbol' </span><span class="s2">in </span><span class="s1">g </span><span class="s3">&amp;&amp; </span><span class="s4">'iterator' </span><span class="s2">in </span><span class="s1">Symbol</span><span class="s3">,</span>
  <span class="s1">blob</span><span class="s3">:</span>
    <span class="s4">'FileReader' </span><span class="s2">in </span><span class="s1">g </span><span class="s3">&amp;&amp;</span>
    <span class="s4">'Blob' </span><span class="s2">in </span><span class="s1">g </span><span class="s3">&amp;&amp;</span>
    <span class="s3">(</span><span class="s2">function</span><span class="s3">() {</span>
      <span class="s2">try </span><span class="s3">{</span>
        <span class="s2">new </span><span class="s1">Blob</span><span class="s3">()</span>
        <span class="s2">return true</span>
      <span class="s3">} </span><span class="s2">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s2">return false</span>
      <span class="s3">}</span>
    <span class="s3">})(),</span>
  <span class="s1">formData</span><span class="s3">: </span><span class="s4">'FormData' </span><span class="s2">in </span><span class="s1">g</span><span class="s3">,</span>
  <span class="s1">arrayBuffer</span><span class="s3">: </span><span class="s4">'ArrayBuffer' </span><span class="s2">in </span><span class="s1">g</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">isDataView</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
  <span class="s2">return </span><span class="s1">obj </span><span class="s3">&amp;&amp; </span><span class="s1">DataView</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isPrototypeOf</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">)</span>
<span class="s3">}</span>

<span class="s2">if </span><span class="s3">(</span><span class="s1">support</span><span class="s3">.</span><span class="s1">arrayBuffer</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">viewClasses </span><span class="s3">= [</span>
    <span class="s4">'[object Int8Array]'</span><span class="s3">,</span>
    <span class="s4">'[object Uint8Array]'</span><span class="s3">,</span>
    <span class="s4">'[object Uint8ClampedArray]'</span><span class="s3">,</span>
    <span class="s4">'[object Int16Array]'</span><span class="s3">,</span>
    <span class="s4">'[object Uint16Array]'</span><span class="s3">,</span>
    <span class="s4">'[object Int32Array]'</span><span class="s3">,</span>
    <span class="s4">'[object Uint32Array]'</span><span class="s3">,</span>
    <span class="s4">'[object Float32Array]'</span><span class="s3">,</span>
    <span class="s4">'[object Float64Array]'</span>
  <span class="s3">]</span>

  <span class="s2">var </span><span class="s1">isArrayBufferView </span><span class="s3">=</span>
    <span class="s1">ArrayBuffer</span><span class="s3">.</span><span class="s1">isView </span><span class="s3">||</span>
    <span class="s2">function</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
      <span class="s2">return </span><span class="s1">obj </span><span class="s3">&amp;&amp; </span><span class="s1">viewClasses</span><span class="s3">.</span><span class="s1">indexOf</span><span class="s3">(</span><span class="s1">Object</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">)) &gt; -</span><span class="s5">1</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">normalizeName</span><span class="s3">(</span><span class="s1">name</span><span class="s3">) {</span>
  <span class="s2">if </span><span class="s3">(</span><span class="s2">typeof </span><span class="s1">name </span><span class="s3">!== </span><span class="s4">'string'</span><span class="s3">) {</span>
    <span class="s1">name </span><span class="s3">= </span><span class="s1">String</span><span class="s3">(</span><span class="s1">name</span><span class="s3">)</span>
  <span class="s3">}</span>
  <span class="s2">if </span><span class="s3">(</span><span class="s6">/[^a-z0-9\-#$%&amp;'*+.^_`|~!]/i</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">name</span><span class="s3">) || </span><span class="s1">name </span><span class="s3">=== </span><span class="s4">''</span><span class="s3">) {</span>
    <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">'Invalid character in header field name: &quot;' </span><span class="s3">+ </span><span class="s1">name </span><span class="s3">+ </span><span class="s4">'&quot;'</span><span class="s3">)</span>
  <span class="s3">}</span>
  <span class="s2">return </span><span class="s1">name</span><span class="s3">.</span><span class="s1">toLowerCase</span><span class="s3">()</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">normalizeValue</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
  <span class="s2">if </span><span class="s3">(</span><span class="s2">typeof </span><span class="s1">value </span><span class="s3">!== </span><span class="s4">'string'</span><span class="s3">) {</span>
    <span class="s1">value </span><span class="s3">= </span><span class="s1">String</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)</span>
  <span class="s3">}</span>
  <span class="s2">return </span><span class="s1">value</span>
<span class="s3">}</span>

<span class="s0">// Build a destructive iterator for the value list</span>
<span class="s2">function </span><span class="s1">iteratorFor</span><span class="s3">(</span><span class="s1">items</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">iterator </span><span class="s3">= {</span>
    <span class="s1">next</span><span class="s3">: </span><span class="s2">function</span><span class="s3">() {</span>
      <span class="s2">var </span><span class="s1">value </span><span class="s3">= </span><span class="s1">items</span><span class="s3">.</span><span class="s1">shift</span><span class="s3">()</span>
      <span class="s2">return </span><span class="s3">{</span><span class="s1">done</span><span class="s3">: </span><span class="s1">value </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">value</span><span class="s3">: </span><span class="s1">value</span><span class="s3">}</span>
    <span class="s3">}</span>
  <span class="s3">}</span>

  <span class="s2">if </span><span class="s3">(</span><span class="s1">support</span><span class="s3">.</span><span class="s1">iterable</span><span class="s3">) {</span>
    <span class="s1">iterator</span><span class="s3">[</span><span class="s1">Symbol</span><span class="s3">.</span><span class="s1">iterator</span><span class="s3">] = </span><span class="s2">function</span><span class="s3">() {</span>
      <span class="s2">return </span><span class="s1">iterator</span>
    <span class="s3">}</span>
  <span class="s3">}</span>

  <span class="s2">return </span><span class="s1">iterator</span>
<span class="s3">}</span>

<span class="s2">export function </span><span class="s1">Headers</span><span class="s3">(</span><span class="s1">headers</span><span class="s3">) {</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">map </span><span class="s3">= {}</span>

  <span class="s2">if </span><span class="s3">(</span><span class="s1">headers </span><span class="s2">instanceof </span><span class="s1">Headers</span><span class="s3">) {</span>
    <span class="s1">headers</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">name</span><span class="s3">) {</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">value</span><span class="s3">)</span>
    <span class="s3">}, </span><span class="s2">this</span><span class="s3">)</span>
  <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">Array</span><span class="s3">.</span><span class="s1">isArray</span><span class="s3">(</span><span class="s1">headers</span><span class="s3">)) {</span>
    <span class="s1">headers</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">header</span><span class="s3">) {</span>
      <span class="s2">if </span><span class="s3">(</span><span class="s1">header</span><span class="s3">.</span><span class="s1">length </span><span class="s3">!= </span><span class="s5">2</span><span class="s3">) {</span>
        <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">'Headers constructor: expected name/value pair to be length 2, found' </span><span class="s3">+ </span><span class="s1">header</span><span class="s3">.</span><span class="s1">length</span><span class="s3">)</span>
      <span class="s3">}</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">header</span><span class="s3">[</span><span class="s5">0</span><span class="s3">], </span><span class="s1">header</span><span class="s3">[</span><span class="s5">1</span><span class="s3">])</span>
    <span class="s3">}, </span><span class="s2">this</span><span class="s3">)</span>
  <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">headers</span><span class="s3">) {</span>
    <span class="s1">Object</span><span class="s3">.</span><span class="s1">getOwnPropertyNames</span><span class="s3">(</span><span class="s1">headers</span><span class="s3">).</span><span class="s1">forEach</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">) {</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">headers</span><span class="s3">[</span><span class="s1">name</span><span class="s3">])</span>
    <span class="s3">}, </span><span class="s2">this</span><span class="s3">)</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s1">Headers</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">append </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">value</span><span class="s3">) {</span>
  <span class="s1">name </span><span class="s3">= </span><span class="s1">normalizeName</span><span class="s3">(</span><span class="s1">name</span><span class="s3">)</span>
  <span class="s1">value </span><span class="s3">= </span><span class="s1">normalizeValue</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)</span>
  <span class="s2">var </span><span class="s1">oldValue </span><span class="s3">= </span><span class="s2">this</span><span class="s3">.</span><span class="s1">map</span><span class="s3">[</span><span class="s1">name</span><span class="s3">]</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">map</span><span class="s3">[</span><span class="s1">name</span><span class="s3">] = </span><span class="s1">oldValue </span><span class="s3">? </span><span class="s1">oldValue </span><span class="s3">+ </span><span class="s4">', ' </span><span class="s3">+ </span><span class="s1">value </span><span class="s3">: </span><span class="s1">value</span>
<span class="s3">}</span>

<span class="s1">Headers</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">[</span><span class="s4">'delete'</span><span class="s3">] = </span><span class="s2">function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">) {</span>
  <span class="s2">delete this</span><span class="s3">.</span><span class="s1">map</span><span class="s3">[</span><span class="s1">normalizeName</span><span class="s3">(</span><span class="s1">name</span><span class="s3">)]</span>
<span class="s3">}</span>

<span class="s1">Headers</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">get </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">) {</span>
  <span class="s1">name </span><span class="s3">= </span><span class="s1">normalizeName</span><span class="s3">(</span><span class="s1">name</span><span class="s3">)</span>
  <span class="s2">return this</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">name</span><span class="s3">) ? </span><span class="s2">this</span><span class="s3">.</span><span class="s1">map</span><span class="s3">[</span><span class="s1">name</span><span class="s3">] : </span><span class="s2">null</span>
<span class="s3">}</span>

<span class="s1">Headers</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">has </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">) {</span>
  <span class="s2">return this</span><span class="s3">.</span><span class="s1">map</span><span class="s3">.</span><span class="s1">hasOwnProperty</span><span class="s3">(</span><span class="s1">normalizeName</span><span class="s3">(</span><span class="s1">name</span><span class="s3">))</span>
<span class="s3">}</span>

<span class="s1">Headers</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">set </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">value</span><span class="s3">) {</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">map</span><span class="s3">[</span><span class="s1">normalizeName</span><span class="s3">(</span><span class="s1">name</span><span class="s3">)] = </span><span class="s1">normalizeValue</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)</span>
<span class="s3">}</span>

<span class="s1">Headers</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">forEach </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">callback</span><span class="s3">, </span><span class="s1">thisArg</span><span class="s3">) {</span>
  <span class="s2">for </span><span class="s3">(</span><span class="s2">var </span><span class="s1">name </span><span class="s2">in this</span><span class="s3">.</span><span class="s1">map</span><span class="s3">) {</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">map</span><span class="s3">.</span><span class="s1">hasOwnProperty</span><span class="s3">(</span><span class="s1">name</span><span class="s3">)) {</span>
      <span class="s1">callback</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">thisArg</span><span class="s3">, </span><span class="s2">this</span><span class="s3">.</span><span class="s1">map</span><span class="s3">[</span><span class="s1">name</span><span class="s3">], </span><span class="s1">name</span><span class="s3">, </span><span class="s2">this</span><span class="s3">)</span>
    <span class="s3">}</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s1">Headers</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">keys </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
  <span class="s2">var </span><span class="s1">items </span><span class="s3">= []</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">name</span><span class="s3">) {</span>
    <span class="s1">items</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">name</span><span class="s3">)</span>
  <span class="s3">})</span>
  <span class="s2">return </span><span class="s1">iteratorFor</span><span class="s3">(</span><span class="s1">items</span><span class="s3">)</span>
<span class="s3">}</span>

<span class="s1">Headers</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">values </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
  <span class="s2">var </span><span class="s1">items </span><span class="s3">= []</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
    <span class="s1">items</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)</span>
  <span class="s3">})</span>
  <span class="s2">return </span><span class="s1">iteratorFor</span><span class="s3">(</span><span class="s1">items</span><span class="s3">)</span>
<span class="s3">}</span>

<span class="s1">Headers</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">entries </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
  <span class="s2">var </span><span class="s1">items </span><span class="s3">= []</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">name</span><span class="s3">) {</span>
    <span class="s1">items</span><span class="s3">.</span><span class="s1">push</span><span class="s3">([</span><span class="s1">name</span><span class="s3">, </span><span class="s1">value</span><span class="s3">])</span>
  <span class="s3">})</span>
  <span class="s2">return </span><span class="s1">iteratorFor</span><span class="s3">(</span><span class="s1">items</span><span class="s3">)</span>
<span class="s3">}</span>

<span class="s2">if </span><span class="s3">(</span><span class="s1">support</span><span class="s3">.</span><span class="s1">iterable</span><span class="s3">) {</span>
  <span class="s1">Headers</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">[</span><span class="s1">Symbol</span><span class="s3">.</span><span class="s1">iterator</span><span class="s3">] = </span><span class="s1">Headers</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">entries</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">consumed</span><span class="s3">(</span><span class="s1">body</span><span class="s3">) {</span>
  <span class="s2">if </span><span class="s3">(</span><span class="s1">body</span><span class="s3">.</span><span class="s1">_noBody</span><span class="s3">) </span><span class="s2">return</span>
  <span class="s2">if </span><span class="s3">(</span><span class="s1">body</span><span class="s3">.</span><span class="s1">bodyUsed</span><span class="s3">) {</span>
    <span class="s2">return </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">reject</span><span class="s3">(</span><span class="s2">new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">'Already read'</span><span class="s3">))</span>
  <span class="s3">}</span>
  <span class="s1">body</span><span class="s3">.</span><span class="s1">bodyUsed </span><span class="s3">= </span><span class="s2">true</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">fileReaderReady</span><span class="s3">(</span><span class="s1">reader</span><span class="s3">) {</span>
  <span class="s2">return new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">resolve</span><span class="s3">, </span><span class="s1">reject</span><span class="s3">) {</span>
    <span class="s1">reader</span><span class="s3">.</span><span class="s1">onload </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
      <span class="s1">resolve</span><span class="s3">(</span><span class="s1">reader</span><span class="s3">.</span><span class="s1">result</span><span class="s3">)</span>
    <span class="s3">}</span>
    <span class="s1">reader</span><span class="s3">.</span><span class="s1">onerror </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
      <span class="s1">reject</span><span class="s3">(</span><span class="s1">reader</span><span class="s3">.</span><span class="s1">error</span><span class="s3">)</span>
    <span class="s3">}</span>
  <span class="s3">})</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">readBlobAsArrayBuffer</span><span class="s3">(</span><span class="s1">blob</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">reader </span><span class="s3">= </span><span class="s2">new </span><span class="s1">FileReader</span><span class="s3">()</span>
  <span class="s2">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s1">fileReaderReady</span><span class="s3">(</span><span class="s1">reader</span><span class="s3">)</span>
  <span class="s1">reader</span><span class="s3">.</span><span class="s1">readAsArrayBuffer</span><span class="s3">(</span><span class="s1">blob</span><span class="s3">)</span>
  <span class="s2">return </span><span class="s1">promise</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">readBlobAsText</span><span class="s3">(</span><span class="s1">blob</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">reader </span><span class="s3">= </span><span class="s2">new </span><span class="s1">FileReader</span><span class="s3">()</span>
  <span class="s2">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s1">fileReaderReady</span><span class="s3">(</span><span class="s1">reader</span><span class="s3">)</span>
  <span class="s2">var </span><span class="s1">match </span><span class="s3">= </span><span class="s6">/charset=([A-Za-z0-9_-]+)/</span><span class="s3">.</span><span class="s1">exec</span><span class="s3">(</span><span class="s1">blob</span><span class="s3">.</span><span class="s1">type</span><span class="s3">)</span>
  <span class="s2">var </span><span class="s1">encoding </span><span class="s3">= </span><span class="s1">match </span><span class="s3">? </span><span class="s1">match</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] : </span><span class="s4">'utf-8'</span>
  <span class="s1">reader</span><span class="s3">.</span><span class="s1">readAsText</span><span class="s3">(</span><span class="s1">blob</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">)</span>
  <span class="s2">return </span><span class="s1">promise</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">readArrayBufferAsText</span><span class="s3">(</span><span class="s1">buf</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">view </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Uint8Array</span><span class="s3">(</span><span class="s1">buf</span><span class="s3">)</span>
  <span class="s2">var </span><span class="s1">chars </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Array</span><span class="s3">(</span><span class="s1">view</span><span class="s3">.</span><span class="s1">length</span><span class="s3">)</span>

  <span class="s2">for </span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s5">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">view</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; </span><span class="s1">i</span><span class="s3">++) {</span>
    <span class="s1">chars</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">String</span><span class="s3">.</span><span class="s1">fromCharCode</span><span class="s3">(</span><span class="s1">view</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>
  <span class="s3">}</span>
  <span class="s2">return </span><span class="s1">chars</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s4">''</span><span class="s3">)</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">bufferClone</span><span class="s3">(</span><span class="s1">buf</span><span class="s3">) {</span>
  <span class="s2">if </span><span class="s3">(</span><span class="s1">buf</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">) {</span>
    <span class="s2">return </span><span class="s1">buf</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
  <span class="s3">} </span><span class="s2">else </span><span class="s3">{</span>
    <span class="s2">var </span><span class="s1">view </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Uint8Array</span><span class="s3">(</span><span class="s1">buf</span><span class="s3">.</span><span class="s1">byteLength</span><span class="s3">)</span>
    <span class="s1">view</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s2">new </span><span class="s1">Uint8Array</span><span class="s3">(</span><span class="s1">buf</span><span class="s3">))</span>
    <span class="s2">return </span><span class="s1">view</span><span class="s3">.</span><span class="s1">buffer</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">Body</span><span class="s3">() {</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">bodyUsed </span><span class="s3">= </span><span class="s2">false</span>

  <span class="s2">this</span><span class="s3">.</span><span class="s1">_initBody </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">body</span><span class="s3">) {</span>
    <span class="s0">/* 
      fetch-mock wraps the Response object in an ES6 Proxy to 
      provide useful test harness features such as flush. However, on 
      ES5 browsers without fetch or Proxy support pollyfills must be used; 
      the proxy-pollyfill is unable to proxy an attribute unless it exists 
      on the object before the Proxy is created. This change ensures 
      Response.bodyUsed exists on the instance, while maintaining the 
      semantic of setting Request.bodyUsed in the constructor before 
      _initBody is called. 
    */</span>
    <span class="s0">// eslint-disable-next-line no-self-assign</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">bodyUsed </span><span class="s3">= </span><span class="s2">this</span><span class="s3">.</span><span class="s1">bodyUsed</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyInit </span><span class="s3">= </span><span class="s1">body</span>
    <span class="s2">if </span><span class="s3">(!</span><span class="s1">body</span><span class="s3">) {</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">_noBody </span><span class="s3">= </span><span class="s2">true</span><span class="s3">;</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyText </span><span class="s3">= </span><span class="s4">''</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s2">typeof </span><span class="s1">body </span><span class="s3">=== </span><span class="s4">'string'</span><span class="s3">) {</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyText </span><span class="s3">= </span><span class="s1">body</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">support</span><span class="s3">.</span><span class="s1">blob </span><span class="s3">&amp;&amp; </span><span class="s1">Blob</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isPrototypeOf</span><span class="s3">(</span><span class="s1">body</span><span class="s3">)) {</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyBlob </span><span class="s3">= </span><span class="s1">body</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">support</span><span class="s3">.</span><span class="s1">formData </span><span class="s3">&amp;&amp; </span><span class="s1">FormData</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isPrototypeOf</span><span class="s3">(</span><span class="s1">body</span><span class="s3">)) {</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyFormData </span><span class="s3">= </span><span class="s1">body</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">support</span><span class="s3">.</span><span class="s1">searchParams </span><span class="s3">&amp;&amp; </span><span class="s1">URLSearchParams</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isPrototypeOf</span><span class="s3">(</span><span class="s1">body</span><span class="s3">)) {</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyText </span><span class="s3">= </span><span class="s1">body</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">()</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">support</span><span class="s3">.</span><span class="s1">arrayBuffer </span><span class="s3">&amp;&amp; </span><span class="s1">support</span><span class="s3">.</span><span class="s1">blob </span><span class="s3">&amp;&amp; </span><span class="s1">isDataView</span><span class="s3">(</span><span class="s1">body</span><span class="s3">)) {</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer </span><span class="s3">= </span><span class="s1">bufferClone</span><span class="s3">(</span><span class="s1">body</span><span class="s3">.</span><span class="s1">buffer</span><span class="s3">)</span>
      <span class="s0">// IE 10-11 can't handle a DataView body.</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyInit </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Blob</span><span class="s3">([</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer</span><span class="s3">])</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">support</span><span class="s3">.</span><span class="s1">arrayBuffer </span><span class="s3">&amp;&amp; (</span><span class="s1">ArrayBuffer</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isPrototypeOf</span><span class="s3">(</span><span class="s1">body</span><span class="s3">) || </span><span class="s1">isArrayBufferView</span><span class="s3">(</span><span class="s1">body</span><span class="s3">))) {</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer </span><span class="s3">= </span><span class="s1">bufferClone</span><span class="s3">(</span><span class="s1">body</span><span class="s3">)</span>
    <span class="s3">} </span><span class="s2">else </span><span class="s3">{</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyText </span><span class="s3">= </span><span class="s1">body </span><span class="s3">= </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">body</span><span class="s3">)</span>
    <span class="s3">}</span>

    <span class="s2">if </span><span class="s3">(!</span><span class="s2">this</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">'content-type'</span><span class="s3">)) {</span>
      <span class="s2">if </span><span class="s3">(</span><span class="s2">typeof </span><span class="s1">body </span><span class="s3">=== </span><span class="s4">'string'</span><span class="s3">) {</span>
        <span class="s2">this</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s4">'content-type'</span><span class="s3">, </span><span class="s4">'text/plain;charset=UTF-8'</span><span class="s3">)</span>
      <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyBlob </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyBlob</span><span class="s3">.</span><span class="s1">type</span><span class="s3">) {</span>
        <span class="s2">this</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s4">'content-type'</span><span class="s3">, </span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyBlob</span><span class="s3">.</span><span class="s1">type</span><span class="s3">)</span>
      <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">support</span><span class="s3">.</span><span class="s1">searchParams </span><span class="s3">&amp;&amp; </span><span class="s1">URLSearchParams</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isPrototypeOf</span><span class="s3">(</span><span class="s1">body</span><span class="s3">)) {</span>
        <span class="s2">this</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s4">'content-type'</span><span class="s3">, </span><span class="s4">'application/x-www-form-urlencoded;charset=UTF-8'</span><span class="s3">)</span>
      <span class="s3">}</span>
    <span class="s3">}</span>
  <span class="s3">}</span>

  <span class="s2">if </span><span class="s3">(</span><span class="s1">support</span><span class="s3">.</span><span class="s1">blob</span><span class="s3">) {</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">blob </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
      <span class="s2">var </span><span class="s1">rejected </span><span class="s3">= </span><span class="s1">consumed</span><span class="s3">(</span><span class="s2">this</span><span class="s3">)</span>
      <span class="s2">if </span><span class="s3">(</span><span class="s1">rejected</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">rejected</span>
      <span class="s3">}</span>

      <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyBlob</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyBlob</span><span class="s3">)</span>
      <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s2">new </span><span class="s1">Blob</span><span class="s3">([</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer</span><span class="s3">]))</span>
      <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyFormData</span><span class="s3">) {</span>
        <span class="s2">throw new </span><span class="s1">Error</span><span class="s3">(</span><span class="s4">'could not read FormData body as blob'</span><span class="s3">)</span>
      <span class="s3">} </span><span class="s2">else </span><span class="s3">{</span>
        <span class="s2">return </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s2">new </span><span class="s1">Blob</span><span class="s3">([</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyText</span><span class="s3">]))</span>
      <span class="s3">}</span>
    <span class="s3">}</span>
  <span class="s3">}</span>

  <span class="s2">this</span><span class="s3">.</span><span class="s1">arrayBuffer </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer</span><span class="s3">) {</span>
      <span class="s2">var </span><span class="s1">isConsumed </span><span class="s3">= </span><span class="s1">consumed</span><span class="s3">(</span><span class="s2">this</span><span class="s3">)</span>
      <span class="s2">if </span><span class="s3">(</span><span class="s1">isConsumed</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">isConsumed</span>
      <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">ArrayBuffer</span><span class="s3">.</span><span class="s1">isView</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer</span><span class="s3">)) {</span>
        <span class="s2">return </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span>
          <span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer</span><span class="s3">.</span><span class="s1">buffer</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span>
            <span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer</span><span class="s3">.</span><span class="s1">byteOffset</span><span class="s3">,</span>
            <span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer</span><span class="s3">.</span><span class="s1">byteOffset </span><span class="s3">+ </span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer</span><span class="s3">.</span><span class="s1">byteLength</span>
          <span class="s3">)</span>
        <span class="s3">)</span>
      <span class="s3">} </span><span class="s2">else </span><span class="s3">{</span>
        <span class="s2">return </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer</span><span class="s3">)</span>
      <span class="s3">}</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">support</span><span class="s3">.</span><span class="s1">blob</span><span class="s3">) {</span>
      <span class="s2">return this</span><span class="s3">.</span><span class="s1">blob</span><span class="s3">().</span><span class="s1">then</span><span class="s3">(</span><span class="s1">readBlobAsArrayBuffer</span><span class="s3">)</span>
    <span class="s3">} </span><span class="s2">else </span><span class="s3">{</span>
      <span class="s2">throw new </span><span class="s1">Error</span><span class="s3">(</span><span class="s4">'could not read as ArrayBuffer'</span><span class="s3">)</span>
    <span class="s3">}</span>
  <span class="s3">}</span>

  <span class="s2">this</span><span class="s3">.</span><span class="s1">text </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
    <span class="s2">var </span><span class="s1">rejected </span><span class="s3">= </span><span class="s1">consumed</span><span class="s3">(</span><span class="s2">this</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">rejected</span><span class="s3">) {</span>
      <span class="s2">return </span><span class="s1">rejected</span>
    <span class="s3">}</span>

    <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyBlob</span><span class="s3">) {</span>
      <span class="s2">return </span><span class="s1">readBlobAsText</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyBlob</span><span class="s3">)</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer</span><span class="s3">) {</span>
      <span class="s2">return </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">readArrayBufferAsText</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyArrayBuffer</span><span class="s3">))</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyFormData</span><span class="s3">) {</span>
      <span class="s2">throw new </span><span class="s1">Error</span><span class="s3">(</span><span class="s4">'could not read FormData body as text'</span><span class="s3">)</span>
    <span class="s3">} </span><span class="s2">else </span><span class="s3">{</span>
      <span class="s2">return </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyText</span><span class="s3">)</span>
    <span class="s3">}</span>
  <span class="s3">}</span>

  <span class="s2">if </span><span class="s3">(</span><span class="s1">support</span><span class="s3">.</span><span class="s1">formData</span><span class="s3">) {</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">formData </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
      <span class="s2">return this</span><span class="s3">.</span><span class="s1">text</span><span class="s3">().</span><span class="s1">then</span><span class="s3">(</span><span class="s1">decode</span><span class="s3">)</span>
    <span class="s3">}</span>
  <span class="s3">}</span>

  <span class="s2">this</span><span class="s3">.</span><span class="s1">json </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
    <span class="s2">return this</span><span class="s3">.</span><span class="s1">text</span><span class="s3">().</span><span class="s1">then</span><span class="s3">(</span><span class="s1">JSON</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">)</span>
  <span class="s3">}</span>

  <span class="s2">return this</span>
<span class="s3">}</span>

<span class="s0">// HTTP methods whose capitalization should be normalized</span>
<span class="s2">var </span><span class="s1">methods </span><span class="s3">= [</span><span class="s4">'CONNECT'</span><span class="s3">, </span><span class="s4">'DELETE'</span><span class="s3">, </span><span class="s4">'GET'</span><span class="s3">, </span><span class="s4">'HEAD'</span><span class="s3">, </span><span class="s4">'OPTIONS'</span><span class="s3">, </span><span class="s4">'PATCH'</span><span class="s3">, </span><span class="s4">'POST'</span><span class="s3">, </span><span class="s4">'PUT'</span><span class="s3">, </span><span class="s4">'TRACE'</span><span class="s3">]</span>

<span class="s2">function </span><span class="s1">normalizeMethod</span><span class="s3">(</span><span class="s1">method</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">upcased </span><span class="s3">= </span><span class="s1">method</span><span class="s3">.</span><span class="s1">toUpperCase</span><span class="s3">()</span>
  <span class="s2">return </span><span class="s1">methods</span><span class="s3">.</span><span class="s1">indexOf</span><span class="s3">(</span><span class="s1">upcased</span><span class="s3">) &gt; -</span><span class="s5">1 </span><span class="s3">? </span><span class="s1">upcased </span><span class="s3">: </span><span class="s1">method</span>
<span class="s3">}</span>

<span class="s2">export function </span><span class="s1">Request</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">options</span><span class="s3">) {</span>
  <span class="s2">if </span><span class="s3">(!(</span><span class="s2">this instanceof </span><span class="s1">Request</span><span class="s3">)) {</span>
    <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">'Please use the &quot;new&quot; operator, this DOM object constructor cannot be called as a function.'</span><span class="s3">)</span>
  <span class="s3">}</span>

  <span class="s1">options </span><span class="s3">= </span><span class="s1">options </span><span class="s3">|| {}</span>
  <span class="s2">var </span><span class="s1">body </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">body</span>

  <span class="s2">if </span><span class="s3">(</span><span class="s1">input </span><span class="s2">instanceof </span><span class="s1">Request</span><span class="s3">) {</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">bodyUsed</span><span class="s3">) {</span>
      <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">'Already read'</span><span class="s3">)</span>
    <span class="s3">}</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">url </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">url</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">credentials </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">credentials</span>
    <span class="s2">if </span><span class="s3">(!</span><span class="s1">options</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">) {</span>
      <span class="s2">this</span><span class="s3">.</span><span class="s1">headers </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Headers</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">)</span>
    <span class="s3">}</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">method </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">method</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">mode </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">mode</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">signal </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">signal</span>
    <span class="s2">if </span><span class="s3">(!</span><span class="s1">body </span><span class="s3">&amp;&amp; </span><span class="s1">input</span><span class="s3">.</span><span class="s1">_bodyInit </span><span class="s3">!= </span><span class="s2">null</span><span class="s3">) {</span>
      <span class="s1">body </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">_bodyInit</span>
      <span class="s1">input</span><span class="s3">.</span><span class="s1">bodyUsed </span><span class="s3">= </span><span class="s2">true</span>
    <span class="s3">}</span>
  <span class="s3">} </span><span class="s2">else </span><span class="s3">{</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">url </span><span class="s3">= </span><span class="s1">String</span><span class="s3">(</span><span class="s1">input</span><span class="s3">)</span>
  <span class="s3">}</span>

  <span class="s2">this</span><span class="s3">.</span><span class="s1">credentials </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">credentials </span><span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">credentials </span><span class="s3">|| </span><span class="s4">'same-origin'</span>
  <span class="s2">if </span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">headers </span><span class="s3">|| !</span><span class="s2">this</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">) {</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">headers </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Headers</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">)</span>
  <span class="s3">}</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">method </span><span class="s3">= </span><span class="s1">normalizeMethod</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">method </span><span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">method </span><span class="s3">|| </span><span class="s4">'GET'</span><span class="s3">)</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">mode </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">mode </span><span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">mode </span><span class="s3">|| </span><span class="s2">null</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">signal </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">signal </span><span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">signal </span><span class="s3">|| (</span><span class="s2">function </span><span class="s3">() {</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s4">'AbortController' </span><span class="s2">in </span><span class="s1">g</span><span class="s3">) {</span>
      <span class="s2">var </span><span class="s1">ctrl </span><span class="s3">= </span><span class="s2">new </span><span class="s1">AbortController</span><span class="s3">();</span>
      <span class="s2">return </span><span class="s1">ctrl</span><span class="s3">.</span><span class="s1">signal</span><span class="s3">;</span>
    <span class="s3">}</span>
  <span class="s3">}());</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">referrer </span><span class="s3">= </span><span class="s2">null</span>

  <span class="s2">if </span><span class="s3">((</span><span class="s2">this</span><span class="s3">.</span><span class="s1">method </span><span class="s3">=== </span><span class="s4">'GET' </span><span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">method </span><span class="s3">=== </span><span class="s4">'HEAD'</span><span class="s3">) &amp;&amp; </span><span class="s1">body</span><span class="s3">) {</span>
    <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">'Body not allowed for GET or HEAD requests'</span><span class="s3">)</span>
  <span class="s3">}</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">_initBody</span><span class="s3">(</span><span class="s1">body</span><span class="s3">)</span>

  <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">method </span><span class="s3">=== </span><span class="s4">'GET' </span><span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">method </span><span class="s3">=== </span><span class="s4">'HEAD'</span><span class="s3">) {</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">cache </span><span class="s3">=== </span><span class="s4">'no-store' </span><span class="s3">|| </span><span class="s1">options</span><span class="s3">.</span><span class="s1">cache </span><span class="s3">=== </span><span class="s4">'no-cache'</span><span class="s3">) {</span>
      <span class="s0">// Search for a '_' parameter in the query string</span>
      <span class="s2">var </span><span class="s1">reParamSearch </span><span class="s3">= </span><span class="s6">/([?&amp;])_=[^&amp;]*/</span>
      <span class="s2">if </span><span class="s3">(</span><span class="s1">reParamSearch</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">url</span><span class="s3">)) {</span>
        <span class="s0">// If it already exists then set the value with the current time</span>
        <span class="s2">this</span><span class="s3">.</span><span class="s1">url </span><span class="s3">= </span><span class="s2">this</span><span class="s3">.</span><span class="s1">url</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s1">reParamSearch</span><span class="s3">, </span><span class="s4">'$1_=' </span><span class="s3">+ </span><span class="s2">new </span><span class="s1">Date</span><span class="s3">().</span><span class="s1">getTime</span><span class="s3">())</span>
      <span class="s3">} </span><span class="s2">else </span><span class="s3">{</span>
        <span class="s0">// Otherwise add a new '_' parameter to the end with the current time</span>
        <span class="s2">var </span><span class="s1">reQueryString </span><span class="s3">= </span><span class="s6">/\?/</span>
        <span class="s2">this</span><span class="s3">.</span><span class="s1">url </span><span class="s3">+= (</span><span class="s1">reQueryString</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">url</span><span class="s3">) ? </span><span class="s4">'&amp;' </span><span class="s3">: </span><span class="s4">'?'</span><span class="s3">) + </span><span class="s4">'_=' </span><span class="s3">+ </span><span class="s2">new </span><span class="s1">Date</span><span class="s3">().</span><span class="s1">getTime</span><span class="s3">()</span>
      <span class="s3">}</span>
    <span class="s3">}</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s1">Request</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">clone </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
  <span class="s2">return new </span><span class="s1">Request</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, {</span><span class="s1">body</span><span class="s3">: </span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyInit</span><span class="s3">})</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">decode</span><span class="s3">(</span><span class="s1">body</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">form </span><span class="s3">= </span><span class="s2">new </span><span class="s1">FormData</span><span class="s3">()</span>
  <span class="s1">body</span>
    <span class="s3">.</span><span class="s1">trim</span><span class="s3">()</span>
    <span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s4">'&amp;'</span><span class="s3">)</span>
    <span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">bytes</span><span class="s3">) {</span>
      <span class="s2">if </span><span class="s3">(</span><span class="s1">bytes</span><span class="s3">) {</span>
        <span class="s2">var </span><span class="s1">split </span><span class="s3">= </span><span class="s1">bytes</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s4">'='</span><span class="s3">)</span>
        <span class="s2">var </span><span class="s1">name </span><span class="s3">= </span><span class="s1">split</span><span class="s3">.</span><span class="s1">shift</span><span class="s3">().</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/\+/g</span><span class="s3">, </span><span class="s4">' '</span><span class="s3">)</span>
        <span class="s2">var </span><span class="s1">value </span><span class="s3">= </span><span class="s1">split</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s4">'='</span><span class="s3">).</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/\+/g</span><span class="s3">, </span><span class="s4">' '</span><span class="s3">)</span>
        <span class="s1">form</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">decodeURIComponent</span><span class="s3">(</span><span class="s1">name</span><span class="s3">), </span><span class="s1">decodeURIComponent</span><span class="s3">(</span><span class="s1">value</span><span class="s3">))</span>
      <span class="s3">}</span>
    <span class="s3">})</span>
  <span class="s2">return </span><span class="s1">form</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">parseHeaders</span><span class="s3">(</span><span class="s1">rawHeaders</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">headers </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Headers</span><span class="s3">()</span>
  <span class="s0">// Replace instances of \r\n and \n followed by at least one space or horizontal tab with a space</span>
  <span class="s0">// https://tools.ietf.org/html/rfc7230#section-3.2</span>
  <span class="s2">var </span><span class="s1">preProcessedHeaders </span><span class="s3">= </span><span class="s1">rawHeaders</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/\r?\n[\t ]+/g</span><span class="s3">, </span><span class="s4">' '</span><span class="s3">)</span>
  <span class="s0">// Avoiding split via regex to work around a common IE11 bug with the core-js 3.6.0 regex polyfill</span>
  <span class="s0">// https://github.com/github/fetch/issues/748</span>
  <span class="s0">// https://github.com/zloirock/core-js/issues/751</span>
  <span class="s1">preProcessedHeaders</span>
    <span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s4">'</span><span class="s2">\r</span><span class="s4">'</span><span class="s3">)</span>
    <span class="s3">.</span><span class="s1">map</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">header</span><span class="s3">) {</span>
      <span class="s2">return </span><span class="s1">header</span><span class="s3">.</span><span class="s1">indexOf</span><span class="s3">(</span><span class="s4">'</span><span class="s2">\n</span><span class="s4">'</span><span class="s3">) === </span><span class="s5">0 </span><span class="s3">? </span><span class="s1">header</span><span class="s3">.</span><span class="s1">substr</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s1">header</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) : </span><span class="s1">header</span>
    <span class="s3">})</span>
    <span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">line</span><span class="s3">) {</span>
      <span class="s2">var </span><span class="s1">parts </span><span class="s3">= </span><span class="s1">line</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s4">':'</span><span class="s3">)</span>
      <span class="s2">var </span><span class="s1">key </span><span class="s3">= </span><span class="s1">parts</span><span class="s3">.</span><span class="s1">shift</span><span class="s3">().</span><span class="s1">trim</span><span class="s3">()</span>
      <span class="s2">if </span><span class="s3">(</span><span class="s1">key</span><span class="s3">) {</span>
        <span class="s2">var </span><span class="s1">value </span><span class="s3">= </span><span class="s1">parts</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s4">':'</span><span class="s3">).</span><span class="s1">trim</span><span class="s3">()</span>
        <span class="s2">try </span><span class="s3">{</span>
          <span class="s1">headers</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">key</span><span class="s3">, </span><span class="s1">value</span><span class="s3">)</span>
        <span class="s3">} </span><span class="s2">catch </span><span class="s3">(</span><span class="s1">error</span><span class="s3">) {</span>
          <span class="s1">console</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span><span class="s4">'Response ' </span><span class="s3">+ </span><span class="s1">error</span><span class="s3">.</span><span class="s1">message</span><span class="s3">)</span>
        <span class="s3">}</span>
      <span class="s3">}</span>
    <span class="s3">})</span>
  <span class="s2">return </span><span class="s1">headers</span>
<span class="s3">}</span>

<span class="s1">Body</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">Request</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">)</span>

<span class="s2">export function </span><span class="s1">Response</span><span class="s3">(</span><span class="s1">bodyInit</span><span class="s3">, </span><span class="s1">options</span><span class="s3">) {</span>
  <span class="s2">if </span><span class="s3">(!(</span><span class="s2">this instanceof </span><span class="s1">Response</span><span class="s3">)) {</span>
    <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">'Please use the &quot;new&quot; operator, this DOM object constructor cannot be called as a function.'</span><span class="s3">)</span>
  <span class="s3">}</span>
  <span class="s2">if </span><span class="s3">(!</span><span class="s1">options</span><span class="s3">) {</span>
    <span class="s1">options </span><span class="s3">= {}</span>
  <span class="s3">}</span>

  <span class="s2">this</span><span class="s3">.</span><span class="s1">type </span><span class="s3">= </span><span class="s4">'default'</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">status </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">status </span><span class="s3">=== </span><span class="s1">undefined </span><span class="s3">? </span><span class="s5">200 </span><span class="s3">: </span><span class="s1">options</span><span class="s3">.</span><span class="s1">status</span>
  <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">status </span><span class="s3">&lt; </span><span class="s5">200 </span><span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">status </span><span class="s3">&gt; </span><span class="s5">599</span><span class="s3">) {</span>
    <span class="s2">throw new </span><span class="s1">RangeError</span><span class="s3">(</span><span class="s4">&quot;Failed to construct 'Response': The status provided (0) is outside the range [200, 599].&quot;</span><span class="s3">)</span>
  <span class="s3">}</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">ok </span><span class="s3">= </span><span class="s2">this</span><span class="s3">.</span><span class="s1">status </span><span class="s3">&gt;= </span><span class="s5">200 </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">status </span><span class="s3">&lt; </span><span class="s5">300</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">statusText </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">statusText </span><span class="s3">=== </span><span class="s1">undefined </span><span class="s3">? </span><span class="s4">'' </span><span class="s3">: </span><span class="s4">'' </span><span class="s3">+ </span><span class="s1">options</span><span class="s3">.</span><span class="s1">statusText</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">headers </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Headers</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">)</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">url </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">url </span><span class="s3">|| </span><span class="s4">''</span>
  <span class="s2">this</span><span class="s3">.</span><span class="s1">_initBody</span><span class="s3">(</span><span class="s1">bodyInit</span><span class="s3">)</span>
<span class="s3">}</span>

<span class="s1">Body</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">Response</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">)</span>

<span class="s1">Response</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">clone </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
  <span class="s2">return new </span><span class="s1">Response</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">_bodyInit</span><span class="s3">, {</span>
    <span class="s1">status</span><span class="s3">: </span><span class="s2">this</span><span class="s3">.</span><span class="s1">status</span><span class="s3">,</span>
    <span class="s1">statusText</span><span class="s3">: </span><span class="s2">this</span><span class="s3">.</span><span class="s1">statusText</span><span class="s3">,</span>
    <span class="s1">headers</span><span class="s3">: </span><span class="s2">new </span><span class="s1">Headers</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">),</span>
    <span class="s1">url</span><span class="s3">: </span><span class="s2">this</span><span class="s3">.</span><span class="s1">url</span>
  <span class="s3">})</span>
<span class="s3">}</span>

<span class="s1">Response</span><span class="s3">.</span><span class="s1">error </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
  <span class="s2">var </span><span class="s1">response </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Response</span><span class="s3">(</span><span class="s2">null</span><span class="s3">, {</span><span class="s1">status</span><span class="s3">: </span><span class="s5">200</span><span class="s3">, </span><span class="s1">statusText</span><span class="s3">: </span><span class="s4">''</span><span class="s3">})</span>
  <span class="s1">response</span><span class="s3">.</span><span class="s1">status </span><span class="s3">= </span><span class="s5">0</span>
  <span class="s1">response</span><span class="s3">.</span><span class="s1">type </span><span class="s3">= </span><span class="s4">'error'</span>
  <span class="s2">return </span><span class="s1">response</span>
<span class="s3">}</span>

<span class="s2">var </span><span class="s1">redirectStatuses </span><span class="s3">= [</span><span class="s5">301</span><span class="s3">, </span><span class="s5">302</span><span class="s3">, </span><span class="s5">303</span><span class="s3">, </span><span class="s5">307</span><span class="s3">, </span><span class="s5">308</span><span class="s3">]</span>

<span class="s1">Response</span><span class="s3">.</span><span class="s1">redirect </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">url</span><span class="s3">, </span><span class="s1">status</span><span class="s3">) {</span>
  <span class="s2">if </span><span class="s3">(</span><span class="s1">redirectStatuses</span><span class="s3">.</span><span class="s1">indexOf</span><span class="s3">(</span><span class="s1">status</span><span class="s3">) === -</span><span class="s5">1</span><span class="s3">) {</span>
    <span class="s2">throw new </span><span class="s1">RangeError</span><span class="s3">(</span><span class="s4">'Invalid status code'</span><span class="s3">)</span>
  <span class="s3">}</span>

  <span class="s2">return new </span><span class="s1">Response</span><span class="s3">(</span><span class="s2">null</span><span class="s3">, {</span><span class="s1">status</span><span class="s3">: </span><span class="s1">status</span><span class="s3">, </span><span class="s1">headers</span><span class="s3">: {</span><span class="s1">location</span><span class="s3">: </span><span class="s1">url</span><span class="s3">}})</span>
<span class="s3">}</span>

<span class="s2">export var </span><span class="s1">DOMException </span><span class="s3">= </span><span class="s1">g</span><span class="s3">.</span><span class="s1">DOMException</span>
<span class="s2">try </span><span class="s3">{</span>
  <span class="s2">new </span><span class="s1">DOMException</span><span class="s3">()</span>
<span class="s3">} </span><span class="s2">catch </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
  <span class="s1">DOMException </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">name</span><span class="s3">) {</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">message </span><span class="s3">= </span><span class="s1">message</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">name </span><span class="s3">= </span><span class="s1">name</span>
    <span class="s2">var </span><span class="s1">error </span><span class="s3">= </span><span class="s1">Error</span><span class="s3">(</span><span class="s1">message</span><span class="s3">)</span>
    <span class="s2">this</span><span class="s3">.</span><span class="s1">stack </span><span class="s3">= </span><span class="s1">error</span><span class="s3">.</span><span class="s1">stack</span>
  <span class="s3">}</span>
  <span class="s1">DOMException</span><span class="s3">.</span><span class="s1">prototype </span><span class="s3">= </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">create</span><span class="s3">(</span><span class="s1">Error</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">)</span>
  <span class="s1">DOMException</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">constructor </span><span class="s3">= </span><span class="s1">DOMException</span>
<span class="s3">}</span>

<span class="s2">export function </span><span class="s1">fetch</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">init</span><span class="s3">) {</span>
  <span class="s2">return new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">resolve</span><span class="s3">, </span><span class="s1">reject</span><span class="s3">) {</span>
    <span class="s2">var </span><span class="s1">request </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Request</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">init</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s3">(</span><span class="s1">request</span><span class="s3">.</span><span class="s1">signal </span><span class="s3">&amp;&amp; </span><span class="s1">request</span><span class="s3">.</span><span class="s1">signal</span><span class="s3">.</span><span class="s1">aborted</span><span class="s3">) {</span>
      <span class="s2">return </span><span class="s1">reject</span><span class="s3">(</span><span class="s2">new </span><span class="s1">DOMException</span><span class="s3">(</span><span class="s4">'Aborted'</span><span class="s3">, </span><span class="s4">'AbortError'</span><span class="s3">))</span>
    <span class="s3">}</span>

    <span class="s2">var </span><span class="s1">xhr </span><span class="s3">= </span><span class="s2">new </span><span class="s1">XMLHttpRequest</span><span class="s3">()</span>

    <span class="s2">function </span><span class="s1">abortXhr</span><span class="s3">() {</span>
      <span class="s1">xhr</span><span class="s3">.</span><span class="s1">abort</span><span class="s3">()</span>
    <span class="s3">}</span>

    <span class="s1">xhr</span><span class="s3">.</span><span class="s1">onload </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
      <span class="s2">var </span><span class="s1">options </span><span class="s3">= {</span>
        <span class="s1">statusText</span><span class="s3">: </span><span class="s1">xhr</span><span class="s3">.</span><span class="s1">statusText</span><span class="s3">,</span>
        <span class="s1">headers</span><span class="s3">: </span><span class="s1">parseHeaders</span><span class="s3">(</span><span class="s1">xhr</span><span class="s3">.</span><span class="s1">getAllResponseHeaders</span><span class="s3">() || </span><span class="s4">''</span><span class="s3">)</span>
      <span class="s3">}</span>
      <span class="s0">// This check if specifically for when a user fetches a file locally from the file system</span>
      <span class="s0">// Only if the status is out of a normal range</span>
      <span class="s2">if </span><span class="s3">(</span><span class="s1">request</span><span class="s3">.</span><span class="s1">url</span><span class="s3">.</span><span class="s1">startsWith</span><span class="s3">(</span><span class="s4">'file://'</span><span class="s3">) &amp;&amp; (</span><span class="s1">xhr</span><span class="s3">.</span><span class="s1">status </span><span class="s3">&lt; </span><span class="s5">200 </span><span class="s3">|| </span><span class="s1">xhr</span><span class="s3">.</span><span class="s1">status </span><span class="s3">&gt; </span><span class="s5">599</span><span class="s3">)) {</span>
        <span class="s1">options</span><span class="s3">.</span><span class="s1">status </span><span class="s3">= </span><span class="s5">200</span><span class="s3">;</span>
      <span class="s3">} </span><span class="s2">else </span><span class="s3">{</span>
        <span class="s1">options</span><span class="s3">.</span><span class="s1">status </span><span class="s3">= </span><span class="s1">xhr</span><span class="s3">.</span><span class="s1">status</span><span class="s3">;</span>
      <span class="s3">}</span>
      <span class="s1">options</span><span class="s3">.</span><span class="s1">url </span><span class="s3">= </span><span class="s4">'responseURL' </span><span class="s2">in </span><span class="s1">xhr </span><span class="s3">? </span><span class="s1">xhr</span><span class="s3">.</span><span class="s1">responseURL </span><span class="s3">: </span><span class="s1">options</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">'X-Request-URL'</span><span class="s3">)</span>
      <span class="s2">var </span><span class="s1">body </span><span class="s3">= </span><span class="s4">'response' </span><span class="s2">in </span><span class="s1">xhr </span><span class="s3">? </span><span class="s1">xhr</span><span class="s3">.</span><span class="s1">response </span><span class="s3">: </span><span class="s1">xhr</span><span class="s3">.</span><span class="s1">responseText</span>
      <span class="s1">setTimeout</span><span class="s3">(</span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s1">resolve</span><span class="s3">(</span><span class="s2">new </span><span class="s1">Response</span><span class="s3">(</span><span class="s1">body</span><span class="s3">, </span><span class="s1">options</span><span class="s3">))</span>
      <span class="s3">}, </span><span class="s5">0</span><span class="s3">)</span>
    <span class="s3">}</span>

    <span class="s1">xhr</span><span class="s3">.</span><span class="s1">onerror </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
      <span class="s1">setTimeout</span><span class="s3">(</span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s1">reject</span><span class="s3">(</span><span class="s2">new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">'Network request failed'</span><span class="s3">))</span>
      <span class="s3">}, </span><span class="s5">0</span><span class="s3">)</span>
    <span class="s3">}</span>

    <span class="s1">xhr</span><span class="s3">.</span><span class="s1">ontimeout </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
      <span class="s1">setTimeout</span><span class="s3">(</span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s1">reject</span><span class="s3">(</span><span class="s2">new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">'Network request timed out'</span><span class="s3">))</span>
      <span class="s3">}, </span><span class="s5">0</span><span class="s3">)</span>
    <span class="s3">}</span>

    <span class="s1">xhr</span><span class="s3">.</span><span class="s1">onabort </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
      <span class="s1">setTimeout</span><span class="s3">(</span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s1">reject</span><span class="s3">(</span><span class="s2">new </span><span class="s1">DOMException</span><span class="s3">(</span><span class="s4">'Aborted'</span><span class="s3">, </span><span class="s4">'AbortError'</span><span class="s3">))</span>
      <span class="s3">}, </span><span class="s5">0</span><span class="s3">)</span>
    <span class="s3">}</span>

    <span class="s2">function </span><span class="s1">fixUrl</span><span class="s3">(</span><span class="s1">url</span><span class="s3">) {</span>
      <span class="s2">try </span><span class="s3">{</span>
        <span class="s2">return </span><span class="s1">url </span><span class="s3">=== </span><span class="s4">'' </span><span class="s3">&amp;&amp; </span><span class="s1">g</span><span class="s3">.</span><span class="s1">location</span><span class="s3">.</span><span class="s1">href </span><span class="s3">? </span><span class="s1">g</span><span class="s3">.</span><span class="s1">location</span><span class="s3">.</span><span class="s1">href </span><span class="s3">: </span><span class="s1">url</span>
      <span class="s3">} </span><span class="s2">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">url</span>
      <span class="s3">}</span>
    <span class="s3">}</span>

    <span class="s1">xhr</span><span class="s3">.</span><span class="s1">open</span><span class="s3">(</span><span class="s1">request</span><span class="s3">.</span><span class="s1">method</span><span class="s3">, </span><span class="s1">fixUrl</span><span class="s3">(</span><span class="s1">request</span><span class="s3">.</span><span class="s1">url</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s3">(</span><span class="s1">request</span><span class="s3">.</span><span class="s1">credentials </span><span class="s3">=== </span><span class="s4">'include'</span><span class="s3">) {</span>
      <span class="s1">xhr</span><span class="s3">.</span><span class="s1">withCredentials </span><span class="s3">= </span><span class="s2">true</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">request</span><span class="s3">.</span><span class="s1">credentials </span><span class="s3">=== </span><span class="s4">'omit'</span><span class="s3">) {</span>
      <span class="s1">xhr</span><span class="s3">.</span><span class="s1">withCredentials </span><span class="s3">= </span><span class="s2">false</span>
    <span class="s3">}</span>

    <span class="s2">if </span><span class="s3">(</span><span class="s4">'responseType' </span><span class="s2">in </span><span class="s1">xhr</span><span class="s3">) {</span>
      <span class="s2">if </span><span class="s3">(</span><span class="s1">support</span><span class="s3">.</span><span class="s1">blob</span><span class="s3">) {</span>
        <span class="s1">xhr</span><span class="s3">.</span><span class="s1">responseType </span><span class="s3">= </span><span class="s4">'blob'</span>
      <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span>
        <span class="s1">support</span><span class="s3">.</span><span class="s1">arrayBuffer</span>
      <span class="s3">) {</span>
        <span class="s1">xhr</span><span class="s3">.</span><span class="s1">responseType </span><span class="s3">= </span><span class="s4">'arraybuffer'</span>
      <span class="s3">}</span>
    <span class="s3">}</span>

    <span class="s2">if </span><span class="s3">(</span><span class="s1">init </span><span class="s3">&amp;&amp; </span><span class="s2">typeof </span><span class="s1">init</span><span class="s3">.</span><span class="s1">headers </span><span class="s3">=== </span><span class="s4">'object' </span><span class="s3">&amp;&amp; !(</span><span class="s1">init</span><span class="s3">.</span><span class="s1">headers </span><span class="s2">instanceof </span><span class="s1">Headers </span><span class="s3">|| (</span><span class="s1">g</span><span class="s3">.</span><span class="s1">Headers </span><span class="s3">&amp;&amp; </span><span class="s1">init</span><span class="s3">.</span><span class="s1">headers </span><span class="s2">instanceof </span><span class="s1">g</span><span class="s3">.</span><span class="s1">Headers</span><span class="s3">))) {</span>
      <span class="s2">var </span><span class="s1">names </span><span class="s3">= [];</span>
      <span class="s1">Object</span><span class="s3">.</span><span class="s1">getOwnPropertyNames</span><span class="s3">(</span><span class="s1">init</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">).</span><span class="s1">forEach</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">) {</span>
        <span class="s1">names</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">normalizeName</span><span class="s3">(</span><span class="s1">name</span><span class="s3">))</span>
        <span class="s1">xhr</span><span class="s3">.</span><span class="s1">setRequestHeader</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">normalizeValue</span><span class="s3">(</span><span class="s1">init</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">[</span><span class="s1">name</span><span class="s3">]))</span>
      <span class="s3">})</span>
      <span class="s1">request</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">name</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">names</span><span class="s3">.</span><span class="s1">indexOf</span><span class="s3">(</span><span class="s1">name</span><span class="s3">) === -</span><span class="s5">1</span><span class="s3">) {</span>
          <span class="s1">xhr</span><span class="s3">.</span><span class="s1">setRequestHeader</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">value</span><span class="s3">)</span>
        <span class="s3">}</span>
      <span class="s3">})</span>
    <span class="s3">} </span><span class="s2">else </span><span class="s3">{</span>
      <span class="s1">request</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">name</span><span class="s3">) {</span>
        <span class="s1">xhr</span><span class="s3">.</span><span class="s1">setRequestHeader</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">value</span><span class="s3">)</span>
      <span class="s3">})</span>
    <span class="s3">}</span>

    <span class="s2">if </span><span class="s3">(</span><span class="s1">request</span><span class="s3">.</span><span class="s1">signal</span><span class="s3">) {</span>
      <span class="s1">request</span><span class="s3">.</span><span class="s1">signal</span><span class="s3">.</span><span class="s1">addEventListener</span><span class="s3">(</span><span class="s4">'abort'</span><span class="s3">, </span><span class="s1">abortXhr</span><span class="s3">)</span>

      <span class="s1">xhr</span><span class="s3">.</span><span class="s1">onreadystatechange </span><span class="s3">= </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s0">// DONE (success or failure)</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">xhr</span><span class="s3">.</span><span class="s1">readyState </span><span class="s3">=== </span><span class="s5">4</span><span class="s3">) {</span>
          <span class="s1">request</span><span class="s3">.</span><span class="s1">signal</span><span class="s3">.</span><span class="s1">removeEventListener</span><span class="s3">(</span><span class="s4">'abort'</span><span class="s3">, </span><span class="s1">abortXhr</span><span class="s3">)</span>
        <span class="s3">}</span>
      <span class="s3">}</span>
    <span class="s3">}</span>

    <span class="s1">xhr</span><span class="s3">.</span><span class="s1">send</span><span class="s3">(</span><span class="s2">typeof </span><span class="s1">request</span><span class="s3">.</span><span class="s1">_bodyInit </span><span class="s3">=== </span><span class="s4">'undefined' </span><span class="s3">? </span><span class="s2">null </span><span class="s3">: </span><span class="s1">request</span><span class="s3">.</span><span class="s1">_bodyInit</span><span class="s3">)</span>
  <span class="s3">})</span>
<span class="s3">}</span>

<span class="s1">fetch</span><span class="s3">.</span><span class="s1">polyfill </span><span class="s3">= </span><span class="s2">true</span>

<span class="s2">if </span><span class="s3">(!</span><span class="s1">g</span><span class="s3">.</span><span class="s1">fetch</span><span class="s3">) {</span>
  <span class="s1">g</span><span class="s3">.</span><span class="s1">fetch </span><span class="s3">= </span><span class="s1">fetch</span>
  <span class="s1">g</span><span class="s3">.</span><span class="s1">Headers </span><span class="s3">= </span><span class="s1">Headers</span>
  <span class="s1">g</span><span class="s3">.</span><span class="s1">Request </span><span class="s3">= </span><span class="s1">Request</span>
  <span class="s1">g</span><span class="s3">.</span><span class="s1">Response </span><span class="s3">= </span><span class="s1">Response</span>
<span class="s3">}</span>
</pre>
</body>
</html>