<html>
<head>
<title>parser.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6aab73;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #5f826b; font-style: italic;}
.s7 { color: #67a37c; font-style: italic;}
.s8 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
parser.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>

<span class="s2">exports</span><span class="s1">.</span><span class="s2">__esModule </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
<span class="s2">exports</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">] = </span><span class="s3">void </span><span class="s4">0</span><span class="s1">;</span>
<span class="s3">var </span><span class="s2">_root </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./selectors/root&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_selector </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./selectors/selector&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_className </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./selectors/className&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_comment </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./selectors/comment&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_id </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./selectors/id&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_tag </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./selectors/tag&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_string </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./selectors/string&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_pseudo </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./selectors/pseudo&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_attribute </span><span class="s1">= </span><span class="s2">_interopRequireWildcard</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./selectors/attribute&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_universal </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./selectors/universal&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_combinator </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./selectors/combinator&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_nesting </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./selectors/nesting&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_sortAscending </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./sortAscending&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_tokenize </span><span class="s1">= </span><span class="s2">_interopRequireWildcard</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./tokenize&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">tokens </span><span class="s1">= </span><span class="s2">_interopRequireWildcard</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./tokenTypes&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">types </span><span class="s1">= </span><span class="s2">_interopRequireWildcard</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./selectors/types&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_util </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./util&quot;</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_WHITESPACE_TOKENS</span><span class="s1">, </span><span class="s2">_Object$assign</span><span class="s1">;</span>
<span class="s3">function </span><span class="s2">_getRequireWildcardCache</span><span class="s1">(</span><span class="s2">nodeInterop</span><span class="s1">) { </span><span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">WeakMap </span><span class="s1">!== </span><span class="s0">&quot;function&quot;</span><span class="s1">) </span><span class="s3">return null</span><span class="s1">; </span><span class="s3">var </span><span class="s2">cacheBabelInterop </span><span class="s1">= </span><span class="s3">new </span><span class="s2">WeakMap</span><span class="s1">(); </span><span class="s3">var </span><span class="s2">cacheNodeInterop </span><span class="s1">= </span><span class="s3">new </span><span class="s2">WeakMap</span><span class="s1">(); </span><span class="s3">return </span><span class="s1">(</span><span class="s2">_getRequireWildcardCache </span><span class="s1">= </span><span class="s3">function </span><span class="s2">_getRequireWildcardCache</span><span class="s1">(</span><span class="s2">nodeInterop</span><span class="s1">) { </span><span class="s3">return </span><span class="s2">nodeInterop </span><span class="s1">? </span><span class="s2">cacheNodeInterop </span><span class="s1">: </span><span class="s2">cacheBabelInterop</span><span class="s1">; })(</span><span class="s2">nodeInterop</span><span class="s1">); }</span>
<span class="s3">function </span><span class="s2">_interopRequireWildcard</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">nodeInterop</span><span class="s1">) { </span><span class="s3">if </span><span class="s1">(!</span><span class="s2">nodeInterop </span><span class="s1">&amp;&amp; </span><span class="s2">obj </span><span class="s1">&amp;&amp; </span><span class="s2">obj</span><span class="s1">.</span><span class="s2">__esModule</span><span class="s1">) { </span><span class="s3">return </span><span class="s2">obj</span><span class="s1">; } </span><span class="s3">if </span><span class="s1">(</span><span class="s2">obj </span><span class="s1">=== </span><span class="s3">null </span><span class="s1">|| </span><span class="s3">typeof </span><span class="s2">obj </span><span class="s1">!== </span><span class="s0">&quot;object&quot; </span><span class="s1">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">obj </span><span class="s1">!== </span><span class="s0">&quot;function&quot;</span><span class="s1">) { </span><span class="s3">return </span><span class="s1">{ </span><span class="s0">&quot;default&quot;</span><span class="s1">: </span><span class="s2">obj </span><span class="s1">}; } </span><span class="s3">var </span><span class="s2">cache </span><span class="s1">= </span><span class="s2">_getRequireWildcardCache</span><span class="s1">(</span><span class="s2">nodeInterop</span><span class="s1">); </span><span class="s3">if </span><span class="s1">(</span><span class="s2">cache </span><span class="s1">&amp;&amp; </span><span class="s2">cache</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">)) { </span><span class="s3">return </span><span class="s2">cache</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">); } </span><span class="s3">var </span><span class="s2">newObj </span><span class="s1">= {}; </span><span class="s3">var </span><span class="s2">hasPropertyDescriptor </span><span class="s1">= </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty </span><span class="s1">&amp;&amp; </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">getOwnPropertyDescriptor</span><span class="s1">; </span><span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s2">key </span><span class="s3">in </span><span class="s2">obj</span><span class="s1">) { </span><span class="s3">if </span><span class="s1">(</span><span class="s2">key </span><span class="s1">!== </span><span class="s0">&quot;default&quot; </span><span class="s1">&amp;&amp; </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">hasOwnProperty</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">key</span><span class="s1">)) { </span><span class="s3">var </span><span class="s2">desc </span><span class="s1">= </span><span class="s2">hasPropertyDescriptor </span><span class="s1">? </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">getOwnPropertyDescriptor</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">key</span><span class="s1">) : </span><span class="s3">null</span><span class="s1">; </span><span class="s3">if </span><span class="s1">(</span><span class="s2">desc </span><span class="s1">&amp;&amp; (</span><span class="s2">desc</span><span class="s1">.</span><span class="s2">get </span><span class="s1">|| </span><span class="s2">desc</span><span class="s1">.</span><span class="s2">set</span><span class="s1">)) { </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">newObj</span><span class="s1">, </span><span class="s2">key</span><span class="s1">, </span><span class="s2">desc</span><span class="s1">); } </span><span class="s3">else </span><span class="s1">{ </span><span class="s2">newObj</span><span class="s1">[</span><span class="s2">key</span><span class="s1">] = </span><span class="s2">obj</span><span class="s1">[</span><span class="s2">key</span><span class="s1">]; } } } </span><span class="s2">newObj</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">] = </span><span class="s2">obj</span><span class="s1">; </span><span class="s3">if </span><span class="s1">(</span><span class="s2">cache</span><span class="s1">) { </span><span class="s2">cache</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">newObj</span><span class="s1">); } </span><span class="s3">return </span><span class="s2">newObj</span><span class="s1">; }</span>
<span class="s3">function </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">) { </span><span class="s3">return </span><span class="s2">obj </span><span class="s1">&amp;&amp; </span><span class="s2">obj</span><span class="s1">.</span><span class="s2">__esModule </span><span class="s1">? </span><span class="s2">obj </span><span class="s1">: { </span><span class="s0">&quot;default&quot;</span><span class="s1">: </span><span class="s2">obj </span><span class="s1">}; }</span>
<span class="s3">function </span><span class="s2">_defineProperties</span><span class="s1">(</span><span class="s2">target</span><span class="s1">, </span><span class="s2">props</span><span class="s1">) { </span><span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s2">i </span><span class="s1">= </span><span class="s4">0</span><span class="s1">; </span><span class="s2">i </span><span class="s1">&lt; </span><span class="s2">props</span><span class="s1">.</span><span class="s2">length</span><span class="s1">; </span><span class="s2">i</span><span class="s1">++) { </span><span class="s3">var </span><span class="s2">descriptor </span><span class="s1">= </span><span class="s2">props</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]; </span><span class="s2">descriptor</span><span class="s1">.</span><span class="s2">enumerable </span><span class="s1">= </span><span class="s2">descriptor</span><span class="s1">.</span><span class="s2">enumerable </span><span class="s1">|| </span><span class="s3">false</span><span class="s1">; </span><span class="s2">descriptor</span><span class="s1">.</span><span class="s2">configurable </span><span class="s1">= </span><span class="s3">true</span><span class="s1">; </span><span class="s3">if </span><span class="s1">(</span><span class="s0">&quot;value&quot; </span><span class="s3">in </span><span class="s2">descriptor</span><span class="s1">) </span><span class="s2">descriptor</span><span class="s1">.</span><span class="s2">writable </span><span class="s1">= </span><span class="s3">true</span><span class="s1">; </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">target</span><span class="s1">, </span><span class="s2">descriptor</span><span class="s1">.</span><span class="s2">key</span><span class="s1">, </span><span class="s2">descriptor</span><span class="s1">); } }</span>
<span class="s3">function </span><span class="s2">_createClass</span><span class="s1">(</span><span class="s2">Constructor</span><span class="s1">, </span><span class="s2">protoProps</span><span class="s1">, </span><span class="s2">staticProps</span><span class="s1">) { </span><span class="s3">if </span><span class="s1">(</span><span class="s2">protoProps</span><span class="s1">) </span><span class="s2">_defineProperties</span><span class="s1">(</span><span class="s2">Constructor</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">, </span><span class="s2">protoProps</span><span class="s1">); </span><span class="s3">if </span><span class="s1">(</span><span class="s2">staticProps</span><span class="s1">) </span><span class="s2">_defineProperties</span><span class="s1">(</span><span class="s2">Constructor</span><span class="s1">, </span><span class="s2">staticProps</span><span class="s1">); </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">Constructor</span><span class="s1">, </span><span class="s0">&quot;prototype&quot;</span><span class="s1">, { </span><span class="s2">writable</span><span class="s1">: </span><span class="s3">false </span><span class="s1">}); </span><span class="s3">return </span><span class="s2">Constructor</span><span class="s1">; }</span>
<span class="s3">var </span><span class="s2">WHITESPACE_TOKENS </span><span class="s1">= (</span><span class="s2">_WHITESPACE_TOKENS </span><span class="s1">= {}, </span><span class="s2">_WHITESPACE_TOKENS</span><span class="s1">[</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">space</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_WHITESPACE_TOKENS</span><span class="s1">[</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">cr</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_WHITESPACE_TOKENS</span><span class="s1">[</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">feed</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_WHITESPACE_TOKENS</span><span class="s1">[</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">newline</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_WHITESPACE_TOKENS</span><span class="s1">[</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tab</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_WHITESPACE_TOKENS</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">WHITESPACE_EQUIV_TOKENS </span><span class="s1">= </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">assign</span><span class="s1">({}, </span><span class="s2">WHITESPACE_TOKENS</span><span class="s1">, (</span><span class="s2">_Object$assign </span><span class="s1">= {}, </span><span class="s2">_Object$assign</span><span class="s1">[</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">comment</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_Object$assign</span><span class="s1">));</span>
<span class="s3">function </span><span class="s2">tokenStart</span><span class="s1">(</span><span class="s2">token</span><span class="s1">) {</span>
  <span class="s3">return </span><span class="s1">{</span>
    <span class="s2">line</span><span class="s1">: </span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_LINE</span><span class="s1">],</span>
    <span class="s2">column</span><span class="s1">: </span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_COL</span><span class="s1">]</span>
  <span class="s1">};</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">tokenEnd</span><span class="s1">(</span><span class="s2">token</span><span class="s1">) {</span>
  <span class="s3">return </span><span class="s1">{</span>
    <span class="s2">line</span><span class="s1">: </span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">END_LINE</span><span class="s1">],</span>
    <span class="s2">column</span><span class="s1">: </span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">END_COL</span><span class="s1">]</span>
  <span class="s1">};</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">getSource</span><span class="s1">(</span><span class="s2">startLine</span><span class="s1">, </span><span class="s2">startColumn</span><span class="s1">, </span><span class="s2">endLine</span><span class="s1">, </span><span class="s2">endColumn</span><span class="s1">) {</span>
  <span class="s3">return </span><span class="s1">{</span>
    <span class="s2">start</span><span class="s1">: {</span>
      <span class="s2">line</span><span class="s1">: </span><span class="s2">startLine</span><span class="s1">,</span>
      <span class="s2">column</span><span class="s1">: </span><span class="s2">startColumn</span>
    <span class="s1">},</span>
    <span class="s2">end</span><span class="s1">: {</span>
      <span class="s2">line</span><span class="s1">: </span><span class="s2">endLine</span><span class="s1">,</span>
      <span class="s2">column</span><span class="s1">: </span><span class="s2">endColumn</span>
    <span class="s1">}</span>
  <span class="s1">};</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">getTokenSource</span><span class="s1">(</span><span class="s2">token</span><span class="s1">) {</span>
  <span class="s3">return </span><span class="s2">getSource</span><span class="s1">(</span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_LINE</span><span class="s1">], </span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_COL</span><span class="s1">], </span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">END_LINE</span><span class="s1">], </span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">END_COL</span><span class="s1">]);</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">getTokenSourceSpan</span><span class="s1">(</span><span class="s2">startToken</span><span class="s1">, </span><span class="s2">endToken</span><span class="s1">) {</span>
  <span class="s3">if </span><span class="s1">(!</span><span class="s2">startToken</span><span class="s1">) {</span>
    <span class="s3">return </span><span class="s2">undefined</span><span class="s1">;</span>
  <span class="s1">}</span>
  <span class="s3">return </span><span class="s2">getSource</span><span class="s1">(</span><span class="s2">startToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_LINE</span><span class="s1">], </span><span class="s2">startToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_COL</span><span class="s1">], </span><span class="s2">endToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">END_LINE</span><span class="s1">], </span><span class="s2">endToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">END_COL</span><span class="s1">]);</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">unescapeProp</span><span class="s1">(</span><span class="s2">node</span><span class="s1">, </span><span class="s2">prop</span><span class="s1">) {</span>
  <span class="s3">var </span><span class="s2">value </span><span class="s1">= </span><span class="s2">node</span><span class="s1">[</span><span class="s2">prop</span><span class="s1">];</span>
  <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">value </span><span class="s1">!== </span><span class="s0">&quot;string&quot;</span><span class="s1">) {</span>
    <span class="s3">return</span><span class="s1">;</span>
  <span class="s1">}</span>
  <span class="s3">if </span><span class="s1">(</span><span class="s2">value</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s0">&quot;</span><span class="s3">\\</span><span class="s0">&quot;</span><span class="s1">) !== -</span><span class="s4">1</span><span class="s1">) {</span>
    <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">ensureObject</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">);</span>
    <span class="s2">node</span><span class="s1">[</span><span class="s2">prop</span><span class="s1">] = (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">unesc</span><span class="s1">)(</span><span class="s2">value</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">[</span><span class="s2">prop</span><span class="s1">] === </span><span class="s2">undefined</span><span class="s1">) {</span>
      <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">[</span><span class="s2">prop</span><span class="s1">] = </span><span class="s2">value</span><span class="s1">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
  <span class="s3">return </span><span class="s2">node</span><span class="s1">;</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">indexesOf</span><span class="s1">(</span><span class="s2">array</span><span class="s1">, </span><span class="s2">item</span><span class="s1">) {</span>
  <span class="s3">var </span><span class="s2">i </span><span class="s1">= -</span><span class="s4">1</span><span class="s1">;</span>
  <span class="s3">var </span><span class="s2">indexes </span><span class="s1">= [];</span>
  <span class="s3">while </span><span class="s1">((</span><span class="s2">i </span><span class="s1">= </span><span class="s2">array</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">item</span><span class="s1">, </span><span class="s2">i </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">)) !== -</span><span class="s4">1</span><span class="s1">) {</span>
    <span class="s2">indexes</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span>
  <span class="s1">}</span>
  <span class="s3">return </span><span class="s2">indexes</span><span class="s1">;</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">uniqs</span><span class="s1">() {</span>
  <span class="s3">var </span><span class="s2">list </span><span class="s1">= </span><span class="s2">Array</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">.</span><span class="s2">apply</span><span class="s1">([], </span><span class="s2">arguments</span><span class="s1">);</span>
  <span class="s3">return </span><span class="s2">list</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">(</span><span class="s3">function </span><span class="s1">(</span><span class="s2">item</span><span class="s1">, </span><span class="s2">i</span><span class="s1">) {</span>
    <span class="s3">return </span><span class="s2">i </span><span class="s1">=== </span><span class="s2">list</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">item</span><span class="s1">);</span>
  <span class="s1">});</span>
<span class="s1">}</span>
<span class="s3">var </span><span class="s2">Parser </span><span class="s1">= </span><span class="s5">/*#__PURE__*/</span><span class="s3">function </span><span class="s1">() {</span>
  <span class="s3">function </span><span class="s2">Parser</span><span class="s1">(</span><span class="s2">rule</span><span class="s1">, </span><span class="s2">options</span><span class="s1">) {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">options </span><span class="s1">=== </span><span class="s3">void </span><span class="s4">0</span><span class="s1">) {</span>
      <span class="s2">options </span><span class="s1">= {};</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">rule </span><span class="s1">= </span><span class="s2">rule</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">options </span><span class="s1">= </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">assign</span><span class="s1">({</span>
      <span class="s2">lossy</span><span class="s1">: </span><span class="s3">false</span><span class="s1">,</span>
      <span class="s2">safe</span><span class="s1">: </span><span class="s3">false</span>
    <span class="s1">}, </span><span class="s2">options</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">= </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">css </span><span class="s1">= </span><span class="s3">typeof this</span><span class="s1">.</span><span class="s2">rule </span><span class="s1">=== </span><span class="s0">'string' </span><span class="s1">? </span><span class="s3">this</span><span class="s1">.</span><span class="s2">rule </span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">selector</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_tokenize</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">])({</span>
      <span class="s2">css</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">css</span><span class="s1">,</span>
      <span class="s2">error</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">_errorGenerator</span><span class="s1">(),</span>
      <span class="s2">safe</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">safe</span>
    <span class="s1">});</span>
    <span class="s3">var </span><span class="s2">rootSource </span><span class="s1">= </span><span class="s2">getTokenSourceSpan</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s4">0</span><span class="s1">], </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">length </span><span class="s1">- </span><span class="s4">1</span><span class="s1">]);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">root </span><span class="s1">= </span><span class="s3">new </span><span class="s2">_root</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
      <span class="s2">source</span><span class="s1">: </span><span class="s2">rootSource</span>
    <span class="s1">});</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">root</span><span class="s1">.</span><span class="s2">errorGenerator </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">_errorGenerator</span><span class="s1">();</span>
    <span class="s3">var </span><span class="s2">selector </span><span class="s1">= </span><span class="s3">new </span><span class="s2">_selector</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
      <span class="s2">source</span><span class="s1">: {</span>
        <span class="s2">start</span><span class="s1">: {</span>
          <span class="s2">line</span><span class="s1">: </span><span class="s4">1</span><span class="s1">,</span>
          <span class="s2">column</span><span class="s1">: </span><span class="s4">1</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">});</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">root</span><span class="s1">.</span><span class="s2">append</span><span class="s1">(</span><span class="s2">selector</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">current </span><span class="s1">= </span><span class="s2">selector</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">loop</span><span class="s1">();</span>
  <span class="s1">}</span>
  <span class="s3">var </span><span class="s2">_proto </span><span class="s1">= </span><span class="s2">Parser</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">;</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">_errorGenerator </span><span class="s1">= </span><span class="s3">function </span><span class="s2">_errorGenerator</span><span class="s1">() {</span>
    <span class="s3">var </span><span class="s2">_this </span><span class="s1">= </span><span class="s3">this</span><span class="s1">;</span>
    <span class="s3">return function </span><span class="s1">(</span><span class="s2">message</span><span class="s1">, </span><span class="s2">errorOptions</span><span class="s1">) {</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">_this</span><span class="s1">.</span><span class="s2">rule </span><span class="s1">=== </span><span class="s0">'string'</span><span class="s1">) {</span>
        <span class="s3">return new </span><span class="s2">Error</span><span class="s1">(</span><span class="s2">message</span><span class="s1">);</span>
      <span class="s1">}</span>
      <span class="s3">return </span><span class="s2">_this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">error</span><span class="s1">(</span><span class="s2">message</span><span class="s1">, </span><span class="s2">errorOptions</span><span class="s1">);</span>
    <span class="s1">};</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">attribute </span><span class="s1">= </span><span class="s3">function </span><span class="s2">attribute</span><span class="s1">() {</span>
    <span class="s3">var </span><span class="s2">attr </span><span class="s1">= [];</span>
    <span class="s3">var </span><span class="s2">startingToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
    <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">&lt; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] !== </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">closeSquare</span><span class="s1">) {</span>
      <span class="s2">attr</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">);</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] !== </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">closeSquare</span><span class="s1">) {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">expected</span><span class="s1">(</span><span class="s0">'closing square bracket'</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]);</span>
    <span class="s1">}</span>
    <span class="s3">var </span><span class="s2">len </span><span class="s1">= </span><span class="s2">attr</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">node </span><span class="s1">= {</span>
      <span class="s2">source</span><span class="s1">: </span><span class="s2">getSource</span><span class="s1">(</span><span class="s2">startingToken</span><span class="s1">[</span><span class="s4">1</span><span class="s1">], </span><span class="s2">startingToken</span><span class="s1">[</span><span class="s4">2</span><span class="s1">], </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s4">3</span><span class="s1">], </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s4">4</span><span class="s1">]),</span>
      <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s2">startingToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]</span>
    <span class="s1">};</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">len </span><span class="s1">=== </span><span class="s4">1 </span><span class="s1">&amp;&amp; !~[</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">word</span><span class="s1">].</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">attr</span><span class="s1">[</span><span class="s4">0</span><span class="s1">][</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">])) {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">expected</span><span class="s1">(</span><span class="s0">'attribute'</span><span class="s1">, </span><span class="s2">attr</span><span class="s1">[</span><span class="s4">0</span><span class="s1">][</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]);</span>
    <span class="s1">}</span>
    <span class="s3">var </span><span class="s2">pos </span><span class="s1">= </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">spaceBefore </span><span class="s1">= </span><span class="s0">''</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">commentBefore </span><span class="s1">= </span><span class="s0">''</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">lastAdded </span><span class="s1">= </span><span class="s3">null</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">spaceAfterMeaningfulToken </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
    <span class="s3">while </span><span class="s1">(</span><span class="s2">pos </span><span class="s1">&lt; </span><span class="s2">len</span><span class="s1">) {</span>
      <span class="s3">var </span><span class="s2">token </span><span class="s1">= </span><span class="s2">attr</span><span class="s1">[</span><span class="s2">pos</span><span class="s1">];</span>
      <span class="s3">var </span><span class="s2">content </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(</span><span class="s2">token</span><span class="s1">);</span>
      <span class="s3">var </span><span class="s2">next </span><span class="s1">= </span><span class="s2">attr</span><span class="s1">[</span><span class="s2">pos </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">];</span>
      <span class="s3">switch </span><span class="s1">(</span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">]) {</span>
        <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">space</span><span class="s1">:</span>
          <span class="s5">// if (</span>
          <span class="s5">//     len === 1 ||</span>
          <span class="s5">//     pos === 0 &amp;&amp; this.content(next) === '|'</span>
          <span class="s5">// ) {</span>
          <span class="s5">//     return this.expected('attribute', token[TOKEN.START_POS], content);</span>
          <span class="s5">// }</span>
          <span class="s2">spaceAfterMeaningfulToken </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">lossy</span><span class="s1">) {</span>
            <span class="s3">break</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">lastAdded</span><span class="s1">) {</span>
            <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">ensureObject</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'spaces'</span><span class="s1">, </span><span class="s2">lastAdded</span><span class="s1">);</span>
            <span class="s3">var </span><span class="s2">prevContent </span><span class="s1">= </span><span class="s2">node</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">[</span><span class="s2">lastAdded</span><span class="s1">].</span><span class="s2">after </span><span class="s1">|| </span><span class="s0">''</span><span class="s1">;</span>
            <span class="s2">node</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">[</span><span class="s2">lastAdded</span><span class="s1">].</span><span class="s2">after </span><span class="s1">= </span><span class="s2">prevContent </span><span class="s1">+ </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s3">var </span><span class="s2">existingComment </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">getProp</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">, </span><span class="s0">'spaces'</span><span class="s1">, </span><span class="s2">lastAdded</span><span class="s1">, </span><span class="s0">'after'</span><span class="s1">) || </span><span class="s3">null</span><span class="s1">;</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">existingComment</span><span class="s1">) {</span>
              <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">[</span><span class="s2">lastAdded</span><span class="s1">].</span><span class="s2">after </span><span class="s1">= </span><span class="s2">existingComment </span><span class="s1">+ </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s1">}</span>
          <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
            <span class="s2">spaceBefore </span><span class="s1">= </span><span class="s2">spaceBefore </span><span class="s1">+ </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s2">commentBefore </span><span class="s1">= </span><span class="s2">commentBefore </span><span class="s1">+ </span><span class="s2">content</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s3">break</span><span class="s1">;</span>
        <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">asterisk</span><span class="s1">:</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">next</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">equals</span><span class="s1">) {</span>
            <span class="s2">node</span><span class="s1">.</span><span class="s2">operator </span><span class="s1">= </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s2">lastAdded </span><span class="s1">= </span><span class="s0">'operator'</span><span class="s1">;</span>
          <span class="s1">} </span><span class="s3">else if </span><span class="s1">((!</span><span class="s2">node</span><span class="s1">.</span><span class="s2">namespace </span><span class="s1">|| </span><span class="s2">lastAdded </span><span class="s1">=== </span><span class="s0">&quot;namespace&quot; </span><span class="s1">&amp;&amp; !</span><span class="s2">spaceAfterMeaningfulToken</span><span class="s1">) &amp;&amp; </span><span class="s2">next</span><span class="s1">) {</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">spaceBefore</span><span class="s1">) {</span>
              <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">ensureObject</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'spaces'</span><span class="s1">, </span><span class="s0">'attribute'</span><span class="s1">);</span>
              <span class="s2">node</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">attribute</span><span class="s1">.</span><span class="s2">before </span><span class="s1">= </span><span class="s2">spaceBefore</span><span class="s1">;</span>
              <span class="s2">spaceBefore </span><span class="s1">= </span><span class="s0">''</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">commentBefore</span><span class="s1">) {</span>
              <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">ensureObject</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">, </span><span class="s0">'spaces'</span><span class="s1">, </span><span class="s0">'attribute'</span><span class="s1">);</span>
              <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">attribute</span><span class="s1">.</span><span class="s2">before </span><span class="s1">= </span><span class="s2">spaceBefore</span><span class="s1">;</span>
              <span class="s2">commentBefore </span><span class="s1">= </span><span class="s0">''</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s2">node</span><span class="s1">.</span><span class="s2">namespace </span><span class="s1">= (</span><span class="s2">node</span><span class="s1">.</span><span class="s2">namespace </span><span class="s1">|| </span><span class="s0">&quot;&quot;</span><span class="s1">) + </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s3">var </span><span class="s2">rawValue </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">getProp</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">, </span><span class="s0">'namespace'</span><span class="s1">) || </span><span class="s3">null</span><span class="s1">;</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">rawValue</span><span class="s1">) {</span>
              <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">.</span><span class="s2">namespace </span><span class="s1">+= </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s2">lastAdded </span><span class="s1">= </span><span class="s0">'namespace'</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s2">spaceAfterMeaningfulToken </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
          <span class="s3">break</span><span class="s1">;</span>
        <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">dollar</span><span class="s1">:</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">lastAdded </span><span class="s1">=== </span><span class="s0">&quot;value&quot;</span><span class="s1">) {</span>
            <span class="s3">var </span><span class="s2">oldRawValue </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">getProp</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">, </span><span class="s0">'value'</span><span class="s1">);</span>
            <span class="s2">node</span><span class="s1">.</span><span class="s2">value </span><span class="s1">+= </span><span class="s0">&quot;$&quot;</span><span class="s1">;</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">oldRawValue</span><span class="s1">) {</span>
              <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">.</span><span class="s2">value </span><span class="s1">= </span><span class="s2">oldRawValue </span><span class="s1">+ </span><span class="s0">&quot;$&quot;</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s3">break</span><span class="s1">;</span>
          <span class="s1">}</span>
        <span class="s5">// Falls through</span>
        <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">caret</span><span class="s1">:</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">next</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">equals</span><span class="s1">) {</span>
            <span class="s2">node</span><span class="s1">.</span><span class="s2">operator </span><span class="s1">= </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s2">lastAdded </span><span class="s1">= </span><span class="s0">'operator'</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s2">spaceAfterMeaningfulToken </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
          <span class="s3">break</span><span class="s1">;</span>
        <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">combinator</span><span class="s1">:</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">content </span><span class="s1">=== </span><span class="s0">'~' </span><span class="s1">&amp;&amp; </span><span class="s2">next</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">equals</span><span class="s1">) {</span>
            <span class="s2">node</span><span class="s1">.</span><span class="s2">operator </span><span class="s1">= </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s2">lastAdded </span><span class="s1">= </span><span class="s0">'operator'</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">content </span><span class="s1">!== </span><span class="s0">'|'</span><span class="s1">) {</span>
            <span class="s2">spaceAfterMeaningfulToken </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
            <span class="s3">break</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">next</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">equals</span><span class="s1">) {</span>
            <span class="s2">node</span><span class="s1">.</span><span class="s2">operator </span><span class="s1">= </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s2">lastAdded </span><span class="s1">= </span><span class="s0">'operator'</span><span class="s1">;</span>
          <span class="s1">} </span><span class="s3">else if </span><span class="s1">(!</span><span class="s2">node</span><span class="s1">.</span><span class="s2">namespace </span><span class="s1">&amp;&amp; !</span><span class="s2">node</span><span class="s1">.</span><span class="s2">attribute</span><span class="s1">) {</span>
            <span class="s2">node</span><span class="s1">.</span><span class="s2">namespace </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s2">spaceAfterMeaningfulToken </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
          <span class="s3">break</span><span class="s1">;</span>
        <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">word</span><span class="s1">:</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">next </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(</span><span class="s2">next</span><span class="s1">) === </span><span class="s0">'|' </span><span class="s1">&amp;&amp; </span><span class="s2">attr</span><span class="s1">[</span><span class="s2">pos </span><span class="s1">+ </span><span class="s4">2</span><span class="s1">] &amp;&amp; </span><span class="s2">attr</span><span class="s1">[</span><span class="s2">pos </span><span class="s1">+ </span><span class="s4">2</span><span class="s1">][</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] !== </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">equals </span><span class="s1">&amp;&amp;</span>
          <span class="s5">// this look-ahead probably fails with comment nodes involved.</span>
          <span class="s1">!</span><span class="s2">node</span><span class="s1">.</span><span class="s2">operator </span><span class="s1">&amp;&amp; !</span><span class="s2">node</span><span class="s1">.</span><span class="s2">namespace</span><span class="s1">) {</span>
            <span class="s2">node</span><span class="s1">.</span><span class="s2">namespace </span><span class="s1">= </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s2">lastAdded </span><span class="s1">= </span><span class="s0">'namespace'</span><span class="s1">;</span>
          <span class="s1">} </span><span class="s3">else if </span><span class="s1">(!</span><span class="s2">node</span><span class="s1">.</span><span class="s2">attribute </span><span class="s1">|| </span><span class="s2">lastAdded </span><span class="s1">=== </span><span class="s0">&quot;attribute&quot; </span><span class="s1">&amp;&amp; !</span><span class="s2">spaceAfterMeaningfulToken</span><span class="s1">) {</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">spaceBefore</span><span class="s1">) {</span>
              <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">ensureObject</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'spaces'</span><span class="s1">, </span><span class="s0">'attribute'</span><span class="s1">);</span>
              <span class="s2">node</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">attribute</span><span class="s1">.</span><span class="s2">before </span><span class="s1">= </span><span class="s2">spaceBefore</span><span class="s1">;</span>
              <span class="s2">spaceBefore </span><span class="s1">= </span><span class="s0">''</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">commentBefore</span><span class="s1">) {</span>
              <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">ensureObject</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">, </span><span class="s0">'spaces'</span><span class="s1">, </span><span class="s0">'attribute'</span><span class="s1">);</span>
              <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">attribute</span><span class="s1">.</span><span class="s2">before </span><span class="s1">= </span><span class="s2">commentBefore</span><span class="s1">;</span>
              <span class="s2">commentBefore </span><span class="s1">= </span><span class="s0">''</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s2">node</span><span class="s1">.</span><span class="s2">attribute </span><span class="s1">= (</span><span class="s2">node</span><span class="s1">.</span><span class="s2">attribute </span><span class="s1">|| </span><span class="s0">&quot;&quot;</span><span class="s1">) + </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s3">var </span><span class="s2">_rawValue </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">getProp</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">, </span><span class="s0">'attribute'</span><span class="s1">) || </span><span class="s3">null</span><span class="s1">;</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">_rawValue</span><span class="s1">) {</span>
              <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">.</span><span class="s2">attribute </span><span class="s1">+= </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s2">lastAdded </span><span class="s1">= </span><span class="s0">'attribute'</span><span class="s1">;</span>
          <span class="s1">} </span><span class="s3">else if </span><span class="s1">(!</span><span class="s2">node</span><span class="s1">.</span><span class="s2">value </span><span class="s1">&amp;&amp; </span><span class="s2">node</span><span class="s1">.</span><span class="s2">value </span><span class="s1">!== </span><span class="s0">&quot;&quot; </span><span class="s1">|| </span><span class="s2">lastAdded </span><span class="s1">=== </span><span class="s0">&quot;value&quot; </span><span class="s1">&amp;&amp; !(</span><span class="s2">spaceAfterMeaningfulToken </span><span class="s1">|| </span><span class="s2">node</span><span class="s1">.</span><span class="s2">quoteMark</span><span class="s1">)) {</span>
            <span class="s3">var </span><span class="s2">_unescaped </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">unesc</span><span class="s1">)(</span><span class="s2">content</span><span class="s1">);</span>
            <span class="s3">var </span><span class="s2">_oldRawValue </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">getProp</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">, </span><span class="s0">'value'</span><span class="s1">) || </span><span class="s0">''</span><span class="s1">;</span>
            <span class="s3">var </span><span class="s2">oldValue </span><span class="s1">= </span><span class="s2">node</span><span class="s1">.</span><span class="s2">value </span><span class="s1">|| </span><span class="s0">''</span><span class="s1">;</span>
            <span class="s2">node</span><span class="s1">.</span><span class="s2">value </span><span class="s1">= </span><span class="s2">oldValue </span><span class="s1">+ </span><span class="s2">_unescaped</span><span class="s1">;</span>
            <span class="s2">node</span><span class="s1">.</span><span class="s2">quoteMark </span><span class="s1">= </span><span class="s3">null</span><span class="s1">;</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">_unescaped </span><span class="s1">!== </span><span class="s2">content </span><span class="s1">|| </span><span class="s2">_oldRawValue</span><span class="s1">) {</span>
              <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">ensureObject</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">);</span>
              <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">.</span><span class="s2">value </span><span class="s1">= (</span><span class="s2">_oldRawValue </span><span class="s1">|| </span><span class="s2">oldValue</span><span class="s1">) + </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s2">lastAdded </span><span class="s1">= </span><span class="s0">'value'</span><span class="s1">;</span>
          <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
            <span class="s3">var </span><span class="s2">insensitive </span><span class="s1">= </span><span class="s2">content </span><span class="s1">=== </span><span class="s0">'i' </span><span class="s1">|| </span><span class="s2">content </span><span class="s1">=== </span><span class="s0">&quot;I&quot;</span><span class="s1">;</span>
            <span class="s3">if </span><span class="s1">((</span><span class="s2">node</span><span class="s1">.</span><span class="s2">value </span><span class="s1">|| </span><span class="s2">node</span><span class="s1">.</span><span class="s2">value </span><span class="s1">=== </span><span class="s0">''</span><span class="s1">) &amp;&amp; (</span><span class="s2">node</span><span class="s1">.</span><span class="s2">quoteMark </span><span class="s1">|| </span><span class="s2">spaceAfterMeaningfulToken</span><span class="s1">)) {</span>
              <span class="s2">node</span><span class="s1">.</span><span class="s2">insensitive </span><span class="s1">= </span><span class="s2">insensitive</span><span class="s1">;</span>
              <span class="s3">if </span><span class="s1">(!</span><span class="s2">insensitive </span><span class="s1">|| </span><span class="s2">content </span><span class="s1">=== </span><span class="s0">&quot;I&quot;</span><span class="s1">) {</span>
                <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">ensureObject</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">);</span>
                <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">.</span><span class="s2">insensitiveFlag </span><span class="s1">= </span><span class="s2">content</span><span class="s1">;</span>
              <span class="s1">}</span>
              <span class="s2">lastAdded </span><span class="s1">= </span><span class="s0">'insensitive'</span><span class="s1">;</span>
              <span class="s3">if </span><span class="s1">(</span><span class="s2">spaceBefore</span><span class="s1">) {</span>
                <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">ensureObject</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'spaces'</span><span class="s1">, </span><span class="s0">'insensitive'</span><span class="s1">);</span>
                <span class="s2">node</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">insensitive</span><span class="s1">.</span><span class="s2">before </span><span class="s1">= </span><span class="s2">spaceBefore</span><span class="s1">;</span>
                <span class="s2">spaceBefore </span><span class="s1">= </span><span class="s0">''</span><span class="s1">;</span>
              <span class="s1">}</span>
              <span class="s3">if </span><span class="s1">(</span><span class="s2">commentBefore</span><span class="s1">) {</span>
                <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">ensureObject</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">, </span><span class="s0">'spaces'</span><span class="s1">, </span><span class="s0">'insensitive'</span><span class="s1">);</span>
                <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">insensitive</span><span class="s1">.</span><span class="s2">before </span><span class="s1">= </span><span class="s2">commentBefore</span><span class="s1">;</span>
                <span class="s2">commentBefore </span><span class="s1">= </span><span class="s0">''</span><span class="s1">;</span>
              <span class="s1">}</span>
            <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s2">node</span><span class="s1">.</span><span class="s2">value </span><span class="s1">|| </span><span class="s2">node</span><span class="s1">.</span><span class="s2">value </span><span class="s1">=== </span><span class="s0">''</span><span class="s1">) {</span>
              <span class="s2">lastAdded </span><span class="s1">= </span><span class="s0">'value'</span><span class="s1">;</span>
              <span class="s2">node</span><span class="s1">.</span><span class="s2">value </span><span class="s1">+= </span><span class="s2">content</span><span class="s1">;</span>
              <span class="s3">if </span><span class="s1">(</span><span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">.</span><span class="s2">value</span><span class="s1">) {</span>
                <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">.</span><span class="s2">value </span><span class="s1">+= </span><span class="s2">content</span><span class="s1">;</span>
              <span class="s1">}</span>
            <span class="s1">}</span>
          <span class="s1">}</span>
          <span class="s2">spaceAfterMeaningfulToken </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
          <span class="s3">break</span><span class="s1">;</span>
        <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">str</span><span class="s1">:</span>
          <span class="s3">if </span><span class="s1">(!</span><span class="s2">node</span><span class="s1">.</span><span class="s2">attribute </span><span class="s1">|| !</span><span class="s2">node</span><span class="s1">.</span><span class="s2">operator</span><span class="s1">) {</span>
            <span class="s3">return this</span><span class="s1">.</span><span class="s2">error</span><span class="s1">(</span><span class="s0">&quot;Expected an attribute followed by an operator preceding the string.&quot;</span><span class="s1">, {</span>
              <span class="s2">index</span><span class="s1">: </span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]</span>
            <span class="s1">});</span>
          <span class="s1">}</span>
          <span class="s3">var </span><span class="s2">_unescapeValue </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_attribute</span><span class="s1">.</span><span class="s2">unescapeValue</span><span class="s1">)(</span><span class="s2">content</span><span class="s1">),</span>
            <span class="s2">unescaped </span><span class="s1">= </span><span class="s2">_unescapeValue</span><span class="s1">.</span><span class="s2">unescaped</span><span class="s1">,</span>
            <span class="s2">quoteMark </span><span class="s1">= </span><span class="s2">_unescapeValue</span><span class="s1">.</span><span class="s2">quoteMark</span><span class="s1">;</span>
          <span class="s2">node</span><span class="s1">.</span><span class="s2">value </span><span class="s1">= </span><span class="s2">unescaped</span><span class="s1">;</span>
          <span class="s2">node</span><span class="s1">.</span><span class="s2">quoteMark </span><span class="s1">= </span><span class="s2">quoteMark</span><span class="s1">;</span>
          <span class="s2">lastAdded </span><span class="s1">= </span><span class="s0">'value'</span><span class="s1">;</span>
          <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">ensureObject</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">);</span>
          <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">.</span><span class="s2">value </span><span class="s1">= </span><span class="s2">content</span><span class="s1">;</span>
          <span class="s2">spaceAfterMeaningfulToken </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
          <span class="s3">break</span><span class="s1">;</span>
        <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">equals</span><span class="s1">:</span>
          <span class="s3">if </span><span class="s1">(!</span><span class="s2">node</span><span class="s1">.</span><span class="s2">attribute</span><span class="s1">) {</span>
            <span class="s3">return this</span><span class="s1">.</span><span class="s2">expected</span><span class="s1">(</span><span class="s0">'attribute'</span><span class="s1">, </span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">], </span><span class="s2">content</span><span class="s1">);</span>
          <span class="s1">}</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">node</span><span class="s1">.</span><span class="s2">value</span><span class="s1">) {</span>
            <span class="s3">return this</span><span class="s1">.</span><span class="s2">error</span><span class="s1">(</span><span class="s0">'Unexpected &quot;=&quot; found; an operator was already defined.'</span><span class="s1">, {</span>
              <span class="s2">index</span><span class="s1">: </span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]</span>
            <span class="s1">});</span>
          <span class="s1">}</span>
          <span class="s2">node</span><span class="s1">.</span><span class="s2">operator </span><span class="s1">= </span><span class="s2">node</span><span class="s1">.</span><span class="s2">operator </span><span class="s1">? </span><span class="s2">node</span><span class="s1">.</span><span class="s2">operator </span><span class="s1">+ </span><span class="s2">content </span><span class="s1">: </span><span class="s2">content</span><span class="s1">;</span>
          <span class="s2">lastAdded </span><span class="s1">= </span><span class="s0">'operator'</span><span class="s1">;</span>
          <span class="s2">spaceAfterMeaningfulToken </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
          <span class="s3">break</span><span class="s1">;</span>
        <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">comment</span><span class="s1">:</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">lastAdded</span><span class="s1">) {</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">spaceAfterMeaningfulToken </span><span class="s1">|| </span><span class="s2">next </span><span class="s1">&amp;&amp; </span><span class="s2">next</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">space </span><span class="s1">|| </span><span class="s2">lastAdded </span><span class="s1">=== </span><span class="s0">'insensitive'</span><span class="s1">) {</span>
              <span class="s3">var </span><span class="s2">lastComment </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">getProp</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'spaces'</span><span class="s1">, </span><span class="s2">lastAdded</span><span class="s1">, </span><span class="s0">'after'</span><span class="s1">) || </span><span class="s0">''</span><span class="s1">;</span>
              <span class="s3">var </span><span class="s2">rawLastComment </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">getProp</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">, </span><span class="s0">'spaces'</span><span class="s1">, </span><span class="s2">lastAdded</span><span class="s1">, </span><span class="s0">'after'</span><span class="s1">) || </span><span class="s2">lastComment</span><span class="s1">;</span>
              <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">ensureObject</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">, </span><span class="s0">'spaces'</span><span class="s1">, </span><span class="s2">lastAdded</span><span class="s1">);</span>
              <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">[</span><span class="s2">lastAdded</span><span class="s1">].</span><span class="s2">after </span><span class="s1">= </span><span class="s2">rawLastComment </span><span class="s1">+ </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
              <span class="s3">var </span><span class="s2">lastValue </span><span class="s1">= </span><span class="s2">node</span><span class="s1">[</span><span class="s2">lastAdded</span><span class="s1">] || </span><span class="s0">''</span><span class="s1">;</span>
              <span class="s3">var </span><span class="s2">rawLastValue </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">getProp</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">, </span><span class="s2">lastAdded</span><span class="s1">) || </span><span class="s2">lastValue</span><span class="s1">;</span>
              <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">ensureObject</span><span class="s1">)(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">'raws'</span><span class="s1">);</span>
              <span class="s2">node</span><span class="s1">.</span><span class="s2">raws</span><span class="s1">[</span><span class="s2">lastAdded</span><span class="s1">] = </span><span class="s2">rawLastValue </span><span class="s1">+ </span><span class="s2">content</span><span class="s1">;</span>
            <span class="s1">}</span>
          <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
            <span class="s2">commentBefore </span><span class="s1">= </span><span class="s2">commentBefore </span><span class="s1">+ </span><span class="s2">content</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s3">break</span><span class="s1">;</span>
        <span class="s3">default</span><span class="s1">:</span>
          <span class="s3">return this</span><span class="s1">.</span><span class="s2">error</span><span class="s1">(</span><span class="s0">&quot;Unexpected </span><span class="s3">\&quot;</span><span class="s0">&quot; </span><span class="s1">+ </span><span class="s2">content </span><span class="s1">+ </span><span class="s0">&quot;</span><span class="s3">\&quot; </span><span class="s0">found.&quot;</span><span class="s1">, {</span>
            <span class="s2">index</span><span class="s1">: </span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]</span>
          <span class="s1">});</span>
      <span class="s1">}</span>
      <span class="s2">pos</span><span class="s1">++;</span>
    <span class="s1">}</span>
    <span class="s2">unescapeProp</span><span class="s1">(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">&quot;attribute&quot;</span><span class="s1">);</span>
    <span class="s2">unescapeProp</span><span class="s1">(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">&quot;namespace&quot;</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">newNode</span><span class="s1">(</span><span class="s3">new </span><span class="s2">_attribute</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">](</span><span class="s2">node</span><span class="s1">));</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
  <span class="s1">}</span>

  <span class="s6">/**</span>
   <span class="s6">* return a node containing meaningless garbage up to (but not including) the specified token position.</span>
   <span class="s6">* if the token position is negative, all remaining tokens are consumed.</span>
   <span class="s6">*</span>
   <span class="s6">* This returns an array containing a single string node if all whitespace,</span>
   <span class="s6">* otherwise an array of comment nodes with space before and after.</span>
   <span class="s6">*</span>
   <span class="s6">* These tokens are not added to the current selector, the caller can add them or use them to amend</span>
   <span class="s6">* a previous node's space metadata.</span>
   <span class="s6">*</span>
   <span class="s6">* In lossy mode, this returns only comments.</span>
   <span class="s6">*/</span><span class="s1">;</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">parseWhitespaceEquivalentTokens </span><span class="s1">= </span><span class="s3">function </span><span class="s2">parseWhitespaceEquivalentTokens</span><span class="s1">(</span><span class="s2">stopPosition</span><span class="s1">) {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">stopPosition </span><span class="s1">&lt; </span><span class="s4">0</span><span class="s1">) {</span>
      <span class="s2">stopPosition </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">var </span><span class="s2">startPosition </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">nodes </span><span class="s1">= [];</span>
    <span class="s3">var </span><span class="s2">space </span><span class="s1">= </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">lastComment </span><span class="s1">= </span><span class="s2">undefined</span><span class="s1">;</span>
    <span class="s3">do </span><span class="s1">{</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">WHITESPACE_TOKENS</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">]]) {</span>
        <span class="s3">if </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">lossy</span><span class="s1">) {</span>
          <span class="s2">space </span><span class="s1">+= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">();</span>
        <span class="s1">}</span>
      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">comment</span><span class="s1">) {</span>
        <span class="s3">var </span><span class="s2">spaces </span><span class="s1">= {};</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">space</span><span class="s1">) {</span>
          <span class="s2">spaces</span><span class="s1">.</span><span class="s2">before </span><span class="s1">= </span><span class="s2">space</span><span class="s1">;</span>
          <span class="s2">space </span><span class="s1">= </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">lastComment </span><span class="s1">= </span><span class="s3">new </span><span class="s2">_comment</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
          <span class="s2">value</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(),</span>
          <span class="s2">source</span><span class="s1">: </span><span class="s2">getTokenSource</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">),</span>
          <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">],</span>
          <span class="s2">spaces</span><span class="s1">: </span><span class="s2">spaces</span>
        <span class="s1">});</span>
        <span class="s2">nodes</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">lastComment</span><span class="s1">);</span>
      <span class="s1">}</span>
    <span class="s1">} </span><span class="s3">while </span><span class="s1">(++</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">&lt; </span><span class="s2">stopPosition</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">space</span><span class="s1">) {</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">lastComment</span><span class="s1">) {</span>
        <span class="s2">lastComment</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">after </span><span class="s1">= </span><span class="s2">space</span><span class="s1">;</span>
      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">lossy</span><span class="s1">) {</span>
        <span class="s3">var </span><span class="s2">firstToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">startPosition</span><span class="s1">];</span>
        <span class="s3">var </span><span class="s2">lastToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">- </span><span class="s4">1</span><span class="s1">];</span>
        <span class="s2">nodes</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s3">new </span><span class="s2">_string</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
          <span class="s2">value</span><span class="s1">: </span><span class="s0">''</span><span class="s1">,</span>
          <span class="s2">source</span><span class="s1">: </span><span class="s2">getSource</span><span class="s1">(</span><span class="s2">firstToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_LINE</span><span class="s1">], </span><span class="s2">firstToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_COL</span><span class="s1">], </span><span class="s2">lastToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">END_LINE</span><span class="s1">], </span><span class="s2">lastToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">END_COL</span><span class="s1">]),</span>
          <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s2">firstToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">],</span>
          <span class="s2">spaces</span><span class="s1">: {</span>
            <span class="s2">before</span><span class="s1">: </span><span class="s2">space</span><span class="s1">,</span>
            <span class="s2">after</span><span class="s1">: </span><span class="s0">''</span>
          <span class="s1">}</span>
        <span class="s1">}));</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s3">return </span><span class="s2">nodes</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s6">/**</span>
   <span class="s6">*</span>
   <span class="s6">* </span><span class="s7">@param </span><span class="s6">{*} nodes</span>
   <span class="s6">*/</span><span class="s1">;</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">convertWhitespaceNodesToSpace </span><span class="s1">= </span><span class="s3">function </span><span class="s2">convertWhitespaceNodesToSpace</span><span class="s1">(</span><span class="s2">nodes</span><span class="s1">, </span><span class="s2">requiredSpace</span><span class="s1">) {</span>
    <span class="s3">var </span><span class="s2">_this2 </span><span class="s1">= </span><span class="s3">this</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">requiredSpace </span><span class="s1">=== </span><span class="s3">void </span><span class="s4">0</span><span class="s1">) {</span>
      <span class="s2">requiredSpace </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">var </span><span class="s2">space </span><span class="s1">= </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">rawSpace </span><span class="s1">= </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
    <span class="s2">nodes</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">(</span><span class="s3">function </span><span class="s1">(</span><span class="s2">n</span><span class="s1">) {</span>
      <span class="s3">var </span><span class="s2">spaceBefore </span><span class="s1">= </span><span class="s2">_this2</span><span class="s1">.</span><span class="s2">lossySpace</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">before</span><span class="s1">, </span><span class="s2">requiredSpace</span><span class="s1">);</span>
      <span class="s3">var </span><span class="s2">rawSpaceBefore </span><span class="s1">= </span><span class="s2">_this2</span><span class="s1">.</span><span class="s2">lossySpace</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">rawSpaceBefore</span><span class="s1">, </span><span class="s2">requiredSpace</span><span class="s1">);</span>
      <span class="s2">space </span><span class="s1">+= </span><span class="s2">spaceBefore </span><span class="s1">+ </span><span class="s2">_this2</span><span class="s1">.</span><span class="s2">lossySpace</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">after</span><span class="s1">, </span><span class="s2">requiredSpace </span><span class="s1">&amp;&amp; </span><span class="s2">spaceBefore</span><span class="s1">.</span><span class="s2">length </span><span class="s1">=== </span><span class="s4">0</span><span class="s1">);</span>
      <span class="s2">rawSpace </span><span class="s1">+= </span><span class="s2">spaceBefore </span><span class="s1">+ </span><span class="s2">n</span><span class="s1">.</span><span class="s2">value </span><span class="s1">+ </span><span class="s2">_this2</span><span class="s1">.</span><span class="s2">lossySpace</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">rawSpaceAfter</span><span class="s1">, </span><span class="s2">requiredSpace </span><span class="s1">&amp;&amp; </span><span class="s2">rawSpaceBefore</span><span class="s1">.</span><span class="s2">length </span><span class="s1">=== </span><span class="s4">0</span><span class="s1">);</span>
    <span class="s1">});</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">rawSpace </span><span class="s1">=== </span><span class="s2">space</span><span class="s1">) {</span>
      <span class="s2">rawSpace </span><span class="s1">= </span><span class="s2">undefined</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">var </span><span class="s2">result </span><span class="s1">= {</span>
      <span class="s2">space</span><span class="s1">: </span><span class="s2">space</span><span class="s1">,</span>
      <span class="s2">rawSpace</span><span class="s1">: </span><span class="s2">rawSpace</span>
    <span class="s1">};</span>
    <span class="s3">return </span><span class="s2">result</span><span class="s1">;</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">isNamedCombinator </span><span class="s1">= </span><span class="s3">function </span><span class="s2">isNamedCombinator</span><span class="s1">(</span><span class="s2">position</span><span class="s1">) {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">position </span><span class="s1">=== </span><span class="s3">void </span><span class="s4">0</span><span class="s1">) {</span>
      <span class="s2">position </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">position </span><span class="s1">+ </span><span class="s4">0</span><span class="s1">] &amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">position </span><span class="s1">+ </span><span class="s4">0</span><span class="s1">][</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">slash </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">position </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">] &amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">position </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">][</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">word </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">position </span><span class="s1">+ </span><span class="s4">2</span><span class="s1">] &amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">position </span><span class="s1">+ </span><span class="s4">2</span><span class="s1">][</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">slash</span><span class="s1">;</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">namedCombinator </span><span class="s1">= </span><span class="s3">function </span><span class="s2">namedCombinator</span><span class="s1">() {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">isNamedCombinator</span><span class="s1">()) {</span>
      <span class="s3">var </span><span class="s2">nameRaw </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">]);</span>
      <span class="s3">var </span><span class="s2">name </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_util</span><span class="s1">.</span><span class="s2">unesc</span><span class="s1">)(</span><span class="s2">nameRaw</span><span class="s1">).</span><span class="s2">toLowerCase</span><span class="s1">();</span>
      <span class="s3">var </span><span class="s2">raws </span><span class="s1">= {};</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">name </span><span class="s1">!== </span><span class="s2">nameRaw</span><span class="s1">) {</span>
        <span class="s2">raws</span><span class="s1">.</span><span class="s2">value </span><span class="s1">= </span><span class="s0">&quot;/&quot; </span><span class="s1">+ </span><span class="s2">nameRaw </span><span class="s1">+ </span><span class="s0">&quot;/&quot;</span><span class="s1">;</span>
      <span class="s1">}</span>
      <span class="s3">var </span><span class="s2">node </span><span class="s1">= </span><span class="s3">new </span><span class="s2">_combinator</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
        <span class="s2">value</span><span class="s1">: </span><span class="s0">&quot;/&quot; </span><span class="s1">+ </span><span class="s2">name </span><span class="s1">+ </span><span class="s0">&quot;/&quot;</span><span class="s1">,</span>
        <span class="s2">source</span><span class="s1">: </span><span class="s2">getSource</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_LINE</span><span class="s1">], </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_COL</span><span class="s1">], </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">+ </span><span class="s4">2</span><span class="s1">][</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">END_LINE</span><span class="s1">], </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">+ </span><span class="s4">2</span><span class="s1">][</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">END_COL</span><span class="s1">]),</span>
        <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">],</span>
        <span class="s2">raws</span><span class="s1">: </span><span class="s2">raws</span>
      <span class="s1">});</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">+ </span><span class="s4">3</span><span class="s1">;</span>
      <span class="s3">return </span><span class="s2">node</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">unexpected</span><span class="s1">();</span>
    <span class="s1">}</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">combinator </span><span class="s1">= </span><span class="s3">function </span><span class="s2">combinator</span><span class="s1">() {</span>
    <span class="s3">var </span><span class="s2">_this3 </span><span class="s1">= </span><span class="s3">this</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">() === </span><span class="s0">'|'</span><span class="s1">) {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">namespace</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s5">// We need to decide between a space that's a descendant combinator and meaningless whitespace at the end of a selector.</span>
    <span class="s3">var </span><span class="s2">nextSigTokenPos </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">locateNextMeaningfulToken</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">nextSigTokenPos </span><span class="s1">&lt; </span><span class="s4">0 </span><span class="s1">|| </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">nextSigTokenPos</span><span class="s1">][</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">comma</span><span class="s1">) {</span>
      <span class="s3">var </span><span class="s2">nodes </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">parseWhitespaceEquivalentTokens</span><span class="s1">(</span><span class="s2">nextSigTokenPos</span><span class="s1">);</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">nodes</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&gt; </span><span class="s4">0</span><span class="s1">) {</span>
        <span class="s3">var </span><span class="s2">last </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">current</span><span class="s1">.</span><span class="s2">last</span><span class="s1">;</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">last</span><span class="s1">) {</span>
          <span class="s3">var </span><span class="s2">_this$convertWhitespa </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">convertWhitespaceNodesToSpace</span><span class="s1">(</span><span class="s2">nodes</span><span class="s1">),</span>
            <span class="s2">space </span><span class="s1">= </span><span class="s2">_this$convertWhitespa</span><span class="s1">.</span><span class="s2">space</span><span class="s1">,</span>
            <span class="s2">rawSpace </span><span class="s1">= </span><span class="s2">_this$convertWhitespa</span><span class="s1">.</span><span class="s2">rawSpace</span><span class="s1">;</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">rawSpace </span><span class="s1">!== </span><span class="s2">undefined</span><span class="s1">) {</span>
            <span class="s2">last</span><span class="s1">.</span><span class="s2">rawSpaceAfter </span><span class="s1">+= </span><span class="s2">rawSpace</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s2">last</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">after </span><span class="s1">+= </span><span class="s2">space</span><span class="s1">;</span>
        <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
          <span class="s2">nodes</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">(</span><span class="s3">function </span><span class="s1">(</span><span class="s2">n</span><span class="s1">) {</span>
            <span class="s3">return </span><span class="s2">_this3</span><span class="s1">.</span><span class="s2">newNode</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span>
          <span class="s1">});</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
      <span class="s3">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">var </span><span class="s2">firstToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">spaceOrDescendantSelectorNodes </span><span class="s1">= </span><span class="s2">undefined</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">nextSigTokenPos </span><span class="s1">&gt; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">) {</span>
      <span class="s2">spaceOrDescendantSelectorNodes </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">parseWhitespaceEquivalentTokens</span><span class="s1">(</span><span class="s2">nextSigTokenPos</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">var </span><span class="s2">node</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">isNamedCombinator</span><span class="s1">()) {</span>
      <span class="s2">node </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">namedCombinator</span><span class="s1">();</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">combinator</span><span class="s1">) {</span>
      <span class="s2">node </span><span class="s1">= </span><span class="s3">new </span><span class="s2">_combinator</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
        <span class="s2">value</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(),</span>
        <span class="s2">source</span><span class="s1">: </span><span class="s2">getTokenSource</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">),</span>
        <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]</span>
      <span class="s1">});</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s2">WHITESPACE_TOKENS</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">]]) {</span>
      <span class="s5">// pass</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(!</span><span class="s2">spaceOrDescendantSelectorNodes</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">unexpected</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">node</span><span class="s1">) {</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">spaceOrDescendantSelectorNodes</span><span class="s1">) {</span>
        <span class="s3">var </span><span class="s2">_this$convertWhitespa2 </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">convertWhitespaceNodesToSpace</span><span class="s1">(</span><span class="s2">spaceOrDescendantSelectorNodes</span><span class="s1">),</span>
          <span class="s2">_space </span><span class="s1">= </span><span class="s2">_this$convertWhitespa2</span><span class="s1">.</span><span class="s2">space</span><span class="s1">,</span>
          <span class="s2">_rawSpace </span><span class="s1">= </span><span class="s2">_this$convertWhitespa2</span><span class="s1">.</span><span class="s2">rawSpace</span><span class="s1">;</span>
        <span class="s2">node</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">before </span><span class="s1">= </span><span class="s2">_space</span><span class="s1">;</span>
        <span class="s2">node</span><span class="s1">.</span><span class="s2">rawSpaceBefore </span><span class="s1">= </span><span class="s2">_rawSpace</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s5">// descendant combinator</span>
      <span class="s3">var </span><span class="s2">_this$convertWhitespa3 </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">convertWhitespaceNodesToSpace</span><span class="s1">(</span><span class="s2">spaceOrDescendantSelectorNodes</span><span class="s1">, </span><span class="s3">true</span><span class="s1">),</span>
        <span class="s2">_space2 </span><span class="s1">= </span><span class="s2">_this$convertWhitespa3</span><span class="s1">.</span><span class="s2">space</span><span class="s1">,</span>
        <span class="s2">_rawSpace2 </span><span class="s1">= </span><span class="s2">_this$convertWhitespa3</span><span class="s1">.</span><span class="s2">rawSpace</span><span class="s1">;</span>
      <span class="s3">if </span><span class="s1">(!</span><span class="s2">_rawSpace2</span><span class="s1">) {</span>
        <span class="s2">_rawSpace2 </span><span class="s1">= </span><span class="s2">_space2</span><span class="s1">;</span>
      <span class="s1">}</span>
      <span class="s3">var </span><span class="s2">spaces </span><span class="s1">= {};</span>
      <span class="s3">var </span><span class="s2">raws </span><span class="s1">= {</span>
        <span class="s2">spaces</span><span class="s1">: {}</span>
      <span class="s1">};</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">_space2</span><span class="s1">.</span><span class="s2">endsWith</span><span class="s1">(</span><span class="s0">' '</span><span class="s1">) &amp;&amp; </span><span class="s2">_rawSpace2</span><span class="s1">.</span><span class="s2">endsWith</span><span class="s1">(</span><span class="s0">' '</span><span class="s1">)) {</span>
        <span class="s2">spaces</span><span class="s1">.</span><span class="s2">before </span><span class="s1">= </span><span class="s2">_space2</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_space2</span><span class="s1">.</span><span class="s2">length </span><span class="s1">- </span><span class="s4">1</span><span class="s1">);</span>
        <span class="s2">raws</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">before </span><span class="s1">= </span><span class="s2">_rawSpace2</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_rawSpace2</span><span class="s1">.</span><span class="s2">length </span><span class="s1">- </span><span class="s4">1</span><span class="s1">);</span>
      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s2">_space2</span><span class="s1">.</span><span class="s2">startsWith</span><span class="s1">(</span><span class="s0">' '</span><span class="s1">) &amp;&amp; </span><span class="s2">_rawSpace2</span><span class="s1">.</span><span class="s2">startsWith</span><span class="s1">(</span><span class="s0">' '</span><span class="s1">)) {</span>
        <span class="s2">spaces</span><span class="s1">.</span><span class="s2">after </span><span class="s1">= </span><span class="s2">_space2</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s4">1</span><span class="s1">);</span>
        <span class="s2">raws</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">after </span><span class="s1">= </span><span class="s2">_rawSpace2</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s4">1</span><span class="s1">);</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s2">raws</span><span class="s1">.</span><span class="s2">value </span><span class="s1">= </span><span class="s2">_rawSpace2</span><span class="s1">;</span>
      <span class="s1">}</span>
      <span class="s2">node </span><span class="s1">= </span><span class="s3">new </span><span class="s2">_combinator</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
        <span class="s2">value</span><span class="s1">: </span><span class="s0">' '</span><span class="s1">,</span>
        <span class="s2">source</span><span class="s1">: </span><span class="s2">getTokenSourceSpan</span><span class="s1">(</span><span class="s2">firstToken</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">- </span><span class="s4">1</span><span class="s1">]),</span>
        <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s2">firstToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">],</span>
        <span class="s2">spaces</span><span class="s1">: </span><span class="s2">spaces</span><span class="s1">,</span>
        <span class="s2">raws</span><span class="s1">: </span><span class="s2">raws</span>
      <span class="s1">});</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">space</span><span class="s1">) {</span>
      <span class="s2">node</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">after </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">optionalSpace</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">());</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
    <span class="s1">}</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">newNode</span><span class="s1">(</span><span class="s2">node</span><span class="s1">);</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">comma </span><span class="s1">= </span><span class="s3">function </span><span class="s2">comma</span><span class="s1">() {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">=== </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">length </span><span class="s1">- </span><span class="s4">1</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">root</span><span class="s1">.</span><span class="s2">trailingComma </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
      <span class="s3">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">current</span><span class="s1">.</span><span class="s2">_inferEndPosition</span><span class="s1">();</span>
    <span class="s3">var </span><span class="s2">selector </span><span class="s1">= </span><span class="s3">new </span><span class="s2">_selector</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
      <span class="s2">source</span><span class="s1">: {</span>
        <span class="s2">start</span><span class="s1">: </span><span class="s2">tokenStart</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">])</span>
      <span class="s1">}</span>
    <span class="s1">});</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">current</span><span class="s1">.</span><span class="s2">parent</span><span class="s1">.</span><span class="s2">append</span><span class="s1">(</span><span class="s2">selector</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">current </span><span class="s1">= </span><span class="s2">selector</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">comment </span><span class="s1">= </span><span class="s3">function </span><span class="s2">comment</span><span class="s1">() {</span>
    <span class="s3">var </span><span class="s2">current </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">newNode</span><span class="s1">(</span><span class="s3">new </span><span class="s2">_comment</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
      <span class="s2">value</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(),</span>
      <span class="s2">source</span><span class="s1">: </span><span class="s2">getTokenSource</span><span class="s1">(</span><span class="s2">current</span><span class="s1">),</span>
      <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s2">current</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]</span>
    <span class="s1">}));</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">error </span><span class="s1">= </span><span class="s3">function </span><span class="s2">error</span><span class="s1">(</span><span class="s2">message</span><span class="s1">, </span><span class="s2">opts</span><span class="s1">) {</span>
    <span class="s3">throw this</span><span class="s1">.</span><span class="s2">root</span><span class="s1">.</span><span class="s2">error</span><span class="s1">(</span><span class="s2">message</span><span class="s1">, </span><span class="s2">opts</span><span class="s1">);</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">missingBackslash </span><span class="s1">= </span><span class="s3">function </span><span class="s2">missingBackslash</span><span class="s1">() {</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">error</span><span class="s1">(</span><span class="s0">'Expected a backslash preceding the semicolon.'</span><span class="s1">, {</span>
      <span class="s2">index</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]</span>
    <span class="s1">});</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">missingParenthesis </span><span class="s1">= </span><span class="s3">function </span><span class="s2">missingParenthesis</span><span class="s1">() {</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">expected</span><span class="s1">(</span><span class="s0">'opening parenthesis'</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]);</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">missingSquareBracket </span><span class="s1">= </span><span class="s3">function </span><span class="s2">missingSquareBracket</span><span class="s1">() {</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">expected</span><span class="s1">(</span><span class="s0">'opening square bracket'</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]);</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">unexpected </span><span class="s1">= </span><span class="s3">function </span><span class="s2">unexpected</span><span class="s1">() {</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">error</span><span class="s1">(</span><span class="s0">&quot;Unexpected '&quot; </span><span class="s1">+ </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">() + </span><span class="s0">&quot;'. Escaping special characters with </span><span class="s3">\\ </span><span class="s0">may help.&quot;</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]);</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">unexpectedPipe </span><span class="s1">= </span><span class="s3">function </span><span class="s2">unexpectedPipe</span><span class="s1">() {</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">error</span><span class="s1">(</span><span class="s0">&quot;Unexpected '|'.&quot;</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]);</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">namespace </span><span class="s1">= </span><span class="s3">function </span><span class="s2">namespace</span><span class="s1">() {</span>
    <span class="s3">var </span><span class="s2">before </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">prevToken </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">prevToken</span><span class="s1">) || </span><span class="s3">true</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">nextToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">word</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">word</span><span class="s1">(</span><span class="s2">before</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">nextToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">asterisk</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">universal</span><span class="s1">(</span><span class="s2">before</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">unexpectedPipe</span><span class="s1">();</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">nesting </span><span class="s1">= </span><span class="s3">function </span><span class="s2">nesting</span><span class="s1">() {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">nextToken</span><span class="s1">) {</span>
      <span class="s3">var </span><span class="s2">nextContent </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">nextToken</span><span class="s1">);</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">nextContent </span><span class="s1">=== </span><span class="s0">&quot;|&quot;</span><span class="s1">) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
        <span class="s3">return</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s3">var </span><span class="s2">current </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">newNode</span><span class="s1">(</span><span class="s3">new </span><span class="s2">_nesting</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
      <span class="s2">value</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(),</span>
      <span class="s2">source</span><span class="s1">: </span><span class="s2">getTokenSource</span><span class="s1">(</span><span class="s2">current</span><span class="s1">),</span>
      <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s2">current</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]</span>
    <span class="s1">}));</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">parentheses </span><span class="s1">= </span><span class="s3">function </span><span class="s2">parentheses</span><span class="s1">() {</span>
    <span class="s3">var </span><span class="s2">last </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">current</span><span class="s1">.</span><span class="s2">last</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">unbalanced </span><span class="s1">= </span><span class="s4">1</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">last </span><span class="s1">&amp;&amp; </span><span class="s2">last</span><span class="s1">.</span><span class="s2">type </span><span class="s1">=== </span><span class="s2">types</span><span class="s1">.</span><span class="s2">PSEUDO</span><span class="s1">) {</span>
      <span class="s3">var </span><span class="s2">selector </span><span class="s1">= </span><span class="s3">new </span><span class="s2">_selector</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
        <span class="s2">source</span><span class="s1">: {</span>
          <span class="s2">start</span><span class="s1">: </span><span class="s2">tokenStart</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">- </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">}</span>
      <span class="s1">});</span>
      <span class="s3">var </span><span class="s2">cache </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">current</span><span class="s1">;</span>
      <span class="s2">last</span><span class="s1">.</span><span class="s2">append</span><span class="s1">(</span><span class="s2">selector</span><span class="s1">);</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">current </span><span class="s1">= </span><span class="s2">selector</span><span class="s1">;</span>
      <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">&lt; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&amp;&amp; </span><span class="s2">unbalanced</span><span class="s1">) {</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">openParenthesis</span><span class="s1">) {</span>
          <span class="s2">unbalanced</span><span class="s1">++;</span>
        <span class="s1">}</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">closeParenthesis</span><span class="s1">) {</span>
          <span class="s2">unbalanced</span><span class="s1">--;</span>
        <span class="s1">}</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">unbalanced</span><span class="s1">) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">parse</span><span class="s1">();</span>
        <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">current</span><span class="s1">.</span><span class="s2">source</span><span class="s1">.</span><span class="s2">end </span><span class="s1">= </span><span class="s2">tokenEnd</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">);</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">current</span><span class="s1">.</span><span class="s2">parent</span><span class="s1">.</span><span class="s2">source</span><span class="s1">.</span><span class="s2">end </span><span class="s1">= </span><span class="s2">tokenEnd</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">);</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">current </span><span class="s1">= </span><span class="s2">cache</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s5">// I think this case should be an error. It's used to implement a basic parse of media queries</span>
      <span class="s5">// but I don't think it's a good idea.</span>
      <span class="s3">var </span><span class="s2">parenStart </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">;</span>
      <span class="s3">var </span><span class="s2">parenValue </span><span class="s1">= </span><span class="s0">&quot;(&quot;</span><span class="s1">;</span>
      <span class="s3">var </span><span class="s2">parenEnd</span><span class="s1">;</span>
      <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">&lt; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&amp;&amp; </span><span class="s2">unbalanced</span><span class="s1">) {</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">openParenthesis</span><span class="s1">) {</span>
          <span class="s2">unbalanced</span><span class="s1">++;</span>
        <span class="s1">}</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">closeParenthesis</span><span class="s1">) {</span>
          <span class="s2">unbalanced</span><span class="s1">--;</span>
        <span class="s1">}</span>
        <span class="s2">parenEnd </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">;</span>
        <span class="s2">parenValue </span><span class="s1">+= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">parseParenthesisToken</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">);</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
      <span class="s1">}</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">last</span><span class="s1">) {</span>
        <span class="s2">last</span><span class="s1">.</span><span class="s2">appendToPropertyAndEscape</span><span class="s1">(</span><span class="s0">&quot;value&quot;</span><span class="s1">, </span><span class="s2">parenValue</span><span class="s1">, </span><span class="s2">parenValue</span><span class="s1">);</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">newNode</span><span class="s1">(</span><span class="s3">new </span><span class="s2">_string</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
          <span class="s2">value</span><span class="s1">: </span><span class="s2">parenValue</span><span class="s1">,</span>
          <span class="s2">source</span><span class="s1">: </span><span class="s2">getSource</span><span class="s1">(</span><span class="s2">parenStart</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_LINE</span><span class="s1">], </span><span class="s2">parenStart</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_COL</span><span class="s1">], </span><span class="s2">parenEnd</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">END_LINE</span><span class="s1">], </span><span class="s2">parenEnd</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">END_COL</span><span class="s1">]),</span>
          <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s2">parenStart</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]</span>
        <span class="s1">}));</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">unbalanced</span><span class="s1">) {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">expected</span><span class="s1">(</span><span class="s0">'closing parenthesis'</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]);</span>
    <span class="s1">}</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">pseudo </span><span class="s1">= </span><span class="s3">function </span><span class="s2">pseudo</span><span class="s1">() {</span>
    <span class="s3">var </span><span class="s2">_this4 </span><span class="s1">= </span><span class="s3">this</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">pseudoStr </span><span class="s1">= </span><span class="s0">''</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">startingToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">;</span>
    <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">colon</span><span class="s1">) {</span>
      <span class="s2">pseudoStr </span><span class="s1">+= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">) {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">expected</span><span class="s1">([</span><span class="s0">'pseudo-class'</span><span class="s1">, </span><span class="s0">'pseudo-element'</span><span class="s1">], </span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">- </span><span class="s4">1</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">word</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">splitWord</span><span class="s1">(</span><span class="s3">false</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">first</span><span class="s1">, </span><span class="s2">length</span><span class="s1">) {</span>
        <span class="s2">pseudoStr </span><span class="s1">+= </span><span class="s2">first</span><span class="s1">;</span>
        <span class="s2">_this4</span><span class="s1">.</span><span class="s2">newNode</span><span class="s1">(</span><span class="s3">new </span><span class="s2">_pseudo</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
          <span class="s2">value</span><span class="s1">: </span><span class="s2">pseudoStr</span><span class="s1">,</span>
          <span class="s2">source</span><span class="s1">: </span><span class="s2">getTokenSourceSpan</span><span class="s1">(</span><span class="s2">startingToken</span><span class="s1">, </span><span class="s2">_this4</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">),</span>
          <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s2">startingToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]</span>
        <span class="s1">}));</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">length </span><span class="s1">&gt; </span><span class="s4">1 </span><span class="s1">&amp;&amp; </span><span class="s2">_this4</span><span class="s1">.</span><span class="s2">nextToken </span><span class="s1">&amp;&amp; </span><span class="s2">_this4</span><span class="s1">.</span><span class="s2">nextToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">openParenthesis</span><span class="s1">) {</span>
          <span class="s2">_this4</span><span class="s1">.</span><span class="s2">error</span><span class="s1">(</span><span class="s0">'Misplaced parenthesis.'</span><span class="s1">, {</span>
            <span class="s2">index</span><span class="s1">: </span><span class="s2">_this4</span><span class="s1">.</span><span class="s2">nextToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]</span>
          <span class="s1">});</span>
        <span class="s1">}</span>
      <span class="s1">});</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">expected</span><span class="s1">([</span><span class="s0">'pseudo-class'</span><span class="s1">, </span><span class="s0">'pseudo-element'</span><span class="s1">], </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]);</span>
    <span class="s1">}</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">space </span><span class="s1">= </span><span class="s3">function </span><span class="s2">space</span><span class="s1">() {</span>
    <span class="s3">var </span><span class="s2">content </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">();</span>
    <span class="s5">// Handle space before and after the selector</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">=== </span><span class="s4">0 </span><span class="s1">|| </span><span class="s3">this</span><span class="s1">.</span><span class="s2">prevToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">comma </span><span class="s1">|| </span><span class="s3">this</span><span class="s1">.</span><span class="s2">prevToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">openParenthesis </span><span class="s1">|| </span><span class="s3">this</span><span class="s1">.</span><span class="s2">current</span><span class="s1">.</span><span class="s2">nodes</span><span class="s1">.</span><span class="s2">every</span><span class="s1">(</span><span class="s3">function </span><span class="s1">(</span><span class="s2">node</span><span class="s1">) {</span>
      <span class="s3">return </span><span class="s2">node</span><span class="s1">.</span><span class="s2">type </span><span class="s1">=== </span><span class="s0">'comment'</span><span class="s1">;</span>
    <span class="s1">})) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">spaces </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">optionalSpace</span><span class="s1">(</span><span class="s2">content</span><span class="s1">);</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">=== </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">length </span><span class="s1">- </span><span class="s4">1 </span><span class="s1">|| </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nextToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">comma </span><span class="s1">|| </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nextToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">closeParenthesis</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">current</span><span class="s1">.</span><span class="s2">last</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">after </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">optionalSpace</span><span class="s1">(</span><span class="s2">content</span><span class="s1">);</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">combinator</span><span class="s1">();</span>
    <span class="s1">}</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">string </span><span class="s1">= </span><span class="s3">function </span><span class="s2">string</span><span class="s1">() {</span>
    <span class="s3">var </span><span class="s2">current </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">newNode</span><span class="s1">(</span><span class="s3">new </span><span class="s2">_string</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
      <span class="s2">value</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(),</span>
      <span class="s2">source</span><span class="s1">: </span><span class="s2">getTokenSource</span><span class="s1">(</span><span class="s2">current</span><span class="s1">),</span>
      <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s2">current</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]</span>
    <span class="s1">}));</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">universal </span><span class="s1">= </span><span class="s3">function </span><span class="s2">universal</span><span class="s1">(</span><span class="s2">namespace</span><span class="s1">) {</span>
    <span class="s3">var </span><span class="s2">nextToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nextToken</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">nextToken </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(</span><span class="s2">nextToken</span><span class="s1">) === </span><span class="s0">'|'</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">namespace</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">var </span><span class="s2">current </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">newNode</span><span class="s1">(</span><span class="s3">new </span><span class="s2">_universal</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">]({</span>
      <span class="s2">value</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(),</span>
      <span class="s2">source</span><span class="s1">: </span><span class="s2">getTokenSource</span><span class="s1">(</span><span class="s2">current</span><span class="s1">),</span>
      <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s2">current</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">]</span>
    <span class="s1">}), </span><span class="s2">namespace</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">splitWord </span><span class="s1">= </span><span class="s3">function </span><span class="s2">splitWord</span><span class="s1">(</span><span class="s2">namespace</span><span class="s1">, </span><span class="s2">firstCallback</span><span class="s1">) {</span>
    <span class="s3">var </span><span class="s2">_this5 </span><span class="s1">= </span><span class="s3">this</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">nextToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nextToken</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s2">word </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">();</span>
    <span class="s3">while </span><span class="s1">(</span><span class="s2">nextToken </span><span class="s1">&amp;&amp; ~[</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">dollar</span><span class="s1">, </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">caret</span><span class="s1">, </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">equals</span><span class="s1">, </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">word</span><span class="s1">].</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">nextToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">])) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
      <span class="s3">var </span><span class="s2">current </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">();</span>
      <span class="s2">word </span><span class="s1">+= </span><span class="s2">current</span><span class="s1">;</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">current</span><span class="s1">.</span><span class="s2">lastIndexOf</span><span class="s1">(</span><span class="s0">'</span><span class="s3">\\</span><span class="s0">'</span><span class="s1">) === </span><span class="s2">current</span><span class="s1">.</span><span class="s2">length </span><span class="s1">- </span><span class="s4">1</span><span class="s1">) {</span>
        <span class="s3">var </span><span class="s2">next </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nextToken</span><span class="s1">;</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">next </span><span class="s1">&amp;&amp; </span><span class="s2">next</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">space</span><span class="s1">) {</span>
          <span class="s2">word </span><span class="s1">+= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">requiredSpace</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(</span><span class="s2">next</span><span class="s1">));</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
      <span class="s2">nextToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nextToken</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">var </span><span class="s2">hasClass </span><span class="s1">= </span><span class="s2">indexesOf</span><span class="s1">(</span><span class="s2">word</span><span class="s1">, </span><span class="s0">'.'</span><span class="s1">).</span><span class="s2">filter</span><span class="s1">(</span><span class="s3">function </span><span class="s1">(</span><span class="s2">i</span><span class="s1">) {</span>
      <span class="s5">// Allow escaped dot within class name</span>
      <span class="s3">var </span><span class="s2">escapedDot </span><span class="s1">= </span><span class="s2">word</span><span class="s1">[</span><span class="s2">i </span><span class="s1">- </span><span class="s4">1</span><span class="s1">] === </span><span class="s0">'</span><span class="s3">\\</span><span class="s0">'</span><span class="s1">;</span>
      <span class="s5">// Allow decimal numbers percent in @keyframes</span>
      <span class="s3">var </span><span class="s2">isKeyframesPercent </span><span class="s1">= </span><span class="s8">/^\d+\.\d+%$/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">word</span><span class="s1">);</span>
      <span class="s3">return </span><span class="s1">!</span><span class="s2">escapedDot </span><span class="s1">&amp;&amp; !</span><span class="s2">isKeyframesPercent</span><span class="s1">;</span>
    <span class="s1">});</span>
    <span class="s3">var </span><span class="s2">hasId </span><span class="s1">= </span><span class="s2">indexesOf</span><span class="s1">(</span><span class="s2">word</span><span class="s1">, </span><span class="s0">'#'</span><span class="s1">).</span><span class="s2">filter</span><span class="s1">(</span><span class="s3">function </span><span class="s1">(</span><span class="s2">i</span><span class="s1">) {</span>
      <span class="s3">return </span><span class="s2">word</span><span class="s1">[</span><span class="s2">i </span><span class="s1">- </span><span class="s4">1</span><span class="s1">] !== </span><span class="s0">'</span><span class="s3">\\</span><span class="s0">'</span><span class="s1">;</span>
    <span class="s1">});</span>
    <span class="s5">// Eliminate Sass interpolations from the list of id indexes</span>
    <span class="s3">var </span><span class="s2">interpolations </span><span class="s1">= </span><span class="s2">indexesOf</span><span class="s1">(</span><span class="s2">word</span><span class="s1">, </span><span class="s0">'#{'</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">interpolations</span><span class="s1">.</span><span class="s2">length</span><span class="s1">) {</span>
      <span class="s2">hasId </span><span class="s1">= </span><span class="s2">hasId</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">(</span><span class="s3">function </span><span class="s1">(</span><span class="s2">hashIndex</span><span class="s1">) {</span>
        <span class="s3">return </span><span class="s1">!~</span><span class="s2">interpolations</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">hashIndex</span><span class="s1">);</span>
      <span class="s1">});</span>
    <span class="s1">}</span>
    <span class="s3">var </span><span class="s2">indices </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_sortAscending</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">])(</span><span class="s2">uniqs</span><span class="s1">([</span><span class="s4">0</span><span class="s1">].</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">hasClass</span><span class="s1">, </span><span class="s2">hasId</span><span class="s1">)));</span>
    <span class="s2">indices</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">(</span><span class="s3">function </span><span class="s1">(</span><span class="s2">ind</span><span class="s1">, </span><span class="s2">i</span><span class="s1">) {</span>
      <span class="s3">var </span><span class="s2">index </span><span class="s1">= </span><span class="s2">indices</span><span class="s1">[</span><span class="s2">i </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">] || </span><span class="s2">word</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span>
      <span class="s3">var </span><span class="s2">value </span><span class="s1">= </span><span class="s2">word</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">ind</span><span class="s1">, </span><span class="s2">index</span><span class="s1">);</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">i </span><span class="s1">=== </span><span class="s4">0 </span><span class="s1">&amp;&amp; </span><span class="s2">firstCallback</span><span class="s1">) {</span>
        <span class="s3">return </span><span class="s2">firstCallback</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">_this5</span><span class="s1">, </span><span class="s2">value</span><span class="s1">, </span><span class="s2">indices</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span>
      <span class="s1">}</span>
      <span class="s3">var </span><span class="s2">node</span><span class="s1">;</span>
      <span class="s3">var </span><span class="s2">current </span><span class="s1">= </span><span class="s2">_this5</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">;</span>
      <span class="s3">var </span><span class="s2">sourceIndex </span><span class="s1">= </span><span class="s2">current</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">] + </span><span class="s2">indices</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span>
      <span class="s3">var </span><span class="s2">source </span><span class="s1">= </span><span class="s2">getSource</span><span class="s1">(</span><span class="s2">current</span><span class="s1">[</span><span class="s4">1</span><span class="s1">], </span><span class="s2">current</span><span class="s1">[</span><span class="s4">2</span><span class="s1">] + </span><span class="s2">ind</span><span class="s1">, </span><span class="s2">current</span><span class="s1">[</span><span class="s4">3</span><span class="s1">], </span><span class="s2">current</span><span class="s1">[</span><span class="s4">2</span><span class="s1">] + (</span><span class="s2">index </span><span class="s1">- </span><span class="s4">1</span><span class="s1">));</span>
      <span class="s3">if </span><span class="s1">(~</span><span class="s2">hasClass</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">ind</span><span class="s1">)) {</span>
        <span class="s3">var </span><span class="s2">classNameOpts </span><span class="s1">= {</span>
          <span class="s2">value</span><span class="s1">: </span><span class="s2">value</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s4">1</span><span class="s1">),</span>
          <span class="s2">source</span><span class="s1">: </span><span class="s2">source</span><span class="s1">,</span>
          <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s2">sourceIndex</span>
        <span class="s1">};</span>
        <span class="s2">node </span><span class="s1">= </span><span class="s3">new </span><span class="s2">_className</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">](</span><span class="s2">unescapeProp</span><span class="s1">(</span><span class="s2">classNameOpts</span><span class="s1">, </span><span class="s0">&quot;value&quot;</span><span class="s1">));</span>
      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(~</span><span class="s2">hasId</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">ind</span><span class="s1">)) {</span>
        <span class="s3">var </span><span class="s2">idOpts </span><span class="s1">= {</span>
          <span class="s2">value</span><span class="s1">: </span><span class="s2">value</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s4">1</span><span class="s1">),</span>
          <span class="s2">source</span><span class="s1">: </span><span class="s2">source</span><span class="s1">,</span>
          <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s2">sourceIndex</span>
        <span class="s1">};</span>
        <span class="s2">node </span><span class="s1">= </span><span class="s3">new </span><span class="s2">_id</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">](</span><span class="s2">unescapeProp</span><span class="s1">(</span><span class="s2">idOpts</span><span class="s1">, </span><span class="s0">&quot;value&quot;</span><span class="s1">));</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s3">var </span><span class="s2">tagOpts </span><span class="s1">= {</span>
          <span class="s2">value</span><span class="s1">: </span><span class="s2">value</span><span class="s1">,</span>
          <span class="s2">source</span><span class="s1">: </span><span class="s2">source</span><span class="s1">,</span>
          <span class="s2">sourceIndex</span><span class="s1">: </span><span class="s2">sourceIndex</span>
        <span class="s1">};</span>
        <span class="s2">unescapeProp</span><span class="s1">(</span><span class="s2">tagOpts</span><span class="s1">, </span><span class="s0">&quot;value&quot;</span><span class="s1">);</span>
        <span class="s2">node </span><span class="s1">= </span><span class="s3">new </span><span class="s2">_tag</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">](</span><span class="s2">tagOpts</span><span class="s1">);</span>
      <span class="s1">}</span>
      <span class="s2">_this5</span><span class="s1">.</span><span class="s2">newNode</span><span class="s1">(</span><span class="s2">node</span><span class="s1">, </span><span class="s2">namespace</span><span class="s1">);</span>
      <span class="s5">// Ensure that the namespace is used only once</span>
      <span class="s2">namespace </span><span class="s1">= </span><span class="s3">null</span><span class="s1">;</span>
    <span class="s1">});</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">word </span><span class="s1">= </span><span class="s3">function </span><span class="s2">word</span><span class="s1">(</span><span class="s2">namespace</span><span class="s1">) {</span>
    <span class="s3">var </span><span class="s2">nextToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nextToken</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">nextToken </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(</span><span class="s2">nextToken</span><span class="s1">) === </span><span class="s0">'|'</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">++;</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">namespace</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">splitWord</span><span class="s1">(</span><span class="s2">namespace</span><span class="s1">);</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">loop </span><span class="s1">= </span><span class="s3">function </span><span class="s2">loop</span><span class="s1">() {</span>
    <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">&lt; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">length</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">parse</span><span class="s1">(</span><span class="s3">true</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">current</span><span class="s1">.</span><span class="s2">_inferEndPosition</span><span class="s1">();</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">root</span><span class="s1">;</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">parse </span><span class="s1">= </span><span class="s3">function </span><span class="s2">parse</span><span class="s1">(</span><span class="s2">throwOnParenthesis</span><span class="s1">) {</span>
    <span class="s3">switch </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">]) {</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">space</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">space</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">comment</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">comment</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">openParenthesis</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">parentheses</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">closeParenthesis</span><span class="s1">:</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">throwOnParenthesis</span><span class="s1">) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">missingParenthesis</span><span class="s1">();</span>
        <span class="s1">}</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">openSquare</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">attribute</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">dollar</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">caret</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">equals</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">word</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">word</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">colon</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">pseudo</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">comma</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">comma</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">asterisk</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">universal</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">ampersand</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">nesting</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">slash</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">combinator</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">combinator</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">str</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">string</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s5">// These cases throw; no break needed.</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">closeSquare</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">missingSquareBracket</span><span class="s1">();</span>
      <span class="s3">case </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">semicolon</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">missingBackslash</span><span class="s1">();</span>
      <span class="s3">default</span><span class="s1">:</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">unexpected</span><span class="s1">();</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s6">/**</span>
   <span class="s6">* Helpers</span>
   <span class="s6">*/</span><span class="s1">;</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">expected </span><span class="s1">= </span><span class="s3">function </span><span class="s2">expected</span><span class="s1">(</span><span class="s2">description</span><span class="s1">, </span><span class="s2">index</span><span class="s1">, </span><span class="s2">found</span><span class="s1">) {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">description</span><span class="s1">)) {</span>
      <span class="s3">var </span><span class="s2">last </span><span class="s1">= </span><span class="s2">description</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">();</span>
      <span class="s2">description </span><span class="s1">= </span><span class="s2">description</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">', '</span><span class="s1">) + </span><span class="s0">&quot; or &quot; </span><span class="s1">+ </span><span class="s2">last</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">var </span><span class="s2">an </span><span class="s1">= </span><span class="s8">/^[aeiou]/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">description</span><span class="s1">[</span><span class="s4">0</span><span class="s1">]) ? </span><span class="s0">'an' </span><span class="s1">: </span><span class="s0">'a'</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s2">found</span><span class="s1">) {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">error</span><span class="s1">(</span><span class="s0">&quot;Expected &quot; </span><span class="s1">+ </span><span class="s2">an </span><span class="s1">+ </span><span class="s0">&quot; &quot; </span><span class="s1">+ </span><span class="s2">description </span><span class="s1">+ </span><span class="s0">&quot;.&quot;</span><span class="s1">, {</span>
        <span class="s2">index</span><span class="s1">: </span><span class="s2">index</span>
      <span class="s1">});</span>
    <span class="s1">}</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">error</span><span class="s1">(</span><span class="s0">&quot;Expected &quot; </span><span class="s1">+ </span><span class="s2">an </span><span class="s1">+ </span><span class="s0">&quot; &quot; </span><span class="s1">+ </span><span class="s2">description </span><span class="s1">+ </span><span class="s0">&quot;, found </span><span class="s3">\&quot;</span><span class="s0">&quot; </span><span class="s1">+ </span><span class="s2">found </span><span class="s1">+ </span><span class="s0">&quot;</span><span class="s3">\&quot; </span><span class="s0">instead.&quot;</span><span class="s1">, {</span>
      <span class="s2">index</span><span class="s1">: </span><span class="s2">index</span>
    <span class="s1">});</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">requiredSpace </span><span class="s1">= </span><span class="s3">function </span><span class="s2">requiredSpace</span><span class="s1">(</span><span class="s2">space</span><span class="s1">) {</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">lossy </span><span class="s1">? </span><span class="s0">' ' </span><span class="s1">: </span><span class="s2">space</span><span class="s1">;</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">optionalSpace </span><span class="s1">= </span><span class="s3">function </span><span class="s2">optionalSpace</span><span class="s1">(</span><span class="s2">space</span><span class="s1">) {</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">lossy </span><span class="s1">? </span><span class="s0">'' </span><span class="s1">: </span><span class="s2">space</span><span class="s1">;</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">lossySpace </span><span class="s1">= </span><span class="s3">function </span><span class="s2">lossySpace</span><span class="s1">(</span><span class="s2">space</span><span class="s1">, </span><span class="s2">required</span><span class="s1">) {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">lossy</span><span class="s1">) {</span>
      <span class="s3">return </span><span class="s2">required </span><span class="s1">? </span><span class="s0">' ' </span><span class="s1">: </span><span class="s0">''</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">return </span><span class="s2">space</span><span class="s1">;</span>
    <span class="s1">}</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">parseParenthesisToken </span><span class="s1">= </span><span class="s3">function </span><span class="s2">parseParenthesisToken</span><span class="s1">(</span><span class="s2">token</span><span class="s1">) {</span>
    <span class="s3">var </span><span class="s2">content </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">(</span><span class="s2">token</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">] === </span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">space</span><span class="s1">) {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">requiredSpace</span><span class="s1">(</span><span class="s2">content</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">return </span><span class="s2">content</span><span class="s1">;</span>
    <span class="s1">}</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">newNode </span><span class="s1">= </span><span class="s3">function </span><span class="s2">newNode</span><span class="s1">(</span><span class="s2">node</span><span class="s1">, </span><span class="s2">namespace</span><span class="s1">) {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">namespace</span><span class="s1">) {</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s8">/^ +$/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">namespace</span><span class="s1">)) {</span>
        <span class="s3">if </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">lossy</span><span class="s1">) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">spaces </span><span class="s1">= (</span><span class="s3">this</span><span class="s1">.</span><span class="s2">spaces </span><span class="s1">|| </span><span class="s0">''</span><span class="s1">) + </span><span class="s2">namespace</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">namespace </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
      <span class="s1">}</span>
      <span class="s2">node</span><span class="s1">.</span><span class="s2">namespace </span><span class="s1">= </span><span class="s2">namespace</span><span class="s1">;</span>
      <span class="s2">unescapeProp</span><span class="s1">(</span><span class="s2">node</span><span class="s1">, </span><span class="s0">&quot;namespace&quot;</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">) {</span>
      <span class="s2">node</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">.</span><span class="s2">before </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">spaces</span><span class="s1">;</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">spaces </span><span class="s1">= </span><span class="s0">''</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">current</span><span class="s1">.</span><span class="s2">append</span><span class="s1">(</span><span class="s2">node</span><span class="s1">);</span>
  <span class="s1">};</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">content </span><span class="s1">= </span><span class="s3">function </span><span class="s2">content</span><span class="s1">(</span><span class="s2">token</span><span class="s1">) {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">token </span><span class="s1">=== </span><span class="s3">void </span><span class="s4">0</span><span class="s1">) {</span>
      <span class="s2">token </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">currToken</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">css</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">START_POS</span><span class="s1">], </span><span class="s2">token</span><span class="s1">[</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">END_POS</span><span class="s1">]);</span>
  <span class="s1">};</span>
  <span class="s6">/**</span>
   <span class="s6">* returns the index of the next non-whitespace, non-comment token.</span>
   <span class="s6">* returns -1 if no meaningful token is found.</span>
   <span class="s6">*/</span>
  <span class="s2">_proto</span><span class="s1">.</span><span class="s2">locateNextMeaningfulToken </span><span class="s1">= </span><span class="s3">function </span><span class="s2">locateNextMeaningfulToken</span><span class="s1">(</span><span class="s2">startPosition</span><span class="s1">) {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">startPosition </span><span class="s1">=== </span><span class="s3">void </span><span class="s4">0</span><span class="s1">) {</span>
      <span class="s2">startPosition </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">var </span><span class="s2">searchPosition </span><span class="s1">= </span><span class="s2">startPosition</span><span class="s1">;</span>
    <span class="s3">while </span><span class="s1">(</span><span class="s2">searchPosition </span><span class="s1">&lt; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">length</span><span class="s1">) {</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">WHITESPACE_EQUIV_TOKENS</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">searchPosition</span><span class="s1">][</span><span class="s2">_tokenize</span><span class="s1">.</span><span class="s2">FIELDS</span><span class="s1">.</span><span class="s2">TYPE</span><span class="s1">]]) {</span>
        <span class="s2">searchPosition</span><span class="s1">++;</span>
        <span class="s3">continue</span><span class="s1">;</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s3">return </span><span class="s2">searchPosition</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s3">return </span><span class="s1">-</span><span class="s4">1</span><span class="s1">;</span>
  <span class="s1">};</span>
  <span class="s2">_createClass</span><span class="s1">(</span><span class="s2">Parser</span><span class="s1">, [{</span>
    <span class="s2">key</span><span class="s1">: </span><span class="s0">&quot;currToken&quot;</span><span class="s1">,</span>
    <span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s2">get</span><span class="s1">() {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position</span><span class="s1">];</span>
    <span class="s1">}</span>
  <span class="s1">}, {</span>
    <span class="s2">key</span><span class="s1">: </span><span class="s0">&quot;nextToken&quot;</span><span class="s1">,</span>
    <span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s2">get</span><span class="s1">() {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">];</span>
    <span class="s1">}</span>
  <span class="s1">}, {</span>
    <span class="s2">key</span><span class="s1">: </span><span class="s0">&quot;prevToken&quot;</span><span class="s1">,</span>
    <span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s2">get</span><span class="s1">() {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">position </span><span class="s1">- </span><span class="s4">1</span><span class="s1">];</span>
    <span class="s1">}</span>
  <span class="s1">}]);</span>
  <span class="s3">return </span><span class="s2">Parser</span><span class="s1">;</span>
<span class="s1">}();</span>
<span class="s2">exports</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">] = </span><span class="s2">Parser</span><span class="s1">;</span>
<span class="s2">module</span><span class="s1">.</span><span class="s2">exports </span><span class="s1">= </span><span class="s2">exports</span><span class="s1">.</span><span class="s2">default</span><span class="s1">;</span></pre>
</body>
</html>