<html>
<head>
<title>inference.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
.s7 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
inference.js</font>
</center></td></tr></table>
<pre><span class="s0">/***********************************************************************</span>

  <span class="s0">A JavaScript tokenizer / parser / beautifier / compressor.</span>
  <span class="s0">https://github.com/mishoo/UglifyJS2</span>

  <span class="s0">-------------------------------- (C) ---------------------------------</span>

                           <span class="s0">Author: Mihai Bazon</span>
                         <span class="s0">&lt;mihai.bazon@gmail.com&gt;</span>
                       <span class="s0">http://mihai.bazon.net/blog</span>

  <span class="s0">Distributed under the BSD license:</span>

    <span class="s0">Copyright 2012 (c) Mihai Bazon &lt;mihai.bazon@gmail.com&gt;</span>

    <span class="s0">Redistribution and use in source and binary forms, with or without</span>
    <span class="s0">modification, are permitted provided that the following conditions</span>
    <span class="s0">are met:</span>

        <span class="s0">* Redistributions of source code must retain the above</span>
          <span class="s0">copyright notice, this list of conditions and the following</span>
          <span class="s0">disclaimer.</span>

        <span class="s0">* Redistributions in binary form must reproduce the above</span>
          <span class="s0">copyright notice, this list of conditions and the following</span>
          <span class="s0">disclaimer in the documentation and/or other materials</span>
          <span class="s0">provided with the distribution.</span>

    <span class="s0">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER “AS IS” AND ANY</span>
    <span class="s0">EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
    <span class="s0">IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span>
    <span class="s0">PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE</span>
    <span class="s0">LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,</span>
    <span class="s0">OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
    <span class="s0">PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
    <span class="s0">PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
    <span class="s0">THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR</span>
    <span class="s0">TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF</span>
    <span class="s0">THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
    <span class="s0">SUCH DAMAGE.</span>

 <span class="s0">***********************************************************************/</span>

<span class="s2">import </span><span class="s3">{</span>
  <span class="s1">AST_Array</span><span class="s3">,</span>
  <span class="s1">AST_Arrow</span><span class="s3">,</span>
  <span class="s1">AST_Assign</span><span class="s3">,</span>
  <span class="s1">AST_BigInt</span><span class="s3">,</span>
  <span class="s1">AST_Binary</span><span class="s3">,</span>
  <span class="s1">AST_Block</span><span class="s3">,</span>
  <span class="s1">AST_BlockStatement</span><span class="s3">,</span>
  <span class="s1">AST_Call</span><span class="s3">,</span>
  <span class="s1">AST_Case</span><span class="s3">,</span>
  <span class="s1">AST_Chain</span><span class="s3">,</span>
  <span class="s1">AST_Class</span><span class="s3">,</span>
  <span class="s1">AST_DefClass</span><span class="s3">,</span>
  <span class="s1">AST_ClassStaticBlock</span><span class="s3">,</span>
  <span class="s1">AST_ClassProperty</span><span class="s3">,</span>
  <span class="s1">AST_ConciseMethod</span><span class="s3">,</span>
  <span class="s1">AST_Conditional</span><span class="s3">,</span>
  <span class="s1">AST_Constant</span><span class="s3">,</span>
  <span class="s1">AST_Definitions</span><span class="s3">,</span>
  <span class="s1">AST_Dot</span><span class="s3">,</span>
  <span class="s1">AST_EmptyStatement</span><span class="s3">,</span>
  <span class="s1">AST_Expansion</span><span class="s3">,</span>
  <span class="s1">AST_False</span><span class="s3">,</span>
  <span class="s1">AST_ForIn</span><span class="s3">,</span>
  <span class="s1">AST_Function</span><span class="s3">,</span>
  <span class="s1">AST_If</span><span class="s3">,</span>
  <span class="s1">AST_Import</span><span class="s3">,</span>
  <span class="s1">AST_ImportMeta</span><span class="s3">,</span>
  <span class="s1">AST_Jump</span><span class="s3">,</span>
  <span class="s1">AST_LabeledStatement</span><span class="s3">,</span>
  <span class="s1">AST_Lambda</span><span class="s3">,</span>
  <span class="s1">AST_New</span><span class="s3">,</span>
  <span class="s1">AST_Node</span><span class="s3">,</span>
  <span class="s1">AST_Null</span><span class="s3">,</span>
  <span class="s1">AST_Number</span><span class="s3">,</span>
  <span class="s1">AST_Object</span><span class="s3">,</span>
  <span class="s1">AST_ObjectGetter</span><span class="s3">,</span>
  <span class="s1">AST_ObjectKeyVal</span><span class="s3">,</span>
  <span class="s1">AST_ObjectProperty</span><span class="s3">,</span>
  <span class="s1">AST_ObjectSetter</span><span class="s3">,</span>
  <span class="s1">AST_PropAccess</span><span class="s3">,</span>
  <span class="s1">AST_RegExp</span><span class="s3">,</span>
  <span class="s1">AST_Return</span><span class="s3">,</span>
  <span class="s1">AST_Scope</span><span class="s3">,</span>
  <span class="s1">AST_Sequence</span><span class="s3">,</span>
  <span class="s1">AST_SimpleStatement</span><span class="s3">,</span>
  <span class="s1">AST_Statement</span><span class="s3">,</span>
  <span class="s1">AST_String</span><span class="s3">,</span>
  <span class="s1">AST_Sub</span><span class="s3">,</span>
  <span class="s1">AST_Switch</span><span class="s3">,</span>
  <span class="s1">AST_SwitchBranch</span><span class="s3">,</span>
  <span class="s1">AST_SymbolClassProperty</span><span class="s3">,</span>
  <span class="s1">AST_SymbolDeclaration</span><span class="s3">,</span>
  <span class="s1">AST_SymbolRef</span><span class="s3">,</span>
  <span class="s1">AST_TemplateSegment</span><span class="s3">,</span>
  <span class="s1">AST_TemplateString</span><span class="s3">,</span>
  <span class="s1">AST_This</span><span class="s3">,</span>
  <span class="s1">AST_True</span><span class="s3">,</span>
  <span class="s1">AST_Try</span><span class="s3">,</span>
  <span class="s1">AST_Unary</span><span class="s3">,</span>
  <span class="s1">AST_UnaryPostfix</span><span class="s3">,</span>
  <span class="s1">AST_UnaryPrefix</span><span class="s3">,</span>
  <span class="s1">AST_Undefined</span><span class="s3">,</span>
  <span class="s1">AST_VarDef</span><span class="s3">,</span>

  <span class="s1">walk</span><span class="s3">,</span>
  <span class="s1">walk_abort</span><span class="s3">,</span>

  <span class="s1">_PURE</span>
<span class="s3">} </span><span class="s1">from </span><span class="s4">&quot;../ast.js&quot;</span><span class="s3">;</span>
<span class="s2">import </span><span class="s3">{</span>
    <span class="s1">makePredicate</span><span class="s3">,</span>
    <span class="s1">return_true</span><span class="s3">,</span>
    <span class="s1">return_false</span><span class="s3">,</span>
    <span class="s1">return_null</span><span class="s3">,</span>
    <span class="s1">return_this</span><span class="s3">,</span>
    <span class="s1">make_node</span><span class="s3">,</span>
    <span class="s1">member</span><span class="s3">,</span>
    <span class="s1">has_annotation</span><span class="s3">,</span>
<span class="s3">} </span><span class="s1">from </span><span class="s4">&quot;../utils/index.js&quot;</span><span class="s3">;</span>
<span class="s2">import </span><span class="s3">{ </span><span class="s1">make_sequence</span><span class="s3">, </span><span class="s1">best_of_expression</span><span class="s3">, </span><span class="s1">read_property </span><span class="s3">} </span><span class="s1">from </span><span class="s4">&quot;./common.js&quot;</span><span class="s3">;</span>

<span class="s2">import </span><span class="s3">{ </span><span class="s1">INLINED</span><span class="s3">, </span><span class="s1">UNDEFINED</span><span class="s3">, </span><span class="s1">has_flag </span><span class="s3">} </span><span class="s1">from </span><span class="s4">&quot;./compressor-flags.js&quot;</span><span class="s3">;</span>
<span class="s2">import </span><span class="s3">{ </span><span class="s1">pure_prop_access_globals</span><span class="s3">, </span><span class="s1">is_pure_native_fn</span><span class="s3">, </span><span class="s1">is_pure_native_method </span><span class="s3">} </span><span class="s1">from </span><span class="s4">&quot;./native-objects.js&quot;</span><span class="s3">;</span>

<span class="s5">// Functions and methods to infer certain facts about expressions</span>
<span class="s5">// It's not always possible to be 100% sure about something just by static analysis,</span>
<span class="s5">// so `true` means yes, and `false` means maybe</span>

<span class="s2">export const </span><span class="s1">is_undeclared_ref </span><span class="s3">= (</span><span class="s1">node</span><span class="s3">) =&gt;</span>
    <span class="s1">node </span><span class="s2">instanceof </span><span class="s1">AST_SymbolRef </span><span class="s3">&amp;&amp; </span><span class="s1">node</span><span class="s3">.</span><span class="s1">definition</span><span class="s3">().</span><span class="s1">undeclared</span><span class="s3">;</span>

<span class="s2">export const </span><span class="s1">lazy_op </span><span class="s3">= </span><span class="s1">makePredicate</span><span class="s3">(</span><span class="s4">&quot;&amp;&amp; || ??&quot;</span><span class="s3">);</span>
<span class="s2">export const </span><span class="s1">unary_side_effects </span><span class="s3">= </span><span class="s1">makePredicate</span><span class="s3">(</span><span class="s4">&quot;delete ++ --&quot;</span><span class="s3">);</span>

<span class="s5">// methods to determine whether an expression has a boolean result type</span>
<span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">def_is_boolean</span><span class="s3">) {</span>
    <span class="s2">const </span><span class="s1">unary_bool </span><span class="s3">= </span><span class="s1">makePredicate</span><span class="s3">(</span><span class="s4">&quot;! delete&quot;</span><span class="s3">);</span>
    <span class="s2">const </span><span class="s1">binary_bool </span><span class="s3">= </span><span class="s1">makePredicate</span><span class="s3">(</span><span class="s4">&quot;in instanceof == != === !== &lt; &lt;= &gt;= &gt;&quot;</span><span class="s3">);</span>
    <span class="s1">def_is_boolean</span><span class="s3">(</span><span class="s1">AST_Node</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_is_boolean</span><span class="s3">(</span><span class="s1">AST_UnaryPrefix</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return </span><span class="s1">unary_bool</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_is_boolean</span><span class="s3">(</span><span class="s1">AST_Binary</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return </span><span class="s1">binary_bool</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s1">lazy_op</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">)</span>
                <span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">left</span><span class="s3">.</span><span class="s1">is_boolean</span><span class="s3">()</span>
                <span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">is_boolean</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">def_is_boolean</span><span class="s3">(</span><span class="s1">AST_Conditional</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">consequent</span><span class="s3">.</span><span class="s1">is_boolean</span><span class="s3">() &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">.</span><span class="s1">is_boolean</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">def_is_boolean</span><span class="s3">(</span><span class="s1">AST_Assign</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;=&quot; </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">is_boolean</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">def_is_boolean</span><span class="s3">(</span><span class="s1">AST_Sequence</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">tail_node</span><span class="s3">().</span><span class="s1">is_boolean</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">def_is_boolean</span><span class="s3">(</span><span class="s1">AST_True</span><span class="s3">, </span><span class="s1">return_true</span><span class="s3">);</span>
    <span class="s1">def_is_boolean</span><span class="s3">(</span><span class="s1">AST_False</span><span class="s3">, </span><span class="s1">return_true</span><span class="s3">);</span>
<span class="s3">})(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">func</span><span class="s3">) {</span>
    <span class="s1">node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;is_boolean&quot;</span><span class="s3">, </span><span class="s1">func</span><span class="s3">);</span>
<span class="s3">});</span>

<span class="s5">// methods to determine if an expression has a numeric result type</span>
<span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">def_is_number</span><span class="s3">) {</span>
    <span class="s1">def_is_number</span><span class="s3">(</span><span class="s1">AST_Node</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_is_number</span><span class="s3">(</span><span class="s1">AST_Number</span><span class="s3">, </span><span class="s1">return_true</span><span class="s3">);</span>
    <span class="s2">const </span><span class="s1">unary </span><span class="s3">= </span><span class="s1">makePredicate</span><span class="s3">(</span><span class="s4">&quot;+ - ~ ++ --&quot;</span><span class="s3">);</span>
    <span class="s1">def_is_number</span><span class="s3">(</span><span class="s1">AST_Unary</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return </span><span class="s1">unary</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">) &amp;&amp; !(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression </span><span class="s2">instanceof </span><span class="s1">AST_BigInt</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s2">const </span><span class="s1">numeric_ops </span><span class="s3">= </span><span class="s1">makePredicate</span><span class="s3">(</span><span class="s4">&quot;- * / % &amp; | ^ &lt;&lt; &gt;&gt; &gt;&gt;&gt;&quot;</span><span class="s3">);</span>
    <span class="s1">def_is_number</span><span class="s3">(</span><span class="s1">AST_Binary</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">numeric_ops</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">) || </span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;+&quot;</span>
            <span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">left</span><span class="s3">.</span><span class="s1">is_number</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">is_number</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_is_number</span><span class="s3">(</span><span class="s1">AST_Assign</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">numeric_ops</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s6">0</span><span class="s3">, -</span><span class="s6">1</span><span class="s3">))</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;=&quot; </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">is_number</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_is_number</span><span class="s3">(</span><span class="s1">AST_Sequence</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">tail_node</span><span class="s3">().</span><span class="s1">is_number</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_is_number</span><span class="s3">(</span><span class="s1">AST_Conditional</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">consequent</span><span class="s3">.</span><span class="s1">is_number</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">.</span><span class="s1">is_number</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
<span class="s3">})(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">func</span><span class="s3">) {</span>
    <span class="s1">node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;is_number&quot;</span><span class="s3">, </span><span class="s1">func</span><span class="s3">);</span>
<span class="s3">});</span>

<span class="s5">// methods to determine if an expression has a string result type</span>
<span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">def_is_string</span><span class="s3">) {</span>
    <span class="s1">def_is_string</span><span class="s3">(</span><span class="s1">AST_Node</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_is_string</span><span class="s3">(</span><span class="s1">AST_String</span><span class="s3">, </span><span class="s1">return_true</span><span class="s3">);</span>
    <span class="s1">def_is_string</span><span class="s3">(</span><span class="s1">AST_TemplateString</span><span class="s3">, </span><span class="s1">return_true</span><span class="s3">);</span>
    <span class="s1">def_is_string</span><span class="s3">(</span><span class="s1">AST_UnaryPrefix</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;typeof&quot;</span><span class="s3">;</span>
    <span class="s3">});</span>
    <span class="s1">def_is_string</span><span class="s3">(</span><span class="s1">AST_Binary</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;+&quot; </span><span class="s3">&amp;&amp;</span>
            <span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">left</span><span class="s3">.</span><span class="s1">is_string</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) || </span><span class="s2">this</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">is_string</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">));</span>
    <span class="s3">});</span>
    <span class="s1">def_is_string</span><span class="s3">(</span><span class="s1">AST_Assign</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;=&quot; </span><span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;+=&quot;</span><span class="s3">) &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">is_string</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_is_string</span><span class="s3">(</span><span class="s1">AST_Sequence</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">tail_node</span><span class="s3">().</span><span class="s1">is_string</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_is_string</span><span class="s3">(</span><span class="s1">AST_Conditional</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">consequent</span><span class="s3">.</span><span class="s1">is_string</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">.</span><span class="s1">is_string</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
<span class="s3">})(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">func</span><span class="s3">) {</span>
    <span class="s1">node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;is_string&quot;</span><span class="s3">, </span><span class="s1">func</span><span class="s3">);</span>
<span class="s3">});</span>

<span class="s2">export function </span><span class="s1">is_undefined</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">) {</span>
    <span class="s2">return </span><span class="s3">(</span>
        <span class="s1">has_flag</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">UNDEFINED</span><span class="s3">)</span>
        <span class="s3">|| </span><span class="s1">node </span><span class="s2">instanceof </span><span class="s1">AST_Undefined</span>
        <span class="s3">|| </span><span class="s1">node </span><span class="s2">instanceof </span><span class="s1">AST_UnaryPrefix</span>
            <span class="s3">&amp;&amp; </span><span class="s1">node</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;void&quot;</span>
            <span class="s3">&amp;&amp; !</span><span class="s1">node</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
    <span class="s3">);</span>
<span class="s3">}</span>

<span class="s5">// Is the node explicitly null or undefined.</span>
<span class="s2">function </span><span class="s1">is_null_or_undefined</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">) {</span>
    <span class="s2">let </span><span class="s1">fixed</span><span class="s3">;</span>
    <span class="s2">return </span><span class="s3">(</span>
        <span class="s1">node </span><span class="s2">instanceof </span><span class="s1">AST_Null</span>
        <span class="s3">|| </span><span class="s1">is_undefined</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">)</span>
        <span class="s3">|| (</span>
            <span class="s1">node </span><span class="s2">instanceof </span><span class="s1">AST_SymbolRef</span>
            <span class="s3">&amp;&amp; (</span><span class="s1">fixed </span><span class="s3">= </span><span class="s1">node</span><span class="s3">.</span><span class="s1">definition</span><span class="s3">().</span><span class="s1">fixed</span><span class="s3">) </span><span class="s2">instanceof </span><span class="s1">AST_Node</span>
            <span class="s3">&amp;&amp; </span><span class="s1">is_nullish</span><span class="s3">(</span><span class="s1">fixed</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">)</span>
        <span class="s3">)</span>
    <span class="s3">);</span>
<span class="s3">}</span>

<span class="s5">// Find out if this expression is optionally chained from a base-point that we</span>
<span class="s5">// can statically analyze as null or undefined.</span>
<span class="s2">export function </span><span class="s1">is_nullish_shortcircuited</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">) {</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">node </span><span class="s2">instanceof </span><span class="s1">AST_PropAccess </span><span class="s3">|| </span><span class="s1">node </span><span class="s2">instanceof </span><span class="s1">AST_Call</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s3">(</span>
            <span class="s3">(</span><span class="s1">node</span><span class="s3">.</span><span class="s1">optional </span><span class="s3">&amp;&amp; </span><span class="s1">is_null_or_undefined</span><span class="s3">(</span><span class="s1">node</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">))</span>
            <span class="s3">|| </span><span class="s1">is_nullish_shortcircuited</span><span class="s3">(</span><span class="s1">node</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">)</span>
        <span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">node </span><span class="s2">instanceof </span><span class="s1">AST_Chain</span><span class="s3">) </span><span class="s2">return </span><span class="s1">is_nullish_shortcircuited</span><span class="s3">(</span><span class="s1">node</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s2">return false</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s5">// Find out if something is == null, or can short circuit into nullish.</span>
<span class="s5">// Used to optimize ?. and ??</span>
<span class="s2">export function </span><span class="s1">is_nullish</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">) {</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">is_null_or_undefined</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return true</span><span class="s3">;</span>
    <span class="s2">return </span><span class="s1">is_nullish_shortcircuited</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s5">// Determine if expression might cause side effects</span>
<span class="s5">// If there's a possibility that a node may change something when it's executed, this returns true</span>
<span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">def_has_side_effects</span><span class="s3">) {</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Node</span><span class="s3">, </span><span class="s1">return_true</span><span class="s3">);</span>

    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_EmptyStatement</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Constant</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_This</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>

    <span class="s2">function </span><span class="s1">any</span><span class="s3">(</span><span class="s1">list</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">for </span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s1">list</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; --</span><span class="s1">i </span><span class="s3">&gt;= </span><span class="s6">0</span><span class="s3">;)</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">list</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">))</span>
                <span class="s2">return true</span><span class="s3">;</span>
        <span class="s2">return false</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Block</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Call</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span>
            <span class="s3">!</span><span class="s2">this</span><span class="s3">.</span><span class="s1">is_callee_pure</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">&amp;&amp; (!</span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">is_call_pure</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
                <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">))</span>
        <span class="s3">) {</span>
            <span class="s2">return true</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">args</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Switch</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Case</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Try</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">bcatch </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">bcatch</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">bfinally </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">bfinally</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_If</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">condition</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">body </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">alternative </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_ImportMeta</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_LabeledStatement</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_SimpleStatement</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Lambda</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Class</span><span class="s3">, </span><span class="s2">function </span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">extends </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">extends</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) {</span>
            <span class="s2">return true</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">properties</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_ClassStaticBlock</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Binary</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">left</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Assign</span><span class="s3">, </span><span class="s1">return_true</span><span class="s3">);</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Conditional</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">condition</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">consequent</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Unary</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">unary_side_effects</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_SymbolRef</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s3">!</span><span class="s2">this</span><span class="s3">.</span><span class="s1">is_declared</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) &amp;&amp; !</span><span class="s1">pure_prop_access_globals</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">name</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_SymbolClassProperty</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_SymbolDeclaration</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Object</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">properties</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_ObjectProperty</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s3">(</span>
            <span class="s2">this</span><span class="s3">.</span><span class="s1">computed_key</span><span class="s3">() &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">value </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
        <span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_ClassProperty</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s3">(</span>
            <span class="s2">this</span><span class="s3">.</span><span class="s1">computed_key</span><span class="s3">() &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">static </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">value </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
        <span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_ConciseMethod</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">computed_key</span><span class="s3">() &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_ObjectGetter</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">computed_key</span><span class="s3">() &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_ObjectSetter</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">computed_key</span><span class="s3">() &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Array</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">elements</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Dot</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">is_nullish</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">)) {</span>
            <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s2">if </span><span class="s3">(!</span><span class="s2">this</span><span class="s3">.</span><span class="s1">optional </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">may_throw_on_access</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) {</span>
            <span class="s2">return true</span><span class="s3">;</span>
        <span class="s3">}</span>

        <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Sub</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">is_nullish</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">)) {</span>
            <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s2">if </span><span class="s3">(!</span><span class="s2">this</span><span class="s3">.</span><span class="s1">optional </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">may_throw_on_access</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) {</span>
            <span class="s2">return true</span><span class="s3">;</span>
        <span class="s3">}</span>

        <span class="s2">var </span><span class="s1">property </span><span class="s3">= </span><span class="s2">this</span><span class="s3">.</span><span class="s1">property</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">property </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">optional</span><span class="s3">) </span><span class="s2">return true</span><span class="s3">; </span><span class="s5">// &quot;?.&quot; is a condition</span>

        <span class="s2">return </span><span class="s1">property </span><span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Chain</span><span class="s3">, </span><span class="s2">function </span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">has_side_effects</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Sequence</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">expressions</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_Definitions</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">definitions</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_VarDef</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">;</span>
    <span class="s3">});</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_TemplateSegment</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_has_side_effects</span><span class="s3">(</span><span class="s1">AST_TemplateString</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">segments</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
<span class="s3">})(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">func</span><span class="s3">) {</span>
    <span class="s1">node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;has_side_effects&quot;</span><span class="s3">, </span><span class="s1">func</span><span class="s3">);</span>
<span class="s3">});</span>

<span class="s5">// determine if expression may throw</span>
<span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">def_may_throw</span><span class="s3">) {</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Node</span><span class="s3">, </span><span class="s1">return_true</span><span class="s3">);</span>

    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Constant</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_EmptyStatement</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Lambda</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_SymbolDeclaration</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_This</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_ImportMeta</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>

    <span class="s2">function </span><span class="s1">any</span><span class="s3">(</span><span class="s1">list</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">for </span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s1">list</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; --</span><span class="s1">i </span><span class="s3">&gt;= </span><span class="s6">0</span><span class="s3">;)</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">list</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">))</span>
                <span class="s2">return true</span><span class="s3">;</span>
        <span class="s2">return false</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Class</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">extends </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">extends</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return true</span><span class="s3">;</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">properties</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_ClassStaticBlock</span><span class="s3">, </span><span class="s2">function </span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Array</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">elements</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Assign</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return true</span><span class="s3">;</span>
        <span class="s2">if </span><span class="s3">(!</span><span class="s1">compressor</span><span class="s3">.</span><span class="s1">has_directive</span><span class="s3">(</span><span class="s4">&quot;use strict&quot;</span><span class="s3">)</span>
            <span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;=&quot;</span>
            <span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">left </span><span class="s2">instanceof </span><span class="s1">AST_SymbolRef</span><span class="s3">) {</span>
            <span class="s2">return false</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">left</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Binary</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">left</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Block</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Call</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">is_nullish</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return false</span><span class="s3">;</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">args</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return true</span><span class="s3">;</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">is_callee_pure</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return false</span><span class="s3">;</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return true</span><span class="s3">;</span>
        <span class="s2">return </span><span class="s3">!(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression </span><span class="s2">instanceof </span><span class="s1">AST_Lambda</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Case</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Conditional</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">condition</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">consequent</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Definitions</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">definitions</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_If</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">condition</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">body </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">alternative </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_LabeledStatement</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Object</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">properties</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_ObjectProperty</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s5">// TODO key may throw too</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">value </span><span class="s3">? </span><span class="s2">this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) : </span><span class="s2">false</span><span class="s3">;</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_ClassProperty</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s3">(</span>
            <span class="s2">this</span><span class="s3">.</span><span class="s1">computed_key</span><span class="s3">() &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">static </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">value </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
        <span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_ConciseMethod</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">computed_key</span><span class="s3">() &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_ObjectGetter</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">computed_key</span><span class="s3">() &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_ObjectSetter</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">computed_key</span><span class="s3">() &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Return</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">value </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Sequence</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">expressions</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_SimpleStatement</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Dot</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">is_nullish</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return false</span><span class="s3">;</span>
        <span class="s2">return </span><span class="s3">!</span><span class="s2">this</span><span class="s3">.</span><span class="s1">optional </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">may_throw_on_access</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Sub</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">is_nullish</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return false</span><span class="s3">;</span>
        <span class="s2">return </span><span class="s3">!</span><span class="s2">this</span><span class="s3">.</span><span class="s1">optional </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">may_throw_on_access</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">property</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Chain</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Switch</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s1">any</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_SymbolRef</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s3">!</span><span class="s2">this</span><span class="s3">.</span><span class="s1">is_declared</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) &amp;&amp; !</span><span class="s1">pure_prop_access_globals</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">name</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_SymbolClassProperty</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Try</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">bcatch </span><span class="s3">? </span><span class="s2">this</span><span class="s3">.</span><span class="s1">bcatch</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) : </span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">bfinally </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">bfinally</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_Unary</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;typeof&quot; </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression </span><span class="s2">instanceof </span><span class="s1">AST_SymbolRef</span><span class="s3">)</span>
            <span class="s2">return false</span><span class="s3">;</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw</span><span class="s3">(</span><span class="s1">AST_VarDef</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(!</span><span class="s2">this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">) </span><span class="s2">return false</span><span class="s3">;</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">may_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
<span class="s3">})(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">func</span><span class="s3">) {</span>
    <span class="s1">node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;may_throw&quot;</span><span class="s3">, </span><span class="s1">func</span><span class="s3">);</span>
<span class="s3">});</span>

<span class="s5">// determine if expression is constant</span>
<span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">def_is_constant_expression</span><span class="s3">) {</span>
    <span class="s2">function </span><span class="s1">all_refs_local</span><span class="s3">(</span><span class="s1">scope</span><span class="s3">) {</span>
        <span class="s2">let </span><span class="s1">result </span><span class="s3">= </span><span class="s2">true</span><span class="s3">;</span>
        <span class="s1">walk</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">node </span><span class="s3">=&gt; {</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">node </span><span class="s2">instanceof </span><span class="s1">AST_SymbolRef</span><span class="s3">) {</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">has_flag</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">INLINED</span><span class="s3">)) {</span>
                    <span class="s1">result </span><span class="s3">= </span><span class="s2">false</span><span class="s3">;</span>
                    <span class="s2">return </span><span class="s1">walk_abort</span><span class="s3">;</span>
                <span class="s3">}</span>
                <span class="s2">var </span><span class="s1">def </span><span class="s3">= </span><span class="s1">node</span><span class="s3">.</span><span class="s1">definition</span><span class="s3">();</span>
                <span class="s2">if </span><span class="s3">(</span>
                    <span class="s1">member</span><span class="s3">(</span><span class="s1">def</span><span class="s3">, </span><span class="s2">this</span><span class="s3">.</span><span class="s1">enclosed</span><span class="s3">)</span>
                    <span class="s3">&amp;&amp; !</span><span class="s2">this</span><span class="s3">.</span><span class="s1">variables</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">def</span><span class="s3">.</span><span class="s1">name</span><span class="s3">)</span>
                <span class="s3">) {</span>
                    <span class="s2">if </span><span class="s3">(</span><span class="s1">scope</span><span class="s3">) {</span>
                        <span class="s2">var </span><span class="s1">scope_def </span><span class="s3">= </span><span class="s1">scope</span><span class="s3">.</span><span class="s1">find_variable</span><span class="s3">(</span><span class="s1">node</span><span class="s3">);</span>
                        <span class="s2">if </span><span class="s3">(</span><span class="s1">def</span><span class="s3">.</span><span class="s1">undeclared </span><span class="s3">? !</span><span class="s1">scope_def </span><span class="s3">: </span><span class="s1">scope_def </span><span class="s3">=== </span><span class="s1">def</span><span class="s3">) {</span>
                            <span class="s1">result </span><span class="s3">= </span><span class="s4">&quot;f&quot;</span><span class="s3">;</span>
                            <span class="s2">return true</span><span class="s3">;</span>
                        <span class="s3">}</span>
                    <span class="s3">}</span>
                    <span class="s1">result </span><span class="s3">= </span><span class="s2">false</span><span class="s3">;</span>
                    <span class="s2">return </span><span class="s1">walk_abort</span><span class="s3">;</span>
                <span class="s3">}</span>
                <span class="s2">return true</span><span class="s3">;</span>
            <span class="s3">}</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">node </span><span class="s2">instanceof </span><span class="s1">AST_This </span><span class="s3">&amp;&amp; </span><span class="s2">this instanceof </span><span class="s1">AST_Arrow</span><span class="s3">) {</span>
                <span class="s1">result </span><span class="s3">= </span><span class="s2">false</span><span class="s3">;</span>
                <span class="s2">return </span><span class="s1">walk_abort</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">});</span>
        <span class="s2">return </span><span class="s1">result</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s1">def_is_constant_expression</span><span class="s3">(</span><span class="s1">AST_Node</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_is_constant_expression</span><span class="s3">(</span><span class="s1">AST_Constant</span><span class="s3">, </span><span class="s1">return_true</span><span class="s3">);</span>
    <span class="s1">def_is_constant_expression</span><span class="s3">(</span><span class="s1">AST_Class</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">scope</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">extends </span><span class="s3">&amp;&amp; !</span><span class="s2">this</span><span class="s3">.</span><span class="s1">extends</span><span class="s3">.</span><span class="s1">is_constant_expression</span><span class="s3">(</span><span class="s1">scope</span><span class="s3">)) {</span>
            <span class="s2">return false</span><span class="s3">;</span>
        <span class="s3">}</span>

        <span class="s2">for </span><span class="s3">(</span><span class="s2">const </span><span class="s1">prop of </span><span class="s2">this</span><span class="s3">.</span><span class="s1">properties</span><span class="s3">) {</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">prop</span><span class="s3">.</span><span class="s1">computed_key</span><span class="s3">() &amp;&amp; !</span><span class="s1">prop</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">is_constant_expression</span><span class="s3">(</span><span class="s1">scope</span><span class="s3">)) {</span>
                <span class="s2">return false</span><span class="s3">;</span>
            <span class="s3">}</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">prop</span><span class="s3">.</span><span class="s1">static </span><span class="s3">&amp;&amp; </span><span class="s1">prop</span><span class="s3">.</span><span class="s1">value </span><span class="s3">&amp;&amp; !</span><span class="s1">prop</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">is_constant_expression</span><span class="s3">(</span><span class="s1">scope</span><span class="s3">)) {</span>
                <span class="s2">return false</span><span class="s3">;</span>
            <span class="s3">}</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">prop </span><span class="s2">instanceof </span><span class="s1">AST_ClassStaticBlock</span><span class="s3">) {</span>
                <span class="s2">return false</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>

        <span class="s2">return </span><span class="s1">all_refs_local</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">scope</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_is_constant_expression</span><span class="s3">(</span><span class="s1">AST_Lambda</span><span class="s3">, </span><span class="s1">all_refs_local</span><span class="s3">);</span>
    <span class="s1">def_is_constant_expression</span><span class="s3">(</span><span class="s1">AST_Unary</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">is_constant_expression</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">def_is_constant_expression</span><span class="s3">(</span><span class="s1">AST_Binary</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">left</span><span class="s3">.</span><span class="s1">is_constant_expression</span><span class="s3">()</span>
            <span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">is_constant_expression</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">def_is_constant_expression</span><span class="s3">(</span><span class="s1">AST_Array</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">elements</span><span class="s3">.</span><span class="s1">every</span><span class="s3">((</span><span class="s1">l</span><span class="s3">) =&gt; </span><span class="s1">l</span><span class="s3">.</span><span class="s1">is_constant_expression</span><span class="s3">());</span>
    <span class="s3">});</span>
    <span class="s1">def_is_constant_expression</span><span class="s3">(</span><span class="s1">AST_Object</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">properties</span><span class="s3">.</span><span class="s1">every</span><span class="s3">((</span><span class="s1">l</span><span class="s3">) =&gt; </span><span class="s1">l</span><span class="s3">.</span><span class="s1">is_constant_expression</span><span class="s3">());</span>
    <span class="s3">});</span>
    <span class="s1">def_is_constant_expression</span><span class="s3">(</span><span class="s1">AST_ObjectProperty</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return </span><span class="s3">!!(!(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">key </span><span class="s2">instanceof </span><span class="s1">AST_Node</span><span class="s3">) &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">value </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">is_constant_expression</span><span class="s3">());</span>
    <span class="s3">});</span>
<span class="s3">})(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">func</span><span class="s3">) {</span>
    <span class="s1">node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;is_constant_expression&quot;</span><span class="s3">, </span><span class="s1">func</span><span class="s3">);</span>
<span class="s3">});</span>


<span class="s5">// may_throw_on_access()</span>
<span class="s5">// returns true if this node may be null, undefined or contain `AST_Accessor`</span>
<span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">def_may_throw_on_access</span><span class="s3">) {</span>
    <span class="s1">AST_Node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;may_throw_on_access&quot;</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s3">!</span><span class="s1">compressor</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s4">&quot;pure_getters&quot;</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">_dot_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s2">function </span><span class="s1">is_strict</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s7">/strict/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s4">&quot;pure_getters&quot;</span><span class="s3">));</span>
    <span class="s3">}</span>

    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Node</span><span class="s3">, </span><span class="s1">is_strict</span><span class="s3">);</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Null</span><span class="s3">, </span><span class="s1">return_true</span><span class="s3">);</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Undefined</span><span class="s3">, </span><span class="s1">return_true</span><span class="s3">);</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Constant</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Array</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Object</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(!</span><span class="s1">is_strict</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return false</span><span class="s3">;</span>
        <span class="s2">for </span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s2">this</span><span class="s3">.</span><span class="s1">properties</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; --</span><span class="s1">i </span><span class="s3">&gt;=</span><span class="s6">0</span><span class="s3">;)</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">properties</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">_dot_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return true</span><span class="s3">;</span>
        <span class="s2">return false</span><span class="s3">;</span>
    <span class="s3">});</span>
    <span class="s5">// Do not be as strict with classes as we are with objects.</span>
    <span class="s5">// Hopefully the community is not going to abuse static getters and setters.</span>
    <span class="s5">// https://github.com/terser/terser/issues/724#issuecomment-643655656</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Class</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_ObjectProperty</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_ObjectGetter</span><span class="s3">, </span><span class="s1">return_true</span><span class="s3">);</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Expansion</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">_dot_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Function</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Arrow</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_UnaryPostfix</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_UnaryPrefix</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;void&quot;</span><span class="s3">;</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Binary</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;&amp;&amp;&quot; </span><span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;||&quot; </span><span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;??&quot;</span><span class="s3">)</span>
            <span class="s3">&amp;&amp; (</span><span class="s2">this</span><span class="s3">.</span><span class="s1">left</span><span class="s3">.</span><span class="s1">_dot_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) || </span><span class="s2">this</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">_dot_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">));</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Assign</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">logical</span><span class="s3">) </span><span class="s2">return true</span><span class="s3">;</span>

        <span class="s2">return this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;=&quot;</span>
            <span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">_dot_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Conditional</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">consequent</span><span class="s3">.</span><span class="s1">_dot_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">.</span><span class="s1">_dot_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Dot</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(!</span><span class="s1">is_strict</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return false</span><span class="s3">;</span>

        <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">property </span><span class="s3">== </span><span class="s4">&quot;prototype&quot;</span><span class="s3">) {</span>
            <span class="s2">return </span><span class="s3">!(</span>
                <span class="s2">this</span><span class="s3">.</span><span class="s1">expression </span><span class="s2">instanceof </span><span class="s1">AST_Function</span>
                <span class="s3">|| </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression </span><span class="s2">instanceof </span><span class="s1">AST_Class</span>
            <span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s2">return true</span><span class="s3">;</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Chain</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">_dot_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_Sequence</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">tail_node</span><span class="s3">().</span><span class="s1">_dot_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_may_throw_on_access</span><span class="s3">(</span><span class="s1">AST_SymbolRef</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">name </span><span class="s3">=== </span><span class="s4">&quot;arguments&quot; </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">scope </span><span class="s2">instanceof </span><span class="s1">AST_Lambda</span><span class="s3">) </span><span class="s2">return false</span><span class="s3">;</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">has_flag</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">UNDEFINED</span><span class="s3">)) </span><span class="s2">return true</span><span class="s3">;</span>
        <span class="s2">if </span><span class="s3">(!</span><span class="s1">is_strict</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return false</span><span class="s3">;</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">is_undeclared_ref</span><span class="s3">(</span><span class="s2">this</span><span class="s3">) &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">is_declared</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) </span><span class="s2">return false</span><span class="s3">;</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">is_immutable</span><span class="s3">()) </span><span class="s2">return false</span><span class="s3">;</span>
        <span class="s2">var </span><span class="s1">fixed </span><span class="s3">= </span><span class="s2">this</span><span class="s3">.</span><span class="s1">fixed_value</span><span class="s3">();</span>
        <span class="s2">return </span><span class="s3">!</span><span class="s1">fixed </span><span class="s3">|| </span><span class="s1">fixed</span><span class="s3">.</span><span class="s1">_dot_throw</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
    <span class="s3">});</span>
<span class="s3">})(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">func</span><span class="s3">) {</span>
    <span class="s1">node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;_dot_throw&quot;</span><span class="s3">, </span><span class="s1">func</span><span class="s3">);</span>
<span class="s3">});</span>

<span class="s2">export function </span><span class="s1">is_lhs</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">parent</span><span class="s3">) {</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">parent </span><span class="s2">instanceof </span><span class="s1">AST_Unary </span><span class="s3">&amp;&amp; </span><span class="s1">unary_side_effects</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">)) </span><span class="s2">return </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">;</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">parent </span><span class="s2">instanceof </span><span class="s1">AST_Assign </span><span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">left </span><span class="s3">=== </span><span class="s1">node</span><span class="s3">) </span><span class="s2">return </span><span class="s1">node</span><span class="s3">;</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">parent </span><span class="s2">instanceof </span><span class="s1">AST_ForIn </span><span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">init </span><span class="s3">=== </span><span class="s1">node</span><span class="s3">) </span><span class="s2">return </span><span class="s1">node</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s5">// method to negate an expression</span>
<span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">def_negate</span><span class="s3">) {</span>
    <span class="s2">function </span><span class="s1">basic_negation</span><span class="s3">(</span><span class="s1">exp</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">make_node</span><span class="s3">(</span><span class="s1">AST_UnaryPrefix</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">, {</span>
            <span class="s1">operator</span><span class="s3">: </span><span class="s4">&quot;!&quot;</span><span class="s3">,</span>
            <span class="s1">expression</span><span class="s3">: </span><span class="s1">exp</span>
        <span class="s3">});</span>
    <span class="s3">}</span>
    <span class="s2">function </span><span class="s1">best</span><span class="s3">(</span><span class="s1">orig</span><span class="s3">, </span><span class="s1">alt</span><span class="s3">, </span><span class="s1">first_in_statement</span><span class="s3">) {</span>
        <span class="s2">var </span><span class="s1">negated </span><span class="s3">= </span><span class="s1">basic_negation</span><span class="s3">(</span><span class="s1">orig</span><span class="s3">);</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">first_in_statement</span><span class="s3">) {</span>
            <span class="s2">var </span><span class="s1">stat </span><span class="s3">= </span><span class="s1">make_node</span><span class="s3">(</span><span class="s1">AST_SimpleStatement</span><span class="s3">, </span><span class="s1">alt</span><span class="s3">, {</span>
                <span class="s1">body</span><span class="s3">: </span><span class="s1">alt</span>
            <span class="s3">});</span>
            <span class="s2">return </span><span class="s1">best_of_expression</span><span class="s3">(</span><span class="s1">negated</span><span class="s3">, </span><span class="s1">stat</span><span class="s3">) === </span><span class="s1">stat </span><span class="s3">? </span><span class="s1">alt </span><span class="s3">: </span><span class="s1">negated</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s2">return </span><span class="s1">best_of_expression</span><span class="s3">(</span><span class="s1">negated</span><span class="s3">, </span><span class="s1">alt</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s1">def_negate</span><span class="s3">(</span><span class="s1">AST_Node</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return </span><span class="s1">basic_negation</span><span class="s3">(</span><span class="s2">this</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_negate</span><span class="s3">(</span><span class="s1">AST_Statement</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">throw new </span><span class="s1">Error</span><span class="s3">(</span><span class="s4">&quot;Cannot negate a statement&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_negate</span><span class="s3">(</span><span class="s1">AST_Function</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return </span><span class="s1">basic_negation</span><span class="s3">(</span><span class="s2">this</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_negate</span><span class="s3">(</span><span class="s1">AST_Class</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return </span><span class="s1">basic_negation</span><span class="s3">(</span><span class="s2">this</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_negate</span><span class="s3">(</span><span class="s1">AST_Arrow</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return </span><span class="s1">basic_negation</span><span class="s3">(</span><span class="s2">this</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_negate</span><span class="s3">(</span><span class="s1">AST_UnaryPrefix</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s4">&quot;!&quot;</span><span class="s3">)</span>
            <span class="s2">return this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">;</span>
        <span class="s2">return </span><span class="s1">basic_negation</span><span class="s3">(</span><span class="s2">this</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_negate</span><span class="s3">(</span><span class="s1">AST_Sequence</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
        <span class="s2">var </span><span class="s1">expressions </span><span class="s3">= </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expressions</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">();</span>
        <span class="s1">expressions</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">expressions</span><span class="s3">.</span><span class="s1">pop</span><span class="s3">().</span><span class="s1">negate</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">));</span>
        <span class="s2">return </span><span class="s1">make_sequence</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">expressions</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_negate</span><span class="s3">(</span><span class="s1">AST_Conditional</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">, </span><span class="s1">first_in_statement</span><span class="s3">) {</span>
        <span class="s2">var </span><span class="s1">self </span><span class="s3">= </span><span class="s2">this</span><span class="s3">.</span><span class="s1">clone</span><span class="s3">();</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">consequent </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">consequent</span><span class="s3">.</span><span class="s1">negate</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">alternative </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">.</span><span class="s1">negate</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
        <span class="s2">return </span><span class="s1">best</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">self</span><span class="s3">, </span><span class="s1">first_in_statement</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">def_negate</span><span class="s3">(</span><span class="s1">AST_Binary</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">, </span><span class="s1">first_in_statement</span><span class="s3">) {</span>
        <span class="s2">var </span><span class="s1">self </span><span class="s3">= </span><span class="s2">this</span><span class="s3">.</span><span class="s1">clone</span><span class="s3">(), </span><span class="s1">op </span><span class="s3">= </span><span class="s2">this</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">;</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s4">&quot;unsafe_comps&quot;</span><span class="s3">)) {</span>
            <span class="s2">switch </span><span class="s3">(</span><span class="s1">op</span><span class="s3">) {</span>
              <span class="s2">case </span><span class="s4">&quot;&lt;=&quot; </span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">= </span><span class="s4">&quot;&gt;&quot;  </span><span class="s3">; </span><span class="s2">return </span><span class="s1">self</span><span class="s3">;</span>
              <span class="s2">case </span><span class="s4">&quot;&lt;&quot;  </span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">= </span><span class="s4">&quot;&gt;=&quot; </span><span class="s3">; </span><span class="s2">return </span><span class="s1">self</span><span class="s3">;</span>
              <span class="s2">case </span><span class="s4">&quot;&gt;=&quot; </span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">= </span><span class="s4">&quot;&lt;&quot;  </span><span class="s3">; </span><span class="s2">return </span><span class="s1">self</span><span class="s3">;</span>
              <span class="s2">case </span><span class="s4">&quot;&gt;&quot;  </span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">= </span><span class="s4">&quot;&lt;=&quot; </span><span class="s3">; </span><span class="s2">return </span><span class="s1">self</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s2">switch </span><span class="s3">(</span><span class="s1">op</span><span class="s3">) {</span>
          <span class="s2">case </span><span class="s4">&quot;==&quot; </span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">= </span><span class="s4">&quot;!=&quot;</span><span class="s3">; </span><span class="s2">return </span><span class="s1">self</span><span class="s3">;</span>
          <span class="s2">case </span><span class="s4">&quot;!=&quot; </span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">= </span><span class="s4">&quot;==&quot;</span><span class="s3">; </span><span class="s2">return </span><span class="s1">self</span><span class="s3">;</span>
          <span class="s2">case </span><span class="s4">&quot;===&quot;</span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">= </span><span class="s4">&quot;!==&quot;</span><span class="s3">; </span><span class="s2">return </span><span class="s1">self</span><span class="s3">;</span>
          <span class="s2">case </span><span class="s4">&quot;!==&quot;</span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">= </span><span class="s4">&quot;===&quot;</span><span class="s3">; </span><span class="s2">return </span><span class="s1">self</span><span class="s3">;</span>
          <span class="s2">case </span><span class="s4">&quot;&amp;&amp;&quot;</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">= </span><span class="s4">&quot;||&quot;</span><span class="s3">;</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">left </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">left</span><span class="s3">.</span><span class="s1">negate</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">, </span><span class="s1">first_in_statement</span><span class="s3">);</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">right </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">negate</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
            <span class="s2">return </span><span class="s1">best</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">self</span><span class="s3">, </span><span class="s1">first_in_statement</span><span class="s3">);</span>
          <span class="s2">case </span><span class="s4">&quot;||&quot;</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">= </span><span class="s4">&quot;&amp;&amp;&quot;</span><span class="s3">;</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">left </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">left</span><span class="s3">.</span><span class="s1">negate</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">, </span><span class="s1">first_in_statement</span><span class="s3">);</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">right </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">negate</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">);</span>
            <span class="s2">return </span><span class="s1">best</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">self</span><span class="s3">, </span><span class="s1">first_in_statement</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s2">return </span><span class="s1">basic_negation</span><span class="s3">(</span><span class="s2">this</span><span class="s3">);</span>
    <span class="s3">});</span>
<span class="s3">})(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">func</span><span class="s3">) {</span>
    <span class="s1">node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;negate&quot;</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">, </span><span class="s1">first_in_statement</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">func</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">compressor</span><span class="s3">, </span><span class="s1">first_in_statement</span><span class="s3">);</span>
    <span class="s3">});</span>
<span class="s3">});</span>

<span class="s5">// Is the callee of this function pure?</span>
<span class="s2">var </span><span class="s1">global_pure_fns </span><span class="s3">= </span><span class="s1">makePredicate</span><span class="s3">(</span><span class="s4">&quot;Boolean decodeURI decodeURIComponent Date encodeURI encodeURIComponent Error escape EvalError isFinite isNaN Number Object parseFloat parseInt RangeError ReferenceError String SyntaxError TypeError unescape URIError&quot;</span><span class="s3">);</span>
<span class="s1">AST_Call</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;is_callee_pure&quot;</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s4">&quot;unsafe&quot;</span><span class="s3">)) {</span>
        <span class="s2">var </span><span class="s1">expr </span><span class="s3">= </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">;</span>
        <span class="s2">var </span><span class="s1">first_arg </span><span class="s3">= (</span><span class="s2">this</span><span class="s3">.</span><span class="s1">args </span><span class="s3">&amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">args</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] &amp;&amp; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">args</span><span class="s3">[</span><span class="s6">0</span><span class="s3">].</span><span class="s1">evaluate</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">));</span>
        <span class="s2">if </span><span class="s3">(</span>
            <span class="s1">expr</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">&amp;&amp; </span><span class="s1">expr</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">name </span><span class="s3">=== </span><span class="s4">&quot;hasOwnProperty&quot; </span><span class="s3">&amp;&amp;</span>
            <span class="s3">(</span><span class="s1">first_arg </span><span class="s3">== </span><span class="s2">null </span><span class="s3">|| </span><span class="s1">first_arg</span><span class="s3">.</span><span class="s1">thedef </span><span class="s3">&amp;&amp; </span><span class="s1">first_arg</span><span class="s3">.</span><span class="s1">thedef</span><span class="s3">.</span><span class="s1">undeclared</span><span class="s3">)</span>
        <span class="s3">) {</span>
            <span class="s2">return false</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">is_undeclared_ref</span><span class="s3">(</span><span class="s1">expr</span><span class="s3">) &amp;&amp; </span><span class="s1">global_pure_fns</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">expr</span><span class="s3">.</span><span class="s1">name</span><span class="s3">)) </span><span class="s2">return true</span><span class="s3">;</span>
        <span class="s2">if </span><span class="s3">(</span>
            <span class="s1">expr </span><span class="s2">instanceof </span><span class="s1">AST_Dot</span>
            <span class="s3">&amp;&amp; </span><span class="s1">is_undeclared_ref</span><span class="s3">(</span><span class="s1">expr</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">)</span>
            <span class="s3">&amp;&amp; </span><span class="s1">is_pure_native_fn</span><span class="s3">(</span><span class="s1">expr</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">name</span><span class="s3">, </span><span class="s1">expr</span><span class="s3">.</span><span class="s1">property</span><span class="s3">)</span>
        <span class="s3">) {</span>
            <span class="s2">return true</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s2">return </span><span class="s3">!!</span><span class="s1">has_annotation</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">_PURE</span><span class="s3">) || !</span><span class="s1">compressor</span><span class="s3">.</span><span class="s1">pure_funcs</span><span class="s3">(</span><span class="s2">this</span><span class="s3">);</span>
<span class="s3">});</span>

<span class="s5">// If I call this, is it a pure function?</span>
<span class="s1">AST_Node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;is_call_pure&quot;</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>
<span class="s1">AST_Dot</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;is_call_pure&quot;</span><span class="s3">, </span><span class="s2">function</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">) {</span>
    <span class="s2">if </span><span class="s3">(!</span><span class="s1">compressor</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s4">&quot;unsafe&quot;</span><span class="s3">)) </span><span class="s2">return</span><span class="s3">;</span>
    <span class="s2">const </span><span class="s1">expr </span><span class="s3">= </span><span class="s2">this</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">;</span>

    <span class="s2">let </span><span class="s1">native_obj</span><span class="s3">;</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">expr </span><span class="s2">instanceof </span><span class="s1">AST_Array</span><span class="s3">) {</span>
        <span class="s1">native_obj </span><span class="s3">= </span><span class="s4">&quot;Array&quot;</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">expr</span><span class="s3">.</span><span class="s1">is_boolean</span><span class="s3">()) {</span>
        <span class="s1">native_obj </span><span class="s3">= </span><span class="s4">&quot;Boolean&quot;</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">expr</span><span class="s3">.</span><span class="s1">is_number</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) {</span>
        <span class="s1">native_obj </span><span class="s3">= </span><span class="s4">&quot;Number&quot;</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">expr </span><span class="s2">instanceof </span><span class="s1">AST_RegExp</span><span class="s3">) {</span>
        <span class="s1">native_obj </span><span class="s3">= </span><span class="s4">&quot;RegExp&quot;</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(</span><span class="s1">expr</span><span class="s3">.</span><span class="s1">is_string</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) {</span>
        <span class="s1">native_obj </span><span class="s3">= </span><span class="s4">&quot;String&quot;</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s2">else if </span><span class="s3">(!</span><span class="s2">this</span><span class="s3">.</span><span class="s1">may_throw_on_access</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)) {</span>
        <span class="s1">native_obj </span><span class="s3">= </span><span class="s4">&quot;Object&quot;</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s2">return </span><span class="s1">native_obj </span><span class="s3">!= </span><span class="s2">null </span><span class="s3">&amp;&amp; </span><span class="s1">is_pure_native_method</span><span class="s3">(</span><span class="s1">native_obj</span><span class="s3">, </span><span class="s2">this</span><span class="s3">.</span><span class="s1">property</span><span class="s3">);</span>
<span class="s3">});</span>

<span class="s5">// tell me if a statement aborts</span>
<span class="s2">export const </span><span class="s1">aborts </span><span class="s3">= (</span><span class="s1">thing</span><span class="s3">) =&gt; </span><span class="s1">thing </span><span class="s3">&amp;&amp; </span><span class="s1">thing</span><span class="s3">.</span><span class="s1">aborts</span><span class="s3">();</span>

<span class="s3">(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">def_aborts</span><span class="s3">) {</span>
    <span class="s1">def_aborts</span><span class="s3">(</span><span class="s1">AST_Statement</span><span class="s3">, </span><span class="s1">return_null</span><span class="s3">);</span>
    <span class="s1">def_aborts</span><span class="s3">(</span><span class="s1">AST_Jump</span><span class="s3">, </span><span class="s1">return_this</span><span class="s3">);</span>
    <span class="s2">function </span><span class="s1">block_aborts</span><span class="s3">() {</span>
        <span class="s2">for </span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; </span><span class="s1">i</span><span class="s3">++) {</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">aborts</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])) {</span>
                <span class="s2">return this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s2">return null</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s1">def_aborts</span><span class="s3">(</span><span class="s1">AST_Import</span><span class="s3">, </span><span class="s1">return_null</span><span class="s3">);</span>
    <span class="s1">def_aborts</span><span class="s3">(</span><span class="s1">AST_BlockStatement</span><span class="s3">, </span><span class="s1">block_aborts</span><span class="s3">);</span>
    <span class="s1">def_aborts</span><span class="s3">(</span><span class="s1">AST_SwitchBranch</span><span class="s3">, </span><span class="s1">block_aborts</span><span class="s3">);</span>
    <span class="s1">def_aborts</span><span class="s3">(</span><span class="s1">AST_DefClass</span><span class="s3">, </span><span class="s2">function </span><span class="s3">() {</span>
        <span class="s2">for </span><span class="s3">(</span><span class="s2">const </span><span class="s1">prop of </span><span class="s2">this</span><span class="s3">.</span><span class="s1">properties</span><span class="s3">) {</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">prop </span><span class="s2">instanceof </span><span class="s1">AST_ClassStaticBlock</span><span class="s3">) {</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">prop</span><span class="s3">.</span><span class="s1">aborts</span><span class="s3">()) </span><span class="s2">return </span><span class="s1">prop</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s2">return null</span><span class="s3">;</span>
    <span class="s3">});</span>
    <span class="s1">def_aborts</span><span class="s3">(</span><span class="s1">AST_ClassStaticBlock</span><span class="s3">, </span><span class="s1">block_aborts</span><span class="s3">);</span>
    <span class="s1">def_aborts</span><span class="s3">(</span><span class="s1">AST_If</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
        <span class="s2">return this</span><span class="s3">.</span><span class="s1">alternative </span><span class="s3">&amp;&amp; </span><span class="s1">aborts</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">) &amp;&amp; </span><span class="s1">aborts</span><span class="s3">(</span><span class="s2">this</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">) &amp;&amp; </span><span class="s2">this</span><span class="s3">;</span>
    <span class="s3">});</span>
<span class="s3">})(</span><span class="s2">function</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">func</span><span class="s3">) {</span>
    <span class="s1">node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;aborts&quot;</span><span class="s3">, </span><span class="s1">func</span><span class="s3">);</span>
<span class="s3">});</span>

<span class="s1">AST_Node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s4">&quot;contains_this&quot;</span><span class="s3">, </span><span class="s2">function</span><span class="s3">() {</span>
    <span class="s2">return </span><span class="s1">walk</span><span class="s3">(</span><span class="s2">this</span><span class="s3">, </span><span class="s1">node </span><span class="s3">=&gt; {</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">node </span><span class="s2">instanceof </span><span class="s1">AST_This</span><span class="s3">) </span><span class="s2">return </span><span class="s1">walk_abort</span><span class="s3">;</span>
        <span class="s2">if </span><span class="s3">(</span>
            <span class="s1">node </span><span class="s3">!== </span><span class="s2">this</span>
            <span class="s3">&amp;&amp; </span><span class="s1">node </span><span class="s2">instanceof </span><span class="s1">AST_Scope</span>
            <span class="s3">&amp;&amp; !(</span><span class="s1">node </span><span class="s2">instanceof </span><span class="s1">AST_Arrow</span><span class="s3">)</span>
        <span class="s3">) {</span>
            <span class="s2">return true</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">});</span>
<span class="s3">});</span>

<span class="s2">export function </span><span class="s1">is_modified</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">, </span><span class="s1">tw</span><span class="s3">, </span><span class="s1">node</span><span class="s3">, </span><span class="s1">value</span><span class="s3">, </span><span class="s1">level</span><span class="s3">, </span><span class="s1">immutable</span><span class="s3">) {</span>
    <span class="s2">var </span><span class="s1">parent </span><span class="s3">= </span><span class="s1">tw</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">(</span><span class="s1">level</span><span class="s3">);</span>
    <span class="s2">var </span><span class="s1">lhs </span><span class="s3">= </span><span class="s1">is_lhs</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">parent</span><span class="s3">);</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">lhs</span><span class="s3">) </span><span class="s2">return </span><span class="s1">lhs</span><span class="s3">;</span>
    <span class="s2">if </span><span class="s3">(!</span><span class="s1">immutable</span>
        <span class="s3">&amp;&amp; </span><span class="s1">parent </span><span class="s2">instanceof </span><span class="s1">AST_Call</span>
        <span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s1">node</span>
        <span class="s3">&amp;&amp; !(</span><span class="s1">value </span><span class="s2">instanceof </span><span class="s1">AST_Arrow</span><span class="s3">)</span>
        <span class="s3">&amp;&amp; !(</span><span class="s1">value </span><span class="s2">instanceof </span><span class="s1">AST_Class</span><span class="s3">)</span>
        <span class="s3">&amp;&amp; !</span><span class="s1">parent</span><span class="s3">.</span><span class="s1">is_callee_pure</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">)</span>
        <span class="s3">&amp;&amp; (!(</span><span class="s1">value </span><span class="s2">instanceof </span><span class="s1">AST_Function</span><span class="s3">)</span>
            <span class="s3">|| !(</span><span class="s1">parent </span><span class="s2">instanceof </span><span class="s1">AST_New</span><span class="s3">) &amp;&amp; </span><span class="s1">value</span><span class="s3">.</span><span class="s1">contains_this</span><span class="s3">())) {</span>
        <span class="s2">return true</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">parent </span><span class="s2">instanceof </span><span class="s1">AST_Array</span><span class="s3">) {</span>
        <span class="s2">return </span><span class="s1">is_modified</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">, </span><span class="s1">tw</span><span class="s3">, </span><span class="s1">parent</span><span class="s3">, </span><span class="s1">parent</span><span class="s3">, </span><span class="s1">level </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">parent </span><span class="s2">instanceof </span><span class="s1">AST_ObjectKeyVal </span><span class="s3">&amp;&amp; </span><span class="s1">node </span><span class="s3">=== </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">value</span><span class="s3">) {</span>
        <span class="s2">var </span><span class="s1">obj </span><span class="s3">= </span><span class="s1">tw</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">(</span><span class="s1">level </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">);</span>
        <span class="s2">return </span><span class="s1">is_modified</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">, </span><span class="s1">tw</span><span class="s3">, </span><span class="s1">obj</span><span class="s3">, </span><span class="s1">obj</span><span class="s3">, </span><span class="s1">level </span><span class="s3">+ </span><span class="s6">2</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">parent </span><span class="s2">instanceof </span><span class="s1">AST_PropAccess </span><span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s1">node</span><span class="s3">) {</span>
        <span class="s2">var </span><span class="s1">prop </span><span class="s3">= </span><span class="s1">read_property</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">property</span><span class="s3">);</span>
        <span class="s2">return </span><span class="s3">!</span><span class="s1">immutable </span><span class="s3">&amp;&amp; </span><span class="s1">is_modified</span><span class="s3">(</span><span class="s1">compressor</span><span class="s3">, </span><span class="s1">tw</span><span class="s3">, </span><span class="s1">parent</span><span class="s3">, </span><span class="s1">prop</span><span class="s3">, </span><span class="s1">level </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">}</span>
</pre>
</body>
</html>