<html>
<head>
<title>pkcs7asn1.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #67a37c; font-style: italic;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #6aab73;}
.s6 { color: #7a7e85;}
.s7 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
pkcs7asn1.js</font>
</center></td></tr></table>
<pre><span class="s0">/**</span>
 <span class="s0">* Javascript implementation of ASN.1 validators for PKCS#7 v1.5.</span>
 <span class="s0">*</span>
 <span class="s0">* </span><span class="s1">@author </span><span class="s0">Dave Longley</span>
 <span class="s0">* </span><span class="s1">@author </span><span class="s0">Stefan Siegl</span>
 <span class="s0">*</span>
 <span class="s0">* Copyright (c) 2012-2015 Digital Bazaar, Inc.</span>
 <span class="s0">* Copyright (c) 2012 Stefan Siegl &lt;stesie@brokenpipe.de&gt;</span>
 <span class="s0">*</span>
 <span class="s0">* The ASN.1 representation of PKCS#7 is as follows</span>
 <span class="s0">* (see RFC #2315 for details, http://www.ietf.org/rfc/rfc2315.txt):</span>
 <span class="s0">*</span>
 <span class="s0">* A PKCS#7 message consists of a ContentInfo on root level, which may</span>
 <span class="s0">* contain any number of further ContentInfo nested into it.</span>
 <span class="s0">*</span>
 <span class="s0">* ContentInfo ::= SEQUENCE {</span>
 <span class="s0">*   contentType                ContentType,</span>
 <span class="s0">*   content               [0]  EXPLICIT ANY DEFINED BY contentType OPTIONAL</span>
 <span class="s0">* }</span>
 <span class="s0">*</span>
 <span class="s0">* ContentType ::= OBJECT IDENTIFIER</span>
 <span class="s0">*</span>
 <span class="s0">* EnvelopedData ::= SEQUENCE {</span>
 <span class="s0">*   version                    Version,</span>
 <span class="s0">*   recipientInfos             RecipientInfos,</span>
 <span class="s0">*   encryptedContentInfo       EncryptedContentInfo</span>
 <span class="s0">* }</span>
 <span class="s0">*</span>
 <span class="s0">* EncryptedData ::= SEQUENCE {</span>
 <span class="s0">*   version                    Version,</span>
 <span class="s0">*   encryptedContentInfo       EncryptedContentInfo</span>
 <span class="s0">* }</span>
 <span class="s0">*</span>
 <span class="s0">* id-signedData OBJECT IDENTIFIER ::= { iso(1) member-body(2)</span>
 <span class="s0">*   us(840) rsadsi(113549) pkcs(1) pkcs7(7) 2 }</span>
 <span class="s0">*</span>
 <span class="s0">* SignedData ::= SEQUENCE {</span>
 <span class="s0">*   version           INTEGER,</span>
 <span class="s0">*   digestAlgorithms  DigestAlgorithmIdentifiers,</span>
 <span class="s0">*   contentInfo       ContentInfo,</span>
 <span class="s0">*   certificates      [0] IMPLICIT Certificates OPTIONAL,</span>
 <span class="s0">*   crls              [1] IMPLICIT CertificateRevocationLists OPTIONAL,</span>
 <span class="s0">*   signerInfos       SignerInfos</span>
 <span class="s0">* }</span>
 <span class="s0">*</span>
 <span class="s0">* SignerInfos ::= SET OF SignerInfo</span>
 <span class="s0">*</span>
 <span class="s0">* SignerInfo ::= SEQUENCE {</span>
 <span class="s0">*   version                    Version,</span>
 <span class="s0">*   issuerAndSerialNumber      IssuerAndSerialNumber,</span>
 <span class="s0">*   digestAlgorithm            DigestAlgorithmIdentifier,</span>
 <span class="s0">*   authenticatedAttributes    [0] IMPLICIT Attributes OPTIONAL,</span>
 <span class="s0">*   digestEncryptionAlgorithm  DigestEncryptionAlgorithmIdentifier,</span>
 <span class="s0">*   encryptedDigest            EncryptedDigest,</span>
 <span class="s0">*   unauthenticatedAttributes  [1] IMPLICIT Attributes OPTIONAL</span>
 <span class="s0">* }</span>
 <span class="s0">*</span>
 <span class="s0">* EncryptedDigest ::= OCTET STRING</span>
 <span class="s0">*</span>
 <span class="s0">* Attributes ::= SET OF Attribute</span>
 <span class="s0">*</span>
 <span class="s0">* Attribute ::= SEQUENCE {</span>
 <span class="s0">*   attrType    OBJECT IDENTIFIER,</span>
 <span class="s0">*   attrValues  SET OF AttributeValue</span>
 <span class="s0">* }</span>
 <span class="s0">*</span>
 <span class="s0">* AttributeValue ::= ANY</span>
 <span class="s0">*</span>
 <span class="s0">* Version ::= INTEGER</span>
 <span class="s0">*</span>
 <span class="s0">* RecipientInfos ::= SET OF RecipientInfo</span>
 <span class="s0">*</span>
 <span class="s0">* EncryptedContentInfo ::= SEQUENCE {</span>
 <span class="s0">*   contentType                 ContentType,</span>
 <span class="s0">*   contentEncryptionAlgorithm  ContentEncryptionAlgorithmIdentifier,</span>
 <span class="s0">*   encryptedContent       [0]  IMPLICIT EncryptedContent OPTIONAL</span>
 <span class="s0">* }</span>
 <span class="s0">*</span>
 <span class="s0">* ContentEncryptionAlgorithmIdentifier ::= AlgorithmIdentifier</span>
 <span class="s0">*</span>
 <span class="s0">* The AlgorithmIdentifier contains an Object Identifier (OID) and parameters</span>
 <span class="s0">* for the algorithm, if any. In the case of AES and DES3, there is only one,</span>
 <span class="s0">* the IV.</span>
 <span class="s0">*</span>
 <span class="s0">* AlgorithmIdentifer ::= SEQUENCE {</span>
 <span class="s0">*    algorithm OBJECT IDENTIFIER,</span>
 <span class="s0">*    parameters ANY DEFINED BY algorithm OPTIONAL</span>
 <span class="s0">* }</span>
 <span class="s0">*</span>
 <span class="s0">* EncryptedContent ::= OCTET STRING</span>
 <span class="s0">*</span>
 <span class="s0">* RecipientInfo ::= SEQUENCE {</span>
 <span class="s0">*   version                     Version,</span>
 <span class="s0">*   issuerAndSerialNumber       IssuerAndSerialNumber,</span>
 <span class="s0">*   keyEncryptionAlgorithm      KeyEncryptionAlgorithmIdentifier,</span>
 <span class="s0">*   encryptedKey                EncryptedKey</span>
 <span class="s0">* }</span>
 <span class="s0">*</span>
 <span class="s0">* IssuerAndSerialNumber ::= SEQUENCE {</span>
 <span class="s0">*   issuer                      Name,</span>
 <span class="s0">*   serialNumber                CertificateSerialNumber</span>
 <span class="s0">* }</span>
 <span class="s0">*</span>
 <span class="s0">* CertificateSerialNumber ::= INTEGER</span>
 <span class="s0">*</span>
 <span class="s0">* KeyEncryptionAlgorithmIdentifier ::= AlgorithmIdentifier</span>
 <span class="s0">*</span>
 <span class="s0">* EncryptedKey ::= OCTET STRING</span>
 <span class="s0">*/</span>
<span class="s3">var </span><span class="s2">forge </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s5">'./forge'</span><span class="s4">);</span>
<span class="s2">require</span><span class="s4">(</span><span class="s5">'./asn1'</span><span class="s4">);</span>
<span class="s2">require</span><span class="s4">(</span><span class="s5">'./util'</span><span class="s4">);</span>

<span class="s6">// shortcut for ASN.1 API</span>
<span class="s3">var </span><span class="s2">asn1 </span><span class="s4">= </span><span class="s2">forge</span><span class="s4">.</span><span class="s2">asn1</span><span class="s4">;</span>

<span class="s6">// shortcut for PKCS#7 API</span>
<span class="s3">var </span><span class="s2">p7v </span><span class="s4">= </span><span class="s2">module</span><span class="s4">.</span><span class="s2">exports </span><span class="s4">= </span><span class="s2">forge</span><span class="s4">.</span><span class="s2">pkcs7asn1 </span><span class="s4">= </span><span class="s2">forge</span><span class="s4">.</span><span class="s2">pkcs7asn1 </span><span class="s4">|| {};</span>
<span class="s2">forge</span><span class="s4">.</span><span class="s2">pkcs7 </span><span class="s4">= </span><span class="s2">forge</span><span class="s4">.</span><span class="s2">pkcs7 </span><span class="s4">|| {};</span>
<span class="s2">forge</span><span class="s4">.</span><span class="s2">pkcs7</span><span class="s4">.</span><span class="s2">asn1 </span><span class="s4">= </span><span class="s2">p7v</span><span class="s4">;</span>

<span class="s3">var </span><span class="s2">contentInfoValidator </span><span class="s4">= {</span>
  <span class="s2">name</span><span class="s4">: </span><span class="s5">'ContentInfo'</span><span class="s4">,</span>
  <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
  <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
  <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
  <span class="s2">value</span><span class="s4">: [{</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'ContentInfo.ContentType'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">OID</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
    <span class="s2">capture</span><span class="s4">: </span><span class="s5">'contentType'</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'ContentInfo.content'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">CONTEXT_SPECIFIC</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">optional</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">captureAsn1</span><span class="s4">: </span><span class="s5">'content'</span>
  <span class="s4">}]</span>
<span class="s4">};</span>
<span class="s2">p7v</span><span class="s4">.</span><span class="s2">contentInfoValidator </span><span class="s4">= </span><span class="s2">contentInfoValidator</span><span class="s4">;</span>

<span class="s3">var </span><span class="s2">encryptedContentInfoValidator </span><span class="s4">= {</span>
  <span class="s2">name</span><span class="s4">: </span><span class="s5">'EncryptedContentInfo'</span><span class="s4">,</span>
  <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
  <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
  <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
  <span class="s2">value</span><span class="s4">: [{</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'EncryptedContentInfo.contentType'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">OID</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
    <span class="s2">capture</span><span class="s4">: </span><span class="s5">'contentType'</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'EncryptedContentInfo.contentEncryptionAlgorithm'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">value</span><span class="s4">: [{</span>
      <span class="s2">name</span><span class="s4">: </span><span class="s5">'EncryptedContentInfo.contentEncryptionAlgorithm.algorithm'</span><span class="s4">,</span>
      <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
      <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">OID</span><span class="s4">,</span>
      <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
      <span class="s2">capture</span><span class="s4">: </span><span class="s5">'encAlgorithm'</span>
    <span class="s4">}, {</span>
      <span class="s2">name</span><span class="s4">: </span><span class="s5">'EncryptedContentInfo.contentEncryptionAlgorithm.parameter'</span><span class="s4">,</span>
      <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
      <span class="s2">captureAsn1</span><span class="s4">: </span><span class="s5">'encParameter'</span>
    <span class="s4">}]</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'EncryptedContentInfo.encryptedContent'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">CONTEXT_SPECIFIC</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s6">/* The PKCS#7 structure output by OpenSSL somewhat differs from what 
     * other implementations do generate. 
     * 
     * OpenSSL generates a structure like this: 
     * SEQUENCE { 
     *    ... 
     *    [0] 
     *       26 DA 67 D2 17 9C 45 3C B1 2A A8 59 2F 29 33 38 
     *       C3 C3 DF 86 71 74 7A 19 9F 40 D0 29 BE 85 90 45 
     *       ... 
     * } 
     * 
     * Whereas other implementations (and this PKCS#7 module) generate: 
     * SEQUENCE { 
     *    ... 
     *    [0] { 
     *       OCTET STRING 
     *          26 DA 67 D2 17 9C 45 3C B1 2A A8 59 2F 29 33 38 
     *          C3 C3 DF 86 71 74 7A 19 9F 40 D0 29 BE 85 90 45 
     *          ... 
     *    } 
     * } 
     * 
     * In order to support both, we just capture the context specific 
     * field here.  The OCTET STRING bit is removed below. 
     */</span>
    <span class="s2">capture</span><span class="s4">: </span><span class="s5">'encryptedContent'</span><span class="s4">,</span>
    <span class="s2">captureAsn1</span><span class="s4">: </span><span class="s5">'encryptedContentAsn1'</span>
  <span class="s4">}]</span>
<span class="s4">};</span>

<span class="s2">p7v</span><span class="s4">.</span><span class="s2">envelopedDataValidator </span><span class="s4">= {</span>
  <span class="s2">name</span><span class="s4">: </span><span class="s5">'EnvelopedData'</span><span class="s4">,</span>
  <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
  <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
  <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
  <span class="s2">value</span><span class="s4">: [{</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'EnvelopedData.Version'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">INTEGER</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
    <span class="s2">capture</span><span class="s4">: </span><span class="s5">'version'</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'EnvelopedData.RecipientInfos'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SET</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">captureAsn1</span><span class="s4">: </span><span class="s5">'recipientInfos'</span>
  <span class="s4">}].</span><span class="s2">concat</span><span class="s4">(</span><span class="s2">encryptedContentInfoValidator</span><span class="s4">)</span>
<span class="s4">};</span>

<span class="s2">p7v</span><span class="s4">.</span><span class="s2">encryptedDataValidator </span><span class="s4">= {</span>
  <span class="s2">name</span><span class="s4">: </span><span class="s5">'EncryptedData'</span><span class="s4">,</span>
  <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
  <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
  <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
  <span class="s2">value</span><span class="s4">: [{</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'EncryptedData.Version'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">INTEGER</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
    <span class="s2">capture</span><span class="s4">: </span><span class="s5">'version'</span>
  <span class="s4">}].</span><span class="s2">concat</span><span class="s4">(</span><span class="s2">encryptedContentInfoValidator</span><span class="s4">)</span>
<span class="s4">};</span>

<span class="s3">var </span><span class="s2">signerValidator </span><span class="s4">= {</span>
  <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignerInfo'</span><span class="s4">,</span>
  <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
  <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
  <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
  <span class="s2">value</span><span class="s4">: [{</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignerInfo.version'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">INTEGER</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignerInfo.issuerAndSerialNumber'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">value</span><span class="s4">: [{</span>
      <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignerInfo.issuerAndSerialNumber.issuer'</span><span class="s4">,</span>
      <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
      <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
      <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">captureAsn1</span><span class="s4">: </span><span class="s5">'issuer'</span>
    <span class="s4">}, {</span>
      <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignerInfo.issuerAndSerialNumber.serialNumber'</span><span class="s4">,</span>
      <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
      <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">INTEGER</span><span class="s4">,</span>
      <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
      <span class="s2">capture</span><span class="s4">: </span><span class="s5">'serial'</span>
    <span class="s4">}]</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignerInfo.digestAlgorithm'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">value</span><span class="s4">: [{</span>
      <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignerInfo.digestAlgorithm.algorithm'</span><span class="s4">,</span>
      <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
      <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">OID</span><span class="s4">,</span>
      <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
      <span class="s2">capture</span><span class="s4">: </span><span class="s5">'digestAlgorithm'</span>
    <span class="s4">}, {</span>
      <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignerInfo.digestAlgorithm.parameter'</span><span class="s4">,</span>
      <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
      <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
      <span class="s2">captureAsn1</span><span class="s4">: </span><span class="s5">'digestParameter'</span><span class="s4">,</span>
      <span class="s2">optional</span><span class="s4">: </span><span class="s3">true</span>
    <span class="s4">}]</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignerInfo.authenticatedAttributes'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">CONTEXT_SPECIFIC</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">optional</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">capture</span><span class="s4">: </span><span class="s5">'authenticatedAttributes'</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignerInfo.digestEncryptionAlgorithm'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">capture</span><span class="s4">: </span><span class="s5">'signatureAlgorithm'</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignerInfo.encryptedDigest'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">OCTETSTRING</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
    <span class="s2">capture</span><span class="s4">: </span><span class="s5">'signature'</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignerInfo.unauthenticatedAttributes'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">CONTEXT_SPECIFIC</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s7">1</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">optional</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">capture</span><span class="s4">: </span><span class="s5">'unauthenticatedAttributes'</span>
  <span class="s4">}]</span>
<span class="s4">};</span>

<span class="s2">p7v</span><span class="s4">.</span><span class="s2">signedDataValidator </span><span class="s4">= {</span>
  <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignedData'</span><span class="s4">,</span>
  <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
  <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
  <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
  <span class="s2">value</span><span class="s4">: [{</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignedData.Version'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">INTEGER</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
    <span class="s2">capture</span><span class="s4">: </span><span class="s5">'version'</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignedData.DigestAlgorithms'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SET</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">captureAsn1</span><span class="s4">: </span><span class="s5">'digestAlgorithms'</span>
  <span class="s4">},</span>
  <span class="s2">contentInfoValidator</span><span class="s4">,</span>
  <span class="s4">{</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignedData.Certificates'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">CONTEXT_SPECIFIC</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">optional</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">captureAsn1</span><span class="s4">: </span><span class="s5">'certificates'</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignedData.CertificateRevocationLists'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">CONTEXT_SPECIFIC</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s7">1</span><span class="s4">,</span>
    <span class="s2">optional</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">captureAsn1</span><span class="s4">: </span><span class="s5">'crls'</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'SignedData.SignerInfos'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SET</span><span class="s4">,</span>
    <span class="s2">capture</span><span class="s4">: </span><span class="s5">'signerInfos'</span><span class="s4">,</span>
    <span class="s2">optional</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">value</span><span class="s4">: [</span><span class="s2">signerValidator</span><span class="s4">]</span>
  <span class="s4">}]</span>
<span class="s4">};</span>

<span class="s2">p7v</span><span class="s4">.</span><span class="s2">recipientInfoValidator </span><span class="s4">= {</span>
  <span class="s2">name</span><span class="s4">: </span><span class="s5">'RecipientInfo'</span><span class="s4">,</span>
  <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
  <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
  <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
  <span class="s2">value</span><span class="s4">: [{</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'RecipientInfo.version'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">INTEGER</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
    <span class="s2">capture</span><span class="s4">: </span><span class="s5">'version'</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'RecipientInfo.issuerAndSerial'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">value</span><span class="s4">: [{</span>
      <span class="s2">name</span><span class="s4">: </span><span class="s5">'RecipientInfo.issuerAndSerial.issuer'</span><span class="s4">,</span>
      <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
      <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
      <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">captureAsn1</span><span class="s4">: </span><span class="s5">'issuer'</span>
    <span class="s4">}, {</span>
      <span class="s2">name</span><span class="s4">: </span><span class="s5">'RecipientInfo.issuerAndSerial.serialNumber'</span><span class="s4">,</span>
      <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
      <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">INTEGER</span><span class="s4">,</span>
      <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
      <span class="s2">capture</span><span class="s4">: </span><span class="s5">'serial'</span>
    <span class="s4">}]</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'RecipientInfo.keyEncryptionAlgorithm'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">SEQUENCE</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">value</span><span class="s4">: [{</span>
      <span class="s2">name</span><span class="s4">: </span><span class="s5">'RecipientInfo.keyEncryptionAlgorithm.algorithm'</span><span class="s4">,</span>
      <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
      <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">OID</span><span class="s4">,</span>
      <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
      <span class="s2">capture</span><span class="s4">: </span><span class="s5">'encAlgorithm'</span>
    <span class="s4">}, {</span>
      <span class="s2">name</span><span class="s4">: </span><span class="s5">'RecipientInfo.keyEncryptionAlgorithm.parameter'</span><span class="s4">,</span>
      <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
      <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
      <span class="s2">captureAsn1</span><span class="s4">: </span><span class="s5">'encParameter'</span><span class="s4">,</span>
      <span class="s2">optional</span><span class="s4">: </span><span class="s3">true</span>
    <span class="s4">}]</span>
  <span class="s4">}, {</span>
    <span class="s2">name</span><span class="s4">: </span><span class="s5">'RecipientInfo.encryptedKey'</span><span class="s4">,</span>
    <span class="s2">tagClass</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Class</span><span class="s4">.</span><span class="s2">UNIVERSAL</span><span class="s4">,</span>
    <span class="s2">type</span><span class="s4">: </span><span class="s2">asn1</span><span class="s4">.</span><span class="s2">Type</span><span class="s4">.</span><span class="s2">OCTETSTRING</span><span class="s4">,</span>
    <span class="s2">constructed</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
    <span class="s2">capture</span><span class="s4">: </span><span class="s5">'encKey'</span>
  <span class="s4">}]</span>
<span class="s4">};</span>
</pre>
</body>
</html>