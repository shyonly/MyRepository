<html>
<head>
<title>core.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6aab73;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
core.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">exports</span><span class="s1">, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, { </span><span class="s2">value</span><span class="s1">: </span><span class="s3">true </span><span class="s1">});</span>
<span class="s2">exports</span><span class="s1">.</span><span class="s2">CodeGen </span><span class="s1">= </span><span class="s2">exports</span><span class="s1">.</span><span class="s2">Name </span><span class="s1">= </span><span class="s2">exports</span><span class="s1">.</span><span class="s2">nil </span><span class="s1">= </span><span class="s2">exports</span><span class="s1">.</span><span class="s2">stringify </span><span class="s1">= </span><span class="s2">exports</span><span class="s1">.</span><span class="s2">str </span><span class="s1">= </span><span class="s2">exports</span><span class="s1">.</span><span class="s2">_ </span><span class="s1">= </span><span class="s2">exports</span><span class="s1">.</span><span class="s2">KeywordCxt </span><span class="s1">= </span><span class="s3">void </span><span class="s4">0</span><span class="s1">;</span>
<span class="s3">var </span><span class="s2">validate_1 </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./compile/validate&quot;</span><span class="s1">);</span>
<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">exports</span><span class="s1">, </span><span class="s0">&quot;KeywordCxt&quot;</span><span class="s1">, { </span><span class="s2">enumerable</span><span class="s1">: </span><span class="s3">true</span><span class="s1">, </span><span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s1">() { </span><span class="s3">return </span><span class="s2">validate_1</span><span class="s1">.</span><span class="s2">KeywordCxt</span><span class="s1">; } });</span>
<span class="s3">var </span><span class="s2">codegen_1 </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./compile/codegen&quot;</span><span class="s1">);</span>
<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">exports</span><span class="s1">, </span><span class="s0">&quot;_&quot;</span><span class="s1">, { </span><span class="s2">enumerable</span><span class="s1">: </span><span class="s3">true</span><span class="s1">, </span><span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s1">() { </span><span class="s3">return </span><span class="s2">codegen_1</span><span class="s1">.</span><span class="s2">_</span><span class="s1">; } });</span>
<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">exports</span><span class="s1">, </span><span class="s0">&quot;str&quot;</span><span class="s1">, { </span><span class="s2">enumerable</span><span class="s1">: </span><span class="s3">true</span><span class="s1">, </span><span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s1">() { </span><span class="s3">return </span><span class="s2">codegen_1</span><span class="s1">.</span><span class="s2">str</span><span class="s1">; } });</span>
<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">exports</span><span class="s1">, </span><span class="s0">&quot;stringify&quot;</span><span class="s1">, { </span><span class="s2">enumerable</span><span class="s1">: </span><span class="s3">true</span><span class="s1">, </span><span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s1">() { </span><span class="s3">return </span><span class="s2">codegen_1</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">; } });</span>
<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">exports</span><span class="s1">, </span><span class="s0">&quot;nil&quot;</span><span class="s1">, { </span><span class="s2">enumerable</span><span class="s1">: </span><span class="s3">true</span><span class="s1">, </span><span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s1">() { </span><span class="s3">return </span><span class="s2">codegen_1</span><span class="s1">.</span><span class="s2">nil</span><span class="s1">; } });</span>
<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">exports</span><span class="s1">, </span><span class="s0">&quot;Name&quot;</span><span class="s1">, { </span><span class="s2">enumerable</span><span class="s1">: </span><span class="s3">true</span><span class="s1">, </span><span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s1">() { </span><span class="s3">return </span><span class="s2">codegen_1</span><span class="s1">.</span><span class="s2">Name</span><span class="s1">; } });</span>
<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">exports</span><span class="s1">, </span><span class="s0">&quot;CodeGen&quot;</span><span class="s1">, { </span><span class="s2">enumerable</span><span class="s1">: </span><span class="s3">true</span><span class="s1">, </span><span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s1">() { </span><span class="s3">return </span><span class="s2">codegen_1</span><span class="s1">.</span><span class="s2">CodeGen</span><span class="s1">; } });</span>
<span class="s3">const </span><span class="s2">validation_error_1 </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./runtime/validation_error&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s2">ref_error_1 </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./compile/ref_error&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s2">rules_1 </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./compile/rules&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s2">compile_1 </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./compile&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s2">codegen_2 </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./compile/codegen&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s2">resolve_1 </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./compile/resolve&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s2">dataType_1 </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./compile/validate/dataType&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s2">util_1 </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./compile/util&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s2">$dataRefSchema </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./refs/data.json&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s2">uri_1 </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./runtime/uri&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s2">defaultRegExp </span><span class="s1">= (</span><span class="s2">str</span><span class="s1">, </span><span class="s2">flags</span><span class="s1">) =&gt; </span><span class="s3">new </span><span class="s2">RegExp</span><span class="s1">(</span><span class="s2">str</span><span class="s1">, </span><span class="s2">flags</span><span class="s1">);</span>
<span class="s2">defaultRegExp</span><span class="s1">.</span><span class="s2">code </span><span class="s1">= </span><span class="s0">&quot;new RegExp&quot;</span><span class="s1">;</span>
<span class="s3">const </span><span class="s2">META_IGNORE_OPTIONS </span><span class="s1">= [</span><span class="s0">&quot;removeAdditional&quot;</span><span class="s1">, </span><span class="s0">&quot;useDefaults&quot;</span><span class="s1">, </span><span class="s0">&quot;coerceTypes&quot;</span><span class="s1">];</span>
<span class="s3">const </span><span class="s2">EXT_SCOPE_NAMES </span><span class="s1">= </span><span class="s3">new </span><span class="s2">Set</span><span class="s1">([</span>
    <span class="s0">&quot;validate&quot;</span><span class="s1">,</span>
    <span class="s0">&quot;serialize&quot;</span><span class="s1">,</span>
    <span class="s0">&quot;parse&quot;</span><span class="s1">,</span>
    <span class="s0">&quot;wrapper&quot;</span><span class="s1">,</span>
    <span class="s0">&quot;root&quot;</span><span class="s1">,</span>
    <span class="s0">&quot;schema&quot;</span><span class="s1">,</span>
    <span class="s0">&quot;keyword&quot;</span><span class="s1">,</span>
    <span class="s0">&quot;pattern&quot;</span><span class="s1">,</span>
    <span class="s0">&quot;formats&quot;</span><span class="s1">,</span>
    <span class="s0">&quot;validate$data&quot;</span><span class="s1">,</span>
    <span class="s0">&quot;func&quot;</span><span class="s1">,</span>
    <span class="s0">&quot;obj&quot;</span><span class="s1">,</span>
    <span class="s0">&quot;Error&quot;</span><span class="s1">,</span>
<span class="s1">]);</span>
<span class="s3">const </span><span class="s2">removedOptions </span><span class="s1">= {</span>
    <span class="s2">errorDataPath</span><span class="s1">: </span><span class="s0">&quot;&quot;</span><span class="s1">,</span>
    <span class="s2">format</span><span class="s1">: </span><span class="s0">&quot;`validateFormats: false` can be used instead.&quot;</span><span class="s1">,</span>
    <span class="s2">nullable</span><span class="s1">: </span><span class="s0">'&quot;nullable&quot; keyword is supported by default.'</span><span class="s1">,</span>
    <span class="s2">jsonPointers</span><span class="s1">: </span><span class="s0">&quot;Deprecated jsPropertySyntax can be used instead.&quot;</span><span class="s1">,</span>
    <span class="s2">extendRefs</span><span class="s1">: </span><span class="s0">&quot;Deprecated ignoreKeywordsWithRef can be used instead.&quot;</span><span class="s1">,</span>
    <span class="s2">missingRefs</span><span class="s1">: </span><span class="s0">&quot;Pass empty schema with $id that should be ignored to ajv.addSchema.&quot;</span><span class="s1">,</span>
    <span class="s2">processCode</span><span class="s1">: </span><span class="s0">&quot;Use option `code: {process: (code, schemaEnv: object) =&gt; string}`&quot;</span><span class="s1">,</span>
    <span class="s2">sourceCode</span><span class="s1">: </span><span class="s0">&quot;Use option `code: {source: true}`&quot;</span><span class="s1">,</span>
    <span class="s2">strictDefaults</span><span class="s1">: </span><span class="s0">&quot;It is default now, see option `strict`.&quot;</span><span class="s1">,</span>
    <span class="s2">strictKeywords</span><span class="s1">: </span><span class="s0">&quot;It is default now, see option `strict`.&quot;</span><span class="s1">,</span>
    <span class="s2">uniqueItems</span><span class="s1">: </span><span class="s0">'&quot;uniqueItems&quot; keyword is always validated.'</span><span class="s1">,</span>
    <span class="s2">unknownFormats</span><span class="s1">: </span><span class="s0">&quot;Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).&quot;</span><span class="s1">,</span>
    <span class="s2">cache</span><span class="s1">: </span><span class="s0">&quot;Map is used as cache, schema object as key.&quot;</span><span class="s1">,</span>
    <span class="s2">serialize</span><span class="s1">: </span><span class="s0">&quot;Map is used as cache, schema object as key.&quot;</span><span class="s1">,</span>
    <span class="s2">ajvErrors</span><span class="s1">: </span><span class="s0">&quot;It is default now.&quot;</span><span class="s1">,</span>
<span class="s1">};</span>
<span class="s3">const </span><span class="s2">deprecatedOptions </span><span class="s1">= {</span>
    <span class="s2">ignoreKeywordsWithRef</span><span class="s1">: </span><span class="s0">&quot;&quot;</span><span class="s1">,</span>
    <span class="s2">jsPropertySyntax</span><span class="s1">: </span><span class="s0">&quot;&quot;</span><span class="s1">,</span>
    <span class="s2">unicode</span><span class="s1">: </span><span class="s0">'&quot;minLength&quot;/&quot;maxLength&quot; account for unicode characters by default.'</span><span class="s1">,</span>
<span class="s1">};</span>
<span class="s3">const </span><span class="s2">MAX_EXPRESSION </span><span class="s1">= </span><span class="s4">200</span><span class="s1">;</span>
<span class="s5">// eslint-disable-next-line complexity</span>
<span class="s3">function </span><span class="s2">requiredOptions</span><span class="s1">(</span><span class="s2">o</span><span class="s1">) {</span>
    <span class="s3">var </span><span class="s2">_a</span><span class="s1">, </span><span class="s2">_b</span><span class="s1">, </span><span class="s2">_c</span><span class="s1">, </span><span class="s2">_d</span><span class="s1">, </span><span class="s2">_e</span><span class="s1">, </span><span class="s2">_f</span><span class="s1">, </span><span class="s2">_g</span><span class="s1">, </span><span class="s2">_h</span><span class="s1">, </span><span class="s2">_j</span><span class="s1">, </span><span class="s2">_k</span><span class="s1">, </span><span class="s2">_l</span><span class="s1">, </span><span class="s2">_m</span><span class="s1">, </span><span class="s2">_o</span><span class="s1">, </span><span class="s2">_p</span><span class="s1">, </span><span class="s2">_q</span><span class="s1">, </span><span class="s2">_r</span><span class="s1">, </span><span class="s2">_s</span><span class="s1">, </span><span class="s2">_t</span><span class="s1">, </span><span class="s2">_u</span><span class="s1">, </span><span class="s2">_v</span><span class="s1">, </span><span class="s2">_w</span><span class="s1">, </span><span class="s2">_x</span><span class="s1">, </span><span class="s2">_y</span><span class="s1">, </span><span class="s2">_z</span><span class="s1">, </span><span class="s2">_0</span><span class="s1">;</span>
    <span class="s3">const </span><span class="s2">s </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">strict</span><span class="s1">;</span>
    <span class="s3">const </span><span class="s2">_optz </span><span class="s1">= (</span><span class="s2">_a </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">code</span><span class="s1">) === </span><span class="s3">null </span><span class="s1">|| </span><span class="s2">_a </span><span class="s1">=== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">: </span><span class="s2">_a</span><span class="s1">.</span><span class="s2">optimize</span><span class="s1">;</span>
    <span class="s3">const </span><span class="s2">optimize </span><span class="s1">= </span><span class="s2">_optz </span><span class="s1">=== </span><span class="s3">true </span><span class="s1">|| </span><span class="s2">_optz </span><span class="s1">=== </span><span class="s2">undefined </span><span class="s1">? </span><span class="s4">1 </span><span class="s1">: </span><span class="s2">_optz </span><span class="s1">|| </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s3">const </span><span class="s2">regExp </span><span class="s1">= (</span><span class="s2">_c </span><span class="s1">= (</span><span class="s2">_b </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">code</span><span class="s1">) === </span><span class="s3">null </span><span class="s1">|| </span><span class="s2">_b </span><span class="s1">=== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">: </span><span class="s2">_b</span><span class="s1">.</span><span class="s2">regExp</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_c </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_c </span><span class="s1">: </span><span class="s2">defaultRegExp</span><span class="s1">;</span>
    <span class="s3">const </span><span class="s2">uriResolver </span><span class="s1">= (</span><span class="s2">_d </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">uriResolver</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_d </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_d </span><span class="s1">: </span><span class="s2">uri_1</span><span class="s1">.</span><span class="s2">default</span><span class="s1">;</span>
    <span class="s3">return </span><span class="s1">{</span>
        <span class="s2">strictSchema</span><span class="s1">: (</span><span class="s2">_f </span><span class="s1">= (</span><span class="s2">_e </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">strictSchema</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_e </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_e </span><span class="s1">: </span><span class="s2">s</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_f </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_f </span><span class="s1">: </span><span class="s3">true</span><span class="s1">,</span>
        <span class="s2">strictNumbers</span><span class="s1">: (</span><span class="s2">_h </span><span class="s1">= (</span><span class="s2">_g </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">strictNumbers</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_g </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_g </span><span class="s1">: </span><span class="s2">s</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_h </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_h </span><span class="s1">: </span><span class="s3">true</span><span class="s1">,</span>
        <span class="s2">strictTypes</span><span class="s1">: (</span><span class="s2">_k </span><span class="s1">= (</span><span class="s2">_j </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">strictTypes</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_j </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_j </span><span class="s1">: </span><span class="s2">s</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_k </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_k </span><span class="s1">: </span><span class="s0">&quot;log&quot;</span><span class="s1">,</span>
        <span class="s2">strictTuples</span><span class="s1">: (</span><span class="s2">_m </span><span class="s1">= (</span><span class="s2">_l </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">strictTuples</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_l </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_l </span><span class="s1">: </span><span class="s2">s</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_m </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_m </span><span class="s1">: </span><span class="s0">&quot;log&quot;</span><span class="s1">,</span>
        <span class="s2">strictRequired</span><span class="s1">: (</span><span class="s2">_p </span><span class="s1">= (</span><span class="s2">_o </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">strictRequired</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_o </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_o </span><span class="s1">: </span><span class="s2">s</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_p </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_p </span><span class="s1">: </span><span class="s3">false</span><span class="s1">,</span>
        <span class="s2">code</span><span class="s1">: </span><span class="s2">o</span><span class="s1">.</span><span class="s2">code </span><span class="s1">? { </span><span class="s2">...o</span><span class="s1">.</span><span class="s2">code</span><span class="s1">, </span><span class="s2">optimize</span><span class="s1">, </span><span class="s2">regExp </span><span class="s1">} : { </span><span class="s2">optimize</span><span class="s1">, </span><span class="s2">regExp </span><span class="s1">},</span>
        <span class="s2">loopRequired</span><span class="s1">: (</span><span class="s2">_q </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">loopRequired</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_q </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_q </span><span class="s1">: </span><span class="s2">MAX_EXPRESSION</span><span class="s1">,</span>
        <span class="s2">loopEnum</span><span class="s1">: (</span><span class="s2">_r </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">loopEnum</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_r </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_r </span><span class="s1">: </span><span class="s2">MAX_EXPRESSION</span><span class="s1">,</span>
        <span class="s2">meta</span><span class="s1">: (</span><span class="s2">_s </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_s </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_s </span><span class="s1">: </span><span class="s3">true</span><span class="s1">,</span>
        <span class="s2">messages</span><span class="s1">: (</span><span class="s2">_t </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">messages</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_t </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_t </span><span class="s1">: </span><span class="s3">true</span><span class="s1">,</span>
        <span class="s2">inlineRefs</span><span class="s1">: (</span><span class="s2">_u </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">inlineRefs</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_u </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_u </span><span class="s1">: </span><span class="s3">true</span><span class="s1">,</span>
        <span class="s2">schemaId</span><span class="s1">: (</span><span class="s2">_v </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">schemaId</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_v </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_v </span><span class="s1">: </span><span class="s0">&quot;$id&quot;</span><span class="s1">,</span>
        <span class="s2">addUsedSchema</span><span class="s1">: (</span><span class="s2">_w </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">addUsedSchema</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_w </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_w </span><span class="s1">: </span><span class="s3">true</span><span class="s1">,</span>
        <span class="s2">validateSchema</span><span class="s1">: (</span><span class="s2">_x </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">validateSchema</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_x </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_x </span><span class="s1">: </span><span class="s3">true</span><span class="s1">,</span>
        <span class="s2">validateFormats</span><span class="s1">: (</span><span class="s2">_y </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">validateFormats</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_y </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_y </span><span class="s1">: </span><span class="s3">true</span><span class="s1">,</span>
        <span class="s2">unicodeRegExp</span><span class="s1">: (</span><span class="s2">_z </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">unicodeRegExp</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_z </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_z </span><span class="s1">: </span><span class="s3">true</span><span class="s1">,</span>
        <span class="s2">int32range</span><span class="s1">: (</span><span class="s2">_0 </span><span class="s1">= </span><span class="s2">o</span><span class="s1">.</span><span class="s2">int32range</span><span class="s1">) !== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">_0 </span><span class="s1">!== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s2">_0 </span><span class="s1">: </span><span class="s3">true</span><span class="s1">,</span>
        <span class="s2">uriResolver</span><span class="s1">: </span><span class="s2">uriResolver</span><span class="s1">,</span>
    <span class="s1">};</span>
<span class="s1">}</span>
<span class="s3">class </span><span class="s2">Ajv </span><span class="s1">{</span>
    <span class="s2">constructor</span><span class="s1">(</span><span class="s2">opts </span><span class="s1">= {}) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">schemas </span><span class="s1">= {};</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">refs </span><span class="s1">= {};</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">formats </span><span class="s1">= {};</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">_compilations </span><span class="s1">= </span><span class="s3">new </span><span class="s2">Set</span><span class="s1">();</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">_loading </span><span class="s1">= {};</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">_cache </span><span class="s1">= </span><span class="s3">new </span><span class="s2">Map</span><span class="s1">();</span>
        <span class="s2">opts </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts </span><span class="s1">= { </span><span class="s2">...opts</span><span class="s1">, </span><span class="s2">...requiredOptions</span><span class="s1">(</span><span class="s2">opts</span><span class="s1">) };</span>
        <span class="s3">const </span><span class="s1">{ </span><span class="s2">es5</span><span class="s1">, </span><span class="s2">lines </span><span class="s1">} = </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">code</span><span class="s1">;</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">scope </span><span class="s1">= </span><span class="s3">new </span><span class="s2">codegen_2</span><span class="s1">.</span><span class="s2">ValueScope</span><span class="s1">({ </span><span class="s2">scope</span><span class="s1">: {}, </span><span class="s2">prefixes</span><span class="s1">: </span><span class="s2">EXT_SCOPE_NAMES</span><span class="s1">, </span><span class="s2">es5</span><span class="s1">, </span><span class="s2">lines </span><span class="s1">});</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">logger </span><span class="s1">= </span><span class="s2">getLogger</span><span class="s1">(</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">logger</span><span class="s1">);</span>
        <span class="s3">const </span><span class="s2">formatOpt </span><span class="s1">= </span><span class="s2">opts</span><span class="s1">.</span><span class="s2">validateFormats</span><span class="s1">;</span>
        <span class="s2">opts</span><span class="s1">.</span><span class="s2">validateFormats </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">RULES </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">rules_1</span><span class="s1">.</span><span class="s2">getRules</span><span class="s1">)();</span>
        <span class="s2">checkOptions</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">removedOptions</span><span class="s1">, </span><span class="s2">opts</span><span class="s1">, </span><span class="s0">&quot;NOT SUPPORTED&quot;</span><span class="s1">);</span>
        <span class="s2">checkOptions</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">deprecatedOptions</span><span class="s1">, </span><span class="s2">opts</span><span class="s1">, </span><span class="s0">&quot;DEPRECATED&quot;</span><span class="s1">, </span><span class="s0">&quot;warn&quot;</span><span class="s1">);</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">_metaOpts </span><span class="s1">= </span><span class="s2">getMetaSchemaOptions</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">);</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">formats</span><span class="s1">)</span>
            <span class="s2">addInitialFormats</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">);</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">_addVocabularies</span><span class="s1">();</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">_addDefaultMetaSchema</span><span class="s1">();</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">keywords</span><span class="s1">)</span>
            <span class="s2">addInitialKeywords</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">opts</span><span class="s1">.</span><span class="s2">keywords</span><span class="s1">);</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">opts</span><span class="s1">.</span><span class="s2">meta </span><span class="s1">== </span><span class="s0">&quot;object&quot;</span><span class="s1">)</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">addMetaSchema</span><span class="s1">(</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">);</span>
        <span class="s2">addInitialSchemas</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">);</span>
        <span class="s2">opts</span><span class="s1">.</span><span class="s2">validateFormats </span><span class="s1">= </span><span class="s2">formatOpt</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">_addVocabularies</span><span class="s1">() {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">addKeyword</span><span class="s1">(</span><span class="s0">&quot;$async&quot;</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">_addDefaultMetaSchema</span><span class="s1">() {</span>
        <span class="s3">const </span><span class="s1">{ </span><span class="s2">$data</span><span class="s1">, </span><span class="s2">meta</span><span class="s1">, </span><span class="s2">schemaId </span><span class="s1">} = </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">;</span>
        <span class="s3">let </span><span class="s2">_dataRefSchema </span><span class="s1">= </span><span class="s2">$dataRefSchema</span><span class="s1">;</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">schemaId </span><span class="s1">=== </span><span class="s0">&quot;id&quot;</span><span class="s1">) {</span>
            <span class="s2">_dataRefSchema </span><span class="s1">= { </span><span class="s2">...$dataRefSchema </span><span class="s1">};</span>
            <span class="s2">_dataRefSchema</span><span class="s1">.</span><span class="s2">id </span><span class="s1">= </span><span class="s2">_dataRefSchema</span><span class="s1">.</span><span class="s2">$id</span><span class="s1">;</span>
            <span class="s3">delete </span><span class="s2">_dataRefSchema</span><span class="s1">.</span><span class="s2">$id</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">meta </span><span class="s1">&amp;&amp; </span><span class="s2">$data</span><span class="s1">)</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">addMetaSchema</span><span class="s1">(</span><span class="s2">_dataRefSchema</span><span class="s1">, </span><span class="s2">_dataRefSchema</span><span class="s1">[</span><span class="s2">schemaId</span><span class="s1">], </span><span class="s3">false</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">defaultMeta</span><span class="s1">() {</span>
        <span class="s3">const </span><span class="s1">{ </span><span class="s2">meta</span><span class="s1">, </span><span class="s2">schemaId </span><span class="s1">} = </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">;</span>
        <span class="s3">return </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">defaultMeta </span><span class="s1">= </span><span class="s3">typeof </span><span class="s2">meta </span><span class="s1">== </span><span class="s0">&quot;object&quot; </span><span class="s1">? </span><span class="s2">meta</span><span class="s1">[</span><span class="s2">schemaId</span><span class="s1">] || </span><span class="s2">meta </span><span class="s1">: </span><span class="s2">undefined</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">validate</span><span class="s1">(</span><span class="s2">schemaKeyRef</span><span class="s1">, </span><span class="s5">// key, ref or schema object</span>
    <span class="s2">data </span><span class="s5">// to be validated</span>
    <span class="s1">) {</span>
        <span class="s3">let </span><span class="s2">v</span><span class="s1">;</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">schemaKeyRef </span><span class="s1">== </span><span class="s0">&quot;string&quot;</span><span class="s1">) {</span>
            <span class="s2">v </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">getSchema</span><span class="s1">(</span><span class="s2">schemaKeyRef</span><span class="s1">);</span>
            <span class="s3">if </span><span class="s1">(!</span><span class="s2">v</span><span class="s1">)</span>
                <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">`no schema with key or ref &quot;</span><span class="s2">$</span><span class="s1">{</span><span class="s2">schemaKeyRef</span><span class="s1">}</span><span class="s0">&quot;`</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s3">else </span><span class="s1">{</span>
            <span class="s2">v </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">compile</span><span class="s1">(</span><span class="s2">schemaKeyRef</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s3">const </span><span class="s2">valid </span><span class="s1">= </span><span class="s2">v</span><span class="s1">(</span><span class="s2">data</span><span class="s1">);</span>
        <span class="s3">if </span><span class="s1">(!(</span><span class="s0">&quot;$async&quot; </span><span class="s3">in </span><span class="s2">v</span><span class="s1">))</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">errors </span><span class="s1">= </span><span class="s2">v</span><span class="s1">.</span><span class="s2">errors</span><span class="s1">;</span>
        <span class="s3">return </span><span class="s2">valid</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">compile</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">, </span><span class="s2">_meta</span><span class="s1">) {</span>
        <span class="s3">const </span><span class="s2">sch </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">_addSchema</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">, </span><span class="s2">_meta</span><span class="s1">);</span>
        <span class="s3">return </span><span class="s1">(</span><span class="s2">sch</span><span class="s1">.</span><span class="s2">validate </span><span class="s1">|| </span><span class="s3">this</span><span class="s1">.</span><span class="s2">_compileSchemaEnv</span><span class="s1">(</span><span class="s2">sch</span><span class="s1">));</span>
    <span class="s1">}</span>
    <span class="s2">compileAsync</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">, </span><span class="s2">meta</span><span class="s1">) {</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">loadSchema </span><span class="s1">!= </span><span class="s0">&quot;function&quot;</span><span class="s1">) {</span>
            <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;options.loadSchema should be a function&quot;</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s3">const </span><span class="s1">{ </span><span class="s2">loadSchema </span><span class="s1">} = </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">;</span>
        <span class="s3">return </span><span class="s2">runCompileAsync</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">schema</span><span class="s1">, </span><span class="s2">meta</span><span class="s1">);</span>
        <span class="s2">async </span><span class="s3">function </span><span class="s2">runCompileAsync</span><span class="s1">(</span><span class="s2">_schema</span><span class="s1">, </span><span class="s2">_meta</span><span class="s1">) {</span>
            <span class="s3">await </span><span class="s2">loadMetaSchema</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">_schema</span><span class="s1">.</span><span class="s2">$schema</span><span class="s1">);</span>
            <span class="s3">const </span><span class="s2">sch </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">_addSchema</span><span class="s1">(</span><span class="s2">_schema</span><span class="s1">, </span><span class="s2">_meta</span><span class="s1">);</span>
            <span class="s3">return </span><span class="s2">sch</span><span class="s1">.</span><span class="s2">validate </span><span class="s1">|| </span><span class="s2">_compileAsync</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">sch</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s2">async </span><span class="s3">function </span><span class="s2">loadMetaSchema</span><span class="s1">(</span><span class="s2">$ref</span><span class="s1">) {</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">$ref </span><span class="s1">&amp;&amp; !</span><span class="s3">this</span><span class="s1">.</span><span class="s2">getSchema</span><span class="s1">(</span><span class="s2">$ref</span><span class="s1">)) {</span>
                <span class="s3">await </span><span class="s2">runCompileAsync</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, { </span><span class="s2">$ref </span><span class="s1">}, </span><span class="s3">true</span><span class="s1">);</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s2">async </span><span class="s3">function </span><span class="s2">_compileAsync</span><span class="s1">(</span><span class="s2">sch</span><span class="s1">) {</span>
            <span class="s3">try </span><span class="s1">{</span>
                <span class="s3">return this</span><span class="s1">.</span><span class="s2">_compileSchemaEnv</span><span class="s1">(</span><span class="s2">sch</span><span class="s1">);</span>
            <span class="s1">}</span>
            <span class="s3">catch </span><span class="s1">(</span><span class="s2">e</span><span class="s1">) {</span>
                <span class="s3">if </span><span class="s1">(!(</span><span class="s2">e </span><span class="s3">instanceof </span><span class="s2">ref_error_1</span><span class="s1">.</span><span class="s2">default</span><span class="s1">))</span>
                    <span class="s3">throw </span><span class="s2">e</span><span class="s1">;</span>
                <span class="s2">checkLoaded</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">e</span><span class="s1">);</span>
                <span class="s3">await </span><span class="s2">loadMissingSchema</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">e</span><span class="s1">.</span><span class="s2">missingSchema</span><span class="s1">);</span>
                <span class="s3">return </span><span class="s2">_compileAsync</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">sch</span><span class="s1">);</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s3">function </span><span class="s2">checkLoaded</span><span class="s1">({ </span><span class="s2">missingSchema</span><span class="s1">: </span><span class="s2">ref</span><span class="s1">, </span><span class="s2">missingRef </span><span class="s1">}) {</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">refs</span><span class="s1">[</span><span class="s2">ref</span><span class="s1">]) {</span>
                <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">`AnySchema </span><span class="s2">$</span><span class="s1">{</span><span class="s2">ref</span><span class="s1">} </span><span class="s0">is loaded but </span><span class="s2">$</span><span class="s1">{</span><span class="s2">missingRef</span><span class="s1">} </span><span class="s0">cannot be resolved`</span><span class="s1">);</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s2">async </span><span class="s3">function </span><span class="s2">loadMissingSchema</span><span class="s1">(</span><span class="s2">ref</span><span class="s1">) {</span>
            <span class="s3">const </span><span class="s2">_schema </span><span class="s1">= </span><span class="s3">await </span><span class="s2">_loadSchema</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">ref</span><span class="s1">);</span>
            <span class="s3">if </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">refs</span><span class="s1">[</span><span class="s2">ref</span><span class="s1">])</span>
                <span class="s3">await </span><span class="s2">loadMetaSchema</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">_schema</span><span class="s1">.</span><span class="s2">$schema</span><span class="s1">);</span>
            <span class="s3">if </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">refs</span><span class="s1">[</span><span class="s2">ref</span><span class="s1">])</span>
                <span class="s3">this</span><span class="s1">.</span><span class="s2">addSchema</span><span class="s1">(</span><span class="s2">_schema</span><span class="s1">, </span><span class="s2">ref</span><span class="s1">, </span><span class="s2">meta</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s2">async </span><span class="s3">function </span><span class="s2">_loadSchema</span><span class="s1">(</span><span class="s2">ref</span><span class="s1">) {</span>
            <span class="s3">const </span><span class="s2">p </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">_loading</span><span class="s1">[</span><span class="s2">ref</span><span class="s1">];</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">p</span><span class="s1">)</span>
                <span class="s3">return </span><span class="s2">p</span><span class="s1">;</span>
            <span class="s3">try </span><span class="s1">{</span>
                <span class="s3">return await </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">_loading</span><span class="s1">[</span><span class="s2">ref</span><span class="s1">] = </span><span class="s2">loadSchema</span><span class="s1">(</span><span class="s2">ref</span><span class="s1">));</span>
            <span class="s1">}</span>
            <span class="s3">finally </span><span class="s1">{</span>
                <span class="s3">delete this</span><span class="s1">.</span><span class="s2">_loading</span><span class="s1">[</span><span class="s2">ref</span><span class="s1">];</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s5">// Adds schema to the instance</span>
    <span class="s2">addSchema</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">, </span><span class="s5">// If array is passed, `key` will be ignored</span>
    <span class="s2">key</span><span class="s1">, </span><span class="s5">// Optional schema key. Can be passed to `validate` method instead of schema object or id/ref. One schema per instance can have empty `id` and `key`.</span>
    <span class="s2">_meta</span><span class="s1">, </span><span class="s5">// true if schema is a meta-schema. Used internally, addMetaSchema should be used instead.</span>
    <span class="s2">_validateSchema </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">validateSchema </span><span class="s5">// false to skip schema validation. Used internally, option validateSchema should be used instead.</span>
    <span class="s1">) {</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">)) {</span>
            <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">sch of schema</span><span class="s1">)</span>
                <span class="s3">this</span><span class="s1">.</span><span class="s2">addSchema</span><span class="s1">(</span><span class="s2">sch</span><span class="s1">, </span><span class="s2">undefined</span><span class="s1">, </span><span class="s2">_meta</span><span class="s1">, </span><span class="s2">_validateSchema</span><span class="s1">);</span>
            <span class="s3">return this</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s3">let </span><span class="s2">id</span><span class="s1">;</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">schema </span><span class="s1">=== </span><span class="s0">&quot;object&quot;</span><span class="s1">) {</span>
            <span class="s3">const </span><span class="s1">{ </span><span class="s2">schemaId </span><span class="s1">} = </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">;</span>
            <span class="s2">id </span><span class="s1">= </span><span class="s2">schema</span><span class="s1">[</span><span class="s2">schemaId</span><span class="s1">];</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">id </span><span class="s1">!== </span><span class="s2">undefined </span><span class="s1">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">id </span><span class="s1">!= </span><span class="s0">&quot;string&quot;</span><span class="s1">) {</span>
                <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">`schema </span><span class="s2">$</span><span class="s1">{</span><span class="s2">schemaId</span><span class="s1">} </span><span class="s0">must be string`</span><span class="s1">);</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s2">key </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">resolve_1</span><span class="s1">.</span><span class="s2">normalizeId</span><span class="s1">)(</span><span class="s2">key </span><span class="s1">|| </span><span class="s2">id</span><span class="s1">);</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">_checkUnique</span><span class="s1">(</span><span class="s2">key</span><span class="s1">);</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">schemas</span><span class="s1">[</span><span class="s2">key</span><span class="s1">] = </span><span class="s3">this</span><span class="s1">.</span><span class="s2">_addSchema</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">, </span><span class="s2">_meta</span><span class="s1">, </span><span class="s2">key</span><span class="s1">, </span><span class="s2">_validateSchema</span><span class="s1">, </span><span class="s3">true</span><span class="s1">);</span>
        <span class="s3">return this</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s5">// Add schema that will be used to validate other schemas</span>
    <span class="s5">// options in META_IGNORE_OPTIONS are alway set to false</span>
    <span class="s2">addMetaSchema</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">, </span><span class="s2">key</span><span class="s1">, </span><span class="s5">// schema key</span>
    <span class="s2">_validateSchema </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">validateSchema </span><span class="s5">// false to skip schema validation, can be used to override validateSchema option for meta-schema</span>
    <span class="s1">) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">addSchema</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">, </span><span class="s2">key</span><span class="s1">, </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_validateSchema</span><span class="s1">);</span>
        <span class="s3">return this</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s5">//  Validate schema against its meta-schema</span>
    <span class="s2">validateSchema</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">, </span><span class="s2">throwOrLogError</span><span class="s1">) {</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">schema </span><span class="s1">== </span><span class="s0">&quot;boolean&quot;</span><span class="s1">)</span>
            <span class="s3">return true</span><span class="s1">;</span>
        <span class="s3">let </span><span class="s2">$schema</span><span class="s1">;</span>
        <span class="s2">$schema </span><span class="s1">= </span><span class="s2">schema</span><span class="s1">.</span><span class="s2">$schema</span><span class="s1">;</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">$schema </span><span class="s1">!== </span><span class="s2">undefined </span><span class="s1">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">$schema </span><span class="s1">!= </span><span class="s0">&quot;string&quot;</span><span class="s1">) {</span>
            <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;$schema must be a string&quot;</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s2">$schema </span><span class="s1">= </span><span class="s2">$schema </span><span class="s1">|| </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">defaultMeta </span><span class="s1">|| </span><span class="s3">this</span><span class="s1">.</span><span class="s2">defaultMeta</span><span class="s1">();</span>
        <span class="s3">if </span><span class="s1">(!</span><span class="s2">$schema</span><span class="s1">) {</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">logger</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s0">&quot;meta-schema not available&quot;</span><span class="s1">);</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">errors </span><span class="s1">= </span><span class="s3">null</span><span class="s1">;</span>
            <span class="s3">return true</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s3">const </span><span class="s2">valid </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">validate</span><span class="s1">(</span><span class="s2">$schema</span><span class="s1">, </span><span class="s2">schema</span><span class="s1">);</span>
        <span class="s3">if </span><span class="s1">(!</span><span class="s2">valid </span><span class="s1">&amp;&amp; </span><span class="s2">throwOrLogError</span><span class="s1">) {</span>
            <span class="s3">const </span><span class="s2">message </span><span class="s1">= </span><span class="s0">&quot;schema is invalid: &quot; </span><span class="s1">+ </span><span class="s3">this</span><span class="s1">.</span><span class="s2">errorsText</span><span class="s1">();</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">validateSchema </span><span class="s1">=== </span><span class="s0">&quot;log&quot;</span><span class="s1">)</span>
                <span class="s3">this</span><span class="s1">.</span><span class="s2">logger</span><span class="s1">.</span><span class="s2">error</span><span class="s1">(</span><span class="s2">message</span><span class="s1">);</span>
            <span class="s3">else</span>
                <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s2">message</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s3">return </span><span class="s2">valid</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s5">// Get compiled schema by `key` or `ref`.</span>
    <span class="s5">// (`key` that was passed to `addSchema` or full schema reference - `schema.$id` or resolved id)</span>
    <span class="s2">getSchema</span><span class="s1">(</span><span class="s2">keyRef</span><span class="s1">) {</span>
        <span class="s3">let </span><span class="s2">sch</span><span class="s1">;</span>
        <span class="s3">while </span><span class="s1">(</span><span class="s3">typeof </span><span class="s1">(</span><span class="s2">sch </span><span class="s1">= </span><span class="s2">getSchEnv</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">keyRef</span><span class="s1">)) == </span><span class="s0">&quot;string&quot;</span><span class="s1">)</span>
            <span class="s2">keyRef </span><span class="s1">= </span><span class="s2">sch</span><span class="s1">;</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">sch </span><span class="s1">=== </span><span class="s2">undefined</span><span class="s1">) {</span>
            <span class="s3">const </span><span class="s1">{ </span><span class="s2">schemaId </span><span class="s1">} = </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">;</span>
            <span class="s3">const </span><span class="s2">root </span><span class="s1">= </span><span class="s3">new </span><span class="s2">compile_1</span><span class="s1">.</span><span class="s2">SchemaEnv</span><span class="s1">({ </span><span class="s2">schema</span><span class="s1">: {}, </span><span class="s2">schemaId </span><span class="s1">});</span>
            <span class="s2">sch </span><span class="s1">= </span><span class="s2">compile_1</span><span class="s1">.</span><span class="s2">resolveSchema</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">root</span><span class="s1">, </span><span class="s2">keyRef</span><span class="s1">);</span>
            <span class="s3">if </span><span class="s1">(!</span><span class="s2">sch</span><span class="s1">)</span>
                <span class="s3">return</span><span class="s1">;</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">refs</span><span class="s1">[</span><span class="s2">keyRef</span><span class="s1">] = </span><span class="s2">sch</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s3">return </span><span class="s1">(</span><span class="s2">sch</span><span class="s1">.</span><span class="s2">validate </span><span class="s1">|| </span><span class="s3">this</span><span class="s1">.</span><span class="s2">_compileSchemaEnv</span><span class="s1">(</span><span class="s2">sch</span><span class="s1">));</span>
    <span class="s1">}</span>
    <span class="s5">// Remove cached schema(s).</span>
    <span class="s5">// If no parameter is passed all schemas but meta-schemas are removed.</span>
    <span class="s5">// If RegExp is passed all schemas with key/id matching pattern but meta-schemas are removed.</span>
    <span class="s5">// Even if schema is referenced by other schemas it still can be removed as other schemas have local references.</span>
    <span class="s2">removeSchema</span><span class="s1">(</span><span class="s2">schemaKeyRef</span><span class="s1">) {</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">schemaKeyRef </span><span class="s3">instanceof </span><span class="s2">RegExp</span><span class="s1">) {</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">_removeAllSchemas</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">schemas</span><span class="s1">, </span><span class="s2">schemaKeyRef</span><span class="s1">);</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">_removeAllSchemas</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">refs</span><span class="s1">, </span><span class="s2">schemaKeyRef</span><span class="s1">);</span>
            <span class="s3">return this</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s3">switch </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">schemaKeyRef</span><span class="s1">) {</span>
            <span class="s3">case </span><span class="s0">&quot;undefined&quot;</span><span class="s1">:</span>
                <span class="s3">this</span><span class="s1">.</span><span class="s2">_removeAllSchemas</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">schemas</span><span class="s1">);</span>
                <span class="s3">this</span><span class="s1">.</span><span class="s2">_removeAllSchemas</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">refs</span><span class="s1">);</span>
                <span class="s3">this</span><span class="s1">.</span><span class="s2">_cache</span><span class="s1">.</span><span class="s2">clear</span><span class="s1">();</span>
                <span class="s3">return this</span><span class="s1">;</span>
            <span class="s3">case </span><span class="s0">&quot;string&quot;</span><span class="s1">: {</span>
                <span class="s3">const </span><span class="s2">sch </span><span class="s1">= </span><span class="s2">getSchEnv</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">schemaKeyRef</span><span class="s1">);</span>
                <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">sch </span><span class="s1">== </span><span class="s0">&quot;object&quot;</span><span class="s1">)</span>
                    <span class="s3">this</span><span class="s1">.</span><span class="s2">_cache</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">sch</span><span class="s1">.</span><span class="s2">schema</span><span class="s1">);</span>
                <span class="s3">delete this</span><span class="s1">.</span><span class="s2">schemas</span><span class="s1">[</span><span class="s2">schemaKeyRef</span><span class="s1">];</span>
                <span class="s3">delete this</span><span class="s1">.</span><span class="s2">refs</span><span class="s1">[</span><span class="s2">schemaKeyRef</span><span class="s1">];</span>
                <span class="s3">return this</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s3">case </span><span class="s0">&quot;object&quot;</span><span class="s1">: {</span>
                <span class="s3">const </span><span class="s2">cacheKey </span><span class="s1">= </span><span class="s2">schemaKeyRef</span><span class="s1">;</span>
                <span class="s3">this</span><span class="s1">.</span><span class="s2">_cache</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">cacheKey</span><span class="s1">);</span>
                <span class="s3">let </span><span class="s2">id </span><span class="s1">= </span><span class="s2">schemaKeyRef</span><span class="s1">[</span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">schemaId</span><span class="s1">];</span>
                <span class="s3">if </span><span class="s1">(</span><span class="s2">id</span><span class="s1">) {</span>
                    <span class="s2">id </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">resolve_1</span><span class="s1">.</span><span class="s2">normalizeId</span><span class="s1">)(</span><span class="s2">id</span><span class="s1">);</span>
                    <span class="s3">delete this</span><span class="s1">.</span><span class="s2">schemas</span><span class="s1">[</span><span class="s2">id</span><span class="s1">];</span>
                    <span class="s3">delete this</span><span class="s1">.</span><span class="s2">refs</span><span class="s1">[</span><span class="s2">id</span><span class="s1">];</span>
                <span class="s1">}</span>
                <span class="s3">return this</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s3">default</span><span class="s1">:</span>
                <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;ajv.removeSchema: invalid parameter&quot;</span><span class="s1">);</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s5">// add &quot;vocabulary&quot; - a collection of keywords</span>
    <span class="s2">addVocabulary</span><span class="s1">(</span><span class="s2">definitions</span><span class="s1">) {</span>
        <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">def of definitions</span><span class="s1">)</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">addKeyword</span><span class="s1">(</span><span class="s2">def</span><span class="s1">);</span>
        <span class="s3">return this</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">addKeyword</span><span class="s1">(</span><span class="s2">kwdOrDef</span><span class="s1">, </span><span class="s2">def </span><span class="s5">// deprecated</span>
    <span class="s1">) {</span>
        <span class="s3">let </span><span class="s2">keyword</span><span class="s1">;</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">kwdOrDef </span><span class="s1">== </span><span class="s0">&quot;string&quot;</span><span class="s1">) {</span>
            <span class="s2">keyword </span><span class="s1">= </span><span class="s2">kwdOrDef</span><span class="s1">;</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">def </span><span class="s1">== </span><span class="s0">&quot;object&quot;</span><span class="s1">) {</span>
                <span class="s3">this</span><span class="s1">.</span><span class="s2">logger</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s0">&quot;these parameters are deprecated, see docs for addKeyword&quot;</span><span class="s1">);</span>
                <span class="s2">def</span><span class="s1">.</span><span class="s2">keyword </span><span class="s1">= </span><span class="s2">keyword</span><span class="s1">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s3">else if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">kwdOrDef </span><span class="s1">== </span><span class="s0">&quot;object&quot; </span><span class="s1">&amp;&amp; </span><span class="s2">def </span><span class="s1">=== </span><span class="s2">undefined</span><span class="s1">) {</span>
            <span class="s2">def </span><span class="s1">= </span><span class="s2">kwdOrDef</span><span class="s1">;</span>
            <span class="s2">keyword </span><span class="s1">= </span><span class="s2">def</span><span class="s1">.</span><span class="s2">keyword</span><span class="s1">;</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">keyword</span><span class="s1">) &amp;&amp; !</span><span class="s2">keyword</span><span class="s1">.</span><span class="s2">length</span><span class="s1">) {</span>
                <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;addKeywords: keyword must be string or non-empty array&quot;</span><span class="s1">);</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s3">else </span><span class="s1">{</span>
            <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;invalid addKeywords parameters&quot;</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s2">checkKeyword</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">keyword</span><span class="s1">, </span><span class="s2">def</span><span class="s1">);</span>
        <span class="s3">if </span><span class="s1">(!</span><span class="s2">def</span><span class="s1">) {</span>
            <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">util_1</span><span class="s1">.</span><span class="s2">eachItem</span><span class="s1">)(</span><span class="s2">keyword</span><span class="s1">, (</span><span class="s2">kwd</span><span class="s1">) =&gt; </span><span class="s2">addRule</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">kwd</span><span class="s1">));</span>
            <span class="s3">return this</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">keywordMetaschema</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">def</span><span class="s1">);</span>
        <span class="s3">const </span><span class="s2">definition </span><span class="s1">= {</span>
            <span class="s2">...def</span><span class="s1">,</span>
            <span class="s2">type</span><span class="s1">: (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">dataType_1</span><span class="s1">.</span><span class="s2">getJSONTypes</span><span class="s1">)(</span><span class="s2">def</span><span class="s1">.</span><span class="s2">type</span><span class="s1">),</span>
            <span class="s2">schemaType</span><span class="s1">: (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">dataType_1</span><span class="s1">.</span><span class="s2">getJSONTypes</span><span class="s1">)(</span><span class="s2">def</span><span class="s1">.</span><span class="s2">schemaType</span><span class="s1">),</span>
        <span class="s1">};</span>
        <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">util_1</span><span class="s1">.</span><span class="s2">eachItem</span><span class="s1">)(</span><span class="s2">keyword</span><span class="s1">, </span><span class="s2">definition</span><span class="s1">.</span><span class="s2">type</span><span class="s1">.</span><span class="s2">length </span><span class="s1">=== </span><span class="s4">0</span>
            <span class="s1">? (</span><span class="s2">k</span><span class="s1">) =&gt; </span><span class="s2">addRule</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">k</span><span class="s1">, </span><span class="s2">definition</span><span class="s1">)</span>
            <span class="s1">: (</span><span class="s2">k</span><span class="s1">) =&gt; </span><span class="s2">definition</span><span class="s1">.</span><span class="s2">type</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">((</span><span class="s2">t</span><span class="s1">) =&gt; </span><span class="s2">addRule</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">k</span><span class="s1">, </span><span class="s2">definition</span><span class="s1">, </span><span class="s2">t</span><span class="s1">)));</span>
        <span class="s3">return this</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">getKeyword</span><span class="s1">(</span><span class="s2">keyword</span><span class="s1">) {</span>
        <span class="s3">const </span><span class="s2">rule </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">RULES</span><span class="s1">.</span><span class="s2">all</span><span class="s1">[</span><span class="s2">keyword</span><span class="s1">];</span>
        <span class="s3">return typeof </span><span class="s2">rule </span><span class="s1">== </span><span class="s0">&quot;object&quot; </span><span class="s1">? </span><span class="s2">rule</span><span class="s1">.</span><span class="s2">definition </span><span class="s1">: !!</span><span class="s2">rule</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s5">// Remove keyword</span>
    <span class="s2">removeKeyword</span><span class="s1">(</span><span class="s2">keyword</span><span class="s1">) {</span>
        <span class="s5">// TODO return type should be Ajv</span>
        <span class="s3">const </span><span class="s1">{ </span><span class="s2">RULES </span><span class="s1">} = </span><span class="s3">this</span><span class="s1">;</span>
        <span class="s3">delete </span><span class="s2">RULES</span><span class="s1">.</span><span class="s2">keywords</span><span class="s1">[</span><span class="s2">keyword</span><span class="s1">];</span>
        <span class="s3">delete </span><span class="s2">RULES</span><span class="s1">.</span><span class="s2">all</span><span class="s1">[</span><span class="s2">keyword</span><span class="s1">];</span>
        <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">group of RULES</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">) {</span>
            <span class="s3">const </span><span class="s2">i </span><span class="s1">= </span><span class="s2">group</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">findIndex</span><span class="s1">((</span><span class="s2">rule</span><span class="s1">) =&gt; </span><span class="s2">rule</span><span class="s1">.</span><span class="s2">keyword </span><span class="s1">=== </span><span class="s2">keyword</span><span class="s1">);</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">i </span><span class="s1">&gt;= </span><span class="s4">0</span><span class="s1">)</span>
                <span class="s2">group</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">splice</span><span class="s1">(</span><span class="s2">i</span><span class="s1">, </span><span class="s4">1</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s3">return this</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s5">// Add format</span>
    <span class="s2">addFormat</span><span class="s1">(</span><span class="s2">name</span><span class="s1">, </span><span class="s2">format</span><span class="s1">) {</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">format </span><span class="s1">== </span><span class="s0">&quot;string&quot;</span><span class="s1">)</span>
            <span class="s2">format </span><span class="s1">= </span><span class="s3">new </span><span class="s2">RegExp</span><span class="s1">(</span><span class="s2">format</span><span class="s1">);</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">formats</span><span class="s1">[</span><span class="s2">name</span><span class="s1">] = </span><span class="s2">format</span><span class="s1">;</span>
        <span class="s3">return this</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">errorsText</span><span class="s1">(</span><span class="s2">errors </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">errors</span><span class="s1">, </span><span class="s5">// optional array of validation errors</span>
    <span class="s1">{ </span><span class="s2">separator </span><span class="s1">= </span><span class="s0">&quot;, &quot;</span><span class="s1">, </span><span class="s2">dataVar </span><span class="s1">= </span><span class="s0">&quot;data&quot; </span><span class="s1">} = {} </span><span class="s5">// optional options with properties `separator` and `dataVar`</span>
    <span class="s1">) {</span>
        <span class="s3">if </span><span class="s1">(!</span><span class="s2">errors </span><span class="s1">|| </span><span class="s2">errors</span><span class="s1">.</span><span class="s2">length </span><span class="s1">=== </span><span class="s4">0</span><span class="s1">)</span>
            <span class="s3">return </span><span class="s0">&quot;No errors&quot;</span><span class="s1">;</span>
        <span class="s3">return </span><span class="s2">errors</span>
            <span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">) =&gt; </span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">dataVar</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">instancePath</span><span class="s1">} </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">message</span><span class="s1">}</span><span class="s0">`</span><span class="s1">)</span>
            <span class="s1">.</span><span class="s2">reduce</span><span class="s1">((</span><span class="s2">text</span><span class="s1">, </span><span class="s2">msg</span><span class="s1">) =&gt; </span><span class="s2">text </span><span class="s1">+ </span><span class="s2">separator </span><span class="s1">+ </span><span class="s2">msg</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">$dataMetaSchema</span><span class="s1">(</span><span class="s2">metaSchema</span><span class="s1">, </span><span class="s2">keywordsJsonPointers</span><span class="s1">) {</span>
        <span class="s3">const </span><span class="s2">rules </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">RULES</span><span class="s1">.</span><span class="s2">all</span><span class="s1">;</span>
        <span class="s2">metaSchema </span><span class="s1">= </span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">parse</span><span class="s1">(</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">metaSchema</span><span class="s1">));</span>
        <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">jsonPointer of keywordsJsonPointers</span><span class="s1">) {</span>
            <span class="s3">const </span><span class="s2">segments </span><span class="s1">= </span><span class="s2">jsonPointer</span><span class="s1">.</span><span class="s2">split</span><span class="s1">(</span><span class="s0">&quot;/&quot;</span><span class="s1">).</span><span class="s2">slice</span><span class="s1">(</span><span class="s4">1</span><span class="s1">); </span><span class="s5">// first segment is an empty string</span>
            <span class="s3">let </span><span class="s2">keywords </span><span class="s1">= </span><span class="s2">metaSchema</span><span class="s1">;</span>
            <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">seg of segments</span><span class="s1">)</span>
                <span class="s2">keywords </span><span class="s1">= </span><span class="s2">keywords</span><span class="s1">[</span><span class="s2">seg</span><span class="s1">];</span>
            <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">key </span><span class="s3">in </span><span class="s2">rules</span><span class="s1">) {</span>
                <span class="s3">const </span><span class="s2">rule </span><span class="s1">= </span><span class="s2">rules</span><span class="s1">[</span><span class="s2">key</span><span class="s1">];</span>
                <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">rule </span><span class="s1">!= </span><span class="s0">&quot;object&quot;</span><span class="s1">)</span>
                    <span class="s3">continue</span><span class="s1">;</span>
                <span class="s3">const </span><span class="s1">{ </span><span class="s2">$data </span><span class="s1">} = </span><span class="s2">rule</span><span class="s1">.</span><span class="s2">definition</span><span class="s1">;</span>
                <span class="s3">const </span><span class="s2">schema </span><span class="s1">= </span><span class="s2">keywords</span><span class="s1">[</span><span class="s2">key</span><span class="s1">];</span>
                <span class="s3">if </span><span class="s1">(</span><span class="s2">$data </span><span class="s1">&amp;&amp; </span><span class="s2">schema</span><span class="s1">)</span>
                    <span class="s2">keywords</span><span class="s1">[</span><span class="s2">key</span><span class="s1">] = </span><span class="s2">schemaOrData</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">);</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s3">return </span><span class="s2">metaSchema</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">_removeAllSchemas</span><span class="s1">(</span><span class="s2">schemas</span><span class="s1">, </span><span class="s2">regex</span><span class="s1">) {</span>
        <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">keyRef </span><span class="s3">in </span><span class="s2">schemas</span><span class="s1">) {</span>
            <span class="s3">const </span><span class="s2">sch </span><span class="s1">= </span><span class="s2">schemas</span><span class="s1">[</span><span class="s2">keyRef</span><span class="s1">];</span>
            <span class="s3">if </span><span class="s1">(!</span><span class="s2">regex </span><span class="s1">|| </span><span class="s2">regex</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">keyRef</span><span class="s1">)) {</span>
                <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">sch </span><span class="s1">== </span><span class="s0">&quot;string&quot;</span><span class="s1">) {</span>
                    <span class="s3">delete </span><span class="s2">schemas</span><span class="s1">[</span><span class="s2">keyRef</span><span class="s1">];</span>
                <span class="s1">}</span>
                <span class="s3">else if </span><span class="s1">(</span><span class="s2">sch </span><span class="s1">&amp;&amp; !</span><span class="s2">sch</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">) {</span>
                    <span class="s3">this</span><span class="s1">.</span><span class="s2">_cache</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">sch</span><span class="s1">.</span><span class="s2">schema</span><span class="s1">);</span>
                    <span class="s3">delete </span><span class="s2">schemas</span><span class="s1">[</span><span class="s2">keyRef</span><span class="s1">];</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">_addSchema</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">, </span><span class="s2">meta</span><span class="s1">, </span><span class="s2">baseId</span><span class="s1">, </span><span class="s2">validateSchema </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">validateSchema</span><span class="s1">, </span><span class="s2">addSchema </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">addUsedSchema</span><span class="s1">) {</span>
        <span class="s3">let </span><span class="s2">id</span><span class="s1">;</span>
        <span class="s3">const </span><span class="s1">{ </span><span class="s2">schemaId </span><span class="s1">} = </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">;</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">schema </span><span class="s1">== </span><span class="s0">&quot;object&quot;</span><span class="s1">) {</span>
            <span class="s2">id </span><span class="s1">= </span><span class="s2">schema</span><span class="s1">[</span><span class="s2">schemaId</span><span class="s1">];</span>
        <span class="s1">}</span>
        <span class="s3">else </span><span class="s1">{</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">jtd</span><span class="s1">)</span>
                <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;schema must be object&quot;</span><span class="s1">);</span>
            <span class="s3">else if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">schema </span><span class="s1">!= </span><span class="s0">&quot;boolean&quot;</span><span class="s1">)</span>
                <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;schema must be object or boolean&quot;</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s3">let </span><span class="s2">sch </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">_cache</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">);</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">sch </span><span class="s1">!== </span><span class="s2">undefined</span><span class="s1">)</span>
            <span class="s3">return </span><span class="s2">sch</span><span class="s1">;</span>
        <span class="s2">baseId </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">resolve_1</span><span class="s1">.</span><span class="s2">normalizeId</span><span class="s1">)(</span><span class="s2">id </span><span class="s1">|| </span><span class="s2">baseId</span><span class="s1">);</span>
        <span class="s3">const </span><span class="s2">localRefs </span><span class="s1">= </span><span class="s2">resolve_1</span><span class="s1">.</span><span class="s2">getSchemaRefs</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">schema</span><span class="s1">, </span><span class="s2">baseId</span><span class="s1">);</span>
        <span class="s2">sch </span><span class="s1">= </span><span class="s3">new </span><span class="s2">compile_1</span><span class="s1">.</span><span class="s2">SchemaEnv</span><span class="s1">({ </span><span class="s2">schema</span><span class="s1">, </span><span class="s2">schemaId</span><span class="s1">, </span><span class="s2">meta</span><span class="s1">, </span><span class="s2">baseId</span><span class="s1">, </span><span class="s2">localRefs </span><span class="s1">});</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">_cache</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">sch</span><span class="s1">.</span><span class="s2">schema</span><span class="s1">, </span><span class="s2">sch</span><span class="s1">);</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">addSchema </span><span class="s1">&amp;&amp; !</span><span class="s2">baseId</span><span class="s1">.</span><span class="s2">startsWith</span><span class="s1">(</span><span class="s0">&quot;#&quot;</span><span class="s1">)) {</span>
            <span class="s5">// TODO atm it is allowed to overwrite schemas without id (instead of not adding them)</span>
            <span class="s3">if </span><span class="s1">(</span><span class="s2">baseId</span><span class="s1">)</span>
                <span class="s3">this</span><span class="s1">.</span><span class="s2">_checkUnique</span><span class="s1">(</span><span class="s2">baseId</span><span class="s1">);</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">refs</span><span class="s1">[</span><span class="s2">baseId</span><span class="s1">] = </span><span class="s2">sch</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">validateSchema</span><span class="s1">)</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">validateSchema</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">, </span><span class="s3">true</span><span class="s1">);</span>
        <span class="s3">return </span><span class="s2">sch</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">_checkUnique</span><span class="s1">(</span><span class="s2">id</span><span class="s1">) {</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">schemas</span><span class="s1">[</span><span class="s2">id</span><span class="s1">] || </span><span class="s3">this</span><span class="s1">.</span><span class="s2">refs</span><span class="s1">[</span><span class="s2">id</span><span class="s1">]) {</span>
            <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">`schema with key or id &quot;</span><span class="s2">$</span><span class="s1">{</span><span class="s2">id</span><span class="s1">}</span><span class="s0">&quot; already exists`</span><span class="s1">);</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">_compileSchemaEnv</span><span class="s1">(</span><span class="s2">sch</span><span class="s1">) {</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">sch</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">)</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">_compileMetaSchema</span><span class="s1">(</span><span class="s2">sch</span><span class="s1">);</span>
        <span class="s3">else</span>
            <span class="s2">compile_1</span><span class="s1">.</span><span class="s2">compileSchema</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">sch</span><span class="s1">);</span>
        <span class="s5">/* istanbul ignore if */</span>
        <span class="s3">if </span><span class="s1">(!</span><span class="s2">sch</span><span class="s1">.</span><span class="s2">validate</span><span class="s1">)</span>
            <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;ajv implementation error&quot;</span><span class="s1">);</span>
        <span class="s3">return </span><span class="s2">sch</span><span class="s1">.</span><span class="s2">validate</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">_compileMetaSchema</span><span class="s1">(</span><span class="s2">sch</span><span class="s1">) {</span>
        <span class="s3">const </span><span class="s2">currentOpts </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">;</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">opts </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">_metaOpts</span><span class="s1">;</span>
        <span class="s3">try </span><span class="s1">{</span>
            <span class="s2">compile_1</span><span class="s1">.</span><span class="s2">compileSchema</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">sch</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s3">finally </span><span class="s1">{</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">opts </span><span class="s1">= </span><span class="s2">currentOpts</span><span class="s1">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s2">exports</span><span class="s1">.</span><span class="s2">default </span><span class="s1">= </span><span class="s2">Ajv</span><span class="s1">;</span>
<span class="s2">Ajv</span><span class="s1">.</span><span class="s2">ValidationError </span><span class="s1">= </span><span class="s2">validation_error_1</span><span class="s1">.</span><span class="s2">default</span><span class="s1">;</span>
<span class="s2">Ajv</span><span class="s1">.</span><span class="s2">MissingRefError </span><span class="s1">= </span><span class="s2">ref_error_1</span><span class="s1">.</span><span class="s2">default</span><span class="s1">;</span>
<span class="s3">function </span><span class="s2">checkOptions</span><span class="s1">(</span><span class="s2">checkOpts</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">msg</span><span class="s1">, </span><span class="s2">log </span><span class="s1">= </span><span class="s0">&quot;error&quot;</span><span class="s1">) {</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">key </span><span class="s3">in </span><span class="s2">checkOpts</span><span class="s1">) {</span>
        <span class="s3">const </span><span class="s2">opt </span><span class="s1">= </span><span class="s2">key</span><span class="s1">;</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">opt </span><span class="s3">in </span><span class="s2">options</span><span class="s1">)</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">logger</span><span class="s1">[</span><span class="s2">log</span><span class="s1">](</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">msg</span><span class="s1">}</span><span class="s0">: option </span><span class="s2">$</span><span class="s1">{</span><span class="s2">key</span><span class="s1">}</span><span class="s0">. </span><span class="s2">$</span><span class="s1">{</span><span class="s2">checkOpts</span><span class="s1">[</span><span class="s2">opt</span><span class="s1">]}</span><span class="s0">`</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">getSchEnv</span><span class="s1">(</span><span class="s2">keyRef</span><span class="s1">) {</span>
    <span class="s2">keyRef </span><span class="s1">= (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">resolve_1</span><span class="s1">.</span><span class="s2">normalizeId</span><span class="s1">)(</span><span class="s2">keyRef</span><span class="s1">); </span><span class="s5">// TODO tests fail without this line</span>
    <span class="s3">return this</span><span class="s1">.</span><span class="s2">schemas</span><span class="s1">[</span><span class="s2">keyRef</span><span class="s1">] || </span><span class="s3">this</span><span class="s1">.</span><span class="s2">refs</span><span class="s1">[</span><span class="s2">keyRef</span><span class="s1">];</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">addInitialSchemas</span><span class="s1">() {</span>
    <span class="s3">const </span><span class="s2">optsSchemas </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">schemas</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s2">optsSchemas</span><span class="s1">)</span>
        <span class="s3">return</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">optsSchemas</span><span class="s1">))</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">addSchema</span><span class="s1">(</span><span class="s2">optsSchemas</span><span class="s1">);</span>
    <span class="s3">else</span>
        <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">key </span><span class="s3">in </span><span class="s2">optsSchemas</span><span class="s1">)</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">addSchema</span><span class="s1">(</span><span class="s2">optsSchemas</span><span class="s1">[</span><span class="s2">key</span><span class="s1">], </span><span class="s2">key</span><span class="s1">);</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">addInitialFormats</span><span class="s1">() {</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">name </span><span class="s3">in this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">formats</span><span class="s1">) {</span>
        <span class="s3">const </span><span class="s2">format </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">formats</span><span class="s1">[</span><span class="s2">name</span><span class="s1">];</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">format</span><span class="s1">)</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">addFormat</span><span class="s1">(</span><span class="s2">name</span><span class="s1">, </span><span class="s2">format</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">addInitialKeywords</span><span class="s1">(</span><span class="s2">defs</span><span class="s1">) {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">defs</span><span class="s1">)) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">addVocabulary</span><span class="s1">(</span><span class="s2">defs</span><span class="s1">);</span>
        <span class="s3">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">logger</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s0">&quot;keywords option as map is deprecated, pass array&quot;</span><span class="s1">);</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">keyword </span><span class="s3">in </span><span class="s2">defs</span><span class="s1">) {</span>
        <span class="s3">const </span><span class="s2">def </span><span class="s1">= </span><span class="s2">defs</span><span class="s1">[</span><span class="s2">keyword</span><span class="s1">];</span>
        <span class="s3">if </span><span class="s1">(!</span><span class="s2">def</span><span class="s1">.</span><span class="s2">keyword</span><span class="s1">)</span>
            <span class="s2">def</span><span class="s1">.</span><span class="s2">keyword </span><span class="s1">= </span><span class="s2">keyword</span><span class="s1">;</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">addKeyword</span><span class="s1">(</span><span class="s2">def</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">getMetaSchemaOptions</span><span class="s1">() {</span>
    <span class="s3">const </span><span class="s2">metaOpts </span><span class="s1">= { </span><span class="s2">...</span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts </span><span class="s1">};</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">opt of META_IGNORE_OPTIONS</span><span class="s1">)</span>
        <span class="s3">delete </span><span class="s2">metaOpts</span><span class="s1">[</span><span class="s2">opt</span><span class="s1">];</span>
    <span class="s3">return </span><span class="s2">metaOpts</span><span class="s1">;</span>
<span class="s1">}</span>
<span class="s3">const </span><span class="s2">noLogs </span><span class="s1">= { </span><span class="s2">log</span><span class="s1">() { }, </span><span class="s2">warn</span><span class="s1">() { }, </span><span class="s2">error</span><span class="s1">() { } };</span>
<span class="s3">function </span><span class="s2">getLogger</span><span class="s1">(</span><span class="s2">logger</span><span class="s1">) {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">logger </span><span class="s1">=== </span><span class="s3">false</span><span class="s1">)</span>
        <span class="s3">return </span><span class="s2">noLogs</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">logger </span><span class="s1">=== </span><span class="s2">undefined</span><span class="s1">)</span>
        <span class="s3">return </span><span class="s2">console</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">logger</span><span class="s1">.</span><span class="s2">log </span><span class="s1">&amp;&amp; </span><span class="s2">logger</span><span class="s1">.</span><span class="s2">warn </span><span class="s1">&amp;&amp; </span><span class="s2">logger</span><span class="s1">.</span><span class="s2">error</span><span class="s1">)</span>
        <span class="s3">return </span><span class="s2">logger</span><span class="s1">;</span>
    <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;logger must implement log, warn and error methods&quot;</span><span class="s1">);</span>
<span class="s1">}</span>
<span class="s3">const </span><span class="s2">KEYWORD_NAME </span><span class="s1">= </span><span class="s6">/^[a-z_$][a-z0-9_$:-]*$/i</span><span class="s1">;</span>
<span class="s3">function </span><span class="s2">checkKeyword</span><span class="s1">(</span><span class="s2">keyword</span><span class="s1">, </span><span class="s2">def</span><span class="s1">) {</span>
    <span class="s3">const </span><span class="s1">{ </span><span class="s2">RULES </span><span class="s1">} = </span><span class="s3">this</span><span class="s1">;</span>
    <span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">util_1</span><span class="s1">.</span><span class="s2">eachItem</span><span class="s1">)(</span><span class="s2">keyword</span><span class="s1">, (</span><span class="s2">kwd</span><span class="s1">) =&gt; {</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">RULES</span><span class="s1">.</span><span class="s2">keywords</span><span class="s1">[</span><span class="s2">kwd</span><span class="s1">])</span>
            <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">`Keyword </span><span class="s2">$</span><span class="s1">{</span><span class="s2">kwd</span><span class="s1">} </span><span class="s0">is already defined`</span><span class="s1">);</span>
        <span class="s3">if </span><span class="s1">(!</span><span class="s2">KEYWORD_NAME</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">kwd</span><span class="s1">))</span>
            <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">`Keyword </span><span class="s2">$</span><span class="s1">{</span><span class="s2">kwd</span><span class="s1">} </span><span class="s0">has invalid name`</span><span class="s1">);</span>
    <span class="s1">});</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s2">def</span><span class="s1">)</span>
        <span class="s3">return</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">def</span><span class="s1">.</span><span class="s2">$data </span><span class="s1">&amp;&amp; !(</span><span class="s0">&quot;code&quot; </span><span class="s3">in </span><span class="s2">def </span><span class="s1">|| </span><span class="s0">&quot;validate&quot; </span><span class="s3">in </span><span class="s2">def</span><span class="s1">)) {</span>
        <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">'$data keyword must have &quot;code&quot; or &quot;validate&quot; function'</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">addRule</span><span class="s1">(</span><span class="s2">keyword</span><span class="s1">, </span><span class="s2">definition</span><span class="s1">, </span><span class="s2">dataType</span><span class="s1">) {</span>
    <span class="s3">var </span><span class="s2">_a</span><span class="s1">;</span>
    <span class="s3">const </span><span class="s2">post </span><span class="s1">= </span><span class="s2">definition </span><span class="s1">=== </span><span class="s3">null </span><span class="s1">|| </span><span class="s2">definition </span><span class="s1">=== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">: </span><span class="s2">definition</span><span class="s1">.</span><span class="s2">post</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">dataType </span><span class="s1">&amp;&amp; </span><span class="s2">post</span><span class="s1">)</span>
        <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">'keyword with &quot;post&quot; flag cannot have &quot;type&quot;'</span><span class="s1">);</span>
    <span class="s3">const </span><span class="s1">{ </span><span class="s2">RULES </span><span class="s1">} = </span><span class="s3">this</span><span class="s1">;</span>
    <span class="s3">let </span><span class="s2">ruleGroup </span><span class="s1">= </span><span class="s2">post </span><span class="s1">? </span><span class="s2">RULES</span><span class="s1">.</span><span class="s2">post </span><span class="s1">: </span><span class="s2">RULES</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">find</span><span class="s1">(({ </span><span class="s2">type</span><span class="s1">: </span><span class="s2">t </span><span class="s1">}) =&gt; </span><span class="s2">t </span><span class="s1">=== </span><span class="s2">dataType</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s2">ruleGroup</span><span class="s1">) {</span>
        <span class="s2">ruleGroup </span><span class="s1">= { </span><span class="s2">type</span><span class="s1">: </span><span class="s2">dataType</span><span class="s1">, </span><span class="s2">rules</span><span class="s1">: [] };</span>
        <span class="s2">RULES</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">ruleGroup</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">RULES</span><span class="s1">.</span><span class="s2">keywords</span><span class="s1">[</span><span class="s2">keyword</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s2">definition</span><span class="s1">)</span>
        <span class="s3">return</span><span class="s1">;</span>
    <span class="s3">const </span><span class="s2">rule </span><span class="s1">= {</span>
        <span class="s2">keyword</span><span class="s1">,</span>
        <span class="s2">definition</span><span class="s1">: {</span>
            <span class="s2">...definition</span><span class="s1">,</span>
            <span class="s2">type</span><span class="s1">: (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">dataType_1</span><span class="s1">.</span><span class="s2">getJSONTypes</span><span class="s1">)(</span><span class="s2">definition</span><span class="s1">.</span><span class="s2">type</span><span class="s1">),</span>
            <span class="s2">schemaType</span><span class="s1">: (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">dataType_1</span><span class="s1">.</span><span class="s2">getJSONTypes</span><span class="s1">)(</span><span class="s2">definition</span><span class="s1">.</span><span class="s2">schemaType</span><span class="s1">),</span>
        <span class="s1">},</span>
    <span class="s1">};</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">definition</span><span class="s1">.</span><span class="s2">before</span><span class="s1">)</span>
        <span class="s2">addBeforeRule</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">ruleGroup</span><span class="s1">, </span><span class="s2">rule</span><span class="s1">, </span><span class="s2">definition</span><span class="s1">.</span><span class="s2">before</span><span class="s1">);</span>
    <span class="s3">else</span>
        <span class="s2">ruleGroup</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">rule</span><span class="s1">);</span>
    <span class="s2">RULES</span><span class="s1">.</span><span class="s2">all</span><span class="s1">[</span><span class="s2">keyword</span><span class="s1">] = </span><span class="s2">rule</span><span class="s1">;</span>
    <span class="s1">(</span><span class="s2">_a </span><span class="s1">= </span><span class="s2">definition</span><span class="s1">.</span><span class="s2">implements</span><span class="s1">) === </span><span class="s3">null </span><span class="s1">|| </span><span class="s2">_a </span><span class="s1">=== </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">? </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">: </span><span class="s2">_a</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">((</span><span class="s2">kwd</span><span class="s1">) =&gt; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">addKeyword</span><span class="s1">(</span><span class="s2">kwd</span><span class="s1">));</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">addBeforeRule</span><span class="s1">(</span><span class="s2">ruleGroup</span><span class="s1">, </span><span class="s2">rule</span><span class="s1">, </span><span class="s2">before</span><span class="s1">) {</span>
    <span class="s3">const </span><span class="s2">i </span><span class="s1">= </span><span class="s2">ruleGroup</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">findIndex</span><span class="s1">((</span><span class="s2">_rule</span><span class="s1">) =&gt; </span><span class="s2">_rule</span><span class="s1">.</span><span class="s2">keyword </span><span class="s1">=== </span><span class="s2">before</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">i </span><span class="s1">&gt;= </span><span class="s4">0</span><span class="s1">) {</span>
        <span class="s2">ruleGroup</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">splice</span><span class="s1">(</span><span class="s2">i</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s2">rule</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">else </span><span class="s1">{</span>
        <span class="s2">ruleGroup</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">rule</span><span class="s1">);</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">logger</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s0">`rule </span><span class="s2">$</span><span class="s1">{</span><span class="s2">before</span><span class="s1">} </span><span class="s0">is not defined`</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s2">keywordMetaschema</span><span class="s1">(</span><span class="s2">def</span><span class="s1">) {</span>
    <span class="s3">let </span><span class="s1">{ </span><span class="s2">metaSchema </span><span class="s1">} = </span><span class="s2">def</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">metaSchema </span><span class="s1">=== </span><span class="s2">undefined</span><span class="s1">)</span>
        <span class="s3">return</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">def</span><span class="s1">.</span><span class="s2">$data </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">opts</span><span class="s1">.</span><span class="s2">$data</span><span class="s1">)</span>
        <span class="s2">metaSchema </span><span class="s1">= </span><span class="s2">schemaOrData</span><span class="s1">(</span><span class="s2">metaSchema</span><span class="s1">);</span>
    <span class="s2">def</span><span class="s1">.</span><span class="s2">validateSchema </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">compile</span><span class="s1">(</span><span class="s2">metaSchema</span><span class="s1">, </span><span class="s3">true</span><span class="s1">);</span>
<span class="s1">}</span>
<span class="s3">const </span><span class="s2">$dataRef </span><span class="s1">= {</span>
    <span class="s2">$ref</span><span class="s1">: </span><span class="s0">&quot;https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#&quot;</span><span class="s1">,</span>
<span class="s1">};</span>
<span class="s3">function </span><span class="s2">schemaOrData</span><span class="s1">(</span><span class="s2">schema</span><span class="s1">) {</span>
    <span class="s3">return </span><span class="s1">{ </span><span class="s2">anyOf</span><span class="s1">: [</span><span class="s2">schema</span><span class="s1">, </span><span class="s2">$dataRef</span><span class="s1">] };</span>
<span class="s1">}</span>
<span class="s5">//# sourceMappingURL=core.js.map</span></pre>
</body>
</html>