<html>
<head>
<title>step.vue</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #d5b778;}
.s1 { color: #bcbec4;}
.s2 { color: #bababa;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
.s5 { color: #cf8e6d;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
step.vue</font>
</center></td></tr></table>
<pre><span class="s0">&lt;template&gt;</span>
  <span class="s0">&lt;div</span>
    <span class="s2">class</span><span class="s3">=&quot;el-step&quot;</span>
    <span class="s2">:style</span><span class="s3">=&quot;</span><span class="s1">style</span><span class="s3">&quot;</span>
    <span class="s2">:class</span><span class="s3">=&quot;</span><span class="s1">[</span>
      <span class="s1">!isSimple &amp;&amp; </span><span class="s3">`is-</span><span class="s1">${$parent.direction}</span><span class="s3">`</span><span class="s1">,</span>
      <span class="s1">isSimple &amp;&amp; </span><span class="s3">'is-simple'</span><span class="s1">,</span>
      <span class="s1">isLast &amp;&amp; !space &amp;&amp; !isCenter &amp;&amp; </span><span class="s3">'is-flex'</span><span class="s1">,</span>
      <span class="s1">isCenter &amp;&amp; !isVertical &amp;&amp; !isSimple &amp;&amp; </span><span class="s3">'is-center'</span>
     <span class="s1">]</span><span class="s3">&quot;</span><span class="s0">&gt;</span>
    <span class="s4">&lt;!-- icon &amp; line --&gt;</span>
    <span class="s0">&lt;div</span>
      <span class="s2">class</span><span class="s3">=&quot;el-step__head&quot;</span>
      <span class="s2">:class</span><span class="s3">=&quot;`is-</span><span class="s1">${currentStatus}</span><span class="s3">`&quot;</span><span class="s0">&gt;</span>
      <span class="s0">&lt;div</span>
        <span class="s2">class</span><span class="s3">=&quot;el-step__line&quot;</span>
        <span class="s2">:style</span><span class="s3">=&quot;</span><span class="s1">isLast ? </span><span class="s3">'' </span><span class="s1">: { marginRight: $parent.stepOffset + </span><span class="s3">'px' </span><span class="s1">}</span><span class="s3">&quot;</span>
      <span class="s0">&gt;</span>
        <span class="s0">&lt;i </span><span class="s2">class</span><span class="s3">=&quot;el-step__line-inner&quot; </span><span class="s2">:style</span><span class="s3">=&quot;</span><span class="s1">lineStyle</span><span class="s3">&quot;</span><span class="s0">&gt;&lt;/i&gt;</span>
      <span class="s0">&lt;/div&gt;</span>

      <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;el-step__icon&quot; </span><span class="s2">:class</span><span class="s3">=&quot;`is-</span><span class="s1">${icon ? </span><span class="s3">'icon' </span><span class="s1">: </span><span class="s3">'text'</span><span class="s1">}</span><span class="s3">`&quot;</span><span class="s0">&gt;</span>
        <span class="s0">&lt;slot</span>
          <span class="s2">v-if</span><span class="s3">=&quot;</span><span class="s1">currentStatus !== </span><span class="s3">'success' </span><span class="s1">&amp;&amp; currentStatus !== </span><span class="s3">'error'&quot;</span>
          <span class="s2">name</span><span class="s3">=&quot;icon&quot;</span><span class="s0">&gt;</span>
          <span class="s0">&lt;i </span><span class="s2">v-if</span><span class="s3">=&quot;</span><span class="s1">icon</span><span class="s3">&quot; </span><span class="s2">class</span><span class="s3">=&quot;el-step__icon-inner&quot; </span><span class="s2">:class</span><span class="s3">=&quot;</span><span class="s1">[icon]</span><span class="s3">&quot;</span><span class="s0">&gt;&lt;/i&gt;</span>
          <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;el-step__icon-inner&quot; </span><span class="s2">v-if</span><span class="s3">=&quot;</span><span class="s1">!icon &amp;&amp; !isSimple</span><span class="s3">&quot;</span><span class="s0">&gt;</span><span class="s1">{{ index + 1 }}</span><span class="s0">&lt;/div&gt;</span>
        <span class="s0">&lt;/slot&gt;</span>
        <span class="s0">&lt;i</span>
          <span class="s2">v-else</span>
          <span class="s2">:class</span><span class="s3">=&quot;</span><span class="s1">[</span><span class="s3">'el-icon-' </span><span class="s1">+ (currentStatus === </span><span class="s3">'success' </span><span class="s1">? </span><span class="s3">'check' </span><span class="s1">: </span><span class="s3">'close'</span><span class="s1">)]</span><span class="s3">&quot;</span>
          <span class="s2">class</span><span class="s3">=&quot;el-step__icon-inner is-status&quot;</span>
        <span class="s0">&gt;</span>
        <span class="s0">&lt;/i&gt;</span>
      <span class="s0">&lt;/div&gt;</span>
    <span class="s0">&lt;/div&gt;</span>
    <span class="s4">&lt;!-- title &amp; description --&gt;</span>
    <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;el-step__main&quot;</span><span class="s0">&gt;</span>
      <span class="s0">&lt;div</span>
        <span class="s2">class</span><span class="s3">=&quot;el-step__title&quot;</span>
        <span class="s2">ref</span><span class="s3">=&quot;title&quot;</span>
        <span class="s2">:class</span><span class="s3">=&quot;</span><span class="s1">[</span><span class="s3">'is-' </span><span class="s1">+ currentStatus]</span><span class="s3">&quot;</span><span class="s0">&gt;</span>
        <span class="s0">&lt;slot </span><span class="s2">name</span><span class="s3">=&quot;title&quot;</span><span class="s0">&gt;</span><span class="s1">{{ title }}</span><span class="s0">&lt;/slot&gt;</span>
      <span class="s0">&lt;/div&gt;</span>
      <span class="s0">&lt;div </span><span class="s2">v-if</span><span class="s3">=&quot;</span><span class="s1">isSimple</span><span class="s3">&quot; </span><span class="s2">class</span><span class="s3">=&quot;el-step__arrow&quot;</span><span class="s0">&gt;&lt;/div&gt;</span>
      <span class="s0">&lt;div</span>
        <span class="s2">v-else</span>
        <span class="s2">class</span><span class="s3">=&quot;el-step__description&quot;</span>
        <span class="s2">:class</span><span class="s3">=&quot;</span><span class="s1">[</span><span class="s3">'is-' </span><span class="s1">+ currentStatus]</span><span class="s3">&quot;</span><span class="s0">&gt;</span>
        <span class="s0">&lt;slot </span><span class="s2">name</span><span class="s3">=&quot;description&quot;</span><span class="s0">&gt;</span><span class="s1">{{ description }}</span><span class="s0">&lt;/slot&gt;</span>
      <span class="s0">&lt;/div&gt;</span>
    <span class="s0">&lt;/div&gt;</span>
  <span class="s0">&lt;/div&gt;</span>
<span class="s0">&lt;/template&gt;</span>

<span class="s0">&lt;script&gt;</span>
<span class="s5">export default </span><span class="s1">{</span>
  <span class="s1">name: </span><span class="s3">'ElStep'</span><span class="s1">,</span>

  <span class="s1">props: {</span>
    <span class="s1">title: String,</span>
    <span class="s1">icon: String,</span>
    <span class="s1">description: String,</span>
    <span class="s1">status: String</span>
  <span class="s1">},</span>

  <span class="s1">data() {</span>
    <span class="s5">return </span><span class="s1">{</span>
      <span class="s1">index: -</span><span class="s6">1</span><span class="s1">,</span>
      <span class="s1">lineStyle: {},</span>
      <span class="s1">internalStatus: </span><span class="s3">''</span>
    <span class="s1">};</span>
  <span class="s1">},</span>

  <span class="s1">beforeCreate() {</span>
    <span class="s5">this</span><span class="s1">.$parent.steps.push(</span><span class="s5">this</span><span class="s1">);</span>
  <span class="s1">},</span>

  <span class="s1">beforeDestroy() {</span>
    <span class="s5">const </span><span class="s1">steps = </span><span class="s5">this</span><span class="s1">.$parent.steps;</span>
    <span class="s5">const </span><span class="s1">index = steps.indexOf(</span><span class="s5">this</span><span class="s1">);</span>
    <span class="s5">if </span><span class="s1">(index &gt;= </span><span class="s6">0</span><span class="s1">) {</span>
      <span class="s1">steps.splice(index, </span><span class="s6">1</span><span class="s1">);</span>
    <span class="s1">}</span>
  <span class="s1">},</span>

  <span class="s1">computed: {</span>
    <span class="s1">currentStatus() {</span>
      <span class="s5">return this</span><span class="s1">.status || </span><span class="s5">this</span><span class="s1">.internalStatus;</span>
    <span class="s1">},</span>
    <span class="s1">prevStatus() {</span>
      <span class="s5">const </span><span class="s1">prevStep = </span><span class="s5">this</span><span class="s1">.$parent.steps[</span><span class="s5">this</span><span class="s1">.index - </span><span class="s6">1</span><span class="s1">];</span>
      <span class="s5">return </span><span class="s1">prevStep ? prevStep.currentStatus : </span><span class="s3">'wait'</span><span class="s1">;</span>
    <span class="s1">},</span>
    <span class="s1">isCenter() {</span>
      <span class="s5">return this</span><span class="s1">.$parent.alignCenter;</span>
    <span class="s1">},</span>
    <span class="s1">isVertical() {</span>
      <span class="s5">return this</span><span class="s1">.$parent.direction === </span><span class="s3">'vertical'</span><span class="s1">;</span>
    <span class="s1">},</span>
    <span class="s1">isSimple() {</span>
      <span class="s5">return this</span><span class="s1">.$parent.simple;</span>
    <span class="s1">},</span>
    <span class="s1">isLast() {</span>
      <span class="s5">const </span><span class="s1">parent = </span><span class="s5">this</span><span class="s1">.$parent;</span>
      <span class="s5">return </span><span class="s1">parent.steps[parent.steps.length - </span><span class="s6">1</span><span class="s1">] === </span><span class="s5">this</span><span class="s1">;</span>
    <span class="s1">},</span>
    <span class="s1">stepsCount() {</span>
      <span class="s5">return this</span><span class="s1">.$parent.steps.length;</span>
    <span class="s1">},</span>
    <span class="s1">space() {</span>
      <span class="s5">const </span><span class="s1">{ isSimple, $parent: { space } } = </span><span class="s5">this</span><span class="s1">;</span>
      <span class="s5">return </span><span class="s1">isSimple ? </span><span class="s3">'' </span><span class="s1">: space ;</span>
    <span class="s1">},</span>
    <span class="s1">style: </span><span class="s5">function</span><span class="s1">() {</span>
      <span class="s5">const </span><span class="s1">style = {};</span>
      <span class="s5">const </span><span class="s1">parent = </span><span class="s5">this</span><span class="s1">.$parent;</span>
      <span class="s5">const </span><span class="s1">len = parent.steps.length;</span>

      <span class="s5">const </span><span class="s1">space = (</span><span class="s5">typeof this</span><span class="s1">.space === </span><span class="s3">'number'</span>
        <span class="s1">? </span><span class="s5">this</span><span class="s1">.space + </span><span class="s3">'px'</span>
        <span class="s1">: </span><span class="s5">this</span><span class="s1">.space</span>
          <span class="s1">? </span><span class="s5">this</span><span class="s1">.space</span>
          <span class="s1">: </span><span class="s6">100 </span><span class="s1">/ (len - (</span><span class="s5">this</span><span class="s1">.isCenter ? </span><span class="s6">0 </span><span class="s1">: </span><span class="s6">1</span><span class="s1">)) + </span><span class="s3">'%'</span><span class="s1">);</span>
      <span class="s1">style.flexBasis = space;</span>
      <span class="s5">if </span><span class="s1">(</span><span class="s5">this</span><span class="s1">.isVertical) </span><span class="s5">return </span><span class="s1">style;</span>
      <span class="s5">if </span><span class="s1">(</span><span class="s5">this</span><span class="s1">.isLast) {</span>
        <span class="s1">style.maxWidth = </span><span class="s6">100 </span><span class="s1">/ </span><span class="s5">this</span><span class="s1">.stepsCount + </span><span class="s3">'%'</span><span class="s1">;</span>
      <span class="s1">} </span><span class="s5">else </span><span class="s1">{</span>
        <span class="s1">style.marginRight = -</span><span class="s5">this</span><span class="s1">.$parent.stepOffset + </span><span class="s3">'px'</span><span class="s1">;</span>
      <span class="s1">}</span>

      <span class="s5">return </span><span class="s1">style;</span>
    <span class="s1">}</span>
  <span class="s1">},</span>

  <span class="s1">methods: {</span>
    <span class="s1">updateStatus(val) {</span>
      <span class="s5">const </span><span class="s1">prevChild = </span><span class="s5">this</span><span class="s1">.$parent.$children[</span><span class="s5">this</span><span class="s1">.index - </span><span class="s6">1</span><span class="s1">];</span>

      <span class="s5">if </span><span class="s1">(val &gt; </span><span class="s5">this</span><span class="s1">.index) {</span>
        <span class="s5">this</span><span class="s1">.internalStatus = </span><span class="s5">this</span><span class="s1">.$parent.finishStatus;</span>
      <span class="s1">} </span><span class="s5">else if </span><span class="s1">(val === </span><span class="s5">this</span><span class="s1">.index &amp;&amp; </span><span class="s5">this</span><span class="s1">.prevStatus !== </span><span class="s3">'error'</span><span class="s1">) {</span>
        <span class="s5">this</span><span class="s1">.internalStatus = </span><span class="s5">this</span><span class="s1">.$parent.processStatus;</span>
      <span class="s1">} </span><span class="s5">else </span><span class="s1">{</span>
        <span class="s5">this</span><span class="s1">.internalStatus = </span><span class="s3">'wait'</span><span class="s1">;</span>
      <span class="s1">}</span>

      <span class="s5">if </span><span class="s1">(prevChild) prevChild.calcProgress(</span><span class="s5">this</span><span class="s1">.internalStatus);</span>
    <span class="s1">},</span>

    <span class="s1">calcProgress(status) {</span>
      <span class="s5">let </span><span class="s1">step = </span><span class="s6">100</span><span class="s1">;</span>
      <span class="s5">const </span><span class="s1">style = {};</span>

      <span class="s1">style.transitionDelay = </span><span class="s6">150 </span><span class="s1">* </span><span class="s5">this</span><span class="s1">.index + </span><span class="s3">'ms'</span><span class="s1">;</span>
      <span class="s5">if </span><span class="s1">(status === </span><span class="s5">this</span><span class="s1">.$parent.processStatus) {</span>
        <span class="s1">step = </span><span class="s5">this</span><span class="s1">.currentStatus !== </span><span class="s3">'error' </span><span class="s1">? </span><span class="s6">0 </span><span class="s1">: </span><span class="s6">0</span><span class="s1">;</span>
      <span class="s1">} </span><span class="s5">else if </span><span class="s1">(status === </span><span class="s3">'wait'</span><span class="s1">) {</span>
        <span class="s1">step = </span><span class="s6">0</span><span class="s1">;</span>
        <span class="s1">style.transitionDelay = (-</span><span class="s6">150 </span><span class="s1">* </span><span class="s5">this</span><span class="s1">.index) + </span><span class="s3">'ms'</span><span class="s1">;</span>
      <span class="s1">}</span>

      <span class="s1">style.borderWidth = step &amp;&amp; !</span><span class="s5">this</span><span class="s1">.isSimple ? </span><span class="s3">'1px' </span><span class="s1">: </span><span class="s6">0</span><span class="s1">;</span>
      <span class="s5">this</span><span class="s1">.$parent.direction === </span><span class="s3">'vertical'</span>
        <span class="s1">? style.height = step + </span><span class="s3">'%'</span>
        <span class="s1">: style.width = step + </span><span class="s3">'%'</span><span class="s1">;</span>

      <span class="s5">this</span><span class="s1">.lineStyle = style;</span>
    <span class="s1">}</span>
  <span class="s1">},</span>

  <span class="s1">mounted() {</span>
    <span class="s5">const </span><span class="s1">unwatch = </span><span class="s5">this</span><span class="s1">.$watch(</span><span class="s3">'index'</span><span class="s1">, val =&gt; {</span>
      <span class="s5">this</span><span class="s1">.$watch(</span><span class="s3">'$parent.active'</span><span class="s1">, </span><span class="s5">this</span><span class="s1">.updateStatus, { immediate: </span><span class="s5">true </span><span class="s1">});</span>
      <span class="s5">this</span><span class="s1">.$watch(</span><span class="s3">'$parent.processStatus'</span><span class="s1">, () =&gt; {</span>
        <span class="s5">const </span><span class="s1">activeIndex = </span><span class="s5">this</span><span class="s1">.$parent.active;</span>
        <span class="s5">this</span><span class="s1">.updateStatus(activeIndex);</span>
      <span class="s1">}, { immediate: </span><span class="s5">true </span><span class="s1">});</span>
      <span class="s1">unwatch();</span>
    <span class="s1">});</span>
  <span class="s1">}</span>
<span class="s1">};</span>
<span class="s0">&lt;/script&gt;</span>
</pre>
</body>
</html>