<html>
<head>
<title>ed25519.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
.s7 { color: #67a37c; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
ed25519.js</font>
</center></td></tr></table>
<pre><span class="s0">/**</span>
 <span class="s0">* JavaScript implementation of Ed25519.</span>
 <span class="s0">*</span>
 <span class="s0">* Copyright (c) 2017-2019 Digital Bazaar, Inc.</span>
 <span class="s0">*</span>
 <span class="s0">* This implementation is based on the most excellent TweetNaCl which is</span>
 <span class="s0">* in the public domain. Many thanks to its contributors:</span>
 <span class="s0">*</span>
 <span class="s0">* https://github.com/dchest/tweetnacl-js</span>
 <span class="s0">*/</span>
<span class="s2">var </span><span class="s1">forge </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s4">'./forge'</span><span class="s3">);</span>
<span class="s1">require</span><span class="s3">(</span><span class="s4">'./jsbn'</span><span class="s3">);</span>
<span class="s1">require</span><span class="s3">(</span><span class="s4">'./random'</span><span class="s3">);</span>
<span class="s1">require</span><span class="s3">(</span><span class="s4">'./sha512'</span><span class="s3">);</span>
<span class="s1">require</span><span class="s3">(</span><span class="s4">'./util'</span><span class="s3">);</span>
<span class="s2">var </span><span class="s1">asn1Validator </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s4">'./asn1-validator'</span><span class="s3">);</span>
<span class="s2">var </span><span class="s1">publicKeyValidator </span><span class="s3">= </span><span class="s1">asn1Validator</span><span class="s3">.</span><span class="s1">publicKeyValidator</span><span class="s3">;</span>
<span class="s2">var </span><span class="s1">privateKeyValidator </span><span class="s3">= </span><span class="s1">asn1Validator</span><span class="s3">.</span><span class="s1">privateKeyValidator</span><span class="s3">;</span>

<span class="s2">if</span><span class="s3">(</span><span class="s2">typeof </span><span class="s1">BigInteger </span><span class="s3">=== </span><span class="s4">'undefined'</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">BigInteger </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">jsbn</span><span class="s3">.</span><span class="s1">BigInteger</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s2">var </span><span class="s1">ByteBuffer </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">util</span><span class="s3">.</span><span class="s1">ByteBuffer</span><span class="s3">;</span>
<span class="s2">var </span><span class="s1">NativeBuffer </span><span class="s3">= </span><span class="s2">typeof </span><span class="s1">Buffer </span><span class="s3">=== </span><span class="s4">'undefined' </span><span class="s3">? </span><span class="s1">Uint8Array </span><span class="s3">: </span><span class="s1">Buffer</span><span class="s3">;</span>

<span class="s5">/* 
 * Ed25519 algorithms, see RFC 8032: 
 * https://tools.ietf.org/html/rfc8032 
 */</span>
<span class="s1">forge</span><span class="s3">.</span><span class="s1">pki </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">pki </span><span class="s3">|| {};</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">pki</span><span class="s3">.</span><span class="s1">ed25519 </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">ed25519 </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">ed25519 </span><span class="s3">|| {};</span>
<span class="s2">var </span><span class="s1">ed25519 </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">ed25519</span><span class="s3">;</span>

<span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants </span><span class="s3">= {};</span>
<span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">PUBLIC_KEY_BYTE_LENGTH </span><span class="s3">= </span><span class="s6">32</span><span class="s3">;</span>
<span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">PRIVATE_KEY_BYTE_LENGTH </span><span class="s3">= </span><span class="s6">64</span><span class="s3">;</span>
<span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SEED_BYTE_LENGTH </span><span class="s3">= </span><span class="s6">32</span><span class="s3">;</span>
<span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SIGN_BYTE_LENGTH </span><span class="s3">= </span><span class="s6">64</span><span class="s3">;</span>
<span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">HASH_BYTE_LENGTH </span><span class="s3">= </span><span class="s6">64</span><span class="s3">;</span>

<span class="s1">ed25519</span><span class="s3">.</span><span class="s1">generateKeyPair </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">options</span><span class="s3">) {</span>
  <span class="s1">options </span><span class="s3">= </span><span class="s1">options </span><span class="s3">|| {};</span>
  <span class="s2">var </span><span class="s1">seed </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">seed</span><span class="s3">;</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">seed </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) {</span>
    <span class="s5">// generate seed</span>
    <span class="s1">seed </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">getBytesSync</span><span class="s3">(</span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SEED_BYTE_LENGTH</span><span class="s3">);</span>
  <span class="s3">} </span><span class="s2">else if</span><span class="s3">(</span><span class="s2">typeof </span><span class="s1">seed </span><span class="s3">=== </span><span class="s4">'string'</span><span class="s3">) {</span>
    <span class="s2">if</span><span class="s3">(</span><span class="s1">seed</span><span class="s3">.</span><span class="s1">length </span><span class="s3">!== </span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SEED_BYTE_LENGTH</span><span class="s3">) {</span>
      <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span>
        <span class="s4">'&quot;seed&quot; must be ' </span><span class="s3">+ </span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SEED_BYTE_LENGTH </span><span class="s3">+</span>
        <span class="s4">' bytes in length.'</span><span class="s3">);</span>
    <span class="s3">}</span>
  <span class="s3">} </span><span class="s2">else if</span><span class="s3">(!(</span><span class="s1">seed </span><span class="s2">instanceof </span><span class="s1">Uint8Array</span><span class="s3">)) {</span>
    <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span>
      <span class="s4">'&quot;seed&quot; must be a node.js Buffer, Uint8Array, or a binary string.'</span><span class="s3">);</span>
  <span class="s3">}</span>

  <span class="s1">seed </span><span class="s3">= </span><span class="s1">messageToNativeBuffer</span><span class="s3">({</span><span class="s1">message</span><span class="s3">: </span><span class="s1">seed</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">: </span><span class="s4">'binary'</span><span class="s3">});</span>

  <span class="s2">var </span><span class="s1">pk </span><span class="s3">= </span><span class="s2">new </span><span class="s1">NativeBuffer</span><span class="s3">(</span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">PUBLIC_KEY_BYTE_LENGTH</span><span class="s3">);</span>
  <span class="s2">var </span><span class="s1">sk </span><span class="s3">= </span><span class="s2">new </span><span class="s1">NativeBuffer</span><span class="s3">(</span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">PRIVATE_KEY_BYTE_LENGTH</span><span class="s3">);</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">32</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">sk</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">seed</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s1">crypto_sign_keypair</span><span class="s3">(</span><span class="s1">pk</span><span class="s3">, </span><span class="s1">sk</span><span class="s3">);</span>
  <span class="s2">return </span><span class="s3">{</span><span class="s1">publicKey</span><span class="s3">: </span><span class="s1">pk</span><span class="s3">, </span><span class="s1">privateKey</span><span class="s3">: </span><span class="s1">sk</span><span class="s3">};</span>
<span class="s3">};</span>

<span class="s0">/**</span>
 <span class="s0">* Converts a private key from a RFC8410 ASN.1 encoding.</span>
 <span class="s0">*</span>
 <span class="s0">* </span><span class="s7">@param </span><span class="s0">obj - The asn1 representation of a private key.</span>
 <span class="s0">*</span>
 <span class="s0">* </span><span class="s7">@returns </span><span class="s0">{Object} keyInfo - The key information.</span>
 <span class="s0">* </span><span class="s7">@returns </span><span class="s0">{Buffer|Uint8Array} keyInfo.privateKeyBytes - 32 private key bytes.</span>
 <span class="s0">*/</span>
<span class="s1">ed25519</span><span class="s3">.</span><span class="s1">privateKeyFromAsn1 </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">capture </span><span class="s3">= {};</span>
  <span class="s2">var </span><span class="s1">errors </span><span class="s3">= [];</span>
  <span class="s2">var </span><span class="s1">valid </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">asn1</span><span class="s3">.</span><span class="s1">validate</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">privateKeyValidator</span><span class="s3">, </span><span class="s1">capture</span><span class="s3">, </span><span class="s1">errors</span><span class="s3">);</span>
  <span class="s2">if</span><span class="s3">(!</span><span class="s1">valid</span><span class="s3">) {</span>
    <span class="s2">var </span><span class="s1">error </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Error</span><span class="s3">(</span><span class="s4">'Invalid Key.'</span><span class="s3">);</span>
    <span class="s1">error</span><span class="s3">.</span><span class="s1">errors </span><span class="s3">= </span><span class="s1">errors</span><span class="s3">;</span>
    <span class="s2">throw </span><span class="s1">error</span><span class="s3">;</span>
  <span class="s3">}</span>
  <span class="s2">var </span><span class="s1">oid </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">asn1</span><span class="s3">.</span><span class="s1">derToOid</span><span class="s3">(</span><span class="s1">capture</span><span class="s3">.</span><span class="s1">privateKeyOid</span><span class="s3">);</span>
  <span class="s2">var </span><span class="s1">ed25519Oid </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">oids</span><span class="s3">.</span><span class="s1">EdDSA25519</span><span class="s3">;</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">oid </span><span class="s3">!== </span><span class="s1">ed25519Oid</span><span class="s3">) {</span>
    <span class="s2">throw new </span><span class="s1">Error</span><span class="s3">(</span><span class="s4">'Invalid OID &quot;' </span><span class="s3">+ </span><span class="s1">oid </span><span class="s3">+ </span><span class="s4">'&quot;; OID must be &quot;' </span><span class="s3">+</span>
      <span class="s1">ed25519Oid </span><span class="s3">+ </span><span class="s4">'&quot;.'</span><span class="s3">);</span>
  <span class="s3">}</span>
  <span class="s2">var </span><span class="s1">privateKey </span><span class="s3">= </span><span class="s1">capture</span><span class="s3">.</span><span class="s1">privateKey</span><span class="s3">;</span>
  <span class="s5">// manually extract the private key bytes from nested octet string, see FIXME:</span>
  <span class="s5">// https://github.com/digitalbazaar/forge/blob/master/lib/asn1.js#L542</span>
  <span class="s2">var </span><span class="s1">privateKeyBytes </span><span class="s3">= </span><span class="s1">messageToNativeBuffer</span><span class="s3">({</span>
    <span class="s1">message</span><span class="s3">: </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">asn1</span><span class="s3">.</span><span class="s1">fromDer</span><span class="s3">(</span><span class="s1">privateKey</span><span class="s3">).</span><span class="s1">value</span><span class="s3">,</span>
    <span class="s1">encoding</span><span class="s3">: </span><span class="s4">'binary'</span>
  <span class="s3">});</span>
  <span class="s5">// TODO: RFC8410 specifies a format for encoding the public key bytes along</span>
  <span class="s5">// with the private key bytes. `publicKeyBytes` can be returned in the</span>
  <span class="s5">// future. https://tools.ietf.org/html/rfc8410#section-10.3</span>
  <span class="s2">return </span><span class="s3">{</span><span class="s1">privateKeyBytes</span><span class="s3">: </span><span class="s1">privateKeyBytes</span><span class="s3">};</span>
<span class="s3">};</span>

<span class="s0">/**</span>
 <span class="s0">* Converts a public key from a RFC8410 ASN.1 encoding.</span>
 <span class="s0">*</span>
 <span class="s0">* </span><span class="s7">@param </span><span class="s0">obj - The asn1 representation of a public key.</span>
 <span class="s0">*</span>
 <span class="s0">* </span><span class="s7">@return </span><span class="s0">{Buffer|Uint8Array} - 32 public key bytes.</span>
 <span class="s0">*/</span>
<span class="s1">ed25519</span><span class="s3">.</span><span class="s1">publicKeyFromAsn1 </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
  <span class="s5">// get SubjectPublicKeyInfo</span>
  <span class="s2">var </span><span class="s1">capture </span><span class="s3">= {};</span>
  <span class="s2">var </span><span class="s1">errors </span><span class="s3">= [];</span>
  <span class="s2">var </span><span class="s1">valid </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">asn1</span><span class="s3">.</span><span class="s1">validate</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">publicKeyValidator</span><span class="s3">, </span><span class="s1">capture</span><span class="s3">, </span><span class="s1">errors</span><span class="s3">);</span>
  <span class="s2">if</span><span class="s3">(!</span><span class="s1">valid</span><span class="s3">) {</span>
    <span class="s2">var </span><span class="s1">error </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Error</span><span class="s3">(</span><span class="s4">'Invalid Key.'</span><span class="s3">);</span>
    <span class="s1">error</span><span class="s3">.</span><span class="s1">errors </span><span class="s3">= </span><span class="s1">errors</span><span class="s3">;</span>
    <span class="s2">throw </span><span class="s1">error</span><span class="s3">;</span>
  <span class="s3">}</span>
  <span class="s2">var </span><span class="s1">oid </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">asn1</span><span class="s3">.</span><span class="s1">derToOid</span><span class="s3">(</span><span class="s1">capture</span><span class="s3">.</span><span class="s1">publicKeyOid</span><span class="s3">);</span>
  <span class="s2">var </span><span class="s1">ed25519Oid </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">oids</span><span class="s3">.</span><span class="s1">EdDSA25519</span><span class="s3">;</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">oid </span><span class="s3">!== </span><span class="s1">ed25519Oid</span><span class="s3">) {</span>
    <span class="s2">throw new </span><span class="s1">Error</span><span class="s3">(</span><span class="s4">'Invalid OID &quot;' </span><span class="s3">+ </span><span class="s1">oid </span><span class="s3">+ </span><span class="s4">'&quot;; OID must be &quot;' </span><span class="s3">+</span>
      <span class="s1">ed25519Oid </span><span class="s3">+ </span><span class="s4">'&quot;.'</span><span class="s3">);</span>
  <span class="s3">}</span>
  <span class="s2">var </span><span class="s1">publicKeyBytes </span><span class="s3">= </span><span class="s1">capture</span><span class="s3">.</span><span class="s1">ed25519PublicKey</span><span class="s3">;</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">publicKeyBytes</span><span class="s3">.</span><span class="s1">length </span><span class="s3">!== </span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">PUBLIC_KEY_BYTE_LENGTH</span><span class="s3">) {</span>
    <span class="s2">throw new </span><span class="s1">Error</span><span class="s3">(</span><span class="s4">'Key length is invalid.'</span><span class="s3">);</span>
  <span class="s3">}</span>
  <span class="s2">return </span><span class="s1">messageToNativeBuffer</span><span class="s3">({</span>
    <span class="s1">message</span><span class="s3">: </span><span class="s1">publicKeyBytes</span><span class="s3">,</span>
    <span class="s1">encoding</span><span class="s3">: </span><span class="s4">'binary'</span>
  <span class="s3">});</span>
<span class="s3">};</span>

<span class="s1">ed25519</span><span class="s3">.</span><span class="s1">publicKeyFromPrivateKey </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">options</span><span class="s3">) {</span>
  <span class="s1">options </span><span class="s3">= </span><span class="s1">options </span><span class="s3">|| {};</span>
  <span class="s2">var </span><span class="s1">privateKey </span><span class="s3">= </span><span class="s1">messageToNativeBuffer</span><span class="s3">({</span>
    <span class="s1">message</span><span class="s3">: </span><span class="s1">options</span><span class="s3">.</span><span class="s1">privateKey</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">: </span><span class="s4">'binary'</span>
  <span class="s3">});</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">privateKey</span><span class="s3">.</span><span class="s1">length </span><span class="s3">!== </span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">PRIVATE_KEY_BYTE_LENGTH</span><span class="s3">) {</span>
    <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span>
      <span class="s4">'&quot;options.privateKey&quot; must have a byte length of ' </span><span class="s3">+</span>
      <span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">PRIVATE_KEY_BYTE_LENGTH</span><span class="s3">);</span>
  <span class="s3">}</span>

  <span class="s2">var </span><span class="s1">pk </span><span class="s3">= </span><span class="s2">new </span><span class="s1">NativeBuffer</span><span class="s3">(</span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">PUBLIC_KEY_BYTE_LENGTH</span><span class="s3">);</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">pk</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">pk</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">privateKey</span><span class="s3">[</span><span class="s6">32 </span><span class="s3">+ </span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">return </span><span class="s1">pk</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">ed25519</span><span class="s3">.</span><span class="s1">sign </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">options</span><span class="s3">) {</span>
  <span class="s1">options </span><span class="s3">= </span><span class="s1">options </span><span class="s3">|| {};</span>
  <span class="s2">var </span><span class="s1">msg </span><span class="s3">= </span><span class="s1">messageToNativeBuffer</span><span class="s3">(</span><span class="s1">options</span><span class="s3">);</span>
  <span class="s2">var </span><span class="s1">privateKey </span><span class="s3">= </span><span class="s1">messageToNativeBuffer</span><span class="s3">({</span>
    <span class="s1">message</span><span class="s3">: </span><span class="s1">options</span><span class="s3">.</span><span class="s1">privateKey</span><span class="s3">,</span>
    <span class="s1">encoding</span><span class="s3">: </span><span class="s4">'binary'</span>
  <span class="s3">});</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">privateKey</span><span class="s3">.</span><span class="s1">length </span><span class="s3">=== </span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SEED_BYTE_LENGTH</span><span class="s3">) {</span>
    <span class="s2">var </span><span class="s1">keyPair </span><span class="s3">= </span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">generateKeyPair</span><span class="s3">({</span><span class="s1">seed</span><span class="s3">: </span><span class="s1">privateKey</span><span class="s3">});</span>
    <span class="s1">privateKey </span><span class="s3">= </span><span class="s1">keyPair</span><span class="s3">.</span><span class="s1">privateKey</span><span class="s3">;</span>
  <span class="s3">} </span><span class="s2">else if</span><span class="s3">(</span><span class="s1">privateKey</span><span class="s3">.</span><span class="s1">length </span><span class="s3">!== </span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">PRIVATE_KEY_BYTE_LENGTH</span><span class="s3">) {</span>
    <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span>
      <span class="s4">'&quot;options.privateKey&quot; must have a byte length of ' </span><span class="s3">+</span>
      <span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SEED_BYTE_LENGTH </span><span class="s3">+ </span><span class="s4">' or ' </span><span class="s3">+</span>
      <span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">PRIVATE_KEY_BYTE_LENGTH</span><span class="s3">);</span>
  <span class="s3">}</span>

  <span class="s2">var </span><span class="s1">signedMsg </span><span class="s3">= </span><span class="s2">new </span><span class="s1">NativeBuffer</span><span class="s3">(</span>
    <span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SIGN_BYTE_LENGTH </span><span class="s3">+ </span><span class="s1">msg</span><span class="s3">.</span><span class="s1">length</span><span class="s3">);</span>
  <span class="s1">crypto_sign</span><span class="s3">(</span><span class="s1">signedMsg</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">.</span><span class="s1">length</span><span class="s3">, </span><span class="s1">privateKey</span><span class="s3">);</span>

  <span class="s2">var </span><span class="s1">sig </span><span class="s3">= </span><span class="s2">new </span><span class="s1">NativeBuffer</span><span class="s3">(</span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SIGN_BYTE_LENGTH</span><span class="s3">);</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">sig</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">sig</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">signedMsg</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">return </span><span class="s1">sig</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">ed25519</span><span class="s3">.</span><span class="s1">verify </span><span class="s3">= </span><span class="s2">function</span><span class="s3">(</span><span class="s1">options</span><span class="s3">) {</span>
  <span class="s1">options </span><span class="s3">= </span><span class="s1">options </span><span class="s3">|| {};</span>
  <span class="s2">var </span><span class="s1">msg </span><span class="s3">= </span><span class="s1">messageToNativeBuffer</span><span class="s3">(</span><span class="s1">options</span><span class="s3">);</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">signature </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) {</span>
    <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span>
      <span class="s4">'&quot;options.signature&quot; must be a node.js Buffer, a Uint8Array, a forge ' </span><span class="s3">+</span>
      <span class="s4">'ByteBuffer, or a binary string.'</span><span class="s3">);</span>
  <span class="s3">}</span>
  <span class="s2">var </span><span class="s1">sig </span><span class="s3">= </span><span class="s1">messageToNativeBuffer</span><span class="s3">({</span>
    <span class="s1">message</span><span class="s3">: </span><span class="s1">options</span><span class="s3">.</span><span class="s1">signature</span><span class="s3">,</span>
    <span class="s1">encoding</span><span class="s3">: </span><span class="s4">'binary'</span>
  <span class="s3">});</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">sig</span><span class="s3">.</span><span class="s1">length </span><span class="s3">!== </span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SIGN_BYTE_LENGTH</span><span class="s3">) {</span>
    <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span>
      <span class="s4">'&quot;options.signature&quot; must have a byte length of ' </span><span class="s3">+</span>
      <span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SIGN_BYTE_LENGTH</span><span class="s3">);</span>
  <span class="s3">}</span>
  <span class="s2">var </span><span class="s1">publicKey </span><span class="s3">= </span><span class="s1">messageToNativeBuffer</span><span class="s3">({</span>
    <span class="s1">message</span><span class="s3">: </span><span class="s1">options</span><span class="s3">.</span><span class="s1">publicKey</span><span class="s3">,</span>
    <span class="s1">encoding</span><span class="s3">: </span><span class="s4">'binary'</span>
  <span class="s3">});</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">publicKey</span><span class="s3">.</span><span class="s1">length </span><span class="s3">!== </span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">PUBLIC_KEY_BYTE_LENGTH</span><span class="s3">) {</span>
    <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span>
      <span class="s4">'&quot;options.publicKey&quot; must have a byte length of ' </span><span class="s3">+</span>
      <span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">PUBLIC_KEY_BYTE_LENGTH</span><span class="s3">);</span>
  <span class="s3">}</span>

  <span class="s2">var </span><span class="s1">sm </span><span class="s3">= </span><span class="s2">new </span><span class="s1">NativeBuffer</span><span class="s3">(</span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SIGN_BYTE_LENGTH </span><span class="s3">+ </span><span class="s1">msg</span><span class="s3">.</span><span class="s1">length</span><span class="s3">);</span>
  <span class="s2">var </span><span class="s1">m </span><span class="s3">= </span><span class="s2">new </span><span class="s1">NativeBuffer</span><span class="s3">(</span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SIGN_BYTE_LENGTH </span><span class="s3">+ </span><span class="s1">msg</span><span class="s3">.</span><span class="s1">length</span><span class="s3">);</span>
  <span class="s2">var </span><span class="s1">i</span><span class="s3">;</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SIGN_BYTE_LENGTH</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">sm</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">sig</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">msg</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">sm</span><span class="s3">[</span><span class="s1">i </span><span class="s3">+ </span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">SIGN_BYTE_LENGTH</span><span class="s3">] = </span><span class="s1">msg</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">return </span><span class="s3">(</span><span class="s1">crypto_sign_open</span><span class="s3">(</span><span class="s1">m</span><span class="s3">, </span><span class="s1">sm</span><span class="s3">, </span><span class="s1">sm</span><span class="s3">.</span><span class="s1">length</span><span class="s3">, </span><span class="s1">publicKey</span><span class="s3">) &gt;= </span><span class="s6">0</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s2">function </span><span class="s1">messageToNativeBuffer</span><span class="s3">(</span><span class="s1">options</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">message </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">message</span><span class="s3">;</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">message </span><span class="s2">instanceof </span><span class="s1">Uint8Array </span><span class="s3">|| </span><span class="s1">message </span><span class="s2">instanceof </span><span class="s1">NativeBuffer</span><span class="s3">) {</span>
    <span class="s2">return </span><span class="s1">message</span><span class="s3">;</span>
  <span class="s3">}</span>

  <span class="s2">var </span><span class="s1">encoding </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">encoding</span><span class="s3">;</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">message </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) {</span>
    <span class="s2">if</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">md</span><span class="s3">) {</span>
      <span class="s5">// TODO: more rigorous validation that `md` is a MessageDigest</span>
      <span class="s1">message </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">md</span><span class="s3">.</span><span class="s1">digest</span><span class="s3">().</span><span class="s1">getBytes</span><span class="s3">();</span>
      <span class="s1">encoding </span><span class="s3">= </span><span class="s4">'binary'</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s2">else </span><span class="s3">{</span>
      <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">'&quot;options.message&quot; or &quot;options.md&quot; not specified.'</span><span class="s3">);</span>
    <span class="s3">}</span>
  <span class="s3">}</span>

  <span class="s2">if</span><span class="s3">(</span><span class="s2">typeof </span><span class="s1">message </span><span class="s3">=== </span><span class="s4">'string' </span><span class="s3">&amp;&amp; !</span><span class="s1">encoding</span><span class="s3">) {</span>
    <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">'&quot;options.encoding&quot; must be &quot;binary&quot; or &quot;utf8&quot;.'</span><span class="s3">);</span>
  <span class="s3">}</span>

  <span class="s2">if</span><span class="s3">(</span><span class="s2">typeof </span><span class="s1">message </span><span class="s3">=== </span><span class="s4">'string'</span><span class="s3">) {</span>
    <span class="s2">if</span><span class="s3">(</span><span class="s2">typeof </span><span class="s1">Buffer </span><span class="s3">!== </span><span class="s4">'undefined'</span><span class="s3">) {</span>
      <span class="s2">return </span><span class="s1">Buffer</span><span class="s3">.</span><span class="s1">from</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s1">message </span><span class="s3">= </span><span class="s2">new </span><span class="s1">ByteBuffer</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">);</span>
  <span class="s3">} </span><span class="s2">else if</span><span class="s3">(!(</span><span class="s1">message </span><span class="s2">instanceof </span><span class="s1">ByteBuffer</span><span class="s3">)) {</span>
    <span class="s2">throw new </span><span class="s1">TypeError</span><span class="s3">(</span>
      <span class="s4">'&quot;options.message&quot; must be a node.js Buffer, a Uint8Array, a forge ' </span><span class="s3">+</span>
      <span class="s4">'ByteBuffer, or a string with &quot;options.encoding&quot; specifying its ' </span><span class="s3">+</span>
      <span class="s4">'encoding.'</span><span class="s3">);</span>
  <span class="s3">}</span>

  <span class="s5">// convert to native buffer</span>
  <span class="s2">var </span><span class="s1">buffer </span><span class="s3">= </span><span class="s2">new </span><span class="s1">NativeBuffer</span><span class="s3">(</span><span class="s1">message</span><span class="s3">.</span><span class="s1">length</span><span class="s3">());</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">buffer</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">buffer</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">message</span><span class="s3">.</span><span class="s1">at</span><span class="s3">(</span><span class="s1">i</span><span class="s3">);</span>
  <span class="s3">}</span>
  <span class="s2">return </span><span class="s1">buffer</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s2">var </span><span class="s1">gf0 </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">();</span>
<span class="s2">var </span><span class="s1">gf1 </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">([</span><span class="s6">1</span><span class="s3">]);</span>
<span class="s2">var </span><span class="s1">D </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">([</span>
  <span class="s6">0x78a3</span><span class="s3">, </span><span class="s6">0x1359</span><span class="s3">, </span><span class="s6">0x4dca</span><span class="s3">, </span><span class="s6">0x75eb</span><span class="s3">, </span><span class="s6">0xd8ab</span><span class="s3">, </span><span class="s6">0x4141</span><span class="s3">, </span><span class="s6">0x0a4d</span><span class="s3">, </span><span class="s6">0x0070</span><span class="s3">,</span>
  <span class="s6">0xe898</span><span class="s3">, </span><span class="s6">0x7779</span><span class="s3">, </span><span class="s6">0x4079</span><span class="s3">, </span><span class="s6">0x8cc7</span><span class="s3">, </span><span class="s6">0xfe73</span><span class="s3">, </span><span class="s6">0x2b6f</span><span class="s3">, </span><span class="s6">0x6cee</span><span class="s3">, </span><span class="s6">0x5203</span><span class="s3">]);</span>
<span class="s2">var </span><span class="s1">D2 </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">([</span>
  <span class="s6">0xf159</span><span class="s3">, </span><span class="s6">0x26b2</span><span class="s3">, </span><span class="s6">0x9b94</span><span class="s3">, </span><span class="s6">0xebd6</span><span class="s3">, </span><span class="s6">0xb156</span><span class="s3">, </span><span class="s6">0x8283</span><span class="s3">, </span><span class="s6">0x149a</span><span class="s3">, </span><span class="s6">0x00e0</span><span class="s3">,</span>
  <span class="s6">0xd130</span><span class="s3">, </span><span class="s6">0xeef3</span><span class="s3">, </span><span class="s6">0x80f2</span><span class="s3">, </span><span class="s6">0x198e</span><span class="s3">, </span><span class="s6">0xfce7</span><span class="s3">, </span><span class="s6">0x56df</span><span class="s3">, </span><span class="s6">0xd9dc</span><span class="s3">, </span><span class="s6">0x2406</span><span class="s3">]);</span>
<span class="s2">var </span><span class="s1">X </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">([</span>
  <span class="s6">0xd51a</span><span class="s3">, </span><span class="s6">0x8f25</span><span class="s3">, </span><span class="s6">0x2d60</span><span class="s3">, </span><span class="s6">0xc956</span><span class="s3">, </span><span class="s6">0xa7b2</span><span class="s3">, </span><span class="s6">0x9525</span><span class="s3">, </span><span class="s6">0xc760</span><span class="s3">, </span><span class="s6">0x692c</span><span class="s3">,</span>
  <span class="s6">0xdc5c</span><span class="s3">, </span><span class="s6">0xfdd6</span><span class="s3">, </span><span class="s6">0xe231</span><span class="s3">, </span><span class="s6">0xc0a4</span><span class="s3">, </span><span class="s6">0x53fe</span><span class="s3">, </span><span class="s6">0xcd6e</span><span class="s3">, </span><span class="s6">0x36d3</span><span class="s3">, </span><span class="s6">0x2169</span><span class="s3">]);</span>
<span class="s2">var </span><span class="s1">Y </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">([</span>
  <span class="s6">0x6658</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">,</span>
  <span class="s6">0x6666</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">, </span><span class="s6">0x6666</span><span class="s3">]);</span>
<span class="s2">var </span><span class="s1">L </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Float64Array</span><span class="s3">([</span>
  <span class="s6">0xed</span><span class="s3">, </span><span class="s6">0xd3</span><span class="s3">, </span><span class="s6">0xf5</span><span class="s3">, </span><span class="s6">0x5c</span><span class="s3">, </span><span class="s6">0x1a</span><span class="s3">, </span><span class="s6">0x63</span><span class="s3">, </span><span class="s6">0x12</span><span class="s3">, </span><span class="s6">0x58</span><span class="s3">,</span>
  <span class="s6">0xd6</span><span class="s3">, </span><span class="s6">0x9c</span><span class="s3">, </span><span class="s6">0xf7</span><span class="s3">, </span><span class="s6">0xa2</span><span class="s3">, </span><span class="s6">0xde</span><span class="s3">, </span><span class="s6">0xf9</span><span class="s3">, </span><span class="s6">0xde</span><span class="s3">, </span><span class="s6">0x14</span><span class="s3">,</span>
  <span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0x10</span><span class="s3">]);</span>
<span class="s2">var </span><span class="s1">I </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">([</span>
  <span class="s6">0xa0b0</span><span class="s3">, </span><span class="s6">0x4a0e</span><span class="s3">, </span><span class="s6">0x1b27</span><span class="s3">, </span><span class="s6">0xc4ee</span><span class="s3">, </span><span class="s6">0xe478</span><span class="s3">, </span><span class="s6">0xad2f</span><span class="s3">, </span><span class="s6">0x1806</span><span class="s3">, </span><span class="s6">0x2f43</span><span class="s3">,</span>
  <span class="s6">0xd7a7</span><span class="s3">, </span><span class="s6">0x3dfb</span><span class="s3">, </span><span class="s6">0x0099</span><span class="s3">, </span><span class="s6">0x2b4d</span><span class="s3">, </span><span class="s6">0xdf0b</span><span class="s3">, </span><span class="s6">0x4fc1</span><span class="s3">, </span><span class="s6">0x2480</span><span class="s3">, </span><span class="s6">0x2b83</span><span class="s3">]);</span>

<span class="s5">// TODO: update forge buffer implementation to use `Buffer` or `Uint8Array`,</span>
<span class="s5">// whichever is available, to improve performance</span>
<span class="s2">function </span><span class="s1">sha512</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">, </span><span class="s1">msgLen</span><span class="s3">) {</span>
  <span class="s5">// Note: `out` and `msg` are NativeBuffer</span>
  <span class="s2">var </span><span class="s1">md </span><span class="s3">= </span><span class="s1">forge</span><span class="s3">.</span><span class="s1">md</span><span class="s3">.</span><span class="s1">sha512</span><span class="s3">.</span><span class="s1">create</span><span class="s3">();</span>
  <span class="s2">var </span><span class="s1">buffer </span><span class="s3">= </span><span class="s2">new </span><span class="s1">ByteBuffer</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">);</span>
  <span class="s1">md</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">buffer</span><span class="s3">.</span><span class="s1">getBytes</span><span class="s3">(</span><span class="s1">msgLen</span><span class="s3">), </span><span class="s4">'binary'</span><span class="s3">);</span>
  <span class="s2">var </span><span class="s1">hash </span><span class="s3">= </span><span class="s1">md</span><span class="s3">.</span><span class="s1">digest</span><span class="s3">().</span><span class="s1">getBytes</span><span class="s3">();</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s2">typeof </span><span class="s1">Buffer </span><span class="s3">!== </span><span class="s4">'undefined'</span><span class="s3">) {</span>
    <span class="s2">return </span><span class="s1">Buffer</span><span class="s3">.</span><span class="s1">from</span><span class="s3">(</span><span class="s1">hash</span><span class="s3">, </span><span class="s4">'binary'</span><span class="s3">);</span>
  <span class="s3">}</span>
  <span class="s2">var </span><span class="s1">out </span><span class="s3">= </span><span class="s2">new </span><span class="s1">NativeBuffer</span><span class="s3">(</span><span class="s1">ed25519</span><span class="s3">.</span><span class="s1">constants</span><span class="s3">.</span><span class="s1">HASH_BYTE_LENGTH</span><span class="s3">);</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">64</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">out</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">hash</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i</span><span class="s3">);</span>
  <span class="s3">}</span>
  <span class="s2">return </span><span class="s1">out</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">crypto_sign_keypair</span><span class="s3">(</span><span class="s1">pk</span><span class="s3">, </span><span class="s1">sk</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">p </span><span class="s3">= [</span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">()];</span>
  <span class="s2">var </span><span class="s1">i</span><span class="s3">;</span>

  <span class="s2">var </span><span class="s1">d </span><span class="s3">= </span><span class="s1">sha512</span><span class="s3">(</span><span class="s1">sk</span><span class="s3">, </span><span class="s6">32</span><span class="s3">);</span>
  <span class="s1">d</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] &amp;= </span><span class="s6">248</span><span class="s3">;</span>
  <span class="s1">d</span><span class="s3">[</span><span class="s6">31</span><span class="s3">] &amp;= </span><span class="s6">127</span><span class="s3">;</span>
  <span class="s1">d</span><span class="s3">[</span><span class="s6">31</span><span class="s3">] |= </span><span class="s6">64</span><span class="s3">;</span>

  <span class="s1">scalarbase</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">d</span><span class="s3">);</span>
  <span class="s1">pack</span><span class="s3">(</span><span class="s1">pk</span><span class="s3">, </span><span class="s1">p</span><span class="s3">);</span>

  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">32</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">sk</span><span class="s3">[</span><span class="s1">i </span><span class="s3">+ </span><span class="s6">32</span><span class="s3">] = </span><span class="s1">pk</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">return </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s5">// Note: difference from C - smlen returned, not passed as argument.</span>
<span class="s2">function </span><span class="s1">crypto_sign</span><span class="s3">(</span><span class="s1">sm</span><span class="s3">, </span><span class="s1">m</span><span class="s3">, </span><span class="s1">n</span><span class="s3">, </span><span class="s1">sk</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">i</span><span class="s3">, </span><span class="s1">j</span><span class="s3">, </span><span class="s1">x </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Float64Array</span><span class="s3">(</span><span class="s6">64</span><span class="s3">);</span>
  <span class="s2">var </span><span class="s1">p </span><span class="s3">= [</span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">()];</span>

  <span class="s2">var </span><span class="s1">d </span><span class="s3">= </span><span class="s1">sha512</span><span class="s3">(</span><span class="s1">sk</span><span class="s3">, </span><span class="s6">32</span><span class="s3">);</span>
  <span class="s1">d</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] &amp;= </span><span class="s6">248</span><span class="s3">;</span>
  <span class="s1">d</span><span class="s3">[</span><span class="s6">31</span><span class="s3">] &amp;= </span><span class="s6">127</span><span class="s3">;</span>
  <span class="s1">d</span><span class="s3">[</span><span class="s6">31</span><span class="s3">] |= </span><span class="s6">64</span><span class="s3">;</span>

  <span class="s2">var </span><span class="s1">smlen </span><span class="s3">= </span><span class="s1">n </span><span class="s3">+ </span><span class="s6">64</span><span class="s3">;</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">n</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">sm</span><span class="s3">[</span><span class="s6">64 </span><span class="s3">+ </span><span class="s1">i</span><span class="s3">] = </span><span class="s1">m</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">32</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">sm</span><span class="s3">[</span><span class="s6">32 </span><span class="s3">+ </span><span class="s1">i</span><span class="s3">] = </span><span class="s1">d</span><span class="s3">[</span><span class="s6">32 </span><span class="s3">+ </span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>

  <span class="s2">var </span><span class="s1">r </span><span class="s3">= </span><span class="s1">sha512</span><span class="s3">(</span><span class="s1">sm</span><span class="s3">.</span><span class="s1">subarray</span><span class="s3">(</span><span class="s6">32</span><span class="s3">), </span><span class="s1">n </span><span class="s3">+ </span><span class="s6">32</span><span class="s3">);</span>
  <span class="s1">reduce</span><span class="s3">(</span><span class="s1">r</span><span class="s3">);</span>
  <span class="s1">scalarbase</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">r</span><span class="s3">);</span>
  <span class="s1">pack</span><span class="s3">(</span><span class="s1">sm</span><span class="s3">, </span><span class="s1">p</span><span class="s3">);</span>

  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">32</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">64</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">sm</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">sk</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">var </span><span class="s1">h </span><span class="s3">= </span><span class="s1">sha512</span><span class="s3">(</span><span class="s1">sm</span><span class="s3">, </span><span class="s1">n </span><span class="s3">+ </span><span class="s6">64</span><span class="s3">);</span>
  <span class="s1">reduce</span><span class="s3">(</span><span class="s1">h</span><span class="s3">);</span>

  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">32</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">64</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">x</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s6">0</span><span class="s3">;</span>
  <span class="s3">}</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">32</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">x</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">r</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">32</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s2">for</span><span class="s3">(</span><span class="s1">j </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">j </span><span class="s3">&lt; </span><span class="s6">32</span><span class="s3">; </span><span class="s1">j</span><span class="s3">++) {</span>
      <span class="s1">x</span><span class="s3">[</span><span class="s1">i </span><span class="s3">+ </span><span class="s1">j</span><span class="s3">] += </span><span class="s1">h</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] * </span><span class="s1">d</span><span class="s3">[</span><span class="s1">j</span><span class="s3">];</span>
    <span class="s3">}</span>
  <span class="s3">}</span>

  <span class="s1">modL</span><span class="s3">(</span><span class="s1">sm</span><span class="s3">.</span><span class="s1">subarray</span><span class="s3">(</span><span class="s6">32</span><span class="s3">), </span><span class="s1">x</span><span class="s3">);</span>
  <span class="s2">return </span><span class="s1">smlen</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">crypto_sign_open</span><span class="s3">(</span><span class="s1">m</span><span class="s3">, </span><span class="s1">sm</span><span class="s3">, </span><span class="s1">n</span><span class="s3">, </span><span class="s1">pk</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">i</span><span class="s3">, </span><span class="s1">mlen</span><span class="s3">;</span>
  <span class="s2">var </span><span class="s1">t </span><span class="s3">= </span><span class="s2">new </span><span class="s1">NativeBuffer</span><span class="s3">(</span><span class="s6">32</span><span class="s3">);</span>
  <span class="s2">var </span><span class="s1">p </span><span class="s3">= [</span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">()],</span>
      <span class="s1">q </span><span class="s3">= [</span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">()];</span>

  <span class="s1">mlen </span><span class="s3">= -</span><span class="s6">1</span><span class="s3">;</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">n </span><span class="s3">&lt; </span><span class="s6">64</span><span class="s3">) {</span>
    <span class="s2">return </span><span class="s3">-</span><span class="s6">1</span><span class="s3">;</span>
  <span class="s3">}</span>

  <span class="s2">if</span><span class="s3">(</span><span class="s1">unpackneg</span><span class="s3">(</span><span class="s1">q</span><span class="s3">, </span><span class="s1">pk</span><span class="s3">)) {</span>
    <span class="s2">return </span><span class="s3">-</span><span class="s6">1</span><span class="s3">;</span>
  <span class="s3">}</span>

  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">n</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">m</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">sm</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">32</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">m</span><span class="s3">[</span><span class="s1">i </span><span class="s3">+ </span><span class="s6">32</span><span class="s3">] = </span><span class="s1">pk</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">var </span><span class="s1">h </span><span class="s3">= </span><span class="s1">sha512</span><span class="s3">(</span><span class="s1">m</span><span class="s3">, </span><span class="s1">n</span><span class="s3">);</span>
  <span class="s1">reduce</span><span class="s3">(</span><span class="s1">h</span><span class="s3">);</span>
  <span class="s1">scalarmult</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">q</span><span class="s3">, </span><span class="s1">h</span><span class="s3">);</span>

  <span class="s1">scalarbase</span><span class="s3">(</span><span class="s1">q</span><span class="s3">, </span><span class="s1">sm</span><span class="s3">.</span><span class="s1">subarray</span><span class="s3">(</span><span class="s6">32</span><span class="s3">));</span>
  <span class="s1">add</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">q</span><span class="s3">);</span>
  <span class="s1">pack</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, </span><span class="s1">p</span><span class="s3">);</span>

  <span class="s1">n </span><span class="s3">-= </span><span class="s6">64</span><span class="s3">;</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">crypto_verify_32</span><span class="s3">(</span><span class="s1">sm</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t</span><span class="s3">, </span><span class="s6">0</span><span class="s3">)) {</span>
    <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">n</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
      <span class="s1">m</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s6">0</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s2">return </span><span class="s3">-</span><span class="s6">1</span><span class="s3">;</span>
  <span class="s3">}</span>

  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">n</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">m</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">sm</span><span class="s3">[</span><span class="s1">i </span><span class="s3">+ </span><span class="s6">64</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s1">mlen </span><span class="s3">= </span><span class="s1">n</span><span class="s3">;</span>
  <span class="s2">return </span><span class="s1">mlen</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">modL</span><span class="s3">(</span><span class="s1">r</span><span class="s3">, </span><span class="s1">x</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">carry</span><span class="s3">, </span><span class="s1">i</span><span class="s3">, </span><span class="s1">j</span><span class="s3">, </span><span class="s1">k</span><span class="s3">;</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">63</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&gt;= </span><span class="s6">32</span><span class="s3">; --</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">carry </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
    <span class="s2">for</span><span class="s3">(</span><span class="s1">j </span><span class="s3">= </span><span class="s1">i </span><span class="s3">- </span><span class="s6">32</span><span class="s3">, </span><span class="s1">k </span><span class="s3">= </span><span class="s1">i </span><span class="s3">- </span><span class="s6">12</span><span class="s3">; </span><span class="s1">j </span><span class="s3">&lt; </span><span class="s1">k</span><span class="s3">; ++</span><span class="s1">j</span><span class="s3">) {</span>
      <span class="s1">x</span><span class="s3">[</span><span class="s1">j</span><span class="s3">] += </span><span class="s1">carry </span><span class="s3">- </span><span class="s6">16 </span><span class="s3">* </span><span class="s1">x</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] * </span><span class="s1">L</span><span class="s3">[</span><span class="s1">j </span><span class="s3">- (</span><span class="s1">i </span><span class="s3">- </span><span class="s6">32</span><span class="s3">)];</span>
      <span class="s1">carry </span><span class="s3">= (</span><span class="s1">x</span><span class="s3">[</span><span class="s1">j</span><span class="s3">] + </span><span class="s6">128</span><span class="s3">) &gt;&gt; </span><span class="s6">8</span><span class="s3">;</span>
      <span class="s1">x</span><span class="s3">[</span><span class="s1">j</span><span class="s3">] -= </span><span class="s1">carry </span><span class="s3">* </span><span class="s6">256</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s1">x</span><span class="s3">[</span><span class="s1">j</span><span class="s3">] += </span><span class="s1">carry</span><span class="s3">;</span>
    <span class="s1">x</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s6">0</span><span class="s3">;</span>
  <span class="s3">}</span>
  <span class="s1">carry </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">j </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">j </span><span class="s3">&lt; </span><span class="s6">32</span><span class="s3">; ++</span><span class="s1">j</span><span class="s3">) {</span>
    <span class="s1">x</span><span class="s3">[</span><span class="s1">j</span><span class="s3">] += </span><span class="s1">carry </span><span class="s3">- (</span><span class="s1">x</span><span class="s3">[</span><span class="s6">31</span><span class="s3">] &gt;&gt; </span><span class="s6">4</span><span class="s3">) * </span><span class="s1">L</span><span class="s3">[</span><span class="s1">j</span><span class="s3">];</span>
    <span class="s1">carry </span><span class="s3">= </span><span class="s1">x</span><span class="s3">[</span><span class="s1">j</span><span class="s3">] &gt;&gt; </span><span class="s6">8</span><span class="s3">;</span>
    <span class="s1">x</span><span class="s3">[</span><span class="s1">j</span><span class="s3">] &amp;= </span><span class="s6">255</span><span class="s3">;</span>
  <span class="s3">}</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">j </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">j </span><span class="s3">&lt; </span><span class="s6">32</span><span class="s3">; ++</span><span class="s1">j</span><span class="s3">) {</span>
    <span class="s1">x</span><span class="s3">[</span><span class="s1">j</span><span class="s3">] -= </span><span class="s1">carry </span><span class="s3">* </span><span class="s1">L</span><span class="s3">[</span><span class="s1">j</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">32</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">x</span><span class="s3">[</span><span class="s1">i </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">] += </span><span class="s1">x</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] &gt;&gt; </span><span class="s6">8</span><span class="s3">;</span>
    <span class="s1">r</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">x</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] &amp; </span><span class="s6">255</span><span class="s3">;</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">reduce</span><span class="s3">(</span><span class="s1">r</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">x </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Float64Array</span><span class="s3">(</span><span class="s6">64</span><span class="s3">);</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">64</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">x</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">r</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
    <span class="s1">r</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s6">0</span><span class="s3">;</span>
  <span class="s3">}</span>
  <span class="s1">modL</span><span class="s3">(</span><span class="s1">r</span><span class="s3">, </span><span class="s1">x</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">add</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">q</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">a </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">b </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">c </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(),</span>
      <span class="s1">d </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">e </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">f </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(),</span>
      <span class="s1">g </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">h </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">t </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">();</span>

  <span class="s1">Z</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">p</span><span class="s3">[</span><span class="s6">1</span><span class="s3">], </span><span class="s1">p</span><span class="s3">[</span><span class="s6">0</span><span class="s3">]);</span>
  <span class="s1">Z</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, </span><span class="s1">q</span><span class="s3">[</span><span class="s6">1</span><span class="s3">], </span><span class="s1">q</span><span class="s3">[</span><span class="s6">0</span><span class="s3">]);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">t</span><span class="s3">);</span>
  <span class="s1">A</span><span class="s3">(</span><span class="s1">b</span><span class="s3">, </span><span class="s1">p</span><span class="s3">[</span><span class="s6">0</span><span class="s3">], </span><span class="s1">p</span><span class="s3">[</span><span class="s6">1</span><span class="s3">]);</span>
  <span class="s1">A</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, </span><span class="s1">q</span><span class="s3">[</span><span class="s6">0</span><span class="s3">], </span><span class="s1">q</span><span class="s3">[</span><span class="s6">1</span><span class="s3">]);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">b</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">t</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">p</span><span class="s3">[</span><span class="s6">3</span><span class="s3">], </span><span class="s1">q</span><span class="s3">[</span><span class="s6">3</span><span class="s3">]);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">D2</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">d</span><span class="s3">, </span><span class="s1">p</span><span class="s3">[</span><span class="s6">2</span><span class="s3">], </span><span class="s1">q</span><span class="s3">[</span><span class="s6">2</span><span class="s3">]);</span>
  <span class="s1">A</span><span class="s3">(</span><span class="s1">d</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">d</span><span class="s3">);</span>
  <span class="s1">Z</span><span class="s3">(</span><span class="s1">e</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">a</span><span class="s3">);</span>
  <span class="s1">Z</span><span class="s3">(</span><span class="s1">f</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">c</span><span class="s3">);</span>
  <span class="s1">A</span><span class="s3">(</span><span class="s1">g</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">c</span><span class="s3">);</span>
  <span class="s1">A</span><span class="s3">(</span><span class="s1">h</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">a</span><span class="s3">);</span>

  <span class="s1">M</span><span class="s3">(</span><span class="s1">p</span><span class="s3">[</span><span class="s6">0</span><span class="s3">], </span><span class="s1">e</span><span class="s3">, </span><span class="s1">f</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">p</span><span class="s3">[</span><span class="s6">1</span><span class="s3">], </span><span class="s1">h</span><span class="s3">, </span><span class="s1">g</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">p</span><span class="s3">[</span><span class="s6">2</span><span class="s3">], </span><span class="s1">g</span><span class="s3">, </span><span class="s1">f</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">p</span><span class="s3">[</span><span class="s6">3</span><span class="s3">], </span><span class="s1">e</span><span class="s3">, </span><span class="s1">h</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">cswap</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">q</span><span class="s3">, </span><span class="s1">b</span><span class="s3">) {</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">4</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">sel25519</span><span class="s3">(</span><span class="s1">p</span><span class="s3">[</span><span class="s1">i</span><span class="s3">], </span><span class="s1">q</span><span class="s3">[</span><span class="s1">i</span><span class="s3">], </span><span class="s1">b</span><span class="s3">);</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">pack</span><span class="s3">(</span><span class="s1">r</span><span class="s3">, </span><span class="s1">p</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">tx </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">ty </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">zi </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">();</span>
  <span class="s1">inv25519</span><span class="s3">(</span><span class="s1">zi</span><span class="s3">, </span><span class="s1">p</span><span class="s3">[</span><span class="s6">2</span><span class="s3">]);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">tx</span><span class="s3">, </span><span class="s1">p</span><span class="s3">[</span><span class="s6">0</span><span class="s3">], </span><span class="s1">zi</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, </span><span class="s1">p</span><span class="s3">[</span><span class="s6">1</span><span class="s3">], </span><span class="s1">zi</span><span class="s3">);</span>
  <span class="s1">pack25519</span><span class="s3">(</span><span class="s1">r</span><span class="s3">, </span><span class="s1">ty</span><span class="s3">);</span>
  <span class="s1">r</span><span class="s3">[</span><span class="s6">31</span><span class="s3">] ^= </span><span class="s1">par25519</span><span class="s3">(</span><span class="s1">tx</span><span class="s3">) &lt;&lt; </span><span class="s6">7</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">pack25519</span><span class="s3">(</span><span class="s1">o</span><span class="s3">, </span><span class="s1">n</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">i</span><span class="s3">, </span><span class="s1">j</span><span class="s3">, </span><span class="s1">b</span><span class="s3">;</span>
  <span class="s2">var </span><span class="s1">m </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">t </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">();</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">16</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">t</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">n</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s1">car25519</span><span class="s3">(</span><span class="s1">t</span><span class="s3">);</span>
  <span class="s1">car25519</span><span class="s3">(</span><span class="s1">t</span><span class="s3">);</span>
  <span class="s1">car25519</span><span class="s3">(</span><span class="s1">t</span><span class="s3">);</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">j </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">j </span><span class="s3">&lt; </span><span class="s6">2</span><span class="s3">; ++</span><span class="s1">j</span><span class="s3">) {</span>
    <span class="s1">m</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] = </span><span class="s1">t</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] - </span><span class="s6">0xffed</span><span class="s3">;</span>
    <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">1</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">15</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
      <span class="s1">m</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">t</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] - </span><span class="s6">0xffff </span><span class="s3">- ((</span><span class="s1">m</span><span class="s3">[</span><span class="s1">i </span><span class="s3">- </span><span class="s6">1</span><span class="s3">] &gt;&gt; </span><span class="s6">16</span><span class="s3">) &amp; </span><span class="s6">1</span><span class="s3">);</span>
      <span class="s1">m</span><span class="s3">[</span><span class="s1">i</span><span class="s3">-</span><span class="s6">1</span><span class="s3">] &amp;= </span><span class="s6">0xffff</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s1">m</span><span class="s3">[</span><span class="s6">15</span><span class="s3">] = </span><span class="s1">t</span><span class="s3">[</span><span class="s6">15</span><span class="s3">] - </span><span class="s6">0x7fff </span><span class="s3">- ((</span><span class="s1">m</span><span class="s3">[</span><span class="s6">14</span><span class="s3">] &gt;&gt; </span><span class="s6">16</span><span class="s3">) &amp; </span><span class="s6">1</span><span class="s3">);</span>
    <span class="s1">b </span><span class="s3">= (</span><span class="s1">m</span><span class="s3">[</span><span class="s6">15</span><span class="s3">] &gt;&gt; </span><span class="s6">16</span><span class="s3">) &amp; </span><span class="s6">1</span><span class="s3">;</span>
    <span class="s1">m</span><span class="s3">[</span><span class="s6">14</span><span class="s3">] &amp;= </span><span class="s6">0xffff</span><span class="s3">;</span>
    <span class="s1">sel25519</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, </span><span class="s1">m</span><span class="s3">, </span><span class="s6">1 </span><span class="s3">- </span><span class="s1">b</span><span class="s3">);</span>
  <span class="s3">}</span>
  <span class="s2">for </span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">16</span><span class="s3">; </span><span class="s1">i</span><span class="s3">++) {</span>
    <span class="s1">o</span><span class="s3">[</span><span class="s6">2 </span><span class="s3">* </span><span class="s1">i</span><span class="s3">] = </span><span class="s1">t</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] &amp; </span><span class="s6">0xff</span><span class="s3">;</span>
    <span class="s1">o</span><span class="s3">[</span><span class="s6">2 </span><span class="s3">* </span><span class="s1">i </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">] = </span><span class="s1">t</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] &gt;&gt; </span><span class="s6">8</span><span class="s3">;</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">unpackneg</span><span class="s3">(</span><span class="s1">r</span><span class="s3">, </span><span class="s1">p</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">t </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">chk </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">num </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(),</span>
      <span class="s1">den </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">den2 </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">den4 </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">(),</span>
      <span class="s1">den6 </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">();</span>

  <span class="s1">set25519</span><span class="s3">(</span><span class="s1">r</span><span class="s3">[</span><span class="s6">2</span><span class="s3">], </span><span class="s1">gf1</span><span class="s3">);</span>
  <span class="s1">unpack25519</span><span class="s3">(</span><span class="s1">r</span><span class="s3">[</span><span class="s6">1</span><span class="s3">], </span><span class="s1">p</span><span class="s3">);</span>
  <span class="s1">S</span><span class="s3">(</span><span class="s1">num</span><span class="s3">, </span><span class="s1">r</span><span class="s3">[</span><span class="s6">1</span><span class="s3">]);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">den</span><span class="s3">, </span><span class="s1">num</span><span class="s3">, </span><span class="s1">D</span><span class="s3">);</span>
  <span class="s1">Z</span><span class="s3">(</span><span class="s1">num</span><span class="s3">, </span><span class="s1">num</span><span class="s3">, </span><span class="s1">r</span><span class="s3">[</span><span class="s6">2</span><span class="s3">]);</span>
  <span class="s1">A</span><span class="s3">(</span><span class="s1">den</span><span class="s3">, </span><span class="s1">r</span><span class="s3">[</span><span class="s6">2</span><span class="s3">], </span><span class="s1">den</span><span class="s3">);</span>

  <span class="s1">S</span><span class="s3">(</span><span class="s1">den2</span><span class="s3">, </span><span class="s1">den</span><span class="s3">);</span>
  <span class="s1">S</span><span class="s3">(</span><span class="s1">den4</span><span class="s3">, </span><span class="s1">den2</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">den6</span><span class="s3">, </span><span class="s1">den4</span><span class="s3">, </span><span class="s1">den2</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, </span><span class="s1">den6</span><span class="s3">, </span><span class="s1">num</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, </span><span class="s1">t</span><span class="s3">, </span><span class="s1">den</span><span class="s3">);</span>

  <span class="s1">pow2523</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, </span><span class="s1">t</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, </span><span class="s1">t</span><span class="s3">, </span><span class="s1">num</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, </span><span class="s1">t</span><span class="s3">, </span><span class="s1">den</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, </span><span class="s1">t</span><span class="s3">, </span><span class="s1">den</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">r</span><span class="s3">[</span><span class="s6">0</span><span class="s3">], </span><span class="s1">t</span><span class="s3">, </span><span class="s1">den</span><span class="s3">);</span>

  <span class="s1">S</span><span class="s3">(</span><span class="s1">chk</span><span class="s3">, </span><span class="s1">r</span><span class="s3">[</span><span class="s6">0</span><span class="s3">]);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">chk</span><span class="s3">, </span><span class="s1">chk</span><span class="s3">, </span><span class="s1">den</span><span class="s3">);</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">neq25519</span><span class="s3">(</span><span class="s1">chk</span><span class="s3">, </span><span class="s1">num</span><span class="s3">)) {</span>
    <span class="s1">M</span><span class="s3">(</span><span class="s1">r</span><span class="s3">[</span><span class="s6">0</span><span class="s3">], </span><span class="s1">r</span><span class="s3">[</span><span class="s6">0</span><span class="s3">], </span><span class="s1">I</span><span class="s3">);</span>
  <span class="s3">}</span>

  <span class="s1">S</span><span class="s3">(</span><span class="s1">chk</span><span class="s3">, </span><span class="s1">r</span><span class="s3">[</span><span class="s6">0</span><span class="s3">]);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">chk</span><span class="s3">, </span><span class="s1">chk</span><span class="s3">, </span><span class="s1">den</span><span class="s3">);</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">neq25519</span><span class="s3">(</span><span class="s1">chk</span><span class="s3">, </span><span class="s1">num</span><span class="s3">)) {</span>
    <span class="s2">return </span><span class="s3">-</span><span class="s6">1</span><span class="s3">;</span>
  <span class="s3">}</span>

  <span class="s2">if</span><span class="s3">(</span><span class="s1">par25519</span><span class="s3">(</span><span class="s1">r</span><span class="s3">[</span><span class="s6">0</span><span class="s3">]) === (</span><span class="s1">p</span><span class="s3">[</span><span class="s6">31</span><span class="s3">] &gt;&gt; </span><span class="s6">7</span><span class="s3">)) {</span>
    <span class="s1">Z</span><span class="s3">(</span><span class="s1">r</span><span class="s3">[</span><span class="s6">0</span><span class="s3">], </span><span class="s1">gf0</span><span class="s3">, </span><span class="s1">r</span><span class="s3">[</span><span class="s6">0</span><span class="s3">]);</span>
  <span class="s3">}</span>

  <span class="s1">M</span><span class="s3">(</span><span class="s1">r</span><span class="s3">[</span><span class="s6">3</span><span class="s3">], </span><span class="s1">r</span><span class="s3">[</span><span class="s6">0</span><span class="s3">], </span><span class="s1">r</span><span class="s3">[</span><span class="s6">1</span><span class="s3">]);</span>
  <span class="s2">return </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">unpack25519</span><span class="s3">(</span><span class="s1">o</span><span class="s3">, </span><span class="s1">n</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">i</span><span class="s3">;</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">16</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">o</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">n</span><span class="s3">[</span><span class="s6">2 </span><span class="s3">* </span><span class="s1">i</span><span class="s3">] + (</span><span class="s1">n</span><span class="s3">[</span><span class="s6">2 </span><span class="s3">* </span><span class="s1">i </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">] &lt;&lt; </span><span class="s6">8</span><span class="s3">);</span>
  <span class="s3">}</span>
  <span class="s1">o</span><span class="s3">[</span><span class="s6">15</span><span class="s3">] &amp;= </span><span class="s6">0x7fff</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">pow2523</span><span class="s3">(</span><span class="s1">o</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">c </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">();</span>
  <span class="s2">var </span><span class="s1">a</span><span class="s3">;</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">a </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">a </span><span class="s3">&lt; </span><span class="s6">16</span><span class="s3">; ++</span><span class="s1">a</span><span class="s3">) {</span>
    <span class="s1">c</span><span class="s3">[</span><span class="s1">a</span><span class="s3">] = </span><span class="s1">i</span><span class="s3">[</span><span class="s1">a</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">a </span><span class="s3">= </span><span class="s6">250</span><span class="s3">; </span><span class="s1">a </span><span class="s3">&gt;= </span><span class="s6">0</span><span class="s3">; --</span><span class="s1">a</span><span class="s3">) {</span>
    <span class="s1">S</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">c</span><span class="s3">);</span>
    <span class="s2">if</span><span class="s3">(</span><span class="s1">a </span><span class="s3">!== </span><span class="s6">1</span><span class="s3">) {</span>
      <span class="s1">M</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">i</span><span class="s3">);</span>
    <span class="s3">}</span>
  <span class="s3">}</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">a </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">a </span><span class="s3">&lt; </span><span class="s6">16</span><span class="s3">; ++</span><span class="s1">a</span><span class="s3">) {</span>
    <span class="s1">o</span><span class="s3">[</span><span class="s1">a</span><span class="s3">] = </span><span class="s1">c</span><span class="s3">[</span><span class="s1">a</span><span class="s3">];</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">neq25519</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">c </span><span class="s3">= </span><span class="s2">new </span><span class="s1">NativeBuffer</span><span class="s3">(</span><span class="s6">32</span><span class="s3">);</span>
  <span class="s2">var </span><span class="s1">d </span><span class="s3">= </span><span class="s2">new </span><span class="s1">NativeBuffer</span><span class="s3">(</span><span class="s6">32</span><span class="s3">);</span>
  <span class="s1">pack25519</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">a</span><span class="s3">);</span>
  <span class="s1">pack25519</span><span class="s3">(</span><span class="s1">d</span><span class="s3">, </span><span class="s1">b</span><span class="s3">);</span>
  <span class="s2">return </span><span class="s1">crypto_verify_32</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s6">0</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">crypto_verify_32</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">xi</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">yi</span><span class="s3">) {</span>
  <span class="s2">return </span><span class="s1">vn</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">xi</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">yi</span><span class="s3">, </span><span class="s6">32</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">vn</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">xi</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">yi</span><span class="s3">, </span><span class="s1">n</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">i</span><span class="s3">, </span><span class="s1">d </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">n</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">d </span><span class="s3">|= </span><span class="s1">x</span><span class="s3">[</span><span class="s1">xi </span><span class="s3">+ </span><span class="s1">i</span><span class="s3">] ^ </span><span class="s1">y</span><span class="s3">[</span><span class="s1">yi </span><span class="s3">+ </span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">return </span><span class="s3">(</span><span class="s6">1 </span><span class="s3">&amp; ((</span><span class="s1">d </span><span class="s3">- </span><span class="s6">1</span><span class="s3">) &gt;&gt;&gt; </span><span class="s6">8</span><span class="s3">)) - </span><span class="s6">1</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">par25519</span><span class="s3">(</span><span class="s1">a</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">d </span><span class="s3">= </span><span class="s2">new </span><span class="s1">NativeBuffer</span><span class="s3">(</span><span class="s6">32</span><span class="s3">);</span>
  <span class="s1">pack25519</span><span class="s3">(</span><span class="s1">d</span><span class="s3">, </span><span class="s1">a</span><span class="s3">);</span>
  <span class="s2">return </span><span class="s1">d</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] &amp; </span><span class="s6">1</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">scalarmult</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">q</span><span class="s3">, </span><span class="s1">s</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">b</span><span class="s3">, </span><span class="s1">i</span><span class="s3">;</span>
  <span class="s1">set25519</span><span class="s3">(</span><span class="s1">p</span><span class="s3">[</span><span class="s6">0</span><span class="s3">], </span><span class="s1">gf0</span><span class="s3">);</span>
  <span class="s1">set25519</span><span class="s3">(</span><span class="s1">p</span><span class="s3">[</span><span class="s6">1</span><span class="s3">], </span><span class="s1">gf1</span><span class="s3">);</span>
  <span class="s1">set25519</span><span class="s3">(</span><span class="s1">p</span><span class="s3">[</span><span class="s6">2</span><span class="s3">], </span><span class="s1">gf1</span><span class="s3">);</span>
  <span class="s1">set25519</span><span class="s3">(</span><span class="s1">p</span><span class="s3">[</span><span class="s6">3</span><span class="s3">], </span><span class="s1">gf0</span><span class="s3">);</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">255</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&gt;= </span><span class="s6">0</span><span class="s3">; --</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">b </span><span class="s3">= (</span><span class="s1">s</span><span class="s3">[(</span><span class="s1">i </span><span class="s3">/ </span><span class="s6">8</span><span class="s3">)|</span><span class="s6">0</span><span class="s3">] &gt;&gt; (</span><span class="s1">i </span><span class="s3">&amp; </span><span class="s6">7</span><span class="s3">)) &amp; </span><span class="s6">1</span><span class="s3">;</span>
    <span class="s1">cswap</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">q</span><span class="s3">, </span><span class="s1">b</span><span class="s3">);</span>
    <span class="s1">add</span><span class="s3">(</span><span class="s1">q</span><span class="s3">, </span><span class="s1">p</span><span class="s3">);</span>
    <span class="s1">add</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">p</span><span class="s3">);</span>
    <span class="s1">cswap</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">q</span><span class="s3">, </span><span class="s1">b</span><span class="s3">);</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">scalarbase</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">s</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">q </span><span class="s3">= [</span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">(), </span><span class="s1">gf</span><span class="s3">()];</span>
  <span class="s1">set25519</span><span class="s3">(</span><span class="s1">q</span><span class="s3">[</span><span class="s6">0</span><span class="s3">], </span><span class="s1">X</span><span class="s3">);</span>
  <span class="s1">set25519</span><span class="s3">(</span><span class="s1">q</span><span class="s3">[</span><span class="s6">1</span><span class="s3">], </span><span class="s1">Y</span><span class="s3">);</span>
  <span class="s1">set25519</span><span class="s3">(</span><span class="s1">q</span><span class="s3">[</span><span class="s6">2</span><span class="s3">], </span><span class="s1">gf1</span><span class="s3">);</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">q</span><span class="s3">[</span><span class="s6">3</span><span class="s3">], </span><span class="s1">X</span><span class="s3">, </span><span class="s1">Y</span><span class="s3">);</span>
  <span class="s1">scalarmult</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">q</span><span class="s3">, </span><span class="s1">s</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">set25519</span><span class="s3">(</span><span class="s1">r</span><span class="s3">, </span><span class="s1">a</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">i</span><span class="s3">;</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">16</span><span class="s3">; </span><span class="s1">i</span><span class="s3">++) {</span>
    <span class="s1">r</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">a</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] | </span><span class="s6">0</span><span class="s3">;</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">inv25519</span><span class="s3">(</span><span class="s1">o</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">c </span><span class="s3">= </span><span class="s1">gf</span><span class="s3">();</span>
  <span class="s2">var </span><span class="s1">a</span><span class="s3">;</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">a </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">a </span><span class="s3">&lt; </span><span class="s6">16</span><span class="s3">; ++</span><span class="s1">a</span><span class="s3">) {</span>
    <span class="s1">c</span><span class="s3">[</span><span class="s1">a</span><span class="s3">] = </span><span class="s1">i</span><span class="s3">[</span><span class="s1">a</span><span class="s3">];</span>
  <span class="s3">}</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">a </span><span class="s3">= </span><span class="s6">253</span><span class="s3">; </span><span class="s1">a </span><span class="s3">&gt;= </span><span class="s6">0</span><span class="s3">; --</span><span class="s1">a</span><span class="s3">) {</span>
    <span class="s1">S</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">c</span><span class="s3">);</span>
    <span class="s2">if</span><span class="s3">(</span><span class="s1">a </span><span class="s3">!== </span><span class="s6">2 </span><span class="s3">&amp;&amp; </span><span class="s1">a </span><span class="s3">!== </span><span class="s6">4</span><span class="s3">) {</span>
      <span class="s1">M</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">i</span><span class="s3">);</span>
    <span class="s3">}</span>
  <span class="s3">}</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">a </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">a </span><span class="s3">&lt; </span><span class="s6">16</span><span class="s3">; ++</span><span class="s1">a</span><span class="s3">) {</span>
    <span class="s1">o</span><span class="s3">[</span><span class="s1">a</span><span class="s3">] = </span><span class="s1">c</span><span class="s3">[</span><span class="s1">a</span><span class="s3">];</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">car25519</span><span class="s3">(</span><span class="s1">o</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">i</span><span class="s3">, </span><span class="s1">v</span><span class="s3">, </span><span class="s1">c </span><span class="s3">= </span><span class="s6">1</span><span class="s3">;</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">16</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">v </span><span class="s3">= </span><span class="s1">o</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] + </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">;</span>
    <span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);</span>
    <span class="s1">o</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s3">}</span>
  <span class="s1">o</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] += </span><span class="s1">c </span><span class="s3">- </span><span class="s6">1 </span><span class="s3">+ </span><span class="s6">37 </span><span class="s3">* (</span><span class="s1">c </span><span class="s3">- </span><span class="s6">1</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">sel25519</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">q</span><span class="s3">, </span><span class="s1">b</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">t</span><span class="s3">, </span><span class="s1">c </span><span class="s3">= ~(</span><span class="s1">b </span><span class="s3">- </span><span class="s6">1</span><span class="s3">);</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">16</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">t </span><span class="s3">= </span><span class="s1">c </span><span class="s3">&amp; (</span><span class="s1">p</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] ^ </span><span class="s1">q</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]);</span>
    <span class="s1">p</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] ^= </span><span class="s1">t</span><span class="s3">;</span>
    <span class="s1">q</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] ^= </span><span class="s1">t</span><span class="s3">;</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">gf</span><span class="s3">(</span><span class="s1">init</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">i</span><span class="s3">, </span><span class="s1">r </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Float64Array</span><span class="s3">(</span><span class="s6">16</span><span class="s3">);</span>
  <span class="s2">if</span><span class="s3">(</span><span class="s1">init</span><span class="s3">) {</span>
    <span class="s2">for</span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">init</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
      <span class="s1">r</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">init</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
    <span class="s3">}</span>
  <span class="s3">}</span>
  <span class="s2">return </span><span class="s1">r</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">A</span><span class="s3">(</span><span class="s1">o</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">) {</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">16</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">o</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">a</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] + </span><span class="s1">b</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">Z</span><span class="s3">(</span><span class="s1">o</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">) {</span>
  <span class="s2">for</span><span class="s3">(</span><span class="s2">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">16</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s1">o</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">a</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] - </span><span class="s1">b</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
  <span class="s3">}</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">S</span><span class="s3">(</span><span class="s1">o</span><span class="s3">, </span><span class="s1">a</span><span class="s3">) {</span>
  <span class="s1">M</span><span class="s3">(</span><span class="s1">o</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">a</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s2">function </span><span class="s1">M</span><span class="s3">(</span><span class="s1">o</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">) {</span>
  <span class="s2">var </span><span class="s1">v</span><span class="s3">, </span><span class="s1">c</span><span class="s3">,</span>
     <span class="s1">t0 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">,  </span><span class="s1">t1 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">,  </span><span class="s1">t2 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">,  </span><span class="s1">t3 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">,  </span><span class="s1">t4 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">,  </span><span class="s1">t5 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">,  </span><span class="s1">t6 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">,  </span><span class="s1">t7 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">,</span>
     <span class="s1">t8 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">,  </span><span class="s1">t9 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t10 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t11 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t12 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t13 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t14 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t15 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">,</span>
    <span class="s1">t16 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t17 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t18 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t19 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t20 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t21 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t22 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t23 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">,</span>
    <span class="s1">t24 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t25 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t26 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t27 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t28 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t29 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">t30 </span><span class="s3">= </span><span class="s6">0</span><span class="s3">,</span>
    <span class="s1">b0 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">0</span><span class="s3">],</span>
    <span class="s1">b1 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">1</span><span class="s3">],</span>
    <span class="s1">b2 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">2</span><span class="s3">],</span>
    <span class="s1">b3 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">3</span><span class="s3">],</span>
    <span class="s1">b4 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">4</span><span class="s3">],</span>
    <span class="s1">b5 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">5</span><span class="s3">],</span>
    <span class="s1">b6 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">6</span><span class="s3">],</span>
    <span class="s1">b7 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">7</span><span class="s3">],</span>
    <span class="s1">b8 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">8</span><span class="s3">],</span>
    <span class="s1">b9 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">9</span><span class="s3">],</span>
    <span class="s1">b10 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">10</span><span class="s3">],</span>
    <span class="s1">b11 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">11</span><span class="s3">],</span>
    <span class="s1">b12 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">12</span><span class="s3">],</span>
    <span class="s1">b13 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">13</span><span class="s3">],</span>
    <span class="s1">b14 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">14</span><span class="s3">],</span>
    <span class="s1">b15 </span><span class="s3">= </span><span class="s1">b</span><span class="s3">[</span><span class="s6">15</span><span class="s3">];</span>

  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">0</span><span class="s3">];</span>
  <span class="s1">t0 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t1 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t2 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t3 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t4 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t5 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t6 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t7 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t8 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t9 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t10 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t11 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">1</span><span class="s3">];</span>
  <span class="s1">t1 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t2 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t3 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t4 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t5 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t6 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t7 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t8 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t9 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t10 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t11 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">2</span><span class="s3">];</span>
  <span class="s1">t2 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t3 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t4 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t5 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t6 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t7 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t8 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t9 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t10 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t11 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">3</span><span class="s3">];</span>
  <span class="s1">t3 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t4 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t5 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t6 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t7 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t8 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t9 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t10 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t11 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t18 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">4</span><span class="s3">];</span>
  <span class="s1">t4 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t5 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t6 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t7 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t8 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t9 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t10 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t11 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t18 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t19 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">5</span><span class="s3">];</span>
  <span class="s1">t5 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t6 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t7 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t8 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t9 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t10 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t11 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t18 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t19 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t20 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">6</span><span class="s3">];</span>
  <span class="s1">t6 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t7 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t8 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t9 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t10 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t11 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t18 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t19 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t20 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t21 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">7</span><span class="s3">];</span>
  <span class="s1">t7 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t8 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t9 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t10 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t11 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t18 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t19 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t20 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t21 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t22 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">8</span><span class="s3">];</span>
  <span class="s1">t8 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t9 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t10 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t11 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t18 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t19 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t20 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t21 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t22 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t23 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">9</span><span class="s3">];</span>
  <span class="s1">t9 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t10 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t11 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t18 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t19 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t20 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t21 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t22 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t23 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t24 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">10</span><span class="s3">];</span>
  <span class="s1">t10 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t11 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t18 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t19 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t20 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t21 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t22 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t23 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t24 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t25 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">11</span><span class="s3">];</span>
  <span class="s1">t11 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t18 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t19 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t20 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t21 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t22 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t23 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t24 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t25 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t26 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">12</span><span class="s3">];</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t18 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t19 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t20 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t21 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t22 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t23 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t24 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t25 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t26 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t27 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">13</span><span class="s3">];</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t18 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t19 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t20 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t21 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t22 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t23 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t24 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t25 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t26 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t27 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t28 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">14</span><span class="s3">];</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t18 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t19 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t20 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t21 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t22 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t23 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t24 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t25 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t26 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t27 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t28 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t29 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s6">15</span><span class="s3">];</span>
  <span class="s1">t15 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b0</span><span class="s3">;</span>
  <span class="s1">t16 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b1</span><span class="s3">;</span>
  <span class="s1">t17 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b2</span><span class="s3">;</span>
  <span class="s1">t18 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b3</span><span class="s3">;</span>
  <span class="s1">t19 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b4</span><span class="s3">;</span>
  <span class="s1">t20 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b5</span><span class="s3">;</span>
  <span class="s1">t21 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b6</span><span class="s3">;</span>
  <span class="s1">t22 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b7</span><span class="s3">;</span>
  <span class="s1">t23 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b8</span><span class="s3">;</span>
  <span class="s1">t24 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b9</span><span class="s3">;</span>
  <span class="s1">t25 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b10</span><span class="s3">;</span>
  <span class="s1">t26 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b11</span><span class="s3">;</span>
  <span class="s1">t27 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b12</span><span class="s3">;</span>
  <span class="s1">t28 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b13</span><span class="s3">;</span>
  <span class="s1">t29 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b14</span><span class="s3">;</span>
  <span class="s1">t30 </span><span class="s3">+= </span><span class="s1">v </span><span class="s3">* </span><span class="s1">b15</span><span class="s3">;</span>

  <span class="s1">t0  </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t16</span><span class="s3">;</span>
  <span class="s1">t1  </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t17</span><span class="s3">;</span>
  <span class="s1">t2  </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t18</span><span class="s3">;</span>
  <span class="s1">t3  </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t19</span><span class="s3">;</span>
  <span class="s1">t4  </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t20</span><span class="s3">;</span>
  <span class="s1">t5  </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t21</span><span class="s3">;</span>
  <span class="s1">t6  </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t22</span><span class="s3">;</span>
  <span class="s1">t7  </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t23</span><span class="s3">;</span>
  <span class="s1">t8  </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t24</span><span class="s3">;</span>
  <span class="s1">t9  </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t25</span><span class="s3">;</span>
  <span class="s1">t10 </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t26</span><span class="s3">;</span>
  <span class="s1">t11 </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t27</span><span class="s3">;</span>
  <span class="s1">t12 </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t28</span><span class="s3">;</span>
  <span class="s1">t13 </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t29</span><span class="s3">;</span>
  <span class="s1">t14 </span><span class="s3">+= </span><span class="s6">38 </span><span class="s3">* </span><span class="s1">t30</span><span class="s3">;</span>
  <span class="s5">// t15 left as is</span>

  <span class="s5">// first car</span>
  <span class="s1">c </span><span class="s3">= </span><span class="s6">1</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t0 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t0 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t1 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t1 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t2 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t2 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t3 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t3 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t4 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t4 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t5 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t5 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t6 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t6 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t7 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t7 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t8 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t8 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t9 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t9 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">t10 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">); </span><span class="s1">t10 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">t11 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">); </span><span class="s1">t11 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">t12 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">); </span><span class="s1">t12 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">t13 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">); </span><span class="s1">t13 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">t14 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">); </span><span class="s1">t14 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">t15 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">); </span><span class="s1">t15 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">t0 </span><span class="s3">+= </span><span class="s1">c</span><span class="s3">-</span><span class="s6">1 </span><span class="s3">+ </span><span class="s6">37 </span><span class="s3">* (</span><span class="s1">c</span><span class="s3">-</span><span class="s6">1</span><span class="s3">);</span>

  <span class="s5">// second car</span>
  <span class="s1">c </span><span class="s3">= </span><span class="s6">1</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t0 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t0 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t1 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t1 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t2 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t2 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t3 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t3 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t4 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t4 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t5 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t5 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t6 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t6 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t7 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t7 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t8 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t8 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">=  </span><span class="s1">t9 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">);  </span><span class="s1">t9 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">t10 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">); </span><span class="s1">t10 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">t11 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">); </span><span class="s1">t11 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">t12 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">); </span><span class="s1">t12 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">t13 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">); </span><span class="s1">t13 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">t14 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">); </span><span class="s1">t14 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">v </span><span class="s3">= </span><span class="s1">t15 </span><span class="s3">+ </span><span class="s1">c </span><span class="s3">+ </span><span class="s6">65535</span><span class="s3">; </span><span class="s1">c </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">v </span><span class="s3">/ </span><span class="s6">65536</span><span class="s3">); </span><span class="s1">t15 </span><span class="s3">= </span><span class="s1">v </span><span class="s3">- </span><span class="s1">c </span><span class="s3">* </span><span class="s6">65536</span><span class="s3">;</span>
  <span class="s1">t0 </span><span class="s3">+= </span><span class="s1">c</span><span class="s3">-</span><span class="s6">1 </span><span class="s3">+ </span><span class="s6">37 </span><span class="s3">* (</span><span class="s1">c</span><span class="s3">-</span><span class="s6">1</span><span class="s3">);</span>

  <span class="s1">o</span><span class="s3">[ </span><span class="s6">0</span><span class="s3">] = </span><span class="s1">t0</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[ </span><span class="s6">1</span><span class="s3">] = </span><span class="s1">t1</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[ </span><span class="s6">2</span><span class="s3">] = </span><span class="s1">t2</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[ </span><span class="s6">3</span><span class="s3">] = </span><span class="s1">t3</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[ </span><span class="s6">4</span><span class="s3">] = </span><span class="s1">t4</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[ </span><span class="s6">5</span><span class="s3">] = </span><span class="s1">t5</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[ </span><span class="s6">6</span><span class="s3">] = </span><span class="s1">t6</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[ </span><span class="s6">7</span><span class="s3">] = </span><span class="s1">t7</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[ </span><span class="s6">8</span><span class="s3">] = </span><span class="s1">t8</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[ </span><span class="s6">9</span><span class="s3">] = </span><span class="s1">t9</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[</span><span class="s6">10</span><span class="s3">] = </span><span class="s1">t10</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[</span><span class="s6">11</span><span class="s3">] = </span><span class="s1">t11</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[</span><span class="s6">12</span><span class="s3">] = </span><span class="s1">t12</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[</span><span class="s6">13</span><span class="s3">] = </span><span class="s1">t13</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[</span><span class="s6">14</span><span class="s3">] = </span><span class="s1">t14</span><span class="s3">;</span>
  <span class="s1">o</span><span class="s3">[</span><span class="s6">15</span><span class="s3">] = </span><span class="s1">t15</span><span class="s3">;</span>
<span class="s3">}</span>
</pre>
</body>
</html>