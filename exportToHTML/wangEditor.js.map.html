<html>
<head>
<title>wangEditor.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
.s1 { color: #6aab73;}
.s2 { color: #2aacb8;}
.s3 { color: #cf8e6d;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
wangEditor.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;webpack://wangEditor/webpack/universalModuleDefinition&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/webpack/bootstrap&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/helpers/interopRequireDefault.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/object/define-property.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/tslib/tslib.es6.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/utils/dom-core.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/instance/for-each.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/export.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/utils/util.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/utils/const.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/global.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/path.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/well-known-symbol.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/fails.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/define-well-known-symbol.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/is-object.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/descriptors.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/entry-virtual.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/has.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/instance/trim.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-define-property.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/create-non-enumerable-property.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/css-loader/dist/runtime/api.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/array-method-uses-to-length.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/menu-constructors/BtnMenu.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/menu-constructors/DropListMenu.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/an-object.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/instance/map.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/instance/index-of.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/instance/includes.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/instance/find.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/to-indexed-object.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/to-object.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/array-iteration.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/menu-constructors/Panel.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/classof-raw.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/to-length.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/get-built-in.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/set-to-string-tag.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/menu-constructors/PanelMenu.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/menu-constructors/Tooltip.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/function-bind-context.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/a-function.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/internal-state.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/is-pure.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/iterators.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/instance/slice.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/set-timeout.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/list/utils.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/create-property-descriptor.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/require-object-coercible.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.string.iterator.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/hidden-keys.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-keys.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/redefine.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/web.dom-collections.iterator.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/is-array.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/array-method-has-species-support.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/instance/bind.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/list/ListHandle/ListHandle.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-property-is-enumerable.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/to-primitive.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.object.to-string.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/to-integer.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/shared-key.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/uid.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/classof.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/iterate.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/array-method-is-strict.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/whitespaces.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/create-property.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/instance/filter.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-get-own-property-descriptor.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/indexed-object.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/document-create-element.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/shared.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/define-iterator.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/native-symbol.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-create.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/array-includes.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/to-absolute-index.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/enum-bug-keys.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/to-string-tag-support.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/add-to-unscopables.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/an-instance.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/engine-user-agent.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/new-promise-capability.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/engine-v8-version.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/array-species-create.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/array/is-array.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/string-trim.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/instance/splice.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/helpers/typeof.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/well-known-symbol-wrapped.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/object/entries.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/menu-constructors/Menu.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/link/is-active.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/img/upload-img.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/todo/util.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/utils/data-structure/cache.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/ie8-dom-define.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/is-forced.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/inspect-source.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/shared-store.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/iterators-core.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-get-prototype-of.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/use-symbol-as-uid.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-keys-internal.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/html.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/native-promise-constructor.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/redefine-all.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/set-species.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/is-array-iterator-method.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/get-iterator-method.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/call-with-safe-iteration-closing.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/check-correctness-of-iteration.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/species-constructor.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/task.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/engine-is-ios.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/promise-resolve.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/perform.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/map.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/collection.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/internal-metadata.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/collection-strong.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.iterator.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-get-own-property-names.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-get-own-property-symbols.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/object/assign.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/config/style.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/config/text.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/text/paste/paste-event.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/set.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/instance/some.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/menu-constructors/DropList.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/upload/upload-core.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/upload/progress.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/list/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/array/from.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/code/is-active.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/todo/todo.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/wangEditor.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/object/define-property.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/object/define-property.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.object.define-property.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/(webpack)/buildin/global.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/common.less?4672&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/common.less&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/icon.less?c1d5&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/icon.less&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/css-loader/dist/runtime/getUrl.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/font/w-e-icon.woff&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/menus.less?3c63&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/menus.less&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/text.less?71cc&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/text.less&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/panel.less?63fd&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/panel.less&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/droplist.less?4262&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/droplist.less&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/utils/polyfill.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/promise.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/promise/index.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/promise/index.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/string-multibyte.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/native-weak-map.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/set-global.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/create-iterator-constructor.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/correct-prototype-getter.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-define-properties.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-to-string.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-set-prototype-of.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/a-possible-prototype.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.iterator.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/dom-iterables.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.promise.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/microtask.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/host-report-errors.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.promise.all-settled.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.promise.finally.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/instance/for-each.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/array/virtual/for-each.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/array/virtual/for-each.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.for-each.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/array-for-each.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/array/is-array.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/array/is-array.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.is-array.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/instance/map.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/instance/map.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/array/virtual/map.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.map.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/instance/trim.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/instance/trim.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/string/virtual/trim.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.string.trim.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/string-trim-forced.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/map/index.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/map/index.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.map.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/freezing.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/instance/index-of.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/instance/index-of.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/array/virtual/index-of.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.index-of.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/instance/splice.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/instance/splice.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/array/virtual/splice.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.splice.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/instance/filter.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/instance/filter.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/array/virtual/filter.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.filter.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/instance/includes.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/instance/includes.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/array/virtual/includes.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.includes.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/string/virtual/includes.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.string.includes.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/not-a-regexp.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/is-regexp.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/correct-is-regexp-logic.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/instance/bind.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/instance/bind.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/function/virtual/bind.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.function.bind.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/function-bind.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js/symbol/iterator.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/features/symbol/iterator.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/symbol/iterator.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js/symbol.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/features/symbol/index.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/symbol/index.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.concat.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-get-own-property-names-external.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.async-iterator.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.description.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.has-instance.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.is-concat-spreadable.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.match.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.match-all.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.replace.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.search.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.species.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.split.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.to-primitive.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.to-string-tag.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.symbol.unscopables.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.math.to-string-tag.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.json.to-string-tag.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/esnext.symbol.async-dispose.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/esnext.symbol.dispose.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/esnext.symbol.observable.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/esnext.symbol.pattern-match.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/esnext.symbol.replace-all.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/parse-int.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/parse-int.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/parse-int.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.parse-int.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/number-parse-int.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/instance/slice.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/instance/slice.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/array/virtual/slice.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.slice.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/set-timeout.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/web.timers.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/config/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/object/assign.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/object/assign.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.object.assign.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-assign.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/config/menus.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/config/events.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/config/paste.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/config/cmd.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/config/image.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/config/lang.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/config/history.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/config/video.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/selection.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/command.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/text/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/instance/find.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/instance/find.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/array/virtual/find.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.find.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/text/event-hooks/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/text/event-hooks/enter-to-create-p.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/text/event-hooks/del-to-keep-p.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/text/event-hooks/tab-to-space.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/text/event-hooks/paste-text-html.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/text/paste/parse-html.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/text/paste/tags.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/set/index.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/set/index.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.set.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/lib/simplehtmlparser.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/text/event-hooks/img-click-active.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/text/getChildrenJSON.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/text/getHtmlByNodeList.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/object/keys.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/object/keys.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/object/keys.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.object.keys.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/object/entries.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/object/entries.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.object.entries.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/object-to-array.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/instance/some.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/instance/some.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/array/virtual/some.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.some.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/menu-list.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/bold/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/head/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/json/stringify.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/json/stringify.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/json/stringify.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.json.stringify.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/link/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/link/create-panel-conf.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/link/util.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/link/bind-event/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/link/bind-event/tooltip-event.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/italic/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/underline/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/strike-through/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/font-style/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/font-style/FontStyleList.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/font-size/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/font-size/FontSizeList.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/justify/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/quote/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/quote/bind-event/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/quote/create-quote-node.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/back-color/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/font-color/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/video/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/video/create-panel-conf.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/video/upload-video.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/date/now.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/date/now.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/date/now.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.date.now.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/video/bind-event/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/video/bind-event/tooltip-event.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/video/bind-event/video-alignment.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/video/bind-event/keyboard.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/img/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/img/bind-event/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/img/bind-event/paste-img.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/img/bind-event/drop-img.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/img/bind-event/drag-size.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/parse-float.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/parse-float.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/parse-float.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.parse-float.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/number-parse-float.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/drag-size.less?198e&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/drag-size.less&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/img/bind-event/tooltip-event.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/img/bind-event/keyboard-event.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/img/create-panel-conf.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/indent/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/indent/operate-element.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/indent/increase-indent-style.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/indent/decrease-indent-style.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/emoticon/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/emoticon/create-panel-conf.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/list/ListHandle/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/list/ListHandle/WrapListHandle.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/list/SelectionRangeElem.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/list/ListHandle/JoinListHandle.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/list/ListHandle/StartJoinListHandle.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/list/ListHandle/EndJoinListHandle.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/list/ListHandle/OtherListHandle.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/lineHeight/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/lineHeight/lineHeightList.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/undo/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/redo/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/table/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/table/create-panel-conf.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/number/is-integer.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/number/is-integer.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/number/is-integer.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.number.is-integer.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/is-integer.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/create-panel-conf.less?d818&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/create-panel-conf.less&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/table/create-table.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/table/bind-event/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/table/bind-event/tooltip-event.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/table/bind-event/event/operating-event.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/array/from.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/array/from.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.from.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/internals/array-from.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/table/bind-event/event/getNode.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/table/bind-event/table-event.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/code/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/code/create-panel-conf.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/code/bind-event/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/code/bind-event/tooltip-event.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/code/bind-event/jump-code-block-down.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/split-line/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/split-line/bind-event/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/split-line/bind-event/tooltip-event.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/todo/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/@babel/runtime-corejs3/core-js-stable/instance/every.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/stable/instance/every.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/instance/every.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/es/array/virtual/every.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./node_modules/core-js-pure/modules/es.array.every.js&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/menus/todo/bind-event/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/init-fns/init-dom.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/init-fns/init-selection.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/init-fns/bind-event.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/init-fns/i18next-init.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/init-fns/set-full-screen.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/full-screen.less?b9eb&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/full-screen.less&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/init-fns/scroll-to-head.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/z-index/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/change/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/utils/observer/mutation.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/history/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/history/data/content.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/history/data/node/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/utils/data-structure/stack.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/history/data/node/compile.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/history/data/node/decompilation.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/history/data/html/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/utils/data-structure/chain.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/history/data/scroll/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/history/data/range/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/disable/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/disable.less?38a7&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/assets/style/disable.less&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/editor/selection-change/index.ts&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack://wangEditor/./src/plugins/index.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;QCVA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;AClFA;AACA;AACA;AACA;AACA;;AAEA,wC;;;;;;ACNA,iBAAiB,mBAAO,CAAC,GAA4C,E;;;;;;;ACArE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAU,gBAAgB,sCAAsC,iBAAiB,EAAE;AACnF,yBAAyB,8EAA8E;AACvG;AACA;;AAEO;AACP;AACA;AACA;AACA,mBAAmB,sBAAsB;AACzC;AACA;;AAEO;AACP;AACA,gDAAgD,OAAO;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEO;AACP;AACA;AACA;AACA;AACA,4DAA4D,cAAc;AAC1E;AACA;AACA;AACA;AACA;;AAEO;AACP;AACA;AACA,4CAA4C,QAAQ;AACpD;AACA;;AAEO;AACP,mCAAmC,oCAAoC;AACvE;;AAEO;AACP;AACA;;AAEO;AACP,2BAA2B,+DAA+D,gBAAgB,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CA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,gBAAgB,KAAwC,GAAG,sBAAiB,GAAG,SAAI;;AAEnF;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA,qEAAqE,qBAAqB,aAAa;;AAEvG;;AAEA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA,yDAAyD;AACzD,GAAG;;AAEH;;;AAGA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA,0BAA0B;AAC1B;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,mBAAmB,4BAA4B;AAC/C;AACA;AACA;AACA;;AAEA;;AAEA,oBAAoB,6BAA6B;AACjD;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,E;;;;;;;AC5Qa;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;;AAEhB;AACA;AACA;;AAEA;AACA,4CAA4C,qBAAqB;AACjE;;AAEA;AACA,KAAK;AACL,IAAI;AACJ;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,qBAAqB,iBAAiB;AACtC;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,oBAAoB,qBAAqB;AACzC;;AAEA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CA;AACA;AACA;AACA;AACA;AACA,GAAG,gBAAgB;AACnB;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;;;;;;AC7EA,sBAAsB,mBAAO,CAAC,EAAgC;AAC9D,eAAe,mBAAO,CAAC,EAAwB;AAC/C,sBAAsB,mBAAO,CAAC,EAAgC;;AAE9D,qBAAqB,oBAAoB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK,YAAY,eAAe;AAChC;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC/BA,gBAAgB,mBAAO,CAAC,EAAyB;;AAEjD;AACA;;AAEA;AACA;AACA,4DAA4D;AAC5D;AACA;AACA;AACA;;;;;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACTA,sBAAsB,mBAAO,CAAC,EAAgC;;AAE9D;AACA;;AAEA;;AAEA;;;;;;;ACPA,8BAA8B;;;;;;;ACA9B;AACA;AACA;AACA,GAAG;AACH;;;;;;;ACJA,iBAAiB,mBAAO,CAAC,EAA2B;;AAEpD;;;;;;;;ACFa;AACb,gBAAgB,mBAAO,CAAC,EAAyB;;AAEjD;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;ACjBA,aAAa,mBAAO,CAAC,CAAqB;AAC1C,gBAAgB,mBAAO,CAAC,EAAgC;;AAExD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;ACnBA;;;;;;;;;;;;;;;;;AAKA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AAIA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA,IAAI,SAAS,GAAG,CAAhB;;AAEA;AAAA;A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AAsB,mBAAO,CAAC,EAAgC;;AAE9D;;AAEA;AACA;AACA;AACA;AACA;;;;;;;ACVA,eAAe,mBAAO,CAAC,EAAwB;;AAE/C;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;;;;;;ACZA,sBAAsB,mBAAO,CAAC,EAAgC;;AAE9D;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAc;AACd,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,SAAS,EAAE;AACzD,CAAC,gBAAgB;;AAEjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA,GAAG,gBAAgB;AACnB;AACA;;;;;;;ACrCA,eAAe,mBAAO,CAAC,EAAwB;AAC/C,gBAAgB,mBAAO,CAAC,EAAyB;AACjD,sBAAsB,mBAAO,CAAC,EAAgC;;AAE9D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACZA,aAAa,mBAAO,CAAC,CAAqB;AAC1C,YAAY,mBAAO,CAAC,EAAoB;AACxC,cAAc,mBAAO,CAAC,EAA0B;AAChD,WAAW,mBAAO,CAAC,EAAoC;AACvD,WAAW,mBAAO,CAAC,GAAmB;AACtC,oBAAoB,mBAAO,CAAC,EAAsC;AAClE,aAAa,mBAAO,CAAC,GAA4B;;AAEjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;AC1GA,gBAAgB,mBAAO,CAAC,EAAgC;;AAExD;;;;;;;ACFA,eAAe,mBAAO,CAAC,EAAwB;AAC/C,eAAe,mBAAO,CAAC,EAAwB;AAC/C,2BAA2B,mBAAO,CAAC,EAAqC;;AAExE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACXA;AACA;AACA,YAAY;AACZ,GAAG;AACH,YAAY;AACZ;AACA;;;;;;;ACNA,iBAAiB,mBAAO,CAAC,GAAyB,E;;;;;;;ACArC;AACb,QAAQ,mBAAO,CAAC,CAAU;AAC1B,aAAa,mBAAO,CAAC,CAAqB;AAC1C,6BAA6B,mBAAO,CAAC,GAAgC;AACrE,YAAY,mBAAO,CAAC,EAAoB;AACxC,kCAAkC,mBAAO,CAAC,EAA6C;AACvF,cAAc,mBAAO,CAAC,EAAsB;AAC5C,iBAAiB,mBAAO,CAAC,EAA0B;AACnD,eAAe,mBAAO,CAAC,EAAwB;AAC/C,qBAAqB,mBAAO,CAAC,EAAgC;AAC7D,qBAAqB,mBAAO,CAAC,EAAqC;AAClE,cAAc,mBAAO,CAAC,EAA8B;AACpD,kBAAkB,mBAAO,CAAC,EAA0B;AACpD,0BAA0B,mBAAO,CAAC,EAA6B;;AAE/D;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mEAAmE,0CAA0C,EAAE;AAC/G;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;;AAEL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;;AAEA;AACA,KAAK,6BAA6B;;AAElC;;AAEA;AACA;;;;;;;ACxEA,iBAAiB,mBAAO,CAAC,EAA0B;AACnD,eAAe,mBAAO,CAAC,EAAwB;AAC/C,UAAU,mBAAO,CAAC,EAAkB;AACpC,qBAAqB,mBAAO,CAAC,EAAqC;AAClE,UAAU,mBAAO,CAAC,EAAkB;AACpC,eAAe,mBAAO,CAAC,GAAuB;;AAE9C;AACA;;AAEA;AACA;AACA;;AAEA;AACA,gCAAgC;AAChC;AACA,gBAAgB;AAChB,GAAG,EAAE;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC5Da;AACb,qBAAqB,mBAAO,CAAC,EAAqC;AAClE,aAAa,mBAAO,CAAC,EAA4B;AACjD,kBAAkB,mBAAO,CAAC,GAA2B;AACrD,WAAW,mBAAO,CAAC,EAAoC;AACvD,iBAAiB,mBAAO,CAAC,EAA0B;AACnD,cAAc,mBAAO,CAAC,EAAsB;AAC5C,qBAAqB,mBAAO,CAAC,EAA8B;AAC3D,iBAAiB,mBAAO,CAAC,GAA0B;AACnD,kBAAkB,mBAAO,CAAC,EAA0B;AACpD,cAAc,mBAAO,CAAC,GAAgC;AACtD,0BAA0B,mBAAO,CAAC,EAA6B;;AAE/D;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;;AAEL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,OAAO;AACtC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AAC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Aa;;AAE3C;AACA;AACA,6DAA6D,0CAA0C;AACvG;AACA;AACA;AACA;;;;;;;ACfA,YAAY,mBAAO,CAAC,EAAoB;;AAExC;AACA,gBAAgB;AAChB;AACA;AACA,CAAC;;;;;;;ACND,kBAAkB,mBAAO,CAAC,EAA0B;AACpD,2BAA2B,mBAAO,CAAC,EAAqC;AACxE,eAAe,mBAAO,CAAC,EAAwB;AAC/C,iBAAiB,mBAAO,CAAC,EAA0B;;AAEnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACfa;AACb,4BAA4B,mBAAO,CAAC,EAAoC;AACxE,cAAc,mBAAO,CAAC,EAAsB;;AAE5C;AACA;AACA,2CAA2C;AAC3C;AACA;;;;;;;ACRA,eAAe,mBAAO,CAAC,EAAwB;AAC/C,yBAAyB,mBAAO,CAAC,GAAmC;;AAEpE;AACA;AACA;AACA;AACA,4DAA4D;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,gBAAgB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;ACvBD,eAAe,mBAAO,CAAC,EAAwB;;AAE/C;AACA;AACA;AACA,GAAG;AACH;;;;;;;;ACNa;AACb,sBAAsB,mBAAO,CAAC,EAAgC;AAC9D,uBAAuB,mBAAO,CAAC,EAAiC;AAChE,gBAAgB,mBAAO,CAAC,EAAwB;AAChD,0BAA0B,mBAAO,CAAC,EAA6B;AAC/D,qBAAqB,mBAAO,CAAC,EAA8B;;AAE3D;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA,8BAA8B;AAC9B,gCAAgC;AAChC,UAAU;AACV,CAAC;;AAED;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AClCa;AACb,QAAQ,mBAAO,CAAC,CAAqB;AACrC,cAAc,mBAAO,CAAC,EAAsB;AAC5C,aAAa,mBAAO,CAAC,CAAqB;AAC1C,iBAAiB,mBAAO,CAAC,EAA2B;AACpD,oBAAoB,mBAAO,CAAC,GAAyC;AACrE,eAAe,mBAAO,CAAC,EAAuB;AAC9C,kBAAkB,mBAAO,CAAC,GAA2B;AACrD,qBAAqB,mBAAO,CAAC,EAAgC;AAC7D,iBAAiB,mBAAO,CAAC,GAA0B;AACnD,eAAe,mBAAO,CAAC,EAAwB;AAC/C,gBAAgB,mBAAO,CAAC,EAAyB;AACjD,iBAAiB,mBAAO,CAAC,EAA0B;AACnD,cAAc,mBAAO,CAAC,EAA0B;AAChD,oBAAoB,mBAAO,CAAC,GAA6B;AACzD,cAAc,mBAAO,CAAC,EAAsB;AAC5C,kCAAkC,mBAAO,CAAC,GAA6C;AACvF,yBAAyB,mBAAO,CAAC,GAAkC;AACnE,WAAW,mBAAO,CAAC,GAAmB;AACtC,gBAAgB,mBAAO,CAAC,GAAwB;AAChD,qBAAqB,mBAAO,CAAC,GAA8B;AAC3D,uBAAuB,mBAAO,CAAC,GAAiC;AAChE,iCAAiC,mBAAO,CAAC,EAAqC;AAC9E,cAAc,mBAAO,CAAC,GAAsB;AAC5C,0BAA0B,mBAAO,CAAC,EAA6B;AAC/D,eAAe,mBAAO,CAAC,GAAwB;AAC/C,sBAAsB,mBAAO,CAAC,EAAgC;AAC9D,iBAAiB,mBAAO,CAAC,EAAgC;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,cAAc,eAAe,cAAc;AACjE;AACA;AACA;AACA,qCAAqC,cAAc;AACnD,CAAC;;AAED;AACA,yDAAyD,cAAc;AACvE,CAAC;;AAED;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,eAAe;AAClB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH,6BAA6B,cAAc;AAC3C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK,GAAG,eAAe;;AAEvB;AACA,wCAAwC,+CAA+C;AACvF;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA,GAAG,2CAA2C;AAC9C;AACA,CAAC;;AAED;AACA;;AAEA;;AAEA;AACA,GAAG,8CAA8C;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED,GAAG,yDAAyD;AAC5D;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED,GAAG,2DAA2D;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,CAAC;;;;;;;AC1XD,aAAa,mBAAO,CAAC,CAAqB;AAC1C,+BAA+B,mBAAO,CAAC,EAAiD;AACxF,cAAc,mBAAO,CAAC,EAA0B;AAChD,gBAAgB,mBAAO,CAAC,GAAmB;AAC3C,aAAa,mBAAO,CAAC,GAA4B;;AAEjD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,+CAA+C,sBAAsB;AACrE;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA,GAAG;AACH;;;;;;;AC7EA,aAAa,mBAAO,CAAC,CAAqB;;AAE1C;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACPa;AACb,QAAQ,mBAAO,CAAC,CAAqB;AACrC,gBAAgB,mBAAO,CAAC,EAAyB;AACjD,iCAAiC,mBAAO,CAAC,EAAqC;AAC9E,cAA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,yCAAyC,WAAW,IAAI;AAC9E,GAAG;AACH,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA,CAAC;AACD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yFAAyF;AACzF;AACA,KAAK;AACL;AACA,mDAAmD,iDAAiD;AACpG,KAAK;AACL,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8EAA8E,kCAAkC;AAChH;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,gFAAgF,eAAe;AAC/F;AACA;AACA;;AAEA,GAAG,yEAAyE;AAC5E;AACA,CAAC;;AAED;AACA;AACA,CAAC;;AAED,GAAG,qDAAqD;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,0BAA0B,mBAAmB,EAAE;AAC/C,0BAA0B,oBAAoB;AAC9C,CAAC;;AAED,GAAG,2EAA2E;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED,GAAG,uDAAuD;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA,GAAG,0DAA0D,kCAAkC,EAAE,GAAG;AACpG;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,YAAY,QAAQ;AACzC;AACA,0CAA0C;AAC1C,GAAG;;AAEH,KAAK,4DAA4D;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0EAA0E;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;ACtTA,sBAAsB,mBAAO,CAAC,EAAgC;AAC9D,gCAAgC,mBAAO,CAAC,GAA4C;;AAEpF,iBAAiB;;AAEjB;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACrBA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA;;;;;;;ACAA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;;;;;;;ACHA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA,qBAAqB,mBAAO,CAAC,EAAgC;;AAE7D;AACA;AACA;;;;;;;ACJA,aAAa,mBAAO,CAAC,CAAqB;AAC1C,qBAAqB,mBAAO,CAAC,EAAgC;;AAE7D;AACA;AACA;;;;;;;ACLA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;AACA;AACA;;;;;;;ACJA;AACA,4BAA4B,mBAAO,CAAC,EAAuC;;AAE3E;;;;;;;ACHA,iBAAiB,mBAAO,CAAC,GAA+B,E;;;;;;ACAxD,aAAa,mBAAO,CAAC,GAAiB;;AAEtC;;;;;;;ACFA,mBAAO,CAAC,GAAyB;AACjC,WAAW,mBAAO,CAAC,CAAmB;;AAEtC;;;;;;;ACHA,QAAQ,mBAAO,CAAC,CAAqB;AACrC,6BAA6B,mBAAO,CAAC,GAA+B;;AAEpE;AACA;AACA,GAAG,2DAA2D;AAC9D;AACA,CAAC;;;;;;;ACPD,aAAa,mBAAO,CAAC,CAAqB;AAC1C,WAAW,mBAAO,CAAC,EAA0B;AAC7C,kBAAkB,mBAAO,CAAC,EAA0B;;AAEpD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;ACbD,aAAa,mBAAO,CAAC,GAAyB;;AAE9C;;;;;;;ACFA,YAAY,mBAAO,CAAC,GAAwB;;AAE5C;;AAEA;AACA;AACA;AACA;;;;;;;ACPA,mBAAO,CAAC,GAAiC;AACzC,mBAAmB,mBAAO,CAAC,EAAkC;;AAE7D;;;;;;;;ACHa;AACb,QAAQ,mBAAO,CAAC,CAAqB;AACrC,eAAe,mBAAO,CAAC,EAAwB;AAC/C,cAAc,mBAAO,CAAC,EAAuB;AAC7C,sBAAsB,mBAAO,CAAC,EAAgC;AAC9D,eAAe,mBAAO,CAAC,EAAwB;AAC/C,sBAAsB,mBAAO,CAAC,EAAgC;AAC9D,qBAAqB,mBAAO,CAAC,EAA8B;AAC3D,sBAAsB,mBAAO,CAAC,EAAgC;AAC9D,mCAAmC,mBAAO,CAAC,EAA+C;AAC1F,8BAA8B,mBAAO,CAAC,EAA0C;;AAEhF;AACA,uDAAuD,8BAA8B;;AAErF;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG,gFAAgF;AACnF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAAS;AACxB;AACA;AACA;AACA,CAAC;;;;;;;AChDD,mBAAO,CAAC,GAAuB;AAC/B,WAAW,mBAAO,CAAC,CAAmB;;AAEtC;;;;;;;ACHA,QAAQ,mBAAO,CAAC,CAAqB;AACrC,aAAa,mBAAO,CAAC,CAAqB;AAC1C,gBAAgB,mBAAO,CAAC,EAAgC;;AAExD;AACA,sCAAsC;;AAEtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA,GAAG,yCAAyC;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;AC3BD;;;;;;;;;;;;;;;;;AAKA;;AAOA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA,gE,CAqGA;;;AACA,IAAM,aAAa,GAAG,wBAClB,EADkB,EAElB,kBAFkB,EAGlB,mBAHkB,EAIlB,kBAJkB,EAKlB,gBALkB,EAMlB,kBANkB,EAOlB,kBAPkB,EAQlB,iBARkB,EASlB,iBATkB,EAUlB,oBAVkB,EAWlB,kBAXkB,EAYlB;AACA;AACI,WAAS,EAAE,mBAAU,IAAV,EAAwB,IAAxB,EAAoC;AAC3C,WAAO,IAAP;AACH;AAHL,CAbkB,CAAtB;AAoBA,qBAAe,aAAf,C;;;;;;AC9IA,aAAa,mBAAO,CAAC,GAAwB;;AAE7C;;;;;;;ACFA,mBAAO,CAAC,GAAgC;AACxC,WAAW,mBAAO,CAAC,CAAsB;;AAEzC;;;;;;;ACHA,QAAQ,mBAAO,CAAC,CAAqB;AACrC,aAAa,mBAAO,CAAC,GAA4B;;AAEjD;AACA;AACA,GAAG,iEAAiE;AACpE;AACA,CAAC;;;;;;;;ACPY;AACb,kBAAkB,mBAAO,CAAC,EAA0B;AACpD,YAAY,mBAAO,CAAC,EAAoB;AACxC,iBAAiB,mBAAO,CAAC,EAA0B;AACnD,kCAAkC,mBAAO,CAAC,GAA8C;AACxF,iCAAiC,mBAAO,CAAC,EAA4C;AACrF,eAAe,mBAAO,CAAC,EAAwB;AAC/C,oBAAoB,mBAAO,CAAC,EAA6B;;AAEzD;AACA;;AAEA;AACA;AACA;AACA;AACA,mCAAmC,OAAO,gCAAgC;AAC1E;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,GAAG,IAAI,OAAO;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,cAAc,EAAE;AAC7D,wBAAwB,+CAA+C;AACvE,CAAC,qCAAqC;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,CAAC;;;;;;;;;ACnDD;;;;;;;;;;;;AA4CA;;AACA,qBAAe;AACX,OAAK,EAAE,CACH,MADG,EAEH,MAFG,EAGH,UAHG,EAIH;AACA,YALG,EAMH,QANG,EAOH,WAPG,EAQH,eARG,EASH,QATG,EAUH,YAVG,EAWH,WAXG,EAYH,WAZG,EAaH,MAbG,EAcH,MAdG,EAeH,MAfG,EAgBH,SAhBG,EAiBH,OAjBG,EAkBH,UAlBG,EAmBH,OAnBG,EAoBH,OApBG,EAqBH,OArBG,EAsBH,MAtBG,EAuBH,WAvBG,EAwBH,MAxBG,EAyBH,MAzBG,CADI;AA6BX,WAAS,EAAE,CACP,IADO,EAEP,IAFO,EAGP,IAHO,EAIP,KAJO,EAKP,MALO,EAMP,MANO,EAOP,IAPO,EAQP,MARO,EASP,OATO,EAUP,QAVO,EAWP,SAXO,EAYP,iBAZO,EAaP,aAbO,CA7BA;AA4CX;AAEA,WAAS,EAAE;AACP,eAAW;AACP,UAAI,EAAE,MADC;AAEP,WAAK,EAAE;AAFA,KADJ;AAKP,SAAK,EAAE;AACH,UAAI,EAAE,MADH;AAEH,WAAK,EAAE;AAFJ,KALA;AASP,UAAM,EAAE;AACJ,UAAI,EAAE,MADF;AAEJ,WAAK,EAAE;AAFH,KATD;AAaP,SAAK,EAAE;AACH,UAAI,EAAE,MADH;AAEH,WAAK,EAAE;AAFJ,KAbA;AAiBP,eAAW;AACP,UAAI,EAAE,MADC;AAEP,WAAK,EAAE;AAFA,KAjBJ;AAqBP,gBAAY;AACR,UAAI,EAAE,MADE;AAER,WAAK,EAAE;AAFC,KArBL;AAyBP,iBAAa;AACT,UAAI,EAAE,MADG;AAET,WAAK,EAAE;AAFE;AAzBN,GA9CA;AA6EX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,QAAM,EAAE,CACJ,SADI,EAEJ,SAFI,EAGJ,SAHI,EAIJ,SAJI,EAKJ,SALI,EAMJ,SANI,EAOJ,SAPI,EAQJ,SARI,EASJ,SATI,EAUJ,SAVI,CAxFG;AAqGX;AACA,cAAY,EAAE,CACV,MADU,EAEV,GAFU,EAGV,IAHU,EAIV,KAJU,EAKV,KALU,EAMV,MANU,EAOV,YAPU,EAQV,MARU,EASV,YATU,EAUV,YAVU,EAWV,MAXU,EAYV,KAZU,EAaV,KAbU,EAcV,IAdU,EAeV,QAfU,EAgBV,KAhBU,EAiBV,UAjBU,EAkBV,KAlBU,EAmBV,QAnBU,EAoBV,eApBU,EAqBV,MArBU,CAtGH;AA8HX,aAAW,EAAE,MA9HF;;AA+HX;;;;;AAKA,UAAQ,EAAE,CACN;AACI;AACA,SAAK,EAAE,IAFX;AAGI;AACA,QAAI,EAAE,OAJV;AAKI;AACA,WAAO,EAAE,yLAAyL,KAAzL,CACL,IADK;AANb,GADM,EAWN;AACI;AACA,SAAK,EAAE,IAFX;AAGI;AACA,QAAI,EAAE,OAJV;AAKI;AACA,WAAO,EAAE,uFAAuF,KAAvF,CACL,IADK;AANb,GAXM,CApIC;AA2JX,aAAW,EAAE,CAAC,GAAD,EAAM,MAAN,EAAc,KAAd,EAAqB,GAArB,EAA0B,KAA1B,EAAiC,GAAjC,CA3JF;AA6JX,WAAS,EAAE,EA7JA;AA+JX,aAAW,EAAE,KA/JF;AAiKX,kBAAgB,EAAE,IAjKP;AAmKX;AACA,qBAAmB,EAAE;AApKV,CAAf,C;;;;;;;;AC7CA;;;;;;;;;;;;;AAKA;AAQA;;;;;;;;AAMA,SAAS,WAAT,CAAqB,SAArB,EAAwC,SAAxC,EAA2D,SAA3D,EAA6E;AACzE,QAAM,CAAC,KAAP,CAAa,SAAb;;AACA,MAAI,SAAJ,EAAe;AACX,WAAO,CAAC,KAAR,CAAc,iBAAiB,SAA/B;AACH;AACJ;;AAED,qBAAe;AACX,iBAAe,EAAE,GADN;AAGX,UAAQ,EAAE,IAHC;AAIX,SAAO,EAAE,gBAJE;AAKX,QAAM,EAAE,gBALG;AAOX,iBAAe,EAAE,IAPN;AAQX,aAAW;AARA,CAAf,C;;;;;;;;AC1BA;;;;;;;;;;;;AAKA,qBAAe;AACX;AACA,kBAAgB,EAAE,IAFP;AAIX;AACA,gBAAc,EAAE,KALL;AAOX;AACA;AACA,iBAAe,EAAE,yBAAU,OAAV,EAAyB;AACtC;AACA,WAAO,OAAP;AACH;AAZU,CAAf,C;;;;;;;;ACLA;;;;;;;;;;;;AAKA,qBAAe;AACX,cAAY,EAAE;AADH,CAAf,C;;;;;;;;ACLA;;;;;;;;;;;;;AAMA;;AAoBA,qBAAe;AACX;AACA,cAAY,EAAE,sBAAU,GAAV,EAAuB,GAAvB,EAAqC,IAArC,EAAkD;AAC5D,WAAO,IAAP;AACH,GAJU;AAKX;AACA,aAAW,EAAE,IANF;AAQX;AACA,gBAAc,EAAE,IATL;AAWX;AACA,iBAAe,EAAE,IAZN;AAcX;AACA,iBAAe,EAAE,gBAfN;AAiBX;AACA,iBAAe,EAAE,CAAC,KAAD,EAAQ,MAAR,EAAgB,KAAhB,EAAuB,KAAvB,EAA8B,KAA9B,CAlBN;AAoBX;AACA,iBAAe,EAAE,EArBN;AAuBX;AACA,qBAAmB,EAAE,KAxBV;AA0BX;AACA,kBAAgB,EAAE,IAAI,IAAJ,GAAW,IA3BlB;AA6BX;AACA,oBAAkB,EAAE,GA9BT;AAgCX;AACA,gBAAc,EAAE,EAjCL;AAmCX;AACA,iBAAe,EAAE,EApCN;AAsCX;AACA,wBAAsB,EAAE,KAvCb;AAyCX;AACA,kBAAgB,EAAE,EA1CP;AA4CX;AACA,gBAAc,EAAE,EA7CL;AA+CX;AACA,kBAAgB,EAAE,KAAK,IAhDZ;AAkDX;AACA,iBAAe,EAAE,KAnDN;AAqDX;AACA,iBAAe,EAAE,IAtDN;AAwDX;AACA,oBAAkB,EAAE;AAzDT,CAAf,C;;;;;;;;;;;;;;;;AC1BA,qBAAe;AACX,MAAI,EAAE,OADK;AAEX,WAAS,EAAE;AACP,aAAS;AACL,gBAAU,EAAE;AACR,UAAE,EAAE,IADI;AAER,UAAE,EAAE,IAFI;AAGR,UAAE,EAAE,IAHI;AAIR,UAAE,EAAE,IAJI;AAKR,UAAE,EAAE,IALI;AAMR,SAAC,EAAE,GANK;AAOR,aAAK,EAAE,OAPC;AAQR,aAAK,EAAE;AACH,eAAK,EAAE;AACH,cAAE,EAAE,IADD;AAEH,cAAE,EAAE,IAFD;AAGH,cAAE,EAAE,IAHD;AAIH,cAAE,EAAE,IAJD;AAKH,cAAE,EAAE,IALD;AAMH,eAAG,EAAE,KANF;AAOH,eAAG,EAAE,KAPF;AAQH,cAAE,EAAE,IARD;AASH,cAAE,EAAE,IATD;AAUH,gBAAI,EAAE,MAVH;AAWH,eAAG,EAAE,KAXF;AAYH,cAAE,EAAE,IAZD;AAaH,cAAE,EAAE,IAbD;AAcH,cAAE,EAAE,IAdD;AAeH,cAAE,EAAE,IAfD;AAgBH,cAAE,EAAE,IAhBD;AAiBH,cAAE,EAAE,IAjBD;AAkBH,cAAE,EAAE,IAlBD;AAmBH,cAAE,EAAE,IAnBD;AAoBH,cAAE,EAAE,IApBD;AAqBH,eAAG,EAAE,KArBF;AAsBH,cAAE,EAAE,IAtBD;AAuBH,cAAE,EAAE,IAvBD;AAwBH,cAAE,EAAE,IAxBD;AAyBH,gBAAI,EAAE,MAzBH;AA0BH,gBAAI,EAAE;AA1BH,WADJ;AA6BH,sBAAY,EAAE;AACV,gBAAI,EAAE,MADI;AAEV,gBAAI,EAAE,MAFI;AAGV,gBAAI,EAAE,MAHI;AAIV,gBAAI,EAAE,MAJI;AAKV,gBAAI,EAAE,MALI;AAMV,gBAAI,EAAE,MANI;AAOV,gBAAI,EAAE,MAPI;AAQV,gBAAI,EAAE,MARI;AASV,cAAE,EAAE,IATM;AAUV,gBAAI,EAAE;AACF,gBAAE,EAAE;AADF,aAVI;AAaV,kBAAM,EAAE;AACJ,kBAAI,EAAE,MADF;AAEJ,kBAAI,EAAE;AAFF,aAbE;AAiBV,mBAAO,EAAE;AACL,gBAAE,EAAE,IADC;AAEL,gBAAE,EAAE,IAFC;AAGL,gBAAE,EAAE,IAHC;AAIL,gBAAE,EAAE;AAJC,aAjBC;AAuBV,gBAAI,EAAE;AACF,kBAAI,EAAE,MADJ;AAEF,kBAAI,EAAE;AAFJ;AAvBI,WA7BX;AAyDH,oBAAU,EAAE;AACR,oBAAQ,EAAE;AACN,gBAAE,EAAE,IADE;AAEN,gBAAE,EAAE,IAFE;AAGN,mBAAK,EAAE,OAHD;AAIN,gBAAE,EAAE;AAJE,aADF;AAOR,iBAAK,EAAE;AACH,kBAAI,EAAE,MADH;AAEH,kBAAI,EAAE,MAFH;AAGH,kBAAI,EAAE,MAHH;AAIH,oBAAM,EAAE,QAJL;AAKH,kBAAI,EAAE;AALH,aAPC;AAcR,gBAAI,EAAE;AACF,gBAAE,EAAE,IADF;AAEF,kBAAI,EAAE,MAFJ;AAGF,kBAAI,EAAE,MAHJ;AAIF,kBAAI,EAAE;AAJJ,aAdE;AAoBR,iBAAK,EAAE;AACH,kBAAI,EAAE,MADH;AAEH,kBAAI,EAAE;AAFH,aApBC;AAwBR,iBAAK,EAAE;AACH,eAAC,EAAE,GADA;AAEH,eAAC,EAAE,GAFA;AAGH,eAAC,EAAE,GAHA;AAIH,gBAAE,EAAE,IAJD;AAKH,iBAAG,EAAE,KALF;AAMH,iBAAG,EAAE,KANF;AAOH,iBAAG,EAAE,KAPF;AAQH,iBAAG,EAAE,KARF;AASH,kBAAI,EAAE,MATH;AAUH,kBAAI,EAAE,MAVH;AAWH,kBAAI,EAAE,MAXH;AAYH,kBAAI,EAAE;AAZH,aAxBC;AAsCR,gBAAI,EAAE;AACF,kBAAI,EAAE,MADJ;AAEF,kBAAI,EAAE,MAFJ;AAGF,kBAAI,EAAE;AAHJ;AAtCE;AAzDT,SARC;AA8GR,gBAAQ,EAAE;AACN,aAAG,EAAE,KADC;AAEN,YAAE,EAAE,IAFE;AAGN,cAAI,EAAE,MAHA;AAIN,cAAI,EAAE,MAJA;AAKN,cAAI,EAAE,MALA;AAMN,gBAAM,EAAE,QANF;AAON,gBAAM,EAAE,QAPF;AAQN,gBAAM,EAAE,QARF;AASN,gBAAM,EAAE,QATF;AAUN,gBAAM,EAAE,QAVF;AAWN,gBAAM,EAAE,QAXF;AAYN,iBAAO,EAAE,SAZH;AAaN,iBAAO,EAAE,SAbH;AAcN,oBAAU,EAAE,YAdN;AAeN,qBAAW,EAAE,aAfP;AAgBN,sBAAY,EAAE,cAhBR;AAiBN,4BAAkB,EAAE,oBAjBd;AAkBN,gBAAM,EAAE,QAlBF;AAmBN,cAAI,EAAE,MAnBA;AAoBN,cAAI,EAAE,MApBA;AAqBN,iBAAO,EAAE,SArBH;AAsBN,aAAG,EAAE,KAtBC;AAuBN,gBAAM,EAAE,QAvBF;AAwBN,gBAAM,EAAE,QAxBF;AAyBN,gBAAM,EAAE,QAzBF;AA0BN,oBAAU,EAAE;AA1BN;AA9GF;AADP,KADF;AA8IP,MAAE,EAAE;AACA,gBAAU,EAAE;AACR,UAAE,EAAE,OADI;AAER,UAAE,EAAE,QAFI;AAGR,UAAE,EAAE,SAHI;AAIR,UAAE,EAAE,QAJI;AAKR,UAAE,EAAE,MALI;AAMR,SAAC,EAAE,MANK;AAOR,aAAK,EAAE,uBAPC;AAQR,aAAK,EAAE;AACH,eAAK,EAAE;AACH,cAAE,EAAE,MADD;AAEH,cAAE,EAAE,MAFD;AAGH,cAAE,EAAE,WAHD;AAIH,cAAE,EAAE,aAJD;AAKH,cAAE,EAAE,QALD;AAMH,eAAG,EAAE,WANF;AAOH,eAAG,EAAE,eAPF;AAQH,cAAE,EAAE,QARD;AASH,cAAE,EAAE,aATD;AAUH,gBAAI,EAAE,YAVH;AAWH,eAAG,EAAE,YAXF;AAYH,cAAE,EAAE,MAZD;AAaH,cAAE,EAAE,eAbD;AAcH,cAAE,EAAE,OAdD;AAeH,cAAE,EAAE,OAfD;AAgBH,cAAE,EAAE,WAhBD;AAiBH,cAAE,EAAE,OAjBD;AAkBH,cAAE,EAAE,OAlBD;AAmBH,cAAE,EAAE,OAnBD;AAoBH,cAAE,EAAE,MApBD;AAqBH,eAAG,EAAE,YArBF;AAsBH,cAAE,EAAE,MAtBD;AAuBH,cAAE,EAAE,MAvBD;AAwBH,cAAE,EAAE,YAxBD;AAyBH,gBAAI,EAAE,mBAzBH;AA0BH,gBAAI,EAAE;AA1BH,WADJ;AA6BH,sBAAY,EAAE;AACV,gBAAI,EAAE,OADI;AAEV,gBAAI,EAAE,YAFI;AAGV,gBAAI,EAAE,YAHI;AAIV,gBAAI,EAAE,WAJI;AAKV,gBAAI,EAAE,aALI;AAMV,gBAAI,EAAE,QANI;AAOV,gBAAI,EAAE,OAPI;AAQV,gBAAI,EAAE,aARI;AASV,cAAE,EAAE,MATM;AAUV,gBAAI,EAAE;AACF,gBAAE,EAAE;AADF,aAVI;AAaV,kBAAM,EAAE;AACJ,kBAAI,EAAE,QADF;AAEJ,kBAAI,EAAE;AAFF,aAbE;AAiBV,mBAAO,EAAE;AACL,gBAAE,EAAE,MADC;AAEL,gBAAE,EAAE,QAFC;AAGL,gBAAE,EAAE,OAHC;AAIL,gBAAE,EAAE;AAJC,aAjBC;AAuBV,gBAAI,EAAE;AACF,kBAAI,EAAE,WADJ;AAEF,kBAAI,EAAE;AAFJ;AAvBI,WA7BX;AAyDH,oBAAU,EAAE;AACR,oBAAQ,EAAE;AACN,gBAAE,EAAE,OADE;AAEN,gBAAE,EAAE;AAFE,aADF;AAKR,iBAAK,EAAE;AACH,kBAAI,EAAE,cADH;AAEH,kBAAI,EAAE,eAFH;AAGH,kBAAI,EAAE,YAHH;AAIH,oBAAM,EAAE,WAJL;AAKH,kBAAI,EAAE;AALH,aALC;AAYR,gBAAI,EAAE;AACF,gBAAE,EAAE,MADF;AAEF,kBAAI,EAAE,WAFJ;AAGF,kBAAI,EAAE,QAHJ;AAIF,kBAAI,EAAE;AAJJ,aAZE;AAkBR,iBAAK,EAAE;AACH,kBAAI,EAAE,cADH;AAEH,kBAAI,EAAE;AAFH,aAlBC;AAsBR,iBAAK,EAAE;AACH,eAAC,EAAE,MADA;AAEH,eAAC,EAAE,SAFA;AAGH,eAAC,EAAE,GAHA;AAIH,gBAAE,EAAE,OAJD;AAKH,iBAAG,EAAE,YALF;AAMH,iBAAG,EAAE,YANF;AAOH,iBAAG,EAAE,eAPF;AAQH,iBAAG,EAAE,eARF;AASH,kBAAI,EAAE,YATH;AAUH,kBAAI,EAAE,eAVH;AAWH,kBAAI,EAAE,cAXH;AAYH,kBAAI,EAAE;AAZH,aAtBC;AAoCR,gBAAI,EAAE;AACF,kBAAI,EAAE,aADJ;AAEF,kBAAI,EAAE,WAFJ;AAGF,kBAAI,EAAE;AAHJ;AApCE;AAzDT,SARC;AA4GR,gBAAQ,EAAE;AACN,aAAG,EAAE,QADC;AAEN,YAAE,EAAE,cAFE;AAGN,cAAI,EAAE,YAHA;AAIN,cAAI,EAAE,cAJA;AAKN,cAAI,EAAE,gBALA;AAMN,gBAAM,EAAE,sBANF;AAON,gBAAM,EAAE,oBAPF;AAQN,gBAAM,EAAE,qBARF;AASN,gBAAM,EAAE,oBATF;AAUN,gBAAM,EAAE,qBAVF;AAWN,gBAAM,EAAE,sBAXF;AAYN,iBAAO,EAAE,uBAZH;AAaN,iBAAO,EAAE,sBAbH;AAcN,oBAAU,EAAE,mCAdN;AAeN,qBAAW,EAAE,4CAfP;AAgBN,sBAAY,EAAE,oDAhBR;AAiBN,4BAAkB,EACd,uEAlBE;AAmBN,gBAAM,EAAE,oBAnBF;AAoBN,cAAI,EAAE,YApBA;AAqBN,cAAI,EAAE,cArBA;AAsBN,iBAAO,EAAE,uBAtBH;AAuBN,aAAG,EAAE,QAvBC;AAwBN,gBAAM,EAAE,sBAxBF;AAyBN,gBAAM,EAAE,oBAzBF;AA0BN,gBAAM,EAAE,qBA1BF;AA2BN,oBAAU,EAAE;AA3BN;AA5GF;AADZ;AA9IG;AAFA,CAAf,C;;;;;;;;ACAA;;;;;;;;;;;;;AAKA;AAEA;;;;;AAGA,SAAS,cAAT,GAAuB;AACnB,MAAI,UAAG,IAAH,MAAa,UAAG,SAApB,EAA+B;AAC3B,WAAO,IAAP;AACH;;AACD,SAAO,KAAP;AACH;;AAED,qBAAe;AACX,gBAAc,gBADH;AAEX,gBAAc,EAAE;AAFL,CAAf,C;;;;;;;;ACjBA;;;;;;;;;;;;;AAMA;;AAoBA,qBAAe;AACX;AACA,kBAAgB,EAAE,0BAAC,KAAD,EAAc;AAC5B,WAAO,IAAP;AACH,GAJU;AAMX;AACA,qBAAmB,EAAE,gBAPV;AASX;AACA,eAAa,EAAE,IAVJ;AAYX;AACA,mBAAiB,EAAE,CAAC,KAAD,CAbR;AAeX;AACA,mBAAiB,EAAE,EAhBR;AAkBX;AACA,oBAAkB,EAAE,IAAI,IAAJ,GAAW,IAAX,GAAkB,IAnB3B;AAqBX;AACA;AAEA;AACA,iBAAe,EAAE,EAzBN;AA2BX;AACA,mBAAiB,EAAE,EA5BR;AA8BX;AACA,0BAAwB,EAAE,KA/Bf;AAiCX;AACA,oBAAkB,EAAE,EAlCT;AAoCX;AACA,kBAAgB,EAAE,EArCP;AAuCX;AACA,oBAAkB,EAAE,OAAO,EAAP,GAAY,EAAZ,GAAiB,CAxC1B;AA0CX;AACA,sBAAoB,EAAE,KA3CX;AA6CX;AACA,mBAAiB,EAAE,IA9CR;AAgDX;AACA,mBAAiB,EAAE;AAjDR,CAAf,C;;;;;;;;;;;;;;;;;;;;AC1BA;;;;;;AAIA;;AACA;;AAEA;;AAEA;AAAA;AAAA;AAII,6BAAY,MAAZ,EAA0B;AAFlB,yBAA0C,IAA1C;AAGJ,SAAK,MAAL,GAAc,MAAd;AACH;AAED;;;;;AAGO,yCAAP;AACI,WAAO,KAAK,aAAZ;AACH,GAFM;AAIP;;;;;;AAIO,0CAAP,UAAiB,MAAjB,EAA+B;AAC3B,QAAI,MAAJ,EAAY;AACR;AACA,WAAK,aAAL,GAAqB,MAArB;AACA;AACH,KAL0B,CAO3B;;;AACA,QAAM,SAAS,GAAG,MAAM,CAAC,YAAP,EAAlB;;AACA,QAAI,SAAS,CAAC,UAAV,KAAyB,CAA7B,EAAgC;AAC5B;AACH;;AACD,QAAM,KAAK,GAAG,SAAS,CAAC,UAAV,CAAqB,CAArB,CAAd,CAZ2B,CAc3B;;AACA,QAAM,cAAc,GAAG,KAAK,yBAAL,CAA+B,KAA/B,CAAvB;;AACA,QAAI,EAAC,cAAc,SAAd,kBAAc,WAAd,GAAc,MAAd,iBAAc,CAAE,MAAjB,CAAJ,EAA6B;AACzB;AACA;AACH;;AACD,QACI,cAAc,CAAC,IAAf,CAAoB,iBAApB,MAA2C,OAA3C,IACA,cAAc,CAAC,WAAf,CAA2B,yBAA3B,CAFJ,EAGE;AACE;AACA;AACA;AACH;;AAED,QAAM,MAAM,GAAG,KAAK,MAApB;AACA,QAAM,SAAS,GAAG,MAAM,CAAC,SAAzB;;AACA,QAAI,SAAS,CAAC,SAAV,CAAoB,cAApB,CAAJ,EAAyC;AACrC,UAAI,SAAS,CAAC,KAAV,CAAgB,CAAhB,MAAuB,cAAc,CAAC,KAAf,CAAqB,CAArB,CAA3B,EAAoD;AAAA;;AAChD,YAAI,0CAAS,CAAC,IAAV,uBAA4B,eAAhC,EAAyC;AACrC,cAAM,SAAS,GAAG,SAAS,CAAC,QAAV,EAAlB;AACA,cAAM,KAAK,GAAG,SAAS,SAAT,aAAS,WAAT,GAAS,MAAT,YAAS,CAAE,IAAX,EAAd;AACA,gBAAM,CAAC,SAAP,CAAiB,iBAAjB,CAAmC,KAAnC,EAAwD,IAAxD,EAA8D,IAA9D;AACA,gBAAM,CAAC,SAAP,CAAiB,gBAAjB;AACH;AACJ,OARoC,CASrC;;;AACA,WAAK,aAAL,GAAqB,KAArB;AACH;AACJ,GA3CM;AA6CP;;;;;;AAIO,8CAAP,UAAqB,OAArB,EAA6C;AAAxB;AAAA;AAAwB;;AACzC,QAAM,KAAK,GAAG,KAAK,aAAnB;;AACA,QAAI,KAAJ,EAAW;AACP,WAAK,CAAC,QAAN,CAAe,OAAf;AACH;AACJ,GALM;AAOP;;;;;AAGO,iDAAP;AACI,QAAM,KAAK,GAAG,KAAK,aAAnB;;AACA,QAAI,KAAJ,EAAW;AACP,aAAO,KAAK,CAAC,QAAN,EAAP;AACH,KAFD,MAEO;AACH,aAAO,EAAP;AACH;AACJ,GAPM;AASP;;;;;;AAIO,0DAAP,UAAiC,KAAjC,EAA8C;AAC1C,QAAI,CAAJ;AACA,KAAC,GAAG,KAAK,IAAI,KAAK,aAAlB;AACA,QAAI,IAAJ;;AACA,QAAI,CAAJ,EAAO;AACH,UAAI,GAAG,CAAC,CAAC,uBAAT;AACA,aAAO,sBAAE,IAAI,CAAC,QAAL,KAAkB,CAAlB,GAAsB,IAAtB,GAA6B,IAAI,CAAC,UAApC,CAAP;AACH;AACJ,GARM;AAUP;;;;;;AAIO,sDAAP,UAA6B,KAA7B,EAA0C;AACtC,QAAI,CAAJ;AACA,KAAC,GAAG,KAAK,IAAI,KAAK,aAAlB;AACA,QAAI,IAAJ;;AACA,QAAI,CAAJ,EAAO;AACH,UAAI,GAAG,CAAC,CAAC,cAAT;AACA,aAAO,sBAAE,IAAI,CAAC,QAAL,KAAkB,CAAlB,GAAsB,IAAtB,GAA6B,IAAI,CAAC,UAApC,CAAP;AACH;AACJ,GARM;AAUP;;;;;;AAIO,oDAAP,UAA2B,KAA3B,EAAwC;AACpC,QAAI,CAAJ;AACA,KAAC,GAAG,KAAK,IAAI,KAAK,aAAlB;AACA,QAAI,IAAJ;;AACA,QAAI,CAAJ,EAAO;AACH,UAAI,GAAG,CAAC,CAAC,YAAT;AACA,aAAO,sBAAE,IAAI,CAAC,QAAL,KAAkB,CAAlB,GAAsB,IAAtB,GAA6B,IAAI,CAAC,UAApC,CAAP;AACH;AACJ,GARM;AAUP;;;;;AAGO,iDAAP;AACI,QAAM,KAAK,GAAG,KAAK,aAAnB;;AACA,QAAI,KAAK,IAAI,KAAK,CAAC,cAAnB,EAAmC;AAC/B,UAAI,KAAK,CAAC,cAAN,KAAyB,KAAK,CAAC,YAAnC,EAAiD;AAC7C,YAAI,KAAK,CAAC,WAAN,KAAsB,KAAK,CAAC,SAAhC,EAA2C;AACvC,iBAAO,IAAP;AACH;AACJ;AACJ;;AACD,WAAO,KAAP;AACH,GAVM;AAYP;;;;;AAGO,iDAAP;AACI,QAAM,SAAS,GAAG,MAAM,CAAC,YAAP,EAAlB;AACA,QAAM,CAAC,GAAG,KAAK,aAAf;;AACA,QAAI,SAAS,IAAI,CAAjB,EAAoB;AAChB,eAAS,CAAC,eAAV;AACA,eAAS,CAAC,QAAV,CAAmB,CAAnB;AACH;AACJ,GAPM;AASP;;;;;AAGO,iDAAP;AACI,QAAM,MAAM,GAAG,KAAK,MAApB;AACA,QAAM,KAAK,GAAG,KAAK,QAAL,EAAd;AACA,QAAI,KAAJ;;AAEA,QAAI,CAAC,KAAL,EAAY;AACR;AACA;AACH;;AACD,QAAI,CAAC,KAAK,gBAAL,EAAL,EAA8B;AAC1B;AACA;AACH;;AAED,QAAI;AACA;AACA,UAAI,UAAG,QAAH,EAAJ,EAAmB;AACf;AACA,cAAM,CAAC,GAAP,OAAc,YAAd,EAA4B,SAA5B,EAFe,CAGf;;AACA,aAAK,CAAC,MAAN,CAAa,KAAK,CAAC,YAAnB,EAAiC,KAAK,CAAC,SAAN,GAAkB,CAAnD,EAJe,CAKf;;AACA,aAAK,SAAL,CAAe,KAAf;AACH,OAPD,MAOO;AACH,aAAK,GAAG,sBAAE,0BAAF,CAAR;AACA,cAAM,CAAC,GAAP,OAAc,YAAd,EAA4B,KAA5B;AACA,aAAK,iBAAL,CAAuB,KAAvB,EAA8B,IAA9B;AACH;AACJ,KAdD,CAcE,OAAO,EAAP,EAAW,CACT;AACH;AACJ,GA/BM;AAgCP;;;;;;;AAKO,mDAAP,UAA0B,QAA1B,EAA0C,MAA1C,EAAsD;AAClD,QAAI,SAAS,GAAG,MAAM,CAAC,YAAP,GAAsB,MAAM,CAAC,YAAP,EAAtB,GAA8C,QAAQ,CAAC,YAAT,EAA9D,CADkD,CAElD;;AACA,aAAS,SAAT,aAAS,WAAT,GAAS,MAAT,YAAS,CAAE,eAAX;AACA,QAAM,KAAK,GAAG,QAAQ,CAAC,WAAT,EAAd;AACA,SAAK,CAAC,QAAN,CAAe,QAAf,EAAyB,CAAzB,EALkD,CAMlD;;AACA,SAAK,CAAC,MAAN,CAAa,MAAb,EAAqB,MAAM,CAAC,UAAP,CAAkB,MAAlB,IAA4B,CAAjD,EAPkD,CAQlD;;AACA,SAAK,SAAL,CAAe,KAAf,EATkD,CAUlD;;AACA,SAAK,gBAAL;AACH,GAZM;AAaP;;;;;;;;AAMO,kDAAP,UAAyB,KAAzB,EAA4C,OAA5C,EAA+D,SAA/D,EAAkF;AAC9E,QAAI,CAAC,KAAK,CAAC,MAAX,EAAmB;AACf;AACH;;AAED,QAAM,IAAI,GAAG,KAAK,CAAC,KAAN,CAAY,CAAZ,CAAb;AACA,QAAM,KAAK,GAAG,QAAQ,CAAC,WAAT,EAAd;;AAEA,QAAI,SAAJ,EAAe;AACX,WAAK,CAAC,kBAAN,CAAyB,IAAzB;AACH,KAFD,MAEO;AACH;AACA,WAAK,CAAC,UAAN,CAAiB,IAAjB;AACH;;AAED,QAAI,OAAO,IAAI,IAAf,EAAqB;AACjB;AACA,WAAK,CAAC,QAAN,CAAe,OAAf;;AAEA,UAAI,CAAC,OAAL,EAAc;AACV,aAAK,SAAL,CAAe,KAAf;AACA,aAAK,MAAL,CAAY,SAAZ,CAAsB,UAAtB,CAAiC,IAAjC;AACH;AACJ,KAvB6E,CAyB9E;;;AACA,SAAK,SAAL,CAAe,KAAf;AACH,GA3BM;AA6BP;;;;;;AAIO,0DAAP;eAAA,CACI;;;AACA,QAAI,SAAJ;AAEA,QAAM,UAAU,SAAG,KAAK,qBAAL,EAAH,MAA+B,IAA/B,IAA+B,aAA/B,GAA+B,MAA/B,GAA+B,GAAE,UAAF,CAAa,KAAK,MAAlB,CAA/C;AACA,QAAM,QAAQ,SAAG,KAAK,mBAAL,EAAH,MAA6B,IAA7B,IAA6B,aAA7B,GAA6B,MAA7B,GAA6B,GAAE,UAAF,CAAa,KAAK,MAAlB,CAA3C;AAEA,aAAS,GAAG,KAAK,oBAAL,CAA0B,sBAAE,UAAF,CAA1B,EAAyC,sBAAE,QAAF,CAAzC,CAAZ;AAEA,WAAO,SAAP;AACH,GAVM;AAYP;;;;;;;;;AAOO,2CAAP,UAAkB,IAAlB,EAA8B,QAA9B,EAA+C;;;AAC3C,QAAM,KAAK,GAAG,KAAK,QAAL,EAAd,CAD2C,CAE3C;;AACA,QAAI,GAAG,GACH,IAAI,CAAC,QAAL,KAAkB,CAAlB,GAAuB,UAAI,CAAC,SAAL,MAAc,IAAd,IAAc,aAAd,GAAc,MAAd,GAAc,GAAE,MAAvC,GAA2D,IAAI,CAAC,UAAL,CAAgB,MAD/E;;AAEA,QAAI,CAAC,UAAG,SAAH,IAAgB,UAAG,IAAH,EAAjB,KAA+B,GAAG,KAAK,CAA3C,EAA8C;AAC1C;AACA,UAAI,IAAI,CAAC,QAAL,KAAkB,CAAlB,IAAuB,IAAI,CAAC,UAAL,CAAgB,GAAG,GAAG,CAAtB,EAAyB,QAAzB,KAAsC,IAAjE,EAAuE;AACnE,WAAG,GAAG,GAAG,GAAG,CAAZ;AACH;AACJ;;AACD,QAAI,GAAG,GAAW,QAAQ,SAAR,YAAQ,WAAR,cAAY,GAA9B;;AACA,QAAI,CAAC,KAAL,EAAY;AACR;AACH;;AACD,QAAI,IAAJ,EAAU;AACN,WAAK,CAAC,QAAN,CAAe,IAAf,EAAqB,GAArB;AACA,WAAK,CAAC,MAAN,CAAa,IAAb,EAAmB,GAAnB;AACA,WAAK,gBAAL;AACH;AACJ,GApBM;AAsBP;;;;;AAGO,6CAAP;AACI,QAAM,SAAS,GAAG,MAAM,CAAC,YAAP,EAAlB;AAEA,WAAO,SAAS,SAAT,aAAS,WAAT,GAAS,MAAT,YAAS,CAAE,YAAlB;AACH,GAJM;AAMP;;;;;AAGO,0DAAP;AACI,QAAM,SAAS,GAAG,MAAM,CAAC,YAAP,EAAlB;;AACA,QAAI,SAAJ,EAAe;AACX,eAAS,CAAC,eAAV;AACH;AACJ,GALM;AAOP;;;;;;AAIO,qDAAP,UAA4B,KAA5B,EAA+C,QAA/C,EAAmE;AAC/D,QAAI,KAAK,GAAiB,EAA1B;AACA,QAAI,KAAK,GAAG,IAAZ;AACA;;;;;AAIA,QAAI;AACA,UAAI,KAAK,GAAe,KAAxB;AACA,UAAM,SAAS,GAAG,KAAK,MAAL,CAAY,SAA9B,CAFA,CAGA;;AACA,aAAO,KAAP,EAAc;AACV,YAAM,KAAK,GAAG,KAAK,SAAL,SAAK,WAAL,GAAK,MAAL,QAAK,CAAE,UAAP,CAAkB,KAAK,MAAvB,CAAd;AACA,YAAI,KAAK,CAAC,WAAN,OAAwB,MAA5B,EAAoC,KAAK,GAAG,KAAR,CAF1B,CAEwC;;AAClD,YAAI,KAAK,CAAC,MAAN,GAAe,CAAnB,EAAsB;AAClB,eAAK,CAAC,IAAN,CAAW,sBAAE,KAAF,CAAX,EADkB,CAElB;AACA;AACA;;AACA,cAAI,SAAQ,SAAR,YAAQ,WAAR,GAAQ,MAAR,WAAQ,CAAE,KAAV,CAAgB,KAAhB,MAA0B,SAAS,CAAC,KAAV,CAAgB,KAAhB,CAA9B,EAAsD;AAClD,iBAAK,GAAG,KAAR;AACH,WAFD,MAEO;AACH,iBAAK,GAAG,KAAK,CAAC,cAAN,EAAR;AACH;AACJ;AACJ;AACJ,KAnBD,CAmBE,OAAO,CAAP,EAAU;AACR,WAAK,GAAG,KAAR;AACH;;AACD,WAAO,KAAP;AACH,GA9BM;AAgCP;;;;;;;AAKO,+CAAP,UAAsB,IAAtB,EAAgC;AAC5B,QAAM,KAAK,GAAG,KAAK,QAAL,EAAd;AACA,SAAK,SAAL,SAAK,WAAL,GAAK,MAAL,QAAK,CAAE,QAAP,CAAgB,IAAhB,EAAsB,CAAtB;AACA,SAAK,SAAL,SAAK,WAAL,GAAK,MAAL,QAAK,CAAE,MAAP,CAAc,IAAd,EAAoB,CAApB;AACH,GAJM;;AAKX;AAAC,CAlWD;;AAoWA,qBAAe,iBAAf,C;;;;;;;;AC7WA;;;;;;;;;;;;;;;AAKA;;AAGA;AAAA;AAAA;AAGI,mBAAY,MAAZ,EAA0B;AACtB,SAAK,MAAL,GAAc,MAAd;AACH;AAED;;;;;;;AAKO,4BAAP,UAAU,IAAV,EAAwB,KAAxB,EAAmD;AAC/C,QAAM,MAAM,GAAG,KAAK,MAApB;;AAEA,QAAI,MAAM,CAAC,MAAP,CAAc,YAAlB,EAAgC;AAC5B,cAAQ,CAAC,WAAT,CAAqB,cAArB,EAAqC,KAArC,EAA4C,MAA5C;AACH;;AAED,QAAM,SAAS,GAAG,MAAM,CAAC,SAAzB,CAP+C,CAS/C;;AACA,QAAI,CAAC,SAAS,CAAC,QAAV,EAAL,EAA2B;AACvB;AACH,KAZ8C,CAc/C;;;AACA,aAAS,CAAC,gBAAV,GAf+C,CAiB/C;;AACA,YAAQ,IAAR;AACI,WAAK,YAAL;AACI,aAAK,UAAL,CAAgB,KAAhB;AACA;;AACJ,WAAK,YAAL;AACI,aAAK,UAAL,CAAgB,KAAhB;AACA;;AACJ;AACI;AACA,aAAK,WAAL,CAAiB,IAAjB,EAAuB,KAAvB;AACA;AAVR,KAlB+C,CA+B/C;;;AACA,UAAM,CAAC,KAAP,CAAa,YAAb,GAhC+C,CAkC/C;;AACA,aAAS,CAAC,SAAV;AACA,aAAS,CAAC,gBAAV;AACH,GArCM;AAuCP;;;;;;AAIQ,iCAAR,UAAmB,IAAnB,EAA+B;AAC3B,QAAM,MAAM,GAAG,KAAK,MAApB;AACA,QAAM,KAAK,GAAG,MAAM,CAAC,SAAP,CAAiB,QAAjB,EAAd;AACA,QAAI,KAAK,IAAI,IAAb,EAAmB;;AAEnB,QAAI,KAAK,qBAAL,CAA2B,YAA3B,CAAJ,EAA8C;AAC1C;AACA,WAAK,WAAL,CAAiB,YAAjB,EAA+B,IAA/B;AACH,KAHD,MAGO,IAAI,KAAK,CAAC,UAAV,EAAsB;AACzB;AACA,WAAK,CAAC,cAAN;;AACA,UAAI,sBAAE,IAAF,EAAQ,KAAR,CAAc,MAAd,GAAuB,CAA3B,EAA8B;AAC1B,aAAK,CAAC,UAAN,CAAiB,sBAAE,IAAF,EAAQ,KAAR,CAAc,CAAd,CAAjB;AACH,OAFD,MAEO;AACH,YAAI,OAAO,GAAG,QAAQ,CAAC,aAAT,CAAuB,GAAvB,CAAd;AACA,eAAO,CAAC,WAAR,CAAoB,QAAQ,CAAC,cAAT,CAAwB,IAAxB,CAApB;AACA,aAAK,CAAC,UAAN,CAAiB,OAAjB;AACH;;AACD,YAAM,CAAC,SAAP,CAAiB,aAAjB;AACH,KAnB0B,CAoB3B;AACA;AACA;AACA;;AACH,GAxBO;AA0BR;;;;;;AAIQ,iCAAR,UAAmB,KAAnB,EAAoC;AAChC,QAAM,MAAM,GAAG,KAAK,MAApB;AACA,QAAM,KAAK,GAAG,MAAM,CAAC,SAAP,CAAiB,QAAjB,EAAd;AACA,QAAI,KAAK,IAAI,IAAb,EAAmB;;AAEnB,QAAI,KAAK,CAAC,UAAV,EAAsB;AAClB,WAAK,CAAC,cAAN;AACA,WAAK,CAAC,UAAN,CAAiB,KAAK,CAAC,KAAN,CAAY,CAAZ,CAAjB;AACH;AACJ,GATO;AAWR;;;;;;;AAKQ,kCAAR,UAAoB,IAApB,EAAkC,KAAlC,EAA+C;AAC3C,YAAQ,CAAC,WAAT,CAAqB,IAArB,EAA2B,KAA3B,EAAkC,KAAlC;AACH,GAFO;AAIR;;;;;;AAIO,wCAAP,UAAyB,IAAzB,EAAqC;AACjC,WAAO,QAAQ,CAAC,iBAAT,CAA2B,IAA3B,CAAP;AACH,GAFM;AAIP;;;;;;AAIO,wCAAP,UAAyB,IAAzB,EAAqC;AACjC,WAAO,QAAQ,CAAC,iBAAT,CAA2B,IAA3B,CAAP;AACH,GAFM;AAIP;;;;;;AAIO,4CAAP,UAA6B,IAA7B,EAAyC;AACrC,WAAO,QAAQ,CAAC,qBAAT,CAA+B,IAA/B,CAAP;AACH,GAFM;;AAGX;AAAC,CAhID;;AAkIA,qBAAe,OAAf,C;;;;;;;;AC1IA;;;;;;;;;;;;;;;;;;;;;;;;;AAKA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AAoDA;AAAA;AAAA;AAII,gBAAY,MAAZ,EAA0B;AACtB,SAAK,MAAL,GAAc,MAAd;AAEA,SAAK,UAAL,GAAkB;AACd,kBAAY,EAAE,EADA;AAEd,kBAAY,EAAE,EAFA;AAGd,gBAAU,EAAE,EAHE;AAId,iBAAW,EAAE,EAJC;AAKd,mBAAa,EAAE,EALD;AAMd,iBAAW,EAAE,EANC;AAOd,iBAAW,EAAE,EAPC;AAQd,mBAAa,EAAE,EARD;AASd,mBAAa,EAAE,EATD;AAUd,qBAAe,EAAE,EAVH;AAWd,oBAAc,EAAE,EAXF;AAYd,sBAAgB,EAAE,EAZJ;AAad,iBAAW,EAAE,EAbC;AAcd,qBAAe,EAAE,EAdH;AAed,qBAAe,EAAE,EAfH;AAgBd,sBAAgB,EAAE,EAhBJ;AAiBd,wBAAkB,EAAE,EAjBN;AAkBd,oBAAc,EAAE,EAlBF;AAmBd,+BAAyB,EAAE,EAnBb;AAoBd,sBAAgB,EAAE,EApBJ;AAqBd,qBAAe,EAAE,EArBH;AAsBd,6BAAuB,EAAE,EAtBX;AAuBd,qBAAe,EAAE,EAvBH;AAwBd,sBAAgB,EAAE;AAxBJ,KAAlB;AA0BH;AAED;;;;;AAGO,wBAAP;AACI;AACA,SAAK,UAAL,GAFJ,CAII;;;AACA,SAAK,eAAL,GALJ,CAOI;;;AACA,uBAAe,IAAf;AACH,GATM;AAWP;;;;;AAGO,qCAAP;AAAA;;AACI,QAAM,IAAI,GAAG,KAAK,IAAL,EAAb;AACA,QAAM,YAAY,GAAG,sCAAK,MAAL,CAAY,kBAAZ,iBAAoC,cAApC,CAArB;AACA,gBAAY,CAAC,IAAb;AACA,QAAI,KAAK,MAAL,CAAY,WAAhB,EAA6B;AAC7B,QAAI,CAAC,IAAD,IAAS,IAAI,KAAK,GAAtB,EAA2B,YAAY,CAAC,IAAb;AAC9B,GANM;AAQP;;;;;AAGO,yBAAP;AACI,SAAK,IAAL,CAAU,eAAV;AACH,GAFM;AAIP;;;;;;AAIO,wBAAP,UAAY,GAAZ,EAAwB;AACpB,QAAM,MAAM,GAAG,KAAK,MAApB;AACA,QAAM,SAAS,GAAG,MAAM,CAAC,SAAzB,CAFoB,CAIpB;;AACA,QAAI,GAAG,IAAI,IAAX,EAAiB;AACb,UAAI,MAAI,GAAG,SAAS,CAAC,IAAV,EAAX,CADa,CAEb;;AACA,YAAI,GAAG,MAAI,CAAC,OAAL,CAAa,UAAb,EAAyB,EAAzB,CAAP,CAHa,CAIb;;AACA,YAAI,GAAG,MAAI,CAAC,OAAL,CAAa,aAAb,EAA4B,EAA5B,CAAP,CALa,CAMb;;AACA,YAAI,GAAG,MAAI,CAAC,OAAL,CAAa,0BAAb,EAAiC,EAAjC,CAAP,CAPa,CAQb;;AACA,YAAI,GAAG,MAAI,CAAC,OAAL,CAAa,qBAAb,EAA4B,KAA5B,CAAP;AAEA;;;;;;AAMA;AACA;;AAEA;;;;;;AAMA;AAEA;;AACA,UAAM,cAAc,GAA4B,MAAI,CAAC,KAAL,CAAW,4BAAX,CAAhD;;AACA,UAAI,cAAc,KAAK,IAAvB,EAA6B;AACzB,+CAAc,MAAd,eAAc,EAAS,gBAAI;AACvB,cAAI,CAAC,IAAI,CAAC,KAAL,CAAW,KAAX,CAAL,EAAwB;AACpB,kBAAI,GAAG,MAAI,CAAC,OAAL,CAAa,IAAb,EAAmB,IAAI,CAAC,SAAL,CAAe,CAAf,EAAkB,IAAI,CAAC,MAAL,GAAc,CAAhC,IAAqC,IAAxD,CAAP;AACH;AACJ,SAJa,CAAd;AAKH;;AACD,aAAO,MAAP;AACH,KA3CmB,CA6CpB;;;AACA,OAAG,GAAG,yBAAG,MAAH,IAAG,CAAT;;AACA,QAAI,GAAG,KAAK,EAAZ,EAAgB;AACZ,SAAG,GAAG,eAAN;AACH;;AACD,QAAI,4BAAG,MAAH,IAAG,EAAS,GAAT,CAAH,KAAqB,CAAzB,EAA4B;AACxB;AACA,SAAG,GAAG,QAAM,GAAN,GAAS,MAAf;AACH;;AACD,aAAS,CAAC,IAAV,CAAe,GAAf,EAtDoB,CAwDpB;;AACA,UAAM,CAAC,aAAP;AACH,GA1DM;AA4DP;;;;;;AAIO,2BAAP,UAAe,QAAf,EAAqC;AACjC,QAAM,IAAI,GAAG,+BAAkB,QAAlB,EAA4B,QAA5B,EAAb;AACA,QAAM,MAAM,GAAG,KAAK,MAApB;AACA,QAAM,SAAS,GAAG,MAAM,CAAC,SAAzB,CAHiC,CAIjC;;AACA,QAAI,CAAC,IAAL,EAAW,OALsB,CAMjC;;AACA,aAAS,CAAC,eAAV,CAA0B,IAA1B;AACH,GARM;AAUP;;;;;AAGO,2BAAP;AACI,QAAM,MAAM,GAAG,KAAK,MAApB;AACA,QAAM,SAAS,GAAG,MAAM,CAAC,SAAzB;AACA,WAAO,6BAAgB,SAAhB,CAAP;AACH,GAJM;;AAeA,wBAAP,UAAY,GAAZ,EAAwB;AACpB,QAAM,MAAM,GAAG,KAAK,MAApB;AACA,QAAM,SAAS,GAAG,MAAM,CAAC,SAAzB,CAFoB,CAIpB;;AACA,QAAI,GAAG,IAAI,IAAX,EAAiB;AACb,UAAI,IAAI,GAAG,SAAS,CAAC,IAAV,EAAX,CADa,CAEb;;AACA,UAAI,GAAG,IAAI,CAAC,OAAL,CAAa,UAAb,EAAyB,EAAzB,CAAP;AACA,aAAO,IAAP;AACH,KAVmB,CAYpB;;;AACA,aAAS,CAAC,IAAV,CAAe,QAAM,GAAN,GAAS,MAAxB,EAboB,CAepB;;AACA,UAAM,CAAC,aAAP;AACH,GAjBM;AAmBP;;;;;;AAIO,0BAAP,UAAc,IAAd,EAA0B;AACtB,QAAM,MAAM,GAAG,KAAK,MAApB;;AACA,QAAI,6BAAI,MAAJ,KAAI,EAAS,GAAT,CAAJ,KAAsB,CAA1B,EAA6B;AACzB;AACA,UAAI,GAAG,QAAM,IAAN,GAAU,MAAjB;AACH;;AACD,SAAK,IAAL,CAAU,KAAK,IAAL,KAAc,IAAxB,EANsB,CAOtB;;AACA,UAAM,CAAC,aAAP;AACH,GATM;AAWP;;;;;AAGQ,8BAAR;AACI,QAAM,MAAM,GAAG,KAAK,MAApB;AACA,QAAM,SAAS,GAAG,MAAM,CAAC,SAAzB;AACA,QAAM,SAAS,GAAG,sBAAE,QAAF,CAAlB,CAHJ,CAKI;;AACA,aAAS,SAAT,GAAkB;AACd;AACA,YAAM,CAAC,SAAP,CAAiB,SAAjB,GAFc,CAGd;;AACA,YAAM,CAAC,KAAP,CAAa,YAAb;AACH,KAXL,CAaI;;;AACA,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,SAAtB,EAdJ,CAgBI;;AACA,aAAS,kBAAT,GAA2B;AACvB,eAAS;AACT,eAAS,CAAC,GAAV,CAAc,OAAd,EAAuB,kBAAvB;AACH;;AACD,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,kBAAtB;;AAEA,aAAS,aAAT,GAAsB;AAClB;AACA,eAAS;AACT,eAAS,CAAC,GAAV,CAAc,SAAd,EAAyB,aAAzB;AACH;;AACD,aAAS,gBAAT,GAAyB;AACrB;AACA,eAAS,CAAC,EAAV,CAAa,SAAb,EAAwB,aAAxB,EAFqB,CAGrB;;AACA,eAAS,CAAC,GAAV,CAAc,YAAd,EAA4B,gBAA5B;AACH;;AACD,aAAS,CAAC,EAAV,CAAa,WAAb,EAA0B;AACtB;AACA,eAAS,CAAC,EAAV,CAAa,YAAb,EAA2B,gBAA3B;AACH,KAHD;AAKA,aAAS,CAAC,EAAV,CAAa,SAAb,EAAwB,UAAC,CAAD,EAAc;AAClC;AACA,eAAS,CAAC,GAAV,CAAc,YAAd,EAA4B,gBAA5B,EAFkC,CAGlC;;AACA,mCAAW;AACP,YAAM,SAAS,GAAG,MAAM,CAAC,SAAzB;AACA,YAAM,KAAK,GAAG,SAAS,CAAC,QAAV,EAAd;AACA,YAAI,KAAK,KAAK,IAAd,EAAoB;AACpB,iBAAS;AACZ,OALD,EAKG,CALH;AAMH,KAVD;AAWH,GAlDO;AAoDR;;;;;AAGQ,mCAAR;AACI,QAAM,MAAM,GAAG,KAAK,MAApB;AACA,QAAM,SAAS,GAAG,MAAM,CAAC,SAAzB;AACA,QAAM,UAAU,GAAG,KAAK,UAAxB,CAHJ,CAKI;;AACA,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,UAAC,CAAD,EAAS;AAC3B,UAAM,WAAW,GAAG,UAAU,CAAC,WAA/B;AACA,0CAAW,MAAX,YAAW,EAAS,cAAE;AAAI,iBAAE,CAAF,CAAE,CAAF;AAAK,OAApB,CAAX;AACH,KAHD,EANJ,CAWI;;AACA,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,UAAC,CAAD,EAAiB;AACnC,UAAI,CAAC,CAAC,OAAF,KAAc,EAAlB,EAAsB;AACtB,UAAM,aAAa,GAAG,UAAU,CAAC,aAAjC;AACA,4CAAa,MAAb,cAAa,EAAS,cAAE;AAAI,iBAAE,CAAF,CAAE,CAAF;AAAK,OAApB,CAAb;AACH,KAJD,EAZJ,CAkBI;;AACA,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,UAAC,CAAD,EAAiB;AACnC,UAAM,WAAW,GAAG,UAAU,CAAC,WAA/B;AACA,0CAAW,MAAX,YAAW,EAAS,cAAE;AAAI,iBAAE,CAAF,CAAE,CAAF;AAAK,OAApB,CAAX;AACH,KAHD,EAnBJ,CAwBI;;AACA,aAAS,CAAC,EAAV,CAAa,SAAb,EAAwB,UAAC,CAAD,EAAiB;AACrC,UAAM,aAAa,GAAG,UAAU,CAAC,aAAjC;AACA,4CAAa,MAAb,cAAa,EAAS,cAAE;AAAI,iBAAE,CAAF,CAAE,CAAF;AAAK,OAApB,CAAb;AACH,KAHD,EAzBJ,CA8BI;;AACA,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,UAAC,CAAD,EAAiB;AACnC,UAAI,CAAC,CAAC,OAAF,KAAc,CAAd,IAAmB,CAAC,CAAC,OAAF,KAAc,EAArC,EAAyC;AACzC,UAAM,cAAc,GAAG,UAAU,CAAC,cAAlC;AACA,6CAAc,MAAd,eAAc,EAAS,cAAE;AAAI,iBAAE,CAAF,CAAE,CAAF;AAAK,OAApB,CAAd;AACH,KAJD,EA/BJ,CAqCI;;AACA,aAAS,CAAC,EAAV,CAAa,SAAb,EAAwB,UAAC,CAAD,EAAiB;AACrC,UAAI,CAAC,CAAC,OAAF,KAAc,CAAd,IAAmB,CAAC,CAAC,OAAF,KAAc,EAArC,EAAyC;AACzC,UAAM,gBAAgB,GAAG,UAAU,CAAC,gBAApC;AACA,+CAAgB,MAAhB,iBAAgB,EAAS,cAAE;AAAI,iBAAE,CAAF,CAAE,CAAF;AAAK,OAApB,CAAhB;AACH,KAJD,EAtCJ,CA4CI;;AACA,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,UAAC,CAAD,EAAkB;AACpC,UAAI,UAAG,IAAH,EAAJ,EAAe,OADqB,CACd;AAEtB;;AACA,OAAC,CAAC,cAAF;AAEA,UAAM,WAAW,GAAG,UAAU,CAAC,WAA/B;AACA,0CAAW,MAAX,YAAW,EAAS,cAAE;AAAI,iBAAE,CAAF,CAAE,CAAF;AAAK,OAApB,CAAX;AACH,KARD,EA7CJ,CAuDI;;AACA,aAAS,CAAC,EAAV,CAAa,SAAb,EAAwB,UAAC,CAAD,EAAiB;AACrC,WACI;AACA,OAAC,MAAM,CAAC,OAAP,IAAkB,MAAM,CAAC,gBAA1B,MACC,CAAC,CAAC,OAAF,IAAa,CAAC,CAAC,OADhB,KAEA,CAAC,CAAC,OAAF,KAAc,EAJlB,EAKE;AACE;AACA,SAAC,CAAC,cAAF,GAFF,CAGE;;AACA,YAAI,CAAC,CAAC,QAAN,EAAgB;AACZ;AACA,gBAAM,CAAC,OAAP,CAAe,OAAf;AACH,SAHD,MAGO;AACH;AACA,gBAAM,CAAC,OAAP,CAAe,MAAf;AACH;AACJ;AACJ,KAlBD,EAxDJ,CA4EI;;AACA,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,UAAC,CAAD,EAAiB;AACnC,UAAI,CAAC,CAAC,OAAF,KAAc,CAAlB,EAAqB;AACrB,OAAC,CAAC,cAAF;AACA,UAAM,WAAW,GAAG,UAAU,CAAC,WAA/B;AACA,0CAAW,MAAX,YAAW,EAAS,cAAE;AAAI,iBAAE,CAAF,CAAE,CAAF;AAAK,OAApB,CAAX;AACH,KALD,EA7EJ,CAoFI;;AACA,aAAS,CAAC,EAAV,CAAa,SAAb,EAAwB,UAAC,CAAD,EAAiB;AACrC,UAAI,CAAC,CAAC,OAAF,KAAc,CAAlB,EAAqB;AACrB,OAAC,CAAC,cAAF;AACA,UAAM,aAAa,GAAG,UAAU,CAAC,aAAjC;AACA,4CAAa,MAAb,cAAa,EAAS,cAAE;AAAI,iBAAE,CAAF,CAAE,CAAF;AAAK,OAApB,CAAb;AACH,KALD,EArFJ,CA4FI;;AACA,aAAS,CAAC,EAAV,CACI,QADJ,EAEI;AACA,oBAAS,UAAC,CAAD,EAAS;AACd,UAAM,gBAAgB,GAAG,UAAU,CAAC,gBAApC;AACA,+CAAgB,MAAhB,iBAAgB,EAAS,cAAE;AAAI,iBAAE,CAAF,CAAE,CAAF;AAAK,OAApB,CAAhB;AACH,KAHD,EAGG,GAHH,CAHJ,EA7FJ,CAsGI;;AACA,aAAS,cAAT,CAAwB,CAAxB,EAAgC;AAC5B;AACA,OAAC,CAAC,cAAF;AACH;;AAED,0BAAE,QAAF,EACK,EADL,CACQ,WADR,EACqB,cADrB,EAEK,EAFL,CAEQ,MAFR,EAEgB,cAFhB,EAGK,EAHL,CAGQ,WAHR,EAGqB,cAHrB,EAIK,EAJL,CAIQ,UAJR,EAIoB,cAJpB,EA5GJ,CAiHI;;AACA,UAAM,CAAC,aAAP,CAAqB;AACjB,4BAAE,QAAF,EACK,GADL,CACS,WADT,EACsB,cADtB,EAEK,GAFL,CAES,MAFT,EAEiB,cAFjB,EAGK,GAHL,CAGS,WAHT,EAGsB,cAHtB,EAIK,GAJL,CAIS,UAJT,EAIqB,cAJrB;AAKH,KAND;AAQA,aAAS,CAAC,EAAV,CAAa,MAAb,EAAqB,UAAC,CAAD,EAAa;AAC9B,OAAC,CAAC,cAAF;AACA,UAAM,MAAM,GAAG,UAAU,CAAC,UAA1B;AACA,qCAAM,MAAN,OAAM,EAAS,cAAE;AAAI,iBAAE,CAAF,CAAE,CAAF;AAAK,OAApB,CAAN;AACH,KAJD,EA1HJ,CAgII;;AACA,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,UAAC,CAAD,EAAS;AAC3B;AACA,UAAI,KAAK,GAAsB,IAA/B;AAEA,UAAM,MAAM,GAAG,CAAC,CAAC,MAAjB;AACA,UAAM,OAAO,GAAG,sBAAE,MAAF,CAAhB;;AACA,UAAI,OAAO,CAAC,WAAR,OAA0B,GAA9B,EAAmC;AAC/B;AACA,aAAK,GAAG,OAAR;AACH,OAHD,MAGO;AACH;AACA,YAAM,OAAO,GAAG,OAAO,CAAC,WAAR,CAAoB,GAApB,CAAhB;;AACA,YAAI,OAAO,IAAI,IAAf,EAAqB;AACjB;AACA,eAAK,GAAG,OAAR;AACH;AACJ;;AAED,UAAI,CAAC,KAAL,EAAY,OAlBe,CAkBR;;AAEnB,UAAM,eAAe,GAAG,UAAU,CAAC,eAAnC;AACA,8CAAe,MAAf,gBAAe,EAAS,cAAE;AAAI,iBAAE,CAAF,KAAE,CAAF;AAAuB,OAAtC,CAAf;AACH,KAtBD,EAjIJ,CAyJI;;AACA,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,UAAC,CAAD,EAAS;AAC3B;AACA,UAAI,IAAI,GAAsB,IAA9B;AAEA,UAAM,MAAM,GAAG,CAAC,CAAC,MAAjB;AACA,UAAM,OAAO,GAAG,sBAAE,MAAF,CAAhB,CAL2B,CAO3B;;AACA,UAAI,OAAO,CAAC,WAAR,OAA0B,KAA1B,IAAmC,CAAC,OAAO,CAAC,KAAR,CAAc,CAAd,EAAiB,YAAjB,CAA8B,YAA9B,CAAxC,EAAqF;AACjF;AACA,SAAC,CAAC,eAAF;AACA,YAAI,GAAG,OAAP;AACH;;AACD,UAAI,CAAC,IAAL,EAAW,OAbgB,CAaT;;AAElB,UAAM,cAAc,GAAG,UAAU,CAAC,cAAlC;AACA,6CAAc,MAAd,eAAc,EAAS,cAAE;AAAI,iBAAE,CAAF,IAAE,CAAF;AAAsB,OAArC,CAAd;AACH,KAjBD,EA1JJ,CA6KI;;AACA,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,UAAC,CAAD,EAAS;AAC3B;AACA,UAAI,KAAK,GAAsB,IAA/B;AAEA,UAAM,MAAM,GAAG,CAAC,CAAC,MAAjB;AACA,UAAM,OAAO,GAAG,sBAAE,MAAF,CAAhB;;AACA,UAAI,OAAO,CAAC,WAAR,OAA0B,KAA9B,EAAqC;AACjC;AACA,aAAK,GAAG,OAAR;AACH,OAHD,MAGO;AACH;AACA,YAAM,OAAO,GAAG,OAAO,CAAC,WAAR,CAAoB,KAApB,CAAhB;;AACA,YAAI,OAAO,KAAK,IAAhB,EAAsB;AAClB;AACA,eAAK,GAAG,OAAR;AACH;AACJ;;AAED,UAAI,CAAC,KAAL,EAAY;AAEZ,UAAM,eAAe,GAAG,UAAU,CAAC,eAAnC;AACA,8CAAe,MAAf,gBAAe,EAAS,cAAE;AAAI,iBAAE,CAAF,KAAE,CAAF;AAAuB,OAAtC,CAAf;AACH,KAtBD,EA9KJ,CAsMI;;AACA,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,UAAC,CAAD,EAAS;AAC3B;AACA,UAAI,UAAU,GAAsB,IAApC;AAEA,UAAM,MAAM,GAAG,CAAC,CAAC,MAAjB;AACA,UAAM,OAAO,GAAG,sBAAE,MAAF,CAAhB,CAL2B,CAM3B;;AACA,UAAI,OAAO,CAAC,WAAR,OAA0B,IAA9B,EAAoC;AAChC,kBAAU,GAAG,OAAb;AACH,OAFD,MAEO;AACH,eAAO,IAAI,IAAX;AACH;;AAED,UAAI,CAAC,UAAL,EAAiB,OAbU,CAaH;AACxB;;AACA,YAAM,CAAC,SAAP,CAAiB,iBAAjB,CAAmC,UAAnC;AACA,YAAM,CAAC,SAAP,CAAiB,gBAAjB;AACA,UAAM,oBAAoB,GAAG,UAAU,CAAC,eAAxC;AACA,mDAAoB,MAApB,qBAAoB,EAAS,cAAE;AAAI,iBAAE,CAAF,UAAE,CAAF;AAA4B,OAA3C,CAApB;AACH,KAnBD,EAvMJ,CA4NI;;AACA,UAAM,CAAC,YAAP,CAAoB,EAApB,CAAuB,OAAvB,EAAgC,UAAC,CAAD,EAAS;AACrC,UAAM,kBAAkB,GAAG,UAAU,CAAC,kBAAtC;AACA,iDAAkB,MAAlB,mBAAkB,EAAS,cAAE;AAAI,iBAAE,CAAF,CAAE,CAAF;AAAK,OAApB,CAAlB;AACH,KAHD,EA7NJ,CAkOI;;AACA,UAAM,CAAC,kBAAP,CAA0B,EAA1B,CAA6B,WAA7B,EAA0C,UAAC,CAAD,EAAc;AACpD,UAAM,MAAM,GAAG,CAAC,CAAC,MAAjB;AACA,UAAM,OAAO,GAAG,sBAAE,MAAF,CAAhB;;AACA,UAAI,OAAO,CAAC,QAAR,CAAiB,iBAAjB,CAAJ,EAAyC;AACrC;AACA,YAAM,yBAAyB,GAAG,UAAU,CAAC,yBAA7C;AACA,0DAAyB,MAAzB,0BAAyB,EAAS,cAAE;AAAI;AAAI,SAAnB,CAAzB;AACH;AACJ,KARD,EAnOJ,CA6OI;;AACA,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,UAAC,CAAD,EAAc;AAChC;AACA,UAAI,IAAI,GAAsB,IAA9B;AAEA,UAAM,MAAM,GAAG,CAAC,CAAC,MAAjB,CAJgC,CAMhC;;AACA,UAAI,GAAG,sBAAE,MAAF,EAAU,iBAAV,CAA4B,OAA5B,EAAqC,MAArC,EAA6C,MAA7C,CAAP,CAPgC,CAShC;;AACA,UAAI,CAAC,IAAL,EAAW;AAEX,UAAM,gBAAgB,GAAG,UAAU,CAAC,gBAApC;AACA,+CAAgB,MAAhB,iBAAgB,EAAS,cAAE;AAAI,iBAAE,CAAC,IAAD,EAAF,CAAE,CAAF;AAAyB,OAAxC,CAAhB;AACH,KAdD,EA9OJ,CA8PI;;AACA,aAAS,CAAC,EAAV,CAAa,SAAb,EAAwB,UAAC,CAAD,EAAiB;AACrC,UAAI,CAAC,CAAC,OAAF,KAAc,EAAlB,EAAsB;AACtB,UAAM,eAAe,GAAG,UAAU,CAAC,eAAnC;AACA,8CAAe,MAAf,gBAAe,EAAS,cAAE;AAAI,iBAAE,CAAF,CAAE,CAAF;AAAK,OAApB,CAAf;AACH,KAJD,EA/PJ,CAqQI;;AACA,aAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,UAAC,CAAD,EAAS;AAC3B;AACA,UAAI,MAAM,GAAsB,IAAhC;AAEA,UAAM,MAAM,GAAG,CAAC,CAAC,MAAjB;AACA,UAAM,OAAO,GAAG,sBAAE,MAAF,CAAhB,CAL2B,CAO3B;;AACA,UAAI,OAAO,CAAC,WAAR,OAA0B,OAA9B,EAAuC;AACnC;AACA,SAAC,CAAC,eAAF;AACA,cAAM,GAAG,OAAT;AACH;;AAED,UAAI,CAAC,MAAL,EAAa,OAdc,CAcP;;AAEpB,UAAM,gBAAgB,GAAG,UAAU,CAAC,gBAApC;AACA,+CAAgB,MAAhB,iBAAgB,EAAS,cAAE;AAAI,iBAAE,CAAF,MAAE,CAAF;AAAwB,OAAvC,CAAhB;AACH,KAlBD;AAmBH,GAzRO;;AA0RZ;AAAC,CAzhBD;;AA2hBA,qBAAe,IAAf,C;;;;;;AC1lBA,aAAa,mBAAO,CAAC,GAAwB;;AAE7C;;;;;;;ACFA,WAAW,mBAAO,CAAC,GAAuB;;AAE1C;;AAEA;AACA;AACA;AACA;;;;;;;ACPA,mBAAO,CAAC,GAAgC;AACxC,mBAAmB,mBAAO,CAAC,EAAkC;;AAE7D;;;;;;;;ACHa;AACb,QAAQ,mBAAO,CAAC,CAAqB;AACrC,YAAY,mBAAO,CAAC,EAA8B;AAClD,uBAAuB,mBAAO,CAAC,EAAiC;AAChE,8BAA8B,mBAAO,CAAC,EAA0C;;AAEhF;AACA;;AAEA;;AAEA;AACA,4CAA4C,qBAAqB,EAAE;;AAEnE;AACA;AACA,GAAG,uEAAuE;AAC1E;AACA;AACA;AACA,CAAC;;AAED;AACA;;;;;;;;;ACvBA;;;;;;;;;;;;;;;AAMA;;AACA;;AACA;;AACA;;AACA;AAEA;;;;;;AAIA,SAAS,aAAT,CAAuB,IAAvB,EAAiC;AAC7B,MAAM,MAAM,GAAG,IAAI,CAAC,MAApB;AACA,MAAM,UAAU,GAAG,IAAI,CAAC,UAAxB,CAF6B,CAI7B;;AACA,iCAAe,MAAf,EAAuB,UAAU,CAAC,aAAlC,EAAiD,UAAU,CAAC,eAA5D,EAL6B,CAO7B;;AACA,6BAAc,MAAd,EAAsB,UAAU,CAAC,cAAjC,EAAiD,UAAU,CAAC,gBAA5D,EAR6B,CAU7B;;AACA,6BAAW,MAAX,EAAmB,UAAU,CAAC,WAA9B,EAX6B,CAa7B;;AACA,4BAAU,MAAV,EAAkB,UAAU,CAAC,aAA7B,EAd6B,CAgB7B;;AACA,+BAAc,MAAd,EAAsB,UAAU,CAAC,WAAjC,EAjB6B,CAmB7B;;AACA,gCAAe,MAAf,EAAuB,UAAU,CAAC,cAAlC;AACH;;AAED,qBAAe,aAAf,C;;;;;;;;ACvCA;;;;;;;;;;;;;;;;;AAMA;;AACA;AAEA;;;;;;;;AAMA,SAAS,cAAT,CAAwB,MAAxB,EAAwC,aAAxC,EAAmE,eAAnE,EAA8F;AAC1F,WAAS,YAAT,CAAsB,cAAtB,EAAgD;AAAA;;AAC5C,QAAM,EAAE,GAAG,sBAAE,eAAF,CAAX;AACA,MAAE,CAAC,YAAH,CAAgB,cAAhB;;AACA,QAAI,kDAAc,CAAC,IAAf,mBAA8B,MAA9B,KAAyC,CAA7C,EAAgD;AAC5C;AACA,QAAE,CAAC,MAAH;AACA;AACH;;AAED,UAAM,CAAC,SAAP,CAAiB,iBAAjB,CAAmC,EAAnC,EAAuC,IAAvC,EAA6C,IAA7C;AACA,UAAM,CAAC,SAAP,CAAiB,gBAAjB;AACA,kBAAc,CAAC,MAAf;AACH,GAbyF,CAe1F;;;AACA,WAAS,EAAT,GAAW;AACP,QAAM,SAAS,GAAG,MAAM,CAAC,SAAzB;AACA,QAAM,cAAc,GAAG,MAAM,CAAC,SAAP,CAAiB,yBAAjB,EAAvB;AACA,QAAM,WAAW,GAAG,cAAc,CAAC,MAAf,EAApB;;AAEA,QAAI,WAAW,CAAC,IAAZ,OAAuB,mBAA3B,EAAgD;AAC5C;AACA;AACA,kBAAY,CAAC,WAAD,CAAZ;AACA;AACH;;AAED,QACI,cAAc,CAAC,WAAf,OAAiC,MAAjC,IACA,cAAc,CAAC,IAAf,OAA0B,EAD1B,IAEA,cAAc,CAAC,IAAf,CAAoB,MAApB,MAAgC,WAHpC,EAIE;AACE;AACA,kBAAY,CAAC,WAAD,CAAZ;AACA;AACH;;AAED,QAAI,CAAC,WAAW,CAAC,KAAZ,CAAkB,SAAlB,CAAL,EAAmC;AAC/B;AACA;AACH;;AAED,QAAM,QAAQ,GAAG,cAAc,CAAC,WAAf,EAAjB;;AACA,QAAI,QAAQ,KAAK,GAAb,IAAoB,cAAc,CAAC,IAAf,CAAoB,iBAApB,MAA2C,IAAnE,EAAyE;AACrE;AACA;AACH;;AAED,QAAI,cAAc,CAAC,IAAf,EAAJ,EAA2B;AACvB;AACA;AACH,KApCM,CAsCP;;;AACA,gBAAY,CAAC,cAAD,CAAZ;AACH;;AACD,eAAa,CAAC,IAAd,CAAmB,EAAnB,EAzD0F,CA2D1F;;AACA,WAAS,oBAAT,CAA8B,CAA9B,EAAsC;WAAA,CAClC;;;AACA,UAAM,CAAC,SAAP,CAAiB,SAAjB,CAA0B,MAAC,YAAY,EAAb,MAAe,IAAf,IAAe,aAAf,GAAe,MAAf,GAAe,GAAE,UAAF,CAAa,CAAb,CAAzC;AACA,QAAM,WAAW,GAAG,MAAM,CAAC,SAAP,CAAiB,yBAAjB,EAApB;;AACA,QAAI,WAAW,CAAC,EAAZ,KAAmB,MAAM,CAAC,UAA9B,EAA0C;AACtC;AACA;AACA,OAAC,CAAC,cAAF;AACA,YAAM,CAAC,GAAP,OAAc,YAAd,EAA4B,aAA5B;AACH;AACJ;;AACD,iBAAe,CAAC,IAAhB,CAAqB,oBAArB;AACH;;AAED,qBAAe,cAAf,C;;;;;;;;ACzFA;;;;;;;;;;;;;;;;;;;;AAKA;;AAEA;AAEA;;;;;;;;AAMA,SAAS,aAAT,CAAuB,MAAvB,EAAuC,cAAvC,EAAmE,gBAAnE,EAA+F;AAC3F,WAAS,IAAT,GAAa;AACT,QAAM,SAAS,GAAG,MAAM,CAAC,SAAzB;AACA,QAAM,IAAI,GAAG,MAAM,CAAC,SAAP,CAAiB,IAAjB,EAAb;AACA,QAAM,IAAI,GAAG,MAAM,CAAC,SAAP,CAAiB,IAAjB,EAAb;AACA,QAAM,OAAO,GAAG,0BAAI,MAAJ,KAAI,CAApB;AACA;;;;;;AAMA,QAAM,SAAS,GAAa,CAAC,aAAD,EAAgB,MAAhB,EAAwB,4BAAxB,EAAsD,eAAtD,CAA5B,CAXS,CAaT;;AACA,QAAI,QAAQ,IAAR,CAAa,IAAb,MAAuB,CAAC,OAAD,IAAY,mCAAS,MAAT,UAAS,EAAU,OAAV,CAA5C,CAAJ,EAAqE;AACjE;AACA,eAAS,CAAC,IAAV,CAAe,eAAf;AAEA;;;;;AAIA,UAAM,aAAa,GAAG,SAAS,CAAC,OAAV,EAAtB,CARiE,CAUjE;;AACA,YAAM,CAAC,SAAP,CAAiB,kBAAjB,CACI,aAAa,CAAC,UAAd,CAAyB,CAAzB,CADJ,EAEI,aAAa,CAAC,UAAd,CAAyB,CAAzB,CAFJ;AAKA,UAAM,cAAc,GAAG,MAAM,CAAC,SAAP,CAAiB,yBAAjB,EAAvB;AAEA,YAAM,CAAC,SAAP,CAAiB,gBAAjB,GAlBiE,CAoBjE;AACA;;AACA,YAAM,CAAC,SAAP,CAAiB,UAAjB,CAA4B,cAAc,CAAC,OAAf,EAA5B,EAAsD,CAAtD;AACH;AACJ;;AACD,gBAAc,CAAC,IAAf,CAAoB,IAApB;;AAEA,WAAS,MAAT,CAAgB,CAAhB,EAAwB;AAAA;;AACpB,QAAM,SAAS,GAAG,MAAM,CAAC,SAAzB;AACA,QAAM,OAAO,GAAG,0CAAS,CAAC,IAAV,GAAiB,WAAjB,kBAAhB;;AACA,QAAI,OAAO,KAAK,eAAhB,EAAyB;AACrB;AACA,OAAC,CAAC,cAAF;AACA;AACH;AACJ;;AACD,kBAAgB,CAAC,IAAjB,CAAsB,MAAtB;AACH;AAED;;;;;;;AAKA,SAAgB,UAAhB,CAA2B,MAA3B,EAA2C,SAA3C,EAAgE;AAC5D,WAAS,IAAT,CAAc,CAAd,EAA8B;AAAA;;AAC1B,QAAI,CAAC,CAAC,OAAF,KAAc,EAAlB,EAAsB;AAClB;AACH;;AAED,QAAM,SAAS,GAAG,MAAM,CAAC,SAAzB;AACA,QAAM,OAAO,GAAG,2CAAS,CAAC,IAAV,GAAiB,WAAjB,mBAAhB,CAN0B,CAQ1B;;AACA,QAAI,CAAC,OAAD,IAAY,OAAO,KAAK,MAA5B,EAAoC;AAChC;AACA,UAAM,EAAE,GAAG,sBAAE,eAAF,CAAX;AACA,eAAS,CAAC,IAAV,CAAe,GAAf,EAHgC,CAGZ;;AACpB,eAAS,CAAC,MAAV,CAAiB,EAAjB;AACA,YAAM,CAAC,SAAP,CAAiB,iBAAjB,CAAmC,EAAnC,EAAuC,KAAvC,EAA8C,IAA9C;AACA,YAAM,CAAC,SAAP,CAAiB,gBAAjB,GANgC,CAOhC;AACA;;AACA,YAAM,CAAC,SAAP,CAAiB,UAAjB,CAA4B,EAAE,CAAC,OAAH,EAA5B,EAA0C,CAA1C;AACH;AACJ;;AAED,WAAS,CAAC,IAAV,CAAe,IAAf;AACH;;AAxBD;AA0BA,qBAAe,aAAf,C;;;;;;;;ACpGA;;;;;;;;;;;;AAOA;;;;;;AAKA,SAAS,UAAT,CAAoB,MAApB,EAAoC,aAApC,EAA6D;AACzD;AACA,WAAS,EAAT,GAAW;AACP,QAAI,CAAC,MAAM,CAAC,GAAP,CAAW,qBAAX,CAAiC,YAAjC,CAAL,EAAqD;AACjD;AACA;AACH;;AACD,QAAM,cAAc,GAAG,MAAM,CAAC,SAAP,CAAiB,yBAAjB,EAAvB;;AACA,QAAI,CAAC,cAAL,EAAqB;AACjB;AACH;;AACD,QAAM,WAAW,GAAG,cAAc,CAAC,MAAf,EAApB;AACA,QAAM,iBAAiB,GAAG,cAAc,CAAC,WAAf,EAA1B;AACA,QAAM,cAAc,GAAG,WAAW,CAAC,WAAZ,EAAvB;;AAEA,QACI,iBAAiB,IAAI,MAArB,IACA,cAAc,KAAK,MADnB,IAEA,cAAc,KAAK,KAFnB,IAGA,OAAO,IAAP,CAAY,cAAZ,CAJJ,EAKE;AACE;AACA,YAAM,CAAC,GAAP,OAAc,YAAd,EAA4B,MAAM,CAAC,MAAP,CAAc,WAA1C;AACH,KARD,MAQO;AACH;AACA,YAAM,CAAC,GAAP,OAAc,YAAd,EAA4B,0BAA5B;AACH;AACJ,GA3BwD,CA6BzD;;;AACA,eAAa,CAAC,IAAd,CAAmB,EAAnB;AACH;;AAED,qBAAe,UAAf,C;;;;;;;;AC7CA;;;;;;;;;;;;;;;;;AAMA;;AACA;;AACA;AAGA;;;;;;;;;;;;;;;AAaA,SAAS,UAAT,CAAoB,QAApB,EAAoC;AAAA;;AAChC,MAAM,KAAK,GAAG,yCAAQ,CACjB,OADS,CACD,UADC,EACW,KADX,EACkB;AADlB,GAET,OAFS,CAED,YAFC,EAEa,MAFb,iBAAd,CADgC,CAIpB;AAEZ;;AACA,MAAM,aAAa,GAAG,QAAQ,CAAC,aAAT,CAAuB,KAAvB,CAAtB;AAEA,eAAa,CAAC,SAAd,GAA0B,KAA1B;AAEA,SAAO,aAAa,CAAC,SAAd,CAAwB,OAAxB,CAAgC,aAAhC,EAA+C,EAA/C,CAAP,CAXgC,CAW0B;AAC7D;AAED;;;;;;;AAKA,SAAS,UAAT,CAAoB,GAApB,EAA+B;AAC3B,MAAI,SAAS,GAAG,GAAG,CAAC,OAAJ,CAAY,eAAZ,EAA6B,IAA7B,EAAmC,OAAnC,CAA2C,WAA3C,EAAwD,EAAxD,CAAhB;AAEA,SAAO,SAAP;AACH;AAED;;;;;;;AAKA,SAAS,eAAT,CAAyB,IAAzB,EAAqC;;;AACjC,MAAI,IAAI,KAAK,EAAb,EAAiB,OAAO,KAAP;AAEjB,MAAM,SAAS,GAAG,QAAQ,CAAC,aAAT,CAAuB,KAAvB,CAAlB;AACA,WAAS,CAAC,SAAV,GAAsB,IAAtB;AAEA,SAAO,gBAAS,CAAC,UAAV,MAAoB,IAApB,IAAoB,aAApB,GAAoB,MAApB,GAAoB,GAAE,QAAtB,MAAmC,GAA1C;AACH;AAED;;;;;;;AAKA,SAAS,gBAAT,CAA0B,OAA1B,EAAyD;AACrD,MAAI,EAAC,OAAO,SAAP,WAAO,WAAP,GAAO,MAAP,UAAO,CAAE,MAAV,CAAJ,EAAsB,OAAO,KAAP;AAEtB,MAAM,GAAG,GAAG,OAAO,CAAC,KAAR,CAAc,CAAd,CAAZ;AAEA,SAAO,GAAG,CAAC,QAAJ,KAAiB,GAAjB,IAAwB,GAAG,CAAC,SAAJ,KAAkB,MAAjD;AACH;AAED;;;;;;;AAKA,SAAS,aAAT,CAAuB,MAAvB,EAAuC,WAAvC,EAA8D;AAC1D,WAAS,EAAT,CAAY,CAAZ,EAAoB;AAChB;AACA,QAAM,MAAM,GAAG,MAAM,CAAC,MAAtB;AACA,QAAM,gBAAgB,GAAG,MAAM,CAAC,gBAAhC;AACA,QAAM,cAAc,GAAG,MAAM,CAAC,cAA9B;AACA,QAAM,eAAe,GAAG,MAAM,CAAC,eAA/B,CALgB,CAOhB;;AACA,QAAI,SAAS,GAAG,2BAAa,CAAb,EAAkC,gBAAlC,EAAoD,cAApD,CAAhB;AACA,QAAI,SAAS,GAAG,2BAAa,CAAb,CAAhB;AACA,aAAS,GAAG,SAAS,CAAC,OAAV,CAAkB,MAAlB,EAA0B,MAA1B,CAAZ,CAVgB,CAWhB;;AACA,QAAM,cAAc,GAAG,MAAM,CAAC,SAAP,CAAiB,yBAAjB,EAAvB;;AACA,QAAI,CAAC,cAAL,EAAqB;AACjB;AACH;;AACD,QAAM,QAAQ,GAAG,cAAc,SAAd,kBAAc,WAAd,GAAc,MAAd,iBAAc,CAAE,WAAhB,EAAjB;AACA,QAAM,QAAQ,GAAG,cAAc,SAAd,kBAAc,WAAd,GAAc,MAAd,iBAAc,CAAE,UAAhB,CAA2B,MAA3B,CAAjB,CAjBgB,CAkBhB;;AACA,QAAI,WAAW,GAAW,EAA1B;;AACA,QAAI,QAAQ,CAAC,KAAT,CAAe,CAAf,CAAJ,EAAuB;AACnB,iBAAW,GAAG,QAAQ,SAAR,YAAQ,WAAR,GAAQ,MAAR,WAAQ,CAAE,WAAV,EAAd;AACH,KAtBe,CAuBhB;;;AACA,QAAI,QAAQ,KAAK,MAAb,IAAuB,WAAW,KAAK,KAA3C,EAAkD;AAC9C,UAAI,eAAe,IAAI,kBAAW,eAAX,CAAvB,EAAoD;AAChD;AACA,iBAAS,GAAG,MAAM,eAAe,CAAC,SAAD,CAAf,IAA8B,EAApC,CAAZ;AACH;;AACD,YAAM,CAAC,GAAP,OAAc,YAAd,EAA4B,UAAU,CAAC,SAAD,CAAtC;AACA;AACH,KA/Be,CAiChB;AACA;;;AACA,QAAI,iBAAS,IAAT,CAAc,SAAd,KAA4B,gBAAhC,EAAkD;AAC9C;AACA,UAAI,eAAe,IAAI,kBAAW,eAAX,CAAvB,EAAoD;AAChD;AACA,iBAAS,GAAG,MAAM,eAAe,CAAC,SAAD,CAAf,IAA8B,EAApC,CAAZ,CAFgD,CAEI;AACvD,OAL6C,CAO9C;AACA;;;AACA,UAAM,UAAU,GAAG,SAAS,CAAC,OAAV,CAAkB,gBAAlB,EAA4B,UAAU,IAAV,EAAsB;AACjE,eAAO,eAAY,IAAZ,GAAgB,uBAAhB,GAAqC,IAArC,GAAyC,MAAhD;AACH,OAFkB,CAAnB;AAGA,UAAM,KAAK,GAAG,MAAM,CAAC,SAAP,CAAiB,QAAjB,EAAd,CAZ8C,CAc9C;AACA;;AACA,UAAM,GAAG,GAAG,QAAQ,CAAC,aAAT,CAAuB,KAAvB,CAAZ;AACA,UAAM,QAAQ,GAAG,QAAQ,CAAC,sBAAT,EAAjB;AAEA,SAAG,CAAC,SAAJ,GAAgB,UAAhB;AAEA,UAAI,KAAK,IAAI,IAAb,EAAmB,OArB2B,CAuB9C;;AACA,aAAO,GAAG,CAAC,UAAJ,CAAe,MAAtB,EAA8B;AAC1B,gBAAQ,CAAC,MAAT,CAAgB,GAAG,CAAC,UAAJ,CAAe,CAAf,CAAhB;AACH,OA1B6C,CA4B9C;;;AACA,UAAM,OAAO,GAAG,QAAQ,CAAC,gBAAT,CAA0B,GAA1B,CAAhB;AACA,sCAAO,MAAP,QAAO,EAAS,eAAG;AACf,WAAG,CAAC,SAAJ,GAAgB,GAAG,CAAC,IAApB;AACH,OAFM,CAAP;;AAIA,UAAI,KAAK,CAAC,UAAV,EAAsB;AAClB,aAAK,CAAC,cAAN;AACA,aAAK,CAAC,UAAN,CAAiB,QAAjB;AACH;;AAED,YAAM,CAAC,SAAP,CAAiB,yBAAjB;AAEA;AACH,KA7Ee,CA8EhB;;;AACA,QAAI,CAAC,SAAL,EAAgB;AACZ;AACH;;AACD,QAAI;AACA;AACA;AACA,UAAI,eAAe,IAAI,kBAAW,eAAX,CAAvB,EAAoD;AAChD;AACA,iBAAS,GAAG,MAAM,eAAe,CAAC,SAAD,CAAf,IAA8B,EAApC,CAAZ,CAFgD,CAEI;AACvD,OAND,CAOA;;;AACA,UAAI,UAAU,GAAY,4BAA4B,IAA5B,CAAiC,SAAjC,CAA1B,CARA,CAQsE;AACtE;;AACA,UAAI,UAAU,IAAI,gBAAlB,EAAoC;AAChC,cAAM,CAAC,GAAP,OAAc,YAAd,EAA4B,KAAG,UAAU,CAAC,SAAD,CAAzC,EADgC,CACwB;AAC3D,OAFD,MAEO;AACH,YAAM,IAAI,GAAG,UAAU,CAAC,SAAD,CAAvB,CADG,CAEH;;AACA,YAAI,eAAe,CAAC,IAAD,CAAnB,EAA2B;AACvB,cAAM,OAAO,GAAG,MAAM,CAAC,SAAvB;AACA,gBAAM,CAAC,GAAP,OAAc,YAAd,EAA4B,IAA5B,EAFuB,CAGvB;;AACA,cAAI,OAAO,CAAC,KAAR,CAAc,cAAd,CAAJ,EAAmC;AAC/B;AACA,kBAAM,CAAC,SAAP,CAAiB,gBAAjB;AACA;AACH,WARsB,CASvB;;;AACA,cAAI,gBAAgB,CAAC,QAAD,CAApB,EAAgC;AAC5B,oBAAQ,CAAC,MAAT;AACH;AACJ,SAbD,MAaO;AACH,gBAAM,CAAC,GAAP,OAAc,YAAd,EAA4B,IAA5B,EADG,CAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACH;AACJ;AACJ,KAxCD,CAwCE,OAAO,EAAP,EAAW;AACT;AACA,UAAI,eAAe,IAAI,kBAAW,eAAX,CAAvB,EAAoD;AAChD;AACA,iBAAS,GAAG,MAAM,eAAe,CAAC,SAAD,CAAf,IAA8B,EAApC,CAAZ;AACH;;AACD,YAAM,CAAC,GAAP,OAAc,YAAd,EAA4B,KAAG,UAAU,CAAC,SAAD,CAAzC,EANS,CAM+C;AAC3D;AACJ;;AAED,aAAW,CAAC,IAAZ,CAAiB,EAAjB;AACH;;AAED,qBAAe,aAAf,C;;;;;;;;ACzNA;;;;;;;;;;;;;;;;;;;;;AAKA;;AACA;AAOA;;;;;;AAIA,SAAS,eAAT,CAAyB,IAAzB,EAAqC;AACjC,MAAM,aAAa,GAAG,qBAAtB;AACA,MAAM,WAAW,GAAG,qBAApB;AACA,SAAO,IAAI,CAAC,OAAL,CAAa,aAAb,EAA4B,UAAC,CAAD,EAAU;AACzC;AACA,QAAM,MAAM,GAAG,CAAC,CAAC,KAAF,CAAQ,WAAR,CAAf;AACA,QAAI,MAAM,IAAI,IAAd,EAAoB,OAAO,EAAP;AACpB,WAAO,MAAM,CAAC,CAAD,CAAb;AACH,GALM,CAAP;AAMH;AAED;;;;;;;AAKA,SAAS,WAAT,CAAqB,GAArB,EAAkC,SAAlC,EAAoD;AAAA;;AAChD,KAAG,GAAG,oCAAG,CAAC,WAAJ,kBAAN,CADgD,CAGhD;;AACA,MAAI,mBAAY,GAAZ,CAAgB,GAAhB,CAAJ,EAA0B;AACtB,WAAO,IAAP;AACH,GAN+C,CAQhD;;;AACA,MAAI,SAAJ,EAAe;AACX,QAAI,GAAG,KAAK,KAAZ,EAAmB;AACf,aAAO,IAAP;AACH;AACJ;;AAED,SAAO,KAAP;AACH;AAED;;;;;;;AAKA,SAAS,YAAT,CAAsB,GAAtB,EAAmC,KAAnC,EAAoD;AAChD,MAAI,MAAM,GAAG,EAAb,CADgD,CAGhD;;AACA,QAAM,GAAG,MAAI,GAAb,CAJgD,CAMhD;;AACA,MAAI,UAAU,GAAa,EAA3B;AACA,gCAAK,MAAL,MAAK,EAAS,UAAC,IAAD,EAAe;AACzB,cAAU,CAAC,IAAX,CAAmB,IAAI,CAAC,IAAL,GAAS,KAAT,GAAc,IAAI,CAAC,KAAnB,GAAwB,IAA3C;AACH,GAFI,CAAL;;AAGA,MAAI,UAAU,CAAC,MAAX,GAAoB,CAAxB,EAA2B;AACvB,UAAM,GAAG,MAAM,GAAG,GAAT,GAAe,UAAU,CAAC,IAAX,CAAgB,GAAhB,CAAxB;AACH,GAb+C,CAehD;;;AACA,MAAM,OAAO,GAAG,kBAAW,GAAX,CAAe,GAAf,CAAhB,CAhBgD,CAgBZ;;AACpC,QAAM,GAAG,MAAM,IAAI,OAAO,GAAG,GAAH,GAAS,EAApB,CAAN,GAAgC,GAAzC;AAEA,SAAO,MAAP;AACH;AAED;;;;;;AAIA,SAAS,UAAT,CAAoB,GAApB,EAA+B;AAC3B,SAAO,OAAK,GAAL,GAAQ,GAAf;AACH;AAED;;;;;;;;AAMA,SAAS,SAAT,CAAmB,IAAnB,EAAiC,WAAjC,EAA8D,SAA9D,EAAwF;AAAvD;AAAA;AAA2B;;AAAE;AAAA;AAA0B;;AACpF,MAAI,SAAS,GAAa,EAA1B,CADoF,CACvD;AAE7B;;AACA,MAAI,OAAO,GAAG,EAAd;;AACA,WAAS,YAAT,CAAsB,GAAtB,EAAiC;AAC7B,OAAG,GAAG,yBAAG,MAAH,IAAG,CAAT;AACA,QAAI,CAAC,GAAL,EAAU;AACV,QAAI,kBAAW,GAAX,CAAe,GAAf,CAAJ,EAAyB,OAHI,CAGG;;AAChC,WAAO,GAAG,GAAV;AACH;;AACD,WAAS,UAAT,GAAmB;AACf,WAAO,GAAG,EAAV;AACH,GAbmF,CAepF;;;AACA,MAAM,UAAU,GAAG,IAAI,gCAAJ,EAAnB;AACA,YAAU,CAAC,KAAX,CAAiB,IAAjB,EAAuB;AACnB,gBAAY,EAAZ,sBAAa,GAAb,EAA0B,KAA1B,EAAmC;AAC/B;AACA,kBAAY,CAAC,GAAD,CAAZ,CAF+B,CAI/B;;AACA,UAAI,WAAW,CAAC,GAAD,EAAM,SAAN,CAAf,EAAiC;AAC7B;AACH,OAP8B,CAS/B;;;AACA,UAAM,iBAAiB,GAAG,uBAAgB,GAAhB,CAAoB,GAApB,KAA4B,EAAtD;AACA,UAAM,WAAW,GAAe,EAAhC;AACA,oCAAK,MAAL,MAAK,EAAS,UAAC,IAAD,EAAe;AACzB;AACA,YAAM,IAAI,GAAG,IAAI,CAAC,IAAlB,CAFyB,CAIzB;;AACA,YAAI,IAAI,KAAK,OAAb,EAAsB;AAClB;AACA,cAAI,CAAC,WAAL,EAAkB;AACd,uBAAW,CAAC,IAAZ,CAAiB,IAAjB;AACH;;AACD;AACH,SAXwB,CAazB;;;AACA,YAAI,2CAAiB,MAAjB,kBAAiB,EAAU,IAAV,CAAjB,KAAqC,KAAzC,EAAgD;AAC5C;AACA;AACH;;AACD,mBAAW,CAAC,IAAZ,CAAiB,IAAjB;AACH,OAnBI,CAAL,CAZ+B,CAiC/B;;AACA,UAAM,IAAI,GAAG,YAAY,CAAC,GAAD,EAAM,WAAN,CAAzB;AACA,eAAS,CAAC,IAAV,CAAe,IAAf;AACH,KArCkB;AAsCnB,cAAU,EAAV,oBAAW,GAAX,EAAsB;AAClB,UAAI,CAAC,GAAL,EAAU;AACN;AACH,OAHiB,CAKlB;;;AACA,UAAI,WAAW,CAAC,OAAD,EAAU,SAAV,CAAf,EAAqC;AACrC,eAAS,CAAC,IAAV,CAAe,GAAf;AACH,KA9CkB;AA+CnB,cAAU,EAAV,oBAAW,GAAX,EAAsB;AAClB;AACA,UAAI,WAAW,CAAC,GAAD,EAAM,SAAN,CAAf,EAAiC;AAC7B;AACH,OAJiB,CAMlB;;;AACA,UAAM,IAAI,GAAG,UAAU,CAAC,GAAD,CAAvB;AACA,eAAS,CAAC,IAAV,CAAe,IAAf,EARkB,CAUlB;;AACA,gBAAU;AACb,KA3DkB;AA4DnB,WAAO,EAAP,iBAAQ,GAAR,EAAmB;AACf;AACA,kBAAY,CAAC,GAAD,CAAZ;AACH;AA/DkB,GAAvB;AAkEA,MAAI,MAAM,GAAG,SAAS,CAAC,IAAV,CAAe,EAAf,CAAb,CAnFoF,CAmFpD;AAEhC;;AACA,QAAM,GAAG,eAAe,CAAC,MAAD,CAAxB;AAEA,SAAO,MAAP;AACH;;AAED,qBAAe,SAAf,C;;;;;;;;ACvLA;;;;;;;;;;;;;;;;sGAKA;;AACa,sBAAc,oBAAQ,CAC/B,SAD+B,EAE/B,UAF+B,EAG/B,MAH+B,EAI/B,MAJ+B,EAK/B,MAL+B,EAM/B,MAN+B,EAO/B,QAP+B,EAQ/B,OAR+B,EAS/B,MAT+B,EAU/B,OAV+B,EAW/B,QAX+B,EAY/B,OAZ+B,EAa/B,KAb+B,EAc/B,QAd+B,EAe/B,KAf+B,CAAR,CAAd,C,CAkBb;;AACa,0BAAkB,oBAAQ,CACnC,CAAC,KAAD,EAAQ,CAAC,KAAD,EAAQ,KAAR,CAAR,CADmC,EAEnC,CAAC,GAAD,EAAM,CAAC,MAAD,EAAS,QAAT,CAAN,CAFmC,EAGnC,CAAC,IAAD,EAAO,CAAC,SAAD,EAAY,SAAZ,CAAP,CAHmC,EAInC,CAAC,IAAD,EAAO,CAAC,SAAD,EAAY,SAAZ,CAAP,CAJmC,CAAR,CAAlB,C,CAOb;;AACa,qBAAa,oBAAQ,CAC9B,MAD8B,EAE9B,MAF8B,EAG9B,UAH8B,EAI9B,IAJ8B,EAK9B,KAL8B,EAM9B,IAN8B,EAO9B,KAP8B,EAQ9B,OAR8B,EAS9B,SAT8B,EAU9B,OAV8B,CAAR,CAAb,C,CAab;;AACa,yBAAiB,oBAAQ,CAClC,IADkC,EAElC,IAFkC,EAGlC,IAHkC,EAIlC,IAJkC,EAKlC,IALkC,EAMlC,GANkC,EAOlC,IAPkC,EAQlC,IARkC,EASlC,OATkC,EAUlC,YAVkC,EAWlC,KAXkC,EAYlC,IAZkC,EAalC,MAbkC,CAAR,CAAjB,C;;;;;;AC/Cb,aAAa,mBAAO,CAAC,GAAc;;AAEnC;;;;;;;ACFA,mBAAO,CAAC,GAAsB;AAC9B,mBAAO,CAAC,EAAmC;AAC3C,mBAAO,CAAC,EAAkC;AAC1C,mBAAO,CAAC,EAA4C;AACpD,WAAW,mBAAO,CAAC,CAAsB;;AAEzC;;;;;;;;ACNa;AACb,iBAAiB,mBAAO,CAAC,GAAyB;AAClD,uBAAuB,mBAAO,CAAC,GAAgC;;AAE/D;AACA;AACA;AACA,yBAAyB,gEAAgE;AACzF,CAAC;;;;;;;ACRD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE;AAClE;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA,gDAAgD;AAChD;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;;AAEA;AACA;AACA,+CAA+C;AAC/C,uCAAuC;AACvC,gCAAgC;AAChC;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qBAAqB;;AAErB;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qBAAqB;;AAErB;AACA;AACA,iBAAiB;AACjB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;;AAEL;AACA;AACA;AACA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&quot;</span><span class="s0">,</span><span class="s1">&quot;file&quot;</span><span class="s0">:</span><span class="s1">&quot;wangEditor.js&quot;</span><span class="s0">,</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;(function webpackUniversalModuleDefinition(root, factory) {</span><span class="s3">\n\t</span><span class="s1">if(typeof exports === 'object' &amp;&amp; typeof module === 'object')</span><span class="s3">\n\t\t</span><span class="s1">module.exports = factory();</span><span class="s3">\n\t</span><span class="s1">else if(typeof define === 'function' &amp;&amp; define.amd)</span><span class="s3">\n\t\t</span><span class="s1">define([], factory);</span><span class="s3">\n\t</span><span class="s1">else if(typeof exports === 'object')</span><span class="s3">\n\t\t</span><span class="s1">exports[</span><span class="s3">\&quot;</span><span class="s1">wangEditor</span><span class="s3">\&quot;</span><span class="s1">] = factory();</span><span class="s3">\n\t</span><span class="s1">else</span><span class="s3">\n\t\t</span><span class="s1">root[</span><span class="s3">\&quot;</span><span class="s1">wangEditor</span><span class="s3">\&quot;</span><span class="s1">] = factory();</span><span class="s3">\n</span><span class="s1">})(window, function() {</span><span class="s3">\n</span><span class="s1">return &quot;</span><span class="s0">,</span><span class="s1">&quot; </span><span class="s3">\t</span><span class="s1">// The module cache</span><span class="s3">\n \t</span><span class="s1">var installedModules = {};</span><span class="s3">\n\n \t</span><span class="s1">// The require function</span><span class="s3">\n \t</span><span class="s1">function __webpack_require__(moduleId) {</span><span class="s3">\n\n \t\t</span><span class="s1">// Check if module is in cache</span><span class="s3">\n \t\t</span><span class="s1">if(installedModules[moduleId]) {</span><span class="s3">\n \t\t\t</span><span class="s1">return installedModules[moduleId].exports;</span><span class="s3">\n \t\t</span><span class="s1">}</span><span class="s3">\n \t\t</span><span class="s1">// Create a new module (and put it into the cache)</span><span class="s3">\n \t\t</span><span class="s1">var module = installedModules[moduleId] = {</span><span class="s3">\n \t\t\t</span><span class="s1">i: moduleId,</span><span class="s3">\n \t\t\t</span><span class="s1">l: false,</span><span class="s3">\n \t\t\t</span><span class="s1">exports: {}</span><span class="s3">\n \t\t</span><span class="s1">};</span><span class="s3">\n\n \t\t</span><span class="s1">// Execute the module function</span><span class="s3">\n \t\t</span><span class="s1">modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);</span><span class="s3">\n\n \t\t</span><span class="s1">// Flag the module as loaded</span><span class="s3">\n \t\t</span><span class="s1">module.l = true;</span><span class="s3">\n\n \t\t</span><span class="s1">// Return the exports of the module</span><span class="s3">\n \t\t</span><span class="s1">return module.exports;</span><span class="s3">\n \t</span><span class="s1">}</span><span class="s3">\n\n\n \t</span><span class="s1">// expose the modules object (__webpack_modules__)</span><span class="s3">\n \t</span><span class="s1">__webpack_require__.m = modules;</span><span class="s3">\n\n \t</span><span class="s1">// expose the module cache</span><span class="s3">\n \t</span><span class="s1">__webpack_require__.c = installedModules;</span><span class="s3">\n\n \t</span><span class="s1">// define getter function for harmony exports</span><span class="s3">\n \t</span><span class="s1">__webpack_require__.d = function(exports, name, getter) {</span><span class="s3">\n \t\t</span><span class="s1">if(!__webpack_require__.o(exports, name)) {</span><span class="s3">\n \t\t\t</span><span class="s1">Object.defineProperty(exports, name, { enumerable: true, get: getter });</span><span class="s3">\n \t\t</span><span class="s1">}</span><span class="s3">\n \t</span><span class="s1">};</span><span class="s3">\n\n \t</span><span class="s1">// define __esModule on exports</span><span class="s3">\n \t</span><span class="s1">__webpack_require__.r = function(exports) {</span><span class="s3">\n \t\t</span><span class="s1">if(typeof Symbol !== 'undefined' &amp;&amp; Symbol.toStringTag) {</span><span class="s3">\n \t\t\t</span><span class="s1">Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });</span><span class="s3">\n \t\t</span><span class="s1">}</span><span class="s3">\n \t\t</span><span class="s1">Object.defineProperty(exports, '__esModule', { value: true });</span><span class="s3">\n \t</span><span class="s1">};</span><span class="s3">\n\n \t</span><span class="s1">// create a fake namespace object</span><span class="s3">\n \t</span><span class="s1">// mode &amp; 1: value is a module id, require it</span><span class="s3">\n \t</span><span class="s1">// mode &amp; 2: merge all properties of value into the ns</span><span class="s3">\n \t</span><span class="s1">// mode &amp; 4: return value when already ns object</span><span class="s3">\n \t</span><span class="s1">// mode &amp; 8|1: behave like require</span><span class="s3">\n \t</span><span class="s1">__webpack_require__.t = function(value, mode) {</span><span class="s3">\n \t\t</span><span class="s1">if(mode &amp; 1) value = __webpack_require__(value);</span><span class="s3">\n \t\t</span><span class="s1">if(mode &amp; 8) return value;</span><span class="s3">\n \t\t</span><span class="s1">if((mode &amp; 4) &amp;&amp; typeof value === 'object' &amp;&amp; value &amp;&amp; value.__esModule) return value;</span><span class="s3">\n \t\t</span><span class="s1">var ns = Object.create(null);</span><span class="s3">\n \t\t</span><span class="s1">__webpack_require__.r(ns);</span><span class="s3">\n \t\t</span><span class="s1">Object.defineProperty(ns, 'default', { enumerable: true, value: value });</span><span class="s3">\n \t\t</span><span class="s1">if(mode &amp; 2 &amp;&amp; typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));</span><span class="s3">\n \t\t</span><span class="s1">return ns;</span><span class="s3">\n \t</span><span class="s1">};</span><span class="s3">\n\n \t</span><span class="s1">// getDefaultExport function for compatibility with non-harmony modules</span><span class="s3">\n \t</span><span class="s1">__webpack_require__.n = function(module) {</span><span class="s3">\n \t\t</span><span class="s1">var getter = module &amp;&amp; module.__esModule ?</span><span class="s3">\n \t\t\t</span><span class="s1">function getDefault() { return module['default']; } :</span><span class="s3">\n \t\t\t</span><span class="s1">function getModuleExports() { return module; };</span><span class="s3">\n \t\t</span><span class="s1">__webpack_require__.d(getter, 'a', getter);</span><span class="s3">\n \t\t</span><span class="s1">return getter;</span><span class="s3">\n \t</span><span class="s1">};</span><span class="s3">\n\n \t</span><span class="s1">// Object.prototype.hasOwnProperty.call</span><span class="s3">\n \t</span><span class="s1">__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };</span><span class="s3">\n\n \t</span><span class="s1">// __webpack_public_path__</span><span class="s3">\n \t</span><span class="s1">__webpack_require__.p = </span><span class="s3">\&quot;\&quot;</span><span class="s1">;</span><span class="s3">\n\n\n \t</span><span class="s1">// Load entry module and return exports</span><span class="s3">\n \t</span><span class="s1">return __webpack_require__(__webpack_require__.s = 141);</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;function _interopRequireDefault(obj) {</span><span class="s3">\n  </span><span class="s1">return obj &amp;&amp; obj.__esModule ? obj : {</span><span class="s3">\n    \&quot;</span><span class="s1">default</span><span class="s3">\&quot;</span><span class="s1">: obj</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">module.exports = _interopRequireDefault;&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/object/define-property</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;/*! *****************************************************************************</span><span class="s3">\r\n</span><span class="s1">Copyright (c) Microsoft Corporation.</span><span class="s3">\r\n\r\n</span><span class="s1">Permission to use, copy, modify, and/or distribute this software for any</span><span class="s3">\r\n</span><span class="s1">purpose with or without fee is hereby granted.</span><span class="s3">\r\n\r\n</span><span class="s1">THE SOFTWARE IS PROVIDED </span><span class="s3">\&quot;</span><span class="s1">AS IS</span><span class="s3">\&quot; </span><span class="s1">AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH</span><span class="s3">\r\n</span><span class="s1">REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY</span><span class="s3">\r\n</span><span class="s1">AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,</span><span class="s3">\r\n</span><span class="s1">INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM</span><span class="s3">\r\n</span><span class="s1">LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR</span><span class="s3">\r\n</span><span class="s1">OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR</span><span class="s3">\r\n</span><span class="s1">PERFORMANCE OF THIS SOFTWARE.</span><span class="s3">\r\n</span><span class="s1">***************************************************************************** */</span><span class="s3">\r\n</span><span class="s1">/* global Reflect, Promise */</span><span class="s3">\r\n\r\n</span><span class="s1">var extendStatics = function(d, b) {</span><span class="s3">\r\n    </span><span class="s1">extendStatics = Object.setPrototypeOf ||</span><span class="s3">\r\n        </span><span class="s1">({ __proto__: [] } instanceof Array &amp;&amp; function (d, b) { d.__proto__ = b; }) ||</span><span class="s3">\r\n        </span><span class="s1">function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };</span><span class="s3">\r\n    </span><span class="s1">return extendStatics(d, b);</span><span class="s3">\r\n</span><span class="s1">};</span><span class="s3">\r\n\r\n</span><span class="s1">export function __extends(d, b) {</span><span class="s3">\r\n    </span><span class="s1">if (typeof b !== </span><span class="s3">\&quot;</span><span class="s1">function</span><span class="s3">\&quot; </span><span class="s1">&amp;&amp; b !== null)</span><span class="s3">\r\n        </span><span class="s1">throw new TypeError(</span><span class="s3">\&quot;</span><span class="s1">Class extends value </span><span class="s3">\&quot; </span><span class="s1">+ String(b) + </span><span class="s3">\&quot; </span><span class="s1">is not a constructor or null</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\r\n    </span><span class="s1">extendStatics(d, b);</span><span class="s3">\r\n    </span><span class="s1">function __() { this.constructor = d; }</span><span class="s3">\r\n    </span><span class="s1">d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export var __assign = function() {</span><span class="s3">\r\n    </span><span class="s1">__assign = Object.assign || function __assign(t) {</span><span class="s3">\r\n        </span><span class="s1">for (var s, i = 1, n = arguments.length; i &lt; n; i++) {</span><span class="s3">\r\n            </span><span class="s1">s = arguments[i];</span><span class="s3">\r\n            </span><span class="s1">for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];</span><span class="s3">\r\n        </span><span class="s1">}</span><span class="s3">\r\n        </span><span class="s1">return t;</span><span class="s3">\r\n    </span><span class="s1">}</span><span class="s3">\r\n    </span><span class="s1">return __assign.apply(this, arguments);</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __rest(s, e) {</span><span class="s3">\r\n    </span><span class="s1">var t = {};</span><span class="s3">\r\n    </span><span class="s1">for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) &amp;&amp; e.indexOf(p) &lt; 0)</span><span class="s3">\r\n        </span><span class="s1">t[p] = s[p];</span><span class="s3">\r\n    </span><span class="s1">if (s != null &amp;&amp; typeof Object.getOwnPropertySymbols === </span><span class="s3">\&quot;</span><span class="s1">function</span><span class="s3">\&quot;</span><span class="s1">)</span><span class="s3">\r\n        </span><span class="s1">for (var i = 0, p = Object.getOwnPropertySymbols(s); i &lt; p.length; i++) {</span><span class="s3">\r\n            </span><span class="s1">if (e.indexOf(p[i]) &lt; 0 &amp;&amp; Object.prototype.propertyIsEnumerable.call(s, p[i]))</span><span class="s3">\r\n                </span><span class="s1">t[p[i]] = s[p[i]];</span><span class="s3">\r\n        </span><span class="s1">}</span><span class="s3">\r\n    </span><span class="s1">return t;</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __decorate(decorators, target, key, desc) {</span><span class="s3">\r\n    </span><span class="s1">var c = arguments.length, r = c &lt; 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;</span><span class="s3">\r\n    </span><span class="s1">if (typeof Reflect === </span><span class="s3">\&quot;</span><span class="s1">object</span><span class="s3">\&quot; </span><span class="s1">&amp;&amp; typeof Reflect.decorate === </span><span class="s3">\&quot;</span><span class="s1">function</span><span class="s3">\&quot;</span><span class="s1">) r = Reflect.decorate(decorators, target, key, desc);</span><span class="s3">\r\n    </span><span class="s1">else for (var i = decorators.length - 1; i &gt;= 0; i--) if (d = decorators[i]) r = (c &lt; 3 ? d(r) : c &gt; 3 ? d(target, key, r) : d(target, key)) || r;</span><span class="s3">\r\n    </span><span class="s1">return c &gt; 3 &amp;&amp; r &amp;&amp; Object.defineProperty(target, key, r), r;</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __param(paramIndex, decorator) {</span><span class="s3">\r\n    </span><span class="s1">return function (target, key) { decorator(target, key, paramIndex); }</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __metadata(metadataKey, metadataValue) {</span><span class="s3">\r\n    </span><span class="s1">if (typeof Reflect === </span><span class="s3">\&quot;</span><span class="s1">object</span><span class="s3">\&quot; </span><span class="s1">&amp;&amp; typeof Reflect.metadata === </span><span class="s3">\&quot;</span><span class="s1">function</span><span class="s3">\&quot;</span><span class="s1">) return Reflect.metadata(metadataKey, metadataValue);</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __awaiter(thisArg, _arguments, P, generator) {</span><span class="s3">\r\n    </span><span class="s1">function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }</span><span class="s3">\r\n    </span><span class="s1">return new (P || (P = Promise))(function (resolve, reject) {</span><span class="s3">\r\n        </span><span class="s1">function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }</span><span class="s3">\r\n        </span><span class="s1">function rejected(value) { try { step(generator[</span><span class="s3">\&quot;</span><span class="s1">throw</span><span class="s3">\&quot;</span><span class="s1">](value)); } catch (e) { reject(e); } }</span><span class="s3">\r\n        </span><span class="s1">function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }</span><span class="s3">\r\n        </span><span class="s1">step((generator = generator.apply(thisArg, _arguments || [])).next());</span><span class="s3">\r\n    </span><span class="s1">});</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __generator(thisArg, body) {</span><span class="s3">\r\n    </span><span class="s1">var _ = { label: 0, sent: function() { if (t[0] &amp; 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;</span><span class="s3">\r\n    </span><span class="s1">return g = { next: verb(0), </span><span class="s3">\&quot;</span><span class="s1">throw</span><span class="s3">\&quot;</span><span class="s1">: verb(1), </span><span class="s3">\&quot;</span><span class="s1">return</span><span class="s3">\&quot;</span><span class="s1">: verb(2) }, typeof Symbol === </span><span class="s3">\&quot;</span><span class="s1">function</span><span class="s3">\&quot; </span><span class="s1">&amp;&amp; (g[Symbol.iterator] = function() { return this; }), g;</span><span class="s3">\r\n    </span><span class="s1">function verb(n) { return function (v) { return step([n, v]); }; }</span><span class="s3">\r\n    </span><span class="s1">function step(op) {</span><span class="s3">\r\n        </span><span class="s1">if (f) throw new TypeError(</span><span class="s3">\&quot;</span><span class="s1">Generator is already executing.</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\r\n        </span><span class="s1">while (_) try {</span><span class="s3">\r\n            </span><span class="s1">if (f = 1, y &amp;&amp; (t = op[0] &amp; 2 ? y[</span><span class="s3">\&quot;</span><span class="s1">return</span><span class="s3">\&quot;</span><span class="s1">] : op[0] ? y[</span><span class="s3">\&quot;</span><span class="s1">throw</span><span class="s3">\&quot;</span><span class="s1">] || ((t = y[</span><span class="s3">\&quot;</span><span class="s1">return</span><span class="s3">\&quot;</span><span class="s1">]) &amp;&amp; t.call(y), 0) : y.next) &amp;&amp; !(t = t.call(y, op[1])).done) return t;</span><span class="s3">\r\n            </span><span class="s1">if (y = 0, t) op = [op[0] &amp; 2, t.value];</span><span class="s3">\r\n            </span><span class="s1">switch (op[0]) {</span><span class="s3">\r\n                </span><span class="s1">case 0: case 1: t = op; break;</span><span class="s3">\r\n                </span><span class="s1">case 4: _.label++; return { value: op[1], done: false };</span><span class="s3">\r\n                </span><span class="s1">case 5: _.label++; y = op[1]; op = [0]; continue;</span><span class="s3">\r\n                </span><span class="s1">case 7: op = _.ops.pop(); _.trys.pop(); continue;</span><span class="s3">\r\n                </span><span class="s1">default:</span><span class="s3">\r\n                    </span><span class="s1">if (!(t = _.trys, t = t.length &gt; 0 &amp;&amp; t[t.length - 1]) &amp;&amp; (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }</span><span class="s3">\r\n                    </span><span class="s1">if (op[0] === 3 &amp;&amp; (!t || (op[1] &gt; t[0] &amp;&amp; op[1] &lt; t[3]))) { _.label = op[1]; break; }</span><span class="s3">\r\n                    </span><span class="s1">if (op[0] === 6 &amp;&amp; _.label &lt; t[1]) { _.label = t[1]; t = op; break; }</span><span class="s3">\r\n                    </span><span class="s1">if (t &amp;&amp; _.label &lt; t[2]) { _.label = t[2]; _.ops.push(op); break; }</span><span class="s3">\r\n                    </span><span class="s1">if (t[2]) _.ops.pop();</span><span class="s3">\r\n                    </span><span class="s1">_.trys.pop(); continue;</span><span class="s3">\r\n            </span><span class="s1">}</span><span class="s3">\r\n            </span><span class="s1">op = body.call(thisArg, _);</span><span class="s3">\r\n        </span><span class="s1">} catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }</span><span class="s3">\r\n        </span><span class="s1">if (op[0] &amp; 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };</span><span class="s3">\r\n    </span><span class="s1">}</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export var __createBinding = Object.create ? (function(o, m, k, k2) {</span><span class="s3">\r\n    </span><span class="s1">if (k2 === undefined) k2 = k;</span><span class="s3">\r\n    </span><span class="s1">Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });</span><span class="s3">\r\n</span><span class="s1">}) : (function(o, m, k, k2) {</span><span class="s3">\r\n    </span><span class="s1">if (k2 === undefined) k2 = k;</span><span class="s3">\r\n    </span><span class="s1">o[k2] = m[k];</span><span class="s3">\r\n</span><span class="s1">});</span><span class="s3">\r\n\r\n</span><span class="s1">export function __exportStar(m, o) {</span><span class="s3">\r\n    </span><span class="s1">for (var p in m) if (p !== </span><span class="s3">\&quot;</span><span class="s1">default</span><span class="s3">\&quot; </span><span class="s1">&amp;&amp; !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __values(o) {</span><span class="s3">\r\n    </span><span class="s1">var s = typeof Symbol === </span><span class="s3">\&quot;</span><span class="s1">function</span><span class="s3">\&quot; </span><span class="s1">&amp;&amp; Symbol.iterator, m = s &amp;&amp; o[s], i = 0;</span><span class="s3">\r\n    </span><span class="s1">if (m) return m.call(o);</span><span class="s3">\r\n    </span><span class="s1">if (o &amp;&amp; typeof o.length === </span><span class="s3">\&quot;</span><span class="s1">number</span><span class="s3">\&quot;</span><span class="s1">) return {</span><span class="s3">\r\n        </span><span class="s1">next: function () {</span><span class="s3">\r\n            </span><span class="s1">if (o &amp;&amp; i &gt;= o.length) o = void 0;</span><span class="s3">\r\n            </span><span class="s1">return { value: o &amp;&amp; o[i++], done: !o };</span><span class="s3">\r\n        </span><span class="s1">}</span><span class="s3">\r\n    </span><span class="s1">};</span><span class="s3">\r\n    </span><span class="s1">throw new TypeError(s ? </span><span class="s3">\&quot;</span><span class="s1">Object is not iterable.</span><span class="s3">\&quot; </span><span class="s1">: </span><span class="s3">\&quot;</span><span class="s1">Symbol.iterator is not defined.</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __read(o, n) {</span><span class="s3">\r\n    </span><span class="s1">var m = typeof Symbol === </span><span class="s3">\&quot;</span><span class="s1">function</span><span class="s3">\&quot; </span><span class="s1">&amp;&amp; o[Symbol.iterator];</span><span class="s3">\r\n    </span><span class="s1">if (!m) return o;</span><span class="s3">\r\n    </span><span class="s1">var i = m.call(o), r, ar = [], e;</span><span class="s3">\r\n    </span><span class="s1">try {</span><span class="s3">\r\n        </span><span class="s1">while ((n === void 0 || n-- &gt; 0) &amp;&amp; !(r = i.next()).done) ar.push(r.value);</span><span class="s3">\r\n    </span><span class="s1">}</span><span class="s3">\r\n    </span><span class="s1">catch (error) { e = { error: error }; }</span><span class="s3">\r\n    </span><span class="s1">finally {</span><span class="s3">\r\n        </span><span class="s1">try {</span><span class="s3">\r\n            </span><span class="s1">if (r &amp;&amp; !r.done &amp;&amp; (m = i[</span><span class="s3">\&quot;</span><span class="s1">return</span><span class="s3">\&quot;</span><span class="s1">])) m.call(i);</span><span class="s3">\r\n        </span><span class="s1">}</span><span class="s3">\r\n        </span><span class="s1">finally { if (e) throw e.error; }</span><span class="s3">\r\n    </span><span class="s1">}</span><span class="s3">\r\n    </span><span class="s1">return ar;</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">/** @deprecated */</span><span class="s3">\r\n</span><span class="s1">export function __spread() {</span><span class="s3">\r\n    </span><span class="s1">for (var ar = [], i = 0; i &lt; arguments.length; i++)</span><span class="s3">\r\n        </span><span class="s1">ar = ar.concat(__read(arguments[i]));</span><span class="s3">\r\n    </span><span class="s1">return ar;</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">/** @deprecated */</span><span class="s3">\r\n</span><span class="s1">export function __spreadArrays() {</span><span class="s3">\r\n    </span><span class="s1">for (var s = 0, i = 0, il = arguments.length; i &lt; il; i++) s += arguments[i].length;</span><span class="s3">\r\n    </span><span class="s1">for (var r = Array(s), k = 0, i = 0; i &lt; il; i++)</span><span class="s3">\r\n        </span><span class="s1">for (var a = arguments[i], j = 0, jl = a.length; j &lt; jl; j++, k++)</span><span class="s3">\r\n            </span><span class="s1">r[k] = a[j];</span><span class="s3">\r\n    </span><span class="s1">return r;</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __spreadArray(to, from) {</span><span class="s3">\r\n    </span><span class="s1">for (var i = 0, il = from.length, j = to.length; i &lt; il; i++, j++)</span><span class="s3">\r\n        </span><span class="s1">to[j] = from[i];</span><span class="s3">\r\n    </span><span class="s1">return to;</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __await(v) {</span><span class="s3">\r\n    </span><span class="s1">return this instanceof __await ? (this.v = v, this) : new __await(v);</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __asyncGenerator(thisArg, _arguments, generator) {</span><span class="s3">\r\n    </span><span class="s1">if (!Symbol.asyncIterator) throw new TypeError(</span><span class="s3">\&quot;</span><span class="s1">Symbol.asyncIterator is not defined.</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\r\n    </span><span class="s1">var g = generator.apply(thisArg, _arguments || []), i, q = [];</span><span class="s3">\r\n    </span><span class="s1">return i = {}, verb(</span><span class="s3">\&quot;</span><span class="s1">next</span><span class="s3">\&quot;</span><span class="s1">), verb(</span><span class="s3">\&quot;</span><span class="s1">throw</span><span class="s3">\&quot;</span><span class="s1">), verb(</span><span class="s3">\&quot;</span><span class="s1">return</span><span class="s3">\&quot;</span><span class="s1">), i[Symbol.asyncIterator] = function () { return this; }, i;</span><span class="s3">\r\n    </span><span class="s1">function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) &gt; 1 || resume(n, v); }); }; }</span><span class="s3">\r\n    </span><span class="s1">function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }</span><span class="s3">\r\n    </span><span class="s1">function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }</span><span class="s3">\r\n    </span><span class="s1">function fulfill(value) { resume(</span><span class="s3">\&quot;</span><span class="s1">next</span><span class="s3">\&quot;</span><span class="s1">, value); }</span><span class="s3">\r\n    </span><span class="s1">function reject(value) { resume(</span><span class="s3">\&quot;</span><span class="s1">throw</span><span class="s3">\&quot;</span><span class="s1">, value); }</span><span class="s3">\r\n    </span><span class="s1">function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __asyncDelegator(o) {</span><span class="s3">\r\n    </span><span class="s1">var i, p;</span><span class="s3">\r\n    </span><span class="s1">return i = {}, verb(</span><span class="s3">\&quot;</span><span class="s1">next</span><span class="s3">\&quot;</span><span class="s1">), verb(</span><span class="s3">\&quot;</span><span class="s1">throw</span><span class="s3">\&quot;</span><span class="s1">, function (e) { throw e; }), verb(</span><span class="s3">\&quot;</span><span class="s1">return</span><span class="s3">\&quot;</span><span class="s1">), i[Symbol.iterator] = function () { return this; }, i;</span><span class="s3">\r\n    </span><span class="s1">function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === </span><span class="s3">\&quot;</span><span class="s1">return</span><span class="s3">\&quot; </span><span class="s1">} : f ? f(v) : v; } : f; }</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __asyncValues(o) {</span><span class="s3">\r\n    </span><span class="s1">if (!Symbol.asyncIterator) throw new TypeError(</span><span class="s3">\&quot;</span><span class="s1">Symbol.asyncIterator is not defined.</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\r\n    </span><span class="s1">var m = o[Symbol.asyncIterator], i;</span><span class="s3">\r\n    </span><span class="s1">return m ? m.call(o) : (o = typeof __values === </span><span class="s3">\&quot;</span><span class="s1">function</span><span class="s3">\&quot; </span><span class="s1">? __values(o) : o[Symbol.iterator](), i = {}, verb(</span><span class="s3">\&quot;</span><span class="s1">next</span><span class="s3">\&quot;</span><span class="s1">), verb(</span><span class="s3">\&quot;</span><span class="s1">throw</span><span class="s3">\&quot;</span><span class="s1">), verb(</span><span class="s3">\&quot;</span><span class="s1">return</span><span class="s3">\&quot;</span><span class="s1">), i[Symbol.asyncIterator] = function () { return this; }, i);</span><span class="s3">\r\n    </span><span class="s1">function verb(n) { i[n] = o[n] &amp;&amp; function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }</span><span class="s3">\r\n    </span><span class="s1">function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __makeTemplateObject(cooked, raw) {</span><span class="s3">\r\n    </span><span class="s1">if (Object.defineProperty) { Object.defineProperty(cooked, </span><span class="s3">\&quot;</span><span class="s1">raw</span><span class="s3">\&quot;</span><span class="s1">, { value: raw }); } else { cooked.raw = raw; }</span><span class="s3">\r\n    </span><span class="s1">return cooked;</span><span class="s3">\r\n</span><span class="s1">};</span><span class="s3">\r\n\r\n</span><span class="s1">var __setModuleDefault = Object.create ? (function(o, v) {</span><span class="s3">\r\n    </span><span class="s1">Object.defineProperty(o, </span><span class="s3">\&quot;</span><span class="s1">default</span><span class="s3">\&quot;</span><span class="s1">, { enumerable: true, value: v });</span><span class="s3">\r\n</span><span class="s1">}) : function(o, v) {</span><span class="s3">\r\n    </span><span class="s1">o[</span><span class="s3">\&quot;</span><span class="s1">default</span><span class="s3">\&quot;</span><span class="s1">] = v;</span><span class="s3">\r\n</span><span class="s1">};</span><span class="s3">\r\n\r\n</span><span class="s1">export function __importStar(mod) {</span><span class="s3">\r\n    </span><span class="s1">if (mod &amp;&amp; mod.__esModule) return mod;</span><span class="s3">\r\n    </span><span class="s1">var result = {};</span><span class="s3">\r\n    </span><span class="s1">if (mod != null) for (var k in mod) if (k !== </span><span class="s3">\&quot;</span><span class="s1">default</span><span class="s3">\&quot; </span><span class="s1">&amp;&amp; Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);</span><span class="s3">\r\n    </span><span class="s1">__setModuleDefault(result, mod);</span><span class="s3">\r\n    </span><span class="s1">return result;</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __importDefault(mod) {</span><span class="s3">\r\n    </span><span class="s1">return (mod &amp;&amp; mod.__esModule) ? mod : { default: mod };</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __classPrivateFieldGet(receiver, privateMap) {</span><span class="s3">\r\n    </span><span class="s1">if (!privateMap.has(receiver)) {</span><span class="s3">\r\n        </span><span class="s1">throw new TypeError(</span><span class="s3">\&quot;</span><span class="s1">attempted to get private field on non-instance</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\r\n    </span><span class="s1">}</span><span class="s3">\r\n    </span><span class="s1">return privateMap.get(receiver);</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n\r\n</span><span class="s1">export function __classPrivateFieldSet(receiver, privateMap, value) {</span><span class="s3">\r\n    </span><span class="s1">if (!privateMap.has(receiver)) {</span><span class="s3">\r\n        </span><span class="s1">throw new TypeError(</span><span class="s3">\&quot;</span><span class="s1">attempted to set private field on non-instance</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\r\n    </span><span class="s1">}</span><span class="s3">\r\n    </span><span class="s1">privateMap.set(receiver, value);</span><span class="s3">\r\n    </span><span class="s1">return value;</span><span class="s3">\r\n</span><span class="s1">}</span><span class="s3">\r\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 封装 DOM 操作</span><span class="s3">\n </span><span class="s1">* @wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../editor/index'</span><span class="s3">\n</span><span class="s1">import { toArray } from './util'</span><span class="s3">\n\n</span><span class="s1">// 记录元素基于上一个相对&amp;绝对定位的位置信息</span><span class="s3">\n</span><span class="s1">type OffsetDataType = {</span><span class="s3">\n    </span><span class="s1">top: number</span><span class="s3">\n    </span><span class="s1">left: number</span><span class="s3">\n    </span><span class="s1">width: number</span><span class="s3">\n    </span><span class="s1">height: number</span><span class="s3">\n    </span><span class="s1">parent: Element | null</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// 记录代理事件绑定</span><span class="s3">\n</span><span class="s1">type listener = (e: Event) =&gt; void</span><span class="s3">\n</span><span class="s1">type EventItem = {</span><span class="s3">\n    </span><span class="s1">elem: HTMLElement</span><span class="s3">\n    </span><span class="s1">selector: string</span><span class="s3">\n    </span><span class="s1">fn: listener</span><span class="s3">\n    </span><span class="s1">agentFn: listener</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">const AGENT_EVENTS: EventItem[] = []</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 根据 html 字符串创建 elem</span><span class="s3">\n </span><span class="s1">* @param {String} html html</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function _createElemByHTML(html: string): HTMLElement[] {</span><span class="s3">\n    </span><span class="s1">const div = document.createElement('div')</span><span class="s3">\n    </span><span class="s1">div.innerHTML = html</span><span class="s3">\n    </span><span class="s1">const elems = div.children</span><span class="s3">\n    </span><span class="s1">return toArray(elems)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 判断是否是 DOM List</span><span class="s3">\n </span><span class="s1">* @param selector DOM 元素或列表</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function _isDOMList&lt;T extends HTMLCollection | NodeList&gt;(selector: unknown): selector is T {</span><span class="s3">\n    </span><span class="s1">if (!selector) {</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (selector instanceof HTMLCollection || selector instanceof NodeList) {</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return false</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 封装 querySelectorAll</span><span class="s3">\n </span><span class="s1">* @param selector css 选择器</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function _querySelectorAll(selector: string): HTMLElement[] {</span><span class="s3">\n    </span><span class="s1">const elems = document.querySelectorAll(selector)</span><span class="s3">\n    </span><span class="s1">return toArray(elems)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 封装 _styleArrTrim</span><span class="s3">\n </span><span class="s1">* @param styleArr css</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function _styleArrTrim(style: string | string[]): string[] {</span><span class="s3">\n    </span><span class="s1">let styleArr: string[] = []</span><span class="s3">\n    </span><span class="s1">let resultArr: string[] = []</span><span class="s3">\n\n    </span><span class="s1">if (!Array.isArray(style)) {</span><span class="s3">\n        </span><span class="s1">// 有 style，将 style 按照 `;` 拆分为数组</span><span class="s3">\n        </span><span class="s1">styleArr = style.split(';')</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">styleArr = style</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">styleArr.forEach(item =&gt; {</span><span class="s3">\n        </span><span class="s1">// 对每项样式，按照 : 拆分为 key 和 value</span><span class="s3">\n        </span><span class="s1">let arr = item.split(':').map(i =&gt; {</span><span class="s3">\n            </span><span class="s1">return i.trim()</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">if (arr.length === 2) {</span><span class="s3">\n            </span><span class="s1">resultArr.push(arr[0] + ':' + arr[1])</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">return resultArr</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export type DomElementSelector =</span><span class="s3">\n    </span><span class="s1">| string</span><span class="s3">\n    </span><span class="s1">| DomElement</span><span class="s3">\n    </span><span class="s1">| Document</span><span class="s3">\n    </span><span class="s1">| Node</span><span class="s3">\n    </span><span class="s1">| NodeList</span><span class="s3">\n    </span><span class="s1">| ChildNode</span><span class="s3">\n    </span><span class="s1">| ChildNode[]</span><span class="s3">\n    </span><span class="s1">| Element</span><span class="s3">\n    </span><span class="s1">| HTMLElement</span><span class="s3">\n    </span><span class="s1">| HTMLElement[]</span><span class="s3">\n    </span><span class="s1">| HTMLCollection</span><span class="s3">\n    </span><span class="s1">| EventTarget</span><span class="s3">\n    </span><span class="s1">| null</span><span class="s3">\n    </span><span class="s1">| undefined</span><span class="s3">\n\n</span><span class="s1">// 构造函数</span><span class="s3">\n</span><span class="s1">export class DomElement&lt;T extends DomElementSelector = DomElementSelector&gt; {</span><span class="s3">\n    </span><span class="s1">// 定义属性</span><span class="s3">\n    </span><span class="s1">selector!: T</span><span class="s3">\n    </span><span class="s1">length: number</span><span class="s3">\n    </span><span class="s1">elems: HTMLElement[]</span><span class="s3">\n    </span><span class="s1">dataSource: Map&lt;string, any&gt;</span><span class="s3">\n    </span><span class="s1">prior?: DomElement // 通过 getNodeTop 获取顶级段落的时候，可以通过 prior 去回溯来源的子节点</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 构造函数</span><span class="s3">\n     </span><span class="s1">* @param selector 任一类型的选择器</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">constructor(selector: T) {</span><span class="s3">\n        </span><span class="s1">// 初始化属性</span><span class="s3">\n        </span><span class="s1">this.elems = []</span><span class="s3">\n        </span><span class="s1">this.length = this.elems.length</span><span class="s3">\n        </span><span class="s1">this.dataSource = new Map()</span><span class="s3">\n\n        </span><span class="s1">if (!selector) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 原本就是 DomElement 实例，则直接返回</span><span class="s3">\n        </span><span class="s1">if (selector instanceof DomElement) {</span><span class="s3">\n            </span><span class="s1">return selector as DomElement&lt;T&gt;</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">let selectorResult: HTMLElement[] = [] // 存储查询结果</span><span class="s3">\n        </span><span class="s1">const nodeType = selector instanceof Node ? selector.nodeType : -1</span><span class="s3">\n        </span><span class="s1">this.selector = selector</span><span class="s3">\n\n        </span><span class="s1">if (nodeType === 1 || nodeType === 9) {</span><span class="s3">\n            </span><span class="s1">selectorResult = [selector as HTMLElement]</span><span class="s3">\n        </span><span class="s1">} else if (_isDOMList(selector)) {</span><span class="s3">\n            </span><span class="s1">// DOM List</span><span class="s3">\n            </span><span class="s1">selectorResult = toArray(selector)</span><span class="s3">\n        </span><span class="s1">} else if (selector instanceof Array) {</span><span class="s3">\n            </span><span class="s1">// Element 数组（其他数据类型，暂时忽略）</span><span class="s3">\n            </span><span class="s1">selectorResult = selector as HTMLElement[]</span><span class="s3">\n        </span><span class="s1">} else if (typeof selector === 'string') {</span><span class="s3">\n            </span><span class="s1">// 字符串</span><span class="s3">\n            </span><span class="s1">const tmpSelector = selector.replace('/</span><span class="s3">\\</span><span class="s1">n/mg', '').trim()</span><span class="s3">\n            </span><span class="s1">if (tmpSelector.indexOf('&lt;') === 0) {</span><span class="s3">\n                </span><span class="s1">// 如 &lt;div&gt;</span><span class="s3">\n                </span><span class="s1">selectorResult = _createElemByHTML(tmpSelector)</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">// 如 #id .class</span><span class="s3">\n                </span><span class="s1">selectorResult = _querySelectorAll(tmpSelector)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const length = selectorResult.length</span><span class="s3">\n        </span><span class="s1">if (!length) {</span><span class="s3">\n            </span><span class="s1">// 空数组</span><span class="s3">\n            </span><span class="s1">return this</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 加入 DOM 节点</span><span class="s3">\n        </span><span class="s1">let i = 0</span><span class="s3">\n        </span><span class="s1">for (; i &lt; length; i++) {</span><span class="s3">\n            </span><span class="s1">this.elems.push(selectorResult[i])</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">this.length = length</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取元素 id</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">get id(): string {</span><span class="s3">\n        </span><span class="s1">return this.elems[0].id</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 遍历所有元素，执行回调函数</span><span class="s3">\n     </span><span class="s1">* @param fn 回调函数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">forEach(fn: (ele: HTMLElement, index?: number) =&gt; boolean | unknown): DomElement {</span><span class="s3">\n        </span><span class="s1">for (let i = 0; i &lt; this.length; i++) {</span><span class="s3">\n            </span><span class="s1">const elem = this.elems[i]</span><span class="s3">\n            </span><span class="s1">const result = fn.call(elem, elem, i)</span><span class="s3">\n            </span><span class="s1">if (result === false) {</span><span class="s3">\n                </span><span class="s1">break</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return this</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 克隆元素</span><span class="s3">\n     </span><span class="s1">* @param deep 是否深度克隆</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">clone(deep: boolean = false): DomElement {</span><span class="s3">\n        </span><span class="s1">const cloneList: HTMLElement[] = []</span><span class="s3">\n        </span><span class="s1">this.elems.forEach(elem =&gt; {</span><span class="s3">\n            </span><span class="s1">cloneList.push(elem.cloneNode(!!deep) as HTMLElement)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">return $(cloneList)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取第几个元素</span><span class="s3">\n     </span><span class="s1">* @param index index</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">get(index: number = 0): DomElement {</span><span class="s3">\n        </span><span class="s1">const length = this.length</span><span class="s3">\n        </span><span class="s1">if (index &gt;= length) {</span><span class="s3">\n            </span><span class="s1">index = index % length</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return $(this.elems[index])</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取第一个元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">first(): DomElement {</span><span class="s3">\n        </span><span class="s1">return this.get(0)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取最后一个元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">last(): DomElement {</span><span class="s3">\n        </span><span class="s1">const length = this.length</span><span class="s3">\n        </span><span class="s1">return this.get(length - 1)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 绑定事件</span><span class="s3">\n     </span><span class="s1">* @param type 事件类型</span><span class="s3">\n     </span><span class="s1">* @param selector DOM 选择器</span><span class="s3">\n     </span><span class="s1">* @param fn 事件函数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">on(type: string, fn: Function): DomElement</span><span class="s3">\n    </span><span class="s1">on(type: string, selector: string, fn: Function): DomElement</span><span class="s3">\n    </span><span class="s1">on(type: string, selector: string | Function, fn?: Function): DomElement {</span><span class="s3">\n        </span><span class="s1">if (!type) return this</span><span class="s3">\n\n        </span><span class="s1">// 没有 selector ，只有 type 和 fn</span><span class="s3">\n        </span><span class="s1">if (typeof selector === 'function') {</span><span class="s3">\n            </span><span class="s1">fn = selector</span><span class="s3">\n            </span><span class="s1">selector = ''</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">return this.forEach(elem =&gt; {</span><span class="s3">\n            </span><span class="s1">// 没有事件代理</span><span class="s3">\n            </span><span class="s1">if (!selector) {</span><span class="s3">\n                </span><span class="s1">// 无代理</span><span class="s3">\n                </span><span class="s1">elem.addEventListener(type, fn as listener)</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 有事件代理</span><span class="s3">\n            </span><span class="s1">const agentFn: listener = function (e) {</span><span class="s3">\n                </span><span class="s1">const target = e.target as HTMLElement</span><span class="s3">\n                </span><span class="s1">if (target.matches(selector as string)) {</span><span class="s3">\n                    </span><span class="s1">;(fn as listener).call(target, e)</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">elem.addEventListener(type, agentFn)</span><span class="s3">\n\n            </span><span class="s1">// 缓存代理事件</span><span class="s3">\n            </span><span class="s1">AGENT_EVENTS.push({</span><span class="s3">\n                </span><span class="s1">elem: elem,</span><span class="s3">\n                </span><span class="s1">selector: selector as string,</span><span class="s3">\n                </span><span class="s1">fn: fn as listener,</span><span class="s3">\n                </span><span class="s1">agentFn,</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 解绑事件</span><span class="s3">\n     </span><span class="s1">* @param type 事件类型</span><span class="s3">\n     </span><span class="s1">* @param selector DOM 选择器</span><span class="s3">\n     </span><span class="s1">* @param fn 事件函数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">off(type: string, fn: Function): DomElement</span><span class="s3">\n    </span><span class="s1">off(type: string, selector: string, fn: Function): DomElement</span><span class="s3">\n    </span><span class="s1">off(type: string, selector: string | Function, fn?: Function): DomElement {</span><span class="s3">\n        </span><span class="s1">if (!type) return this</span><span class="s3">\n\n        </span><span class="s1">// 没有 selector ，只有 type 和 fn</span><span class="s3">\n        </span><span class="s1">if (typeof selector === 'function') {</span><span class="s3">\n            </span><span class="s1">fn = selector</span><span class="s3">\n            </span><span class="s1">selector = ''</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">return this.forEach(function (elem: HTMLElement) {</span><span class="s3">\n            </span><span class="s1">// 解绑事件代理</span><span class="s3">\n            </span><span class="s1">if (selector) {</span><span class="s3">\n                </span><span class="s1">let idx = -1</span><span class="s3">\n                </span><span class="s1">for (let i = 0; i &lt; AGENT_EVENTS.length; i++) {</span><span class="s3">\n                    </span><span class="s1">let item = AGENT_EVENTS[i]</span><span class="s3">\n                    </span><span class="s1">if (item.selector === selector &amp;&amp; item.fn === fn &amp;&amp; item.elem === elem) {</span><span class="s3">\n                        </span><span class="s1">idx = i</span><span class="s3">\n                        </span><span class="s1">break</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">if (idx !== -1) {</span><span class="s3">\n                    </span><span class="s1">const { agentFn } = AGENT_EVENTS.splice(idx, 1)[0]</span><span class="s3">\n                    </span><span class="s1">elem.removeEventListener(type, agentFn)</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">// @ts-ignore</span><span class="s3">\n                </span><span class="s1">elem.removeEventListener(type, fn)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 设置/获取 属性</span><span class="s3">\n     </span><span class="s1">* @param key key</span><span class="s3">\n     </span><span class="s1">* @param val value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">attr(key: string): string</span><span class="s3">\n    </span><span class="s1">attr(key: string, val: string): DomElement</span><span class="s3">\n    </span><span class="s1">attr(key: string, val?: string): DomElement | string {</span><span class="s3">\n        </span><span class="s1">if (val == null) {</span><span class="s3">\n            </span><span class="s1">// 获取数据</span><span class="s3">\n            </span><span class="s1">return this.elems[0].getAttribute(key) || ''</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 否则，设置属性</span><span class="s3">\n        </span><span class="s1">return this.forEach(function (elem: HTMLElement) {</span><span class="s3">\n            </span><span class="s1">elem.setAttribute(key, val)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 删除 属性</span><span class="s3">\n     </span><span class="s1">* @param key key</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">removeAttr(key: string): void {</span><span class="s3">\n        </span><span class="s1">this.forEach(function (elem: HTMLElement) {</span><span class="s3">\n            </span><span class="s1">elem.removeAttribute(key)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 添加 css class</span><span class="s3">\n     </span><span class="s1">* @param className css class</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">addClass(className?: string): DomElement {</span><span class="s3">\n        </span><span class="s1">if (!className) {</span><span class="s3">\n            </span><span class="s1">return this</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">return this.forEach(function (elem: HTMLElement) {</span><span class="s3">\n            </span><span class="s1">if (elem.className) {</span><span class="s3">\n                </span><span class="s1">// 当前有 class</span><span class="s3">\n                </span><span class="s1">let arr: string[] = elem.className.split(/</span><span class="s3">\\</span><span class="s1">s/)</span><span class="s3">\n                </span><span class="s1">arr = arr.filter(item =&gt; {</span><span class="s3">\n                    </span><span class="s1">return !!item.trim()</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n                </span><span class="s1">// 添加 class</span><span class="s3">\n                </span><span class="s1">if (arr.indexOf(className) &lt; 0) {</span><span class="s3">\n                    </span><span class="s1">arr.push(className)</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">// 修改 elem.class</span><span class="s3">\n                </span><span class="s1">elem.className = arr.join(' ')</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">// 当前没有 class</span><span class="s3">\n                </span><span class="s1">elem.className = className</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 添加 css class</span><span class="s3">\n     </span><span class="s1">* @param className css class</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">removeClass(className?: string): DomElement {</span><span class="s3">\n        </span><span class="s1">if (!className) {</span><span class="s3">\n            </span><span class="s1">return this</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return this.forEach(function (elem: HTMLElement) {</span><span class="s3">\n            </span><span class="s1">if (!elem.className) {</span><span class="s3">\n                </span><span class="s1">// 当前无 class</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">let arr: string[] = elem.className.split(/</span><span class="s3">\\</span><span class="s1">s/)</span><span class="s3">\n            </span><span class="s1">arr = arr.filter(item =&gt; {</span><span class="s3">\n                </span><span class="s1">item = item.trim()</span><span class="s3">\n                </span><span class="s1">// 删除 class</span><span class="s3">\n                </span><span class="s1">if (!item || item === className) {</span><span class="s3">\n                    </span><span class="s1">return false</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">return true</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">// 修改 elem.class</span><span class="s3">\n            </span><span class="s1">elem.className = arr.join(' ')</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 是否有传入的 css class</span><span class="s3">\n     </span><span class="s1">* @param className css class</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">hasClass(className?: string): boolean {</span><span class="s3">\n        </span><span class="s1">if (!className) {</span><span class="s3">\n            </span><span class="s1">return false</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">if (!elem.className) {</span><span class="s3">\n            </span><span class="s1">// 当前无 class</span><span class="s3">\n            </span><span class="s1">return false</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">let arr: string[] = elem.className.split(/</span><span class="s3">\\</span><span class="s1">s/)</span><span class="s3">\n        </span><span class="s1">return arr.includes(className) // 是否包含</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 修改 css</span><span class="s3">\n     </span><span class="s1">* @param key css key</span><span class="s3">\n     </span><span class="s1">* @param val css value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">// css(key: string): string</span><span class="s3">\n    </span><span class="s1">css(key: string, val?: string | number): DomElement {</span><span class="s3">\n        </span><span class="s1">let currentStyle: string</span><span class="s3">\n        </span><span class="s1">if (val == '') {</span><span class="s3">\n            </span><span class="s1">currentStyle = ''</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">currentStyle = `${key}:${val};`</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return this.forEach(elem =&gt; {</span><span class="s3">\n            </span><span class="s1">const style = (elem.getAttribute('style') || '').trim()</span><span class="s3">\n            </span><span class="s1">if (style) {</span><span class="s3">\n                </span><span class="s1">// 有 style，将 style 按照 `;` 拆分为数组</span><span class="s3">\n                </span><span class="s1">let resultArr: string[] = _styleArrTrim(style)</span><span class="s3">\n\n                </span><span class="s1">// 替换现有的 style</span><span class="s3">\n                </span><span class="s1">resultArr = resultArr.map(item =&gt; {</span><span class="s3">\n                    </span><span class="s1">if (item.indexOf(key) === 0) {</span><span class="s3">\n                        </span><span class="s1">return currentStyle</span><span class="s3">\n                    </span><span class="s1">} else {</span><span class="s3">\n                        </span><span class="s1">return item</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n                </span><span class="s1">// 新增 style</span><span class="s3">\n                </span><span class="s1">if (currentStyle != '' &amp;&amp; resultArr.indexOf(currentStyle) &lt; 0) {</span><span class="s3">\n                    </span><span class="s1">resultArr.push(currentStyle)</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// 去掉 空白</span><span class="s3">\n                </span><span class="s1">if (currentStyle == '') {</span><span class="s3">\n                    </span><span class="s1">resultArr = _styleArrTrim(resultArr)</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// 重新设置 style</span><span class="s3">\n                </span><span class="s1">elem.setAttribute('style', resultArr.join('; '))</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">// 当前没有 style</span><span class="s3">\n                </span><span class="s1">elem.setAttribute('style', currentStyle)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 封装 getBoundingClientRect</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">getBoundingClientRect(): DOMRect {</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">return elem.getBoundingClientRect()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 显示</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">show(): DomElement {</span><span class="s3">\n        </span><span class="s1">return this.css('display', 'block')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 隐藏</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">hide(): DomElement {</span><span class="s3">\n        </span><span class="s1">return this.css('display', 'none')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取子节点（只有 DOM 元素）</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">children(): DomElement | null {</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">if (!elem) {</span><span class="s3">\n            </span><span class="s1">return null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">return $(elem.children)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取子节点（包括文本节点）</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">childNodes(): DomElement | null {</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">if (!elem) {</span><span class="s3">\n            </span><span class="s1">return null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">return $(elem.childNodes)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 将子元素全部替换</span><span class="s3">\n     </span><span class="s1">* @param $children 新的child节点</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">replaceChildAll($children: DomElement): void {</span><span class="s3">\n        </span><span class="s1">const parent = this.getNode()</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">while (elem.hasChildNodes()) {</span><span class="s3">\n            </span><span class="s1">parent.firstChild &amp;&amp; elem.removeChild(parent.firstChild)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">this.append($children)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 增加子节点</span><span class="s3">\n     </span><span class="s1">* @param $children 子节点</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">append($children: DomElement): DomElement {</span><span class="s3">\n        </span><span class="s1">return this.forEach(elem =&gt; {</span><span class="s3">\n            </span><span class="s1">$children.forEach(function (child: HTMLElement) {</span><span class="s3">\n                </span><span class="s1">elem.appendChild(child)</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 移除当前节点</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">remove(): DomElement {</span><span class="s3">\n        </span><span class="s1">return this.forEach(elem =&gt; {</span><span class="s3">\n            </span><span class="s1">if (elem.remove) {</span><span class="s3">\n                </span><span class="s1">elem.remove()</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">const parent = elem.parentElement</span><span class="s3">\n                </span><span class="s1">parent &amp;&amp; parent.removeChild(elem)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 当前元素，是否包含某个子元素</span><span class="s3">\n     </span><span class="s1">* @param $child 子元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">isContain($child: DomElement): boolean {</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">const child = $child.elems[0]</span><span class="s3">\n        </span><span class="s1">return elem.contains(child)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取当前元素 nodeName</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">getNodeName(): string {</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">return elem.nodeName</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 根据元素位置获取元素节点（默认获取0位置的节点）</span><span class="s3">\n     </span><span class="s1">* @param n 元素节点位置</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">getNode(n: number = 0): Node {</span><span class="s3">\n        </span><span class="s1">let elem: Node</span><span class="s3">\n        </span><span class="s1">elem = this.elems[n]</span><span class="s3">\n        </span><span class="s1">return elem</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 查询</span><span class="s3">\n     </span><span class="s1">* @param selector css 选择器</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">find(selector: string): DomElement {</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">return $(elem.querySelectorAll(selector))</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取/设置 元素 text</span><span class="s3">\n     </span><span class="s1">* @param val text 值</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">text(): string</span><span class="s3">\n    </span><span class="s1">text(val: string): DomElement</span><span class="s3">\n    </span><span class="s1">text(val?: string): DomElement | string {</span><span class="s3">\n        </span><span class="s1">if (!val) {</span><span class="s3">\n            </span><span class="s1">// 获取 text</span><span class="s3">\n            </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n\n            </span><span class="s1">return elem.innerHTML.replace(/&lt;[^&gt;]+&gt;/g, () =&gt; '')</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 设置 text</span><span class="s3">\n            </span><span class="s1">return this.forEach(function (elem: HTMLElement) {</span><span class="s3">\n                </span><span class="s1">elem.innerHTML = val</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 设置/获取 元素 html</span><span class="s3">\n     </span><span class="s1">* @param val html 值</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">html(): string</span><span class="s3">\n    </span><span class="s1">html(val: string): DomElement</span><span class="s3">\n    </span><span class="s1">html(val?: string): DomElement | string {</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">if (!val) {</span><span class="s3">\n            </span><span class="s1">// 获取 html</span><span class="s3">\n            </span><span class="s1">return elem.innerHTML</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 设置 html</span><span class="s3">\n            </span><span class="s1">elem.innerHTML = val</span><span class="s3">\n            </span><span class="s1">return this</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取元素 value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">val(): string {</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">return (elem as any).value.trim() // 暂用 any</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* focus 到当前元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">focus(): DomElement {</span><span class="s3">\n        </span><span class="s1">return this.forEach(elem =&gt; {</span><span class="s3">\n            </span><span class="s1">elem.focus()</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 当前元素前一个兄弟节点</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">prev(): DomElement {</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">return $(elem.previousElementSibling)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 当前元素后一个兄弟节点</span><span class="s3">\n     </span><span class="s1">* 不包括文本节点、注释节点）</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">next(): DomElement {</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">return $(elem.nextElementSibling)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取当前节点的下一个兄弟节点</span><span class="s3">\n     </span><span class="s1">* 包括文本节点、注释节点即回车、换行、空格、文本等等）</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">getNextSibling(): DomElement {</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">return $(elem.nextSibling)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取父元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">parent(): DomElement {</span><span class="s3">\n        </span><span class="s1">const elem = this.elems[0]</span><span class="s3">\n        </span><span class="s1">return $(elem.parentElement)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 查找父元素，直到满足 selector 条件</span><span class="s3">\n     </span><span class="s1">* @param selector css 选择器</span><span class="s3">\n     </span><span class="s1">* @param curElem 从哪个元素开始查找，默认为当前元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">parentUntil(selector: string, curElem?: HTMLElement): DomElement | null {</span><span class="s3">\n        </span><span class="s1">const elem = curElem || this.elems[0]</span><span class="s3">\n        </span><span class="s1">if (elem.nodeName === 'BODY') {</span><span class="s3">\n            </span><span class="s1">return null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const parent = elem.parentElement</span><span class="s3">\n        </span><span class="s1">if (parent === null) {</span><span class="s3">\n            </span><span class="s1">return null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (parent.matches(selector)) {</span><span class="s3">\n            </span><span class="s1">// 找到，并返回</span><span class="s3">\n            </span><span class="s1">return $(parent)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 继续查找，递归</span><span class="s3">\n        </span><span class="s1">return this.parentUntil(selector, parent)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 查找父元素，直到满足 selector 条件,或者 到达 编辑区域容器以及菜单栏容器</span><span class="s3">\n     </span><span class="s1">* @param selector css 选择器</span><span class="s3">\n     </span><span class="s1">* @param curElem 从哪个元素开始查找，默认为当前元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">parentUntilEditor(selector: string, editor: Editor, curElem?: HTMLElement): DomElement | null {</span><span class="s3">\n        </span><span class="s1">const elem = curElem || this.elems[0]</span><span class="s3">\n        </span><span class="s1">if ($(elem).equal(editor.$textContainerElem) || $(elem).equal(editor.$toolbarElem)) {</span><span class="s3">\n            </span><span class="s1">return null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const parent = elem.parentElement</span><span class="s3">\n        </span><span class="s1">if (parent === null) {</span><span class="s3">\n            </span><span class="s1">return null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (parent.matches(selector)) {</span><span class="s3">\n            </span><span class="s1">// 找到，并返回</span><span class="s3">\n            </span><span class="s1">return $(parent)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 继续查找，递归</span><span class="s3">\n        </span><span class="s1">return this.parentUntilEditor(selector, editor, parent)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 判读是否相等</span><span class="s3">\n     </span><span class="s1">* @param $elem 元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">equal($elem: DomElement | HTMLElement): boolean {</span><span class="s3">\n        </span><span class="s1">if ($elem instanceof DomElement) {</span><span class="s3">\n            </span><span class="s1">return this.elems[0] === $elem.elems[0]</span><span class="s3">\n        </span><span class="s1">} else if ($elem instanceof HTMLElement) {</span><span class="s3">\n            </span><span class="s1">return this.elems[0] === $elem</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">return false</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 将该元素插入到某个元素前面</span><span class="s3">\n     </span><span class="s1">* @param selector css 选择器</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">insertBefore(selector: string | DomElement): DomElement {</span><span class="s3">\n        </span><span class="s1">const $referenceNode = $(selector)</span><span class="s3">\n        </span><span class="s1">const referenceNode = $referenceNode.elems[0]</span><span class="s3">\n        </span><span class="s1">if (!referenceNode) {</span><span class="s3">\n            </span><span class="s1">return this</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return this.forEach(elem =&gt; {</span><span class="s3">\n            </span><span class="s1">const parent = referenceNode.parentNode as Node</span><span class="s3">\n            </span><span class="s1">parent?.insertBefore(elem, referenceNode)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 将该元素插入到selector元素后面</span><span class="s3">\n     </span><span class="s1">* @param selector css 选择器</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">insertAfter(selector: string | DomElement): DomElement {</span><span class="s3">\n        </span><span class="s1">const $referenceNode = $(selector)</span><span class="s3">\n        </span><span class="s1">const referenceNode = $referenceNode.elems[0]</span><span class="s3">\n        </span><span class="s1">const anchorNode = referenceNode &amp;&amp; referenceNode.nextSibling</span><span class="s3">\n        </span><span class="s1">if (!referenceNode) {</span><span class="s3">\n            </span><span class="s1">return this</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return this.forEach(function (elem: HTMLElement) {</span><span class="s3">\n            </span><span class="s1">const parent = referenceNode.parentNode as Node</span><span class="s3">\n            </span><span class="s1">if (anchorNode) {</span><span class="s3">\n                </span><span class="s1">parent.insertBefore(elem, anchorNode)</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">parent.appendChild(elem)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 设置/获取 数据</span><span class="s3">\n     </span><span class="s1">* @param key key</span><span class="s3">\n     </span><span class="s1">* @param value value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">data&lt;T&gt;(key: string, value?: T): T | undefined {</span><span class="s3">\n        </span><span class="s1">if (value != null) {</span><span class="s3">\n            </span><span class="s1">// 设置数据</span><span class="s3">\n            </span><span class="s1">this.dataSource.set(key, value)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 获取数据</span><span class="s3">\n            </span><span class="s1">return this.dataSource.get(key)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取当前节点的顶级(段落)</span><span class="s3">\n     </span><span class="s1">* @param editor 富文本实例</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">getNodeTop(editor: Editor): DomElement {</span><span class="s3">\n        </span><span class="s1">// 异常抛出，空的 DomElement 直接返回</span><span class="s3">\n        </span><span class="s1">if (this.length &lt; 1) {</span><span class="s3">\n            </span><span class="s1">return this</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 获取父级元素，并判断是否是 编辑区域</span><span class="s3">\n        </span><span class="s1">// 如果是则返回当前节点</span><span class="s3">\n        </span><span class="s1">const $parent = this.parent()</span><span class="s3">\n\n        </span><span class="s1">// fix：添加当前元素与编辑区元素的比较，防止传入的当前元素就是编辑区元素而造成的获取顶级元素为空的情况</span><span class="s3">\n        </span><span class="s1">if (editor.$textElem.equal(this) || editor.$textElem.equal($parent)) {</span><span class="s3">\n            </span><span class="s1">return this</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 到了此处，即代表当前节点不是顶级段落</span><span class="s3">\n        </span><span class="s1">// 将当前节点存放于父节点的 prior 字段下</span><span class="s3">\n        </span><span class="s1">// 主要用于 回溯 子节点</span><span class="s3">\n        </span><span class="s1">// 例如：ul ol 等标签</span><span class="s3">\n        </span><span class="s1">// 实际操作的节点是 li 但是一个 ul ol 的子节点可能有多个</span><span class="s3">\n        </span><span class="s1">// 所以需要对其进行 回溯 找到对应的子节点</span><span class="s3">\n        </span><span class="s1">$parent.prior = this</span><span class="s3">\n        </span><span class="s1">return $parent.getNodeTop(editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取当前 节点 基与上一个拥有相对或者解决定位的父容器的位置</span><span class="s3">\n     </span><span class="s1">* @param editor 富文本实例</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">getOffsetData(): OffsetDataType {</span><span class="s3">\n        </span><span class="s1">const $node = this.elems[0]</span><span class="s3">\n        </span><span class="s1">return {</span><span class="s3">\n            </span><span class="s1">top: $node.offsetTop,</span><span class="s3">\n            </span><span class="s1">left: $node.offsetLeft,</span><span class="s3">\n            </span><span class="s1">width: $node.offsetWidth,</span><span class="s3">\n            </span><span class="s1">height: $node.offsetHeight,</span><span class="s3">\n            </span><span class="s1">parent: $node.offsetParent,</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 从上至下进行滚动</span><span class="s3">\n     </span><span class="s1">* @param top 滚动的值</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">scrollTop(top: number): void {</span><span class="s3">\n        </span><span class="s1">const $node = this.elems[0]</span><span class="s3">\n        </span><span class="s1">$node.scrollTo({ top })</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// new 一个对象</span><span class="s3">\n</span><span class="s1">function $(...arg: ConstructorParameters&lt;typeof DomElement&gt;): DomElement {</span><span class="s3">\n    </span><span class="s1">return new DomElement(...arg)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default $</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/instance/for-each</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;</span><span class="s3">\n</span><span class="s1">var isForced = require('../internals/is-forced');</span><span class="s3">\n</span><span class="s1">var path = require('../internals/path');</span><span class="s3">\n</span><span class="s1">var bind = require('../internals/function-bind-context');</span><span class="s3">\n</span><span class="s1">var createNonEnumerableProperty = require('../internals/create-non-enumerable-property');</span><span class="s3">\n</span><span class="s1">var has = require('../internals/has');</span><span class="s3">\n\n</span><span class="s1">var wrapConstructor = function (NativeConstructor) {</span><span class="s3">\n  </span><span class="s1">var Wrapper = function (a, b, c) {</span><span class="s3">\n    </span><span class="s1">if (this instanceof NativeConstructor) {</span><span class="s3">\n      </span><span class="s1">switch (arguments.length) {</span><span class="s3">\n        </span><span class="s1">case 0: return new NativeConstructor();</span><span class="s3">\n        </span><span class="s1">case 1: return new NativeConstructor(a);</span><span class="s3">\n        </span><span class="s1">case 2: return new NativeConstructor(a, b);</span><span class="s3">\n      </span><span class="s1">} return new NativeConstructor(a, b, c);</span><span class="s3">\n    </span><span class="s1">} return NativeConstructor.apply(this, arguments);</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">Wrapper.prototype = NativeConstructor.prototype;</span><span class="s3">\n  </span><span class="s1">return Wrapper;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">/*</span><span class="s3">\n  </span><span class="s1">options.target      - name of the target object</span><span class="s3">\n  </span><span class="s1">options.global      - target is the global object</span><span class="s3">\n  </span><span class="s1">options.stat        - export as static methods of target</span><span class="s3">\n  </span><span class="s1">options.proto       - export as prototype methods of target</span><span class="s3">\n  </span><span class="s1">options.real        - real prototype method for the `pure` version</span><span class="s3">\n  </span><span class="s1">options.forced      - export even if the native feature is available</span><span class="s3">\n  </span><span class="s1">options.bind        - bind methods to the target, required for the `pure` version</span><span class="s3">\n  </span><span class="s1">options.wrap        - wrap constructors to preventing global pollution, required for the `pure` version</span><span class="s3">\n  </span><span class="s1">options.unsafe      - use the simple assignment of property instead of delete + defineProperty</span><span class="s3">\n  </span><span class="s1">options.sham        - add a flag to not completely full polyfills</span><span class="s3">\n  </span><span class="s1">options.enumerable  - export as enumerable property</span><span class="s3">\n  </span><span class="s1">options.noTargetGet - prevent calling a getter on target</span><span class="s3">\n</span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">module.exports = function (options, source) {</span><span class="s3">\n  </span><span class="s1">var TARGET = options.target;</span><span class="s3">\n  </span><span class="s1">var GLOBAL = options.global;</span><span class="s3">\n  </span><span class="s1">var STATIC = options.stat;</span><span class="s3">\n  </span><span class="s1">var PROTO = options.proto;</span><span class="s3">\n\n  </span><span class="s1">var nativeSource = GLOBAL ? global : STATIC ? global[TARGET] : (global[TARGET] || {}).prototype;</span><span class="s3">\n\n  </span><span class="s1">var target = GLOBAL ? path : path[TARGET] || (path[TARGET] = {});</span><span class="s3">\n  </span><span class="s1">var targetPrototype = target.prototype;</span><span class="s3">\n\n  </span><span class="s1">var FORCED, USE_NATIVE, VIRTUAL_PROTOTYPE;</span><span class="s3">\n  </span><span class="s1">var key, sourceProperty, targetProperty, nativeProperty, resultProperty, descriptor;</span><span class="s3">\n\n  </span><span class="s1">for (key in source) {</span><span class="s3">\n    </span><span class="s1">FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);</span><span class="s3">\n    </span><span class="s1">// contains in native</span><span class="s3">\n    </span><span class="s1">USE_NATIVE = !FORCED &amp;&amp; nativeSource &amp;&amp; has(nativeSource, key);</span><span class="s3">\n\n    </span><span class="s1">targetProperty = target[key];</span><span class="s3">\n\n    </span><span class="s1">if (USE_NATIVE) if (options.noTargetGet) {</span><span class="s3">\n      </span><span class="s1">descriptor = getOwnPropertyDescriptor(nativeSource, key);</span><span class="s3">\n      </span><span class="s1">nativeProperty = descriptor &amp;&amp; descriptor.value;</span><span class="s3">\n    </span><span class="s1">} else nativeProperty = nativeSource[key];</span><span class="s3">\n\n    </span><span class="s1">// export native or implementation</span><span class="s3">\n    </span><span class="s1">sourceProperty = (USE_NATIVE &amp;&amp; nativeProperty) ? nativeProperty : source[key];</span><span class="s3">\n\n    </span><span class="s1">if (USE_NATIVE &amp;&amp; typeof targetProperty === typeof sourceProperty) continue;</span><span class="s3">\n\n    </span><span class="s1">// bind timers to global for call from export context</span><span class="s3">\n    </span><span class="s1">if (options.bind &amp;&amp; USE_NATIVE) resultProperty = bind(sourceProperty, global);</span><span class="s3">\n    </span><span class="s1">// wrap global constructors for prevent changs in this version</span><span class="s3">\n    </span><span class="s1">else if (options.wrap &amp;&amp; USE_NATIVE) resultProperty = wrapConstructor(sourceProperty);</span><span class="s3">\n    </span><span class="s1">// make static versions for prototype methods</span><span class="s3">\n    </span><span class="s1">else if (PROTO &amp;&amp; typeof sourceProperty == 'function') resultProperty = bind(Function.call, sourceProperty);</span><span class="s3">\n    </span><span class="s1">// default case</span><span class="s3">\n    </span><span class="s1">else resultProperty = sourceProperty;</span><span class="s3">\n\n    </span><span class="s1">// add a flag to not completely full polyfills</span><span class="s3">\n    </span><span class="s1">if (options.sham || (sourceProperty &amp;&amp; sourceProperty.sham) || (targetProperty &amp;&amp; targetProperty.sham)) {</span><span class="s3">\n      </span><span class="s1">createNonEnumerableProperty(resultProperty, 'sham', true);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">target[key] = resultProperty;</span><span class="s3">\n\n    </span><span class="s1">if (PROTO) {</span><span class="s3">\n      </span><span class="s1">VIRTUAL_PROTOTYPE = TARGET + 'Prototype';</span><span class="s3">\n      </span><span class="s1">if (!has(path, VIRTUAL_PROTOTYPE)) {</span><span class="s3">\n        </span><span class="s1">createNonEnumerableProperty(path, VIRTUAL_PROTOTYPE, {});</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">// export virtual prototype methods</span><span class="s3">\n      </span><span class="s1">path[VIRTUAL_PROTOTYPE][key] = sourceProperty;</span><span class="s3">\n      </span><span class="s1">// export real prototype methods</span><span class="s3">\n      </span><span class="s1">if (options.real &amp;&amp; targetPrototype &amp;&amp; !targetPrototype[key]) {</span><span class="s3">\n        </span><span class="s1">createNonEnumerableProperty(targetPrototype, key, sourceProperty);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 工具函数集合</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">class NavUA {</span><span class="s3">\n    </span><span class="s1">public _ua: string</span><span class="s3">\n\n    </span><span class="s1">// 是否为旧版 Edge</span><span class="s3">\n    </span><span class="s1">public isOldEdge: boolean</span><span class="s3">\n\n    </span><span class="s1">// 是否为 Firefox</span><span class="s3">\n    </span><span class="s1">public isFirefox: boolean</span><span class="s3">\n\n    </span><span class="s1">constructor() {</span><span class="s3">\n        </span><span class="s1">this._ua = navigator.userAgent</span><span class="s3">\n\n        </span><span class="s1">const math = this._ua.match(/(Edge?)</span><span class="s3">\\</span><span class="s1">/(</span><span class="s3">\\</span><span class="s1">d+)/)</span><span class="s3">\n        </span><span class="s1">this.isOldEdge = math &amp;&amp; math[1] == 'Edge' &amp;&amp; parseInt(math[2]) &lt; 19 ? true : false</span><span class="s3">\n\n        </span><span class="s1">this.isFirefox =</span><span class="s3">\n            </span><span class="s1">/Firefox</span><span class="s3">\\</span><span class="s1">/</span><span class="s3">\\</span><span class="s1">d+/.test(this._ua) &amp;&amp; !/Seamonkey</span><span class="s3">\\</span><span class="s1">/</span><span class="s3">\\</span><span class="s1">d+/.test(this._ua) ? true : false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 是否为 IE</span><span class="s3">\n    </span><span class="s1">public isIE() {</span><span class="s3">\n        </span><span class="s1">return 'ActiveXObject' in window</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 是否为 webkit</span><span class="s3">\n    </span><span class="s1">public isWebkit() {</span><span class="s3">\n        </span><span class="s1">return /webkit/i.test(this._ua)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// 和 UA 相关的属性</span><span class="s3">\n</span><span class="s1">export const UA = new NavUA()</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 获取随机字符</span><span class="s3">\n </span><span class="s1">* @param prefix 前缀</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function getRandom(prefix: string = ''): string {</span><span class="s3">\n    </span><span class="s1">return prefix + Math.random().toString().slice(2)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 替换 html 特殊字符</span><span class="s3">\n </span><span class="s1">* @param html html 字符串</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function replaceHtmlSymbol(html: string) {</span><span class="s3">\n    </span><span class="s1">return html</span><span class="s3">\n        </span><span class="s1">.replace(/&lt;/gm, '&amp;lt;')</span><span class="s3">\n        </span><span class="s1">.replace(/&gt;/gm, '&amp;gt;')</span><span class="s3">\n        </span><span class="s1">.replace(/</span><span class="s3">\&quot;</span><span class="s1">/gm, '&amp;quot;')</span><span class="s3">\n        </span><span class="s1">.replace(/(</span><span class="s3">\\</span><span class="s1">r</span><span class="s3">\\</span><span class="s1">n|</span><span class="s3">\\</span><span class="s1">r|</span><span class="s3">\\</span><span class="s1">n)/g, '&lt;br/&gt;')</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function replaceSpecialSymbol(value: string) {</span><span class="s3">\n    </span><span class="s1">return value</span><span class="s3">\n        </span><span class="s1">.replace(/&amp;lt;/gm, '&lt;')</span><span class="s3">\n        </span><span class="s1">.replace(/&amp;gt;/gm, '&gt;')</span><span class="s3">\n        </span><span class="s1">.replace(/&amp;quot;/gm, '</span><span class="s3">\&quot;</span><span class="s1">')</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">interface Obj {</span><span class="s3">\n    </span><span class="s1">[key: string]: unknown</span><span class="s3">\n    </span><span class="s1">[key: number]: unknown</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">interface ArrObj {</span><span class="s3">\n    </span><span class="s1">length: number</span><span class="s3">\n    </span><span class="s1">[key: number]: unknown</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 遍历对象或数组，执行回调函数</span><span class="s3">\n </span><span class="s1">* @param obj 对象或数组</span><span class="s3">\n </span><span class="s1">* @param fn 回调函数 (key, val) =&gt; {...}</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function forEach&lt;T extends ArrObj, V = T[Extract&lt;keyof T, number&gt;]&gt;(</span><span class="s3">\n    </span><span class="s1">obj: T,</span><span class="s3">\n    </span><span class="s1">fn: (key: string, value: V) =&gt; boolean | void</span><span class="s3">\n</span><span class="s1">): void</span><span class="s3">\n</span><span class="s1">export function forEach&lt;T extends Obj&gt;(</span><span class="s3">\n    </span><span class="s1">obj: T,</span><span class="s3">\n    </span><span class="s1">fn: (key: string, value: T[Extract&lt;keyof T, string | number&gt;]) =&gt; boolean | void</span><span class="s3">\n</span><span class="s1">): void</span><span class="s3">\n</span><span class="s1">export function forEach&lt;T extends unknown[]&gt;(</span><span class="s3">\n    </span><span class="s1">obj: T,</span><span class="s3">\n    </span><span class="s1">fn: (key: string, value: T[Extract&lt;keyof T, number&gt;]) =&gt; boolean | void</span><span class="s3">\n</span><span class="s1">): void</span><span class="s3">\n</span><span class="s1">export function forEach&lt;T extends unknown[] | Obj | ArrObj&gt;(</span><span class="s3">\n    </span><span class="s1">obj: T,</span><span class="s3">\n    </span><span class="s1">fn: (</span><span class="s3">\n        </span><span class="s1">key: string,</span><span class="s3">\n        </span><span class="s1">value: T[Extract&lt;keyof T, number&gt;] | T[Extract&lt;keyof T, string&gt;]</span><span class="s3">\n    </span><span class="s1">) =&gt; boolean | void</span><span class="s3">\n</span><span class="s1">): void {</span><span class="s3">\n    </span><span class="s1">for (let key in obj) {</span><span class="s3">\n        </span><span class="s1">if (Object.prototype.hasOwnProperty.call(obj, key)) {</span><span class="s3">\n            </span><span class="s1">const result = fn(key, obj[key])</span><span class="s3">\n            </span><span class="s1">if (result === false) {</span><span class="s3">\n                </span><span class="s1">// 提前终止循环</span><span class="s3">\n                </span><span class="s1">break</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 遍历类数组</span><span class="s3">\n </span><span class="s1">* @param fakeArr 类数组</span><span class="s3">\n </span><span class="s1">* @param fn 回调函数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function arrForEach&lt;T extends { length: number; [key: number]: unknown }&gt;(</span><span class="s3">\n    </span><span class="s1">fakeArr: T,</span><span class="s3">\n    </span><span class="s1">fn: (this: T, item: T[number], index: number) =&gt; boolean | unknown</span><span class="s3">\n</span><span class="s1">): void {</span><span class="s3">\n    </span><span class="s1">let i, item, result</span><span class="s3">\n    </span><span class="s1">const length = fakeArr.length || 0</span><span class="s3">\n    </span><span class="s1">for (i = 0; i &lt; length; i++) {</span><span class="s3">\n        </span><span class="s1">item = fakeArr[i]</span><span class="s3">\n        </span><span class="s1">result = fn.call(fakeArr, item, i)</span><span class="s3">\n        </span><span class="s1">if (result === false) {</span><span class="s3">\n            </span><span class="s1">break</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 节流</span><span class="s3">\n </span><span class="s1">* @param fn 函数</span><span class="s3">\n </span><span class="s1">* @param interval 间隔时间，毫秒</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">export function throttle&lt;C, T extends unknown[]&gt;(</span><span class="s3">\n    </span><span class="s1">fn: (this: C, ...args: T) =&gt; unknown,</span><span class="s3">\n    </span><span class="s1">interval: number = 200</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">let flag = false</span><span class="s3">\n    </span><span class="s1">return function (this: C, ...args: T): void {</span><span class="s3">\n        </span><span class="s1">if (!flag) {</span><span class="s3">\n            </span><span class="s1">flag = true</span><span class="s3">\n            </span><span class="s1">setTimeout(() =&gt; {</span><span class="s3">\n                </span><span class="s1">flag = false</span><span class="s3">\n                </span><span class="s1">fn.call(this, ...args) // this 报语法错误，先用 null</span><span class="s3">\n            </span><span class="s1">}, interval)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 防抖</span><span class="s3">\n </span><span class="s1">* @param fn 函数</span><span class="s3">\n </span><span class="s1">* @param delay 间隔时间，毫秒</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function debounce&lt;C, T extends unknown[]&gt;(</span><span class="s3">\n    </span><span class="s1">fn: (this: C, ...args: T) =&gt; void,</span><span class="s3">\n    </span><span class="s1">delay: number = 200</span><span class="s3">\n</span><span class="s1">): (this: C, ...args: T) =&gt; void {</span><span class="s3">\n    </span><span class="s1">let lastFn = 0</span><span class="s3">\n    </span><span class="s1">return function (...args: T) {</span><span class="s3">\n        </span><span class="s1">if (lastFn) {</span><span class="s3">\n            </span><span class="s1">window.clearTimeout(lastFn)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">lastFn = window.setTimeout(() =&gt; {</span><span class="s3">\n            </span><span class="s1">lastFn = 0</span><span class="s3">\n            </span><span class="s1">fn.call(this, ...args) // this 报语法错误，先用 null</span><span class="s3">\n        </span><span class="s1">}, delay)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* isFunction 是否是函数</span><span class="s3">\n </span><span class="s1">* @param fn 函数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function isFunction(fn: any): fn is Function {</span><span class="s3">\n    </span><span class="s1">return typeof fn === 'function'</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 引用与非引用值 深拷贝方法</span><span class="s3">\n </span><span class="s1">* @param data</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function deepClone&lt;T&gt;(data: T): T {</span><span class="s3">\n    </span><span class="s1">if (typeof data !== 'object' || typeof data == 'function' || data === null) {</span><span class="s3">\n        </span><span class="s1">return data</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">let item: any</span><span class="s3">\n    </span><span class="s1">if (Array.isArray(data)) {</span><span class="s3">\n        </span><span class="s1">item = []</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (!Array.isArray(data)) {</span><span class="s3">\n        </span><span class="s1">item = {}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">for (let i in data) {</span><span class="s3">\n        </span><span class="s1">if (Object.prototype.hasOwnProperty.call(data, i)) {</span><span class="s3">\n            </span><span class="s1">item[i] = deepClone(data[i])</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return item</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 将可遍历的对象转换为数组</span><span class="s3">\n </span><span class="s1">* @param data 可遍历的对象</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function toArray&lt;T&gt;(data: T) {</span><span class="s3">\n    </span><span class="s1">return Array.prototype.slice.call(data)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 唯一id生成</span><span class="s3">\n </span><span class="s1">* @param length 随机数长度</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function getRandomCode() {</span><span class="s3">\n    </span><span class="s1">return Math.random().toString(36).slice(-5)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* hex color 转换成 rgb</span><span class="s3">\n </span><span class="s1">* @param hex string</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function hexToRgb(hex: string) {</span><span class="s3">\n    </span><span class="s1">const result = /^#?([a-f</span><span class="s3">\\</span><span class="s1">d]{2})([a-f</span><span class="s3">\\</span><span class="s1">d]{2})([a-f</span><span class="s3">\\</span><span class="s1">d]{2})$/i.exec(hex)</span><span class="s3">\n\n    </span><span class="s1">if (result == null) return null</span><span class="s3">\n\n    </span><span class="s1">const colors = result.map(i =&gt; parseInt(i, 16))</span><span class="s3">\n    </span><span class="s1">const r = colors[1]</span><span class="s3">\n    </span><span class="s1">const g = colors[2]</span><span class="s3">\n    </span><span class="s1">const b = colors[3]</span><span class="s3">\n\n    </span><span class="s1">return `rgb(${r}, ${g}, ${b})`</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 常量</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">export function EMPTY_FN() {}</span><span class="s3">\n\n</span><span class="s1">//用于校验是否为url格式字符串</span><span class="s3">\n</span><span class="s1">export const urlRegex = /(http|ftp|https):</span><span class="s3">\\</span><span class="s1">/</span><span class="s3">\\</span><span class="s1">/[</span><span class="s3">\\</span><span class="s1">w</span><span class="s3">\\</span><span class="s1">-_]+(</span><span class="s3">\\</span><span class="s1">.[</span><span class="s3">\\</span><span class="s1">w</span><span class="s3">\\</span><span class="s1">-_]+)+([</span><span class="s3">\\</span><span class="s1">w</span><span class="s3">\\</span><span class="s1">-.,@?^=%&amp;amp;:/~+#]*[</span><span class="s3">\\</span><span class="s1">w</span><span class="s3">\\</span><span class="s1">-@?^=%&amp;amp;/~+#])?/g</span><span class="s3">\n\n</span><span class="s1">// 编辑器为了方便继续输入/换行等原因 主动生成的空标签</span><span class="s3">\n</span><span class="s1">export const EMPTY_P = '&lt;p data-we-empty-p=</span><span class="s3">\&quot;\&quot;</span><span class="s1">&gt;&lt;br&gt;&lt;/p&gt;'</span><span class="s3">\n\n</span><span class="s1">// 用于校验dom中最后 由编辑器主动生成的空标签结构</span><span class="s3">\n</span><span class="s1">export const EMPTY_P_LAST_REGEX = /&lt;p data-we-empty-p=</span><span class="s3">\&quot;\&quot;</span><span class="s1">&gt;&lt;br</span><span class="s3">\\</span><span class="s1">/?&gt;&lt;</span><span class="s3">\\</span><span class="s1">/p&gt;$/gim</span><span class="s3">\n\n</span><span class="s1">// 用于校验dom中所有 由编辑器主动生成的空标签结构</span><span class="s3">\n</span><span class="s1">export const EMPTY_P_REGEX = /&lt;p data-we-empty-p=</span><span class="s3">\&quot;\&quot;</span><span class="s1">&gt;/gim</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var check = function (it) {</span><span class="s3">\n  </span><span class="s1">return it &amp;&amp; it.Math == Math &amp;&amp; it;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028</span><span class="s3">\n</span><span class="s1">module.exports =</span><span class="s3">\n  </span><span class="s1">// eslint-disable-next-line no-undef</span><span class="s3">\n  </span><span class="s1">check(typeof globalThis == 'object' &amp;&amp; globalThis) ||</span><span class="s3">\n  </span><span class="s1">check(typeof window == 'object' &amp;&amp; window) ||</span><span class="s3">\n  </span><span class="s1">check(typeof self == 'object' &amp;&amp; self) ||</span><span class="s3">\n  </span><span class="s1">check(typeof global == 'object' &amp;&amp; global) ||</span><span class="s3">\n  </span><span class="s1">// eslint-disable-next-line no-new-func</span><span class="s3">\n  </span><span class="s1">Function('return this')();</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = {};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var shared = require('../internals/shared');</span><span class="s3">\n</span><span class="s1">var has = require('../internals/has');</span><span class="s3">\n</span><span class="s1">var uid = require('../internals/uid');</span><span class="s3">\n</span><span class="s1">var NATIVE_SYMBOL = require('../internals/native-symbol');</span><span class="s3">\n</span><span class="s1">var USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');</span><span class="s3">\n\n</span><span class="s1">var WellKnownSymbolsStore = shared('wks');</span><span class="s3">\n</span><span class="s1">var Symbol = global.Symbol;</span><span class="s3">\n</span><span class="s1">var createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol : Symbol &amp;&amp; Symbol.withoutSetter || uid;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (name) {</span><span class="s3">\n  </span><span class="s1">if (!has(WellKnownSymbolsStore, name)) {</span><span class="s3">\n    </span><span class="s1">if (NATIVE_SYMBOL &amp;&amp; has(Symbol, name)) WellKnownSymbolsStore[name] = Symbol[name];</span><span class="s3">\n    </span><span class="s1">else WellKnownSymbolsStore[name] = createWellKnownSymbol('Symbol.' + name);</span><span class="s3">\n  </span><span class="s1">} return WellKnownSymbolsStore[name];</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = function (exec) {</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">return !!exec();</span><span class="s3">\n  </span><span class="s1">} catch (error) {</span><span class="s3">\n    </span><span class="s1">return true;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var path = require('../internals/path');</span><span class="s3">\n</span><span class="s1">var has = require('../internals/has');</span><span class="s3">\n</span><span class="s1">var wrappedWellKnownSymbolModule = require('../internals/well-known-symbol-wrapped');</span><span class="s3">\n</span><span class="s1">var defineProperty = require('../internals/object-define-property').f;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (NAME) {</span><span class="s3">\n  </span><span class="s1">var Symbol = path.Symbol || (path.Symbol = {});</span><span class="s3">\n  </span><span class="s1">if (!has(Symbol, NAME)) defineProperty(Symbol, NAME, {</span><span class="s3">\n    </span><span class="s1">value: wrappedWellKnownSymbolModule.f(NAME)</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">return typeof it === 'object' ? it !== null : typeof it === 'function';</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var fails = require('../internals/fails');</span><span class="s3">\n\n</span><span class="s1">// Thank's IE8 for his funny defineProperty</span><span class="s3">\n</span><span class="s1">module.exports = !fails(function () {</span><span class="s3">\n  </span><span class="s1">return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var path = require('../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (CONSTRUCTOR) {</span><span class="s3">\n  </span><span class="s1">return path[CONSTRUCTOR + 'Prototype'];</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var hasOwnProperty = {}.hasOwnProperty;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it, key) {</span><span class="s3">\n  </span><span class="s1">return hasOwnProperty.call(it, key);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/instance/trim</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var DESCRIPTORS = require('../internals/descriptors');</span><span class="s3">\n</span><span class="s1">var IE8_DOM_DEFINE = require('../internals/ie8-dom-define');</span><span class="s3">\n</span><span class="s1">var anObject = require('../internals/an-object');</span><span class="s3">\n</span><span class="s1">var toPrimitive = require('../internals/to-primitive');</span><span class="s3">\n\n</span><span class="s1">var nativeDefineProperty = Object.defineProperty;</span><span class="s3">\n\n</span><span class="s1">// `Object.defineProperty` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.defineproperty</span><span class="s3">\n</span><span class="s1">exports.f = DESCRIPTORS ? nativeDefineProperty : function defineProperty(O, P, Attributes) {</span><span class="s3">\n  </span><span class="s1">anObject(O);</span><span class="s3">\n  </span><span class="s1">P = toPrimitive(P, true);</span><span class="s3">\n  </span><span class="s1">anObject(Attributes);</span><span class="s3">\n  </span><span class="s1">if (IE8_DOM_DEFINE) try {</span><span class="s3">\n    </span><span class="s1">return nativeDefineProperty(O, P, Attributes);</span><span class="s3">\n  </span><span class="s1">} catch (error) { /* empty */ }</span><span class="s3">\n  </span><span class="s1">if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported');</span><span class="s3">\n  </span><span class="s1">if ('value' in Attributes) O[P] = Attributes.value;</span><span class="s3">\n  </span><span class="s1">return O;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var DESCRIPTORS = require('../internals/descriptors');</span><span class="s3">\n</span><span class="s1">var definePropertyModule = require('../internals/object-define-property');</span><span class="s3">\n</span><span class="s1">var createPropertyDescriptor = require('../internals/create-property-descriptor');</span><span class="s3">\n\n</span><span class="s1">module.exports = DESCRIPTORS ? function (object, key, value) {</span><span class="s3">\n  </span><span class="s1">return definePropertyModule.f(object, key, createPropertyDescriptor(1, value));</span><span class="s3">\n</span><span class="s1">} : function (object, key, value) {</span><span class="s3">\n  </span><span class="s1">object[key] = value;</span><span class="s3">\n  </span><span class="s1">return object;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;</span><span class="s3">\&quot;</span><span class="s1">use strict</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n\n</span><span class="s1">var isOldIE = function isOldIE() {</span><span class="s3">\n  </span><span class="s1">var memo;</span><span class="s3">\n  </span><span class="s1">return function memorize() {</span><span class="s3">\n    </span><span class="s1">if (typeof memo === 'undefined') {</span><span class="s3">\n      </span><span class="s1">// Test for IE &lt;= 9 as proposed by Browserhacks</span><span class="s3">\n      </span><span class="s1">// @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805</span><span class="s3">\n      </span><span class="s1">// Tests for existence of standard globals is to allow style-loader</span><span class="s3">\n      </span><span class="s1">// to operate correctly into non-standard environments</span><span class="s3">\n      </span><span class="s1">// @see https://github.com/webpack-contrib/style-loader/issues/177</span><span class="s3">\n      </span><span class="s1">memo = Boolean(window &amp;&amp; document &amp;&amp; document.all &amp;&amp; !window.atob);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return memo;</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">}();</span><span class="s3">\n\n</span><span class="s1">var getTarget = function getTarget() {</span><span class="s3">\n  </span><span class="s1">var memo = {};</span><span class="s3">\n  </span><span class="s1">return function memorize(target) {</span><span class="s3">\n    </span><span class="s1">if (typeof memo[target] === 'undefined') {</span><span class="s3">\n      </span><span class="s1">var styleTarget = document.querySelector(target); // Special case to return head of iframe instead of iframe itself</span><span class="s3">\n\n      </span><span class="s1">if (window.HTMLIFrameElement &amp;&amp; styleTarget instanceof window.HTMLIFrameElement) {</span><span class="s3">\n        </span><span class="s1">try {</span><span class="s3">\n          </span><span class="s1">// This will throw an exception if access to iframe is blocked</span><span class="s3">\n          </span><span class="s1">// due to cross-origin restrictions</span><span class="s3">\n          </span><span class="s1">styleTarget = styleTarget.contentDocument.head;</span><span class="s3">\n        </span><span class="s1">} catch (e) {</span><span class="s3">\n          </span><span class="s1">// istanbul ignore next</span><span class="s3">\n          </span><span class="s1">styleTarget = null;</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">memo[target] = styleTarget;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return memo[target];</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">}();</span><span class="s3">\n\n</span><span class="s1">var stylesInDom = [];</span><span class="s3">\n\n</span><span class="s1">function getIndexByIdentifier(identifier) {</span><span class="s3">\n  </span><span class="s1">var result = -1;</span><span class="s3">\n\n  </span><span class="s1">for (var i = 0; i &lt; stylesInDom.length; i++) {</span><span class="s3">\n    </span><span class="s1">if (stylesInDom[i].identifier === identifier) {</span><span class="s3">\n      </span><span class="s1">result = i;</span><span class="s3">\n      </span><span class="s1">break;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return result;</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function modulesToDom(list, options) {</span><span class="s3">\n  </span><span class="s1">var idCountMap = {};</span><span class="s3">\n  </span><span class="s1">var identifiers = [];</span><span class="s3">\n\n  </span><span class="s1">for (var i = 0; i &lt; list.length; i++) {</span><span class="s3">\n    </span><span class="s1">var item = list[i];</span><span class="s3">\n    </span><span class="s1">var id = options.base ? item[0] + options.base : item[0];</span><span class="s3">\n    </span><span class="s1">var count = idCountMap[id] || 0;</span><span class="s3">\n    </span><span class="s1">var identifier = </span><span class="s3">\&quot;\&quot;</span><span class="s1">.concat(id, </span><span class="s3">\&quot; \&quot;</span><span class="s1">).concat(count);</span><span class="s3">\n    </span><span class="s1">idCountMap[id] = count + 1;</span><span class="s3">\n    </span><span class="s1">var index = getIndexByIdentifier(identifier);</span><span class="s3">\n    </span><span class="s1">var obj = {</span><span class="s3">\n      </span><span class="s1">css: item[1],</span><span class="s3">\n      </span><span class="s1">media: item[2],</span><span class="s3">\n      </span><span class="s1">sourceMap: item[3]</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n\n    </span><span class="s1">if (index !== -1) {</span><span class="s3">\n      </span><span class="s1">stylesInDom[index].references++;</span><span class="s3">\n      </span><span class="s1">stylesInDom[index].updater(obj);</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">stylesInDom.push({</span><span class="s3">\n        </span><span class="s1">identifier: identifier,</span><span class="s3">\n        </span><span class="s1">updater: addStyle(obj, options),</span><span class="s3">\n        </span><span class="s1">references: 1</span><span class="s3">\n      </span><span class="s1">});</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">identifiers.push(identifier);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return identifiers;</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function insertStyleElement(options) {</span><span class="s3">\n  </span><span class="s1">var style = document.createElement('style');</span><span class="s3">\n  </span><span class="s1">var attributes = options.attributes || {};</span><span class="s3">\n\n  </span><span class="s1">if (typeof attributes.nonce === 'undefined') {</span><span class="s3">\n    </span><span class="s1">var nonce = typeof __webpack_nonce__ !== 'undefined' ? __webpack_nonce__ : null;</span><span class="s3">\n\n    </span><span class="s1">if (nonce) {</span><span class="s3">\n      </span><span class="s1">attributes.nonce = nonce;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">Object.keys(attributes).forEach(function (key) {</span><span class="s3">\n    </span><span class="s1">style.setAttribute(key, attributes[key]);</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n\n  </span><span class="s1">if (typeof options.insert === 'function') {</span><span class="s3">\n    </span><span class="s1">options.insert(style);</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">var target = getTarget(options.insert || 'head');</span><span class="s3">\n\n    </span><span class="s1">if (!target) {</span><span class="s3">\n      </span><span class="s1">throw new Error(</span><span class="s3">\&quot;</span><span class="s1">Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">target.appendChild(style);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return style;</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function removeStyleElement(style) {</span><span class="s3">\n  </span><span class="s1">// istanbul ignore if</span><span class="s3">\n  </span><span class="s1">if (style.parentNode === null) {</span><span class="s3">\n    </span><span class="s1">return false;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">style.parentNode.removeChild(style);</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">/* istanbul ignore next  */</span><span class="s3">\n\n\n</span><span class="s1">var replaceText = function replaceText() {</span><span class="s3">\n  </span><span class="s1">var textStore = [];</span><span class="s3">\n  </span><span class="s1">return function replace(index, replacement) {</span><span class="s3">\n    </span><span class="s1">textStore[index] = replacement;</span><span class="s3">\n    </span><span class="s1">return textStore.filter(Boolean).join('</span><span class="s3">\\</span><span class="s1">n');</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">}();</span><span class="s3">\n\n</span><span class="s1">function applyToSingletonTag(style, index, remove, obj) {</span><span class="s3">\n  </span><span class="s1">var css = remove ? '' : obj.media ? </span><span class="s3">\&quot;</span><span class="s1">@media </span><span class="s3">\&quot;</span><span class="s1">.concat(obj.media, </span><span class="s3">\&quot; </span><span class="s1">{</span><span class="s3">\&quot;</span><span class="s1">).concat(obj.css, </span><span class="s3">\&quot;</span><span class="s1">}</span><span class="s3">\&quot;</span><span class="s1">) : obj.css; // For old IE</span><span class="s3">\n\n  </span><span class="s1">/* istanbul ignore if  */</span><span class="s3">\n\n  </span><span class="s1">if (style.styleSheet) {</span><span class="s3">\n    </span><span class="s1">style.styleSheet.cssText = replaceText(index, css);</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">var cssNode = document.createTextNode(css);</span><span class="s3">\n    </span><span class="s1">var childNodes = style.childNodes;</span><span class="s3">\n\n    </span><span class="s1">if (childNodes[index]) {</span><span class="s3">\n      </span><span class="s1">style.removeChild(childNodes[index]);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (childNodes.length) {</span><span class="s3">\n      </span><span class="s1">style.insertBefore(cssNode, childNodes[index]);</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">style.appendChild(cssNode);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function applyToTag(style, options, obj) {</span><span class="s3">\n  </span><span class="s1">var css = obj.css;</span><span class="s3">\n  </span><span class="s1">var media = obj.media;</span><span class="s3">\n  </span><span class="s1">var sourceMap = obj.sourceMap;</span><span class="s3">\n\n  </span><span class="s1">if (media) {</span><span class="s3">\n    </span><span class="s1">style.setAttribute('media', media);</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">style.removeAttribute('media');</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (sourceMap &amp;&amp; typeof btoa !== 'undefined') {</span><span class="s3">\n    </span><span class="s1">css += </span><span class="s3">\&quot;\\</span><span class="s1">n/*# sourceMappingURL=data:application/json;base64,</span><span class="s3">\&quot;</span><span class="s1">.concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), </span><span class="s3">\&quot; </span><span class="s1">*/</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n  </span><span class="s1">} // For old IE</span><span class="s3">\n\n  </span><span class="s1">/* istanbul ignore if  */</span><span class="s3">\n\n\n  </span><span class="s1">if (style.styleSheet) {</span><span class="s3">\n    </span><span class="s1">style.styleSheet.cssText = css;</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">while (style.firstChild) {</span><span class="s3">\n      </span><span class="s1">style.removeChild(style.firstChild);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">style.appendChild(document.createTextNode(css));</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">var singleton = null;</span><span class="s3">\n</span><span class="s1">var singletonCounter = 0;</span><span class="s3">\n\n</span><span class="s1">function addStyle(obj, options) {</span><span class="s3">\n  </span><span class="s1">var style;</span><span class="s3">\n  </span><span class="s1">var update;</span><span class="s3">\n  </span><span class="s1">var remove;</span><span class="s3">\n\n  </span><span class="s1">if (options.singleton) {</span><span class="s3">\n    </span><span class="s1">var styleIndex = singletonCounter++;</span><span class="s3">\n    </span><span class="s1">style = singleton || (singleton = insertStyleElement(options));</span><span class="s3">\n    </span><span class="s1">update = applyToSingletonTag.bind(null, style, styleIndex, false);</span><span class="s3">\n    </span><span class="s1">remove = applyToSingletonTag.bind(null, style, styleIndex, true);</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">style = insertStyleElement(options);</span><span class="s3">\n    </span><span class="s1">update = applyToTag.bind(null, style, options);</span><span class="s3">\n\n    </span><span class="s1">remove = function remove() {</span><span class="s3">\n      </span><span class="s1">removeStyleElement(style);</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">update(obj);</span><span class="s3">\n  </span><span class="s1">return function updateStyle(newObj) {</span><span class="s3">\n    </span><span class="s1">if (newObj) {</span><span class="s3">\n      </span><span class="s1">if (newObj.css === obj.css &amp;&amp; newObj.media === obj.media &amp;&amp; newObj.sourceMap === obj.sourceMap) {</span><span class="s3">\n        </span><span class="s1">return;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">update(obj = newObj);</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">remove();</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">module.exports = function (list, options) {</span><span class="s3">\n  </span><span class="s1">options = options || {}; // Force single-tag solution on IE6-9, which has a hard limit on the # of &lt;style&gt;</span><span class="s3">\n  </span><span class="s1">// tags it will allow on a page</span><span class="s3">\n\n  </span><span class="s1">if (!options.singleton &amp;&amp; typeof options.singleton !== 'boolean') {</span><span class="s3">\n    </span><span class="s1">options.singleton = isOldIE();</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">list = list || [];</span><span class="s3">\n  </span><span class="s1">var lastIdentifiers = modulesToDom(list, options);</span><span class="s3">\n  </span><span class="s1">return function update(newList) {</span><span class="s3">\n    </span><span class="s1">newList = newList || [];</span><span class="s3">\n\n    </span><span class="s1">if (Object.prototype.toString.call(newList) !== '[object Array]') {</span><span class="s3">\n      </span><span class="s1">return;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">for (var i = 0; i &lt; lastIdentifiers.length; i++) {</span><span class="s3">\n      </span><span class="s1">var identifier = lastIdentifiers[i];</span><span class="s3">\n      </span><span class="s1">var index = getIndexByIdentifier(identifier);</span><span class="s3">\n      </span><span class="s1">stylesInDom[index].references--;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">var newLastIdentifiers = modulesToDom(newList, options);</span><span class="s3">\n\n    </span><span class="s1">for (var _i = 0; _i &lt; lastIdentifiers.length; _i++) {</span><span class="s3">\n      </span><span class="s1">var _identifier = lastIdentifiers[_i];</span><span class="s3">\n\n      </span><span class="s1">var _index = getIndexByIdentifier(_identifier);</span><span class="s3">\n\n      </span><span class="s1">if (stylesInDom[_index].references === 0) {</span><span class="s3">\n        </span><span class="s1">stylesInDom[_index].updater();</span><span class="s3">\n\n        </span><span class="s1">stylesInDom.splice(_index, 1);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">lastIdentifiers = newLastIdentifiers;</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">};&quot;</span><span class="s0">,</span><span class="s1">&quot;</span><span class="s3">\&quot;</span><span class="s1">use strict</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n\n</span><span class="s1">/*</span><span class="s3">\n  </span><span class="s1">MIT License http://www.opensource.org/licenses/mit-license.php</span><span class="s3">\n  </span><span class="s1">Author Tobias Koppers @sokra</span><span class="s3">\n</span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">// css base code, injected by the css-loader</span><span class="s3">\n</span><span class="s1">// eslint-disable-next-line func-names</span><span class="s3">\n</span><span class="s1">module.exports = function (useSourceMap) {</span><span class="s3">\n  </span><span class="s1">var list = []; // return the list of modules as css string</span><span class="s3">\n\n  </span><span class="s1">list.toString = function toString() {</span><span class="s3">\n    </span><span class="s1">return this.map(function (item) {</span><span class="s3">\n      </span><span class="s1">var content = cssWithMappingToString(item, useSourceMap);</span><span class="s3">\n\n      </span><span class="s1">if (item[2]) {</span><span class="s3">\n        </span><span class="s1">return </span><span class="s3">\&quot;</span><span class="s1">@media </span><span class="s3">\&quot;</span><span class="s1">.concat(item[2], </span><span class="s3">\&quot; </span><span class="s1">{</span><span class="s3">\&quot;</span><span class="s1">).concat(content, </span><span class="s3">\&quot;</span><span class="s1">}</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">return content;</span><span class="s3">\n    </span><span class="s1">}).join('');</span><span class="s3">\n  </span><span class="s1">}; // import a list of modules into the list</span><span class="s3">\n  </span><span class="s1">// eslint-disable-next-line func-names</span><span class="s3">\n\n\n  </span><span class="s1">list.i = function (modules, mediaQuery, dedupe) {</span><span class="s3">\n    </span><span class="s1">if (typeof modules === 'string') {</span><span class="s3">\n      </span><span class="s1">// eslint-disable-next-line no-param-reassign</span><span class="s3">\n      </span><span class="s1">modules = [[null, modules, '']];</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">var alreadyImportedModules = {};</span><span class="s3">\n\n    </span><span class="s1">if (dedupe) {</span><span class="s3">\n      </span><span class="s1">for (var i = 0; i &lt; this.length; i++) {</span><span class="s3">\n        </span><span class="s1">// eslint-disable-next-line prefer-destructuring</span><span class="s3">\n        </span><span class="s1">var id = this[i][0];</span><span class="s3">\n\n        </span><span class="s1">if (id != null) {</span><span class="s3">\n          </span><span class="s1">alreadyImportedModules[id] = true;</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">for (var _i = 0; _i &lt; modules.length; _i++) {</span><span class="s3">\n      </span><span class="s1">var item = [].concat(modules[_i]);</span><span class="s3">\n\n      </span><span class="s1">if (dedupe &amp;&amp; alreadyImportedModules[item[0]]) {</span><span class="s3">\n        </span><span class="s1">// eslint-disable-next-line no-continue</span><span class="s3">\n        </span><span class="s1">continue;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (mediaQuery) {</span><span class="s3">\n        </span><span class="s1">if (!item[2]) {</span><span class="s3">\n          </span><span class="s1">item[2] = mediaQuery;</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n          </span><span class="s1">item[2] = </span><span class="s3">\&quot;\&quot;</span><span class="s1">.concat(mediaQuery, </span><span class="s3">\&quot; </span><span class="s1">and </span><span class="s3">\&quot;</span><span class="s1">).concat(item[2]);</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">list.push(item);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n\n  </span><span class="s1">return list;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">function cssWithMappingToString(item, useSourceMap) {</span><span class="s3">\n  </span><span class="s1">var content = item[1] || ''; // eslint-disable-next-line prefer-destructuring</span><span class="s3">\n\n  </span><span class="s1">var cssMapping = item[3];</span><span class="s3">\n\n  </span><span class="s1">if (!cssMapping) {</span><span class="s3">\n    </span><span class="s1">return content;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (useSourceMap &amp;&amp; typeof btoa === 'function') {</span><span class="s3">\n    </span><span class="s1">var sourceMapping = toComment(cssMapping);</span><span class="s3">\n    </span><span class="s1">var sourceURLs = cssMapping.sources.map(function (source) {</span><span class="s3">\n      </span><span class="s1">return </span><span class="s3">\&quot;</span><span class="s1">/*# sourceURL=</span><span class="s3">\&quot;</span><span class="s1">.concat(cssMapping.sourceRoot || '').concat(source, </span><span class="s3">\&quot; </span><span class="s1">*/</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n    </span><span class="s1">return [content].concat(sourceURLs).concat([sourceMapping]).join('</span><span class="s3">\\</span><span class="s1">n');</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return [content].join('</span><span class="s3">\\</span><span class="s1">n');</span><span class="s3">\n</span><span class="s1">} // Adapted from convert-source-map (MIT)</span><span class="s3">\n\n\n</span><span class="s1">function toComment(sourceMap) {</span><span class="s3">\n  </span><span class="s1">// eslint-disable-next-line no-undef</span><span class="s3">\n  </span><span class="s1">var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));</span><span class="s3">\n  </span><span class="s1">var data = </span><span class="s3">\&quot;</span><span class="s1">sourceMappingURL=data:application/json;charset=utf-8;base64,</span><span class="s3">\&quot;</span><span class="s1">.concat(base64);</span><span class="s3">\n  </span><span class="s1">return </span><span class="s3">\&quot;</span><span class="s1">/*# </span><span class="s3">\&quot;</span><span class="s1">.concat(data, </span><span class="s3">\&quot; </span><span class="s1">*/</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">}&quot;</span><span class="s0">,</span><span class="s1">&quot;var DESCRIPTORS = require('../internals/descriptors');</span><span class="s3">\n</span><span class="s1">var fails = require('../internals/fails');</span><span class="s3">\n</span><span class="s1">var has = require('../internals/has');</span><span class="s3">\n\n</span><span class="s1">var defineProperty = Object.defineProperty;</span><span class="s3">\n</span><span class="s1">var cache = {};</span><span class="s3">\n\n</span><span class="s1">var thrower = function (it) { throw it; };</span><span class="s3">\n\n</span><span class="s1">module.exports = function (METHOD_NAME, options) {</span><span class="s3">\n  </span><span class="s1">if (has(cache, METHOD_NAME)) return cache[METHOD_NAME];</span><span class="s3">\n  </span><span class="s1">if (!options) options = {};</span><span class="s3">\n  </span><span class="s1">var method = [][METHOD_NAME];</span><span class="s3">\n  </span><span class="s1">var ACCESSORS = has(options, 'ACCESSORS') ? options.ACCESSORS : false;</span><span class="s3">\n  </span><span class="s1">var argument0 = has(options, 0) ? options[0] : thrower;</span><span class="s3">\n  </span><span class="s1">var argument1 = has(options, 1) ? options[1] : undefined;</span><span class="s3">\n\n  </span><span class="s1">return cache[METHOD_NAME] = !!method &amp;&amp; !fails(function () {</span><span class="s3">\n    </span><span class="s1">if (ACCESSORS &amp;&amp; !DESCRIPTORS) return true;</span><span class="s3">\n    </span><span class="s1">var O = { length: -1 };</span><span class="s3">\n\n    </span><span class="s1">if (ACCESSORS) defineProperty(O, 1, { enumerable: true, get: thrower });</span><span class="s3">\n    </span><span class="s1">else O[1] = 1;</span><span class="s3">\n\n    </span><span class="s1">method.call(O, argument0, argument1);</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 按钮菜单 Class</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import Menu from './Menu'</span><span class="s3">\n\n</span><span class="s1">class BtnMenu extends Menu {</span><span class="s3">\n    </span><span class="s1">constructor($elem: DomElement, editor: Editor) {</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default BtnMenu</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 下拉菜单 Class</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import Menu from './Menu'</span><span class="s3">\n</span><span class="s1">import DropList, { DropListConf } from './DropList'</span><span class="s3">\n\n</span><span class="s1">class DropListMenu extends Menu {</span><span class="s3">\n    </span><span class="s1">public dropList: DropList</span><span class="s3">\n\n    </span><span class="s1">constructor($elem: DomElement, editor: Editor, conf: DropListConf) {</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n\n        </span><span class="s1">// 国际化</span><span class="s3">\n        </span><span class="s1">conf.title = editor.i18next.t(`menus.dropListMenu.${conf.title}`)</span><span class="s3">\n\n        </span><span class="s1">// 非中文模式下 带 icon 的下拉列表居左</span><span class="s3">\n        </span><span class="s1">const className: string = editor.config.lang === 'zh-CN' ? '' : 'w-e-drop-list-tl'</span><span class="s3">\n        </span><span class="s1">if (className !== '' &amp;&amp; conf.type === 'list') {</span><span class="s3">\n            </span><span class="s1">conf.list.forEach(item =&gt; {</span><span class="s3">\n                </span><span class="s1">const $elem = item.$elem</span><span class="s3">\n                </span><span class="s1">const $children = $($elem.children())</span><span class="s3">\n                </span><span class="s1">if ($children.length &gt; 0) {</span><span class="s3">\n                    </span><span class="s1">const nodeName = $children?.getNodeName()</span><span class="s3">\n                    </span><span class="s1">if (nodeName &amp;&amp; nodeName === 'I') {</span><span class="s3">\n                        </span><span class="s1">$elem.addClass(className)</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 初始化 dropList</span><span class="s3">\n        </span><span class="s1">const dropList = new DropList(this, conf)</span><span class="s3">\n        </span><span class="s1">this.dropList = dropList</span><span class="s3">\n\n        </span><span class="s1">// 绑定事件</span><span class="s3">\n        </span><span class="s1">$elem</span><span class="s3">\n            </span><span class="s1">.on('click', () =&gt; {</span><span class="s3">\n                </span><span class="s1">if (editor.selection.getRange() == null) {</span><span class="s3">\n                    </span><span class="s1">return</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">$elem.css('z-index', editor.zIndex.get('menu'))</span><span class="s3">\n                </span><span class="s1">// 触发 droplist 悬浮事件</span><span class="s3">\n                </span><span class="s1">editor.txt.eventHooks.dropListMenuHoverEvents.forEach(fn =&gt; fn())</span><span class="s3">\n                </span><span class="s1">// 显示</span><span class="s3">\n                </span><span class="s1">dropList.show()</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">.on('mouseleave', () =&gt; {</span><span class="s3">\n                </span><span class="s1">$elem.css('z-index', 'auto')</span><span class="s3">\n                </span><span class="s1">// 隐藏</span><span class="s3">\n                </span><span class="s1">dropList.hideTimeoutId = window.setTimeout(() =&gt; {</span><span class="s3">\n                    </span><span class="s1">dropList.hide()</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default DropListMenu</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var isObject = require('../internals/is-object');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">if (!isObject(it)) {</span><span class="s3">\n    </span><span class="s1">throw TypeError(String(it) + ' is not an object');</span><span class="s3">\n  </span><span class="s1">} return it;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/instance/map</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/instance/index-of</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/instance/includes</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/instance/find</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;// toObject with fallback for non-array-like ES3 strings</span><span class="s3">\n</span><span class="s1">var IndexedObject = require('../internals/indexed-object');</span><span class="s3">\n</span><span class="s1">var requireObjectCoercible = require('../internals/require-object-coercible');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">return IndexedObject(requireObjectCoercible(it));</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var requireObjectCoercible = require('../internals/require-object-coercible');</span><span class="s3">\n\n</span><span class="s1">// `ToObject` abstract operation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-toobject</span><span class="s3">\n</span><span class="s1">module.exports = function (argument) {</span><span class="s3">\n  </span><span class="s1">return Object(requireObjectCoercible(argument));</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var bind = require('../internals/function-bind-context');</span><span class="s3">\n</span><span class="s1">var IndexedObject = require('../internals/indexed-object');</span><span class="s3">\n</span><span class="s1">var toObject = require('../internals/to-object');</span><span class="s3">\n</span><span class="s1">var toLength = require('../internals/to-length');</span><span class="s3">\n</span><span class="s1">var arraySpeciesCreate = require('../internals/array-species-create');</span><span class="s3">\n\n</span><span class="s1">var push = [].push;</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.{ forEach, map, filter, some, every, find, findIndex }` methods implementation</span><span class="s3">\n</span><span class="s1">var createMethod = function (TYPE) {</span><span class="s3">\n  </span><span class="s1">var IS_MAP = TYPE == 1;</span><span class="s3">\n  </span><span class="s1">var IS_FILTER = TYPE == 2;</span><span class="s3">\n  </span><span class="s1">var IS_SOME = TYPE == 3;</span><span class="s3">\n  </span><span class="s1">var IS_EVERY = TYPE == 4;</span><span class="s3">\n  </span><span class="s1">var IS_FIND_INDEX = TYPE == 6;</span><span class="s3">\n  </span><span class="s1">var NO_HOLES = TYPE == 5 || IS_FIND_INDEX;</span><span class="s3">\n  </span><span class="s1">return function ($this, callbackfn, that, specificCreate) {</span><span class="s3">\n    </span><span class="s1">var O = toObject($this);</span><span class="s3">\n    </span><span class="s1">var self = IndexedObject(O);</span><span class="s3">\n    </span><span class="s1">var boundFunction = bind(callbackfn, that, 3);</span><span class="s3">\n    </span><span class="s1">var length = toLength(self.length);</span><span class="s3">\n    </span><span class="s1">var index = 0;</span><span class="s3">\n    </span><span class="s1">var create = specificCreate || arraySpeciesCreate;</span><span class="s3">\n    </span><span class="s1">var target = IS_MAP ? create($this, length) : IS_FILTER ? create($this, 0) : undefined;</span><span class="s3">\n    </span><span class="s1">var value, result;</span><span class="s3">\n    </span><span class="s1">for (;length &gt; index; index++) if (NO_HOLES || index in self) {</span><span class="s3">\n      </span><span class="s1">value = self[index];</span><span class="s3">\n      </span><span class="s1">result = boundFunction(value, index, O);</span><span class="s3">\n      </span><span class="s1">if (TYPE) {</span><span class="s3">\n        </span><span class="s1">if (IS_MAP) target[index] = result; // map</span><span class="s3">\n        </span><span class="s1">else if (result) switch (TYPE) {</span><span class="s3">\n          </span><span class="s1">case 3: return true;              // some</span><span class="s3">\n          </span><span class="s1">case 5: return value;             // find</span><span class="s3">\n          </span><span class="s1">case 6: return index;             // findIndex</span><span class="s3">\n          </span><span class="s1">case 2: push.call(target, value); // filter</span><span class="s3">\n        </span><span class="s1">} else if (IS_EVERY) return false;  // every</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : target;</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">module.exports = {</span><span class="s3">\n  </span><span class="s1">// `Array.prototype.forEach` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.foreach</span><span class="s3">\n  </span><span class="s1">forEach: createMethod(0),</span><span class="s3">\n  </span><span class="s1">// `Array.prototype.map` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.map</span><span class="s3">\n  </span><span class="s1">map: createMethod(1),</span><span class="s3">\n  </span><span class="s1">// `Array.prototype.filter` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.filter</span><span class="s3">\n  </span><span class="s1">filter: createMethod(2),</span><span class="s3">\n  </span><span class="s1">// `Array.prototype.some` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.some</span><span class="s3">\n  </span><span class="s1">some: createMethod(3),</span><span class="s3">\n  </span><span class="s1">// `Array.prototype.every` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.every</span><span class="s3">\n  </span><span class="s1">every: createMethod(4),</span><span class="s3">\n  </span><span class="s1">// `Array.prototype.find` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.find</span><span class="s3">\n  </span><span class="s1">find: createMethod(5),</span><span class="s3">\n  </span><span class="s1">// `Array.prototype.findIndex` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.findIndex</span><span class="s3">\n  </span><span class="s1">findIndex: createMethod(6)</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description panel class</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import PanelMenu from './PanelMenu'</span><span class="s3">\n</span><span class="s1">import { EMPTY_FN } from '../../utils/const'</span><span class="s3">\n\n</span><span class="s1">// Panel 配置格式</span><span class="s3">\n</span><span class="s1">export type TabEventConf = {</span><span class="s3">\n    </span><span class="s1">selector: string</span><span class="s3">\n    </span><span class="s1">type: string</span><span class="s3">\n    </span><span class="s1">fn: Function</span><span class="s3">\n    </span><span class="s1">bindEnter?: Boolean</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">export type PanelTabConf = {</span><span class="s3">\n    </span><span class="s1">title: string</span><span class="s3">\n    </span><span class="s1">tpl: string</span><span class="s3">\n    </span><span class="s1">events: TabEventConf[]</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">export type PanelConf = {</span><span class="s3">\n    </span><span class="s1">width: number | 0</span><span class="s3">\n    </span><span class="s1">height: number | 0</span><span class="s3">\n    </span><span class="s1">tabs: PanelTabConf[]</span><span class="s3">\n    </span><span class="s1">setLinkValue?: ($container: DomElement, type: string) =&gt; void</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">class Panel {</span><span class="s3">\n    </span><span class="s1">// 记录已经创建过的 panelMenu</span><span class="s3">\n    </span><span class="s1">static createdMenus: Set&lt;PanelMenu&gt; = new Set()</span><span class="s3">\n\n    </span><span class="s1">private menu: PanelMenu</span><span class="s3">\n    </span><span class="s1">private conf: PanelConf</span><span class="s3">\n    </span><span class="s1">public $container: DomElement</span><span class="s3">\n\n    </span><span class="s1">constructor(menu: PanelMenu, conf: PanelConf) {</span><span class="s3">\n        </span><span class="s1">this.menu = menu</span><span class="s3">\n        </span><span class="s1">this.conf = conf</span><span class="s3">\n        </span><span class="s1">this.$container = $('&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-panel-container</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/div&gt;')</span><span class="s3">\n\n        </span><span class="s1">// 隐藏 panel</span><span class="s3">\n        </span><span class="s1">const editor = menu.editor</span><span class="s3">\n        </span><span class="s1">editor.txt.eventHooks.clickEvents.push(Panel.hideCurAllPanels)</span><span class="s3">\n        </span><span class="s1">editor.txt.eventHooks.toolbarClickEvents.push(Panel.hideCurAllPanels)</span><span class="s3">\n        </span><span class="s1">editor.txt.eventHooks.dropListMenuHoverEvents.push(Panel.hideCurAllPanels)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 创建并展示 panel</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public create(): void {</span><span class="s3">\n        </span><span class="s1">const menu = this.menu</span><span class="s3">\n        </span><span class="s1">if (Panel.createdMenus.has(menu)) {</span><span class="s3">\n            </span><span class="s1">// 创建过了</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const conf = this.conf</span><span class="s3">\n\n        </span><span class="s1">// panel 的容器</span><span class="s3">\n        </span><span class="s1">const $container = this.$container</span><span class="s3">\n        </span><span class="s1">const width = conf.width || 300 // 默认 300px</span><span class="s3">\n        </span><span class="s1">const rect = menu.editor.$toolbarElem.getBoundingClientRect()</span><span class="s3">\n        </span><span class="s1">const menuRect = menu.$elem.getBoundingClientRect()</span><span class="s3">\n        </span><span class="s1">const top = rect.height + rect.top - menuRect.top</span><span class="s3">\n        </span><span class="s1">let left = (rect.width - width) / 2 + rect.left - menuRect.left</span><span class="s3">\n        </span><span class="s1">const offset = 300 // icon与panel菜单距离偏移量暂定 300</span><span class="s3">\n        </span><span class="s1">if (Math.abs(left) &gt; offset) {</span><span class="s3">\n            </span><span class="s1">// panel菜单离工具栏icon过远时，让panel菜单出现在icon正下方，处理边界逻辑</span><span class="s3">\n            </span><span class="s1">if (menuRect.left &lt; document.documentElement.clientWidth / 2) {</span><span class="s3">\n                </span><span class="s1">// icon在左侧</span><span class="s3">\n                </span><span class="s1">left = -menuRect.width / 2</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">// icon在右侧</span><span class="s3">\n                </span><span class="s1">left = -width + menuRect.width / 2</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">$container</span><span class="s3">\n            </span><span class="s1">.css('width', width + 'px')</span><span class="s3">\n            </span><span class="s1">.css('margin-top', `${top}px`)</span><span class="s3">\n            </span><span class="s1">.css('margin-left', `${left}px`)</span><span class="s3">\n            </span><span class="s1">.css('z-index', menu.editor.zIndex.get('panel'))</span><span class="s3">\n\n        </span><span class="s1">// 添加关闭按钮</span><span class="s3">\n        </span><span class="s1">const $closeBtn = $('&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-close w-e-panel-close</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;')</span><span class="s3">\n        </span><span class="s1">$container.append($closeBtn)</span><span class="s3">\n        </span><span class="s1">$closeBtn.on('click', () =&gt; {</span><span class="s3">\n            </span><span class="s1">this.remove()</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// 准备 tabs 容器</span><span class="s3">\n        </span><span class="s1">const $tabTitleContainer = $('&lt;ul class=</span><span class="s3">\&quot;</span><span class="s1">w-e-panel-tab-title</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/ul&gt;')</span><span class="s3">\n        </span><span class="s1">const $tabContentContainer = $('&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-panel-tab-content</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/div&gt;')</span><span class="s3">\n        </span><span class="s1">$container.append($tabTitleContainer).append($tabContentContainer)</span><span class="s3">\n\n        </span><span class="s1">// 设置高度</span><span class="s3">\n        </span><span class="s1">const height = conf.height // height: 0 即不用设置</span><span class="s3">\n        </span><span class="s1">if (height) {</span><span class="s3">\n            </span><span class="s1">$tabContentContainer.css('height', height + 'px').css('overflow-y', 'auto')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// tabs</span><span class="s3">\n        </span><span class="s1">const tabs = conf.tabs || []</span><span class="s3">\n        </span><span class="s1">const tabTitleArr: DomElement[] = []</span><span class="s3">\n        </span><span class="s1">const tabContentArr: DomElement[] = []</span><span class="s3">\n\n        </span><span class="s1">tabs.forEach((tab: PanelTabConf, tabIndex: number) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (!tab) {</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">const title = tab.title || ''</span><span class="s3">\n            </span><span class="s1">const tpl = tab.tpl || ''</span><span class="s3">\n\n            </span><span class="s1">// 添加到 DOM</span><span class="s3">\n            </span><span class="s1">const $title = $(`&lt;li class=</span><span class="s3">\&quot;</span><span class="s1">w-e-item</span><span class="s3">\&quot;</span><span class="s1">&gt;${title}&lt;/li&gt;`)</span><span class="s3">\n            </span><span class="s1">$tabTitleContainer.append($title)</span><span class="s3">\n            </span><span class="s1">const $content = $(tpl)</span><span class="s3">\n            </span><span class="s1">$tabContentContainer.append($content)</span><span class="s3">\n\n            </span><span class="s1">// 记录到内存</span><span class="s3">\n            </span><span class="s1">tabTitleArr.push($title)</span><span class="s3">\n            </span><span class="s1">tabContentArr.push($content)</span><span class="s3">\n\n            </span><span class="s1">// 设置 active 项</span><span class="s3">\n            </span><span class="s1">if (tabIndex === 0) {</span><span class="s3">\n                </span><span class="s1">$title.data('active', true)</span><span class="s3">\n                </span><span class="s1">$title.addClass('w-e-active')</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">$content.hide()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 绑定 tab 的事件</span><span class="s3">\n            </span><span class="s1">$title.on('click', () =&gt; {</span><span class="s3">\n                </span><span class="s1">if ($title.data('active')) {</span><span class="s3">\n                    </span><span class="s1">return</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">// 隐藏所有的 tab</span><span class="s3">\n                </span><span class="s1">tabTitleArr.forEach($title =&gt; {</span><span class="s3">\n                    </span><span class="s1">$title.data('active', false)</span><span class="s3">\n                    </span><span class="s1">$title.removeClass('w-e-active')</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n                </span><span class="s1">tabContentArr.forEach($content =&gt; {</span><span class="s3">\n                    </span><span class="s1">$content.hide()</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n\n                </span><span class="s1">// 显示当前的 tab</span><span class="s3">\n                </span><span class="s1">$title.data('active', true)</span><span class="s3">\n                </span><span class="s1">$title.addClass('w-e-active')</span><span class="s3">\n                </span><span class="s1">$content.show()</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// 绑定关闭事件</span><span class="s3">\n        </span><span class="s1">$container.on('click', (e: Event) =&gt; {</span><span class="s3">\n            </span><span class="s1">// 点击时阻止冒泡</span><span class="s3">\n            </span><span class="s1">e.stopPropagation()</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// 添加到 DOM</span><span class="s3">\n        </span><span class="s1">menu.$elem.append($container)</span><span class="s3">\n\n        </span><span class="s1">// 设置tab内input的值</span><span class="s3">\n        </span><span class="s1">conf.setLinkValue &amp;&amp; conf.setLinkValue($container, 'text')</span><span class="s3">\n        </span><span class="s1">conf.setLinkValue &amp;&amp; conf.setLinkValue($container, 'link')</span><span class="s3">\n\n        </span><span class="s1">// 绑定 conf events 的事件，只有添加到 DOM 之后才能绑定成功</span><span class="s3">\n        </span><span class="s1">tabs.forEach((tab: PanelTabConf, index: number) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (!tab) {</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">const events = tab.events || []</span><span class="s3">\n            </span><span class="s1">events.forEach((event: TabEventConf) =&gt; {</span><span class="s3">\n                </span><span class="s1">const selector = event.selector</span><span class="s3">\n                </span><span class="s1">const type = event.type</span><span class="s3">\n                </span><span class="s1">const fn = event.fn || EMPTY_FN</span><span class="s3">\n                </span><span class="s1">const $content = tabContentArr[index]</span><span class="s3">\n                </span><span class="s1">const bindEnter = event.bindEnter ?? false</span><span class="s3">\n\n                </span><span class="s1">const doneFn = async (e: Event) =&gt; {</span><span class="s3">\n                    </span><span class="s1">e.stopPropagation()</span><span class="s3">\n                    </span><span class="s1">const needToHide = await fn(e)</span><span class="s3">\n                    </span><span class="s1">// 执行完事件之后，是否要关闭 panel</span><span class="s3">\n                    </span><span class="s1">if (needToHide) {</span><span class="s3">\n                        </span><span class="s1">this.remove()</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">// 给按钮绑定相应的事件</span><span class="s3">\n                </span><span class="s1">$content.find(selector).on(type, doneFn)</span><span class="s3">\n                </span><span class="s1">// 绑定enter键入事件</span><span class="s3">\n                </span><span class="s1">if (bindEnter &amp;&amp; type === 'click') {</span><span class="s3">\n                    </span><span class="s1">$content.on('keyup', (e: KeyboardEvent) =&gt; {</span><span class="s3">\n                        </span><span class="s1">if (e.keyCode == 13) {</span><span class="s3">\n                            </span><span class="s1">doneFn(e)</span><span class="s3">\n                        </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">})</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// focus 第一个 elem</span><span class="s3">\n        </span><span class="s1">let $inputs = $container.find('input[type=text],textarea')</span><span class="s3">\n        </span><span class="s1">if ($inputs.length) {</span><span class="s3">\n            </span><span class="s1">$inputs.get(0).focus()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 隐藏其他 panel</span><span class="s3">\n        </span><span class="s1">Panel.hideCurAllPanels()</span><span class="s3">\n\n        </span><span class="s1">// 记录该 menu 已经创建了 panel</span><span class="s3">\n        </span><span class="s1">menu.setPanel(this)</span><span class="s3">\n        </span><span class="s1">Panel.createdMenus.add(menu)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 移除 penal</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public remove(): void {</span><span class="s3">\n        </span><span class="s1">const menu = this.menu</span><span class="s3">\n        </span><span class="s1">const $container = this.$container</span><span class="s3">\n        </span><span class="s1">if ($container) {</span><span class="s3">\n            </span><span class="s1">$container.remove()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 将该 menu 记录中移除</span><span class="s3">\n        </span><span class="s1">Panel.createdMenus.delete(menu)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 隐藏当前所有的 panel</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">static hideCurAllPanels(): void {</span><span class="s3">\n        </span><span class="s1">if (Panel.createdMenus.size === 0) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">Panel.createdMenus.forEach(menu =&gt; {</span><span class="s3">\n            </span><span class="s1">const panel = (menu as PanelMenu).panel</span><span class="s3">\n            </span><span class="s1">panel &amp;&amp; panel.remove()</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Panel</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var toString = {}.toString;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">return toString.call(it).slice(8, -1);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var toInteger = require('../internals/to-integer');</span><span class="s3">\n\n</span><span class="s1">var min = Math.min;</span><span class="s3">\n\n</span><span class="s1">// `ToLength` abstract operation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-tolength</span><span class="s3">\n</span><span class="s1">module.exports = function (argument) {</span><span class="s3">\n  </span><span class="s1">return argument &gt; 0 ? min(toInteger(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var path = require('../internals/path');</span><span class="s3">\n</span><span class="s1">var global = require('../internals/global');</span><span class="s3">\n\n</span><span class="s1">var aFunction = function (variable) {</span><span class="s3">\n  </span><span class="s1">return typeof variable == 'function' ? variable : undefined;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">module.exports = function (namespace, method) {</span><span class="s3">\n  </span><span class="s1">return arguments.length &lt; 2 ? aFunction(path[namespace]) || aFunction(global[namespace])</span><span class="s3">\n    </span><span class="s1">: path[namespace] &amp;&amp; path[namespace][method] || global[namespace] &amp;&amp; global[namespace][method];</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');</span><span class="s3">\n</span><span class="s1">var defineProperty = require('../internals/object-define-property').f;</span><span class="s3">\n</span><span class="s1">var createNonEnumerableProperty = require('../internals/create-non-enumerable-property');</span><span class="s3">\n</span><span class="s1">var has = require('../internals/has');</span><span class="s3">\n</span><span class="s1">var toString = require('../internals/object-to-string');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">var TO_STRING_TAG = wellKnownSymbol('toStringTag');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it, TAG, STATIC, SET_METHOD) {</span><span class="s3">\n  </span><span class="s1">if (it) {</span><span class="s3">\n    </span><span class="s1">var target = STATIC ? it : it.prototype;</span><span class="s3">\n    </span><span class="s1">if (!has(target, TO_STRING_TAG)) {</span><span class="s3">\n      </span><span class="s1">defineProperty(target, TO_STRING_TAG, { configurable: true, value: TAG });</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (SET_METHOD &amp;&amp; !TO_STRING_TAG_SUPPORT) {</span><span class="s3">\n      </span><span class="s1">createNonEnumerableProperty(target, 'toString', toString);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description Modal 菜单 Class</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import Menu from './Menu'</span><span class="s3">\n</span><span class="s1">import Panel from './Panel'</span><span class="s3">\n\n</span><span class="s1">class PanelMenu extends Menu {</span><span class="s3">\n    </span><span class="s1">public panel: Panel | undefined</span><span class="s3">\n\n    </span><span class="s1">constructor($elem: DomElement, editor: Editor) {</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 给 menu 设置 panel</span><span class="s3">\n     </span><span class="s1">* @param panel panel 实例</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public setPanel(panel: Panel): void {</span><span class="s3">\n        </span><span class="s1">this.panel = panel</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default PanelMenu</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description Tooltip class</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n\n</span><span class="s1">type PositionDataType = {</span><span class="s3">\n    </span><span class="s1">top: number</span><span class="s3">\n    </span><span class="s1">left: number</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export type TooltipConfItemType = {</span><span class="s3">\n    </span><span class="s1">$elem: DomElement</span><span class="s3">\n    </span><span class="s1">onClick: Function</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">export type TooltipConfType = Array&lt;TooltipConfItemType&gt;</span><span class="s3">\n\n</span><span class="s1">class Tooltip {</span><span class="s3">\n    </span><span class="s1">private $container: DomElement</span><span class="s3">\n    </span><span class="s1">private $targetElem: DomElement</span><span class="s3">\n    </span><span class="s1">private editor: Editor</span><span class="s3">\n    </span><span class="s1">private conf: TooltipConfType</span><span class="s3">\n    </span><span class="s1">private _show: boolean</span><span class="s3">\n    </span><span class="s1">private _isInsertTextContainer: boolean</span><span class="s3">\n\n    </span><span class="s1">constructor(editor: Editor, $elem: DomElement, conf: TooltipConfType) {</span><span class="s3">\n        </span><span class="s1">this.editor = editor</span><span class="s3">\n        </span><span class="s1">this.$targetElem = $elem</span><span class="s3">\n        </span><span class="s1">this.conf = conf</span><span class="s3">\n        </span><span class="s1">this._show = false</span><span class="s3">\n        </span><span class="s1">this._isInsertTextContainer = false</span><span class="s3">\n        </span><span class="s1">// 定义 container</span><span class="s3">\n        </span><span class="s1">const $container = $('&lt;div&gt;&lt;/div&gt;')</span><span class="s3">\n        </span><span class="s1">$container.addClass('w-e-tooltip')</span><span class="s3">\n        </span><span class="s1">this.$container = $container</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取 tooltip 定位</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private getPositionData(): PositionDataType {</span><span class="s3">\n        </span><span class="s1">const $container = this.$container</span><span class="s3">\n\n        </span><span class="s1">let top = 0</span><span class="s3">\n        </span><span class="s1">let left = 0</span><span class="s3">\n\n        </span><span class="s1">// tooltip 的高度</span><span class="s3">\n        </span><span class="s1">const tooltipHeight = 20</span><span class="s3">\n        </span><span class="s1">// 网页的 scrollTop</span><span class="s3">\n        </span><span class="s1">const pageScrollTop = document.documentElement.scrollTop</span><span class="s3">\n        </span><span class="s1">// 目标元素的 rect</span><span class="s3">\n        </span><span class="s1">const targetElemRect = this.$targetElem.getBoundingClientRect()</span><span class="s3">\n        </span><span class="s1">// 编辑区域的 rect</span><span class="s3">\n        </span><span class="s1">const textElemRect = this.editor.$textElem.getBoundingClientRect()</span><span class="s3">\n        </span><span class="s1">// 获取基于 textContainerElem 的 位置信息</span><span class="s3">\n        </span><span class="s1">const targetOffset = this.$targetElem.getOffsetData()</span><span class="s3">\n        </span><span class="s1">const targetParentElem = $(targetOffset.parent)</span><span class="s3">\n        </span><span class="s1">// 获取 编辑区域的滚动条信息</span><span class="s3">\n        </span><span class="s1">const scrollTop = this.editor.$textElem.elems[0].scrollTop</span><span class="s3">\n        </span><span class="s1">// 是否插入 textContainer 中</span><span class="s3">\n        </span><span class="s1">this._isInsertTextContainer = targetParentElem.equal(this.editor.$textContainerElem)</span><span class="s3">\n\n        </span><span class="s1">if (this._isInsertTextContainer) {</span><span class="s3">\n            </span><span class="s1">// 父容器的高度</span><span class="s3">\n            </span><span class="s1">const targetParentElemHeight = targetParentElem.getBoundingClientRect().height</span><span class="s3">\n            </span><span class="s1">// 相对于父容器的位置信息</span><span class="s3">\n            </span><span class="s1">const { top: offsetTop, left: offsetLeft, height: offsetHeight } = targetOffset</span><span class="s3">\n            </span><span class="s1">// 元素基于父容器的 绝对top信息</span><span class="s3">\n            </span><span class="s1">const absoluteTop = offsetTop - scrollTop</span><span class="s3">\n            </span><span class="s1">if (absoluteTop &gt; tooltipHeight + 5) {</span><span class="s3">\n                </span><span class="s1">// 说明模板元素的顶部空间足够</span><span class="s3">\n                </span><span class="s1">top = absoluteTop - tooltipHeight - 15</span><span class="s3">\n                </span><span class="s1">$container.addClass('w-e-tooltip-up')</span><span class="s3">\n            </span><span class="s1">} else if (absoluteTop + offsetHeight + tooltipHeight &lt; targetParentElemHeight) {</span><span class="s3">\n                </span><span class="s1">// 说明模板元素的底部空间足够</span><span class="s3">\n                </span><span class="s1">top = absoluteTop + offsetHeight + 10</span><span class="s3">\n                </span><span class="s1">$container.addClass('w-e-tooltip-down')</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">// 其他情况，tooltip 放在目标元素左上角</span><span class="s3">\n                </span><span class="s1">top = (absoluteTop &gt; 0 ? absoluteTop : 0) + tooltipHeight + 10</span><span class="s3">\n                </span><span class="s1">$container.addClass('w-e-tooltip-down')</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">// 计算 left</span><span class="s3">\n            </span><span class="s1">if (offsetLeft &lt; 0) {</span><span class="s3">\n                </span><span class="s1">left = 0</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">left = offsetLeft</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">if (targetElemRect.top &lt; tooltipHeight) {</span><span class="s3">\n                </span><span class="s1">// 说明目标元素的顶部，因滑动隐藏在浏览器上方。tooltip 要放在目标元素下面</span><span class="s3">\n                </span><span class="s1">top = targetElemRect.bottom + pageScrollTop + 5 // 5px 间距</span><span class="s3">\n                </span><span class="s1">$container.addClass('w-e-tooltip-down')</span><span class="s3">\n            </span><span class="s1">} else if (targetElemRect.top - textElemRect.top &lt; tooltipHeight) {</span><span class="s3">\n                </span><span class="s1">// 说明目标元素的顶部，因滑动隐藏在编辑区域上方。tooltip 要放在目标元素下面</span><span class="s3">\n                </span><span class="s1">top = targetElemRect.bottom + pageScrollTop + 5 // 5px 间距</span><span class="s3">\n                </span><span class="s1">$container.addClass('w-e-tooltip-down')</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">// 其他情况，tooltip 放在目标元素上方</span><span class="s3">\n                </span><span class="s1">top = targetElemRect.top + pageScrollTop - tooltipHeight - 15 // 减去 toolbar 的高度，还有 15px 间距</span><span class="s3">\n                </span><span class="s1">$container.addClass('w-e-tooltip-up')</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">// 计算 left</span><span class="s3">\n            </span><span class="s1">if (targetElemRect.left &lt; 0) {</span><span class="s3">\n                </span><span class="s1">left = 0</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">left = targetElemRect.left</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 返回结果</span><span class="s3">\n        </span><span class="s1">return { top, left }</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 添加 tooltip 菜单</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private appendMenus(): void {</span><span class="s3">\n        </span><span class="s1">const conf = this.conf</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $targetElem = this.$targetElem</span><span class="s3">\n        </span><span class="s1">const $container = this.$container</span><span class="s3">\n\n        </span><span class="s1">conf.forEach((item: TooltipConfItemType, index: number) =&gt; {</span><span class="s3">\n            </span><span class="s1">// 添加元素</span><span class="s3">\n            </span><span class="s1">const $elem = item.$elem</span><span class="s3">\n            </span><span class="s1">const $wrapper = $('&lt;div&gt;&lt;/div&gt;')</span><span class="s3">\n            </span><span class="s1">$wrapper.addClass('w-e-tooltip-item-wrapper ')</span><span class="s3">\n            </span><span class="s1">$wrapper.append($elem)</span><span class="s3">\n            </span><span class="s1">$container.append($wrapper)</span><span class="s3">\n\n            </span><span class="s1">// 绑定点击事件</span><span class="s3">\n            </span><span class="s1">$elem.on('click', (e: Event) =&gt; {</span><span class="s3">\n                </span><span class="s1">e.preventDefault()</span><span class="s3">\n                </span><span class="s1">const res = item.onClick(editor, $targetElem)</span><span class="s3">\n                </span><span class="s1">if (res) this.remove()</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 创建 tooltip</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public create(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $container = this.$container</span><span class="s3">\n\n        </span><span class="s1">// 生成 container 的内容</span><span class="s3">\n        </span><span class="s1">this.appendMenus()</span><span class="s3">\n\n        </span><span class="s1">// 设置定位</span><span class="s3">\n        </span><span class="s1">const { top, left } = this.getPositionData()</span><span class="s3">\n        </span><span class="s1">$container.css('top', `${top}px`)</span><span class="s3">\n        </span><span class="s1">$container.css('left', `${left}px`)</span><span class="s3">\n\n        </span><span class="s1">// 设置 z-index</span><span class="s3">\n        </span><span class="s1">$container.css('z-index', editor.zIndex.get('tooltip'))</span><span class="s3">\n\n        </span><span class="s1">// 添加到 DOM</span><span class="s3">\n        </span><span class="s1">if (this._isInsertTextContainer) {</span><span class="s3">\n            </span><span class="s1">this.editor.$textContainerElem.append($container)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">$('body').append($container)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">this._show = true</span><span class="s3">\n\n        </span><span class="s1">editor.beforeDestroy(this.remove.bind(this))</span><span class="s3">\n        </span><span class="s1">editor.txt.eventHooks.onBlurEvents.push(this.remove.bind(this))</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 移除该 tooltip</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public remove(): void {</span><span class="s3">\n        </span><span class="s1">this.$container.remove()</span><span class="s3">\n        </span><span class="s1">this._show = false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 是否显示</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public get isShow(): boolean {</span><span class="s3">\n        </span><span class="s1">return this._show</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Tooltip</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var aFunction = require('../internals/a-function');</span><span class="s3">\n\n</span><span class="s1">// optional / simple context binding</span><span class="s3">\n</span><span class="s1">module.exports = function (fn, that, length) {</span><span class="s3">\n  </span><span class="s1">aFunction(fn);</span><span class="s3">\n  </span><span class="s1">if (that === undefined) return fn;</span><span class="s3">\n  </span><span class="s1">switch (length) {</span><span class="s3">\n    </span><span class="s1">case 0: return function () {</span><span class="s3">\n      </span><span class="s1">return fn.call(that);</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n    </span><span class="s1">case 1: return function (a) {</span><span class="s3">\n      </span><span class="s1">return fn.call(that, a);</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n    </span><span class="s1">case 2: return function (a, b) {</span><span class="s3">\n      </span><span class="s1">return fn.call(that, a, b);</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n    </span><span class="s1">case 3: return function (a, b, c) {</span><span class="s3">\n      </span><span class="s1">return fn.call(that, a, b, c);</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return function (/* ...args */) {</span><span class="s3">\n    </span><span class="s1">return fn.apply(that, arguments);</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">if (typeof it != 'function') {</span><span class="s3">\n    </span><span class="s1">throw TypeError(String(it) + ' is not a function');</span><span class="s3">\n  </span><span class="s1">} return it;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var NATIVE_WEAK_MAP = require('../internals/native-weak-map');</span><span class="s3">\n</span><span class="s1">var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var isObject = require('../internals/is-object');</span><span class="s3">\n</span><span class="s1">var createNonEnumerableProperty = require('../internals/create-non-enumerable-property');</span><span class="s3">\n</span><span class="s1">var objectHas = require('../internals/has');</span><span class="s3">\n</span><span class="s1">var sharedKey = require('../internals/shared-key');</span><span class="s3">\n</span><span class="s1">var hiddenKeys = require('../internals/hidden-keys');</span><span class="s3">\n\n</span><span class="s1">var WeakMap = global.WeakMap;</span><span class="s3">\n</span><span class="s1">var set, get, has;</span><span class="s3">\n\n</span><span class="s1">var enforce = function (it) {</span><span class="s3">\n  </span><span class="s1">return has(it) ? get(it) : set(it, {});</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var getterFor = function (TYPE) {</span><span class="s3">\n  </span><span class="s1">return function (it) {</span><span class="s3">\n    </span><span class="s1">var state;</span><span class="s3">\n    </span><span class="s1">if (!isObject(it) || (state = get(it)).type !== TYPE) {</span><span class="s3">\n      </span><span class="s1">throw TypeError('Incompatible receiver, ' + TYPE + ' required');</span><span class="s3">\n    </span><span class="s1">} return state;</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">if (NATIVE_WEAK_MAP) {</span><span class="s3">\n  </span><span class="s1">var store = new WeakMap();</span><span class="s3">\n  </span><span class="s1">var wmget = store.get;</span><span class="s3">\n  </span><span class="s1">var wmhas = store.has;</span><span class="s3">\n  </span><span class="s1">var wmset = store.set;</span><span class="s3">\n  </span><span class="s1">set = function (it, metadata) {</span><span class="s3">\n    </span><span class="s1">wmset.call(store, it, metadata);</span><span class="s3">\n    </span><span class="s1">return metadata;</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">get = function (it) {</span><span class="s3">\n    </span><span class="s1">return wmget.call(store, it) || {};</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">has = function (it) {</span><span class="s3">\n    </span><span class="s1">return wmhas.call(store, it);</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">} else {</span><span class="s3">\n  </span><span class="s1">var STATE = sharedKey('state');</span><span class="s3">\n  </span><span class="s1">hiddenKeys[STATE] = true;</span><span class="s3">\n  </span><span class="s1">set = function (it, metadata) {</span><span class="s3">\n    </span><span class="s1">createNonEnumerableProperty(it, STATE, metadata);</span><span class="s3">\n    </span><span class="s1">return metadata;</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">get = function (it) {</span><span class="s3">\n    </span><span class="s1">return objectHas(it, STATE) ? it[STATE] : {};</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">has = function (it) {</span><span class="s3">\n    </span><span class="s1">return objectHas(it, STATE);</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">module.exports = {</span><span class="s3">\n  </span><span class="s1">set: set,</span><span class="s3">\n  </span><span class="s1">get: get,</span><span class="s3">\n  </span><span class="s1">has: has,</span><span class="s3">\n  </span><span class="s1">enforce: enforce,</span><span class="s3">\n  </span><span class="s1">getterFor: getterFor</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = true;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = {};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/instance/slice</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/set-timeout</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;import { ListType } from '.'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { ContainerFragment } from './ListHandle'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 过滤 选择的 node 节点</span><span class="s3">\n </span><span class="s1">* @returns { DomElement[] } DomElement[]</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function filterSelectionNodes($nodes: DomElement[]): DomElement[] {</span><span class="s3">\n    </span><span class="s1">const $listHtml: DomElement[] = []</span><span class="s3">\n    </span><span class="s1">$nodes.forEach(($node: DomElement) =&gt; {</span><span class="s3">\n        </span><span class="s1">const targerName = $node.getNodeName()</span><span class="s3">\n        </span><span class="s1">if (targerName !== ListType.OrderedList &amp;&amp; targerName !== ListType.UnorderedList) {</span><span class="s3">\n            </span><span class="s1">// 非序列</span><span class="s3">\n            </span><span class="s1">$listHtml.push($node)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 序列</span><span class="s3">\n            </span><span class="s1">if ($node.prior) {</span><span class="s3">\n                </span><span class="s1">$listHtml.push($node.prior)</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">const $children = $node.children()</span><span class="s3">\n                </span><span class="s1">$children?.forEach(($li: HTMLElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">$listHtml.push($($li))</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">return $listHtml</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 更新选区</span><span class="s3">\n </span><span class="s1">* @param $node</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">export function updateRange(editor: Editor, $node: DomElement, collapsed: boolean) {</span><span class="s3">\n    </span><span class="s1">const selection = editor.selection</span><span class="s3">\n    </span><span class="s1">const range = document.createRange()</span><span class="s3">\n\n    </span><span class="s1">// ===============================</span><span class="s3">\n    </span><span class="s1">// length 大于 1</span><span class="s3">\n    </span><span class="s1">// 代表着转换是一个文档节点多段落</span><span class="s3">\n    </span><span class="s1">// ===============================</span><span class="s3">\n    </span><span class="s1">if ($node.length &gt; 1) {</span><span class="s3">\n        </span><span class="s1">range.setStart($node.elems[0], 0)</span><span class="s3">\n        </span><span class="s1">range.setEnd($node.elems[$node.length - 1], $node.elems[$node.length - 1].childNodes.length)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// ===============================</span><span class="s3">\n    </span><span class="s1">// 序列节点 或 单段落</span><span class="s3">\n    </span><span class="s1">// ===============================</span><span class="s3">\n    </span><span class="s1">else {</span><span class="s3">\n        </span><span class="s1">range.selectNodeContents($node.elems[0])</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// ===============================</span><span class="s3">\n    </span><span class="s1">// collapsed 为 true 代表是光标</span><span class="s3">\n    </span><span class="s1">// ===============================</span><span class="s3">\n    </span><span class="s1">collapsed &amp;&amp; range.collapse(false)</span><span class="s3">\n    </span><span class="s1">selection.saveRange(range)</span><span class="s3">\n    </span><span class="s1">selection.restoreSelection()</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 获取起点元素</span><span class="s3">\n </span><span class="s1">* @param $startElem 开始序列节点</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function getStartPoint($startElem: DomElement): DomElement {</span><span class="s3">\n    </span><span class="s1">return $startElem.prior</span><span class="s3">\n        </span><span class="s1">? $startElem.prior // 有 prior 代表不是全选序列</span><span class="s3">\n        </span><span class="s1">: $($startElem.children()?.elems[0]) // 没有则代表全选序列</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 获取结束元素</span><span class="s3">\n </span><span class="s1">* @param $endElem 结束序列节点</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function getEndPoint($endElem: DomElement): DomElement {</span><span class="s3">\n    </span><span class="s1">return $endElem.prior</span><span class="s3">\n        </span><span class="s1">? $endElem.prior // 有 prior 代表不是全选序列</span><span class="s3">\n        </span><span class="s1">: $($endElem.children()?.last().elems[0]) // 没有则代表全选序列</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 在您指定节点的已有子节点之前插入新的子节点。</span><span class="s3">\n </span><span class="s1">* @param { DomElement } $node 指定节点</span><span class="s3">\n </span><span class="s1">* @param { ContainerFragment } newNode 插入的新子节点</span><span class="s3">\n </span><span class="s1">* @param { Node | null } existingNode 指定子节点</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function insertBefore(</span><span class="s3">\n    </span><span class="s1">$node: DomElement,</span><span class="s3">\n    </span><span class="s1">newNode: ContainerFragment,</span><span class="s3">\n    </span><span class="s1">existingNode: Node | null = null</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">$node.parent().elems[0].insertBefore(newNode, existingNode)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 创建指定的 element 对象</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function createElement(target: string): HTMLElement {</span><span class="s3">\n    </span><span class="s1">return document.createElement(target)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 创建文档片段</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function createDocumentFragment(): DocumentFragment {</span><span class="s3">\n    </span><span class="s1">return document.createDocumentFragment()</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 生成 li 标签的元素，并返回 $fragment 文档片段</span><span class="s3">\n </span><span class="s1">* @param { DomElement[] } $nodes 需要转换成 li 的 dom 元素数组</span><span class="s3">\n </span><span class="s1">* @param { ContainerFragment } $fragment 用于存储生成后 li 元素的文档片段</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function createElementFragment(</span><span class="s3">\n    </span><span class="s1">$nodes: DomElement[],</span><span class="s3">\n    </span><span class="s1">$fragment: ContainerFragment,</span><span class="s3">\n    </span><span class="s1">tag: string = 'li'</span><span class="s3">\n</span><span class="s1">): ContainerFragment {</span><span class="s3">\n    </span><span class="s1">$nodes.forEach(($node: DomElement) =&gt; {</span><span class="s3">\n        </span><span class="s1">const $list = createElement(tag)</span><span class="s3">\n        </span><span class="s1">$list.innerHTML = $node.html()</span><span class="s3">\n        </span><span class="s1">$fragment.appendChild($list)</span><span class="s3">\n        </span><span class="s1">$node.remove()</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">return $fragment</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = function (bitmap, value) {</span><span class="s3">\n  </span><span class="s1">return {</span><span class="s3">\n    </span><span class="s1">enumerable: !(bitmap &amp; 1),</span><span class="s3">\n    </span><span class="s1">configurable: !(bitmap &amp; 2),</span><span class="s3">\n    </span><span class="s1">writable: !(bitmap &amp; 4),</span><span class="s3">\n    </span><span class="s1">value: value</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;// `RequireObjectCoercible` abstract operation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-requireobjectcoercible</span><span class="s3">\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">if (it == undefined) throw TypeError(</span><span class="s3">\&quot;</span><span class="s1">Can't call method on </span><span class="s3">\&quot; </span><span class="s1">+ it);</span><span class="s3">\n  </span><span class="s1">return it;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var charAt = require('../internals/string-multibyte').charAt;</span><span class="s3">\n</span><span class="s1">var InternalStateModule = require('../internals/internal-state');</span><span class="s3">\n</span><span class="s1">var defineIterator = require('../internals/define-iterator');</span><span class="s3">\n\n</span><span class="s1">var STRING_ITERATOR = 'String Iterator';</span><span class="s3">\n</span><span class="s1">var setInternalState = InternalStateModule.set;</span><span class="s3">\n</span><span class="s1">var getInternalState = InternalStateModule.getterFor(STRING_ITERATOR);</span><span class="s3">\n\n</span><span class="s1">// `String.prototype[@@iterator]` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-string.prototype-@@iterator</span><span class="s3">\n</span><span class="s1">defineIterator(String, 'String', function (iterated) {</span><span class="s3">\n  </span><span class="s1">setInternalState(this, {</span><span class="s3">\n    </span><span class="s1">type: STRING_ITERATOR,</span><span class="s3">\n    </span><span class="s1">string: String(iterated),</span><span class="s3">\n    </span><span class="s1">index: 0</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n</span><span class="s1">// `%StringIteratorPrototype%.next` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-%stringiteratorprototype%.next</span><span class="s3">\n</span><span class="s1">}, function next() {</span><span class="s3">\n  </span><span class="s1">var state = getInternalState(this);</span><span class="s3">\n  </span><span class="s1">var string = state.string;</span><span class="s3">\n  </span><span class="s1">var index = state.index;</span><span class="s3">\n  </span><span class="s1">var point;</span><span class="s3">\n  </span><span class="s1">if (index &gt;= string.length) return { value: undefined, done: true };</span><span class="s3">\n  </span><span class="s1">point = charAt(string, index);</span><span class="s3">\n  </span><span class="s1">state.index += point.length;</span><span class="s3">\n  </span><span class="s1">return { value: point, done: false };</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = {};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var internalObjectKeys = require('../internals/object-keys-internal');</span><span class="s3">\n</span><span class="s1">var enumBugKeys = require('../internals/enum-bug-keys');</span><span class="s3">\n\n</span><span class="s1">// `Object.keys` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.keys</span><span class="s3">\n</span><span class="s1">module.exports = Object.keys || function keys(O) {</span><span class="s3">\n  </span><span class="s1">return internalObjectKeys(O, enumBugKeys);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var createNonEnumerableProperty = require('../internals/create-non-enumerable-property');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (target, key, value, options) {</span><span class="s3">\n  </span><span class="s1">if (options &amp;&amp; options.enumerable) target[key] = value;</span><span class="s3">\n  </span><span class="s1">else createNonEnumerableProperty(target, key, value);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('./es.array.iterator');</span><span class="s3">\n</span><span class="s1">var DOMIterables = require('../internals/dom-iterables');</span><span class="s3">\n</span><span class="s1">var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var classof = require('../internals/classof');</span><span class="s3">\n</span><span class="s1">var createNonEnumerableProperty = require('../internals/create-non-enumerable-property');</span><span class="s3">\n</span><span class="s1">var Iterators = require('../internals/iterators');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">var TO_STRING_TAG = wellKnownSymbol('toStringTag');</span><span class="s3">\n\n</span><span class="s1">for (var COLLECTION_NAME in DOMIterables) {</span><span class="s3">\n  </span><span class="s1">var Collection = global[COLLECTION_NAME];</span><span class="s3">\n  </span><span class="s1">var CollectionPrototype = Collection &amp;&amp; Collection.prototype;</span><span class="s3">\n  </span><span class="s1">if (CollectionPrototype &amp;&amp; classof(CollectionPrototype) !== TO_STRING_TAG) {</span><span class="s3">\n    </span><span class="s1">createNonEnumerableProperty(CollectionPrototype, TO_STRING_TAG, COLLECTION_NAME);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">Iterators[COLLECTION_NAME] = Iterators.Array;</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var classof = require('../internals/classof-raw');</span><span class="s3">\n\n</span><span class="s1">// `IsArray` abstract operation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-isarray</span><span class="s3">\n</span><span class="s1">module.exports = Array.isArray || function isArray(arg) {</span><span class="s3">\n  </span><span class="s1">return classof(arg) == 'Array';</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var fails = require('../internals/fails');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n</span><span class="s1">var V8_VERSION = require('../internals/engine-v8-version');</span><span class="s3">\n\n</span><span class="s1">var SPECIES = wellKnownSymbol('species');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (METHOD_NAME) {</span><span class="s3">\n  </span><span class="s1">// We can't use this feature detection in V8 since it causes</span><span class="s3">\n  </span><span class="s1">// deoptimization and serious performance degradation</span><span class="s3">\n  </span><span class="s1">// https://github.com/zloirock/core-js/issues/677</span><span class="s3">\n  </span><span class="s1">return V8_VERSION &gt;= 51 || !fails(function () {</span><span class="s3">\n    </span><span class="s1">var array = [];</span><span class="s3">\n    </span><span class="s1">var constructor = array.constructor = {};</span><span class="s3">\n    </span><span class="s1">constructor[SPECIES] = function () {</span><span class="s3">\n      </span><span class="s1">return { foo: 1 };</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n    </span><span class="s1">return array[METHOD_NAME](Boolean).foo !== 1;</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/instance/bind</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;import Editor from '../../../editor'</span><span class="s3">\n</span><span class="s1">import { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import SelectionRangeElem from '../SelectionRangeElem'</span><span class="s3">\n\n</span><span class="s1">export type HandlerListOptions = {</span><span class="s3">\n    </span><span class="s1">editor: Editor</span><span class="s3">\n    </span><span class="s1">listType: string</span><span class="s3">\n    </span><span class="s1">listTarget: string</span><span class="s3">\n    </span><span class="s1">$selectionElem: DomElement</span><span class="s3">\n    </span><span class="s1">$startElem: DomElement</span><span class="s3">\n    </span><span class="s1">$endElem: DomElement</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export interface Exec {</span><span class="s3">\n    </span><span class="s1">exec: Function</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export class ListHandle {</span><span class="s3">\n    </span><span class="s1">public options: HandlerListOptions</span><span class="s3">\n    </span><span class="s1">public selectionRangeElem: SelectionRangeElem</span><span class="s3">\n\n    </span><span class="s1">constructor(options: HandlerListOptions) {</span><span class="s3">\n        </span><span class="s1">this.options = options</span><span class="s3">\n        </span><span class="s1">this.selectionRangeElem = new SelectionRangeElem()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var nativePropertyIsEnumerable = {}.propertyIsEnumerable;</span><span class="s3">\n</span><span class="s1">var getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;</span><span class="s3">\n\n</span><span class="s1">// Nashorn ~ JDK8 bug</span><span class="s3">\n</span><span class="s1">var NASHORN_BUG = getOwnPropertyDescriptor &amp;&amp; !nativePropertyIsEnumerable.call({ 1: 2 }, 1);</span><span class="s3">\n\n</span><span class="s1">// `Object.prototype.propertyIsEnumerable` method implementation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.prototype.propertyisenumerable</span><span class="s3">\n</span><span class="s1">exports.f = NASHORN_BUG ? function propertyIsEnumerable(V) {</span><span class="s3">\n  </span><span class="s1">var descriptor = getOwnPropertyDescriptor(this, V);</span><span class="s3">\n  </span><span class="s1">return !!descriptor &amp;&amp; descriptor.enumerable;</span><span class="s3">\n</span><span class="s1">} : nativePropertyIsEnumerable;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var isObject = require('../internals/is-object');</span><span class="s3">\n\n</span><span class="s1">// `ToPrimitive` abstract operation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-toprimitive</span><span class="s3">\n</span><span class="s1">// instead of the ES6 spec version, we didn't implement @@toPrimitive case</span><span class="s3">\n</span><span class="s1">// and the second argument - flag - preferred type is a string</span><span class="s3">\n</span><span class="s1">module.exports = function (input, PREFERRED_STRING) {</span><span class="s3">\n  </span><span class="s1">if (!isObject(input)) return input;</span><span class="s3">\n  </span><span class="s1">var fn, val;</span><span class="s3">\n  </span><span class="s1">if (PREFERRED_STRING &amp;&amp; typeof (fn = input.toString) == 'function' &amp;&amp; !isObject(val = fn.call(input))) return val;</span><span class="s3">\n  </span><span class="s1">if (typeof (fn = input.valueOf) == 'function' &amp;&amp; !isObject(val = fn.call(input))) return val;</span><span class="s3">\n  </span><span class="s1">if (!PREFERRED_STRING &amp;&amp; typeof (fn = input.toString) == 'function' &amp;&amp; !isObject(val = fn.call(input))) return val;</span><span class="s3">\n  </span><span class="s1">throw TypeError(</span><span class="s3">\&quot;</span><span class="s1">Can't convert object to primitive value</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;// empty</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var ceil = Math.ceil;</span><span class="s3">\n</span><span class="s1">var floor = Math.floor;</span><span class="s3">\n\n</span><span class="s1">// `ToInteger` abstract operation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-tointeger</span><span class="s3">\n</span><span class="s1">module.exports = function (argument) {</span><span class="s3">\n  </span><span class="s1">return isNaN(argument = +argument) ? 0 : (argument &gt; 0 ? floor : ceil)(argument);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var shared = require('../internals/shared');</span><span class="s3">\n</span><span class="s1">var uid = require('../internals/uid');</span><span class="s3">\n\n</span><span class="s1">var keys = shared('keys');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (key) {</span><span class="s3">\n  </span><span class="s1">return keys[key] || (keys[key] = uid(key));</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var id = 0;</span><span class="s3">\n</span><span class="s1">var postfix = Math.random();</span><span class="s3">\n\n</span><span class="s1">module.exports = function (key) {</span><span class="s3">\n  </span><span class="s1">return 'Symbol(' + String(key === undefined ? '' : key) + ')_' + (++id + postfix).toString(36);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');</span><span class="s3">\n</span><span class="s1">var classofRaw = require('../internals/classof-raw');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">var TO_STRING_TAG = wellKnownSymbol('toStringTag');</span><span class="s3">\n</span><span class="s1">// ES3 wrong here</span><span class="s3">\n</span><span class="s1">var CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) == 'Arguments';</span><span class="s3">\n\n</span><span class="s1">// fallback for IE11 Script Access Denied error</span><span class="s3">\n</span><span class="s1">var tryGet = function (it, key) {</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">return it[key];</span><span class="s3">\n  </span><span class="s1">} catch (error) { /* empty */ }</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">// getting tag from ES6+ `Object.prototype.toString`</span><span class="s3">\n</span><span class="s1">module.exports = TO_STRING_TAG_SUPPORT ? classofRaw : function (it) {</span><span class="s3">\n  </span><span class="s1">var O, tag, result;</span><span class="s3">\n  </span><span class="s1">return it === undefined ? 'Undefined' : it === null ? 'Null'</span><span class="s3">\n    </span><span class="s1">// @@toStringTag case</span><span class="s3">\n    </span><span class="s1">: typeof (tag = tryGet(O = Object(it), TO_STRING_TAG)) == 'string' ? tag</span><span class="s3">\n    </span><span class="s1">// builtinTag case</span><span class="s3">\n    </span><span class="s1">: CORRECT_ARGUMENTS ? classofRaw(O)</span><span class="s3">\n    </span><span class="s1">// ES3 arguments fallback</span><span class="s3">\n    </span><span class="s1">: (result = classofRaw(O)) == 'Object' &amp;&amp; typeof O.callee == 'function' ? 'Arguments' : result;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var anObject = require('../internals/an-object');</span><span class="s3">\n</span><span class="s1">var isArrayIteratorMethod = require('../internals/is-array-iterator-method');</span><span class="s3">\n</span><span class="s1">var toLength = require('../internals/to-length');</span><span class="s3">\n</span><span class="s1">var bind = require('../internals/function-bind-context');</span><span class="s3">\n</span><span class="s1">var getIteratorMethod = require('../internals/get-iterator-method');</span><span class="s3">\n</span><span class="s1">var callWithSafeIterationClosing = require('../internals/call-with-safe-iteration-closing');</span><span class="s3">\n\n</span><span class="s1">var Result = function (stopped, result) {</span><span class="s3">\n  </span><span class="s1">this.stopped = stopped;</span><span class="s3">\n  </span><span class="s1">this.result = result;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var iterate = module.exports = function (iterable, fn, that, AS_ENTRIES, IS_ITERATOR) {</span><span class="s3">\n  </span><span class="s1">var boundFunction = bind(fn, that, AS_ENTRIES ? 2 : 1);</span><span class="s3">\n  </span><span class="s1">var iterator, iterFn, index, length, result, next, step;</span><span class="s3">\n\n  </span><span class="s1">if (IS_ITERATOR) {</span><span class="s3">\n    </span><span class="s1">iterator = iterable;</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">iterFn = getIteratorMethod(iterable);</span><span class="s3">\n    </span><span class="s1">if (typeof iterFn != 'function') throw TypeError('Target is not iterable');</span><span class="s3">\n    </span><span class="s1">// optimisation for array iterators</span><span class="s3">\n    </span><span class="s1">if (isArrayIteratorMethod(iterFn)) {</span><span class="s3">\n      </span><span class="s1">for (index = 0, length = toLength(iterable.length); length &gt; index; index++) {</span><span class="s3">\n        </span><span class="s1">result = AS_ENTRIES</span><span class="s3">\n          </span><span class="s1">? boundFunction(anObject(step = iterable[index])[0], step[1])</span><span class="s3">\n          </span><span class="s1">: boundFunction(iterable[index]);</span><span class="s3">\n        </span><span class="s1">if (result &amp;&amp; result instanceof Result) return result;</span><span class="s3">\n      </span><span class="s1">} return new Result(false);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">iterator = iterFn.call(iterable);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">next = iterator.next;</span><span class="s3">\n  </span><span class="s1">while (!(step = next.call(iterator)).done) {</span><span class="s3">\n    </span><span class="s1">result = callWithSafeIterationClosing(iterator, boundFunction, step.value, AS_ENTRIES);</span><span class="s3">\n    </span><span class="s1">if (typeof result == 'object' &amp;&amp; result &amp;&amp; result instanceof Result) return result;</span><span class="s3">\n  </span><span class="s1">} return new Result(false);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">iterate.stop = function (result) {</span><span class="s3">\n  </span><span class="s1">return new Result(true, result);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var fails = require('../internals/fails');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (METHOD_NAME, argument) {</span><span class="s3">\n  </span><span class="s1">var method = [][METHOD_NAME];</span><span class="s3">\n  </span><span class="s1">return !!method &amp;&amp; fails(function () {</span><span class="s3">\n    </span><span class="s1">// eslint-disable-next-line no-useless-call,no-throw-literal</span><span class="s3">\n    </span><span class="s1">method.call(null, argument || function () { throw 1; }, 1);</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;// a string of all valid unicode whitespaces</span><span class="s3">\n</span><span class="s1">// eslint-disable-next-line max-len</span><span class="s3">\n</span><span class="s1">module.exports = '</span><span class="s3">\\</span><span class="s1">u0009</span><span class="s3">\\</span><span class="s1">u000A</span><span class="s3">\\</span><span class="s1">u000B</span><span class="s3">\\</span><span class="s1">u000C</span><span class="s3">\\</span><span class="s1">u000D</span><span class="s3">\\</span><span class="s1">u0020</span><span class="s3">\\</span><span class="s1">u00A0</span><span class="s3">\\</span><span class="s1">u1680</span><span class="s3">\\</span><span class="s1">u2000</span><span class="s3">\\</span><span class="s1">u2001</span><span class="s3">\\</span><span class="s1">u2002</span><span class="s3">\\</span><span class="s1">u2003</span><span class="s3">\\</span><span class="s1">u2004</span><span class="s3">\\</span><span class="s1">u2005</span><span class="s3">\\</span><span class="s1">u2006</span><span class="s3">\\</span><span class="s1">u2007</span><span class="s3">\\</span><span class="s1">u2008</span><span class="s3">\\</span><span class="s1">u2009</span><span class="s3">\\</span><span class="s1">u200A</span><span class="s3">\\</span><span class="s1">u202F</span><span class="s3">\\</span><span class="s1">u205F</span><span class="s3">\\</span><span class="s1">u3000</span><span class="s3">\\</span><span class="s1">u2028</span><span class="s3">\\</span><span class="s1">u2029</span><span class="s3">\\</span><span class="s1">uFEFF';</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var toPrimitive = require('../internals/to-primitive');</span><span class="s3">\n</span><span class="s1">var definePropertyModule = require('../internals/object-define-property');</span><span class="s3">\n</span><span class="s1">var createPropertyDescriptor = require('../internals/create-property-descriptor');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (object, key, value) {</span><span class="s3">\n  </span><span class="s1">var propertyKey = toPrimitive(key);</span><span class="s3">\n  </span><span class="s1">if (propertyKey in object) definePropertyModule.f(object, propertyKey, createPropertyDescriptor(0, value));</span><span class="s3">\n  </span><span class="s1">else object[propertyKey] = value;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/instance/filter</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var DESCRIPTORS = require('../internals/descriptors');</span><span class="s3">\n</span><span class="s1">var propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');</span><span class="s3">\n</span><span class="s1">var createPropertyDescriptor = require('../internals/create-property-descriptor');</span><span class="s3">\n</span><span class="s1">var toIndexedObject = require('../internals/to-indexed-object');</span><span class="s3">\n</span><span class="s1">var toPrimitive = require('../internals/to-primitive');</span><span class="s3">\n</span><span class="s1">var has = require('../internals/has');</span><span class="s3">\n</span><span class="s1">var IE8_DOM_DEFINE = require('../internals/ie8-dom-define');</span><span class="s3">\n\n</span><span class="s1">var nativeGetOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;</span><span class="s3">\n\n</span><span class="s1">// `Object.getOwnPropertyDescriptor` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.getownpropertydescriptor</span><span class="s3">\n</span><span class="s1">exports.f = DESCRIPTORS ? nativeGetOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {</span><span class="s3">\n  </span><span class="s1">O = toIndexedObject(O);</span><span class="s3">\n  </span><span class="s1">P = toPrimitive(P, true);</span><span class="s3">\n  </span><span class="s1">if (IE8_DOM_DEFINE) try {</span><span class="s3">\n    </span><span class="s1">return nativeGetOwnPropertyDescriptor(O, P);</span><span class="s3">\n  </span><span class="s1">} catch (error) { /* empty */ }</span><span class="s3">\n  </span><span class="s1">if (has(O, P)) return createPropertyDescriptor(!propertyIsEnumerableModule.f.call(O, P), O[P]);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var fails = require('../internals/fails');</span><span class="s3">\n</span><span class="s1">var classof = require('../internals/classof-raw');</span><span class="s3">\n\n</span><span class="s1">var split = ''.split;</span><span class="s3">\n\n</span><span class="s1">// fallback for non-array-like ES3 and non-enumerable old V8 strings</span><span class="s3">\n</span><span class="s1">module.exports = fails(function () {</span><span class="s3">\n  </span><span class="s1">// throws an error in rhino, see https://github.com/mozilla/rhino/issues/346</span><span class="s3">\n  </span><span class="s1">// eslint-disable-next-line no-prototype-builtins</span><span class="s3">\n  </span><span class="s1">return !Object('z').propertyIsEnumerable(0);</span><span class="s3">\n</span><span class="s1">}) ? function (it) {</span><span class="s3">\n  </span><span class="s1">return classof(it) == 'String' ? split.call(it, '') : Object(it);</span><span class="s3">\n</span><span class="s1">} : Object;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var isObject = require('../internals/is-object');</span><span class="s3">\n\n</span><span class="s1">var document = global.document;</span><span class="s3">\n</span><span class="s1">// typeof document.createElement is 'object' in old IE</span><span class="s3">\n</span><span class="s1">var EXISTS = isObject(document) &amp;&amp; isObject(document.createElement);</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">return EXISTS ? document.createElement(it) : {};</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var IS_PURE = require('../internals/is-pure');</span><span class="s3">\n</span><span class="s1">var store = require('../internals/shared-store');</span><span class="s3">\n\n</span><span class="s1">(module.exports = function (key, value) {</span><span class="s3">\n  </span><span class="s1">return store[key] || (store[key] = value !== undefined ? value : {});</span><span class="s3">\n</span><span class="s1">})('versions', []).push({</span><span class="s3">\n  </span><span class="s1">version: '3.6.4',</span><span class="s3">\n  </span><span class="s1">mode: IS_PURE ? 'pure' : 'global',</span><span class="s3">\n  </span><span class="s1">copyright: '© 2020 Denis Pushkarev (zloirock.ru)'</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var createIteratorConstructor = require('../internals/create-iterator-constructor');</span><span class="s3">\n</span><span class="s1">var getPrototypeOf = require('../internals/object-get-prototype-of');</span><span class="s3">\n</span><span class="s1">var setPrototypeOf = require('../internals/object-set-prototype-of');</span><span class="s3">\n</span><span class="s1">var setToStringTag = require('../internals/set-to-string-tag');</span><span class="s3">\n</span><span class="s1">var createNonEnumerableProperty = require('../internals/create-non-enumerable-property');</span><span class="s3">\n</span><span class="s1">var redefine = require('../internals/redefine');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n</span><span class="s1">var IS_PURE = require('../internals/is-pure');</span><span class="s3">\n</span><span class="s1">var Iterators = require('../internals/iterators');</span><span class="s3">\n</span><span class="s1">var IteratorsCore = require('../internals/iterators-core');</span><span class="s3">\n\n</span><span class="s1">var IteratorPrototype = IteratorsCore.IteratorPrototype;</span><span class="s3">\n</span><span class="s1">var BUGGY_SAFARI_ITERATORS = IteratorsCore.BUGGY_SAFARI_ITERATORS;</span><span class="s3">\n</span><span class="s1">var ITERATOR = wellKnownSymbol('iterator');</span><span class="s3">\n</span><span class="s1">var KEYS = 'keys';</span><span class="s3">\n</span><span class="s1">var VALUES = 'values';</span><span class="s3">\n</span><span class="s1">var ENTRIES = 'entries';</span><span class="s3">\n\n</span><span class="s1">var returnThis = function () { return this; };</span><span class="s3">\n\n</span><span class="s1">module.exports = function (Iterable, NAME, IteratorConstructor, next, DEFAULT, IS_SET, FORCED) {</span><span class="s3">\n  </span><span class="s1">createIteratorConstructor(IteratorConstructor, NAME, next);</span><span class="s3">\n\n  </span><span class="s1">var getIterationMethod = function (KIND) {</span><span class="s3">\n    </span><span class="s1">if (KIND === DEFAULT &amp;&amp; defaultIterator) return defaultIterator;</span><span class="s3">\n    </span><span class="s1">if (!BUGGY_SAFARI_ITERATORS &amp;&amp; KIND in IterablePrototype) return IterablePrototype[KIND];</span><span class="s3">\n    </span><span class="s1">switch (KIND) {</span><span class="s3">\n      </span><span class="s1">case KEYS: return function keys() { return new IteratorConstructor(this, KIND); };</span><span class="s3">\n      </span><span class="s1">case VALUES: return function values() { return new IteratorConstructor(this, KIND); };</span><span class="s3">\n      </span><span class="s1">case ENTRIES: return function entries() { return new IteratorConstructor(this, KIND); };</span><span class="s3">\n    </span><span class="s1">} return function () { return new IteratorConstructor(this); };</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n\n  </span><span class="s1">var TO_STRING_TAG = NAME + ' Iterator';</span><span class="s3">\n  </span><span class="s1">var INCORRECT_VALUES_NAME = false;</span><span class="s3">\n  </span><span class="s1">var IterablePrototype = Iterable.prototype;</span><span class="s3">\n  </span><span class="s1">var nativeIterator = IterablePrototype[ITERATOR]</span><span class="s3">\n    </span><span class="s1">|| IterablePrototype['@@iterator']</span><span class="s3">\n    </span><span class="s1">|| DEFAULT &amp;&amp; IterablePrototype[DEFAULT];</span><span class="s3">\n  </span><span class="s1">var defaultIterator = !BUGGY_SAFARI_ITERATORS &amp;&amp; nativeIterator || getIterationMethod(DEFAULT);</span><span class="s3">\n  </span><span class="s1">var anyNativeIterator = NAME == 'Array' ? IterablePrototype.entries || nativeIterator : nativeIterator;</span><span class="s3">\n  </span><span class="s1">var CurrentIteratorPrototype, methods, KEY;</span><span class="s3">\n\n  </span><span class="s1">// fix native</span><span class="s3">\n  </span><span class="s1">if (anyNativeIterator) {</span><span class="s3">\n    </span><span class="s1">CurrentIteratorPrototype = getPrototypeOf(anyNativeIterator.call(new Iterable()));</span><span class="s3">\n    </span><span class="s1">if (IteratorPrototype !== Object.prototype &amp;&amp; CurrentIteratorPrototype.next) {</span><span class="s3">\n      </span><span class="s1">if (!IS_PURE &amp;&amp; getPrototypeOf(CurrentIteratorPrototype) !== IteratorPrototype) {</span><span class="s3">\n        </span><span class="s1">if (setPrototypeOf) {</span><span class="s3">\n          </span><span class="s1">setPrototypeOf(CurrentIteratorPrototype, IteratorPrototype);</span><span class="s3">\n        </span><span class="s1">} else if (typeof CurrentIteratorPrototype[ITERATOR] != 'function') {</span><span class="s3">\n          </span><span class="s1">createNonEnumerableProperty(CurrentIteratorPrototype, ITERATOR, returnThis);</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">// Set @@toStringTag to native iterators</span><span class="s3">\n      </span><span class="s1">setToStringTag(CurrentIteratorPrototype, TO_STRING_TAG, true, true);</span><span class="s3">\n      </span><span class="s1">if (IS_PURE) Iterators[TO_STRING_TAG] = returnThis;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// fix Array#{values, @@iterator}.name in V8 / FF</span><span class="s3">\n  </span><span class="s1">if (DEFAULT == VALUES &amp;&amp; nativeIterator &amp;&amp; nativeIterator.name !== VALUES) {</span><span class="s3">\n    </span><span class="s1">INCORRECT_VALUES_NAME = true;</span><span class="s3">\n    </span><span class="s1">defaultIterator = function values() { return nativeIterator.call(this); };</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// define iterator</span><span class="s3">\n  </span><span class="s1">if ((!IS_PURE || FORCED) &amp;&amp; IterablePrototype[ITERATOR] !== defaultIterator) {</span><span class="s3">\n    </span><span class="s1">createNonEnumerableProperty(IterablePrototype, ITERATOR, defaultIterator);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">Iterators[NAME] = defaultIterator;</span><span class="s3">\n\n  </span><span class="s1">// export additional methods</span><span class="s3">\n  </span><span class="s1">if (DEFAULT) {</span><span class="s3">\n    </span><span class="s1">methods = {</span><span class="s3">\n      </span><span class="s1">values: getIterationMethod(VALUES),</span><span class="s3">\n      </span><span class="s1">keys: IS_SET ? defaultIterator : getIterationMethod(KEYS),</span><span class="s3">\n      </span><span class="s1">entries: getIterationMethod(ENTRIES)</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n    </span><span class="s1">if (FORCED) for (KEY in methods) {</span><span class="s3">\n      </span><span class="s1">if (BUGGY_SAFARI_ITERATORS || INCORRECT_VALUES_NAME || !(KEY in IterablePrototype)) {</span><span class="s3">\n        </span><span class="s1">redefine(IterablePrototype, KEY, methods[KEY]);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">} else $({ target: NAME, proto: true, forced: BUGGY_SAFARI_ITERATORS || INCORRECT_VALUES_NAME }, methods);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return methods;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var fails = require('../internals/fails');</span><span class="s3">\n\n</span><span class="s1">module.exports = !!Object.getOwnPropertySymbols &amp;&amp; !fails(function () {</span><span class="s3">\n  </span><span class="s1">// Chrome 38 Symbol has incorrect toString conversion</span><span class="s3">\n  </span><span class="s1">// eslint-disable-next-line no-undef</span><span class="s3">\n  </span><span class="s1">return !String(Symbol());</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var anObject = require('../internals/an-object');</span><span class="s3">\n</span><span class="s1">var defineProperties = require('../internals/object-define-properties');</span><span class="s3">\n</span><span class="s1">var enumBugKeys = require('../internals/enum-bug-keys');</span><span class="s3">\n</span><span class="s1">var hiddenKeys = require('../internals/hidden-keys');</span><span class="s3">\n</span><span class="s1">var html = require('../internals/html');</span><span class="s3">\n</span><span class="s1">var documentCreateElement = require('../internals/document-create-element');</span><span class="s3">\n</span><span class="s1">var sharedKey = require('../internals/shared-key');</span><span class="s3">\n\n</span><span class="s1">var GT = '&gt;';</span><span class="s3">\n</span><span class="s1">var LT = '&lt;';</span><span class="s3">\n</span><span class="s1">var PROTOTYPE = 'prototype';</span><span class="s3">\n</span><span class="s1">var SCRIPT = 'script';</span><span class="s3">\n</span><span class="s1">var IE_PROTO = sharedKey('IE_PROTO');</span><span class="s3">\n\n</span><span class="s1">var EmptyConstructor = function () { /* empty */ };</span><span class="s3">\n\n</span><span class="s1">var scriptTag = function (content) {</span><span class="s3">\n  </span><span class="s1">return LT + SCRIPT + GT + content + LT + '/' + SCRIPT + GT;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">// Create object with fake `null` prototype: use ActiveX Object with cleared prototype</span><span class="s3">\n</span><span class="s1">var NullProtoObjectViaActiveX = function (activeXDocument) {</span><span class="s3">\n  </span><span class="s1">activeXDocument.write(scriptTag(''));</span><span class="s3">\n  </span><span class="s1">activeXDocument.close();</span><span class="s3">\n  </span><span class="s1">var temp = activeXDocument.parentWindow.Object;</span><span class="s3">\n  </span><span class="s1">activeXDocument = null; // avoid memory leak</span><span class="s3">\n  </span><span class="s1">return temp;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">// Create object with fake `null` prototype: use iframe Object with cleared prototype</span><span class="s3">\n</span><span class="s1">var NullProtoObjectViaIFrame = function () {</span><span class="s3">\n  </span><span class="s1">// Thrash, waste and sodomy: IE GC bug</span><span class="s3">\n  </span><span class="s1">var iframe = documentCreateElement('iframe');</span><span class="s3">\n  </span><span class="s1">var JS = 'java' + SCRIPT + ':';</span><span class="s3">\n  </span><span class="s1">var iframeDocument;</span><span class="s3">\n  </span><span class="s1">iframe.style.display = 'none';</span><span class="s3">\n  </span><span class="s1">html.appendChild(iframe);</span><span class="s3">\n  </span><span class="s1">// https://github.com/zloirock/core-js/issues/475</span><span class="s3">\n  </span><span class="s1">iframe.src = String(JS);</span><span class="s3">\n  </span><span class="s1">iframeDocument = iframe.contentWindow.document;</span><span class="s3">\n  </span><span class="s1">iframeDocument.open();</span><span class="s3">\n  </span><span class="s1">iframeDocument.write(scriptTag('document.F=Object'));</span><span class="s3">\n  </span><span class="s1">iframeDocument.close();</span><span class="s3">\n  </span><span class="s1">return iframeDocument.F;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">// Check for document.domain and active x support</span><span class="s3">\n</span><span class="s1">// No need to use active x approach when document.domain is not set</span><span class="s3">\n</span><span class="s1">// see https://github.com/es-shims/es5-shim/issues/150</span><span class="s3">\n</span><span class="s1">// variation of https://github.com/kitcambridge/es5-shim/commit/4f738ac066346</span><span class="s3">\n</span><span class="s1">// avoid IE GC bug</span><span class="s3">\n</span><span class="s1">var activeXDocument;</span><span class="s3">\n</span><span class="s1">var NullProtoObject = function () {</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">/* global ActiveXObject */</span><span class="s3">\n    </span><span class="s1">activeXDocument = document.domain &amp;&amp; new ActiveXObject('htmlfile');</span><span class="s3">\n  </span><span class="s1">} catch (error) { /* ignore */ }</span><span class="s3">\n  </span><span class="s1">NullProtoObject = activeXDocument ? NullProtoObjectViaActiveX(activeXDocument) : NullProtoObjectViaIFrame();</span><span class="s3">\n  </span><span class="s1">var length = enumBugKeys.length;</span><span class="s3">\n  </span><span class="s1">while (length--) delete NullProtoObject[PROTOTYPE][enumBugKeys[length]];</span><span class="s3">\n  </span><span class="s1">return NullProtoObject();</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">hiddenKeys[IE_PROTO] = true;</span><span class="s3">\n\n</span><span class="s1">// `Object.create` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.create</span><span class="s3">\n</span><span class="s1">module.exports = Object.create || function create(O, Properties) {</span><span class="s3">\n  </span><span class="s1">var result;</span><span class="s3">\n  </span><span class="s1">if (O !== null) {</span><span class="s3">\n    </span><span class="s1">EmptyConstructor[PROTOTYPE] = anObject(O);</span><span class="s3">\n    </span><span class="s1">result = new EmptyConstructor();</span><span class="s3">\n    </span><span class="s1">EmptyConstructor[PROTOTYPE] = null;</span><span class="s3">\n    </span><span class="s1">// add </span><span class="s3">\&quot;</span><span class="s1">__proto__</span><span class="s3">\&quot; </span><span class="s1">for Object.getPrototypeOf polyfill</span><span class="s3">\n    </span><span class="s1">result[IE_PROTO] = O;</span><span class="s3">\n  </span><span class="s1">} else result = NullProtoObject();</span><span class="s3">\n  </span><span class="s1">return Properties === undefined ? result : defineProperties(result, Properties);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var toIndexedObject = require('../internals/to-indexed-object');</span><span class="s3">\n</span><span class="s1">var toLength = require('../internals/to-length');</span><span class="s3">\n</span><span class="s1">var toAbsoluteIndex = require('../internals/to-absolute-index');</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.{ indexOf, includes }` methods implementation</span><span class="s3">\n</span><span class="s1">var createMethod = function (IS_INCLUDES) {</span><span class="s3">\n  </span><span class="s1">return function ($this, el, fromIndex) {</span><span class="s3">\n    </span><span class="s1">var O = toIndexedObject($this);</span><span class="s3">\n    </span><span class="s1">var length = toLength(O.length);</span><span class="s3">\n    </span><span class="s1">var index = toAbsoluteIndex(fromIndex, length);</span><span class="s3">\n    </span><span class="s1">var value;</span><span class="s3">\n    </span><span class="s1">// Array#includes uses SameValueZero equality algorithm</span><span class="s3">\n    </span><span class="s1">// eslint-disable-next-line no-self-compare</span><span class="s3">\n    </span><span class="s1">if (IS_INCLUDES &amp;&amp; el != el) while (length &gt; index) {</span><span class="s3">\n      </span><span class="s1">value = O[index++];</span><span class="s3">\n      </span><span class="s1">// eslint-disable-next-line no-self-compare</span><span class="s3">\n      </span><span class="s1">if (value != value) return true;</span><span class="s3">\n    </span><span class="s1">// Array#indexOf ignores holes, Array#includes - not</span><span class="s3">\n    </span><span class="s1">} else for (;length &gt; index; index++) {</span><span class="s3">\n      </span><span class="s1">if ((IS_INCLUDES || index in O) &amp;&amp; O[index] === el) return IS_INCLUDES || index || 0;</span><span class="s3">\n    </span><span class="s1">} return !IS_INCLUDES &amp;&amp; -1;</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">module.exports = {</span><span class="s3">\n  </span><span class="s1">// `Array.prototype.includes` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.includes</span><span class="s3">\n  </span><span class="s1">includes: createMethod(true),</span><span class="s3">\n  </span><span class="s1">// `Array.prototype.indexOf` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.indexof</span><span class="s3">\n  </span><span class="s1">indexOf: createMethod(false)</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var toInteger = require('../internals/to-integer');</span><span class="s3">\n\n</span><span class="s1">var max = Math.max;</span><span class="s3">\n</span><span class="s1">var min = Math.min;</span><span class="s3">\n\n</span><span class="s1">// Helper for a popular repeating case of the spec:</span><span class="s3">\n</span><span class="s1">// Let integer be ? ToInteger(index).</span><span class="s3">\n</span><span class="s1">// If integer &lt; 0, let result be max((length + integer), 0); else let result be min(integer, length).</span><span class="s3">\n</span><span class="s1">module.exports = function (index, length) {</span><span class="s3">\n  </span><span class="s1">var integer = toInteger(index);</span><span class="s3">\n  </span><span class="s1">return integer &lt; 0 ? max(integer + length, 0) : min(integer, length);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;// IE8- don't enum bug keys</span><span class="s3">\n</span><span class="s1">module.exports = [</span><span class="s3">\n  </span><span class="s1">'constructor',</span><span class="s3">\n  </span><span class="s1">'hasOwnProperty',</span><span class="s3">\n  </span><span class="s1">'isPrototypeOf',</span><span class="s3">\n  </span><span class="s1">'propertyIsEnumerable',</span><span class="s3">\n  </span><span class="s1">'toLocaleString',</span><span class="s3">\n  </span><span class="s1">'toString',</span><span class="s3">\n  </span><span class="s1">'valueOf'</span><span class="s3">\n</span><span class="s1">];</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">var TO_STRING_TAG = wellKnownSymbol('toStringTag');</span><span class="s3">\n</span><span class="s1">var test = {};</span><span class="s3">\n\n</span><span class="s1">test[TO_STRING_TAG] = 'z';</span><span class="s3">\n\n</span><span class="s1">module.exports = String(test) === '[object z]';</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = function () { /* empty */ };</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = function (it, Constructor, name) {</span><span class="s3">\n  </span><span class="s1">if (!(it instanceof Constructor)) {</span><span class="s3">\n    </span><span class="s1">throw TypeError('Incorrect ' + (name ? name + ' ' : '') + 'invocation');</span><span class="s3">\n  </span><span class="s1">} return it;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var getBuiltIn = require('../internals/get-built-in');</span><span class="s3">\n\n</span><span class="s1">module.exports = getBuiltIn('navigator', 'userAgent') || '';</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var aFunction = require('../internals/a-function');</span><span class="s3">\n\n</span><span class="s1">var PromiseCapability = function (C) {</span><span class="s3">\n  </span><span class="s1">var resolve, reject;</span><span class="s3">\n  </span><span class="s1">this.promise = new C(function ($$resolve, $$reject) {</span><span class="s3">\n    </span><span class="s1">if (resolve !== undefined || reject !== undefined) throw TypeError('Bad Promise constructor');</span><span class="s3">\n    </span><span class="s1">resolve = $$resolve;</span><span class="s3">\n    </span><span class="s1">reject = $$reject;</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n  </span><span class="s1">this.resolve = aFunction(resolve);</span><span class="s3">\n  </span><span class="s1">this.reject = aFunction(reject);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">// 25.4.1.5 NewPromiseCapability(C)</span><span class="s3">\n</span><span class="s1">module.exports.f = function (C) {</span><span class="s3">\n  </span><span class="s1">return new PromiseCapability(C);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var userAgent = require('../internals/engine-user-agent');</span><span class="s3">\n\n</span><span class="s1">var process = global.process;</span><span class="s3">\n</span><span class="s1">var versions = process &amp;&amp; process.versions;</span><span class="s3">\n</span><span class="s1">var v8 = versions &amp;&amp; versions.v8;</span><span class="s3">\n</span><span class="s1">var match, version;</span><span class="s3">\n\n</span><span class="s1">if (v8) {</span><span class="s3">\n  </span><span class="s1">match = v8.split('.');</span><span class="s3">\n  </span><span class="s1">version = match[0] + match[1];</span><span class="s3">\n</span><span class="s1">} else if (userAgent) {</span><span class="s3">\n  </span><span class="s1">match = userAgent.match(/Edge</span><span class="s3">\\</span><span class="s1">/(</span><span class="s3">\\</span><span class="s1">d+)/);</span><span class="s3">\n  </span><span class="s1">if (!match || match[1] &gt;= 74) {</span><span class="s3">\n    </span><span class="s1">match = userAgent.match(/Chrome</span><span class="s3">\\</span><span class="s1">/(</span><span class="s3">\\</span><span class="s1">d+)/);</span><span class="s3">\n    </span><span class="s1">if (match) version = match[1];</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">module.exports = version &amp;&amp; +version;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 编辑器 class</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement, DomElementSelector } from '../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { deepClone } from '../utils/util'</span><span class="s3">\n</span><span class="s1">import defaultConfig, { ConfigType } from '../config'</span><span class="s3">\n</span><span class="s1">import SelectionAndRangeAPI from './selection'</span><span class="s3">\n</span><span class="s1">import CommandAPI from './command'</span><span class="s3">\n</span><span class="s1">import Text from '../text/index'</span><span class="s3">\n</span><span class="s1">import Menus from '../menus/index'</span><span class="s3">\n</span><span class="s1">import initDom, { selectorValidator } from './init-fns/init-dom'</span><span class="s3">\n</span><span class="s1">import initSelection from './init-fns/init-selection'</span><span class="s3">\n</span><span class="s1">import bindEvent from './init-fns/bind-event'</span><span class="s3">\n</span><span class="s1">import i18nextInit from './init-fns/i18next-init'</span><span class="s3">\n</span><span class="s1">import initFullScreen, { setUnFullScreen, setFullScreen } from './init-fns/set-full-screen'</span><span class="s3">\n</span><span class="s1">import scrollToHead from './init-fns/scroll-to-head'</span><span class="s3">\n</span><span class="s1">import ZIndex from './z-index'</span><span class="s3">\n</span><span class="s1">import Change from './change/index'</span><span class="s3">\n</span><span class="s1">import History from './history/index'</span><span class="s3">\n</span><span class="s1">import disableInit from './disable'</span><span class="s3">\n</span><span class="s1">import SelectionChange from './selection-change'</span><span class="s3">\n\n</span><span class="s1">import initPlugins, { RegisterOptions, pluginsListType, registerPlugin } from '../plugins'</span><span class="s3">\n\n</span><span class="s1">// 创建菜单的 class</span><span class="s3">\n</span><span class="s1">import { MenuListType } from '../menus/menu-list'</span><span class="s3">\n</span><span class="s1">import BtnMenu from '../menus/menu-constructors/BtnMenu'</span><span class="s3">\n</span><span class="s1">import DropList from '../menus/menu-constructors/DropList'</span><span class="s3">\n</span><span class="s1">import DropListMenu from '../menus/menu-constructors/DropListMenu'</span><span class="s3">\n</span><span class="s1">import Panel from '../menus/menu-constructors/Panel'</span><span class="s3">\n</span><span class="s1">import PanelMenu from '../menus/menu-constructors/PanelMenu'</span><span class="s3">\n</span><span class="s1">import Tooltip from '../menus/menu-constructors/Tooltip'</span><span class="s3">\n\n</span><span class="s1">let EDITOR_ID = 1</span><span class="s3">\n\n</span><span class="s1">class Editor {</span><span class="s3">\n    </span><span class="s1">// 暴露 $</span><span class="s3">\n    </span><span class="s1">static $ = $</span><span class="s3">\n\n    </span><span class="s1">static BtnMenu = BtnMenu</span><span class="s3">\n    </span><span class="s1">static DropList = DropList</span><span class="s3">\n    </span><span class="s1">static DropListMenu = DropListMenu</span><span class="s3">\n    </span><span class="s1">static Panel = Panel</span><span class="s3">\n    </span><span class="s1">static PanelMenu = PanelMenu</span><span class="s3">\n    </span><span class="s1">static Tooltip = Tooltip</span><span class="s3">\n    </span><span class="s1">static globalCustomMenuConstructorList: MenuListType = {}</span><span class="s3">\n    </span><span class="s1">static globalPluginsFunctionList: pluginsListType = {}</span><span class="s3">\n    </span><span class="s1">public pluginsFunctionList: pluginsListType = {}</span><span class="s3">\n\n    </span><span class="s1">public id: string</span><span class="s3">\n    </span><span class="s1">public toolbarSelector: DomElementSelector</span><span class="s3">\n    </span><span class="s1">public textSelector?: DomElementSelector</span><span class="s3">\n    </span><span class="s1">public config: ConfigType</span><span class="s3">\n    </span><span class="s1">public $toolbarElem: DomElement</span><span class="s3">\n    </span><span class="s1">public $textContainerElem: DomElement</span><span class="s3">\n    </span><span class="s1">public $textElem: DomElement</span><span class="s3">\n    </span><span class="s1">public toolbarElemId: string</span><span class="s3">\n    </span><span class="s1">public textElemId: string</span><span class="s3">\n    </span><span class="s1">public isFocus: boolean</span><span class="s3">\n    </span><span class="s1">public isComposing: boolean</span><span class="s3">\n    </span><span class="s1">public isCompatibleMode: boolean</span><span class="s3">\n    </span><span class="s1">public selection: SelectionAndRangeAPI</span><span class="s3">\n    </span><span class="s1">public cmd: CommandAPI</span><span class="s3">\n    </span><span class="s1">public txt: Text</span><span class="s3">\n    </span><span class="s1">public menus: Menus</span><span class="s3">\n    </span><span class="s1">public i18next: any</span><span class="s3">\n    </span><span class="s1">public highlight: any</span><span class="s3">\n    </span><span class="s1">public zIndex: ZIndex</span><span class="s3">\n    </span><span class="s1">public change: Change</span><span class="s3">\n    </span><span class="s1">public history: History</span><span class="s3">\n    </span><span class="s1">public isEnable: Boolean</span><span class="s3">\n    </span><span class="s1">public onSelectionChange: SelectionChange</span><span class="s3">\n\n    </span><span class="s1">// 实例销毁前需要执行的钩子集合</span><span class="s3">\n    </span><span class="s1">private beforeDestroyHooks: Function[] = []</span><span class="s3">\n\n    </span><span class="s1">/** 禁用api */</span><span class="s3">\n    </span><span class="s1">public disable: Function</span><span class="s3">\n\n    </span><span class="s1">/** 启用api */</span><span class="s3">\n    </span><span class="s1">public enable: Function</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 构造函数</span><span class="s3">\n     </span><span class="s1">* @param toolbarSelector 工具栏 DOM selector</span><span class="s3">\n     </span><span class="s1">* @param textSelector 文本区域 DOM selector</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">constructor(toolbarSelector: DomElementSelector, textSelector?: DomElementSelector) {</span><span class="s3">\n        </span><span class="s1">// id，用以区分单个页面不同的编辑器对象</span><span class="s3">\n        </span><span class="s1">this.id = `wangEditor-${EDITOR_ID++}`</span><span class="s3">\n\n        </span><span class="s1">this.toolbarSelector = toolbarSelector</span><span class="s3">\n        </span><span class="s1">this.textSelector = textSelector</span><span class="s3">\n\n        </span><span class="s1">selectorValidator(this)</span><span class="s3">\n\n        </span><span class="s1">// 属性的默认值，后面可能会再修改</span><span class="s3">\n        </span><span class="s1">// 默认配置 - 当一个页面有多个编辑器的时候，因为 JS 的特性(引用类型)会导致多个编辑器的 config 引用是同一个，所以需要 深度克隆 断掉引用</span><span class="s3">\n        </span><span class="s1">this.config = deepClone(defaultConfig)</span><span class="s3">\n        </span><span class="s1">this.$toolbarElem = $('&lt;div&gt;&lt;/div&gt;')</span><span class="s3">\n        </span><span class="s1">this.$textContainerElem = $('&lt;div&gt;&lt;/div&gt;')</span><span class="s3">\n        </span><span class="s1">this.$textElem = $('&lt;div&gt;&lt;/div&gt;')</span><span class="s3">\n        </span><span class="s1">this.toolbarElemId = ''</span><span class="s3">\n        </span><span class="s1">this.textElemId = ''</span><span class="s3">\n        </span><span class="s1">this.isFocus = false</span><span class="s3">\n        </span><span class="s1">this.isComposing = false</span><span class="s3">\n        </span><span class="s1">this.isCompatibleMode = false</span><span class="s3">\n\n        </span><span class="s1">this.selection = new SelectionAndRangeAPI(this)</span><span class="s3">\n        </span><span class="s1">this.cmd = new CommandAPI(this)</span><span class="s3">\n        </span><span class="s1">this.txt = new Text(this)</span><span class="s3">\n        </span><span class="s1">this.menus = new Menus(this)</span><span class="s3">\n        </span><span class="s1">this.zIndex = new ZIndex()</span><span class="s3">\n        </span><span class="s1">this.change = new Change(this)</span><span class="s3">\n        </span><span class="s1">this.history = new History(this)</span><span class="s3">\n        </span><span class="s1">this.onSelectionChange = new SelectionChange(this)</span><span class="s3">\n\n        </span><span class="s1">const { disable, enable } = disableInit(this)</span><span class="s3">\n        </span><span class="s1">this.disable = disable</span><span class="s3">\n        </span><span class="s1">this.enable = enable</span><span class="s3">\n        </span><span class="s1">this.isEnable = true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 初始化选区</span><span class="s3">\n     </span><span class="s1">* @param newLine 新建一行</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public initSelection(newLine?: boolean): void {</span><span class="s3">\n        </span><span class="s1">initSelection(this, newLine)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 创建编辑器实例</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public create(): void {</span><span class="s3">\n        </span><span class="s1">// 初始化 ZIndex</span><span class="s3">\n        </span><span class="s1">this.zIndex.init(this)</span><span class="s3">\n\n        </span><span class="s1">// 确定当前的历史记录模式</span><span class="s3">\n        </span><span class="s1">this.isCompatibleMode = this.config.compatibleMode()</span><span class="s3">\n\n        </span><span class="s1">// 标准模式下，重置延迟时间</span><span class="s3">\n        </span><span class="s1">if (!this.isCompatibleMode) {</span><span class="s3">\n            </span><span class="s1">this.config.onchangeTimeout = 30</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 国际化 因为要在创建菜单前使用 所以要最先 初始化</span><span class="s3">\n        </span><span class="s1">i18nextInit(this)</span><span class="s3">\n\n        </span><span class="s1">// 初始化 DOM</span><span class="s3">\n        </span><span class="s1">initDom(this)</span><span class="s3">\n\n        </span><span class="s1">// 初始化 text</span><span class="s3">\n        </span><span class="s1">this.txt.init()</span><span class="s3">\n\n        </span><span class="s1">// 初始化菜单</span><span class="s3">\n        </span><span class="s1">this.menus.init()</span><span class="s3">\n\n        </span><span class="s1">// 初始化全屏功能</span><span class="s3">\n        </span><span class="s1">initFullScreen(this)</span><span class="s3">\n\n        </span><span class="s1">// 初始化选区，将光标定位到内容尾部</span><span class="s3">\n        </span><span class="s1">this.initSelection(true)</span><span class="s3">\n\n        </span><span class="s1">// 绑定事件</span><span class="s3">\n        </span><span class="s1">bindEvent(this)</span><span class="s3">\n\n        </span><span class="s1">// 绑定监听的目标节点</span><span class="s3">\n        </span><span class="s1">this.change.observe()</span><span class="s3">\n\n        </span><span class="s1">this.history.observe()</span><span class="s3">\n\n        </span><span class="s1">// 初始化插件</span><span class="s3">\n        </span><span class="s1">initPlugins(this)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 提供给用户添加销毁前的钩子函数</span><span class="s3">\n     </span><span class="s1">* @param fn 钩子函数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public beforeDestroy(fn: Function): Editor {</span><span class="s3">\n        </span><span class="s1">this.beforeDestroyHooks.push(fn)</span><span class="s3">\n        </span><span class="s1">return this</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 销毁当前编辑器实例</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public destroy(): void {</span><span class="s3">\n        </span><span class="s1">// 调用钩子函数</span><span class="s3">\n        </span><span class="s1">this.beforeDestroyHooks.forEach(fn =&gt; fn.call(this))</span><span class="s3">\n        </span><span class="s1">// 销毁 DOM 节点</span><span class="s3">\n        </span><span class="s1">this.$toolbarElem.remove()</span><span class="s3">\n        </span><span class="s1">this.$textContainerElem.remove()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 将编辑器设置为全屏</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public fullScreen(): void {</span><span class="s3">\n        </span><span class="s1">setFullScreen(this)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 将编辑器退出全屏</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public unFullScreen(): void {</span><span class="s3">\n        </span><span class="s1">setUnFullScreen(this)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 滚动到指定标题锚点</span><span class="s3">\n     </span><span class="s1">* @param id 标题锚点id</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public scrollToHead(id: string): void {</span><span class="s3">\n        </span><span class="s1">scrollToHead(this, id)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 自定义添加菜单</span><span class="s3">\n     </span><span class="s1">* @param key 菜单 key</span><span class="s3">\n     </span><span class="s1">* @param Menu 菜单构造函数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">static registerMenu(key: string, Menu: any) {</span><span class="s3">\n        </span><span class="s1">if (!Menu || typeof Menu !== 'function') return</span><span class="s3">\n        </span><span class="s1">Editor.globalCustomMenuConstructorList[key] = Menu</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 自定义添加插件</span><span class="s3">\n     </span><span class="s1">* @param { string } name 插件的名称</span><span class="s3">\n     </span><span class="s1">* @param { RegisterOptions } options 插件的选项</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public registerPlugin(name: string, options: RegisterOptions) {</span><span class="s3">\n        </span><span class="s1">registerPlugin(name, options, this.pluginsFunctionList)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 自定义添加插件</span><span class="s3">\n     </span><span class="s1">* @param { string } name 插件的名称</span><span class="s3">\n     </span><span class="s1">* @param { RegisterOptions } options 插件的选项</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">static registerPlugin(name: string, options: RegisterOptions) {</span><span class="s3">\n        </span><span class="s1">registerPlugin(name, options, Editor.globalPluginsFunctionList)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Editor</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var isObject = require('../internals/is-object');</span><span class="s3">\n</span><span class="s1">var isArray = require('../internals/is-array');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">var SPECIES = wellKnownSymbol('species');</span><span class="s3">\n\n</span><span class="s1">// `ArraySpeciesCreate` abstract operation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-arrayspeciescreate</span><span class="s3">\n</span><span class="s1">module.exports = function (originalArray, length) {</span><span class="s3">\n  </span><span class="s1">var C;</span><span class="s3">\n  </span><span class="s1">if (isArray(originalArray)) {</span><span class="s3">\n    </span><span class="s1">C = originalArray.constructor;</span><span class="s3">\n    </span><span class="s1">// cross-realm fallback</span><span class="s3">\n    </span><span class="s1">if (typeof C == 'function' &amp;&amp; (C === Array || isArray(C.prototype))) C = undefined;</span><span class="s3">\n    </span><span class="s1">else if (isObject(C)) {</span><span class="s3">\n      </span><span class="s1">C = C[SPECIES];</span><span class="s3">\n      </span><span class="s1">if (C === null) C = undefined;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">} return new (C === undefined ? Array : C)(length === 0 ? 0 : length);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/array/is-array</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var requireObjectCoercible = require('../internals/require-object-coercible');</span><span class="s3">\n</span><span class="s1">var whitespaces = require('../internals/whitespaces');</span><span class="s3">\n\n</span><span class="s1">var whitespace = '[' + whitespaces + ']';</span><span class="s3">\n</span><span class="s1">var ltrim = RegExp('^' + whitespace + whitespace + '*');</span><span class="s3">\n</span><span class="s1">var rtrim = RegExp(whitespace + whitespace + '*$');</span><span class="s3">\n\n</span><span class="s1">// `String.prototype.{ trim, trimStart, trimEnd, trimLeft, trimRight }` methods implementation</span><span class="s3">\n</span><span class="s1">var createMethod = function (TYPE) {</span><span class="s3">\n  </span><span class="s1">return function ($this) {</span><span class="s3">\n    </span><span class="s1">var string = String(requireObjectCoercible($this));</span><span class="s3">\n    </span><span class="s1">if (TYPE &amp; 1) string = string.replace(ltrim, '');</span><span class="s3">\n    </span><span class="s1">if (TYPE &amp; 2) string = string.replace(rtrim, '');</span><span class="s3">\n    </span><span class="s1">return string;</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">module.exports = {</span><span class="s3">\n  </span><span class="s1">// `String.prototype.{ trimLeft, trimStart }` methods</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-string.prototype.trimstart</span><span class="s3">\n  </span><span class="s1">start: createMethod(1),</span><span class="s3">\n  </span><span class="s1">// `String.prototype.{ trimRight, trimEnd }` methods</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-string.prototype.trimend</span><span class="s3">\n  </span><span class="s1">end: createMethod(2),</span><span class="s3">\n  </span><span class="s1">// `String.prototype.trim` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-string.prototype.trim</span><span class="s3">\n  </span><span class="s1">trim: createMethod(3)</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/instance/splice</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var _Symbol$iterator = require(</span><span class="s3">\&quot;</span><span class="s1">../core-js/symbol/iterator</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n\n</span><span class="s1">var _Symbol = require(</span><span class="s3">\&quot;</span><span class="s1">../core-js/symbol</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n\n</span><span class="s1">function _typeof(obj) {</span><span class="s3">\n  \&quot;</span><span class="s1">@babel/helpers - typeof</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n\n  </span><span class="s1">if (typeof _Symbol === </span><span class="s3">\&quot;</span><span class="s1">function</span><span class="s3">\&quot; </span><span class="s1">&amp;&amp; typeof _Symbol$iterator === </span><span class="s3">\&quot;</span><span class="s1">symbol</span><span class="s3">\&quot;</span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">module.exports = _typeof = function _typeof(obj) {</span><span class="s3">\n      </span><span class="s1">return typeof obj;</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">module.exports = _typeof = function _typeof(obj) {</span><span class="s3">\n      </span><span class="s1">return obj &amp;&amp; typeof _Symbol === </span><span class="s3">\&quot;</span><span class="s1">function</span><span class="s3">\&quot; </span><span class="s1">&amp;&amp; obj.constructor === _Symbol &amp;&amp; obj !== _Symbol.prototype ? </span><span class="s3">\&quot;</span><span class="s1">symbol</span><span class="s3">\&quot; </span><span class="s1">: typeof obj;</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return _typeof(obj);</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">module.exports = _typeof;&quot;</span><span class="s0">,</span><span class="s1">&quot;var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">exports.f = wellKnownSymbol;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/object/entries</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description Menu class 父类</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import Panel from './Panel'</span><span class="s3">\n\n</span><span class="s1">export interface MenuActive {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 修改菜单激活状态，菜单是否高亮</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">tryChangeActive(): void</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">class Menu {</span><span class="s3">\n    </span><span class="s1">public key: string | undefined</span><span class="s3">\n    </span><span class="s1">public $elem: DomElement</span><span class="s3">\n    </span><span class="s1">public editor: Editor</span><span class="s3">\n    </span><span class="s1">private _active: boolean // 菜单是否处于激活状态，如选中一段加粗文字时，bold 菜单要被激活（即高亮显示）</span><span class="s3">\n\n    </span><span class="s1">constructor($elem: DomElement, editor: Editor) {</span><span class="s3">\n        </span><span class="s1">this.$elem = $elem</span><span class="s3">\n        </span><span class="s1">this.editor = editor</span><span class="s3">\n        </span><span class="s1">this._active = false</span><span class="s3">\n\n        </span><span class="s1">// 绑定菜单点击事件</span><span class="s3">\n        </span><span class="s1">$elem.on('click', (e: Event) =&gt; {</span><span class="s3">\n            </span><span class="s1">Panel.hideCurAllPanels() // 隐藏当前的所有 Panel</span><span class="s3">\n\n            </span><span class="s1">// 触发菜单点击的钩子</span><span class="s3">\n            </span><span class="s1">editor.txt.eventHooks.menuClickEvents.forEach(fn =&gt; fn())</span><span class="s3">\n\n            </span><span class="s1">e.stopPropagation()</span><span class="s3">\n            </span><span class="s1">if (editor.selection.getRange() == null) {</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">this.clickHandler(e)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 菜单点击事件，子类可重写</span><span class="s3">\n     </span><span class="s1">* @param e event</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected clickHandler(e: Event): void {}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 激活菜单，高亮显示</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected active(): void {</span><span class="s3">\n        </span><span class="s1">this._active = true</span><span class="s3">\n        </span><span class="s1">this.$elem.addClass('w-e-active')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 取消激活，不再高亮显示</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected unActive(): void {</span><span class="s3">\n        </span><span class="s1">this._active = false</span><span class="s3">\n        </span><span class="s1">this.$elem.removeClass('w-e-active')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 是否处于激活状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public get isActive() {</span><span class="s3">\n        </span><span class="s1">return this._active</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Menu</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 检查选区是否在链接中，即菜单是否应该 active</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { DomElement } from '../../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">// 加粗 b</span><span class="s3">\n</span><span class="s1">// 字号/字体/颜色 font</span><span class="s3">\n</span><span class="s1">// 斜体 i</span><span class="s3">\n</span><span class="s1">// 删除线 strike</span><span class="s3">\n</span><span class="s1">export const EXTRA_TAG = ['B', 'FONT', 'I', 'STRIKE']</span><span class="s3">\n\n</span><span class="s1">export function getParentNodeA(selectionELem: DomElement) {</span><span class="s3">\n    </span><span class="s1">let node = selectionELem.elems[0]</span><span class="s3">\n\n    </span><span class="s1">while (node &amp;&amp; EXTRA_TAG.includes(node.nodeName)) {</span><span class="s3">\n        </span><span class="s1">node = node.parentElement!</span><span class="s3">\n\n        </span><span class="s1">if (node.nodeName === 'A') {</span><span class="s3">\n            </span><span class="s1">return node</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function isActive(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const $selectionELem = editor.selection.getSelectionContainerElem()</span><span class="s3">\n\n    </span><span class="s1">if (!$selectionELem?.elems?.length) {</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 选中直接是a元素</span><span class="s3">\n    </span><span class="s1">if ($selectionELem.getNodeName() === 'A') {</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 有可能a里面嵌套了其他元素，比如b、i元素等</span><span class="s3">\n    </span><span class="s1">const parentNode = getParentNodeA($selectionELem)</span><span class="s3">\n\n    </span><span class="s1">if (parentNode &amp;&amp; parentNode.nodeName === 'A') {</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return false</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default isActive</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 上传图片</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { arrForEach, forEach } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import post from '../../editor/upload/upload-core'</span><span class="s3">\n</span><span class="s1">import Progress from '../../editor/upload/progress'</span><span class="s3">\n\n</span><span class="s1">type ResImgItemType = string | { url: string; alt?: string; href?: string }</span><span class="s3">\n\n</span><span class="s1">export type ResType = {</span><span class="s3">\n    </span><span class="s1">errno: number | string</span><span class="s3">\n    </span><span class="s1">data: ResImgItemType[]</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">class UploadImg {</span><span class="s3">\n    </span><span class="s1">private editor: Editor</span><span class="s3">\n\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">this.editor = editor</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 往编辑区域插入图片</span><span class="s3">\n     </span><span class="s1">* @param src 图片地址</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public insertImg(src: string, alt?: string, href?: string): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const config = editor.config</span><span class="s3">\n\n        </span><span class="s1">const i18nPrefix = 'validate.'</span><span class="s3">\n        </span><span class="s1">const t = (text: string, prefix: string = i18nPrefix): string =&gt; {</span><span class="s3">\n            </span><span class="s1">return editor.i18next.t(prefix + text)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">/**</span><span class="s3">\n         </span><span class="s1">* fix: insertImg xss</span><span class="s3">\n         </span><span class="s1">*/</span><span class="s3">\n\n        </span><span class="s1">// 过滤src, 防止xss</span><span class="s3">\n        </span><span class="s1">let resultSrc = src.replace(/&lt;/g, '&amp;lt;').replace(/&gt;/g, '&amp;gt;')</span><span class="s3">\n\n        </span><span class="s1">// 因为下面要单引号拼接字符串, 所以要将单引号替换成双引号</span><span class="s3">\n        </span><span class="s1">resultSrc = resultSrc.replace(</span><span class="s3">\&quot;</span><span class="s1">'</span><span class="s3">\&quot;</span><span class="s1">, '</span><span class="s3">\&quot;</span><span class="s1">')</span><span class="s3">\n\n        </span><span class="s1">let hrefText = ''</span><span class="s3">\n\n        </span><span class="s1">// 设置图片的元数据 data-</span><span class="s3">\n        </span><span class="s1">if (href) {</span><span class="s3">\n            </span><span class="s1">hrefText = href.replace(</span><span class="s3">\&quot;</span><span class="s1">'</span><span class="s3">\&quot;</span><span class="s1">, '</span><span class="s3">\&quot;</span><span class="s1">')</span><span class="s3">\n\n            </span><span class="s1">hrefText = `data-href='${encodeURIComponent(hrefText)}' `</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">let altText = ''</span><span class="s3">\n        </span><span class="s1">// 设置图片alt, 过滤xss标签攻击</span><span class="s3">\n        </span><span class="s1">if (alt) {</span><span class="s3">\n            </span><span class="s1">altText = alt.replace(/&lt;/g, '&amp;lt;').replace(/&gt;/g, '&amp;gt;')</span><span class="s3">\n\n            </span><span class="s1">// 因为下面要单引号拼接字符串, 所以要将单引号替换成双引号</span><span class="s3">\n            </span><span class="s1">altText = altText.replace(</span><span class="s3">\&quot;</span><span class="s1">'</span><span class="s3">\&quot;</span><span class="s1">, '</span><span class="s3">\&quot;</span><span class="s1">')</span><span class="s3">\n\n            </span><span class="s1">altText = `alt='${altText}' `</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 先插入图片，无论是否能成功</span><span class="s3">\n        </span><span class="s1">editor.cmd.do(</span><span class="s3">\n            </span><span class="s1">'insertHTML',</span><span class="s3">\n            </span><span class="s1">`&lt;img src='${resultSrc}' ${altText}${hrefText}style=</span><span class="s3">\&quot;</span><span class="s1">max-width:100%;</span><span class="s3">\&quot; </span><span class="s1">contenteditable=</span><span class="s3">\&quot;</span><span class="s1">false</span><span class="s3">\&quot;</span><span class="s1">/&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">// 执行回调函数</span><span class="s3">\n        </span><span class="s1">config.linkImgCallback(src, alt, href)</span><span class="s3">\n\n        </span><span class="s1">// 加载图片</span><span class="s3">\n        </span><span class="s1">let img: any = document.createElement('img')</span><span class="s3">\n        </span><span class="s1">img.onload = () =&gt; {</span><span class="s3">\n            </span><span class="s1">img = null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">img.onerror = () =&gt; {</span><span class="s3">\n            </span><span class="s1">config.customAlert(</span><span class="s3">\n                </span><span class="s1">t('插入图片错误'),</span><span class="s3">\n                </span><span class="s1">'error',</span><span class="s3">\n                </span><span class="s1">`wangEditor: ${t('插入图片错误')}，${t('图片链接')} </span><span class="s3">\&quot;</span><span class="s1">${src}</span><span class="s3">\&quot;</span><span class="s1">，${t('下载链接失败')}`</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n            </span><span class="s1">img = null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">img.onabort = () =&gt; (img = null)</span><span class="s3">\n        </span><span class="s1">img.src = src</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 上传图片</span><span class="s3">\n     </span><span class="s1">* @param files 文件列表</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public uploadImg(files: FileList | File[]): void {</span><span class="s3">\n        </span><span class="s1">if (!files.length) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const config = editor.config</span><span class="s3">\n\n        </span><span class="s1">// ------------------------------ i18next ------------------------------</span><span class="s3">\n\n        </span><span class="s1">const i18nPrefix = 'validate.'</span><span class="s3">\n        </span><span class="s1">const t = (text: string): string =&gt; {</span><span class="s3">\n            </span><span class="s1">return editor.i18next.t(i18nPrefix + text)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// ------------------------------ 获取配置信息 ------------------------------</span><span class="s3">\n\n        </span><span class="s1">// 服务端地址</span><span class="s3">\n        </span><span class="s1">let uploadImgServer = config.uploadImgServer</span><span class="s3">\n        </span><span class="s1">// base64 格式</span><span class="s3">\n        </span><span class="s1">const uploadImgShowBase64 = config.uploadImgShowBase64</span><span class="s3">\n        </span><span class="s1">// 图片最大体积</span><span class="s3">\n        </span><span class="s1">const maxSize = config.uploadImgMaxSize</span><span class="s3">\n        </span><span class="s1">const maxSizeM = maxSize / 1024 / 1024</span><span class="s3">\n        </span><span class="s1">// 一次最多上传图片数量</span><span class="s3">\n        </span><span class="s1">const maxLength = config.uploadImgMaxLength</span><span class="s3">\n        </span><span class="s1">// 自定义 fileName</span><span class="s3">\n        </span><span class="s1">const uploadFileName = config.uploadFileName</span><span class="s3">\n        </span><span class="s1">// 自定义参数</span><span class="s3">\n        </span><span class="s1">const uploadImgParams = config.uploadImgParams</span><span class="s3">\n        </span><span class="s1">// 参数拼接到 url 中</span><span class="s3">\n        </span><span class="s1">const uploadImgParamsWithUrl = config.uploadImgParamsWithUrl</span><span class="s3">\n        </span><span class="s1">// 自定义 header</span><span class="s3">\n        </span><span class="s1">const uploadImgHeaders = config.uploadImgHeaders</span><span class="s3">\n        </span><span class="s1">// 钩子函数</span><span class="s3">\n        </span><span class="s1">const hooks = config.uploadImgHooks</span><span class="s3">\n        </span><span class="s1">// 上传图片超时时间</span><span class="s3">\n        </span><span class="s1">const timeout = config.uploadImgTimeout</span><span class="s3">\n        </span><span class="s1">// 跨域带 cookie</span><span class="s3">\n        </span><span class="s1">const withCredentials = config.withCredentials</span><span class="s3">\n        </span><span class="s1">// 自定义上传图片</span><span class="s3">\n        </span><span class="s1">const customUploadImg = config.customUploadImg</span><span class="s3">\n\n        </span><span class="s1">if (!customUploadImg) {</span><span class="s3">\n            </span><span class="s1">// 没有 customUploadImg 的情况下，需要如下两个配置才能继续进行图片上传</span><span class="s3">\n            </span><span class="s1">if (!uploadImgServer &amp;&amp; !uploadImgShowBase64) {</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// ------------------------------ 验证文件信息 ------------------------------</span><span class="s3">\n        </span><span class="s1">const resultFiles: File[] = []</span><span class="s3">\n        </span><span class="s1">const errInfos: string[] = []</span><span class="s3">\n        </span><span class="s1">arrForEach(files, file =&gt; {</span><span class="s3">\n            </span><span class="s1">// chrome 低版本 粘贴一张图时files为 [null, File]</span><span class="s3">\n            </span><span class="s1">if (!file) return</span><span class="s3">\n\n            </span><span class="s1">const name = file.name || file.type.replace('/', '.') // 兼容低版本chrome 没有name</span><span class="s3">\n            </span><span class="s1">const size = file.size</span><span class="s3">\n\n            </span><span class="s1">// chrome 低版本 name === undefined</span><span class="s3">\n            </span><span class="s1">if (!name || !size) {</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 将uploadImgAccept数组转换为正则对象</span><span class="s3">\n            </span><span class="s1">const imgType = editor.config.uploadImgAccept.join('|')</span><span class="s3">\n            </span><span class="s1">const imgTypeRuleStr = `.(${imgType})$`</span><span class="s3">\n            </span><span class="s1">const uploadImgAcceptRule = new RegExp(imgTypeRuleStr, 'i')</span><span class="s3">\n            </span><span class="s1">if (uploadImgAcceptRule.test(name) === false) {</span><span class="s3">\n                </span><span class="s1">// 后缀名不合法，不是图片</span><span class="s3">\n                </span><span class="s1">errInfos.push(`【${name}】${t('不是图片')}`)</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">if (maxSize &lt; size) {</span><span class="s3">\n                </span><span class="s1">// 上传图片过大</span><span class="s3">\n                </span><span class="s1">errInfos.push(`【${name}】${t('大于')} ${maxSizeM}M`)</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 验证通过的加入结果列表</span><span class="s3">\n            </span><span class="s1">resultFiles.push(file)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">// 抛出验证信息</span><span class="s3">\n        </span><span class="s1">if (errInfos.length) {</span><span class="s3">\n            </span><span class="s1">config.customAlert(`${t('图片验证未通过')}: </span><span class="s3">\\</span><span class="s1">n` + errInfos.join('</span><span class="s3">\\</span><span class="s1">n'), 'warning')</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 如果过滤后文件列表为空直接返回</span><span class="s3">\n        </span><span class="s1">if (resultFiles.length === 0) {</span><span class="s3">\n            </span><span class="s1">config.customAlert(t('传入的文件不合法'), 'warning')</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (resultFiles.length &gt; maxLength) {</span><span class="s3">\n            </span><span class="s1">config.customAlert(t('一次最多上传') + maxLength + t('张图片'), 'warning')</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// ------------------------------ 自定义上传 ------------------------------</span><span class="s3">\n        </span><span class="s1">if (customUploadImg &amp;&amp; typeof customUploadImg === 'function') {</span><span class="s3">\n            </span><span class="s1">customUploadImg(resultFiles, this.insertImg.bind(this))</span><span class="s3">\n\n            </span><span class="s1">// 阻止以下代码执行，重要！！！</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// ------------------------------ 上传图片 ------------------------------</span><span class="s3">\n\n        </span><span class="s1">// 添加图片数据</span><span class="s3">\n        </span><span class="s1">const formData = new FormData()</span><span class="s3">\n        </span><span class="s1">resultFiles.forEach((file: File, index: number) =&gt; {</span><span class="s3">\n            </span><span class="s1">let name = uploadFileName || file.name</span><span class="s3">\n            </span><span class="s1">if (resultFiles.length &gt; 1) {</span><span class="s3">\n                </span><span class="s1">// 多个文件时，filename 不能重复</span><span class="s3">\n                </span><span class="s1">name = name + (index + 1)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">formData.append(name, file)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">if (uploadImgServer) {</span><span class="s3">\n            </span><span class="s1">// 添加自定义参数</span><span class="s3">\n            </span><span class="s1">const uploadImgServerArr = uploadImgServer.split('#')</span><span class="s3">\n            </span><span class="s1">uploadImgServer = uploadImgServerArr[0]</span><span class="s3">\n            </span><span class="s1">const uploadImgServerHash = uploadImgServerArr[1] || ''</span><span class="s3">\n            </span><span class="s1">forEach(uploadImgParams, (key: string, val: string) =&gt; {</span><span class="s3">\n                </span><span class="s1">// 因使用者反应，自定义参数不能默认 encode ，由 v3.1.1 版本开始注释掉</span><span class="s3">\n                </span><span class="s1">// val = encodeURIComponent(val)</span><span class="s3">\n\n                </span><span class="s1">// 第一，将参数拼接到 url 中</span><span class="s3">\n                </span><span class="s1">if (uploadImgParamsWithUrl) {</span><span class="s3">\n                    </span><span class="s1">if (uploadImgServer.indexOf('?') &gt; 0) {</span><span class="s3">\n                        </span><span class="s1">uploadImgServer += '&amp;'</span><span class="s3">\n                    </span><span class="s1">} else {</span><span class="s3">\n                        </span><span class="s1">uploadImgServer += '?'</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">uploadImgServer = uploadImgServer + key + '=' + val</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// 第二，将参数添加到 formData 中</span><span class="s3">\n                </span><span class="s1">formData.append(key, val)</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">if (uploadImgServerHash) {</span><span class="s3">\n                </span><span class="s1">uploadImgServer += '#' + uploadImgServerHash</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 开始上传</span><span class="s3">\n            </span><span class="s1">const xhr = post(uploadImgServer, {</span><span class="s3">\n                </span><span class="s1">timeout,</span><span class="s3">\n                </span><span class="s1">formData,</span><span class="s3">\n                </span><span class="s1">headers: uploadImgHeaders,</span><span class="s3">\n                </span><span class="s1">withCredentials: !!withCredentials,</span><span class="s3">\n                </span><span class="s1">beforeSend: xhr =&gt; {</span><span class="s3">\n                    </span><span class="s1">if (hooks.before) return hooks.before(xhr, editor, resultFiles)</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">onTimeout: xhr =&gt; {</span><span class="s3">\n                    </span><span class="s1">config.customAlert(t('上传图片超时'), 'error')</span><span class="s3">\n                    </span><span class="s1">if (hooks.timeout) hooks.timeout(xhr, editor)</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">onProgress: (percent, e) =&gt; {</span><span class="s3">\n                    </span><span class="s1">const progressBar = new Progress(editor)</span><span class="s3">\n                    </span><span class="s1">if (e.lengthComputable) {</span><span class="s3">\n                        </span><span class="s1">percent = e.loaded / e.total</span><span class="s3">\n                        </span><span class="s1">progressBar.show(percent)</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">onError: xhr =&gt; {</span><span class="s3">\n                    </span><span class="s1">config.customAlert(</span><span class="s3">\n                        </span><span class="s1">t('上传图片错误'),</span><span class="s3">\n                        </span><span class="s1">'error',</span><span class="s3">\n                        </span><span class="s1">`${t('上传图片错误')}，${t('服务器返回状态')}: ${xhr.status}`</span><span class="s3">\n                    </span><span class="s1">)</span><span class="s3">\n                    </span><span class="s1">if (hooks.error) hooks.error(xhr, editor)</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">onFail: (xhr, resultStr) =&gt; {</span><span class="s3">\n                    </span><span class="s1">config.customAlert(</span><span class="s3">\n                        </span><span class="s1">t('上传图片失败'),</span><span class="s3">\n                        </span><span class="s1">'error',</span><span class="s3">\n                        </span><span class="s1">t('上传图片返回结果错误') + `，${t('返回结果')}: ` + resultStr</span><span class="s3">\n                    </span><span class="s1">)</span><span class="s3">\n                    </span><span class="s1">if (hooks.fail) hooks.fail(xhr, editor, resultStr)</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">onSuccess: (xhr, result: ResType) =&gt; {</span><span class="s3">\n                    </span><span class="s1">if (hooks.customInsert) {</span><span class="s3">\n                        </span><span class="s1">// 自定义插入图片</span><span class="s3">\n                        </span><span class="s1">hooks.customInsert(this.insertImg.bind(this), result, editor)</span><span class="s3">\n                        </span><span class="s1">return</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">if (result.errno != '0') {</span><span class="s3">\n                        </span><span class="s1">// 返回格式不对，应该为 { errno: 0, data: [...] }</span><span class="s3">\n                        </span><span class="s1">config.customAlert(</span><span class="s3">\n                            </span><span class="s1">t('上传图片失败'),</span><span class="s3">\n                            </span><span class="s1">'error',</span><span class="s3">\n                            </span><span class="s1">`${t('上传图片返回结果错误')}，${t('返回结果')} errno=${result.errno}`</span><span class="s3">\n                        </span><span class="s1">)</span><span class="s3">\n                        </span><span class="s1">if (hooks.fail) hooks.fail(xhr, editor, result)</span><span class="s3">\n                        </span><span class="s1">return</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n\n                    </span><span class="s1">// 成功，插入图片</span><span class="s3">\n                    </span><span class="s1">const data = result.data</span><span class="s3">\n                    </span><span class="s1">data.forEach(link =&gt; {</span><span class="s3">\n                        </span><span class="s1">if (typeof link === 'string') {</span><span class="s3">\n                            </span><span class="s1">this.insertImg(link)</span><span class="s3">\n                        </span><span class="s1">} else {</span><span class="s3">\n                            </span><span class="s1">this.insertImg(link.url, link.alt, link.href)</span><span class="s3">\n                        </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">})</span><span class="s3">\n\n                    </span><span class="s1">// 钩子函数</span><span class="s3">\n                    </span><span class="s1">if (hooks.success) hooks.success(xhr, editor, result)</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">if (typeof xhr === 'string') {</span><span class="s3">\n                </span><span class="s1">// 上传被阻止</span><span class="s3">\n                </span><span class="s1">config.customAlert(xhr, 'error')</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 阻止以下代码执行，重要！！！</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// ------------------------------ 显示 base64 格式 ------------------------------</span><span class="s3">\n        </span><span class="s1">if (uploadImgShowBase64) {</span><span class="s3">\n            </span><span class="s1">arrForEach(files, file =&gt; {</span><span class="s3">\n                </span><span class="s1">const _this = this</span><span class="s3">\n                </span><span class="s1">const reader = new FileReader()</span><span class="s3">\n                </span><span class="s1">reader.readAsDataURL(file)</span><span class="s3">\n                </span><span class="s1">reader.onload = function () {</span><span class="s3">\n                    </span><span class="s1">if (!this.result) return</span><span class="s3">\n                    </span><span class="s1">const imgLink = this.result.toString()</span><span class="s3">\n                    </span><span class="s1">_this.insertImg(imgLink, imgLink)</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default UploadImg</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 判断传入的单行顶级选区选取是不是todo</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器对象</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function isTodo($topSelectElem: DomElement) {</span><span class="s3">\n    </span><span class="s1">if ($topSelectElem.length) {</span><span class="s3">\n        </span><span class="s1">return $topSelectElem.attr('class') === 'w-e-todo'</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return false</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 判断选中的内容是不是都是todo</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器对象</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function isAllTodo(editor: Editor): boolean | undefined {</span><span class="s3">\n    </span><span class="s1">const $topSelectElems = editor.selection.getSelectionRangeTopNodes()</span><span class="s3">\n    </span><span class="s1">// 排除为[]的情况</span><span class="s3">\n    </span><span class="s1">if ($topSelectElems.length === 0) return</span><span class="s3">\n\n    </span><span class="s1">return $topSelectElems.every($topSelectElem =&gt; {</span><span class="s3">\n        </span><span class="s1">return isTodo($topSelectElem)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 根据所在的文本节点和光标在文本节点的位置获取截断的后节点内容</span><span class="s3">\n </span><span class="s1">* @param node 顶级节点</span><span class="s3">\n </span><span class="s1">* @param textNode 光标所在的文本节点</span><span class="s3">\n </span><span class="s1">* @param pos 光标在文本节点的位置</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function getCursorNextNode(node: Node, textNode: Node, pos: number): Node | undefined {</span><span class="s3">\n    </span><span class="s1">if (!node.hasChildNodes()) return</span><span class="s3">\n\n    </span><span class="s1">const newNode = node.cloneNode() as ChildNode</span><span class="s3">\n    </span><span class="s1">// 判断光标是否在末尾</span><span class="s3">\n    </span><span class="s1">let end = false</span><span class="s3">\n    </span><span class="s1">if (textNode.nodeValue === '') {</span><span class="s3">\n        </span><span class="s1">end = true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">let delArr: Node[] = []</span><span class="s3">\n    </span><span class="s1">node.childNodes.forEach(v =&gt; {</span><span class="s3">\n        </span><span class="s1">//光标后的内容</span><span class="s3">\n        </span><span class="s1">if (!isContains(v, textNode) &amp;&amp; end) {</span><span class="s3">\n            </span><span class="s1">newNode.appendChild(v.cloneNode(true))</span><span class="s3">\n            </span><span class="s1">if (v.nodeName !== 'BR') {</span><span class="s3">\n                </span><span class="s1">delArr.push(v)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// 光标所在的区域</span><span class="s3">\n        </span><span class="s1">if (isContains(v, textNode)) {</span><span class="s3">\n            </span><span class="s1">if (v.nodeType === 1) {</span><span class="s3">\n                </span><span class="s1">const childNode = getCursorNextNode(v, textNode, pos) as Node</span><span class="s3">\n                </span><span class="s1">if (childNode &amp;&amp; childNode.textContent !== '') newNode?.appendChild(childNode)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">if (v.nodeType === 3) {</span><span class="s3">\n                </span><span class="s1">if (textNode.isEqualNode(v)) {</span><span class="s3">\n                    </span><span class="s1">const textContent = dealTextNode(v, pos)</span><span class="s3">\n                    </span><span class="s1">newNode.textContent = textContent</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">end = true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">// 删除选中后原来的节点</span><span class="s3">\n    </span><span class="s1">delArr.forEach(v =&gt; {</span><span class="s3">\n        </span><span class="s1">const node = v as ChildNode</span><span class="s3">\n        </span><span class="s1">node.remove()</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">return newNode</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 判断otherNode是否包含在node中</span><span class="s3">\n </span><span class="s1">* @param node 父节点</span><span class="s3">\n </span><span class="s1">* @param otherNode 需要判断是不是被包含的节点</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function isContains(node: Node, otherNode: Node) {</span><span class="s3">\n    </span><span class="s1">// 兼容ie11中textNode不支持contains方法</span><span class="s3">\n    </span><span class="s1">if (node.nodeType === 3) {</span><span class="s3">\n        </span><span class="s1">return node.nodeValue === otherNode.nodeValue</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return node.contains(otherNode)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 获取新的文本节点</span><span class="s3">\n </span><span class="s1">* @param node 要处理的文本节点</span><span class="s3">\n </span><span class="s1">* @param pos  光标在文本节点所在的位置</span><span class="s3">\n </span><span class="s1">* @param start 设置为true时保留开始位置到光标的内容，设置为false时删去开始的内容</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function dealTextNode(node: Node, pos: number, start: boolean = true): string {</span><span class="s3">\n    </span><span class="s1">let content = node.nodeValue</span><span class="s3">\n    </span><span class="s1">let oldContent = content?.slice(0, pos) as string</span><span class="s3">\n    </span><span class="s1">content = content?.slice(pos) as string</span><span class="s3">\n    </span><span class="s1">// start为false时替换content和oldContent</span><span class="s3">\n    </span><span class="s1">if (!start) {</span><span class="s3">\n        </span><span class="s1">let temp = content</span><span class="s3">\n        </span><span class="s1">content = oldContent</span><span class="s3">\n        </span><span class="s1">oldContent = temp</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">node.nodeValue = oldContent</span><span class="s3">\n    </span><span class="s1">return content</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export { getCursorNextNode, isTodo, isAllTodo, dealTextNode }</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 双栈实现撤销恢复</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { CeilStack } from './stack'</span><span class="s3">\n\n</span><span class="s1">export default class Cache&lt;T&gt; {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 正常操作（用户输入、js代码修改内容、恢复操作）产生的缓存</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected data: CeilStack&lt;T&gt;</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 撤销操作产生的缓存（恢复操作时需要这些数据）</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected revokeData: CeilStack&lt;T&gt;</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 上一步操作是否为 撤销/恢复</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected isRe: boolean = false</span><span class="s3">\n\n    </span><span class="s1">constructor(protected maxSize: number) {</span><span class="s3">\n        </span><span class="s1">this.data = new CeilStack(maxSize)</span><span class="s3">\n        </span><span class="s1">this.revokeData = new CeilStack(maxSize)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 返回当前栈中的数据长度。格式为：[正常的数据的条数，被撤销的数据的条数]</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public get size() {</span><span class="s3">\n        </span><span class="s1">return [this.data.size, this.revokeData.size]</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 重设数据缓存器的缓存长度（第一次有效）</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public resetMaxSize(maxSize: number) {</span><span class="s3">\n        </span><span class="s1">this.data.resetMax(maxSize)</span><span class="s3">\n        </span><span class="s1">this.revokeData.resetMax(maxSize)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 保存数据</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public save(data: T) {</span><span class="s3">\n        </span><span class="s1">if (this.isRe) {</span><span class="s3">\n            </span><span class="s1">this.revokeData.clear()</span><span class="s3">\n            </span><span class="s1">this.isRe = false</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">this.data.instack(data)</span><span class="s3">\n        </span><span class="s1">return this</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 撤销</span><span class="s3">\n     </span><span class="s1">* @param fn 撤销时，如果有数据，执行的回调函数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public revoke(fn: (data: T) =&gt; void) {</span><span class="s3">\n        </span><span class="s1">!this.isRe &amp;&amp; (this.isRe = true)</span><span class="s3">\n        </span><span class="s1">let data = this.data.outstack()</span><span class="s3">\n        </span><span class="s1">if (data) {</span><span class="s3">\n            </span><span class="s1">this.revokeData.instack(data)</span><span class="s3">\n            </span><span class="s1">fn(data)</span><span class="s3">\n            </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 恢复</span><span class="s3">\n     </span><span class="s1">* @param fn 恢复时，如果有数据，执行的回调函数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public restore(fn: (data: T) =&gt; void) {</span><span class="s3">\n        </span><span class="s1">!this.isRe &amp;&amp; (this.isRe = true)</span><span class="s3">\n        </span><span class="s1">let data = this.revokeData.outstack()</span><span class="s3">\n        </span><span class="s1">if (data) {</span><span class="s3">\n            </span><span class="s1">this.data.instack(data)</span><span class="s3">\n            </span><span class="s1">fn(data)</span><span class="s3">\n            </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var DESCRIPTORS = require('../internals/descriptors');</span><span class="s3">\n</span><span class="s1">var fails = require('../internals/fails');</span><span class="s3">\n</span><span class="s1">var createElement = require('../internals/document-create-element');</span><span class="s3">\n\n</span><span class="s1">// Thank's IE8 for his funny defineProperty</span><span class="s3">\n</span><span class="s1">module.exports = !DESCRIPTORS &amp;&amp; !fails(function () {</span><span class="s3">\n  </span><span class="s1">return Object.defineProperty(createElement('div'), 'a', {</span><span class="s3">\n    </span><span class="s1">get: function () { return 7; }</span><span class="s3">\n  </span><span class="s1">}).a != 7;</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var fails = require('../internals/fails');</span><span class="s3">\n\n</span><span class="s1">var replacement = /#|</span><span class="s3">\\</span><span class="s1">.prototype</span><span class="s3">\\</span><span class="s1">./;</span><span class="s3">\n\n</span><span class="s1">var isForced = function (feature, detection) {</span><span class="s3">\n  </span><span class="s1">var value = data[normalize(feature)];</span><span class="s3">\n  </span><span class="s1">return value == POLYFILL ? true</span><span class="s3">\n    </span><span class="s1">: value == NATIVE ? false</span><span class="s3">\n    </span><span class="s1">: typeof detection == 'function' ? fails(detection)</span><span class="s3">\n    </span><span class="s1">: !!detection;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var normalize = isForced.normalize = function (string) {</span><span class="s3">\n  </span><span class="s1">return String(string).replace(replacement, '.').toLowerCase();</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var data = isForced.data = {};</span><span class="s3">\n</span><span class="s1">var NATIVE = isForced.NATIVE = 'N';</span><span class="s3">\n</span><span class="s1">var POLYFILL = isForced.POLYFILL = 'P';</span><span class="s3">\n\n</span><span class="s1">module.exports = isForced;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var store = require('../internals/shared-store');</span><span class="s3">\n\n</span><span class="s1">var functionToString = Function.toString;</span><span class="s3">\n\n</span><span class="s1">// this helper broken in `3.4.1-3.4.4`, so we can't use `shared` helper</span><span class="s3">\n</span><span class="s1">if (typeof store.inspectSource != 'function') {</span><span class="s3">\n  </span><span class="s1">store.inspectSource = function (it) {</span><span class="s3">\n    </span><span class="s1">return functionToString.call(it);</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">module.exports = store.inspectSource;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var setGlobal = require('../internals/set-global');</span><span class="s3">\n\n</span><span class="s1">var SHARED = '__core-js_shared__';</span><span class="s3">\n</span><span class="s1">var store = global[SHARED] || setGlobal(SHARED, {});</span><span class="s3">\n\n</span><span class="s1">module.exports = store;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var getPrototypeOf = require('../internals/object-get-prototype-of');</span><span class="s3">\n</span><span class="s1">var createNonEnumerableProperty = require('../internals/create-non-enumerable-property');</span><span class="s3">\n</span><span class="s1">var has = require('../internals/has');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n</span><span class="s1">var IS_PURE = require('../internals/is-pure');</span><span class="s3">\n\n</span><span class="s1">var ITERATOR = wellKnownSymbol('iterator');</span><span class="s3">\n</span><span class="s1">var BUGGY_SAFARI_ITERATORS = false;</span><span class="s3">\n\n</span><span class="s1">var returnThis = function () { return this; };</span><span class="s3">\n\n</span><span class="s1">// `%IteratorPrototype%` object</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-%iteratorprototype%-object</span><span class="s3">\n</span><span class="s1">var IteratorPrototype, PrototypeOfArrayIteratorPrototype, arrayIterator;</span><span class="s3">\n\n</span><span class="s1">if ([].keys) {</span><span class="s3">\n  </span><span class="s1">arrayIterator = [].keys();</span><span class="s3">\n  </span><span class="s1">// Safari 8 has buggy iterators w/o `next`</span><span class="s3">\n  </span><span class="s1">if (!('next' in arrayIterator)) BUGGY_SAFARI_ITERATORS = true;</span><span class="s3">\n  </span><span class="s1">else {</span><span class="s3">\n    </span><span class="s1">PrototypeOfArrayIteratorPrototype = getPrototypeOf(getPrototypeOf(arrayIterator));</span><span class="s3">\n    </span><span class="s1">if (PrototypeOfArrayIteratorPrototype !== Object.prototype) IteratorPrototype = PrototypeOfArrayIteratorPrototype;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">if (IteratorPrototype == undefined) IteratorPrototype = {};</span><span class="s3">\n\n</span><span class="s1">// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()</span><span class="s3">\n</span><span class="s1">if (!IS_PURE &amp;&amp; !has(IteratorPrototype, ITERATOR)) {</span><span class="s3">\n  </span><span class="s1">createNonEnumerableProperty(IteratorPrototype, ITERATOR, returnThis);</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">module.exports = {</span><span class="s3">\n  </span><span class="s1">IteratorPrototype: IteratorPrototype,</span><span class="s3">\n  </span><span class="s1">BUGGY_SAFARI_ITERATORS: BUGGY_SAFARI_ITERATORS</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var has = require('../internals/has');</span><span class="s3">\n</span><span class="s1">var toObject = require('../internals/to-object');</span><span class="s3">\n</span><span class="s1">var sharedKey = require('../internals/shared-key');</span><span class="s3">\n</span><span class="s1">var CORRECT_PROTOTYPE_GETTER = require('../internals/correct-prototype-getter');</span><span class="s3">\n\n</span><span class="s1">var IE_PROTO = sharedKey('IE_PROTO');</span><span class="s3">\n</span><span class="s1">var ObjectPrototype = Object.prototype;</span><span class="s3">\n\n</span><span class="s1">// `Object.getPrototypeOf` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.getprototypeof</span><span class="s3">\n</span><span class="s1">module.exports = CORRECT_PROTOTYPE_GETTER ? Object.getPrototypeOf : function (O) {</span><span class="s3">\n  </span><span class="s1">O = toObject(O);</span><span class="s3">\n  </span><span class="s1">if (has(O, IE_PROTO)) return O[IE_PROTO];</span><span class="s3">\n  </span><span class="s1">if (typeof O.constructor == 'function' &amp;&amp; O instanceof O.constructor) {</span><span class="s3">\n    </span><span class="s1">return O.constructor.prototype;</span><span class="s3">\n  </span><span class="s1">} return O instanceof Object ? ObjectPrototype : null;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var NATIVE_SYMBOL = require('../internals/native-symbol');</span><span class="s3">\n\n</span><span class="s1">module.exports = NATIVE_SYMBOL</span><span class="s3">\n  </span><span class="s1">// eslint-disable-next-line no-undef</span><span class="s3">\n  </span><span class="s1">&amp;&amp; !Symbol.sham</span><span class="s3">\n  </span><span class="s1">// eslint-disable-next-line no-undef</span><span class="s3">\n  </span><span class="s1">&amp;&amp; typeof Symbol.iterator == 'symbol';</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var has = require('../internals/has');</span><span class="s3">\n</span><span class="s1">var toIndexedObject = require('../internals/to-indexed-object');</span><span class="s3">\n</span><span class="s1">var indexOf = require('../internals/array-includes').indexOf;</span><span class="s3">\n</span><span class="s1">var hiddenKeys = require('../internals/hidden-keys');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (object, names) {</span><span class="s3">\n  </span><span class="s1">var O = toIndexedObject(object);</span><span class="s3">\n  </span><span class="s1">var i = 0;</span><span class="s3">\n  </span><span class="s1">var result = [];</span><span class="s3">\n  </span><span class="s1">var key;</span><span class="s3">\n  </span><span class="s1">for (key in O) !has(hiddenKeys, key) &amp;&amp; has(O, key) &amp;&amp; result.push(key);</span><span class="s3">\n  </span><span class="s1">// Don't enum bug &amp; hidden keys</span><span class="s3">\n  </span><span class="s1">while (names.length &gt; i) if (has(O, key = names[i++])) {</span><span class="s3">\n    </span><span class="s1">~indexOf(result, key) || result.push(key);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return result;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var getBuiltIn = require('../internals/get-built-in');</span><span class="s3">\n\n</span><span class="s1">module.exports = getBuiltIn('document', 'documentElement');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var global = require('../internals/global');</span><span class="s3">\n\n</span><span class="s1">module.exports = global.Promise;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var redefine = require('../internals/redefine');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (target, src, options) {</span><span class="s3">\n  </span><span class="s1">for (var key in src) {</span><span class="s3">\n    </span><span class="s1">if (options &amp;&amp; options.unsafe &amp;&amp; target[key]) target[key] = src[key];</span><span class="s3">\n    </span><span class="s1">else redefine(target, key, src[key], options);</span><span class="s3">\n  </span><span class="s1">} return target;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var getBuiltIn = require('../internals/get-built-in');</span><span class="s3">\n</span><span class="s1">var definePropertyModule = require('../internals/object-define-property');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n</span><span class="s1">var DESCRIPTORS = require('../internals/descriptors');</span><span class="s3">\n\n</span><span class="s1">var SPECIES = wellKnownSymbol('species');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (CONSTRUCTOR_NAME) {</span><span class="s3">\n  </span><span class="s1">var Constructor = getBuiltIn(CONSTRUCTOR_NAME);</span><span class="s3">\n  </span><span class="s1">var defineProperty = definePropertyModule.f;</span><span class="s3">\n\n  </span><span class="s1">if (DESCRIPTORS &amp;&amp; Constructor &amp;&amp; !Constructor[SPECIES]) {</span><span class="s3">\n    </span><span class="s1">defineProperty(Constructor, SPECIES, {</span><span class="s3">\n      </span><span class="s1">configurable: true,</span><span class="s3">\n      </span><span class="s1">get: function () { return this; }</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n</span><span class="s1">var Iterators = require('../internals/iterators');</span><span class="s3">\n\n</span><span class="s1">var ITERATOR = wellKnownSymbol('iterator');</span><span class="s3">\n</span><span class="s1">var ArrayPrototype = Array.prototype;</span><span class="s3">\n\n</span><span class="s1">// check on default Array iterator</span><span class="s3">\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">return it !== undefined &amp;&amp; (Iterators.Array === it || ArrayPrototype[ITERATOR] === it);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var classof = require('../internals/classof');</span><span class="s3">\n</span><span class="s1">var Iterators = require('../internals/iterators');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">var ITERATOR = wellKnownSymbol('iterator');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">if (it != undefined) return it[ITERATOR]</span><span class="s3">\n    </span><span class="s1">|| it['@@iterator']</span><span class="s3">\n    </span><span class="s1">|| Iterators[classof(it)];</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var anObject = require('../internals/an-object');</span><span class="s3">\n\n</span><span class="s1">// call something on iterator step with safe closing on error</span><span class="s3">\n</span><span class="s1">module.exports = function (iterator, fn, value, ENTRIES) {</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">return ENTRIES ? fn(anObject(value)[0], value[1]) : fn(value);</span><span class="s3">\n  </span><span class="s1">// 7.4.6 IteratorClose(iterator, completion)</span><span class="s3">\n  </span><span class="s1">} catch (error) {</span><span class="s3">\n    </span><span class="s1">var returnMethod = iterator['return'];</span><span class="s3">\n    </span><span class="s1">if (returnMethod !== undefined) anObject(returnMethod.call(iterator));</span><span class="s3">\n    </span><span class="s1">throw error;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">var ITERATOR = wellKnownSymbol('iterator');</span><span class="s3">\n</span><span class="s1">var SAFE_CLOSING = false;</span><span class="s3">\n\n</span><span class="s1">try {</span><span class="s3">\n  </span><span class="s1">var called = 0;</span><span class="s3">\n  </span><span class="s1">var iteratorWithReturn = {</span><span class="s3">\n    </span><span class="s1">next: function () {</span><span class="s3">\n      </span><span class="s1">return { done: !!called++ };</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">'return': function () {</span><span class="s3">\n      </span><span class="s1">SAFE_CLOSING = true;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">iteratorWithReturn[ITERATOR] = function () {</span><span class="s3">\n    </span><span class="s1">return this;</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">// eslint-disable-next-line no-throw-literal</span><span class="s3">\n  </span><span class="s1">Array.from(iteratorWithReturn, function () { throw 2; });</span><span class="s3">\n</span><span class="s1">} catch (error) { /* empty */ }</span><span class="s3">\n\n</span><span class="s1">module.exports = function (exec, SKIP_CLOSING) {</span><span class="s3">\n  </span><span class="s1">if (!SKIP_CLOSING &amp;&amp; !SAFE_CLOSING) return false;</span><span class="s3">\n  </span><span class="s1">var ITERATION_SUPPORT = false;</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">var object = {};</span><span class="s3">\n    </span><span class="s1">object[ITERATOR] = function () {</span><span class="s3">\n      </span><span class="s1">return {</span><span class="s3">\n        </span><span class="s1">next: function () {</span><span class="s3">\n          </span><span class="s1">return { done: ITERATION_SUPPORT = true };</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">};</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n    </span><span class="s1">exec(object);</span><span class="s3">\n  </span><span class="s1">} catch (error) { /* empty */ }</span><span class="s3">\n  </span><span class="s1">return ITERATION_SUPPORT;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var anObject = require('../internals/an-object');</span><span class="s3">\n</span><span class="s1">var aFunction = require('../internals/a-function');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">var SPECIES = wellKnownSymbol('species');</span><span class="s3">\n\n</span><span class="s1">// `SpeciesConstructor` abstract operation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-speciesconstructor</span><span class="s3">\n</span><span class="s1">module.exports = function (O, defaultConstructor) {</span><span class="s3">\n  </span><span class="s1">var C = anObject(O).constructor;</span><span class="s3">\n  </span><span class="s1">var S;</span><span class="s3">\n  </span><span class="s1">return C === undefined || (S = anObject(C)[SPECIES]) == undefined ? defaultConstructor : aFunction(S);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var fails = require('../internals/fails');</span><span class="s3">\n</span><span class="s1">var classof = require('../internals/classof-raw');</span><span class="s3">\n</span><span class="s1">var bind = require('../internals/function-bind-context');</span><span class="s3">\n</span><span class="s1">var html = require('../internals/html');</span><span class="s3">\n</span><span class="s1">var createElement = require('../internals/document-create-element');</span><span class="s3">\n</span><span class="s1">var IS_IOS = require('../internals/engine-is-ios');</span><span class="s3">\n\n</span><span class="s1">var location = global.location;</span><span class="s3">\n</span><span class="s1">var set = global.setImmediate;</span><span class="s3">\n</span><span class="s1">var clear = global.clearImmediate;</span><span class="s3">\n</span><span class="s1">var process = global.process;</span><span class="s3">\n</span><span class="s1">var MessageChannel = global.MessageChannel;</span><span class="s3">\n</span><span class="s1">var Dispatch = global.Dispatch;</span><span class="s3">\n</span><span class="s1">var counter = 0;</span><span class="s3">\n</span><span class="s1">var queue = {};</span><span class="s3">\n</span><span class="s1">var ONREADYSTATECHANGE = 'onreadystatechange';</span><span class="s3">\n</span><span class="s1">var defer, channel, port;</span><span class="s3">\n\n</span><span class="s1">var run = function (id) {</span><span class="s3">\n  </span><span class="s1">// eslint-disable-next-line no-prototype-builtins</span><span class="s3">\n  </span><span class="s1">if (queue.hasOwnProperty(id)) {</span><span class="s3">\n    </span><span class="s1">var fn = queue[id];</span><span class="s3">\n    </span><span class="s1">delete queue[id];</span><span class="s3">\n    </span><span class="s1">fn();</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var runner = function (id) {</span><span class="s3">\n  </span><span class="s1">return function () {</span><span class="s3">\n    </span><span class="s1">run(id);</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var listener = function (event) {</span><span class="s3">\n  </span><span class="s1">run(event.data);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var post = function (id) {</span><span class="s3">\n  </span><span class="s1">// old engines have not location.origin</span><span class="s3">\n  </span><span class="s1">global.postMessage(id + '', location.protocol + '//' + location.host);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">// Node.js 0.9+ &amp; IE10+ has setImmediate, otherwise:</span><span class="s3">\n</span><span class="s1">if (!set || !clear) {</span><span class="s3">\n  </span><span class="s1">set = function setImmediate(fn) {</span><span class="s3">\n    </span><span class="s1">var args = [];</span><span class="s3">\n    </span><span class="s1">var i = 1;</span><span class="s3">\n    </span><span class="s1">while (arguments.length &gt; i) args.push(arguments[i++]);</span><span class="s3">\n    </span><span class="s1">queue[++counter] = function () {</span><span class="s3">\n      </span><span class="s1">// eslint-disable-next-line no-new-func</span><span class="s3">\n      </span><span class="s1">(typeof fn == 'function' ? fn : Function(fn)).apply(undefined, args);</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n    </span><span class="s1">defer(counter);</span><span class="s3">\n    </span><span class="s1">return counter;</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">clear = function clearImmediate(id) {</span><span class="s3">\n    </span><span class="s1">delete queue[id];</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">// Node.js 0.8-</span><span class="s3">\n  </span><span class="s1">if (classof(process) == 'process') {</span><span class="s3">\n    </span><span class="s1">defer = function (id) {</span><span class="s3">\n      </span><span class="s1">process.nextTick(runner(id));</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">// Sphere (JS game engine) Dispatch API</span><span class="s3">\n  </span><span class="s1">} else if (Dispatch &amp;&amp; Dispatch.now) {</span><span class="s3">\n    </span><span class="s1">defer = function (id) {</span><span class="s3">\n      </span><span class="s1">Dispatch.now(runner(id));</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">// Browsers with MessageChannel, includes WebWorkers</span><span class="s3">\n  </span><span class="s1">// except iOS - https://github.com/zloirock/core-js/issues/624</span><span class="s3">\n  </span><span class="s1">} else if (MessageChannel &amp;&amp; !IS_IOS) {</span><span class="s3">\n    </span><span class="s1">channel = new MessageChannel();</span><span class="s3">\n    </span><span class="s1">port = channel.port2;</span><span class="s3">\n    </span><span class="s1">channel.port1.onmessage = listener;</span><span class="s3">\n    </span><span class="s1">defer = bind(port.postMessage, port, 1);</span><span class="s3">\n  </span><span class="s1">// Browsers with postMessage, skip WebWorkers</span><span class="s3">\n  </span><span class="s1">// IE8 has postMessage, but it's sync &amp; typeof its postMessage is 'object'</span><span class="s3">\n  </span><span class="s1">} else if (</span><span class="s3">\n    </span><span class="s1">global.addEventListener &amp;&amp;</span><span class="s3">\n    </span><span class="s1">typeof postMessage == 'function' &amp;&amp;</span><span class="s3">\n    </span><span class="s1">!global.importScripts &amp;&amp;</span><span class="s3">\n    </span><span class="s1">!fails(post) &amp;&amp;</span><span class="s3">\n    </span><span class="s1">location.protocol !== 'file:'</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">defer = post;</span><span class="s3">\n    </span><span class="s1">global.addEventListener('message', listener, false);</span><span class="s3">\n  </span><span class="s1">// IE8-</span><span class="s3">\n  </span><span class="s1">} else if (ONREADYSTATECHANGE in createElement('script')) {</span><span class="s3">\n    </span><span class="s1">defer = function (id) {</span><span class="s3">\n      </span><span class="s1">html.appendChild(createElement('script'))[ONREADYSTATECHANGE] = function () {</span><span class="s3">\n        </span><span class="s1">html.removeChild(this);</span><span class="s3">\n        </span><span class="s1">run(id);</span><span class="s3">\n      </span><span class="s1">};</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">// Rest old browsers</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">defer = function (id) {</span><span class="s3">\n      </span><span class="s1">setTimeout(runner(id), 0);</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">module.exports = {</span><span class="s3">\n  </span><span class="s1">set: set,</span><span class="s3">\n  </span><span class="s1">clear: clear</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var userAgent = require('../internals/engine-user-agent');</span><span class="s3">\n\n</span><span class="s1">module.exports = /(iphone|ipod|ipad).*applewebkit/i.test(userAgent);</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var anObject = require('../internals/an-object');</span><span class="s3">\n</span><span class="s1">var isObject = require('../internals/is-object');</span><span class="s3">\n</span><span class="s1">var newPromiseCapability = require('../internals/new-promise-capability');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (C, x) {</span><span class="s3">\n  </span><span class="s1">anObject(C);</span><span class="s3">\n  </span><span class="s1">if (isObject(x) &amp;&amp; x.constructor === C) return x;</span><span class="s3">\n  </span><span class="s1">var promiseCapability = newPromiseCapability.f(C);</span><span class="s3">\n  </span><span class="s1">var resolve = promiseCapability.resolve;</span><span class="s3">\n  </span><span class="s1">resolve(x);</span><span class="s3">\n  </span><span class="s1">return promiseCapability.promise;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = function (exec) {</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">return { error: false, value: exec() };</span><span class="s3">\n  </span><span class="s1">} catch (error) {</span><span class="s3">\n    </span><span class="s1">return { error: true, value: error };</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/map</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('./export');</span><span class="s3">\n</span><span class="s1">var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var InternalMetadataModule = require('../internals/internal-metadata');</span><span class="s3">\n</span><span class="s1">var fails = require('../internals/fails');</span><span class="s3">\n</span><span class="s1">var createNonEnumerableProperty = require('../internals/create-non-enumerable-property');</span><span class="s3">\n</span><span class="s1">var iterate = require('../internals/iterate');</span><span class="s3">\n</span><span class="s1">var anInstance = require('../internals/an-instance');</span><span class="s3">\n</span><span class="s1">var isObject = require('../internals/is-object');</span><span class="s3">\n</span><span class="s1">var setToStringTag = require('../internals/set-to-string-tag');</span><span class="s3">\n</span><span class="s1">var defineProperty = require('../internals/object-define-property').f;</span><span class="s3">\n</span><span class="s1">var forEach = require('../internals/array-iteration').forEach;</span><span class="s3">\n</span><span class="s1">var DESCRIPTORS = require('../internals/descriptors');</span><span class="s3">\n</span><span class="s1">var InternalStateModule = require('../internals/internal-state');</span><span class="s3">\n\n</span><span class="s1">var setInternalState = InternalStateModule.set;</span><span class="s3">\n</span><span class="s1">var internalStateGetterFor = InternalStateModule.getterFor;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (CONSTRUCTOR_NAME, wrapper, common) {</span><span class="s3">\n  </span><span class="s1">var IS_MAP = CONSTRUCTOR_NAME.indexOf('Map') !== -1;</span><span class="s3">\n  </span><span class="s1">var IS_WEAK = CONSTRUCTOR_NAME.indexOf('Weak') !== -1;</span><span class="s3">\n  </span><span class="s1">var ADDER = IS_MAP ? 'set' : 'add';</span><span class="s3">\n  </span><span class="s1">var NativeConstructor = global[CONSTRUCTOR_NAME];</span><span class="s3">\n  </span><span class="s1">var NativePrototype = NativeConstructor &amp;&amp; NativeConstructor.prototype;</span><span class="s3">\n  </span><span class="s1">var exported = {};</span><span class="s3">\n  </span><span class="s1">var Constructor;</span><span class="s3">\n\n  </span><span class="s1">if (!DESCRIPTORS || typeof NativeConstructor != 'function'</span><span class="s3">\n    </span><span class="s1">|| !(IS_WEAK || NativePrototype.forEach &amp;&amp; !fails(function () { new NativeConstructor().entries().next(); }))</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">// create collection constructor</span><span class="s3">\n    </span><span class="s1">Constructor = common.getConstructor(wrapper, CONSTRUCTOR_NAME, IS_MAP, ADDER);</span><span class="s3">\n    </span><span class="s1">InternalMetadataModule.REQUIRED = true;</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">Constructor = wrapper(function (target, iterable) {</span><span class="s3">\n      </span><span class="s1">setInternalState(anInstance(target, Constructor, CONSTRUCTOR_NAME), {</span><span class="s3">\n        </span><span class="s1">type: CONSTRUCTOR_NAME,</span><span class="s3">\n        </span><span class="s1">collection: new NativeConstructor()</span><span class="s3">\n      </span><span class="s1">});</span><span class="s3">\n      </span><span class="s1">if (iterable != undefined) iterate(iterable, target[ADDER], target, IS_MAP);</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n\n    </span><span class="s1">var getInternalState = internalStateGetterFor(CONSTRUCTOR_NAME);</span><span class="s3">\n\n    </span><span class="s1">forEach(['add', 'clear', 'delete', 'forEach', 'get', 'has', 'set', 'keys', 'values', 'entries'], function (KEY) {</span><span class="s3">\n      </span><span class="s1">var IS_ADDER = KEY == 'add' || KEY == 'set';</span><span class="s3">\n      </span><span class="s1">if (KEY in NativePrototype &amp;&amp; !(IS_WEAK &amp;&amp; KEY == 'clear')) {</span><span class="s3">\n        </span><span class="s1">createNonEnumerableProperty(Constructor.prototype, KEY, function (a, b) {</span><span class="s3">\n          </span><span class="s1">var collection = getInternalState(this).collection;</span><span class="s3">\n          </span><span class="s1">if (!IS_ADDER &amp;&amp; IS_WEAK &amp;&amp; !isObject(a)) return KEY == 'get' ? undefined : false;</span><span class="s3">\n          </span><span class="s1">var result = collection[KEY](a === 0 ? 0 : a, b);</span><span class="s3">\n          </span><span class="s1">return IS_ADDER ? this : result;</span><span class="s3">\n        </span><span class="s1">});</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n\n    </span><span class="s1">IS_WEAK || defineProperty(Constructor.prototype, 'size', {</span><span class="s3">\n      </span><span class="s1">configurable: true,</span><span class="s3">\n      </span><span class="s1">get: function () {</span><span class="s3">\n        </span><span class="s1">return getInternalState(this).collection.size;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">setToStringTag(Constructor, CONSTRUCTOR_NAME, false, true);</span><span class="s3">\n\n  </span><span class="s1">exported[CONSTRUCTOR_NAME] = Constructor;</span><span class="s3">\n  </span><span class="s1">$({ global: true, forced: true }, exported);</span><span class="s3">\n\n  </span><span class="s1">if (!IS_WEAK) common.setStrong(Constructor, CONSTRUCTOR_NAME, IS_MAP);</span><span class="s3">\n\n  </span><span class="s1">return Constructor;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var hiddenKeys = require('../internals/hidden-keys');</span><span class="s3">\n</span><span class="s1">var isObject = require('../internals/is-object');</span><span class="s3">\n</span><span class="s1">var has = require('../internals/has');</span><span class="s3">\n</span><span class="s1">var defineProperty = require('../internals/object-define-property').f;</span><span class="s3">\n</span><span class="s1">var uid = require('../internals/uid');</span><span class="s3">\n</span><span class="s1">var FREEZING = require('../internals/freezing');</span><span class="s3">\n\n</span><span class="s1">var METADATA = uid('meta');</span><span class="s3">\n</span><span class="s1">var id = 0;</span><span class="s3">\n\n</span><span class="s1">var isExtensible = Object.isExtensible || function () {</span><span class="s3">\n  </span><span class="s1">return true;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var setMetadata = function (it) {</span><span class="s3">\n  </span><span class="s1">defineProperty(it, METADATA, { value: {</span><span class="s3">\n    </span><span class="s1">objectID: 'O' + ++id, // object ID</span><span class="s3">\n    </span><span class="s1">weakData: {}          // weak collections IDs</span><span class="s3">\n  </span><span class="s1">} });</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var fastKey = function (it, create) {</span><span class="s3">\n  </span><span class="s1">// return a primitive with prefix</span><span class="s3">\n  </span><span class="s1">if (!isObject(it)) return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;</span><span class="s3">\n  </span><span class="s1">if (!has(it, METADATA)) {</span><span class="s3">\n    </span><span class="s1">// can't set metadata to uncaught frozen object</span><span class="s3">\n    </span><span class="s1">if (!isExtensible(it)) return 'F';</span><span class="s3">\n    </span><span class="s1">// not necessary to add metadata</span><span class="s3">\n    </span><span class="s1">if (!create) return 'E';</span><span class="s3">\n    </span><span class="s1">// add missing metadata</span><span class="s3">\n    </span><span class="s1">setMetadata(it);</span><span class="s3">\n  </span><span class="s1">// return object ID</span><span class="s3">\n  </span><span class="s1">} return it[METADATA].objectID;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var getWeakData = function (it, create) {</span><span class="s3">\n  </span><span class="s1">if (!has(it, METADATA)) {</span><span class="s3">\n    </span><span class="s1">// can't set metadata to uncaught frozen object</span><span class="s3">\n    </span><span class="s1">if (!isExtensible(it)) return true;</span><span class="s3">\n    </span><span class="s1">// not necessary to add metadata</span><span class="s3">\n    </span><span class="s1">if (!create) return false;</span><span class="s3">\n    </span><span class="s1">// add missing metadata</span><span class="s3">\n    </span><span class="s1">setMetadata(it);</span><span class="s3">\n  </span><span class="s1">// return the store of weak collections IDs</span><span class="s3">\n  </span><span class="s1">} return it[METADATA].weakData;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">// add metadata on freeze-family methods calling</span><span class="s3">\n</span><span class="s1">var onFreeze = function (it) {</span><span class="s3">\n  </span><span class="s1">if (FREEZING &amp;&amp; meta.REQUIRED &amp;&amp; isExtensible(it) &amp;&amp; !has(it, METADATA)) setMetadata(it);</span><span class="s3">\n  </span><span class="s1">return it;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var meta = module.exports = {</span><span class="s3">\n  </span><span class="s1">REQUIRED: false,</span><span class="s3">\n  </span><span class="s1">fastKey: fastKey,</span><span class="s3">\n  </span><span class="s1">getWeakData: getWeakData,</span><span class="s3">\n  </span><span class="s1">onFreeze: onFreeze</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">hiddenKeys[METADATA] = true;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var defineProperty = require('../internals/object-define-property').f;</span><span class="s3">\n</span><span class="s1">var create = require('../internals/object-create');</span><span class="s3">\n</span><span class="s1">var redefineAll = require('../internals/redefine-all');</span><span class="s3">\n</span><span class="s1">var bind = require('../internals/function-bind-context');</span><span class="s3">\n</span><span class="s1">var anInstance = require('../internals/an-instance');</span><span class="s3">\n</span><span class="s1">var iterate = require('../internals/iterate');</span><span class="s3">\n</span><span class="s1">var defineIterator = require('../internals/define-iterator');</span><span class="s3">\n</span><span class="s1">var setSpecies = require('../internals/set-species');</span><span class="s3">\n</span><span class="s1">var DESCRIPTORS = require('../internals/descriptors');</span><span class="s3">\n</span><span class="s1">var fastKey = require('../internals/internal-metadata').fastKey;</span><span class="s3">\n</span><span class="s1">var InternalStateModule = require('../internals/internal-state');</span><span class="s3">\n\n</span><span class="s1">var setInternalState = InternalStateModule.set;</span><span class="s3">\n</span><span class="s1">var internalStateGetterFor = InternalStateModule.getterFor;</span><span class="s3">\n\n</span><span class="s1">module.exports = {</span><span class="s3">\n  </span><span class="s1">getConstructor: function (wrapper, CONSTRUCTOR_NAME, IS_MAP, ADDER) {</span><span class="s3">\n    </span><span class="s1">var C = wrapper(function (that, iterable) {</span><span class="s3">\n      </span><span class="s1">anInstance(that, C, CONSTRUCTOR_NAME);</span><span class="s3">\n      </span><span class="s1">setInternalState(that, {</span><span class="s3">\n        </span><span class="s1">type: CONSTRUCTOR_NAME,</span><span class="s3">\n        </span><span class="s1">index: create(null),</span><span class="s3">\n        </span><span class="s1">first: undefined,</span><span class="s3">\n        </span><span class="s1">last: undefined,</span><span class="s3">\n        </span><span class="s1">size: 0</span><span class="s3">\n      </span><span class="s1">});</span><span class="s3">\n      </span><span class="s1">if (!DESCRIPTORS) that.size = 0;</span><span class="s3">\n      </span><span class="s1">if (iterable != undefined) iterate(iterable, that[ADDER], that, IS_MAP);</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n\n    </span><span class="s1">var getInternalState = internalStateGetterFor(CONSTRUCTOR_NAME);</span><span class="s3">\n\n    </span><span class="s1">var define = function (that, key, value) {</span><span class="s3">\n      </span><span class="s1">var state = getInternalState(that);</span><span class="s3">\n      </span><span class="s1">var entry = getEntry(that, key);</span><span class="s3">\n      </span><span class="s1">var previous, index;</span><span class="s3">\n      </span><span class="s1">// change existing entry</span><span class="s3">\n      </span><span class="s1">if (entry) {</span><span class="s3">\n        </span><span class="s1">entry.value = value;</span><span class="s3">\n      </span><span class="s1">// create new entry</span><span class="s3">\n      </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">state.last = entry = {</span><span class="s3">\n          </span><span class="s1">index: index = fastKey(key, true),</span><span class="s3">\n          </span><span class="s1">key: key,</span><span class="s3">\n          </span><span class="s1">value: value,</span><span class="s3">\n          </span><span class="s1">previous: previous = state.last,</span><span class="s3">\n          </span><span class="s1">next: undefined,</span><span class="s3">\n          </span><span class="s1">removed: false</span><span class="s3">\n        </span><span class="s1">};</span><span class="s3">\n        </span><span class="s1">if (!state.first) state.first = entry;</span><span class="s3">\n        </span><span class="s1">if (previous) previous.next = entry;</span><span class="s3">\n        </span><span class="s1">if (DESCRIPTORS) state.size++;</span><span class="s3">\n        </span><span class="s1">else that.size++;</span><span class="s3">\n        </span><span class="s1">// add to index</span><span class="s3">\n        </span><span class="s1">if (index !== 'F') state.index[index] = entry;</span><span class="s3">\n      </span><span class="s1">} return that;</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n\n    </span><span class="s1">var getEntry = function (that, key) {</span><span class="s3">\n      </span><span class="s1">var state = getInternalState(that);</span><span class="s3">\n      </span><span class="s1">// fast case</span><span class="s3">\n      </span><span class="s1">var index = fastKey(key);</span><span class="s3">\n      </span><span class="s1">var entry;</span><span class="s3">\n      </span><span class="s1">if (index !== 'F') return state.index[index];</span><span class="s3">\n      </span><span class="s1">// frozen object case</span><span class="s3">\n      </span><span class="s1">for (entry = state.first; entry; entry = entry.next) {</span><span class="s3">\n        </span><span class="s1">if (entry.key == key) return entry;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n\n    </span><span class="s1">redefineAll(C.prototype, {</span><span class="s3">\n      </span><span class="s1">// 23.1.3.1 Map.prototype.clear()</span><span class="s3">\n      </span><span class="s1">// 23.2.3.2 Set.prototype.clear()</span><span class="s3">\n      </span><span class="s1">clear: function clear() {</span><span class="s3">\n        </span><span class="s1">var that = this;</span><span class="s3">\n        </span><span class="s1">var state = getInternalState(that);</span><span class="s3">\n        </span><span class="s1">var data = state.index;</span><span class="s3">\n        </span><span class="s1">var entry = state.first;</span><span class="s3">\n        </span><span class="s1">while (entry) {</span><span class="s3">\n          </span><span class="s1">entry.removed = true;</span><span class="s3">\n          </span><span class="s1">if (entry.previous) entry.previous = entry.previous.next = undefined;</span><span class="s3">\n          </span><span class="s1">delete data[entry.index];</span><span class="s3">\n          </span><span class="s1">entry = entry.next;</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">state.first = state.last = undefined;</span><span class="s3">\n        </span><span class="s1">if (DESCRIPTORS) state.size = 0;</span><span class="s3">\n        </span><span class="s1">else that.size = 0;</span><span class="s3">\n      </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">// 23.1.3.3 Map.prototype.delete(key)</span><span class="s3">\n      </span><span class="s1">// 23.2.3.4 Set.prototype.delete(value)</span><span class="s3">\n      </span><span class="s1">'delete': function (key) {</span><span class="s3">\n        </span><span class="s1">var that = this;</span><span class="s3">\n        </span><span class="s1">var state = getInternalState(that);</span><span class="s3">\n        </span><span class="s1">var entry = getEntry(that, key);</span><span class="s3">\n        </span><span class="s1">if (entry) {</span><span class="s3">\n          </span><span class="s1">var next = entry.next;</span><span class="s3">\n          </span><span class="s1">var prev = entry.previous;</span><span class="s3">\n          </span><span class="s1">delete state.index[entry.index];</span><span class="s3">\n          </span><span class="s1">entry.removed = true;</span><span class="s3">\n          </span><span class="s1">if (prev) prev.next = next;</span><span class="s3">\n          </span><span class="s1">if (next) next.previous = prev;</span><span class="s3">\n          </span><span class="s1">if (state.first == entry) state.first = next;</span><span class="s3">\n          </span><span class="s1">if (state.last == entry) state.last = prev;</span><span class="s3">\n          </span><span class="s1">if (DESCRIPTORS) state.size--;</span><span class="s3">\n          </span><span class="s1">else that.size--;</span><span class="s3">\n        </span><span class="s1">} return !!entry;</span><span class="s3">\n      </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">// 23.2.3.6 Set.prototype.forEach(callbackfn, thisArg = undefined)</span><span class="s3">\n      </span><span class="s1">// 23.1.3.5 Map.prototype.forEach(callbackfn, thisArg = undefined)</span><span class="s3">\n      </span><span class="s1">forEach: function forEach(callbackfn /* , that = undefined */) {</span><span class="s3">\n        </span><span class="s1">var state = getInternalState(this);</span><span class="s3">\n        </span><span class="s1">var boundFunction = bind(callbackfn, arguments.length &gt; 1 ? arguments[1] : undefined, 3);</span><span class="s3">\n        </span><span class="s1">var entry;</span><span class="s3">\n        </span><span class="s1">while (entry = entry ? entry.next : state.first) {</span><span class="s3">\n          </span><span class="s1">boundFunction(entry.value, entry.key, this);</span><span class="s3">\n          </span><span class="s1">// revert to the last existing entry</span><span class="s3">\n          </span><span class="s1">while (entry &amp;&amp; entry.removed) entry = entry.previous;</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">// 23.1.3.7 Map.prototype.has(key)</span><span class="s3">\n      </span><span class="s1">// 23.2.3.7 Set.prototype.has(value)</span><span class="s3">\n      </span><span class="s1">has: function has(key) {</span><span class="s3">\n        </span><span class="s1">return !!getEntry(this, key);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n\n    </span><span class="s1">redefineAll(C.prototype, IS_MAP ? {</span><span class="s3">\n      </span><span class="s1">// 23.1.3.6 Map.prototype.get(key)</span><span class="s3">\n      </span><span class="s1">get: function get(key) {</span><span class="s3">\n        </span><span class="s1">var entry = getEntry(this, key);</span><span class="s3">\n        </span><span class="s1">return entry &amp;&amp; entry.value;</span><span class="s3">\n      </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">// 23.1.3.9 Map.prototype.set(key, value)</span><span class="s3">\n      </span><span class="s1">set: function set(key, value) {</span><span class="s3">\n        </span><span class="s1">return define(this, key === 0 ? 0 : key, value);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">} : {</span><span class="s3">\n      </span><span class="s1">// 23.2.3.1 Set.prototype.add(value)</span><span class="s3">\n      </span><span class="s1">add: function add(value) {</span><span class="s3">\n        </span><span class="s1">return define(this, value = value === 0 ? 0 : value, value);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n    </span><span class="s1">if (DESCRIPTORS) defineProperty(C.prototype, 'size', {</span><span class="s3">\n      </span><span class="s1">get: function () {</span><span class="s3">\n        </span><span class="s1">return getInternalState(this).size;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n    </span><span class="s1">return C;</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n  </span><span class="s1">setStrong: function (C, CONSTRUCTOR_NAME, IS_MAP) {</span><span class="s3">\n    </span><span class="s1">var ITERATOR_NAME = CONSTRUCTOR_NAME + ' Iterator';</span><span class="s3">\n    </span><span class="s1">var getInternalCollectionState = internalStateGetterFor(CONSTRUCTOR_NAME);</span><span class="s3">\n    </span><span class="s1">var getInternalIteratorState = internalStateGetterFor(ITERATOR_NAME);</span><span class="s3">\n    </span><span class="s1">// add .keys, .values, .entries, [@@iterator]</span><span class="s3">\n    </span><span class="s1">// 23.1.3.4, 23.1.3.8, 23.1.3.11, 23.1.3.12, 23.2.3.5, 23.2.3.8, 23.2.3.10, 23.2.3.11</span><span class="s3">\n    </span><span class="s1">defineIterator(C, CONSTRUCTOR_NAME, function (iterated, kind) {</span><span class="s3">\n      </span><span class="s1">setInternalState(this, {</span><span class="s3">\n        </span><span class="s1">type: ITERATOR_NAME,</span><span class="s3">\n        </span><span class="s1">target: iterated,</span><span class="s3">\n        </span><span class="s1">state: getInternalCollectionState(iterated),</span><span class="s3">\n        </span><span class="s1">kind: kind,</span><span class="s3">\n        </span><span class="s1">last: undefined</span><span class="s3">\n      </span><span class="s1">});</span><span class="s3">\n    </span><span class="s1">}, function () {</span><span class="s3">\n      </span><span class="s1">var state = getInternalIteratorState(this);</span><span class="s3">\n      </span><span class="s1">var kind = state.kind;</span><span class="s3">\n      </span><span class="s1">var entry = state.last;</span><span class="s3">\n      </span><span class="s1">// revert to the last existing entry</span><span class="s3">\n      </span><span class="s1">while (entry &amp;&amp; entry.removed) entry = entry.previous;</span><span class="s3">\n      </span><span class="s1">// get next entry</span><span class="s3">\n      </span><span class="s1">if (!state.target || !(state.last = entry = entry ? entry.next : state.state.first)) {</span><span class="s3">\n        </span><span class="s1">// or finish the iteration</span><span class="s3">\n        </span><span class="s1">state.target = undefined;</span><span class="s3">\n        </span><span class="s1">return { value: undefined, done: true };</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">// return step by kind</span><span class="s3">\n      </span><span class="s1">if (kind == 'keys') return { value: entry.key, done: false };</span><span class="s3">\n      </span><span class="s1">if (kind == 'values') return { value: entry.value, done: false };</span><span class="s3">\n      </span><span class="s1">return { value: [entry.key, entry.value], done: false };</span><span class="s3">\n    </span><span class="s1">}, IS_MAP ? 'entries' : 'values', !IS_MAP, true);</span><span class="s3">\n\n    </span><span class="s1">// add [@@species], 23.1.2.2, 23.2.2.2</span><span class="s3">\n    </span><span class="s1">setSpecies(CONSTRUCTOR_NAME);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.iterator` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.iterator</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('iterator');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var internalObjectKeys = require('../internals/object-keys-internal');</span><span class="s3">\n</span><span class="s1">var enumBugKeys = require('../internals/enum-bug-keys');</span><span class="s3">\n\n</span><span class="s1">var hiddenKeys = enumBugKeys.concat('length', 'prototype');</span><span class="s3">\n\n</span><span class="s1">// `Object.getOwnPropertyNames` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.getownpropertynames</span><span class="s3">\n</span><span class="s1">exports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {</span><span class="s3">\n  </span><span class="s1">return internalObjectKeys(O, hiddenKeys);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;exports.f = Object.getOwnPropertySymbols;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/object/assign</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 样式配置</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">export default {</span><span class="s3">\n    </span><span class="s1">zIndex: 10000,</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 默认常量配置</span><span class="s3">\n </span><span class="s1">* @author xiaokyo</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">export default {</span><span class="s3">\n    </span><span class="s1">focus: true,</span><span class="s3">\n    </span><span class="s1">height: 300,</span><span class="s3">\n    </span><span class="s1">placeholder: '请输入正文',</span><span class="s3">\n    </span><span class="s1">zIndexFullScreen: 10002,</span><span class="s3">\n    </span><span class="s1">showFullScreen: true,</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 处理粘贴逻辑</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { replaceHtmlSymbol, forEach } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import parseHtml from './parse-html'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 获取粘贴的纯文本</span><span class="s3">\n </span><span class="s1">* @param e Event 参数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function getPasteText(e: ClipboardEvent): string {</span><span class="s3">\n    </span><span class="s1">// const clipboardData = e.clipboardData || (e.originalEvent &amp;&amp; e.originalEvent.clipboardData)</span><span class="s3">\n    </span><span class="s1">const clipboardData = e.clipboardData // 暂不考虑 originalEvent 的情况</span><span class="s3">\n    </span><span class="s1">let pasteText = ''</span><span class="s3">\n    </span><span class="s1">if (clipboardData == null) {</span><span class="s3">\n        </span><span class="s1">pasteText = (window as any).clipboardData &amp;&amp; (window as any).clipboardData.getData('text')</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">pasteText = clipboardData.getData('text/plain')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return replaceHtmlSymbol(pasteText)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 获取粘贴的 html 字符串</span><span class="s3">\n </span><span class="s1">* @param e Event 参数</span><span class="s3">\n </span><span class="s1">* @param filterStyle 是否过滤 style 样式</span><span class="s3">\n </span><span class="s1">* @param ignoreImg 是否忽略 img 标签</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function getPasteHtml(</span><span class="s3">\n    </span><span class="s1">e: ClipboardEvent,</span><span class="s3">\n    </span><span class="s1">filterStyle: boolean = true,</span><span class="s3">\n    </span><span class="s1">ignoreImg: boolean = false</span><span class="s3">\n</span><span class="s1">): string {</span><span class="s3">\n    </span><span class="s1">const clipboardData = e.clipboardData // 暂不考虑 originalEvent 的情况</span><span class="s3">\n    </span><span class="s1">let pasteHtml = ''</span><span class="s3">\n    </span><span class="s1">if (clipboardData) {</span><span class="s3">\n        </span><span class="s1">pasteHtml = clipboardData.getData('text/html')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 无法通过 'text/html' 格式获取 html，则尝试获取 text</span><span class="s3">\n    </span><span class="s1">if (!pasteHtml) {</span><span class="s3">\n        </span><span class="s1">const text = getPasteText(e)</span><span class="s3">\n        </span><span class="s1">if (!text) {</span><span class="s3">\n            </span><span class="s1">return '' // 没有找到任何文字，则返回</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">pasteHtml = `&lt;p&gt;${text}&lt;/p&gt;`</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 转译&lt;1，后面跟数字的转译成 &amp;lt;1</span><span class="s3">\n    </span><span class="s1">pasteHtml = pasteHtml.replace(/&lt;(</span><span class="s3">\\</span><span class="s1">d)/gm, (_, num) =&gt; '&amp;lt;' + num)</span><span class="s3">\n\n    </span><span class="s1">// pdf复制只会有一个meta标签，parseHtml中的过滤meta标签会导致后面内容丢失</span><span class="s3">\n    </span><span class="s1">pasteHtml = pasteHtml.replace(/&lt;(</span><span class="s3">\\</span><span class="s1">/?meta.*?)&gt;/gim, '')</span><span class="s3">\n\n    </span><span class="s1">// 剔除多余的标签、属性</span><span class="s3">\n    </span><span class="s1">pasteHtml = parseHtml(pasteHtml, filterStyle, ignoreImg)</span><span class="s3">\n\n    </span><span class="s1">return pasteHtml</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 获取粘贴的图片文件</span><span class="s3">\n </span><span class="s1">* @param e Event 参数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function getPasteImgs(e: ClipboardEvent): File[] {</span><span class="s3">\n    </span><span class="s1">const result: File[] = []</span><span class="s3">\n    </span><span class="s1">const txt = getPasteText(e)</span><span class="s3">\n    </span><span class="s1">if (txt) {</span><span class="s3">\n        </span><span class="s1">// 有文字，就忽略图片</span><span class="s3">\n        </span><span class="s1">return result</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const items = e.clipboardData?.items</span><span class="s3">\n\n    </span><span class="s1">if (!items) return result</span><span class="s3">\n\n    </span><span class="s1">forEach(items, (key, value) =&gt; {</span><span class="s3">\n        </span><span class="s1">const type = value.type</span><span class="s3">\n        </span><span class="s1">if (/image/i.test(type)) {</span><span class="s3">\n            </span><span class="s1">result.push(value.getAsFile() as File)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">return result</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/set</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/instance/some</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 下拉列表 class</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import DropListMenu from './DropListMenu'</span><span class="s3">\n</span><span class="s1">import { EMPTY_FN } from '../../utils/const'</span><span class="s3">\n\n</span><span class="s1">export type DropListItem = {</span><span class="s3">\n    </span><span class="s1">$elem: DomElement</span><span class="s3">\n    </span><span class="s1">value: string</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// droplist 的配置数据</span><span class="s3">\n</span><span class="s1">export type DropListConf = {</span><span class="s3">\n    </span><span class="s1">title: string</span><span class="s3">\n    </span><span class="s1">list: DropListItem[]</span><span class="s3">\n    </span><span class="s1">type: string // 'list' 列表形式（如“标题”菜单）； 'inline-block' 块状形式（如“颜色”菜单）</span><span class="s3">\n    </span><span class="s1">clickHandler: (value: DropListItem['value']) =&gt; void</span><span class="s3">\n    </span><span class="s1">width: number | 100</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">class DropList {</span><span class="s3">\n    </span><span class="s1">private menu: DropListMenu</span><span class="s3">\n    </span><span class="s1">private conf: DropListConf</span><span class="s3">\n    </span><span class="s1">private $container: DomElement</span><span class="s3">\n    </span><span class="s1">private rendered: boolean</span><span class="s3">\n    </span><span class="s1">private _show: boolean</span><span class="s3">\n\n    </span><span class="s1">public hideTimeoutId: number</span><span class="s3">\n\n    </span><span class="s1">constructor(menu: DropListMenu, conf: DropListConf) {</span><span class="s3">\n        </span><span class="s1">this.hideTimeoutId = 0</span><span class="s3">\n        </span><span class="s1">this.menu = menu</span><span class="s3">\n        </span><span class="s1">this.conf = conf</span><span class="s3">\n\n        </span><span class="s1">// 容器</span><span class="s3">\n        </span><span class="s1">const $container = $('&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-droplist</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/div&gt;')</span><span class="s3">\n\n        </span><span class="s1">// 标题</span><span class="s3">\n        </span><span class="s1">const $title = $(`&lt;p&gt;${conf.title}&lt;/p&gt;`)</span><span class="s3">\n        </span><span class="s1">$title.addClass('w-e-dp-title')</span><span class="s3">\n        </span><span class="s1">$container.append($title)</span><span class="s3">\n\n        </span><span class="s1">// 列表和类型</span><span class="s3">\n        </span><span class="s1">const list = conf.list || []</span><span class="s3">\n        </span><span class="s1">const type = conf.type || 'list'</span><span class="s3">\n        </span><span class="s1">// item 的点击事件</span><span class="s3">\n        </span><span class="s1">const clickHandler = conf.clickHandler || EMPTY_FN</span><span class="s3">\n\n        </span><span class="s1">// 加入 DOM 并绑定事件</span><span class="s3">\n        </span><span class="s1">const $list = $('&lt;ul class=</span><span class="s3">\&quot;</span><span class="s1">' + (type === 'list' ? 'w-e-list' : 'w-e-block') + '</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/ul&gt;')</span><span class="s3">\n        </span><span class="s1">list.forEach(item =&gt; {</span><span class="s3">\n            </span><span class="s1">const $elem = item.$elem</span><span class="s3">\n\n            </span><span class="s1">const value = item.value</span><span class="s3">\n            </span><span class="s1">const $li = $('&lt;li class=</span><span class="s3">\&quot;</span><span class="s1">w-e-item</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/li&gt;')</span><span class="s3">\n            </span><span class="s1">if ($elem) {</span><span class="s3">\n                </span><span class="s1">$li.append($elem)</span><span class="s3">\n                </span><span class="s1">$list.append($li)</span><span class="s3">\n                </span><span class="s1">$li.on('click', (e: Event) =&gt; {</span><span class="s3">\n                    </span><span class="s1">clickHandler(value)</span><span class="s3">\n\n                    </span><span class="s1">// 阻止冒泡</span><span class="s3">\n                    </span><span class="s1">e.stopPropagation()</span><span class="s3">\n\n                    </span><span class="s1">// item 点击之后，隐藏 list</span><span class="s3">\n                    </span><span class="s1">this.hideTimeoutId = window.setTimeout(() =&gt; {</span><span class="s3">\n                        </span><span class="s1">this.hide()</span><span class="s3">\n                    </span><span class="s1">})</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">$container.append($list)</span><span class="s3">\n\n        </span><span class="s1">// 绑定隐藏事件</span><span class="s3">\n        </span><span class="s1">$container.on('mouseleave', () =&gt; {</span><span class="s3">\n            </span><span class="s1">this.hideTimeoutId = window.setTimeout(() =&gt; {</span><span class="s3">\n                </span><span class="s1">this.hide()</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// 记录属性</span><span class="s3">\n        </span><span class="s1">this.$container = $container</span><span class="s3">\n        </span><span class="s1">this.rendered = false</span><span class="s3">\n        </span><span class="s1">this._show = false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 显示 DropList</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public show() {</span><span class="s3">\n        </span><span class="s1">if (this.hideTimeoutId) {</span><span class="s3">\n            </span><span class="s1">// 清除之前的定时隐藏</span><span class="s3">\n            </span><span class="s1">clearTimeout(this.hideTimeoutId)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const menu = this.menu</span><span class="s3">\n        </span><span class="s1">const $menuELem = menu.$elem</span><span class="s3">\n        </span><span class="s1">const $container = this.$container</span><span class="s3">\n        </span><span class="s1">if (this._show) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (this.rendered) {</span><span class="s3">\n            </span><span class="s1">// 显示</span><span class="s3">\n            </span><span class="s1">$container.show()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 加入 DOM 之前先定位位置</span><span class="s3">\n            </span><span class="s1">const menuHeight = $menuELem.getBoundingClientRect().height || 0</span><span class="s3">\n            </span><span class="s1">const width = this.conf.width || 100 // 默认为 100</span><span class="s3">\n            </span><span class="s1">$container.css('margin-top', menuHeight + 'px').css('width', width + 'px')</span><span class="s3">\n\n            </span><span class="s1">// 加入到 DOM</span><span class="s3">\n            </span><span class="s1">$menuELem.append($container)</span><span class="s3">\n            </span><span class="s1">this.rendered = true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 修改属性</span><span class="s3">\n        </span><span class="s1">this._show = true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 隐藏 DropList</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public hide() {</span><span class="s3">\n        </span><span class="s1">const $container = this.$container</span><span class="s3">\n        </span><span class="s1">if (!this._show) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// 隐藏并需改属性</span><span class="s3">\n        </span><span class="s1">$container.hide()</span><span class="s3">\n        </span><span class="s1">this._show = false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public get isShow() {</span><span class="s3">\n        </span><span class="s1">return this._show</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default DropList</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 上传的核心方法</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { forEach } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import { DicType } from '../../config/index'</span><span class="s3">\n\n</span><span class="s1">type PostOptionType&lt;T&gt; = {</span><span class="s3">\n    </span><span class="s1">timeout?: number</span><span class="s3">\n    </span><span class="s1">formData?: FormData</span><span class="s3">\n    </span><span class="s1">headers?: DicType</span><span class="s3">\n    </span><span class="s1">withCredentials?: boolean</span><span class="s3">\n    </span><span class="s1">onTimeout?: (xhr: XMLHttpRequest) =&gt; void</span><span class="s3">\n    </span><span class="s1">onProgress?: (percent: number, event: ProgressEvent) =&gt; void</span><span class="s3">\n    </span><span class="s1">beforeSend?: (xhr: XMLHttpRequest) =&gt; { prevent: boolean; msg: string } | void</span><span class="s3">\n    </span><span class="s1">onError?: (xhr: XMLHttpRequest) =&gt; void</span><span class="s3">\n    </span><span class="s1">onFail?: (xhr: XMLHttpRequest, msg: string) =&gt; void</span><span class="s3">\n    </span><span class="s1">onSuccess: (xhr: XMLHttpRequest, result: T) =&gt; void</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 发送 post 请求（用于文件上传）</span><span class="s3">\n </span><span class="s1">* @param url url</span><span class="s3">\n </span><span class="s1">* @param option 配置项</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function post&lt;T extends Object&gt;(url: string, option: PostOptionType&lt;T&gt;): XMLHttpRequest | string {</span><span class="s3">\n    </span><span class="s1">const xhr = new XMLHttpRequest()</span><span class="s3">\n    </span><span class="s1">xhr.open('POST', url)</span><span class="s3">\n\n    </span><span class="s1">// 超时，默认 10s</span><span class="s3">\n    </span><span class="s1">xhr.timeout = option.timeout || 10 * 1000</span><span class="s3">\n    </span><span class="s1">xhr.ontimeout = () =&gt; {</span><span class="s3">\n        </span><span class="s1">console.error('wangEditor - 请求超时')</span><span class="s3">\n        </span><span class="s1">option.onTimeout &amp;&amp; option.onTimeout(xhr)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 进度</span><span class="s3">\n    </span><span class="s1">if (xhr.upload) {</span><span class="s3">\n        </span><span class="s1">xhr.upload.onprogress = (e: ProgressEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">const percent = e.loaded / e.total</span><span class="s3">\n            </span><span class="s1">option.onProgress &amp;&amp; option.onProgress(percent, e)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 自定义 header</span><span class="s3">\n    </span><span class="s1">if (option.headers) {</span><span class="s3">\n        </span><span class="s1">forEach(option.headers, (key: string, val: string) =&gt; {</span><span class="s3">\n            </span><span class="s1">xhr.setRequestHeader(key, val)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 跨域传 cookie</span><span class="s3">\n    </span><span class="s1">xhr.withCredentials = !!option.withCredentials</span><span class="s3">\n\n    </span><span class="s1">// 上传之前的钩子函数，在 xhr.send() 之前执行</span><span class="s3">\n    </span><span class="s1">if (option.beforeSend) {</span><span class="s3">\n        </span><span class="s1">const beforeResult = option.beforeSend(xhr)</span><span class="s3">\n        </span><span class="s1">if (beforeResult &amp;&amp; typeof beforeResult === 'object') {</span><span class="s3">\n            </span><span class="s1">if (beforeResult.prevent) {</span><span class="s3">\n                </span><span class="s1">// 如果返回的结果是 {prevent: true, msg: 'xxxx'} 则表示用户放弃上传</span><span class="s3">\n                </span><span class="s1">return beforeResult.msg</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 服务端返回之后</span><span class="s3">\n    </span><span class="s1">xhr.onreadystatechange = () =&gt; {</span><span class="s3">\n        </span><span class="s1">if (xhr.readyState !== 4) return</span><span class="s3">\n        </span><span class="s1">const status = xhr.status</span><span class="s3">\n        </span><span class="s1">if (status &lt; 200) return // 请求发送过程中，尚未返回</span><span class="s3">\n        </span><span class="s1">if (status &gt;= 300 &amp;&amp; status &lt; 400) return // 重定向</span><span class="s3">\n        </span><span class="s1">if (status &gt;= 400) {</span><span class="s3">\n            </span><span class="s1">// 40x 50x 报错</span><span class="s3">\n            </span><span class="s1">console.error('wangEditor - XHR 报错，状态码 ' + status)</span><span class="s3">\n            </span><span class="s1">if (option.onError) option.onError(xhr) // 有，则执行 onError 函数即可</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// status = 200 ，得到结果</span><span class="s3">\n        </span><span class="s1">const resultStr = xhr.responseText</span><span class="s3">\n        </span><span class="s1">let result: T</span><span class="s3">\n        </span><span class="s1">if (typeof resultStr !== 'object') {</span><span class="s3">\n            </span><span class="s1">try {</span><span class="s3">\n                </span><span class="s1">result = JSON.parse(resultStr)</span><span class="s3">\n            </span><span class="s1">} catch (ex) {</span><span class="s3">\n                </span><span class="s1">console.error('wangEditor - 返回结果不是 JSON 格式', resultStr)</span><span class="s3">\n                </span><span class="s1">if (option.onFail) option.onFail(xhr, resultStr)</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">result = resultStr</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">option.onSuccess(xhr, result)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 发送请求</span><span class="s3">\n    </span><span class="s1">xhr.send(option.formData || null)</span><span class="s3">\n\n    </span><span class="s1">return xhr</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default post</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 上传进度条</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n\n</span><span class="s1">class Progress {</span><span class="s3">\n    </span><span class="s1">private editor: Editor</span><span class="s3">\n    </span><span class="s1">private $bar: DomElement</span><span class="s3">\n    </span><span class="s1">private $textContainer: DomElement</span><span class="s3">\n    </span><span class="s1">private isShow: boolean</span><span class="s3">\n    </span><span class="s1">private time: number</span><span class="s3">\n    </span><span class="s1">private timeoutId: number</span><span class="s3">\n\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">this.editor = editor</span><span class="s3">\n        </span><span class="s1">this.$textContainer = editor.$textContainerElem</span><span class="s3">\n        </span><span class="s1">this.$bar = $('&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-progress</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/div&gt;')</span><span class="s3">\n\n        </span><span class="s1">this.isShow = false</span><span class="s3">\n        </span><span class="s1">this.time = 0</span><span class="s3">\n        </span><span class="s1">this.timeoutId = 0</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 显示进度条</span><span class="s3">\n     </span><span class="s1">* @param progress 进度百分比</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public show(progress: number): void {</span><span class="s3">\n        </span><span class="s1">// 不要重新显示</span><span class="s3">\n        </span><span class="s1">if (this.isShow) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">this.isShow = true</span><span class="s3">\n\n        </span><span class="s1">// 渲染 $bar</span><span class="s3">\n        </span><span class="s1">const $bar = this.$bar</span><span class="s3">\n        </span><span class="s1">const $textContainer = this.$textContainer</span><span class="s3">\n        </span><span class="s1">$textContainer.append($bar)</span><span class="s3">\n\n        </span><span class="s1">// 改变进度条（防抖，100ms 渲染一次）</span><span class="s3">\n        </span><span class="s1">if (Date.now() - this.time &gt; 100) {</span><span class="s3">\n            </span><span class="s1">if (progress &lt;= 1) {</span><span class="s3">\n                </span><span class="s1">$bar.css('width', progress * 100 + '%')</span><span class="s3">\n                </span><span class="s1">this.time = Date.now()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 500ms 之后隐藏</span><span class="s3">\n        </span><span class="s1">let timeoutId = this.timeoutId</span><span class="s3">\n        </span><span class="s1">if (timeoutId) {</span><span class="s3">\n            </span><span class="s1">clearTimeout(timeoutId)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">this.timeoutId = window.setTimeout(() =&gt; {</span><span class="s3">\n            </span><span class="s1">this.hide()</span><span class="s3">\n        </span><span class="s1">}, 500)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 隐藏</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private hide() {</span><span class="s3">\n        </span><span class="s1">const $bar = this.$bar</span><span class="s3">\n        </span><span class="s1">$bar.remove()</span><span class="s3">\n\n        </span><span class="s1">this.isShow = false</span><span class="s3">\n        </span><span class="s1">this.time = 0</span><span class="s3">\n        </span><span class="s1">this.timeoutId = 0</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Progress</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 无序列表/有序列表</span><span class="s3">\n </span><span class="s1">* @author tonghan</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import DropListMenu from '../menu-constructors/DropListMenu'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n\n</span><span class="s1">import { updateRange } from './utils'</span><span class="s3">\n\n</span><span class="s1">import { HandlerListOptions } from './ListHandle/ListHandle'</span><span class="s3">\n</span><span class="s1">import ListHandleCommand, { createListHandle, ClassType } from './ListHandle'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 列表的种类</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export enum ListType {</span><span class="s3">\n    </span><span class="s1">OrderedList = 'OL',</span><span class="s3">\n    </span><span class="s1">UnorderedList = 'UL',</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// 序列类型</span><span class="s3">\n</span><span class="s1">type ListTypeValue = ListType</span><span class="s3">\n\n</span><span class="s1">class List extends DropListMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">序列</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-list2</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">const dropListConf = {</span><span class="s3">\n            </span><span class="s1">width: 130,</span><span class="s3">\n            </span><span class="s1">title: '序列',</span><span class="s3">\n            </span><span class="s1">type: 'list',</span><span class="s3">\n            </span><span class="s1">list: [</span><span class="s3">\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">$elem: $(`</span><span class="s3">\n                        </span><span class="s1">&lt;p&gt;</span><span class="s3">\n                            </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-list2 w-e-drop-list-item</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n                            </span><span class="s1">${editor.i18next.t('menus.dropListMenu.list.无序列表')}</span><span class="s3">\n                        </span><span class="s1">&lt;p&gt;`),</span><span class="s3">\n                    </span><span class="s1">value: ListType.UnorderedList,</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">$elem: $(</span><span class="s3">\n                        </span><span class="s1">`&lt;p&gt;</span><span class="s3">\n                            </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-list-numbered w-e-drop-list-item</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n                            </span><span class="s1">${editor.i18next.t('menus.dropListMenu.list.有序列表')}</span><span class="s3">\n                        </span><span class="s1">&lt;p&gt;`</span><span class="s3">\n                    </span><span class="s1">),</span><span class="s3">\n                    </span><span class="s1">value: ListType.OrderedList,</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">],</span><span class="s3">\n            </span><span class="s1">clickHandler: (value: string) =&gt; {</span><span class="s3">\n                </span><span class="s1">// 注意 this 是指向当前的 List 对象</span><span class="s3">\n                </span><span class="s1">this.command(value as ListTypeValue)</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">super($elem, editor, dropListConf)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public command(type: ListTypeValue): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $selectionElem = editor.selection.getSelectionContainerElem()</span><span class="s3">\n\n        </span><span class="s1">// 选区范围的 DOM 元素不存在，不执行命令</span><span class="s3">\n        </span><span class="s1">if ($selectionElem === undefined) return</span><span class="s3">\n\n        </span><span class="s1">// 获取选区范围内的顶级 DOM 元素</span><span class="s3">\n        </span><span class="s1">this.handleSelectionRangeNodes(type)</span><span class="s3">\n\n        </span><span class="s1">// 是否激活</span><span class="s3">\n        </span><span class="s1">this.tryChangeActive()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public validator($startElem: DomElement, $endElem: DomElement, $textElem: DomElement): boolean {</span><span class="s3">\n        </span><span class="s1">if (</span><span class="s3">\n            </span><span class="s1">!$startElem.length ||</span><span class="s3">\n            </span><span class="s1">!$endElem.length ||</span><span class="s3">\n            </span><span class="s1">$textElem.equal($startElem) ||</span><span class="s3">\n            </span><span class="s1">$textElem.equal($endElem)</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n            </span><span class="s1">return false</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">private handleSelectionRangeNodes(listType: ListTypeValue): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const selection = editor.selection</span><span class="s3">\n\n        </span><span class="s1">// 获取 序列标签</span><span class="s3">\n        </span><span class="s1">const listTarget = listType.toLowerCase()</span><span class="s3">\n\n        </span><span class="s1">// 获取相对应的 元属节点</span><span class="s3">\n        </span><span class="s1">let $selectionElem = selection.getSelectionContainerElem() as DomElement</span><span class="s3">\n        </span><span class="s1">const $startElem = (selection.getSelectionStartElem() as DomElement).getNodeTop(editor)</span><span class="s3">\n        </span><span class="s1">const $endElem = (selection.getSelectionEndElem() as DomElement).getNodeTop(editor)</span><span class="s3">\n\n        </span><span class="s1">// 验证是否执行 处理逻辑</span><span class="s3">\n        </span><span class="s1">if (!this.validator($startElem, $endElem, editor.$textElem)) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 获取选区</span><span class="s3">\n        </span><span class="s1">const _range = selection.getRange()</span><span class="s3">\n        </span><span class="s1">const _collapsed = _range?.collapsed</span><span class="s3">\n\n        </span><span class="s1">// 防止光标的时候判断异常</span><span class="s3">\n        </span><span class="s1">if (!editor.$textElem.equal($selectionElem)) {</span><span class="s3">\n            </span><span class="s1">$selectionElem = $selectionElem.getNodeTop(editor)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const options: HandlerListOptions = {</span><span class="s3">\n            </span><span class="s1">editor,</span><span class="s3">\n            </span><span class="s1">listType,</span><span class="s3">\n            </span><span class="s1">listTarget,</span><span class="s3">\n            </span><span class="s1">$selectionElem,</span><span class="s3">\n            </span><span class="s1">$startElem,</span><span class="s3">\n            </span><span class="s1">$endElem,</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">let classType: ClassType</span><span class="s3">\n\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">// 当 selectionElem 属于序列元素的时候</span><span class="s3">\n        </span><span class="s1">// 代表着当前选区一定是在一个序列元素内的</span><span class="s3">\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">if (this.isOrderElem($selectionElem as DomElement)) {</span><span class="s3">\n            </span><span class="s1">classType = ClassType.Wrap</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">// 当 startElem 和 endElem 属于序列元素的时候</span><span class="s3">\n        </span><span class="s1">// 代表着当前选区一定是在再两个序列的中间(包括两个序列)</span><span class="s3">\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">else if (</span><span class="s3">\n            </span><span class="s1">this.isOrderElem($startElem as DomElement) &amp;&amp;</span><span class="s3">\n            </span><span class="s1">this.isOrderElem($endElem as DomElement)</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n            </span><span class="s1">classType = ClassType.Join</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">// 选区开始元素为 序列 的时候</span><span class="s3">\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">else if (this.isOrderElem($startElem as DomElement)) {</span><span class="s3">\n            </span><span class="s1">classType = ClassType.StartJoin</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">// 选区结束元素为 序列 的时候</span><span class="s3">\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">else if (this.isOrderElem($endElem as DomElement)) {</span><span class="s3">\n            </span><span class="s1">classType = ClassType.EndJoin</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">// 当选区不是序列内且开头和结尾不是序列的时候</span><span class="s3">\n        </span><span class="s1">// 直接获取所有顶级段落然后过滤</span><span class="s3">\n        </span><span class="s1">// 代表着 设置序列 的操作</span><span class="s3">\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">else {</span><span class="s3">\n            </span><span class="s1">classType = ClassType.Other</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const listHandleCmd = new ListHandleCommand(</span><span class="s3">\n            </span><span class="s1">createListHandle(classType, options, _range as Range)</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">// 更新选区</span><span class="s3">\n        </span><span class="s1">updateRange(editor, listHandleCmd.getSelectionRangeElem(), !!_collapsed)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 是否是序列元素节点 UL and OL</span><span class="s3">\n     </span><span class="s1">* @param $node</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private isOrderElem($node: DomElement) {</span><span class="s3">\n        </span><span class="s1">const nodeName = $node.getNodeName()</span><span class="s3">\n        </span><span class="s1">if (nodeName === ListType.OrderedList || nodeName === ListType.UnorderedList) {</span><span class="s3">\n            </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public tryChangeActive(): void {}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default List</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/array/from</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 检查选区是否在代码中，即菜单是否应该 active</span><span class="s3">\n </span><span class="s1">* @author lkw</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n\n</span><span class="s1">function isActive(editor: Editor): boolean {</span><span class="s3">\n    </span><span class="s1">const $selectionELem = editor.selection.getSelectionContainerElem()</span><span class="s3">\n    </span><span class="s1">if (!$selectionELem?.length) {</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (</span><span class="s3">\n        </span><span class="s1">$selectionELem.getNodeName() == 'CODE' ||</span><span class="s3">\n        </span><span class="s1">$selectionELem.getNodeName() == 'PRE' ||</span><span class="s3">\n        </span><span class="s1">$selectionELem.parent().getNodeName() == 'CODE' ||</span><span class="s3">\n        </span><span class="s1">$selectionELem.parent().getNodeName() == 'PRE' ||</span><span class="s3">\n        </span><span class="s1">/hljs/.test($selectionELem.parent().attr('class'))</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default isActive</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">export class todo {</span><span class="s3">\n    </span><span class="s1">private template: string</span><span class="s3">\n    </span><span class="s1">private checked: boolean</span><span class="s3">\n    </span><span class="s1">private $todo: DomElement</span><span class="s3">\n    </span><span class="s1">private $child: DomElement</span><span class="s3">\n    </span><span class="s1">constructor($orginElem?: DomElement) {</span><span class="s3">\n        </span><span class="s1">this.template = `&lt;ul class=</span><span class="s3">\&quot;</span><span class="s1">w-e-todo</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;li&gt;&lt;span contenteditable=</span><span class="s3">\&quot;</span><span class="s1">false</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;input type=</span><span class="s3">\&quot;</span><span class="s1">checkbox</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;`</span><span class="s3">\n        </span><span class="s1">this.checked = false</span><span class="s3">\n        </span><span class="s1">this.$todo = $(this.template)</span><span class="s3">\n        </span><span class="s1">this.$child = $orginElem?.childNodes()?.clone(true) as DomElement</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public init() {</span><span class="s3">\n        </span><span class="s1">const $child = this.$child</span><span class="s3">\n        </span><span class="s1">const $inputContainer = this.getInputContainer()</span><span class="s3">\n\n        </span><span class="s1">if ($child) {</span><span class="s3">\n            </span><span class="s1">$child.insertAfter($inputContainer)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public getInput(): DomElement {</span><span class="s3">\n        </span><span class="s1">const $todo = this.$todo</span><span class="s3">\n        </span><span class="s1">const $input = $todo.find('input')</span><span class="s3">\n        </span><span class="s1">return $input</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public getInputContainer(): DomElement {</span><span class="s3">\n        </span><span class="s1">const $inputContainer = this.getInput().parent()</span><span class="s3">\n        </span><span class="s1">return $inputContainer</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public getTodo(): DomElement {</span><span class="s3">\n        </span><span class="s1">return this.$todo</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function createTodo($orginElem?: DomElement): todo {</span><span class="s3">\n    </span><span class="s1">const t = new todo($orginElem)</span><span class="s3">\n    </span><span class="s1">t.init()</span><span class="s3">\n    </span><span class="s1">return t</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default createTodo</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 入口文件</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import './assets/style/common.less'</span><span class="s3">\n</span><span class="s1">import './assets/style/icon.less'</span><span class="s3">\n</span><span class="s1">import './assets/style/menus.less'</span><span class="s3">\n</span><span class="s1">import './assets/style/text.less'</span><span class="s3">\n</span><span class="s1">import './assets/style/panel.less'</span><span class="s3">\n</span><span class="s1">import './assets/style/droplist.less'</span><span class="s3">\n\n</span><span class="s1">import './utils/polyfill'</span><span class="s3">\n</span><span class="s1">import Editor from './editor/index'</span><span class="s3">\n\n</span><span class="s1">export * from './menus/menu-constructors/index'</span><span class="s3">\n\n</span><span class="s1">// 检验是否浏览器环境</span><span class="s3">\n</span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">document</span><span class="s3">\n</span><span class="s1">} catch (ex) {</span><span class="s3">\n    </span><span class="s1">throw new Error('请在浏览器环境下运行')</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Editor</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/object/define-property');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.object.define-property');</span><span class="s3">\n</span><span class="s1">var path = require('../../internals/path');</span><span class="s3">\n\n</span><span class="s1">var Object = path.Object;</span><span class="s3">\n\n</span><span class="s1">var defineProperty = module.exports = function defineProperty(it, key, desc) {</span><span class="s3">\n  </span><span class="s1">return Object.defineProperty(it, key, desc);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">if (Object.defineProperty.sham) defineProperty.sham = true;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var DESCRIPTORS = require('../internals/descriptors');</span><span class="s3">\n</span><span class="s1">var objectDefinePropertyModile = require('../internals/object-define-property');</span><span class="s3">\n\n</span><span class="s1">// `Object.defineProperty` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.defineproperty</span><span class="s3">\n</span><span class="s1">$({ target: 'Object', stat: true, forced: !DESCRIPTORS, sham: !DESCRIPTORS }, {</span><span class="s3">\n  </span><span class="s1">defineProperty: objectDefinePropertyModile.f</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var g;</span><span class="s3">\n\n</span><span class="s1">// This works in non-strict mode</span><span class="s3">\n</span><span class="s1">g = (function() {</span><span class="s3">\n\t</span><span class="s1">return this;</span><span class="s3">\n</span><span class="s1">})();</span><span class="s3">\n\n</span><span class="s1">try {</span><span class="s3">\n\t</span><span class="s1">// This works if eval is allowed (see CSP)</span><span class="s3">\n\t</span><span class="s1">g = g || new Function(</span><span class="s3">\&quot;</span><span class="s1">return this</span><span class="s3">\&quot;</span><span class="s1">)();</span><span class="s3">\n</span><span class="s1">} catch (e) {</span><span class="s3">\n\t</span><span class="s1">// This works if the window reference is available</span><span class="s3">\n\t</span><span class="s1">if (typeof window === </span><span class="s3">\&quot;</span><span class="s1">object</span><span class="s3">\&quot;</span><span class="s1">) g = window;</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// g can still be undefined, but nothing to do about it...</span><span class="s3">\n</span><span class="s1">// We return undefined, instead of nothing here, so it's</span><span class="s3">\n</span><span class="s1">// easier to handle this case. if(!global) { ...}</span><span class="s3">\n\n</span><span class="s1">module.exports = g;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var api = require(</span><span class="s3">\&quot;</span><span class="s1">!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n            </span><span class="s1">var content = require(</span><span class="s3">\&quot;</span><span class="s1">!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/postcss-loader/src/index.js!../../../node_modules/less-loader/dist/cjs.js!./common.less</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n\n            </span><span class="s1">content = content.__esModule ? content.default : content;</span><span class="s3">\n\n            </span><span class="s1">if (typeof content === 'string') {</span><span class="s3">\n              </span><span class="s1">content = [[module.id, content, '']];</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">var options = {};</span><span class="s3">\n\n</span><span class="s1">options.insert = </span><span class="s3">\&quot;</span><span class="s1">head</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n</span><span class="s1">options.singleton = false;</span><span class="s3">\n\n</span><span class="s1">var update = api(content, options);</span><span class="s3">\n\n\n\n</span><span class="s1">module.exports = content.locals || {};&quot;</span><span class="s0">,</span><span class="s1">&quot;// Imports</span><span class="s3">\n</span><span class="s1">var ___CSS_LOADER_API_IMPORT___ = require(</span><span class="s3">\&quot;</span><span class="s1">../../../node_modules/css-loader/dist/runtime/api.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">exports = ___CSS_LOADER_API_IMPORT___(false);</span><span class="s3">\n</span><span class="s1">// Module</span><span class="s3">\n</span><span class="s1">exports.push([module.id, </span><span class="s3">\&quot;</span><span class="s1">.w-e-toolbar,</span><span class="s3">\\</span><span class="s1">n.w-e-text-container,</span><span class="s3">\\</span><span class="s1">n.w-e-menu-panel {</span><span class="s3">\\</span><span class="s1">n  padding: 0;</span><span class="s3">\\</span><span class="s1">n  margin: 0;</span><span class="s3">\\</span><span class="s1">n  box-sizing: border-box;</span><span class="s3">\\</span><span class="s1">n  background-color: #fff;</span><span class="s3">\\</span><span class="s1">n  /*表情菜单样式*/</span><span class="s3">\\</span><span class="s1">n  /*分割线样式*/</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar h1,</span><span class="s3">\\</span><span class="s1">n.w-e-text-container h1,</span><span class="s3">\\</span><span class="s1">n.w-e-menu-panel h1 {</span><span class="s3">\\</span><span class="s1">n  font-size: 32px !important;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar h2,</span><span class="s3">\\</span><span class="s1">n.w-e-text-container h2,</span><span class="s3">\\</span><span class="s1">n.w-e-menu-panel h2 {</span><span class="s3">\\</span><span class="s1">n  font-size: 24px !important;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar h3,</span><span class="s3">\\</span><span class="s1">n.w-e-text-container h3,</span><span class="s3">\\</span><span class="s1">n.w-e-menu-panel h3 {</span><span class="s3">\\</span><span class="s1">n  font-size: 18.72px !important;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar h4,</span><span class="s3">\\</span><span class="s1">n.w-e-text-container h4,</span><span class="s3">\\</span><span class="s1">n.w-e-menu-panel h4 {</span><span class="s3">\\</span><span class="s1">n  font-size: 16px !important;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar h5,</span><span class="s3">\\</span><span class="s1">n.w-e-text-container h5,</span><span class="s3">\\</span><span class="s1">n.w-e-menu-panel h5 {</span><span class="s3">\\</span><span class="s1">n  font-size: 13.28px !important;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar p,</span><span class="s3">\\</span><span class="s1">n.w-e-text-container p,</span><span class="s3">\\</span><span class="s1">n.w-e-menu-panel p {</span><span class="s3">\\</span><span class="s1">n  font-size: 16px !important;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .eleImg,</span><span class="s3">\\</span><span class="s1">n.w-e-text-container .eleImg,</span><span class="s3">\\</span><span class="s1">n.w-e-menu-panel .eleImg {</span><span class="s3">\\</span><span class="s1">n  cursor: pointer;</span><span class="s3">\\</span><span class="s1">n  display: inline-block;</span><span class="s3">\\</span><span class="s1">n  font-size: 18px;</span><span class="s3">\\</span><span class="s1">n  padding: 0 3px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar *,</span><span class="s3">\\</span><span class="s1">n.w-e-text-container *,</span><span class="s3">\\</span><span class="s1">n.w-e-menu-panel * {</span><span class="s3">\\</span><span class="s1">n  padding: 0;</span><span class="s3">\\</span><span class="s1">n  margin: 0;</span><span class="s3">\\</span><span class="s1">n  box-sizing: border-box;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar hr,</span><span class="s3">\\</span><span class="s1">n.w-e-text-container hr,</span><span class="s3">\\</span><span class="s1">n.w-e-menu-panel hr {</span><span class="s3">\\</span><span class="s1">n  cursor: pointer;</span><span class="s3">\\</span><span class="s1">n  display: block;</span><span class="s3">\\</span><span class="s1">n  height: 0px;</span><span class="s3">\\</span><span class="s1">n  border: 0;</span><span class="s3">\\</span><span class="s1">n  border-top: 3px solid #ccc;</span><span class="s3">\\</span><span class="s1">n  margin: 20px 0;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-clear-fix:after {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n  display: table;</span><span class="s3">\\</span><span class="s1">n  clear: both;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-drop-list-item {</span><span class="s3">\\</span><span class="s1">n  position: relative;</span><span class="s3">\\</span><span class="s1">n  top: 1px;</span><span class="s3">\\</span><span class="s1">n  padding-right: 7px;</span><span class="s3">\\</span><span class="s1">n  color: #333 !important;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-drop-list-tl {</span><span class="s3">\\</span><span class="s1">n  padding-left: 10px;</span><span class="s3">\\</span><span class="s1">n  text-align: left;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n</span><span class="s3">\&quot;</span><span class="s1">, </span><span class="s3">\&quot;\&quot;</span><span class="s1">]);</span><span class="s3">\n</span><span class="s1">// Exports</span><span class="s3">\n</span><span class="s1">module.exports = exports;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var api = require(</span><span class="s3">\&quot;</span><span class="s1">!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n            </span><span class="s1">var content = require(</span><span class="s3">\&quot;</span><span class="s1">!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/postcss-loader/src/index.js!../../../node_modules/less-loader/dist/cjs.js!./icon.less</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n\n            </span><span class="s1">content = content.__esModule ? content.default : content;</span><span class="s3">\n\n            </span><span class="s1">if (typeof content === 'string') {</span><span class="s3">\n              </span><span class="s1">content = [[module.id, content, '']];</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">var options = {};</span><span class="s3">\n\n</span><span class="s1">options.insert = </span><span class="s3">\&quot;</span><span class="s1">head</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n</span><span class="s1">options.singleton = false;</span><span class="s3">\n\n</span><span class="s1">var update = api(content, options);</span><span class="s3">\n\n\n\n</span><span class="s1">module.exports = content.locals || {};&quot;</span><span class="s0">,</span><span class="s1">&quot;// Imports</span><span class="s3">\n</span><span class="s1">var ___CSS_LOADER_API_IMPORT___ = require(</span><span class="s3">\&quot;</span><span class="s1">../../../node_modules/css-loader/dist/runtime/api.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">var ___CSS_LOADER_GET_URL_IMPORT___ = require(</span><span class="s3">\&quot;</span><span class="s1">../../../node_modules/css-loader/dist/runtime/getUrl.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">var ___CSS_LOADER_URL_IMPORT_0___ = require(</span><span class="s3">\&quot;</span><span class="s1">../font/w-e-icon.woff?ddq1c7</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">exports = ___CSS_LOADER_API_IMPORT___(false);</span><span class="s3">\n</span><span class="s1">var ___CSS_LOADER_URL_REPLACEMENT_0___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_0___);</span><span class="s3">\n</span><span class="s1">// Module</span><span class="s3">\n</span><span class="s1">exports.push([module.id, </span><span class="s3">\&quot;</span><span class="s1">@font-face {</span><span class="s3">\\</span><span class="s1">n  font-family: 'w-e-icon';</span><span class="s3">\\</span><span class="s1">n  src: url(</span><span class="s3">\&quot; </span><span class="s1">+ ___CSS_LOADER_URL_REPLACEMENT_0___ + </span><span class="s3">\&quot;</span><span class="s1">) format('truetype');</span><span class="s3">\\</span><span class="s1">n  font-weight: normal;</span><span class="s3">\\</span><span class="s1">n  font-style: normal;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n[class^=</span><span class="s3">\\\&quot;</span><span class="s1">w-e-icon-</span><span class="s3">\\\&quot;</span><span class="s1">],</span><span class="s3">\\</span><span class="s1">n[class*=</span><span class="s3">\\\&quot; </span><span class="s1">w-e-icon-</span><span class="s3">\\\&quot;</span><span class="s1">] {</span><span class="s3">\\</span><span class="s1">n  /* use !important to prevent issues with browser extensions that change fonts */</span><span class="s3">\\</span><span class="s1">n  font-family: 'w-e-icon' !important;</span><span class="s3">\\</span><span class="s1">n  speak: none;</span><span class="s3">\\</span><span class="s1">n  font-style: normal;</span><span class="s3">\\</span><span class="s1">n  font-weight: normal;</span><span class="s3">\\</span><span class="s1">n  font-variant: normal;</span><span class="s3">\\</span><span class="s1">n  text-transform: none;</span><span class="s3">\\</span><span class="s1">n  line-height: 1;</span><span class="s3">\\</span><span class="s1">n  /* Better Font Rendering =========== */</span><span class="s3">\\</span><span class="s1">n  -webkit-font-smoothing: antialiased;</span><span class="s3">\\</span><span class="s1">n  -moz-osx-font-smoothing: grayscale;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-close:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">f00d</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-upload2:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e9c6</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-trash-o:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">f014</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-header:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">f1dc</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-pencil2:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e906</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-paint-brush:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">f1fc</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-image:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e90d</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-play:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e912</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-location:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e947</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-undo:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e965</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-redo:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e966</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-quotes-left:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e977</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-list-numbered:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e9b9</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-list2:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e9bb</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-link:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e9cb</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-happy:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e9df</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-bold:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea62</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-underline:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea63</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-italic:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea64</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-strikethrough:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea65</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-table2:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea71</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-paragraph-left:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea77</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-paragraph-center:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea78</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-paragraph-right:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea79</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-paragraph-justify:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea7a</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-terminal:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">f120</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-page-break:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea68</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-cancel-circle:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea0d</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-font:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea5c</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-text-heigh:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea5f</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-paint-format:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e90c</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-indent-increase:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea7b</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-indent-decrease:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea7c</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-row-height:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e9be</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-fullscreen_exit:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e900</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-fullscreen:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">e901</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-split-line:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea0b</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-icon-checkbox-checked:before {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\\</span><span class="s1">ea52</span><span class="s3">\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n</span><span class="s3">\&quot;</span><span class="s1">, </span><span class="s3">\&quot;\&quot;</span><span class="s1">]);</span><span class="s3">\n</span><span class="s1">// Exports</span><span class="s3">\n</span><span class="s1">module.exports = exports;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;</span><span class="s3">\&quot;</span><span class="s1">use strict</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (url, options) {</span><span class="s3">\n  </span><span class="s1">if (!options) {</span><span class="s3">\n    </span><span class="s1">// eslint-disable-next-line no-param-reassign</span><span class="s3">\n    </span><span class="s1">options = {};</span><span class="s3">\n  </span><span class="s1">} // eslint-disable-next-line no-underscore-dangle, no-param-reassign</span><span class="s3">\n\n\n  </span><span class="s1">url = url &amp;&amp; url.__esModule ? url.default : url;</span><span class="s3">\n\n  </span><span class="s1">if (typeof url !== 'string') {</span><span class="s3">\n    </span><span class="s1">return url;</span><span class="s3">\n  </span><span class="s1">} // If url is already wrapped in quotes, remove them</span><span class="s3">\n\n\n  </span><span class="s1">if (/^['</span><span class="s3">\&quot;</span><span class="s1">].*['</span><span class="s3">\&quot;</span><span class="s1">]$/.test(url)) {</span><span class="s3">\n    </span><span class="s1">// eslint-disable-next-line no-param-reassign</span><span class="s3">\n    </span><span class="s1">url = url.slice(1, -1);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (options.hash) {</span><span class="s3">\n    </span><span class="s1">// eslint-disable-next-line no-param-reassign</span><span class="s3">\n    </span><span class="s1">url += options.hash;</span><span class="s3">\n  </span><span class="s1">} // Should url be wrapped?</span><span class="s3">\n  </span><span class="s1">// See https://drafts.csswg.org/css-values-3/#urls</span><span class="s3">\n\n\n  </span><span class="s1">if (/[</span><span class="s3">\&quot;</span><span class="s1">'() </span><span class="s3">\\</span><span class="s1">t</span><span class="s3">\\</span><span class="s1">n]/.test(url) || options.needQuotes) {</span><span class="s3">\n    </span><span class="s1">return </span><span class="s3">\&quot;\\\&quot;\&quot;</span><span class="s1">.concat(url.replace(/</span><span class="s3">\&quot;</span><span class="s1">/g, '</span><span class="s3">\\\\\&quot;</span><span class="s1">').replace(/</span><span class="s3">\\</span><span class="s1">n/g, '</span><span class="s3">\\\\</span><span class="s1">n'), </span><span class="s3">\&quot;\\\&quot;\&quot;</span><span class="s1">);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return url;</span><span class="s3">\n</span><span class="s1">};&quot;</span><span class="s0">,</span><span class="s1">&quot;export default </span><span class="s3">\&quot;</span><span class="s1">data:font/woff;base64,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</span><span class="s3">\&quot;</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var api = require(</span><span class="s3">\&quot;</span><span class="s1">!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n            </span><span class="s1">var content = require(</span><span class="s3">\&quot;</span><span class="s1">!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/postcss-loader/src/index.js!../../../node_modules/less-loader/dist/cjs.js!./menus.less</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n\n            </span><span class="s1">content = content.__esModule ? content.default : content;</span><span class="s3">\n\n            </span><span class="s1">if (typeof content === 'string') {</span><span class="s3">\n              </span><span class="s1">content = [[module.id, content, '']];</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">var options = {};</span><span class="s3">\n\n</span><span class="s1">options.insert = </span><span class="s3">\&quot;</span><span class="s1">head</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n</span><span class="s1">options.singleton = false;</span><span class="s3">\n\n</span><span class="s1">var update = api(content, options);</span><span class="s3">\n\n\n\n</span><span class="s1">module.exports = content.locals || {};&quot;</span><span class="s0">,</span><span class="s1">&quot;// Imports</span><span class="s3">\n</span><span class="s1">var ___CSS_LOADER_API_IMPORT___ = require(</span><span class="s3">\&quot;</span><span class="s1">../../../node_modules/css-loader/dist/runtime/api.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">exports = ___CSS_LOADER_API_IMPORT___(false);</span><span class="s3">\n</span><span class="s1">// Module</span><span class="s3">\n</span><span class="s1">exports.push([module.id, </span><span class="s3">\&quot;</span><span class="s1">.w-e-toolbar {</span><span class="s3">\\</span><span class="s1">n  display: flex;</span><span class="s3">\\</span><span class="s1">n  padding: 0 6px;</span><span class="s3">\\</span><span class="s1">n  flex-wrap: wrap;</span><span class="s3">\\</span><span class="s1">n  position: relative;</span><span class="s3">\\</span><span class="s1">n  /* 单个菜单 */</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .w-e-menu {</span><span class="s3">\\</span><span class="s1">n  position: relative;</span><span class="s3">\\</span><span class="s1">n  display: flex;</span><span class="s3">\\</span><span class="s1">n  width: 40px;</span><span class="s3">\\</span><span class="s1">n  height: 40px;</span><span class="s3">\\</span><span class="s1">n  align-items: center;</span><span class="s3">\\</span><span class="s1">n  justify-content: center;</span><span class="s3">\\</span><span class="s1">n  text-align: center;</span><span class="s3">\\</span><span class="s1">n  cursor: pointer;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .w-e-menu i {</span><span class="s3">\\</span><span class="s1">n  color: #999;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .w-e-menu:hover {</span><span class="s3">\\</span><span class="s1">n  background-color: #F6F6F6;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .w-e-menu:hover i {</span><span class="s3">\\</span><span class="s1">n  color: #333;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .w-e-active i {</span><span class="s3">\\</span><span class="s1">n  color: #1e88e5;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .w-e-active:hover i {</span><span class="s3">\\</span><span class="s1">n  color: #1e88e5;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu-tooltip {</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  display: flex;</span><span class="s3">\\</span><span class="s1">n  color: #f1f1f1;</span><span class="s3">\\</span><span class="s1">n  background-color: rgba(0, 0, 0, 0.75);</span><span class="s3">\\</span><span class="s1">n  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.15);</span><span class="s3">\\</span><span class="s1">n  border-radius: 4px;</span><span class="s3">\\</span><span class="s1">n  padding: 4px 5px 6px;</span><span class="s3">\\</span><span class="s1">n  justify-content: center;</span><span class="s3">\\</span><span class="s1">n  align-items: center;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu-tooltip-up::after {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  top: 100%;</span><span class="s3">\\</span><span class="s1">n  left: 50%;</span><span class="s3">\\</span><span class="s1">n  margin-left: -5px;</span><span class="s3">\\</span><span class="s1">n  border: 5px solid rgba(0, 0, 0, 0);</span><span class="s3">\\</span><span class="s1">n  border-top-color: rgba(0, 0, 0, 0.73);</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu-tooltip-down::after {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  bottom: 100%;</span><span class="s3">\\</span><span class="s1">n  left: 50%;</span><span class="s3">\\</span><span class="s1">n  margin-left: -5px;</span><span class="s3">\\</span><span class="s1">n  border: 5px solid rgba(0, 0, 0, 0);</span><span class="s3">\\</span><span class="s1">n  border-bottom-color: rgba(0, 0, 0, 0.73);</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu-tooltip-item-wrapper {</span><span class="s3">\\</span><span class="s1">n  font-size: 14px;</span><span class="s3">\\</span><span class="s1">n  margin: 0 5px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n</span><span class="s3">\&quot;</span><span class="s1">, </span><span class="s3">\&quot;\&quot;</span><span class="s1">]);</span><span class="s3">\n</span><span class="s1">// Exports</span><span class="s3">\n</span><span class="s1">module.exports = exports;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var api = require(</span><span class="s3">\&quot;</span><span class="s1">!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n            </span><span class="s1">var content = require(</span><span class="s3">\&quot;</span><span class="s1">!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/postcss-loader/src/index.js!../../../node_modules/less-loader/dist/cjs.js!./text.less</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n\n            </span><span class="s1">content = content.__esModule ? content.default : content;</span><span class="s3">\n\n            </span><span class="s1">if (typeof content === 'string') {</span><span class="s3">\n              </span><span class="s1">content = [[module.id, content, '']];</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">var options = {};</span><span class="s3">\n\n</span><span class="s1">options.insert = </span><span class="s3">\&quot;</span><span class="s1">head</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n</span><span class="s1">options.singleton = false;</span><span class="s3">\n\n</span><span class="s1">var update = api(content, options);</span><span class="s3">\n\n\n\n</span><span class="s1">module.exports = content.locals || {};&quot;</span><span class="s0">,</span><span class="s1">&quot;// Imports</span><span class="s3">\n</span><span class="s1">var ___CSS_LOADER_API_IMPORT___ = require(</span><span class="s3">\&quot;</span><span class="s1">../../../node_modules/css-loader/dist/runtime/api.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">exports = ___CSS_LOADER_API_IMPORT___(false);</span><span class="s3">\n</span><span class="s1">// Module</span><span class="s3">\n</span><span class="s1">exports.push([module.id, </span><span class="s3">\&quot;</span><span class="s1">.w-e-text-container {</span><span class="s3">\\</span><span class="s1">n  position: relative;</span><span class="s3">\\</span><span class="s1">n  height: 100%;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text-container .w-e-progress {</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  background-color: #1e88e5;</span><span class="s3">\\</span><span class="s1">n  top: 0;</span><span class="s3">\\</span><span class="s1">n  left: 0;</span><span class="s3">\\</span><span class="s1">n  height: 1px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text-container .placeholder {</span><span class="s3">\\</span><span class="s1">n  color: #D4D4D4;</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  font-size: 11pt;</span><span class="s3">\\</span><span class="s1">n  line-height: 22px;</span><span class="s3">\\</span><span class="s1">n  left: 10px;</span><span class="s3">\\</span><span class="s1">n  top: 10px;</span><span class="s3">\\</span><span class="s1">n  -webkit-user-select: none;</span><span class="s3">\\</span><span class="s1">n     -moz-user-select: none;</span><span class="s3">\\</span><span class="s1">n      -ms-user-select: none;</span><span class="s3">\\</span><span class="s1">n          user-select: none;</span><span class="s3">\\</span><span class="s1">n  z-index: -1;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text {</span><span class="s3">\\</span><span class="s1">n  padding: 0 10px;</span><span class="s3">\\</span><span class="s1">n  overflow-y: auto;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text p,</span><span class="s3">\\</span><span class="s1">n.w-e-text h1,</span><span class="s3">\\</span><span class="s1">n.w-e-text h2,</span><span class="s3">\\</span><span class="s1">n.w-e-text h3,</span><span class="s3">\\</span><span class="s1">n.w-e-text h4,</span><span class="s3">\\</span><span class="s1">n.w-e-text h5,</span><span class="s3">\\</span><span class="s1">n.w-e-text table,</span><span class="s3">\\</span><span class="s1">n.w-e-text pre {</span><span class="s3">\\</span><span class="s1">n  margin: 10px 0;</span><span class="s3">\\</span><span class="s1">n  line-height: 1.5;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text ul,</span><span class="s3">\\</span><span class="s1">n.w-e-text ol {</span><span class="s3">\\</span><span class="s1">n  margin: 10px 0 10px 20px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text blockquote {</span><span class="s3">\\</span><span class="s1">n  display: block;</span><span class="s3">\\</span><span class="s1">n  border-left: 8px solid #d0e5f2;</span><span class="s3">\\</span><span class="s1">n  padding: 5px 10px;</span><span class="s3">\\</span><span class="s1">n  margin: 10px 0;</span><span class="s3">\\</span><span class="s1">n  line-height: 1.4;</span><span class="s3">\\</span><span class="s1">n  font-size: 100%;</span><span class="s3">\\</span><span class="s1">n  background-color: #f1f1f1;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text code {</span><span class="s3">\\</span><span class="s1">n  display: inline-block;</span><span class="s3">\\</span><span class="s1">n  background-color: #f1f1f1;</span><span class="s3">\\</span><span class="s1">n  border-radius: 3px;</span><span class="s3">\\</span><span class="s1">n  padding: 3px 5px;</span><span class="s3">\\</span><span class="s1">n  margin: 0 3px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text pre code {</span><span class="s3">\\</span><span class="s1">n  display: block;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text table {</span><span class="s3">\\</span><span class="s1">n  border-top: 1px solid #ccc;</span><span class="s3">\\</span><span class="s1">n  border-left: 1px solid #ccc;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text table td,</span><span class="s3">\\</span><span class="s1">n.w-e-text table th {</span><span class="s3">\\</span><span class="s1">n  border-bottom: 1px solid #ccc;</span><span class="s3">\\</span><span class="s1">n  border-right: 1px solid #ccc;</span><span class="s3">\\</span><span class="s1">n  padding: 3px 5px;</span><span class="s3">\\</span><span class="s1">n  min-height: 30px;</span><span class="s3">\\</span><span class="s1">n  height: 30px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text table th {</span><span class="s3">\\</span><span class="s1">n  border-bottom: 2px solid #ccc;</span><span class="s3">\\</span><span class="s1">n  text-align: center;</span><span class="s3">\\</span><span class="s1">n  background-color: #f1f1f1;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text:focus {</span><span class="s3">\\</span><span class="s1">n  outline: none;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text img {</span><span class="s3">\\</span><span class="s1">n  cursor: pointer;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text img:hover {</span><span class="s3">\\</span><span class="s1">n  box-shadow: 0 0 5px #333;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text .w-e-todo {</span><span class="s3">\\</span><span class="s1">n  margin: 0 0 0 20px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text .w-e-todo li {</span><span class="s3">\\</span><span class="s1">n  list-style: none;</span><span class="s3">\\</span><span class="s1">n  font-size: 1em;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text .w-e-todo li span:nth-child(1) {</span><span class="s3">\\</span><span class="s1">n  position: relative;</span><span class="s3">\\</span><span class="s1">n  left: -18px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text .w-e-todo li span:nth-child(1) input {</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  margin-right: 3px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-text .w-e-todo li span:nth-child(1) input[type=checkbox] {</span><span class="s3">\\</span><span class="s1">n  top: 50%;</span><span class="s3">\\</span><span class="s1">n  margin-top: -6px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-tooltip {</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  display: flex;</span><span class="s3">\\</span><span class="s1">n  color: #f1f1f1;</span><span class="s3">\\</span><span class="s1">n  background-color: rgba(0, 0, 0, 0.75);</span><span class="s3">\\</span><span class="s1">n  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.15);</span><span class="s3">\\</span><span class="s1">n  border-radius: 4px;</span><span class="s3">\\</span><span class="s1">n  padding: 4px 5px 6px;</span><span class="s3">\\</span><span class="s1">n  justify-content: center;</span><span class="s3">\\</span><span class="s1">n  align-items: center;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-tooltip-up::after {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  top: 100%;</span><span class="s3">\\</span><span class="s1">n  left: 50%;</span><span class="s3">\\</span><span class="s1">n  margin-left: -5px;</span><span class="s3">\\</span><span class="s1">n  border: 5px solid rgba(0, 0, 0, 0);</span><span class="s3">\\</span><span class="s1">n  border-top-color: rgba(0, 0, 0, 0.73);</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-tooltip-down::after {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  bottom: 100%;</span><span class="s3">\\</span><span class="s1">n  left: 50%;</span><span class="s3">\\</span><span class="s1">n  margin-left: -5px;</span><span class="s3">\\</span><span class="s1">n  border: 5px solid rgba(0, 0, 0, 0);</span><span class="s3">\\</span><span class="s1">n  border-bottom-color: rgba(0, 0, 0, 0.73);</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-tooltip-item-wrapper {</span><span class="s3">\\</span><span class="s1">n  cursor: pointer;</span><span class="s3">\\</span><span class="s1">n  font-size: 14px;</span><span class="s3">\\</span><span class="s1">n  margin: 0 5px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-tooltip-item-wrapper:hover {</span><span class="s3">\\</span><span class="s1">n  color: #ccc;</span><span class="s3">\\</span><span class="s1">n  text-decoration: underline;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n</span><span class="s3">\&quot;</span><span class="s1">, </span><span class="s3">\&quot;\&quot;</span><span class="s1">]);</span><span class="s3">\n</span><span class="s1">// Exports</span><span class="s3">\n</span><span class="s1">module.exports = exports;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var api = require(</span><span class="s3">\&quot;</span><span class="s1">!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n            </span><span class="s1">var content = require(</span><span class="s3">\&quot;</span><span class="s1">!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/postcss-loader/src/index.js!../../../node_modules/less-loader/dist/cjs.js!./panel.less</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n\n            </span><span class="s1">content = content.__esModule ? content.default : content;</span><span class="s3">\n\n            </span><span class="s1">if (typeof content === 'string') {</span><span class="s3">\n              </span><span class="s1">content = [[module.id, content, '']];</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">var options = {};</span><span class="s3">\n\n</span><span class="s1">options.insert = </span><span class="s3">\&quot;</span><span class="s1">head</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n</span><span class="s1">options.singleton = false;</span><span class="s3">\n\n</span><span class="s1">var update = api(content, options);</span><span class="s3">\n\n\n\n</span><span class="s1">module.exports = content.locals || {};&quot;</span><span class="s0">,</span><span class="s1">&quot;// Imports</span><span class="s3">\n</span><span class="s1">var ___CSS_LOADER_API_IMPORT___ = require(</span><span class="s3">\&quot;</span><span class="s1">../../../node_modules/css-loader/dist/runtime/api.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">exports = ___CSS_LOADER_API_IMPORT___(false);</span><span class="s3">\n</span><span class="s1">// Module</span><span class="s3">\n</span><span class="s1">exports.push([module.id, </span><span class="s3">\&quot;</span><span class="s1">.w-e-menu .w-e-panel-container {</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  top: 0;</span><span class="s3">\\</span><span class="s1">n  left: 50%;</span><span class="s3">\\</span><span class="s1">n  border: 1px solid #ccc;</span><span class="s3">\\</span><span class="s1">n  border-top: 0;</span><span class="s3">\\</span><span class="s1">n  box-shadow: 1px 1px 2px #ccc;</span><span class="s3">\\</span><span class="s1">n  color: #333;</span><span class="s3">\\</span><span class="s1">n  background-color: #fff;</span><span class="s3">\\</span><span class="s1">n  text-align: left;</span><span class="s3">\\</span><span class="s1">n  /* 为 emotion panel 定制的样式 */</span><span class="s3">\\</span><span class="s1">n  /* 上传图片、上传视频的 panel 定制样式 */</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-close {</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  right: 0;</span><span class="s3">\\</span><span class="s1">n  top: 0;</span><span class="s3">\\</span><span class="s1">n  padding: 5px;</span><span class="s3">\\</span><span class="s1">n  margin: 2px 5px 0 0;</span><span class="s3">\\</span><span class="s1">n  cursor: pointer;</span><span class="s3">\\</span><span class="s1">n  color: #999;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-close:hover {</span><span class="s3">\\</span><span class="s1">n  color: #333;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-title {</span><span class="s3">\\</span><span class="s1">n  list-style: none;</span><span class="s3">\\</span><span class="s1">n  display: flex;</span><span class="s3">\\</span><span class="s1">n  font-size: 14px;</span><span class="s3">\\</span><span class="s1">n  margin: 2px 10px 0 10px;</span><span class="s3">\\</span><span class="s1">n  border-bottom: 1px solid #f1f1f1;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-title .w-e-item {</span><span class="s3">\\</span><span class="s1">n  padding: 3px 5px;</span><span class="s3">\\</span><span class="s1">n  color: #999;</span><span class="s3">\\</span><span class="s1">n  cursor: pointer;</span><span class="s3">\\</span><span class="s1">n  margin: 0 3px;</span><span class="s3">\\</span><span class="s1">n  position: relative;</span><span class="s3">\\</span><span class="s1">n  top: 1px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-title .w-e-active {</span><span class="s3">\\</span><span class="s1">n  color: #333;</span><span class="s3">\\</span><span class="s1">n  border-bottom: 1px solid #333;</span><span class="s3">\\</span><span class="s1">n  cursor: default;</span><span class="s3">\\</span><span class="s1">n  font-weight: 700;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content {</span><span class="s3">\\</span><span class="s1">n  padding: 10px 15px 10px 15px;</span><span class="s3">\\</span><span class="s1">n  font-size: 16px;</span><span class="s3">\\</span><span class="s1">n  /* 输入框的样式 */</span><span class="s3">\\</span><span class="s1">n  /* 按钮的样式 */</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content input:focus,</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content textarea:focus,</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content button:focus {</span><span class="s3">\\</span><span class="s1">n  outline: none;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content textarea {</span><span class="s3">\\</span><span class="s1">n  width: 100%;</span><span class="s3">\\</span><span class="s1">n  border: 1px solid #ccc;</span><span class="s3">\\</span><span class="s1">n  padding: 5px;</span><span class="s3">\\</span><span class="s1">n  margin-top: 10px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content textarea:focus {</span><span class="s3">\\</span><span class="s1">n  border-color: #1e88e5;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content input[type=text] {</span><span class="s3">\\</span><span class="s1">n  border: none;</span><span class="s3">\\</span><span class="s1">n  border-bottom: 1px solid #ccc;</span><span class="s3">\\</span><span class="s1">n  font-size: 14px;</span><span class="s3">\\</span><span class="s1">n  height: 20px;</span><span class="s3">\\</span><span class="s1">n  color: #333;</span><span class="s3">\\</span><span class="s1">n  text-align: left;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content input[type=text].small {</span><span class="s3">\\</span><span class="s1">n  width: 30px;</span><span class="s3">\\</span><span class="s1">n  text-align: center;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content input[type=text].block {</span><span class="s3">\\</span><span class="s1">n  display: block;</span><span class="s3">\\</span><span class="s1">n  width: 100%;</span><span class="s3">\\</span><span class="s1">n  margin: 10px 0;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content input[type=text]:focus {</span><span class="s3">\\</span><span class="s1">n  border-bottom: 2px solid #1e88e5;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content .w-e-button-container button {</span><span class="s3">\\</span><span class="s1">n  font-size: 14px;</span><span class="s3">\\</span><span class="s1">n  color: #1e88e5;</span><span class="s3">\\</span><span class="s1">n  border: none;</span><span class="s3">\\</span><span class="s1">n  padding: 5px 10px;</span><span class="s3">\\</span><span class="s1">n  background-color: #fff;</span><span class="s3">\\</span><span class="s1">n  cursor: pointer;</span><span class="s3">\\</span><span class="s1">n  border-radius: 3px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content .w-e-button-container button.left {</span><span class="s3">\\</span><span class="s1">n  float: left;</span><span class="s3">\\</span><span class="s1">n  margin-right: 10px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content .w-e-button-container button.right {</span><span class="s3">\\</span><span class="s1">n  float: right;</span><span class="s3">\\</span><span class="s1">n  margin-left: 10px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content .w-e-button-container button.gray {</span><span class="s3">\\</span><span class="s1">n  color: #999;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content .w-e-button-container button.red {</span><span class="s3">\\</span><span class="s1">n  color: #c24f4a;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content .w-e-button-container button:hover {</span><span class="s3">\\</span><span class="s1">n  background-color: #f1f1f1;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-panel-tab-content .w-e-button-container:after {</span><span class="s3">\\</span><span class="s1">n  content: </span><span class="s3">\\\&quot;\\\&quot;</span><span class="s1">;</span><span class="s3">\\</span><span class="s1">n  display: table;</span><span class="s3">\\</span><span class="s1">n  clear: both;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-emoticon-container .w-e-item {</span><span class="s3">\\</span><span class="s1">n  cursor: pointer;</span><span class="s3">\\</span><span class="s1">n  font-size: 18px;</span><span class="s3">\\</span><span class="s1">n  padding: 0 3px;</span><span class="s3">\\</span><span class="s1">n  display: inline-block;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-up-img-container,</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-up-video-container {</span><span class="s3">\\</span><span class="s1">n  text-align: center;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-up-img-container .w-e-up-btn,</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-up-video-container .w-e-up-btn {</span><span class="s3">\\</span><span class="s1">n  display: inline-block;</span><span class="s3">\\</span><span class="s1">n  color: #999;</span><span class="s3">\\</span><span class="s1">n  cursor: pointer;</span><span class="s3">\\</span><span class="s1">n  font-size: 60px;</span><span class="s3">\\</span><span class="s1">n  line-height: 1;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-up-img-container .w-e-up-btn:hover,</span><span class="s3">\\</span><span class="s1">n.w-e-menu .w-e-panel-container .w-e-up-video-container .w-e-up-btn:hover {</span><span class="s3">\\</span><span class="s1">n  color: #333;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n</span><span class="s3">\&quot;</span><span class="s1">, </span><span class="s3">\&quot;\&quot;</span><span class="s1">]);</span><span class="s3">\n</span><span class="s1">// Exports</span><span class="s3">\n</span><span class="s1">module.exports = exports;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var api = require(</span><span class="s3">\&quot;</span><span class="s1">!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n            </span><span class="s1">var content = require(</span><span class="s3">\&quot;</span><span class="s1">!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/postcss-loader/src/index.js!../../../node_modules/less-loader/dist/cjs.js!./droplist.less</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n\n            </span><span class="s1">content = content.__esModule ? content.default : content;</span><span class="s3">\n\n            </span><span class="s1">if (typeof content === 'string') {</span><span class="s3">\n              </span><span class="s1">content = [[module.id, content, '']];</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">var options = {};</span><span class="s3">\n\n</span><span class="s1">options.insert = </span><span class="s3">\&quot;</span><span class="s1">head</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n</span><span class="s1">options.singleton = false;</span><span class="s3">\n\n</span><span class="s1">var update = api(content, options);</span><span class="s3">\n\n\n\n</span><span class="s1">module.exports = content.locals || {};&quot;</span><span class="s0">,</span><span class="s1">&quot;// Imports</span><span class="s3">\n</span><span class="s1">var ___CSS_LOADER_API_IMPORT___ = require(</span><span class="s3">\&quot;</span><span class="s1">../../../node_modules/css-loader/dist/runtime/api.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">exports = ___CSS_LOADER_API_IMPORT___(false);</span><span class="s3">\n</span><span class="s1">// Module</span><span class="s3">\n</span><span class="s1">exports.push([module.id, </span><span class="s3">\&quot;</span><span class="s1">.w-e-toolbar .w-e-droplist {</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  left: 0;</span><span class="s3">\\</span><span class="s1">n  top: 0;</span><span class="s3">\\</span><span class="s1">n  background-color: #fff;</span><span class="s3">\\</span><span class="s1">n  border: 1px solid #f1f1f1;</span><span class="s3">\\</span><span class="s1">n  border-right-color: #ccc;</span><span class="s3">\\</span><span class="s1">n  border-bottom-color: #ccc;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .w-e-droplist .w-e-dp-title {</span><span class="s3">\\</span><span class="s1">n  text-align: center;</span><span class="s3">\\</span><span class="s1">n  color: #999;</span><span class="s3">\\</span><span class="s1">n  line-height: 2;</span><span class="s3">\\</span><span class="s1">n  border-bottom: 1px solid #f1f1f1;</span><span class="s3">\\</span><span class="s1">n  font-size: 13px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .w-e-droplist ul.w-e-list {</span><span class="s3">\\</span><span class="s1">n  list-style: none;</span><span class="s3">\\</span><span class="s1">n  line-height: 1;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .w-e-droplist ul.w-e-list li.w-e-item {</span><span class="s3">\\</span><span class="s1">n  color: #333;</span><span class="s3">\\</span><span class="s1">n  padding: 5px 0;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .w-e-droplist ul.w-e-list li.w-e-item:hover {</span><span class="s3">\\</span><span class="s1">n  background-color: #f1f1f1;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .w-e-droplist ul.w-e-block {</span><span class="s3">\\</span><span class="s1">n  list-style: none;</span><span class="s3">\\</span><span class="s1">n  text-align: left;</span><span class="s3">\\</span><span class="s1">n  padding: 5px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .w-e-droplist ul.w-e-block li.w-e-item {</span><span class="s3">\\</span><span class="s1">n  display: inline-block;</span><span class="s3">\\</span><span class="s1">n  padding: 3px 5px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-toolbar .w-e-droplist ul.w-e-block li.w-e-item:hover {</span><span class="s3">\\</span><span class="s1">n  background-color: #f1f1f1;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n</span><span class="s3">\&quot;</span><span class="s1">, </span><span class="s3">\&quot;\&quot;</span><span class="s1">]);</span><span class="s3">\n</span><span class="s1">// Exports</span><span class="s3">\n</span><span class="s1">module.exports = exports;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description polyfill 【注意，js 语法的兼容，都通过 babel transform runtime 支持】</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">if (!Element.prototype.matches) {</span><span class="s3">\n    </span><span class="s1">Element.prototype.matches = function (s) {</span><span class="s3">\n        </span><span class="s1">let matches: NodeListOf&lt;Element&gt; = this.ownerDocument.querySelectorAll(s)</span><span class="s3">\n        </span><span class="s1">let i: number = matches.length</span><span class="s3">\n        </span><span class="s1">for (i; i &gt;= 0; i--) {</span><span class="s3">\n            </span><span class="s1">if (matches.item(i) === this) break</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return i &gt; -1</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// 有的第三方库需要原生 Promise ，而 IE11 又没有原生 Promise ，就报错</span><span class="s3">\n</span><span class="s1">if (!window.Promise) {</span><span class="s3">\n    </span><span class="s1">window.Promise = Promise</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/promise</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/promise');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.object.to-string');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.string.iterator');</span><span class="s3">\n</span><span class="s1">require('../../modules/web.dom-collections.iterator');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.promise');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.promise.all-settled');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.promise.finally');</span><span class="s3">\n</span><span class="s1">var path = require('../../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.Promise;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var toInteger = require('../internals/to-integer');</span><span class="s3">\n</span><span class="s1">var requireObjectCoercible = require('../internals/require-object-coercible');</span><span class="s3">\n\n</span><span class="s1">// `String.prototype.{ codePointAt, at }` methods implementation</span><span class="s3">\n</span><span class="s1">var createMethod = function (CONVERT_TO_STRING) {</span><span class="s3">\n  </span><span class="s1">return function ($this, pos) {</span><span class="s3">\n    </span><span class="s1">var S = String(requireObjectCoercible($this));</span><span class="s3">\n    </span><span class="s1">var position = toInteger(pos);</span><span class="s3">\n    </span><span class="s1">var size = S.length;</span><span class="s3">\n    </span><span class="s1">var first, second;</span><span class="s3">\n    </span><span class="s1">if (position &lt; 0 || position &gt;= size) return CONVERT_TO_STRING ? '' : undefined;</span><span class="s3">\n    </span><span class="s1">first = S.charCodeAt(position);</span><span class="s3">\n    </span><span class="s1">return first &lt; 0xD800 || first &gt; 0xDBFF || position + 1 === size</span><span class="s3">\n      </span><span class="s1">|| (second = S.charCodeAt(position + 1)) &lt; 0xDC00 || second &gt; 0xDFFF</span><span class="s3">\n        </span><span class="s1">? CONVERT_TO_STRING ? S.charAt(position) : first</span><span class="s3">\n        </span><span class="s1">: CONVERT_TO_STRING ? S.slice(position, position + 2) : (first - 0xD800 &lt;&lt; 10) + (second - 0xDC00) + 0x10000;</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">module.exports = {</span><span class="s3">\n  </span><span class="s1">// `String.prototype.codePointAt` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-string.prototype.codepointat</span><span class="s3">\n  </span><span class="s1">codeAt: createMethod(false),</span><span class="s3">\n  </span><span class="s1">// `String.prototype.at` method</span><span class="s3">\n  </span><span class="s1">// https://github.com/mathiasbynens/String.prototype.at</span><span class="s3">\n  </span><span class="s1">charAt: createMethod(true)</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var inspectSource = require('../internals/inspect-source');</span><span class="s3">\n\n</span><span class="s1">var WeakMap = global.WeakMap;</span><span class="s3">\n\n</span><span class="s1">module.exports = typeof WeakMap === 'function' &amp;&amp; /native code/.test(inspectSource(WeakMap));</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var createNonEnumerableProperty = require('../internals/create-non-enumerable-property');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (key, value) {</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">createNonEnumerableProperty(global, key, value);</span><span class="s3">\n  </span><span class="s1">} catch (error) {</span><span class="s3">\n    </span><span class="s1">global[key] = value;</span><span class="s3">\n  </span><span class="s1">} return value;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var IteratorPrototype = require('../internals/iterators-core').IteratorPrototype;</span><span class="s3">\n</span><span class="s1">var create = require('../internals/object-create');</span><span class="s3">\n</span><span class="s1">var createPropertyDescriptor = require('../internals/create-property-descriptor');</span><span class="s3">\n</span><span class="s1">var setToStringTag = require('../internals/set-to-string-tag');</span><span class="s3">\n</span><span class="s1">var Iterators = require('../internals/iterators');</span><span class="s3">\n\n</span><span class="s1">var returnThis = function () { return this; };</span><span class="s3">\n\n</span><span class="s1">module.exports = function (IteratorConstructor, NAME, next) {</span><span class="s3">\n  </span><span class="s1">var TO_STRING_TAG = NAME + ' Iterator';</span><span class="s3">\n  </span><span class="s1">IteratorConstructor.prototype = create(IteratorPrototype, { next: createPropertyDescriptor(1, next) });</span><span class="s3">\n  </span><span class="s1">setToStringTag(IteratorConstructor, TO_STRING_TAG, false, true);</span><span class="s3">\n  </span><span class="s1">Iterators[TO_STRING_TAG] = returnThis;</span><span class="s3">\n  </span><span class="s1">return IteratorConstructor;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var fails = require('../internals/fails');</span><span class="s3">\n\n</span><span class="s1">module.exports = !fails(function () {</span><span class="s3">\n  </span><span class="s1">function F() { /* empty */ }</span><span class="s3">\n  </span><span class="s1">F.prototype.constructor = null;</span><span class="s3">\n  </span><span class="s1">return Object.getPrototypeOf(new F()) !== F.prototype;</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var DESCRIPTORS = require('../internals/descriptors');</span><span class="s3">\n</span><span class="s1">var definePropertyModule = require('../internals/object-define-property');</span><span class="s3">\n</span><span class="s1">var anObject = require('../internals/an-object');</span><span class="s3">\n</span><span class="s1">var objectKeys = require('../internals/object-keys');</span><span class="s3">\n\n</span><span class="s1">// `Object.defineProperties` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.defineproperties</span><span class="s3">\n</span><span class="s1">module.exports = DESCRIPTORS ? Object.defineProperties : function defineProperties(O, Properties) {</span><span class="s3">\n  </span><span class="s1">anObject(O);</span><span class="s3">\n  </span><span class="s1">var keys = objectKeys(Properties);</span><span class="s3">\n  </span><span class="s1">var length = keys.length;</span><span class="s3">\n  </span><span class="s1">var index = 0;</span><span class="s3">\n  </span><span class="s1">var key;</span><span class="s3">\n  </span><span class="s1">while (length &gt; index) definePropertyModule.f(O, key = keys[index++], Properties[key]);</span><span class="s3">\n  </span><span class="s1">return O;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');</span><span class="s3">\n</span><span class="s1">var classof = require('../internals/classof');</span><span class="s3">\n\n</span><span class="s1">// `Object.prototype.toString` method implementation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.prototype.tostring</span><span class="s3">\n</span><span class="s1">module.exports = TO_STRING_TAG_SUPPORT ? {}.toString : function toString() {</span><span class="s3">\n  </span><span class="s1">return '[object ' + classof(this) + ']';</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var anObject = require('../internals/an-object');</span><span class="s3">\n</span><span class="s1">var aPossiblePrototype = require('../internals/a-possible-prototype');</span><span class="s3">\n\n</span><span class="s1">// `Object.setPrototypeOf` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.setprototypeof</span><span class="s3">\n</span><span class="s1">// Works with __proto__ only. Old v8 can't work with null proto objects.</span><span class="s3">\n</span><span class="s1">/* eslint-disable no-proto */</span><span class="s3">\n</span><span class="s1">module.exports = Object.setPrototypeOf || ('__proto__' in {} ? function () {</span><span class="s3">\n  </span><span class="s1">var CORRECT_SETTER = false;</span><span class="s3">\n  </span><span class="s1">var test = {};</span><span class="s3">\n  </span><span class="s1">var setter;</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">setter = Object.getOwnPropertyDescriptor(Object.prototype, '__proto__').set;</span><span class="s3">\n    </span><span class="s1">setter.call(test, []);</span><span class="s3">\n    </span><span class="s1">CORRECT_SETTER = test instanceof Array;</span><span class="s3">\n  </span><span class="s1">} catch (error) { /* empty */ }</span><span class="s3">\n  </span><span class="s1">return function setPrototypeOf(O, proto) {</span><span class="s3">\n    </span><span class="s1">anObject(O);</span><span class="s3">\n    </span><span class="s1">aPossiblePrototype(proto);</span><span class="s3">\n    </span><span class="s1">if (CORRECT_SETTER) setter.call(O, proto);</span><span class="s3">\n    </span><span class="s1">else O.__proto__ = proto;</span><span class="s3">\n    </span><span class="s1">return O;</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">}() : undefined);</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var isObject = require('../internals/is-object');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">if (!isObject(it) &amp;&amp; it !== null) {</span><span class="s3">\n    </span><span class="s1">throw TypeError(</span><span class="s3">\&quot;</span><span class="s1">Can't set </span><span class="s3">\&quot; </span><span class="s1">+ String(it) + ' as a prototype');</span><span class="s3">\n  </span><span class="s1">} return it;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var toIndexedObject = require('../internals/to-indexed-object');</span><span class="s3">\n</span><span class="s1">var addToUnscopables = require('../internals/add-to-unscopables');</span><span class="s3">\n</span><span class="s1">var Iterators = require('../internals/iterators');</span><span class="s3">\n</span><span class="s1">var InternalStateModule = require('../internals/internal-state');</span><span class="s3">\n</span><span class="s1">var defineIterator = require('../internals/define-iterator');</span><span class="s3">\n\n</span><span class="s1">var ARRAY_ITERATOR = 'Array Iterator';</span><span class="s3">\n</span><span class="s1">var setInternalState = InternalStateModule.set;</span><span class="s3">\n</span><span class="s1">var getInternalState = InternalStateModule.getterFor(ARRAY_ITERATOR);</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.entries` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.entries</span><span class="s3">\n</span><span class="s1">// `Array.prototype.keys` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.keys</span><span class="s3">\n</span><span class="s1">// `Array.prototype.values` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.values</span><span class="s3">\n</span><span class="s1">// `Array.prototype[@@iterator]` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype-@@iterator</span><span class="s3">\n</span><span class="s1">// `CreateArrayIterator` internal method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-createarrayiterator</span><span class="s3">\n</span><span class="s1">module.exports = defineIterator(Array, 'Array', function (iterated, kind) {</span><span class="s3">\n  </span><span class="s1">setInternalState(this, {</span><span class="s3">\n    </span><span class="s1">type: ARRAY_ITERATOR,</span><span class="s3">\n    </span><span class="s1">target: toIndexedObject(iterated), // target</span><span class="s3">\n    </span><span class="s1">index: 0,                          // next index</span><span class="s3">\n    </span><span class="s1">kind: kind                         // kind</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n</span><span class="s1">// `%ArrayIteratorPrototype%.next` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-%arrayiteratorprototype%.next</span><span class="s3">\n</span><span class="s1">}, function () {</span><span class="s3">\n  </span><span class="s1">var state = getInternalState(this);</span><span class="s3">\n  </span><span class="s1">var target = state.target;</span><span class="s3">\n  </span><span class="s1">var kind = state.kind;</span><span class="s3">\n  </span><span class="s1">var index = state.index++;</span><span class="s3">\n  </span><span class="s1">if (!target || index &gt;= target.length) {</span><span class="s3">\n    </span><span class="s1">state.target = undefined;</span><span class="s3">\n    </span><span class="s1">return { value: undefined, done: true };</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">if (kind == 'keys') return { value: index, done: false };</span><span class="s3">\n  </span><span class="s1">if (kind == 'values') return { value: target[index], done: false };</span><span class="s3">\n  </span><span class="s1">return { value: [index, target[index]], done: false };</span><span class="s3">\n</span><span class="s1">}, 'values');</span><span class="s3">\n\n</span><span class="s1">// argumentsList[@@iterator] is %ArrayProto_values%</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-createunmappedargumentsobject</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-createmappedargumentsobject</span><span class="s3">\n</span><span class="s1">Iterators.Arguments = Iterators.Array;</span><span class="s3">\n\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables</span><span class="s3">\n</span><span class="s1">addToUnscopables('keys');</span><span class="s3">\n</span><span class="s1">addToUnscopables('values');</span><span class="s3">\n</span><span class="s1">addToUnscopables('entries');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;// iterable DOM collections</span><span class="s3">\n</span><span class="s1">// flag - `iterable` interface - 'entries', 'keys', 'values', 'forEach' methods</span><span class="s3">\n</span><span class="s1">module.exports = {</span><span class="s3">\n  </span><span class="s1">CSSRuleList: 0,</span><span class="s3">\n  </span><span class="s1">CSSStyleDeclaration: 0,</span><span class="s3">\n  </span><span class="s1">CSSValueList: 0,</span><span class="s3">\n  </span><span class="s1">ClientRectList: 0,</span><span class="s3">\n  </span><span class="s1">DOMRectList: 0,</span><span class="s3">\n  </span><span class="s1">DOMStringList: 0,</span><span class="s3">\n  </span><span class="s1">DOMTokenList: 1,</span><span class="s3">\n  </span><span class="s1">DataTransferItemList: 0,</span><span class="s3">\n  </span><span class="s1">FileList: 0,</span><span class="s3">\n  </span><span class="s1">HTMLAllCollection: 0,</span><span class="s3">\n  </span><span class="s1">HTMLCollection: 0,</span><span class="s3">\n  </span><span class="s1">HTMLFormElement: 0,</span><span class="s3">\n  </span><span class="s1">HTMLSelectElement: 0,</span><span class="s3">\n  </span><span class="s1">MediaList: 0,</span><span class="s3">\n  </span><span class="s1">MimeTypeArray: 0,</span><span class="s3">\n  </span><span class="s1">NamedNodeMap: 0,</span><span class="s3">\n  </span><span class="s1">NodeList: 1,</span><span class="s3">\n  </span><span class="s1">PaintRequestList: 0,</span><span class="s3">\n  </span><span class="s1">Plugin: 0,</span><span class="s3">\n  </span><span class="s1">PluginArray: 0,</span><span class="s3">\n  </span><span class="s1">SVGLengthList: 0,</span><span class="s3">\n  </span><span class="s1">SVGNumberList: 0,</span><span class="s3">\n  </span><span class="s1">SVGPathSegList: 0,</span><span class="s3">\n  </span><span class="s1">SVGPointList: 0,</span><span class="s3">\n  </span><span class="s1">SVGStringList: 0,</span><span class="s3">\n  </span><span class="s1">SVGTransformList: 0,</span><span class="s3">\n  </span><span class="s1">SourceBufferList: 0,</span><span class="s3">\n  </span><span class="s1">StyleSheetList: 0,</span><span class="s3">\n  </span><span class="s1">TextTrackCueList: 0,</span><span class="s3">\n  </span><span class="s1">TextTrackList: 0,</span><span class="s3">\n  </span><span class="s1">TouchList: 0</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var IS_PURE = require('../internals/is-pure');</span><span class="s3">\n</span><span class="s1">var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var getBuiltIn = require('../internals/get-built-in');</span><span class="s3">\n</span><span class="s1">var NativePromise = require('../internals/native-promise-constructor');</span><span class="s3">\n</span><span class="s1">var redefine = require('../internals/redefine');</span><span class="s3">\n</span><span class="s1">var redefineAll = require('../internals/redefine-all');</span><span class="s3">\n</span><span class="s1">var setToStringTag = require('../internals/set-to-string-tag');</span><span class="s3">\n</span><span class="s1">var setSpecies = require('../internals/set-species');</span><span class="s3">\n</span><span class="s1">var isObject = require('../internals/is-object');</span><span class="s3">\n</span><span class="s1">var aFunction = require('../internals/a-function');</span><span class="s3">\n</span><span class="s1">var anInstance = require('../internals/an-instance');</span><span class="s3">\n</span><span class="s1">var classof = require('../internals/classof-raw');</span><span class="s3">\n</span><span class="s1">var inspectSource = require('../internals/inspect-source');</span><span class="s3">\n</span><span class="s1">var iterate = require('../internals/iterate');</span><span class="s3">\n</span><span class="s1">var checkCorrectnessOfIteration = require('../internals/check-correctness-of-iteration');</span><span class="s3">\n</span><span class="s1">var speciesConstructor = require('../internals/species-constructor');</span><span class="s3">\n</span><span class="s1">var task = require('../internals/task').set;</span><span class="s3">\n</span><span class="s1">var microtask = require('../internals/microtask');</span><span class="s3">\n</span><span class="s1">var promiseResolve = require('../internals/promise-resolve');</span><span class="s3">\n</span><span class="s1">var hostReportErrors = require('../internals/host-report-errors');</span><span class="s3">\n</span><span class="s1">var newPromiseCapabilityModule = require('../internals/new-promise-capability');</span><span class="s3">\n</span><span class="s1">var perform = require('../internals/perform');</span><span class="s3">\n</span><span class="s1">var InternalStateModule = require('../internals/internal-state');</span><span class="s3">\n</span><span class="s1">var isForced = require('../internals/is-forced');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n</span><span class="s1">var V8_VERSION = require('../internals/engine-v8-version');</span><span class="s3">\n\n</span><span class="s1">var SPECIES = wellKnownSymbol('species');</span><span class="s3">\n</span><span class="s1">var PROMISE = 'Promise';</span><span class="s3">\n</span><span class="s1">var getInternalState = InternalStateModule.get;</span><span class="s3">\n</span><span class="s1">var setInternalState = InternalStateModule.set;</span><span class="s3">\n</span><span class="s1">var getInternalPromiseState = InternalStateModule.getterFor(PROMISE);</span><span class="s3">\n</span><span class="s1">var PromiseConstructor = NativePromise;</span><span class="s3">\n</span><span class="s1">var TypeError = global.TypeError;</span><span class="s3">\n</span><span class="s1">var document = global.document;</span><span class="s3">\n</span><span class="s1">var process = global.process;</span><span class="s3">\n</span><span class="s1">var $fetch = getBuiltIn('fetch');</span><span class="s3">\n</span><span class="s1">var newPromiseCapability = newPromiseCapabilityModule.f;</span><span class="s3">\n</span><span class="s1">var newGenericPromiseCapability = newPromiseCapability;</span><span class="s3">\n</span><span class="s1">var IS_NODE = classof(process) == 'process';</span><span class="s3">\n</span><span class="s1">var DISPATCH_EVENT = !!(document &amp;&amp; document.createEvent &amp;&amp; global.dispatchEvent);</span><span class="s3">\n</span><span class="s1">var UNHANDLED_REJECTION = 'unhandledrejection';</span><span class="s3">\n</span><span class="s1">var REJECTION_HANDLED = 'rejectionhandled';</span><span class="s3">\n</span><span class="s1">var PENDING = 0;</span><span class="s3">\n</span><span class="s1">var FULFILLED = 1;</span><span class="s3">\n</span><span class="s1">var REJECTED = 2;</span><span class="s3">\n</span><span class="s1">var HANDLED = 1;</span><span class="s3">\n</span><span class="s1">var UNHANDLED = 2;</span><span class="s3">\n</span><span class="s1">var Internal, OwnPromiseCapability, PromiseWrapper, nativeThen;</span><span class="s3">\n\n</span><span class="s1">var FORCED = isForced(PROMISE, function () {</span><span class="s3">\n  </span><span class="s1">var GLOBAL_CORE_JS_PROMISE = inspectSource(PromiseConstructor) !== String(PromiseConstructor);</span><span class="s3">\n  </span><span class="s1">if (!GLOBAL_CORE_JS_PROMISE) {</span><span class="s3">\n    </span><span class="s1">// V8 6.6 (Node 10 and Chrome 66) have a bug with resolving custom thenables</span><span class="s3">\n    </span><span class="s1">// https://bugs.chromium.org/p/chromium/issues/detail?id=830565</span><span class="s3">\n    </span><span class="s1">// We can't detect it synchronously, so just check versions</span><span class="s3">\n    </span><span class="s1">if (V8_VERSION === 66) return true;</span><span class="s3">\n    </span><span class="s1">// Unhandled rejections tracking support, NodeJS Promise without it fails @@species test</span><span class="s3">\n    </span><span class="s1">if (!IS_NODE &amp;&amp; typeof PromiseRejectionEvent != 'function') return true;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">// We need Promise#finally in the pure version for preventing prototype pollution</span><span class="s3">\n  </span><span class="s1">if (IS_PURE &amp;&amp; !PromiseConstructor.prototype['finally']) return true;</span><span class="s3">\n  </span><span class="s1">// We can't use @@species feature detection in V8 since it causes</span><span class="s3">\n  </span><span class="s1">// deoptimization and performance degradation</span><span class="s3">\n  </span><span class="s1">// https://github.com/zloirock/core-js/issues/679</span><span class="s3">\n  </span><span class="s1">if (V8_VERSION &gt;= 51 &amp;&amp; /native code/.test(PromiseConstructor)) return false;</span><span class="s3">\n  </span><span class="s1">// Detect correctness of subclassing with @@species support</span><span class="s3">\n  </span><span class="s1">var promise = PromiseConstructor.resolve(1);</span><span class="s3">\n  </span><span class="s1">var FakePromise = function (exec) {</span><span class="s3">\n    </span><span class="s1">exec(function () { /* empty */ }, function () { /* empty */ });</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">var constructor = promise.constructor = {};</span><span class="s3">\n  </span><span class="s1">constructor[SPECIES] = FakePromise;</span><span class="s3">\n  </span><span class="s1">return !(promise.then(function () { /* empty */ }) instanceof FakePromise);</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">var INCORRECT_ITERATION = FORCED || !checkCorrectnessOfIteration(function (iterable) {</span><span class="s3">\n  </span><span class="s1">PromiseConstructor.all(iterable)['catch'](function () { /* empty */ });</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">// helpers</span><span class="s3">\n</span><span class="s1">var isThenable = function (it) {</span><span class="s3">\n  </span><span class="s1">var then;</span><span class="s3">\n  </span><span class="s1">return isObject(it) &amp;&amp; typeof (then = it.then) == 'function' ? then : false;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var notify = function (promise, state, isReject) {</span><span class="s3">\n  </span><span class="s1">if (state.notified) return;</span><span class="s3">\n  </span><span class="s1">state.notified = true;</span><span class="s3">\n  </span><span class="s1">var chain = state.reactions;</span><span class="s3">\n  </span><span class="s1">microtask(function () {</span><span class="s3">\n    </span><span class="s1">var value = state.value;</span><span class="s3">\n    </span><span class="s1">var ok = state.state == FULFILLED;</span><span class="s3">\n    </span><span class="s1">var index = 0;</span><span class="s3">\n    </span><span class="s1">// variable length - can't use forEach</span><span class="s3">\n    </span><span class="s1">while (chain.length &gt; index) {</span><span class="s3">\n      </span><span class="s1">var reaction = chain[index++];</span><span class="s3">\n      </span><span class="s1">var handler = ok ? reaction.ok : reaction.fail;</span><span class="s3">\n      </span><span class="s1">var resolve = reaction.resolve;</span><span class="s3">\n      </span><span class="s1">var reject = reaction.reject;</span><span class="s3">\n      </span><span class="s1">var domain = reaction.domain;</span><span class="s3">\n      </span><span class="s1">var result, then, exited;</span><span class="s3">\n      </span><span class="s1">try {</span><span class="s3">\n        </span><span class="s1">if (handler) {</span><span class="s3">\n          </span><span class="s1">if (!ok) {</span><span class="s3">\n            </span><span class="s1">if (state.rejection === UNHANDLED) onHandleUnhandled(promise, state);</span><span class="s3">\n            </span><span class="s1">state.rejection = HANDLED;</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">if (handler === true) result = value;</span><span class="s3">\n          </span><span class="s1">else {</span><span class="s3">\n            </span><span class="s1">if (domain) domain.enter();</span><span class="s3">\n            </span><span class="s1">result = handler(value); // can throw</span><span class="s3">\n            </span><span class="s1">if (domain) {</span><span class="s3">\n              </span><span class="s1">domain.exit();</span><span class="s3">\n              </span><span class="s1">exited = true;</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">if (result === reaction.promise) {</span><span class="s3">\n            </span><span class="s1">reject(TypeError('Promise-chain cycle'));</span><span class="s3">\n          </span><span class="s1">} else if (then = isThenable(result)) {</span><span class="s3">\n            </span><span class="s1">then.call(result, resolve, reject);</span><span class="s3">\n          </span><span class="s1">} else resolve(result);</span><span class="s3">\n        </span><span class="s1">} else reject(value);</span><span class="s3">\n      </span><span class="s1">} catch (error) {</span><span class="s3">\n        </span><span class="s1">if (domain &amp;&amp; !exited) domain.exit();</span><span class="s3">\n        </span><span class="s1">reject(error);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">state.reactions = [];</span><span class="s3">\n    </span><span class="s1">state.notified = false;</span><span class="s3">\n    </span><span class="s1">if (isReject &amp;&amp; !state.rejection) onUnhandled(promise, state);</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var dispatchEvent = function (name, promise, reason) {</span><span class="s3">\n  </span><span class="s1">var event, handler;</span><span class="s3">\n  </span><span class="s1">if (DISPATCH_EVENT) {</span><span class="s3">\n    </span><span class="s1">event = document.createEvent('Event');</span><span class="s3">\n    </span><span class="s1">event.promise = promise;</span><span class="s3">\n    </span><span class="s1">event.reason = reason;</span><span class="s3">\n    </span><span class="s1">event.initEvent(name, false, true);</span><span class="s3">\n    </span><span class="s1">global.dispatchEvent(event);</span><span class="s3">\n  </span><span class="s1">} else event = { promise: promise, reason: reason };</span><span class="s3">\n  </span><span class="s1">if (handler = global['on' + name]) handler(event);</span><span class="s3">\n  </span><span class="s1">else if (name === UNHANDLED_REJECTION) hostReportErrors('Unhandled promise rejection', reason);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var onUnhandled = function (promise, state) {</span><span class="s3">\n  </span><span class="s1">task.call(global, function () {</span><span class="s3">\n    </span><span class="s1">var value = state.value;</span><span class="s3">\n    </span><span class="s1">var IS_UNHANDLED = isUnhandled(state);</span><span class="s3">\n    </span><span class="s1">var result;</span><span class="s3">\n    </span><span class="s1">if (IS_UNHANDLED) {</span><span class="s3">\n      </span><span class="s1">result = perform(function () {</span><span class="s3">\n        </span><span class="s1">if (IS_NODE) {</span><span class="s3">\n          </span><span class="s1">process.emit('unhandledRejection', value, promise);</span><span class="s3">\n        </span><span class="s1">} else dispatchEvent(UNHANDLED_REJECTION, promise, value);</span><span class="s3">\n      </span><span class="s1">});</span><span class="s3">\n      </span><span class="s1">// Browsers should not trigger `rejectionHandled` event if it was handled here, NodeJS - should</span><span class="s3">\n      </span><span class="s1">state.rejection = IS_NODE || isUnhandled(state) ? UNHANDLED : HANDLED;</span><span class="s3">\n      </span><span class="s1">if (result.error) throw result.value;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var isUnhandled = function (state) {</span><span class="s3">\n  </span><span class="s1">return state.rejection !== HANDLED &amp;&amp; !state.parent;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var onHandleUnhandled = function (promise, state) {</span><span class="s3">\n  </span><span class="s1">task.call(global, function () {</span><span class="s3">\n    </span><span class="s1">if (IS_NODE) {</span><span class="s3">\n      </span><span class="s1">process.emit('rejectionHandled', promise);</span><span class="s3">\n    </span><span class="s1">} else dispatchEvent(REJECTION_HANDLED, promise, state.value);</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var bind = function (fn, promise, state, unwrap) {</span><span class="s3">\n  </span><span class="s1">return function (value) {</span><span class="s3">\n    </span><span class="s1">fn(promise, state, value, unwrap);</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var internalReject = function (promise, state, value, unwrap) {</span><span class="s3">\n  </span><span class="s1">if (state.done) return;</span><span class="s3">\n  </span><span class="s1">state.done = true;</span><span class="s3">\n  </span><span class="s1">if (unwrap) state = unwrap;</span><span class="s3">\n  </span><span class="s1">state.value = value;</span><span class="s3">\n  </span><span class="s1">state.state = REJECTED;</span><span class="s3">\n  </span><span class="s1">notify(promise, state, true);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var internalResolve = function (promise, state, value, unwrap) {</span><span class="s3">\n  </span><span class="s1">if (state.done) return;</span><span class="s3">\n  </span><span class="s1">state.done = true;</span><span class="s3">\n  </span><span class="s1">if (unwrap) state = unwrap;</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">if (promise === value) throw TypeError(</span><span class="s3">\&quot;</span><span class="s1">Promise can't be resolved itself</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n    </span><span class="s1">var then = isThenable(value);</span><span class="s3">\n    </span><span class="s1">if (then) {</span><span class="s3">\n      </span><span class="s1">microtask(function () {</span><span class="s3">\n        </span><span class="s1">var wrapper = { done: false };</span><span class="s3">\n        </span><span class="s1">try {</span><span class="s3">\n          </span><span class="s1">then.call(value,</span><span class="s3">\n            </span><span class="s1">bind(internalResolve, promise, wrapper, state),</span><span class="s3">\n            </span><span class="s1">bind(internalReject, promise, wrapper, state)</span><span class="s3">\n          </span><span class="s1">);</span><span class="s3">\n        </span><span class="s1">} catch (error) {</span><span class="s3">\n          </span><span class="s1">internalReject(promise, wrapper, error, state);</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">});</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">state.value = value;</span><span class="s3">\n      </span><span class="s1">state.state = FULFILLED;</span><span class="s3">\n      </span><span class="s1">notify(promise, state, false);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">} catch (error) {</span><span class="s3">\n    </span><span class="s1">internalReject(promise, { done: false }, error, state);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">// constructor polyfill</span><span class="s3">\n</span><span class="s1">if (FORCED) {</span><span class="s3">\n  </span><span class="s1">// 25.4.3.1 Promise(executor)</span><span class="s3">\n  </span><span class="s1">PromiseConstructor = function Promise(executor) {</span><span class="s3">\n    </span><span class="s1">anInstance(this, PromiseConstructor, PROMISE);</span><span class="s3">\n    </span><span class="s1">aFunction(executor);</span><span class="s3">\n    </span><span class="s1">Internal.call(this);</span><span class="s3">\n    </span><span class="s1">var state = getInternalState(this);</span><span class="s3">\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">executor(bind(internalResolve, this, state), bind(internalReject, this, state));</span><span class="s3">\n    </span><span class="s1">} catch (error) {</span><span class="s3">\n      </span><span class="s1">internalReject(this, state, error);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">// eslint-disable-next-line no-unused-vars</span><span class="s3">\n  </span><span class="s1">Internal = function Promise(executor) {</span><span class="s3">\n    </span><span class="s1">setInternalState(this, {</span><span class="s3">\n      </span><span class="s1">type: PROMISE,</span><span class="s3">\n      </span><span class="s1">done: false,</span><span class="s3">\n      </span><span class="s1">notified: false,</span><span class="s3">\n      </span><span class="s1">parent: false,</span><span class="s3">\n      </span><span class="s1">reactions: [],</span><span class="s3">\n      </span><span class="s1">rejection: false,</span><span class="s3">\n      </span><span class="s1">state: PENDING,</span><span class="s3">\n      </span><span class="s1">value: undefined</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">Internal.prototype = redefineAll(PromiseConstructor.prototype, {</span><span class="s3">\n    </span><span class="s1">// `Promise.prototype.then` method</span><span class="s3">\n    </span><span class="s1">// https://tc39.github.io/ecma262/#sec-promise.prototype.then</span><span class="s3">\n    </span><span class="s1">then: function then(onFulfilled, onRejected) {</span><span class="s3">\n      </span><span class="s1">var state = getInternalPromiseState(this);</span><span class="s3">\n      </span><span class="s1">var reaction = newPromiseCapability(speciesConstructor(this, PromiseConstructor));</span><span class="s3">\n      </span><span class="s1">reaction.ok = typeof onFulfilled == 'function' ? onFulfilled : true;</span><span class="s3">\n      </span><span class="s1">reaction.fail = typeof onRejected == 'function' &amp;&amp; onRejected;</span><span class="s3">\n      </span><span class="s1">reaction.domain = IS_NODE ? process.domain : undefined;</span><span class="s3">\n      </span><span class="s1">state.parent = true;</span><span class="s3">\n      </span><span class="s1">state.reactions.push(reaction);</span><span class="s3">\n      </span><span class="s1">if (state.state != PENDING) notify(this, state, false);</span><span class="s3">\n      </span><span class="s1">return reaction.promise;</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">// `Promise.prototype.catch` method</span><span class="s3">\n    </span><span class="s1">// https://tc39.github.io/ecma262/#sec-promise.prototype.catch</span><span class="s3">\n    </span><span class="s1">'catch': function (onRejected) {</span><span class="s3">\n      </span><span class="s1">return this.then(undefined, onRejected);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n  </span><span class="s1">OwnPromiseCapability = function () {</span><span class="s3">\n    </span><span class="s1">var promise = new Internal();</span><span class="s3">\n    </span><span class="s1">var state = getInternalState(promise);</span><span class="s3">\n    </span><span class="s1">this.promise = promise;</span><span class="s3">\n    </span><span class="s1">this.resolve = bind(internalResolve, promise, state);</span><span class="s3">\n    </span><span class="s1">this.reject = bind(internalReject, promise, state);</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">newPromiseCapabilityModule.f = newPromiseCapability = function (C) {</span><span class="s3">\n    </span><span class="s1">return C === PromiseConstructor || C === PromiseWrapper</span><span class="s3">\n      </span><span class="s1">? new OwnPromiseCapability(C)</span><span class="s3">\n      </span><span class="s1">: newGenericPromiseCapability(C);</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n\n  </span><span class="s1">if (!IS_PURE &amp;&amp; typeof NativePromise == 'function') {</span><span class="s3">\n    </span><span class="s1">nativeThen = NativePromise.prototype.then;</span><span class="s3">\n\n    </span><span class="s1">// wrap native Promise#then for native async functions</span><span class="s3">\n    </span><span class="s1">redefine(NativePromise.prototype, 'then', function then(onFulfilled, onRejected) {</span><span class="s3">\n      </span><span class="s1">var that = this;</span><span class="s3">\n      </span><span class="s1">return new PromiseConstructor(function (resolve, reject) {</span><span class="s3">\n        </span><span class="s1">nativeThen.call(that, resolve, reject);</span><span class="s3">\n      </span><span class="s1">}).then(onFulfilled, onRejected);</span><span class="s3">\n    </span><span class="s1">// https://github.com/zloirock/core-js/issues/640</span><span class="s3">\n    </span><span class="s1">}, { unsafe: true });</span><span class="s3">\n\n    </span><span class="s1">// wrap fetch result</span><span class="s3">\n    </span><span class="s1">if (typeof $fetch == 'function') $({ global: true, enumerable: true, forced: true }, {</span><span class="s3">\n      </span><span class="s1">// eslint-disable-next-line no-unused-vars</span><span class="s3">\n      </span><span class="s1">fetch: function fetch(input /* , init */) {</span><span class="s3">\n        </span><span class="s1">return promiseResolve(PromiseConstructor, $fetch.apply(global, arguments));</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">$({ global: true, wrap: true, forced: FORCED }, {</span><span class="s3">\n  </span><span class="s1">Promise: PromiseConstructor</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">setToStringTag(PromiseConstructor, PROMISE, false, true);</span><span class="s3">\n</span><span class="s1">setSpecies(PROMISE);</span><span class="s3">\n\n</span><span class="s1">PromiseWrapper = getBuiltIn(PROMISE);</span><span class="s3">\n\n</span><span class="s1">// statics</span><span class="s3">\n</span><span class="s1">$({ target: PROMISE, stat: true, forced: FORCED }, {</span><span class="s3">\n  </span><span class="s1">// `Promise.reject` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-promise.reject</span><span class="s3">\n  </span><span class="s1">reject: function reject(r) {</span><span class="s3">\n    </span><span class="s1">var capability = newPromiseCapability(this);</span><span class="s3">\n    </span><span class="s1">capability.reject.call(undefined, r);</span><span class="s3">\n    </span><span class="s1">return capability.promise;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">$({ target: PROMISE, stat: true, forced: IS_PURE || FORCED }, {</span><span class="s3">\n  </span><span class="s1">// `Promise.resolve` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-promise.resolve</span><span class="s3">\n  </span><span class="s1">resolve: function resolve(x) {</span><span class="s3">\n    </span><span class="s1">return promiseResolve(IS_PURE &amp;&amp; this === PromiseWrapper ? PromiseConstructor : this, x);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">$({ target: PROMISE, stat: true, forced: INCORRECT_ITERATION }, {</span><span class="s3">\n  </span><span class="s1">// `Promise.all` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-promise.all</span><span class="s3">\n  </span><span class="s1">all: function all(iterable) {</span><span class="s3">\n    </span><span class="s1">var C = this;</span><span class="s3">\n    </span><span class="s1">var capability = newPromiseCapability(C);</span><span class="s3">\n    </span><span class="s1">var resolve = capability.resolve;</span><span class="s3">\n    </span><span class="s1">var reject = capability.reject;</span><span class="s3">\n    </span><span class="s1">var result = perform(function () {</span><span class="s3">\n      </span><span class="s1">var $promiseResolve = aFunction(C.resolve);</span><span class="s3">\n      </span><span class="s1">var values = [];</span><span class="s3">\n      </span><span class="s1">var counter = 0;</span><span class="s3">\n      </span><span class="s1">var remaining = 1;</span><span class="s3">\n      </span><span class="s1">iterate(iterable, function (promise) {</span><span class="s3">\n        </span><span class="s1">var index = counter++;</span><span class="s3">\n        </span><span class="s1">var alreadyCalled = false;</span><span class="s3">\n        </span><span class="s1">values.push(undefined);</span><span class="s3">\n        </span><span class="s1">remaining++;</span><span class="s3">\n        </span><span class="s1">$promiseResolve.call(C, promise).then(function (value) {</span><span class="s3">\n          </span><span class="s1">if (alreadyCalled) return;</span><span class="s3">\n          </span><span class="s1">alreadyCalled = true;</span><span class="s3">\n          </span><span class="s1">values[index] = value;</span><span class="s3">\n          </span><span class="s1">--remaining || resolve(values);</span><span class="s3">\n        </span><span class="s1">}, reject);</span><span class="s3">\n      </span><span class="s1">});</span><span class="s3">\n      </span><span class="s1">--remaining || resolve(values);</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n    </span><span class="s1">if (result.error) reject(result.value);</span><span class="s3">\n    </span><span class="s1">return capability.promise;</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n  </span><span class="s1">// `Promise.race` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-promise.race</span><span class="s3">\n  </span><span class="s1">race: function race(iterable) {</span><span class="s3">\n    </span><span class="s1">var C = this;</span><span class="s3">\n    </span><span class="s1">var capability = newPromiseCapability(C);</span><span class="s3">\n    </span><span class="s1">var reject = capability.reject;</span><span class="s3">\n    </span><span class="s1">var result = perform(function () {</span><span class="s3">\n      </span><span class="s1">var $promiseResolve = aFunction(C.resolve);</span><span class="s3">\n      </span><span class="s1">iterate(iterable, function (promise) {</span><span class="s3">\n        </span><span class="s1">$promiseResolve.call(C, promise).then(capability.resolve, reject);</span><span class="s3">\n      </span><span class="s1">});</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n    </span><span class="s1">if (result.error) reject(result.value);</span><span class="s3">\n    </span><span class="s1">return capability.promise;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;</span><span class="s3">\n</span><span class="s1">var classof = require('../internals/classof-raw');</span><span class="s3">\n</span><span class="s1">var macrotask = require('../internals/task').set;</span><span class="s3">\n</span><span class="s1">var IS_IOS = require('../internals/engine-is-ios');</span><span class="s3">\n\n</span><span class="s1">var MutationObserver = global.MutationObserver || global.WebKitMutationObserver;</span><span class="s3">\n</span><span class="s1">var process = global.process;</span><span class="s3">\n</span><span class="s1">var Promise = global.Promise;</span><span class="s3">\n</span><span class="s1">var IS_NODE = classof(process) == 'process';</span><span class="s3">\n</span><span class="s1">// Node.js 11 shows ExperimentalWarning on getting `queueMicrotask`</span><span class="s3">\n</span><span class="s1">var queueMicrotaskDescriptor = getOwnPropertyDescriptor(global, 'queueMicrotask');</span><span class="s3">\n</span><span class="s1">var queueMicrotask = queueMicrotaskDescriptor &amp;&amp; queueMicrotaskDescriptor.value;</span><span class="s3">\n\n</span><span class="s1">var flush, head, last, notify, toggle, node, promise, then;</span><span class="s3">\n\n</span><span class="s1">// modern engines have queueMicrotask method</span><span class="s3">\n</span><span class="s1">if (!queueMicrotask) {</span><span class="s3">\n  </span><span class="s1">flush = function () {</span><span class="s3">\n    </span><span class="s1">var parent, fn;</span><span class="s3">\n    </span><span class="s1">if (IS_NODE &amp;&amp; (parent = process.domain)) parent.exit();</span><span class="s3">\n    </span><span class="s1">while (head) {</span><span class="s3">\n      </span><span class="s1">fn = head.fn;</span><span class="s3">\n      </span><span class="s1">head = head.next;</span><span class="s3">\n      </span><span class="s1">try {</span><span class="s3">\n        </span><span class="s1">fn();</span><span class="s3">\n      </span><span class="s1">} catch (error) {</span><span class="s3">\n        </span><span class="s1">if (head) notify();</span><span class="s3">\n        </span><span class="s1">else last = undefined;</span><span class="s3">\n        </span><span class="s1">throw error;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">} last = undefined;</span><span class="s3">\n    </span><span class="s1">if (parent) parent.enter();</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n\n  </span><span class="s1">// Node.js</span><span class="s3">\n  </span><span class="s1">if (IS_NODE) {</span><span class="s3">\n    </span><span class="s1">notify = function () {</span><span class="s3">\n      </span><span class="s1">process.nextTick(flush);</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">// browsers with MutationObserver, except iOS - https://github.com/zloirock/core-js/issues/339</span><span class="s3">\n  </span><span class="s1">} else if (MutationObserver &amp;&amp; !IS_IOS) {</span><span class="s3">\n    </span><span class="s1">toggle = true;</span><span class="s3">\n    </span><span class="s1">node = document.createTextNode('');</span><span class="s3">\n    </span><span class="s1">new MutationObserver(flush).observe(node, { characterData: true });</span><span class="s3">\n    </span><span class="s1">notify = function () {</span><span class="s3">\n      </span><span class="s1">node.data = toggle = !toggle;</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">// environments with maybe non-completely correct, but existent Promise</span><span class="s3">\n  </span><span class="s1">} else if (Promise &amp;&amp; Promise.resolve) {</span><span class="s3">\n    </span><span class="s1">// Promise.resolve without an argument throws an error in LG WebOS 2</span><span class="s3">\n    </span><span class="s1">promise = Promise.resolve(undefined);</span><span class="s3">\n    </span><span class="s1">then = promise.then;</span><span class="s3">\n    </span><span class="s1">notify = function () {</span><span class="s3">\n      </span><span class="s1">then.call(promise, flush);</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">// for other environments - macrotask based on:</span><span class="s3">\n  </span><span class="s1">// - setImmediate</span><span class="s3">\n  </span><span class="s1">// - MessageChannel</span><span class="s3">\n  </span><span class="s1">// - window.postMessag</span><span class="s3">\n  </span><span class="s1">// - onreadystatechange</span><span class="s3">\n  </span><span class="s1">// - setTimeout</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">notify = function () {</span><span class="s3">\n      </span><span class="s1">// strange IE + webpack dev server bug - use .call(global)</span><span class="s3">\n      </span><span class="s1">macrotask.call(global, flush);</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">module.exports = queueMicrotask || function (fn) {</span><span class="s3">\n  </span><span class="s1">var task = { fn: fn, next: undefined };</span><span class="s3">\n  </span><span class="s1">if (last) last.next = task;</span><span class="s3">\n  </span><span class="s1">if (!head) {</span><span class="s3">\n    </span><span class="s1">head = task;</span><span class="s3">\n    </span><span class="s1">notify();</span><span class="s3">\n  </span><span class="s1">} last = task;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var global = require('../internals/global');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (a, b) {</span><span class="s3">\n  </span><span class="s1">var console = global.console;</span><span class="s3">\n  </span><span class="s1">if (console &amp;&amp; console.error) {</span><span class="s3">\n    </span><span class="s1">arguments.length === 1 ? console.error(a) : console.error(a, b);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var aFunction = require('../internals/a-function');</span><span class="s3">\n</span><span class="s1">var newPromiseCapabilityModule = require('../internals/new-promise-capability');</span><span class="s3">\n</span><span class="s1">var perform = require('../internals/perform');</span><span class="s3">\n</span><span class="s1">var iterate = require('../internals/iterate');</span><span class="s3">\n\n</span><span class="s1">// `Promise.allSettled` method</span><span class="s3">\n</span><span class="s1">// https://github.com/tc39/proposal-promise-allSettled</span><span class="s3">\n</span><span class="s1">$({ target: 'Promise', stat: true }, {</span><span class="s3">\n  </span><span class="s1">allSettled: function allSettled(iterable) {</span><span class="s3">\n    </span><span class="s1">var C = this;</span><span class="s3">\n    </span><span class="s1">var capability = newPromiseCapabilityModule.f(C);</span><span class="s3">\n    </span><span class="s1">var resolve = capability.resolve;</span><span class="s3">\n    </span><span class="s1">var reject = capability.reject;</span><span class="s3">\n    </span><span class="s1">var result = perform(function () {</span><span class="s3">\n      </span><span class="s1">var promiseResolve = aFunction(C.resolve);</span><span class="s3">\n      </span><span class="s1">var values = [];</span><span class="s3">\n      </span><span class="s1">var counter = 0;</span><span class="s3">\n      </span><span class="s1">var remaining = 1;</span><span class="s3">\n      </span><span class="s1">iterate(iterable, function (promise) {</span><span class="s3">\n        </span><span class="s1">var index = counter++;</span><span class="s3">\n        </span><span class="s1">var alreadyCalled = false;</span><span class="s3">\n        </span><span class="s1">values.push(undefined);</span><span class="s3">\n        </span><span class="s1">remaining++;</span><span class="s3">\n        </span><span class="s1">promiseResolve.call(C, promise).then(function (value) {</span><span class="s3">\n          </span><span class="s1">if (alreadyCalled) return;</span><span class="s3">\n          </span><span class="s1">alreadyCalled = true;</span><span class="s3">\n          </span><span class="s1">values[index] = { status: 'fulfilled', value: value };</span><span class="s3">\n          </span><span class="s1">--remaining || resolve(values);</span><span class="s3">\n        </span><span class="s1">}, function (e) {</span><span class="s3">\n          </span><span class="s1">if (alreadyCalled) return;</span><span class="s3">\n          </span><span class="s1">alreadyCalled = true;</span><span class="s3">\n          </span><span class="s1">values[index] = { status: 'rejected', reason: e };</span><span class="s3">\n          </span><span class="s1">--remaining || resolve(values);</span><span class="s3">\n        </span><span class="s1">});</span><span class="s3">\n      </span><span class="s1">});</span><span class="s3">\n      </span><span class="s1">--remaining || resolve(values);</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n    </span><span class="s1">if (result.error) reject(result.value);</span><span class="s3">\n    </span><span class="s1">return capability.promise;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var IS_PURE = require('../internals/is-pure');</span><span class="s3">\n</span><span class="s1">var NativePromise = require('../internals/native-promise-constructor');</span><span class="s3">\n</span><span class="s1">var fails = require('../internals/fails');</span><span class="s3">\n</span><span class="s1">var getBuiltIn = require('../internals/get-built-in');</span><span class="s3">\n</span><span class="s1">var speciesConstructor = require('../internals/species-constructor');</span><span class="s3">\n</span><span class="s1">var promiseResolve = require('../internals/promise-resolve');</span><span class="s3">\n</span><span class="s1">var redefine = require('../internals/redefine');</span><span class="s3">\n\n</span><span class="s1">// Safari bug https://bugs.webkit.org/show_bug.cgi?id=200829</span><span class="s3">\n</span><span class="s1">var NON_GENERIC = !!NativePromise &amp;&amp; fails(function () {</span><span class="s3">\n  </span><span class="s1">NativePromise.prototype['finally'].call({ then: function () { /* empty */ } }, function () { /* empty */ });</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">// `Promise.prototype.finally` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-promise.prototype.finally</span><span class="s3">\n</span><span class="s1">$({ target: 'Promise', proto: true, real: true, forced: NON_GENERIC }, {</span><span class="s3">\n  </span><span class="s1">'finally': function (onFinally) {</span><span class="s3">\n    </span><span class="s1">var C = speciesConstructor(this, getBuiltIn('Promise'));</span><span class="s3">\n    </span><span class="s1">var isFunction = typeof onFinally == 'function';</span><span class="s3">\n    </span><span class="s1">return this.then(</span><span class="s3">\n      </span><span class="s1">isFunction ? function (x) {</span><span class="s3">\n        </span><span class="s1">return promiseResolve(C, onFinally()).then(function () { return x; });</span><span class="s3">\n      </span><span class="s1">} : onFinally,</span><span class="s3">\n      </span><span class="s1">isFunction ? function (e) {</span><span class="s3">\n        </span><span class="s1">return promiseResolve(C, onFinally()).then(function () { throw e; });</span><span class="s3">\n      </span><span class="s1">} : onFinally</span><span class="s3">\n    </span><span class="s1">);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">// patch native Promise.prototype for native async functions</span><span class="s3">\n</span><span class="s1">if (!IS_PURE &amp;&amp; typeof NativePromise == 'function' &amp;&amp; !NativePromise.prototype['finally']) {</span><span class="s3">\n  </span><span class="s1">redefine(NativePromise.prototype, 'finally', getBuiltIn('Promise').prototype['finally']);</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/web.dom-collections.iterator');</span><span class="s3">\n</span><span class="s1">var forEach = require('../array/virtual/for-each');</span><span class="s3">\n</span><span class="s1">var classof = require('../../internals/classof');</span><span class="s3">\n</span><span class="s1">var ArrayPrototype = Array.prototype;</span><span class="s3">\n\n</span><span class="s1">var DOMIterables = {</span><span class="s3">\n  </span><span class="s1">DOMTokenList: true,</span><span class="s3">\n  </span><span class="s1">NodeList: true</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">var own = it.forEach;</span><span class="s3">\n  </span><span class="s1">return it === ArrayPrototype || (it instanceof Array &amp;&amp; own === ArrayPrototype.forEach)</span><span class="s3">\n    </span><span class="s1">// eslint-disable-next-line no-prototype-builtins</span><span class="s3">\n    </span><span class="s1">|| DOMIterables.hasOwnProperty(classof(it)) ? forEach : own;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../../es/array/virtual/for-each');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../../modules/es.array.for-each');</span><span class="s3">\n</span><span class="s1">var entryVirtual = require('../../../internals/entry-virtual');</span><span class="s3">\n\n</span><span class="s1">module.exports = entryVirtual('Array').forEach;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var forEach = require('../internals/array-for-each');</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.forEach` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.foreach</span><span class="s3">\n</span><span class="s1">$({ target: 'Array', proto: true, forced: [].forEach != forEach }, {</span><span class="s3">\n  </span><span class="s1">forEach: forEach</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $forEach = require('../internals/array-iteration').forEach;</span><span class="s3">\n</span><span class="s1">var arrayMethodIsStrict = require('../internals/array-method-is-strict');</span><span class="s3">\n</span><span class="s1">var arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');</span><span class="s3">\n\n</span><span class="s1">var STRICT_METHOD = arrayMethodIsStrict('forEach');</span><span class="s3">\n</span><span class="s1">var USES_TO_LENGTH = arrayMethodUsesToLength('forEach');</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.forEach` method implementation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.foreach</span><span class="s3">\n</span><span class="s1">module.exports = (!STRICT_METHOD || !USES_TO_LENGTH) ? function forEach(callbackfn /* , thisArg */) {</span><span class="s3">\n  </span><span class="s1">return $forEach(this, callbackfn, arguments.length &gt; 1 ? arguments[1] : undefined);</span><span class="s3">\n</span><span class="s1">} : [].forEach;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/array/is-array');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.array.is-array');</span><span class="s3">\n</span><span class="s1">var path = require('../../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.Array.isArray;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var isArray = require('../internals/is-array');</span><span class="s3">\n\n</span><span class="s1">// `Array.isArray` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.isarray</span><span class="s3">\n</span><span class="s1">$({ target: 'Array', stat: true }, {</span><span class="s3">\n  </span><span class="s1">isArray: isArray</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/instance/map');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var map = require('../array/virtual/map');</span><span class="s3">\n\n</span><span class="s1">var ArrayPrototype = Array.prototype;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">var own = it.map;</span><span class="s3">\n  </span><span class="s1">return it === ArrayPrototype || (it instanceof Array &amp;&amp; own === ArrayPrototype.map) ? map : own;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../../modules/es.array.map');</span><span class="s3">\n</span><span class="s1">var entryVirtual = require('../../../internals/entry-virtual');</span><span class="s3">\n\n</span><span class="s1">module.exports = entryVirtual('Array').map;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var $map = require('../internals/array-iteration').map;</span><span class="s3">\n</span><span class="s1">var arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');</span><span class="s3">\n</span><span class="s1">var arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');</span><span class="s3">\n\n</span><span class="s1">var HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('map');</span><span class="s3">\n</span><span class="s1">// FF49- issue</span><span class="s3">\n</span><span class="s1">var USES_TO_LENGTH = arrayMethodUsesToLength('map');</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.map` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.map</span><span class="s3">\n</span><span class="s1">// with adding support of @@species</span><span class="s3">\n</span><span class="s1">$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {</span><span class="s3">\n  </span><span class="s1">map: function map(callbackfn /* , thisArg */) {</span><span class="s3">\n    </span><span class="s1">return $map(this, callbackfn, arguments.length &gt; 1 ? arguments[1] : undefined);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/instance/trim');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var trim = require('../string/virtual/trim');</span><span class="s3">\n\n</span><span class="s1">var StringPrototype = String.prototype;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">var own = it.trim;</span><span class="s3">\n  </span><span class="s1">return typeof it === 'string' || it === StringPrototype</span><span class="s3">\n    </span><span class="s1">|| (it instanceof String &amp;&amp; own === StringPrototype.trim) ? trim : own;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../../modules/es.string.trim');</span><span class="s3">\n</span><span class="s1">var entryVirtual = require('../../../internals/entry-virtual');</span><span class="s3">\n\n</span><span class="s1">module.exports = entryVirtual('String').trim;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var $trim = require('../internals/string-trim').trim;</span><span class="s3">\n</span><span class="s1">var forcedStringTrimMethod = require('../internals/string-trim-forced');</span><span class="s3">\n\n</span><span class="s1">// `String.prototype.trim` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-string.prototype.trim</span><span class="s3">\n</span><span class="s1">$({ target: 'String', proto: true, forced: forcedStringTrimMethod('trim') }, {</span><span class="s3">\n  </span><span class="s1">trim: function trim() {</span><span class="s3">\n    </span><span class="s1">return $trim(this);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var fails = require('../internals/fails');</span><span class="s3">\n</span><span class="s1">var whitespaces = require('../internals/whitespaces');</span><span class="s3">\n\n</span><span class="s1">var non = '</span><span class="s3">\\</span><span class="s1">u200B</span><span class="s3">\\</span><span class="s1">u0085</span><span class="s3">\\</span><span class="s1">u180E';</span><span class="s3">\n\n</span><span class="s1">// check that a method works with the correct list</span><span class="s3">\n</span><span class="s1">// of whitespaces and has a correct name</span><span class="s3">\n</span><span class="s1">module.exports = function (METHOD_NAME) {</span><span class="s3">\n  </span><span class="s1">return fails(function () {</span><span class="s3">\n    </span><span class="s1">return !!whitespaces[METHOD_NAME]() || non[METHOD_NAME]() != non || whitespaces[METHOD_NAME].name !== METHOD_NAME;</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/map');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.map');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.object.to-string');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.string.iterator');</span><span class="s3">\n</span><span class="s1">require('../../modules/web.dom-collections.iterator');</span><span class="s3">\n</span><span class="s1">var path = require('../../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.Map;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var collection = require('../internals/collection');</span><span class="s3">\n</span><span class="s1">var collectionStrong = require('../internals/collection-strong');</span><span class="s3">\n\n</span><span class="s1">// `Map` constructor</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-map-objects</span><span class="s3">\n</span><span class="s1">module.exports = collection('Map', function (init) {</span><span class="s3">\n  </span><span class="s1">return function Map() { return init(this, arguments.length ? arguments[0] : undefined); };</span><span class="s3">\n</span><span class="s1">}, collectionStrong);</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var fails = require('../internals/fails');</span><span class="s3">\n\n</span><span class="s1">module.exports = !fails(function () {</span><span class="s3">\n  </span><span class="s1">return Object.isExtensible(Object.preventExtensions({}));</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/instance/index-of');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var indexOf = require('../array/virtual/index-of');</span><span class="s3">\n\n</span><span class="s1">var ArrayPrototype = Array.prototype;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">var own = it.indexOf;</span><span class="s3">\n  </span><span class="s1">return it === ArrayPrototype || (it instanceof Array &amp;&amp; own === ArrayPrototype.indexOf) ? indexOf : own;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../../modules/es.array.index-of');</span><span class="s3">\n</span><span class="s1">var entryVirtual = require('../../../internals/entry-virtual');</span><span class="s3">\n\n</span><span class="s1">module.exports = entryVirtual('Array').indexOf;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var $indexOf = require('../internals/array-includes').indexOf;</span><span class="s3">\n</span><span class="s1">var arrayMethodIsStrict = require('../internals/array-method-is-strict');</span><span class="s3">\n</span><span class="s1">var arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');</span><span class="s3">\n\n</span><span class="s1">var nativeIndexOf = [].indexOf;</span><span class="s3">\n\n</span><span class="s1">var NEGATIVE_ZERO = !!nativeIndexOf &amp;&amp; 1 / [1].indexOf(1, -0) &lt; 0;</span><span class="s3">\n</span><span class="s1">var STRICT_METHOD = arrayMethodIsStrict('indexOf');</span><span class="s3">\n</span><span class="s1">var USES_TO_LENGTH = arrayMethodUsesToLength('indexOf', { ACCESSORS: true, 1: 0 });</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.indexOf` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.indexof</span><span class="s3">\n</span><span class="s1">$({ target: 'Array', proto: true, forced: NEGATIVE_ZERO || !STRICT_METHOD || !USES_TO_LENGTH }, {</span><span class="s3">\n  </span><span class="s1">indexOf: function indexOf(searchElement /* , fromIndex = 0 */) {</span><span class="s3">\n    </span><span class="s1">return NEGATIVE_ZERO</span><span class="s3">\n      </span><span class="s1">// convert -0 to +0</span><span class="s3">\n      </span><span class="s1">? nativeIndexOf.apply(this, arguments) || 0</span><span class="s3">\n      </span><span class="s1">: $indexOf(this, searchElement, arguments.length &gt; 1 ? arguments[1] : undefined);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/instance/splice');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var splice = require('../array/virtual/splice');</span><span class="s3">\n\n</span><span class="s1">var ArrayPrototype = Array.prototype;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">var own = it.splice;</span><span class="s3">\n  </span><span class="s1">return it === ArrayPrototype || (it instanceof Array &amp;&amp; own === ArrayPrototype.splice) ? splice : own;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../../modules/es.array.splice');</span><span class="s3">\n</span><span class="s1">var entryVirtual = require('../../../internals/entry-virtual');</span><span class="s3">\n\n</span><span class="s1">module.exports = entryVirtual('Array').splice;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var toAbsoluteIndex = require('../internals/to-absolute-index');</span><span class="s3">\n</span><span class="s1">var toInteger = require('../internals/to-integer');</span><span class="s3">\n</span><span class="s1">var toLength = require('../internals/to-length');</span><span class="s3">\n</span><span class="s1">var toObject = require('../internals/to-object');</span><span class="s3">\n</span><span class="s1">var arraySpeciesCreate = require('../internals/array-species-create');</span><span class="s3">\n</span><span class="s1">var createProperty = require('../internals/create-property');</span><span class="s3">\n</span><span class="s1">var arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');</span><span class="s3">\n</span><span class="s1">var arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');</span><span class="s3">\n\n</span><span class="s1">var HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('splice');</span><span class="s3">\n</span><span class="s1">var USES_TO_LENGTH = arrayMethodUsesToLength('splice', { ACCESSORS: true, 0: 0, 1: 2 });</span><span class="s3">\n\n</span><span class="s1">var max = Math.max;</span><span class="s3">\n</span><span class="s1">var min = Math.min;</span><span class="s3">\n</span><span class="s1">var MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF;</span><span class="s3">\n</span><span class="s1">var MAXIMUM_ALLOWED_LENGTH_EXCEEDED = 'Maximum allowed length exceeded';</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.splice` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.splice</span><span class="s3">\n</span><span class="s1">// with adding support of @@species</span><span class="s3">\n</span><span class="s1">$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {</span><span class="s3">\n  </span><span class="s1">splice: function splice(start, deleteCount /* , ...items */) {</span><span class="s3">\n    </span><span class="s1">var O = toObject(this);</span><span class="s3">\n    </span><span class="s1">var len = toLength(O.length);</span><span class="s3">\n    </span><span class="s1">var actualStart = toAbsoluteIndex(start, len);</span><span class="s3">\n    </span><span class="s1">var argumentsLength = arguments.length;</span><span class="s3">\n    </span><span class="s1">var insertCount, actualDeleteCount, A, k, from, to;</span><span class="s3">\n    </span><span class="s1">if (argumentsLength === 0) {</span><span class="s3">\n      </span><span class="s1">insertCount = actualDeleteCount = 0;</span><span class="s3">\n    </span><span class="s1">} else if (argumentsLength === 1) {</span><span class="s3">\n      </span><span class="s1">insertCount = 0;</span><span class="s3">\n      </span><span class="s1">actualDeleteCount = len - actualStart;</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">insertCount = argumentsLength - 2;</span><span class="s3">\n      </span><span class="s1">actualDeleteCount = min(max(toInteger(deleteCount), 0), len - actualStart);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (len + insertCount - actualDeleteCount &gt; MAX_SAFE_INTEGER) {</span><span class="s3">\n      </span><span class="s1">throw TypeError(MAXIMUM_ALLOWED_LENGTH_EXCEEDED);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">A = arraySpeciesCreate(O, actualDeleteCount);</span><span class="s3">\n    </span><span class="s1">for (k = 0; k &lt; actualDeleteCount; k++) {</span><span class="s3">\n      </span><span class="s1">from = actualStart + k;</span><span class="s3">\n      </span><span class="s1">if (from in O) createProperty(A, k, O[from]);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">A.length = actualDeleteCount;</span><span class="s3">\n    </span><span class="s1">if (insertCount &lt; actualDeleteCount) {</span><span class="s3">\n      </span><span class="s1">for (k = actualStart; k &lt; len - actualDeleteCount; k++) {</span><span class="s3">\n        </span><span class="s1">from = k + actualDeleteCount;</span><span class="s3">\n        </span><span class="s1">to = k + insertCount;</span><span class="s3">\n        </span><span class="s1">if (from in O) O[to] = O[from];</span><span class="s3">\n        </span><span class="s1">else delete O[to];</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">for (k = len; k &gt; len - actualDeleteCount + insertCount; k--) delete O[k - 1];</span><span class="s3">\n    </span><span class="s1">} else if (insertCount &gt; actualDeleteCount) {</span><span class="s3">\n      </span><span class="s1">for (k = len - actualDeleteCount; k &gt; actualStart; k--) {</span><span class="s3">\n        </span><span class="s1">from = k + actualDeleteCount - 1;</span><span class="s3">\n        </span><span class="s1">to = k + insertCount - 1;</span><span class="s3">\n        </span><span class="s1">if (from in O) O[to] = O[from];</span><span class="s3">\n        </span><span class="s1">else delete O[to];</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">for (k = 0; k &lt; insertCount; k++) {</span><span class="s3">\n      </span><span class="s1">O[k + actualStart] = arguments[k + 2];</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">O.length = len - actualDeleteCount + insertCount;</span><span class="s3">\n    </span><span class="s1">return A;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/instance/filter');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var filter = require('../array/virtual/filter');</span><span class="s3">\n\n</span><span class="s1">var ArrayPrototype = Array.prototype;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">var own = it.filter;</span><span class="s3">\n  </span><span class="s1">return it === ArrayPrototype || (it instanceof Array &amp;&amp; own === ArrayPrototype.filter) ? filter : own;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../../modules/es.array.filter');</span><span class="s3">\n</span><span class="s1">var entryVirtual = require('../../../internals/entry-virtual');</span><span class="s3">\n\n</span><span class="s1">module.exports = entryVirtual('Array').filter;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var $filter = require('../internals/array-iteration').filter;</span><span class="s3">\n</span><span class="s1">var arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');</span><span class="s3">\n</span><span class="s1">var arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');</span><span class="s3">\n\n</span><span class="s1">var HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('filter');</span><span class="s3">\n</span><span class="s1">// Edge 14- issue</span><span class="s3">\n</span><span class="s1">var USES_TO_LENGTH = arrayMethodUsesToLength('filter');</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.filter` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.filter</span><span class="s3">\n</span><span class="s1">// with adding support of @@species</span><span class="s3">\n</span><span class="s1">$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {</span><span class="s3">\n  </span><span class="s1">filter: function filter(callbackfn /* , thisArg */) {</span><span class="s3">\n    </span><span class="s1">return $filter(this, callbackfn, arguments.length &gt; 1 ? arguments[1] : undefined);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/instance/includes');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var arrayIncludes = require('../array/virtual/includes');</span><span class="s3">\n</span><span class="s1">var stringIncludes = require('../string/virtual/includes');</span><span class="s3">\n\n</span><span class="s1">var ArrayPrototype = Array.prototype;</span><span class="s3">\n</span><span class="s1">var StringPrototype = String.prototype;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">var own = it.includes;</span><span class="s3">\n  </span><span class="s1">if (it === ArrayPrototype || (it instanceof Array &amp;&amp; own === ArrayPrototype.includes)) return arrayIncludes;</span><span class="s3">\n  </span><span class="s1">if (typeof it === 'string' || it === StringPrototype || (it instanceof String &amp;&amp; own === StringPrototype.includes)) {</span><span class="s3">\n    </span><span class="s1">return stringIncludes;</span><span class="s3">\n  </span><span class="s1">} return own;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../../modules/es.array.includes');</span><span class="s3">\n</span><span class="s1">var entryVirtual = require('../../../internals/entry-virtual');</span><span class="s3">\n\n</span><span class="s1">module.exports = entryVirtual('Array').includes;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var $includes = require('../internals/array-includes').includes;</span><span class="s3">\n</span><span class="s1">var addToUnscopables = require('../internals/add-to-unscopables');</span><span class="s3">\n</span><span class="s1">var arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');</span><span class="s3">\n\n</span><span class="s1">var USES_TO_LENGTH = arrayMethodUsesToLength('indexOf', { ACCESSORS: true, 1: 0 });</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.includes` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.includes</span><span class="s3">\n</span><span class="s1">$({ target: 'Array', proto: true, forced: !USES_TO_LENGTH }, {</span><span class="s3">\n  </span><span class="s1">includes: function includes(el /* , fromIndex = 0 */) {</span><span class="s3">\n    </span><span class="s1">return $includes(this, el, arguments.length &gt; 1 ? arguments[1] : undefined);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables</span><span class="s3">\n</span><span class="s1">addToUnscopables('includes');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../../modules/es.string.includes');</span><span class="s3">\n</span><span class="s1">var entryVirtual = require('../../../internals/entry-virtual');</span><span class="s3">\n\n</span><span class="s1">module.exports = entryVirtual('String').includes;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var notARegExp = require('../internals/not-a-regexp');</span><span class="s3">\n</span><span class="s1">var requireObjectCoercible = require('../internals/require-object-coercible');</span><span class="s3">\n</span><span class="s1">var correctIsRegExpLogic = require('../internals/correct-is-regexp-logic');</span><span class="s3">\n\n</span><span class="s1">// `String.prototype.includes` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-string.prototype.includes</span><span class="s3">\n</span><span class="s1">$({ target: 'String', proto: true, forced: !correctIsRegExpLogic('includes') }, {</span><span class="s3">\n  </span><span class="s1">includes: function includes(searchString /* , position = 0 */) {</span><span class="s3">\n    </span><span class="s1">return !!~String(requireObjectCoercible(this))</span><span class="s3">\n      </span><span class="s1">.indexOf(notARegExp(searchString), arguments.length &gt; 1 ? arguments[1] : undefined);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var isRegExp = require('../internals/is-regexp');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">if (isRegExp(it)) {</span><span class="s3">\n    </span><span class="s1">throw TypeError(</span><span class="s3">\&quot;</span><span class="s1">The method doesn't accept regular expressions</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n  </span><span class="s1">} return it;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var isObject = require('../internals/is-object');</span><span class="s3">\n</span><span class="s1">var classof = require('../internals/classof-raw');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">var MATCH = wellKnownSymbol('match');</span><span class="s3">\n\n</span><span class="s1">// `IsRegExp` abstract operation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-isregexp</span><span class="s3">\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">var isRegExp;</span><span class="s3">\n  </span><span class="s1">return isObject(it) &amp;&amp; ((isRegExp = it[MATCH]) !== undefined ? !!isRegExp : classof(it) == 'RegExp');</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">var MATCH = wellKnownSymbol('match');</span><span class="s3">\n\n</span><span class="s1">module.exports = function (METHOD_NAME) {</span><span class="s3">\n  </span><span class="s1">var regexp = /./;</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">'/./'[METHOD_NAME](regexp);</span><span class="s3">\n  </span><span class="s1">} catch (e) {</span><span class="s3">\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">regexp[MATCH] = false;</span><span class="s3">\n      </span><span class="s1">return '/./'[METHOD_NAME](regexp);</span><span class="s3">\n    </span><span class="s1">} catch (f) { /* empty */ }</span><span class="s3">\n  </span><span class="s1">} return false;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/instance/bind');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var bind = require('../function/virtual/bind');</span><span class="s3">\n\n</span><span class="s1">var FunctionPrototype = Function.prototype;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">var own = it.bind;</span><span class="s3">\n  </span><span class="s1">return it === FunctionPrototype || (it instanceof Function &amp;&amp; own === FunctionPrototype.bind) ? bind : own;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../../modules/es.function.bind');</span><span class="s3">\n</span><span class="s1">var entryVirtual = require('../../../internals/entry-virtual');</span><span class="s3">\n\n</span><span class="s1">module.exports = entryVirtual('Function').bind;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var bind = require('../internals/function-bind');</span><span class="s3">\n\n</span><span class="s1">// `Function.prototype.bind` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-function.prototype.bind</span><span class="s3">\n</span><span class="s1">$({ target: 'Function', proto: true }, {</span><span class="s3">\n  </span><span class="s1">bind: bind</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var aFunction = require('../internals/a-function');</span><span class="s3">\n</span><span class="s1">var isObject = require('../internals/is-object');</span><span class="s3">\n\n</span><span class="s1">var slice = [].slice;</span><span class="s3">\n</span><span class="s1">var factories = {};</span><span class="s3">\n\n</span><span class="s1">var construct = function (C, argsLength, args) {</span><span class="s3">\n  </span><span class="s1">if (!(argsLength in factories)) {</span><span class="s3">\n    </span><span class="s1">for (var list = [], i = 0; i &lt; argsLength; i++) list[i] = 'a[' + i + ']';</span><span class="s3">\n    </span><span class="s1">// eslint-disable-next-line no-new-func</span><span class="s3">\n    </span><span class="s1">factories[argsLength] = Function('C,a', 'return new C(' + list.join(',') + ')');</span><span class="s3">\n  </span><span class="s1">} return factories[argsLength](C, args);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">// `Function.prototype.bind` method implementation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-function.prototype.bind</span><span class="s3">\n</span><span class="s1">module.exports = Function.bind || function bind(that /* , ...args */) {</span><span class="s3">\n  </span><span class="s1">var fn = aFunction(this);</span><span class="s3">\n  </span><span class="s1">var partArgs = slice.call(arguments, 1);</span><span class="s3">\n  </span><span class="s1">var boundFunction = function bound(/* args... */) {</span><span class="s3">\n    </span><span class="s1">var args = partArgs.concat(slice.call(arguments));</span><span class="s3">\n    </span><span class="s1">return this instanceof boundFunction ? construct(fn, args.length, args) : fn.apply(that, args);</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">if (isObject(fn.prototype)) boundFunction.prototype = fn.prototype;</span><span class="s3">\n  </span><span class="s1">return boundFunction;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/features/symbol/iterator</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/symbol/iterator');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.symbol.iterator');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.string.iterator');</span><span class="s3">\n</span><span class="s1">require('../../modules/web.dom-collections.iterator');</span><span class="s3">\n</span><span class="s1">var WrappedWellKnownSymbolModule = require('../../internals/well-known-symbol-wrapped');</span><span class="s3">\n\n</span><span class="s1">module.exports = WrappedWellKnownSymbolModule.f('iterator');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/features/symbol</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/symbol');</span><span class="s3">\n</span><span class="s1">require('../../modules/esnext.symbol.async-dispose');</span><span class="s3">\n</span><span class="s1">require('../../modules/esnext.symbol.dispose');</span><span class="s3">\n</span><span class="s1">require('../../modules/esnext.symbol.observable');</span><span class="s3">\n</span><span class="s1">require('../../modules/esnext.symbol.pattern-match');</span><span class="s3">\n</span><span class="s1">// TODO: Remove from `core-js@4`</span><span class="s3">\n</span><span class="s1">require('../../modules/esnext.symbol.replace-all');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.array.concat');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.object.to-string');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.async-iterator');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.description');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.has-instance');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.is-concat-spreadable');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.iterator');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.match');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.match-all');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.replace');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.search');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.species');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.split');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.to-primitive');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.to-string-tag');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.symbol.unscopables');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.math.to-string-tag');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.json.to-string-tag');</span><span class="s3">\n</span><span class="s1">var path = require('../../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.Symbol;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var fails = require('../internals/fails');</span><span class="s3">\n</span><span class="s1">var isArray = require('../internals/is-array');</span><span class="s3">\n</span><span class="s1">var isObject = require('../internals/is-object');</span><span class="s3">\n</span><span class="s1">var toObject = require('../internals/to-object');</span><span class="s3">\n</span><span class="s1">var toLength = require('../internals/to-length');</span><span class="s3">\n</span><span class="s1">var createProperty = require('../internals/create-property');</span><span class="s3">\n</span><span class="s1">var arraySpeciesCreate = require('../internals/array-species-create');</span><span class="s3">\n</span><span class="s1">var arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n</span><span class="s1">var V8_VERSION = require('../internals/engine-v8-version');</span><span class="s3">\n\n</span><span class="s1">var IS_CONCAT_SPREADABLE = wellKnownSymbol('isConcatSpreadable');</span><span class="s3">\n</span><span class="s1">var MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF;</span><span class="s3">\n</span><span class="s1">var MAXIMUM_ALLOWED_INDEX_EXCEEDED = 'Maximum allowed index exceeded';</span><span class="s3">\n\n</span><span class="s1">// We can't use this feature detection in V8 since it causes</span><span class="s3">\n</span><span class="s1">// deoptimization and serious performance degradation</span><span class="s3">\n</span><span class="s1">// https://github.com/zloirock/core-js/issues/679</span><span class="s3">\n</span><span class="s1">var IS_CONCAT_SPREADABLE_SUPPORT = V8_VERSION &gt;= 51 || !fails(function () {</span><span class="s3">\n  </span><span class="s1">var array = [];</span><span class="s3">\n  </span><span class="s1">array[IS_CONCAT_SPREADABLE] = false;</span><span class="s3">\n  </span><span class="s1">return array.concat()[0] !== array;</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">var SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('concat');</span><span class="s3">\n\n</span><span class="s1">var isConcatSpreadable = function (O) {</span><span class="s3">\n  </span><span class="s1">if (!isObject(O)) return false;</span><span class="s3">\n  </span><span class="s1">var spreadable = O[IS_CONCAT_SPREADABLE];</span><span class="s3">\n  </span><span class="s1">return spreadable !== undefined ? !!spreadable : isArray(O);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var FORCED = !IS_CONCAT_SPREADABLE_SUPPORT || !SPECIES_SUPPORT;</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.concat` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.concat</span><span class="s3">\n</span><span class="s1">// with adding support of @@isConcatSpreadable and @@species</span><span class="s3">\n</span><span class="s1">$({ target: 'Array', proto: true, forced: FORCED }, {</span><span class="s3">\n  </span><span class="s1">concat: function concat(arg) { // eslint-disable-line no-unused-vars</span><span class="s3">\n    </span><span class="s1">var O = toObject(this);</span><span class="s3">\n    </span><span class="s1">var A = arraySpeciesCreate(O, 0);</span><span class="s3">\n    </span><span class="s1">var n = 0;</span><span class="s3">\n    </span><span class="s1">var i, k, length, len, E;</span><span class="s3">\n    </span><span class="s1">for (i = -1, length = arguments.length; i &lt; length; i++) {</span><span class="s3">\n      </span><span class="s1">E = i === -1 ? O : arguments[i];</span><span class="s3">\n      </span><span class="s1">if (isConcatSpreadable(E)) {</span><span class="s3">\n        </span><span class="s1">len = toLength(E.length);</span><span class="s3">\n        </span><span class="s1">if (n + len &gt; MAX_SAFE_INTEGER) throw TypeError(MAXIMUM_ALLOWED_INDEX_EXCEEDED);</span><span class="s3">\n        </span><span class="s1">for (k = 0; k &lt; len; k++, n++) if (k in E) createProperty(A, n, E[k]);</span><span class="s3">\n      </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">if (n &gt;= MAX_SAFE_INTEGER) throw TypeError(MAXIMUM_ALLOWED_INDEX_EXCEEDED);</span><span class="s3">\n        </span><span class="s1">createProperty(A, n++, E);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">A.length = n;</span><span class="s3">\n    </span><span class="s1">return A;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var getBuiltIn = require('../internals/get-built-in');</span><span class="s3">\n</span><span class="s1">var IS_PURE = require('../internals/is-pure');</span><span class="s3">\n</span><span class="s1">var DESCRIPTORS = require('../internals/descriptors');</span><span class="s3">\n</span><span class="s1">var NATIVE_SYMBOL = require('../internals/native-symbol');</span><span class="s3">\n</span><span class="s1">var USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');</span><span class="s3">\n</span><span class="s1">var fails = require('../internals/fails');</span><span class="s3">\n</span><span class="s1">var has = require('../internals/has');</span><span class="s3">\n</span><span class="s1">var isArray = require('../internals/is-array');</span><span class="s3">\n</span><span class="s1">var isObject = require('../internals/is-object');</span><span class="s3">\n</span><span class="s1">var anObject = require('../internals/an-object');</span><span class="s3">\n</span><span class="s1">var toObject = require('../internals/to-object');</span><span class="s3">\n</span><span class="s1">var toIndexedObject = require('../internals/to-indexed-object');</span><span class="s3">\n</span><span class="s1">var toPrimitive = require('../internals/to-primitive');</span><span class="s3">\n</span><span class="s1">var createPropertyDescriptor = require('../internals/create-property-descriptor');</span><span class="s3">\n</span><span class="s1">var nativeObjectCreate = require('../internals/object-create');</span><span class="s3">\n</span><span class="s1">var objectKeys = require('../internals/object-keys');</span><span class="s3">\n</span><span class="s1">var getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');</span><span class="s3">\n</span><span class="s1">var getOwnPropertyNamesExternal = require('../internals/object-get-own-property-names-external');</span><span class="s3">\n</span><span class="s1">var getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');</span><span class="s3">\n</span><span class="s1">var getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');</span><span class="s3">\n</span><span class="s1">var definePropertyModule = require('../internals/object-define-property');</span><span class="s3">\n</span><span class="s1">var propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');</span><span class="s3">\n</span><span class="s1">var createNonEnumerableProperty = require('../internals/create-non-enumerable-property');</span><span class="s3">\n</span><span class="s1">var redefine = require('../internals/redefine');</span><span class="s3">\n</span><span class="s1">var shared = require('../internals/shared');</span><span class="s3">\n</span><span class="s1">var sharedKey = require('../internals/shared-key');</span><span class="s3">\n</span><span class="s1">var hiddenKeys = require('../internals/hidden-keys');</span><span class="s3">\n</span><span class="s1">var uid = require('../internals/uid');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n</span><span class="s1">var wrappedWellKnownSymbolModule = require('../internals/well-known-symbol-wrapped');</span><span class="s3">\n</span><span class="s1">var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n</span><span class="s1">var setToStringTag = require('../internals/set-to-string-tag');</span><span class="s3">\n</span><span class="s1">var InternalStateModule = require('../internals/internal-state');</span><span class="s3">\n</span><span class="s1">var $forEach = require('../internals/array-iteration').forEach;</span><span class="s3">\n\n</span><span class="s1">var HIDDEN = sharedKey('hidden');</span><span class="s3">\n</span><span class="s1">var SYMBOL = 'Symbol';</span><span class="s3">\n</span><span class="s1">var PROTOTYPE = 'prototype';</span><span class="s3">\n</span><span class="s1">var TO_PRIMITIVE = wellKnownSymbol('toPrimitive');</span><span class="s3">\n</span><span class="s1">var setInternalState = InternalStateModule.set;</span><span class="s3">\n</span><span class="s1">var getInternalState = InternalStateModule.getterFor(SYMBOL);</span><span class="s3">\n</span><span class="s1">var ObjectPrototype = Object[PROTOTYPE];</span><span class="s3">\n</span><span class="s1">var $Symbol = global.Symbol;</span><span class="s3">\n</span><span class="s1">var $stringify = getBuiltIn('JSON', 'stringify');</span><span class="s3">\n</span><span class="s1">var nativeGetOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;</span><span class="s3">\n</span><span class="s1">var nativeDefineProperty = definePropertyModule.f;</span><span class="s3">\n</span><span class="s1">var nativeGetOwnPropertyNames = getOwnPropertyNamesExternal.f;</span><span class="s3">\n</span><span class="s1">var nativePropertyIsEnumerable = propertyIsEnumerableModule.f;</span><span class="s3">\n</span><span class="s1">var AllSymbols = shared('symbols');</span><span class="s3">\n</span><span class="s1">var ObjectPrototypeSymbols = shared('op-symbols');</span><span class="s3">\n</span><span class="s1">var StringToSymbolRegistry = shared('string-to-symbol-registry');</span><span class="s3">\n</span><span class="s1">var SymbolToStringRegistry = shared('symbol-to-string-registry');</span><span class="s3">\n</span><span class="s1">var WellKnownSymbolsStore = shared('wks');</span><span class="s3">\n</span><span class="s1">var QObject = global.QObject;</span><span class="s3">\n</span><span class="s1">// Don't use setters in Qt Script, https://github.com/zloirock/core-js/issues/173</span><span class="s3">\n</span><span class="s1">var USE_SETTER = !QObject || !QObject[PROTOTYPE] || !QObject[PROTOTYPE].findChild;</span><span class="s3">\n\n</span><span class="s1">// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687</span><span class="s3">\n</span><span class="s1">var setSymbolDescriptor = DESCRIPTORS &amp;&amp; fails(function () {</span><span class="s3">\n  </span><span class="s1">return nativeObjectCreate(nativeDefineProperty({}, 'a', {</span><span class="s3">\n    </span><span class="s1">get: function () { return nativeDefineProperty(this, 'a', { value: 7 }).a; }</span><span class="s3">\n  </span><span class="s1">})).a != 7;</span><span class="s3">\n</span><span class="s1">}) ? function (O, P, Attributes) {</span><span class="s3">\n  </span><span class="s1">var ObjectPrototypeDescriptor = nativeGetOwnPropertyDescriptor(ObjectPrototype, P);</span><span class="s3">\n  </span><span class="s1">if (ObjectPrototypeDescriptor) delete ObjectPrototype[P];</span><span class="s3">\n  </span><span class="s1">nativeDefineProperty(O, P, Attributes);</span><span class="s3">\n  </span><span class="s1">if (ObjectPrototypeDescriptor &amp;&amp; O !== ObjectPrototype) {</span><span class="s3">\n    </span><span class="s1">nativeDefineProperty(ObjectPrototype, P, ObjectPrototypeDescriptor);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">} : nativeDefineProperty;</span><span class="s3">\n\n</span><span class="s1">var wrap = function (tag, description) {</span><span class="s3">\n  </span><span class="s1">var symbol = AllSymbols[tag] = nativeObjectCreate($Symbol[PROTOTYPE]);</span><span class="s3">\n  </span><span class="s1">setInternalState(symbol, {</span><span class="s3">\n    </span><span class="s1">type: SYMBOL,</span><span class="s3">\n    </span><span class="s1">tag: tag,</span><span class="s3">\n    </span><span class="s1">description: description</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n  </span><span class="s1">if (!DESCRIPTORS) symbol.description = description;</span><span class="s3">\n  </span><span class="s1">return symbol;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var isSymbol = USE_SYMBOL_AS_UID ? function (it) {</span><span class="s3">\n  </span><span class="s1">return typeof it == 'symbol';</span><span class="s3">\n</span><span class="s1">} : function (it) {</span><span class="s3">\n  </span><span class="s1">return Object(it) instanceof $Symbol;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var $defineProperty = function defineProperty(O, P, Attributes) {</span><span class="s3">\n  </span><span class="s1">if (O === ObjectPrototype) $defineProperty(ObjectPrototypeSymbols, P, Attributes);</span><span class="s3">\n  </span><span class="s1">anObject(O);</span><span class="s3">\n  </span><span class="s1">var key = toPrimitive(P, true);</span><span class="s3">\n  </span><span class="s1">anObject(Attributes);</span><span class="s3">\n  </span><span class="s1">if (has(AllSymbols, key)) {</span><span class="s3">\n    </span><span class="s1">if (!Attributes.enumerable) {</span><span class="s3">\n      </span><span class="s1">if (!has(O, HIDDEN)) nativeDefineProperty(O, HIDDEN, createPropertyDescriptor(1, {}));</span><span class="s3">\n      </span><span class="s1">O[HIDDEN][key] = true;</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">if (has(O, HIDDEN) &amp;&amp; O[HIDDEN][key]) O[HIDDEN][key] = false;</span><span class="s3">\n      </span><span class="s1">Attributes = nativeObjectCreate(Attributes, { enumerable: createPropertyDescriptor(0, false) });</span><span class="s3">\n    </span><span class="s1">} return setSymbolDescriptor(O, key, Attributes);</span><span class="s3">\n  </span><span class="s1">} return nativeDefineProperty(O, key, Attributes);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var $defineProperties = function defineProperties(O, Properties) {</span><span class="s3">\n  </span><span class="s1">anObject(O);</span><span class="s3">\n  </span><span class="s1">var properties = toIndexedObject(Properties);</span><span class="s3">\n  </span><span class="s1">var keys = objectKeys(properties).concat($getOwnPropertySymbols(properties));</span><span class="s3">\n  </span><span class="s1">$forEach(keys, function (key) {</span><span class="s3">\n    </span><span class="s1">if (!DESCRIPTORS || $propertyIsEnumerable.call(properties, key)) $defineProperty(O, key, properties[key]);</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n  </span><span class="s1">return O;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var $create = function create(O, Properties) {</span><span class="s3">\n  </span><span class="s1">return Properties === undefined ? nativeObjectCreate(O) : $defineProperties(nativeObjectCreate(O), Properties);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var $propertyIsEnumerable = function propertyIsEnumerable(V) {</span><span class="s3">\n  </span><span class="s1">var P = toPrimitive(V, true);</span><span class="s3">\n  </span><span class="s1">var enumerable = nativePropertyIsEnumerable.call(this, P);</span><span class="s3">\n  </span><span class="s1">if (this === ObjectPrototype &amp;&amp; has(AllSymbols, P) &amp;&amp; !has(ObjectPrototypeSymbols, P)) return false;</span><span class="s3">\n  </span><span class="s1">return enumerable || !has(this, P) || !has(AllSymbols, P) || has(this, HIDDEN) &amp;&amp; this[HIDDEN][P] ? enumerable : true;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(O, P) {</span><span class="s3">\n  </span><span class="s1">var it = toIndexedObject(O);</span><span class="s3">\n  </span><span class="s1">var key = toPrimitive(P, true);</span><span class="s3">\n  </span><span class="s1">if (it === ObjectPrototype &amp;&amp; has(AllSymbols, key) &amp;&amp; !has(ObjectPrototypeSymbols, key)) return;</span><span class="s3">\n  </span><span class="s1">var descriptor = nativeGetOwnPropertyDescriptor(it, key);</span><span class="s3">\n  </span><span class="s1">if (descriptor &amp;&amp; has(AllSymbols, key) &amp;&amp; !(has(it, HIDDEN) &amp;&amp; it[HIDDEN][key])) {</span><span class="s3">\n    </span><span class="s1">descriptor.enumerable = true;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return descriptor;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var $getOwnPropertyNames = function getOwnPropertyNames(O) {</span><span class="s3">\n  </span><span class="s1">var names = nativeGetOwnPropertyNames(toIndexedObject(O));</span><span class="s3">\n  </span><span class="s1">var result = [];</span><span class="s3">\n  </span><span class="s1">$forEach(names, function (key) {</span><span class="s3">\n    </span><span class="s1">if (!has(AllSymbols, key) &amp;&amp; !has(hiddenKeys, key)) result.push(key);</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n  </span><span class="s1">return result;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var $getOwnPropertySymbols = function getOwnPropertySymbols(O) {</span><span class="s3">\n  </span><span class="s1">var IS_OBJECT_PROTOTYPE = O === ObjectPrototype;</span><span class="s3">\n  </span><span class="s1">var names = nativeGetOwnPropertyNames(IS_OBJECT_PROTOTYPE ? ObjectPrototypeSymbols : toIndexedObject(O));</span><span class="s3">\n  </span><span class="s1">var result = [];</span><span class="s3">\n  </span><span class="s1">$forEach(names, function (key) {</span><span class="s3">\n    </span><span class="s1">if (has(AllSymbols, key) &amp;&amp; (!IS_OBJECT_PROTOTYPE || has(ObjectPrototype, key))) {</span><span class="s3">\n      </span><span class="s1">result.push(AllSymbols[key]);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n  </span><span class="s1">return result;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">// `Symbol` constructor</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol-constructor</span><span class="s3">\n</span><span class="s1">if (!NATIVE_SYMBOL) {</span><span class="s3">\n  </span><span class="s1">$Symbol = function Symbol() {</span><span class="s3">\n    </span><span class="s1">if (this instanceof $Symbol) throw TypeError('Symbol is not a constructor');</span><span class="s3">\n    </span><span class="s1">var description = !arguments.length || arguments[0] === undefined ? undefined : String(arguments[0]);</span><span class="s3">\n    </span><span class="s1">var tag = uid(description);</span><span class="s3">\n    </span><span class="s1">var setter = function (value) {</span><span class="s3">\n      </span><span class="s1">if (this === ObjectPrototype) setter.call(ObjectPrototypeSymbols, value);</span><span class="s3">\n      </span><span class="s1">if (has(this, HIDDEN) &amp;&amp; has(this[HIDDEN], tag)) this[HIDDEN][tag] = false;</span><span class="s3">\n      </span><span class="s1">setSymbolDescriptor(this, tag, createPropertyDescriptor(1, value));</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n    </span><span class="s1">if (DESCRIPTORS &amp;&amp; USE_SETTER) setSymbolDescriptor(ObjectPrototype, tag, { configurable: true, set: setter });</span><span class="s3">\n    </span><span class="s1">return wrap(tag, description);</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n\n  </span><span class="s1">redefine($Symbol[PROTOTYPE], 'toString', function toString() {</span><span class="s3">\n    </span><span class="s1">return getInternalState(this).tag;</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n\n  </span><span class="s1">redefine($Symbol, 'withoutSetter', function (description) {</span><span class="s3">\n    </span><span class="s1">return wrap(uid(description), description);</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n\n  </span><span class="s1">propertyIsEnumerableModule.f = $propertyIsEnumerable;</span><span class="s3">\n  </span><span class="s1">definePropertyModule.f = $defineProperty;</span><span class="s3">\n  </span><span class="s1">getOwnPropertyDescriptorModule.f = $getOwnPropertyDescriptor;</span><span class="s3">\n  </span><span class="s1">getOwnPropertyNamesModule.f = getOwnPropertyNamesExternal.f = $getOwnPropertyNames;</span><span class="s3">\n  </span><span class="s1">getOwnPropertySymbolsModule.f = $getOwnPropertySymbols;</span><span class="s3">\n\n  </span><span class="s1">wrappedWellKnownSymbolModule.f = function (name) {</span><span class="s3">\n    </span><span class="s1">return wrap(wellKnownSymbol(name), name);</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n\n  </span><span class="s1">if (DESCRIPTORS) {</span><span class="s3">\n    </span><span class="s1">// https://github.com/tc39/proposal-Symbol-description</span><span class="s3">\n    </span><span class="s1">nativeDefineProperty($Symbol[PROTOTYPE], 'description', {</span><span class="s3">\n      </span><span class="s1">configurable: true,</span><span class="s3">\n      </span><span class="s1">get: function description() {</span><span class="s3">\n        </span><span class="s1">return getInternalState(this).description;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n    </span><span class="s1">if (!IS_PURE) {</span><span class="s3">\n      </span><span class="s1">redefine(ObjectPrototype, 'propertyIsEnumerable', $propertyIsEnumerable, { unsafe: true });</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">$({ global: true, wrap: true, forced: !NATIVE_SYMBOL, sham: !NATIVE_SYMBOL }, {</span><span class="s3">\n  </span><span class="s1">Symbol: $Symbol</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">$forEach(objectKeys(WellKnownSymbolsStore), function (name) {</span><span class="s3">\n  </span><span class="s1">defineWellKnownSymbol(name);</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">$({ target: SYMBOL, stat: true, forced: !NATIVE_SYMBOL }, {</span><span class="s3">\n  </span><span class="s1">// `Symbol.for` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.for</span><span class="s3">\n  </span><span class="s1">'for': function (key) {</span><span class="s3">\n    </span><span class="s1">var string = String(key);</span><span class="s3">\n    </span><span class="s1">if (has(StringToSymbolRegistry, string)) return StringToSymbolRegistry[string];</span><span class="s3">\n    </span><span class="s1">var symbol = $Symbol(string);</span><span class="s3">\n    </span><span class="s1">StringToSymbolRegistry[string] = symbol;</span><span class="s3">\n    </span><span class="s1">SymbolToStringRegistry[symbol] = string;</span><span class="s3">\n    </span><span class="s1">return symbol;</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n  </span><span class="s1">// `Symbol.keyFor` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.keyfor</span><span class="s3">\n  </span><span class="s1">keyFor: function keyFor(sym) {</span><span class="s3">\n    </span><span class="s1">if (!isSymbol(sym)) throw TypeError(sym + ' is not a symbol');</span><span class="s3">\n    </span><span class="s1">if (has(SymbolToStringRegistry, sym)) return SymbolToStringRegistry[sym];</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n  </span><span class="s1">useSetter: function () { USE_SETTER = true; },</span><span class="s3">\n  </span><span class="s1">useSimple: function () { USE_SETTER = false; }</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">$({ target: 'Object', stat: true, forced: !NATIVE_SYMBOL, sham: !DESCRIPTORS }, {</span><span class="s3">\n  </span><span class="s1">// `Object.create` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.create</span><span class="s3">\n  </span><span class="s1">create: $create,</span><span class="s3">\n  </span><span class="s1">// `Object.defineProperty` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.defineproperty</span><span class="s3">\n  </span><span class="s1">defineProperty: $defineProperty,</span><span class="s3">\n  </span><span class="s1">// `Object.defineProperties` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.defineproperties</span><span class="s3">\n  </span><span class="s1">defineProperties: $defineProperties,</span><span class="s3">\n  </span><span class="s1">// `Object.getOwnPropertyDescriptor` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.getownpropertydescriptors</span><span class="s3">\n  </span><span class="s1">getOwnPropertyDescriptor: $getOwnPropertyDescriptor</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">$({ target: 'Object', stat: true, forced: !NATIVE_SYMBOL }, {</span><span class="s3">\n  </span><span class="s1">// `Object.getOwnPropertyNames` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.getownpropertynames</span><span class="s3">\n  </span><span class="s1">getOwnPropertyNames: $getOwnPropertyNames,</span><span class="s3">\n  </span><span class="s1">// `Object.getOwnPropertySymbols` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.getownpropertysymbols</span><span class="s3">\n  </span><span class="s1">getOwnPropertySymbols: $getOwnPropertySymbols</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">// Chrome 38 and 39 `Object.getOwnPropertySymbols` fails on primitives</span><span class="s3">\n</span><span class="s1">// https://bugs.chromium.org/p/v8/issues/detail?id=3443</span><span class="s3">\n</span><span class="s1">$({ target: 'Object', stat: true, forced: fails(function () { getOwnPropertySymbolsModule.f(1); }) }, {</span><span class="s3">\n  </span><span class="s1">getOwnPropertySymbols: function getOwnPropertySymbols(it) {</span><span class="s3">\n    </span><span class="s1">return getOwnPropertySymbolsModule.f(toObject(it));</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">// `JSON.stringify` method behavior with symbols</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-json.stringify</span><span class="s3">\n</span><span class="s1">if ($stringify) {</span><span class="s3">\n  </span><span class="s1">var FORCED_JSON_STRINGIFY = !NATIVE_SYMBOL || fails(function () {</span><span class="s3">\n    </span><span class="s1">var symbol = $Symbol();</span><span class="s3">\n    </span><span class="s1">// MS Edge converts symbol values to JSON as {}</span><span class="s3">\n    </span><span class="s1">return $stringify([symbol]) != '[null]'</span><span class="s3">\n      </span><span class="s1">// WebKit converts symbol values to JSON as null</span><span class="s3">\n      </span><span class="s1">|| $stringify({ a: symbol }) != '{}'</span><span class="s3">\n      </span><span class="s1">// V8 throws on boxed symbols</span><span class="s3">\n      </span><span class="s1">|| $stringify(Object(symbol)) != '{}';</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n\n  </span><span class="s1">$({ target: 'JSON', stat: true, forced: FORCED_JSON_STRINGIFY }, {</span><span class="s3">\n    </span><span class="s1">// eslint-disable-next-line no-unused-vars</span><span class="s3">\n    </span><span class="s1">stringify: function stringify(it, replacer, space) {</span><span class="s3">\n      </span><span class="s1">var args = [it];</span><span class="s3">\n      </span><span class="s1">var index = 1;</span><span class="s3">\n      </span><span class="s1">var $replacer;</span><span class="s3">\n      </span><span class="s1">while (arguments.length &gt; index) args.push(arguments[index++]);</span><span class="s3">\n      </span><span class="s1">$replacer = replacer;</span><span class="s3">\n      </span><span class="s1">if (!isObject(replacer) &amp;&amp; it === undefined || isSymbol(it)) return; // IE8 returns string on undefined</span><span class="s3">\n      </span><span class="s1">if (!isArray(replacer)) replacer = function (key, value) {</span><span class="s3">\n        </span><span class="s1">if (typeof $replacer == 'function') value = $replacer.call(this, key, value);</span><span class="s3">\n        </span><span class="s1">if (!isSymbol(value)) return value;</span><span class="s3">\n      </span><span class="s1">};</span><span class="s3">\n      </span><span class="s1">args[1] = replacer;</span><span class="s3">\n      </span><span class="s1">return $stringify.apply(null, args);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// `Symbol.prototype[@@toPrimitive]` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.prototype-@@toprimitive</span><span class="s3">\n</span><span class="s1">if (!$Symbol[PROTOTYPE][TO_PRIMITIVE]) {</span><span class="s3">\n  </span><span class="s1">createNonEnumerableProperty($Symbol[PROTOTYPE], TO_PRIMITIVE, $Symbol[PROTOTYPE].valueOf);</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">// `Symbol.prototype[@@toStringTag]` property</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.prototype-@@tostringtag</span><span class="s3">\n</span><span class="s1">setToStringTag($Symbol, SYMBOL);</span><span class="s3">\n\n</span><span class="s1">hiddenKeys[HIDDEN] = true;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var toIndexedObject = require('../internals/to-indexed-object');</span><span class="s3">\n</span><span class="s1">var nativeGetOwnPropertyNames = require('../internals/object-get-own-property-names').f;</span><span class="s3">\n\n</span><span class="s1">var toString = {}.toString;</span><span class="s3">\n\n</span><span class="s1">var windowNames = typeof window == 'object' &amp;&amp; window &amp;&amp; Object.getOwnPropertyNames</span><span class="s3">\n  </span><span class="s1">? Object.getOwnPropertyNames(window) : [];</span><span class="s3">\n\n</span><span class="s1">var getWindowNames = function (it) {</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">return nativeGetOwnPropertyNames(it);</span><span class="s3">\n  </span><span class="s1">} catch (error) {</span><span class="s3">\n    </span><span class="s1">return windowNames.slice();</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window</span><span class="s3">\n</span><span class="s1">module.exports.f = function getOwnPropertyNames(it) {</span><span class="s3">\n  </span><span class="s1">return windowNames &amp;&amp; toString.call(it) == '[object Window]'</span><span class="s3">\n    </span><span class="s1">? getWindowNames(it)</span><span class="s3">\n    </span><span class="s1">: nativeGetOwnPropertyNames(toIndexedObject(it));</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.asyncIterator` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.asynciterator</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('asyncIterator');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;// empty</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.hasInstance` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.hasinstance</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('hasInstance');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.isConcatSpreadable` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.isconcatspreadable</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('isConcatSpreadable');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.match` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.match</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('match');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.matchAll` well-known symbol</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('matchAll');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.replace` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.replace</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('replace');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.search` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.search</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('search');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.species` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.species</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('species');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.split` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.split</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('split');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.toPrimitive` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.toprimitive</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('toPrimitive');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.toStringTag` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.tostringtag</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('toStringTag');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.unscopables` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-symbol.unscopables</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('unscopables');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var setToStringTag = require('../internals/set-to-string-tag');</span><span class="s3">\n\n</span><span class="s1">// Math[@@toStringTag] property</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-math-@@tostringtag</span><span class="s3">\n</span><span class="s1">setToStringTag(Math, 'Math', true);</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var setToStringTag = require('../internals/set-to-string-tag');</span><span class="s3">\n\n</span><span class="s1">// JSON[@@toStringTag] property</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-json-@@tostringtag</span><span class="s3">\n</span><span class="s1">setToStringTag(global.JSON, 'JSON', true);</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.asyncDispose` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://github.com/tc39/proposal-using-statement</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('asyncDispose');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.dispose` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://github.com/tc39/proposal-using-statement</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('dispose');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.observable` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://github.com/tc39/proposal-observable</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('observable');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">// `Symbol.patternMatch` well-known symbol</span><span class="s3">\n</span><span class="s1">// https://github.com/tc39/proposal-pattern-matching</span><span class="s3">\n</span><span class="s1">defineWellKnownSymbol('patternMatch');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;// TODO: remove from `core-js@4`</span><span class="s3">\n</span><span class="s1">var defineWellKnownSymbol = require('../internals/define-well-known-symbol');</span><span class="s3">\n\n</span><span class="s1">defineWellKnownSymbol('replaceAll');</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/parse-int</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../es/parse-int');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../modules/es.parse-int');</span><span class="s3">\n</span><span class="s1">var path = require('../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.parseInt;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var parseIntImplementation = require('../internals/number-parse-int');</span><span class="s3">\n\n</span><span class="s1">// `parseInt` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-parseint-string-radix</span><span class="s3">\n</span><span class="s1">$({ global: true, forced: parseInt != parseIntImplementation }, {</span><span class="s3">\n  </span><span class="s1">parseInt: parseIntImplementation</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var trim = require('../internals/string-trim').trim;</span><span class="s3">\n</span><span class="s1">var whitespaces = require('../internals/whitespaces');</span><span class="s3">\n\n</span><span class="s1">var $parseInt = global.parseInt;</span><span class="s3">\n</span><span class="s1">var hex = /^[+-]?0[Xx]/;</span><span class="s3">\n</span><span class="s1">var FORCED = $parseInt(whitespaces + '08') !== 8 || $parseInt(whitespaces + '0x16') !== 22;</span><span class="s3">\n\n</span><span class="s1">// `parseInt` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-parseint-string-radix</span><span class="s3">\n</span><span class="s1">module.exports = FORCED ? function parseInt(string, radix) {</span><span class="s3">\n  </span><span class="s1">var S = trim(String(string));</span><span class="s3">\n  </span><span class="s1">return $parseInt(S, (radix &gt;&gt;&gt; 0) || (hex.test(S) ? 16 : 10));</span><span class="s3">\n</span><span class="s1">} : $parseInt;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/instance/slice');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var slice = require('../array/virtual/slice');</span><span class="s3">\n\n</span><span class="s1">var ArrayPrototype = Array.prototype;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">var own = it.slice;</span><span class="s3">\n  </span><span class="s1">return it === ArrayPrototype || (it instanceof Array &amp;&amp; own === ArrayPrototype.slice) ? slice : own;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../../modules/es.array.slice');</span><span class="s3">\n</span><span class="s1">var entryVirtual = require('../../../internals/entry-virtual');</span><span class="s3">\n\n</span><span class="s1">module.exports = entryVirtual('Array').slice;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var isObject = require('../internals/is-object');</span><span class="s3">\n</span><span class="s1">var isArray = require('../internals/is-array');</span><span class="s3">\n</span><span class="s1">var toAbsoluteIndex = require('../internals/to-absolute-index');</span><span class="s3">\n</span><span class="s1">var toLength = require('../internals/to-length');</span><span class="s3">\n</span><span class="s1">var toIndexedObject = require('../internals/to-indexed-object');</span><span class="s3">\n</span><span class="s1">var createProperty = require('../internals/create-property');</span><span class="s3">\n</span><span class="s1">var wellKnownSymbol = require('../internals/well-known-symbol');</span><span class="s3">\n</span><span class="s1">var arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');</span><span class="s3">\n</span><span class="s1">var arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');</span><span class="s3">\n\n</span><span class="s1">var HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('slice');</span><span class="s3">\n</span><span class="s1">var USES_TO_LENGTH = arrayMethodUsesToLength('slice', { ACCESSORS: true, 0: 0, 1: 2 });</span><span class="s3">\n\n</span><span class="s1">var SPECIES = wellKnownSymbol('species');</span><span class="s3">\n</span><span class="s1">var nativeSlice = [].slice;</span><span class="s3">\n</span><span class="s1">var max = Math.max;</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.slice` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.slice</span><span class="s3">\n</span><span class="s1">// fallback for not array-like ES3 strings and DOM objects</span><span class="s3">\n</span><span class="s1">$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {</span><span class="s3">\n  </span><span class="s1">slice: function slice(start, end) {</span><span class="s3">\n    </span><span class="s1">var O = toIndexedObject(this);</span><span class="s3">\n    </span><span class="s1">var length = toLength(O.length);</span><span class="s3">\n    </span><span class="s1">var k = toAbsoluteIndex(start, length);</span><span class="s3">\n    </span><span class="s1">var fin = toAbsoluteIndex(end === undefined ? length : end, length);</span><span class="s3">\n    </span><span class="s1">// inline `ArraySpeciesCreate` for usage native `Array#slice` where it's possible</span><span class="s3">\n    </span><span class="s1">var Constructor, result, n;</span><span class="s3">\n    </span><span class="s1">if (isArray(O)) {</span><span class="s3">\n      </span><span class="s1">Constructor = O.constructor;</span><span class="s3">\n      </span><span class="s1">// cross-realm fallback</span><span class="s3">\n      </span><span class="s1">if (typeof Constructor == 'function' &amp;&amp; (Constructor === Array || isArray(Constructor.prototype))) {</span><span class="s3">\n        </span><span class="s1">Constructor = undefined;</span><span class="s3">\n      </span><span class="s1">} else if (isObject(Constructor)) {</span><span class="s3">\n        </span><span class="s1">Constructor = Constructor[SPECIES];</span><span class="s3">\n        </span><span class="s1">if (Constructor === null) Constructor = undefined;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">if (Constructor === Array || Constructor === undefined) {</span><span class="s3">\n        </span><span class="s1">return nativeSlice.call(O, k, fin);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">result = new (Constructor === undefined ? Array : Constructor)(max(fin - k, 0));</span><span class="s3">\n    </span><span class="s1">for (n = 0; k &lt; fin; k++, n++) if (k in O) createProperty(result, n, O[k]);</span><span class="s3">\n    </span><span class="s1">result.length = n;</span><span class="s3">\n    </span><span class="s1">return result;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../modules/web.timers');</span><span class="s3">\n</span><span class="s1">var path = require('../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.setTimeout;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var userAgent = require('../internals/engine-user-agent');</span><span class="s3">\n\n</span><span class="s1">var slice = [].slice;</span><span class="s3">\n</span><span class="s1">var MSIE = /MSIE .</span><span class="s3">\\</span><span class="s1">./.test(userAgent); // &lt;- dirty ie9- check</span><span class="s3">\n\n</span><span class="s1">var wrap = function (scheduler) {</span><span class="s3">\n  </span><span class="s1">return function (handler, timeout /* , ...arguments */) {</span><span class="s3">\n    </span><span class="s1">var boundArgs = arguments.length &gt; 2;</span><span class="s3">\n    </span><span class="s1">var args = boundArgs ? slice.call(arguments, 2) : undefined;</span><span class="s3">\n    </span><span class="s1">return scheduler(boundArgs ? function () {</span><span class="s3">\n      </span><span class="s1">// eslint-disable-next-line no-new-func</span><span class="s3">\n      </span><span class="s1">(typeof handler == 'function' ? handler : Function(handler)).apply(this, args);</span><span class="s3">\n    </span><span class="s1">} : handler, timeout);</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">// ie9- setTimeout &amp; setInterval additional parameters fix</span><span class="s3">\n</span><span class="s1">// https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timers</span><span class="s3">\n</span><span class="s1">$({ global: true, bind: true, forced: MSIE }, {</span><span class="s3">\n  </span><span class="s1">// `setTimeout` method</span><span class="s3">\n  </span><span class="s1">// https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout</span><span class="s3">\n  </span><span class="s1">setTimeout: wrap(global.setTimeout),</span><span class="s3">\n  </span><span class="s1">// `setInterval` method</span><span class="s3">\n  </span><span class="s1">// https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-setinterval</span><span class="s3">\n  </span><span class="s1">setInterval: wrap(global.setInterval)</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 编辑器配置</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import menusConfig, {</span><span class="s3">\n    </span><span class="s1">EmotionsType,</span><span class="s3">\n    </span><span class="s1">FontSizeConfType,</span><span class="s3">\n    </span><span class="s1">IndentationType,</span><span class="s3">\n    </span><span class="s1">tooltipPositionType,</span><span class="s3">\n    </span><span class="s1">FontStyleType,</span><span class="s3">\n</span><span class="s1">} from './menus'</span><span class="s3">\n</span><span class="s1">import eventsConfig from './events'</span><span class="s3">\n</span><span class="s1">import styleConfig from './style'</span><span class="s3">\n</span><span class="s1">import pasteConfig from './paste'</span><span class="s3">\n</span><span class="s1">import cmdConfig from './cmd'</span><span class="s3">\n</span><span class="s1">import imageConfig, { UploadImageHooksType } from './image'</span><span class="s3">\n</span><span class="s1">import textConfig from './text'</span><span class="s3">\n</span><span class="s1">import langConfig from './lang'</span><span class="s3">\n</span><span class="s1">import historyConfig from './history'</span><span class="s3">\n</span><span class="s1">import videoConfig, { UploadVideoHooksType } from './video'</span><span class="s3">\n\n</span><span class="s1">// 字典类型</span><span class="s3">\n</span><span class="s1">export type DicType = {</span><span class="s3">\n    </span><span class="s1">[key: string]: string</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// 定义配置项的类型规范</span><span class="s3">\n</span><span class="s1">export type ConfigType = {</span><span class="s3">\n    </span><span class="s1">height: number</span><span class="s3">\n    </span><span class="s1">languageType: string[]</span><span class="s3">\n    </span><span class="s1">languageTab: string</span><span class="s3">\n    </span><span class="s1">menus: string[]</span><span class="s3">\n    </span><span class="s1">excludeMenus: string[]</span><span class="s3">\n    </span><span class="s1">fontNames: FontStyleType</span><span class="s3">\n    </span><span class="s1">lineHeights: string[]</span><span class="s3">\n    </span><span class="s1">showMenuTooltips: boolean</span><span class="s3">\n    </span><span class="s1">indentation: IndentationType</span><span class="s3">\n    </span><span class="s1">fontSizes: FontSizeConfType</span><span class="s3">\n    </span><span class="s1">colors: string[]</span><span class="s3">\n    </span><span class="s1">emotions: EmotionsType[]</span><span class="s3">\n    </span><span class="s1">zIndex: number</span><span class="s3">\n    </span><span class="s1">onchange: Function | null</span><span class="s3">\n    </span><span class="s1">onfocus: Function</span><span class="s3">\n    </span><span class="s1">onblur: Function</span><span class="s3">\n    </span><span class="s1">onchangeTimeout: number</span><span class="s3">\n    </span><span class="s1">pasteFilterStyle: boolean</span><span class="s3">\n    </span><span class="s1">pasteIgnoreImg: boolean</span><span class="s3">\n    </span><span class="s1">pasteTextHandle: Function</span><span class="s3">\n    </span><span class="s1">styleWithCSS: boolean</span><span class="s3">\n    </span><span class="s1">linkImgCallback: Function</span><span class="s3">\n    </span><span class="s1">onSelectionChange: Function</span><span class="s3">\n\n    </span><span class="s1">placeholder: string</span><span class="s3">\n    </span><span class="s1">zIndexFullScreen: number</span><span class="s3">\n    </span><span class="s1">showFullScreen: boolean</span><span class="s3">\n    </span><span class="s1">showLinkImg: boolean</span><span class="s3">\n    </span><span class="s1">showLinkImgAlt: boolean</span><span class="s3">\n    </span><span class="s1">showLinkImgHref: boolean</span><span class="s3">\n    </span><span class="s1">uploadImgAccept: string[]</span><span class="s3">\n    </span><span class="s1">uploadImgServer: string</span><span class="s3">\n    </span><span class="s1">uploadImgShowBase64: boolean</span><span class="s3">\n    </span><span class="s1">uploadImgMaxSize: number</span><span class="s3">\n    </span><span class="s1">uploadImgMaxLength: number</span><span class="s3">\n    </span><span class="s1">uploadFileName: string</span><span class="s3">\n    </span><span class="s1">uploadImgParams: DicType</span><span class="s3">\n    </span><span class="s1">uploadImgParamsWithUrl: boolean</span><span class="s3">\n    </span><span class="s1">uploadImgHeaders: DicType</span><span class="s3">\n    </span><span class="s1">uploadImgHooks: UploadImageHooksType</span><span class="s3">\n    </span><span class="s1">uploadImgTimeout: number</span><span class="s3">\n    </span><span class="s1">withCredentials: boolean</span><span class="s3">\n    </span><span class="s1">customUploadImg: Function | null</span><span class="s3">\n    </span><span class="s1">uploadImgFromMedia: Function | null</span><span class="s3">\n    </span><span class="s1">customAlert: Function</span><span class="s3">\n\n    </span><span class="s1">onCatalogChange: Function | null</span><span class="s3">\n\n    </span><span class="s1">lang: string</span><span class="s3">\n    </span><span class="s1">languages: typeof langConfig</span><span class="s3">\n\n    </span><span class="s1">linkCheck: Function</span><span class="s3">\n    </span><span class="s1">linkImgCheck: Function</span><span class="s3">\n    </span><span class="s1">compatibleMode: () =&gt; boolean</span><span class="s3">\n    </span><span class="s1">historyMaxSize: number</span><span class="s3">\n\n    </span><span class="s1">focus: boolean</span><span class="s3">\n\n    </span><span class="s1">onlineVideoCheck: Function</span><span class="s3">\n    </span><span class="s1">onlineVideoCallback: Function</span><span class="s3">\n\n    </span><span class="s1">showLinkVideo: Boolean</span><span class="s3">\n    </span><span class="s1">uploadVideoAccept: string[]</span><span class="s3">\n    </span><span class="s1">uploadVideoServer: string</span><span class="s3">\n    </span><span class="s1">uploadVideoMaxSize: number</span><span class="s3">\n    </span><span class="s1">uploadVideoName: string</span><span class="s3">\n    </span><span class="s1">uploadVideoParams: DicType</span><span class="s3">\n    </span><span class="s1">uploadVideoParamsWithUrl: boolean</span><span class="s3">\n    </span><span class="s1">uploadVideoHeaders: DicType</span><span class="s3">\n    </span><span class="s1">uploadVideoHooks: UploadVideoHooksType</span><span class="s3">\n    </span><span class="s1">uploadVideoTimeout: number</span><span class="s3">\n    </span><span class="s1">withVideoCredentials: boolean</span><span class="s3">\n    </span><span class="s1">customUploadVideo: Function | null</span><span class="s3">\n    </span><span class="s1">customInsertVideo: Function | null</span><span class="s3">\n\n    </span><span class="s1">menuTooltipPosition: tooltipPositionType</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export type Resource = {</span><span class="s3">\n    </span><span class="s1">[language: string]: ResourceLanguage</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export type ResourceLanguage = {</span><span class="s3">\n    </span><span class="s1">[namespace: string]: ResourceKey</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export type ResourceKey =</span><span class="s3">\n    </span><span class="s1">| string</span><span class="s3">\n    </span><span class="s1">| {</span><span class="s3">\n          </span><span class="s1">[key: string]: any</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// 合并所有的配置信息</span><span class="s3">\n</span><span class="s1">const defaultConfig = Object.assign(</span><span class="s3">\n    </span><span class="s1">{},</span><span class="s3">\n    </span><span class="s1">menusConfig,</span><span class="s3">\n    </span><span class="s1">eventsConfig,</span><span class="s3">\n    </span><span class="s1">styleConfig,</span><span class="s3">\n    </span><span class="s1">cmdConfig,</span><span class="s3">\n    </span><span class="s1">pasteConfig,</span><span class="s3">\n    </span><span class="s1">imageConfig,</span><span class="s3">\n    </span><span class="s1">textConfig,</span><span class="s3">\n    </span><span class="s1">langConfig,</span><span class="s3">\n    </span><span class="s1">historyConfig,</span><span class="s3">\n    </span><span class="s1">videoConfig,</span><span class="s3">\n    </span><span class="s1">//链接校验的配置函数</span><span class="s3">\n    </span><span class="s1">{</span><span class="s3">\n        </span><span class="s1">linkCheck: function (text: string, link: string): string | boolean {</span><span class="s3">\n            </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">)</span><span class="s3">\n\n</span><span class="s1">export default defaultConfig</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/object/assign');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.object.assign');</span><span class="s3">\n</span><span class="s1">var path = require('../../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.Object.assign;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var assign = require('../internals/object-assign');</span><span class="s3">\n\n</span><span class="s1">// `Object.assign` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.assign</span><span class="s3">\n</span><span class="s1">$({ target: 'Object', stat: true, forced: Object.assign !== assign }, {</span><span class="s3">\n  </span><span class="s1">assign: assign</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var DESCRIPTORS = require('../internals/descriptors');</span><span class="s3">\n</span><span class="s1">var fails = require('../internals/fails');</span><span class="s3">\n</span><span class="s1">var objectKeys = require('../internals/object-keys');</span><span class="s3">\n</span><span class="s1">var getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');</span><span class="s3">\n</span><span class="s1">var propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');</span><span class="s3">\n</span><span class="s1">var toObject = require('../internals/to-object');</span><span class="s3">\n</span><span class="s1">var IndexedObject = require('../internals/indexed-object');</span><span class="s3">\n\n</span><span class="s1">var nativeAssign = Object.assign;</span><span class="s3">\n</span><span class="s1">var defineProperty = Object.defineProperty;</span><span class="s3">\n\n</span><span class="s1">// `Object.assign` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.assign</span><span class="s3">\n</span><span class="s1">module.exports = !nativeAssign || fails(function () {</span><span class="s3">\n  </span><span class="s1">// should have correct order of operations (Edge bug)</span><span class="s3">\n  </span><span class="s1">if (DESCRIPTORS &amp;&amp; nativeAssign({ b: 1 }, nativeAssign(defineProperty({}, 'a', {</span><span class="s3">\n    </span><span class="s1">enumerable: true,</span><span class="s3">\n    </span><span class="s1">get: function () {</span><span class="s3">\n      </span><span class="s1">defineProperty(this, 'b', {</span><span class="s3">\n        </span><span class="s1">value: 3,</span><span class="s3">\n        </span><span class="s1">enumerable: false</span><span class="s3">\n      </span><span class="s1">});</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}), { b: 2 })).b !== 1) return true;</span><span class="s3">\n  </span><span class="s1">// should work with symbols and should have deterministic property order (V8 bug)</span><span class="s3">\n  </span><span class="s1">var A = {};</span><span class="s3">\n  </span><span class="s1">var B = {};</span><span class="s3">\n  </span><span class="s1">// eslint-disable-next-line no-undef</span><span class="s3">\n  </span><span class="s1">var symbol = Symbol();</span><span class="s3">\n  </span><span class="s1">var alphabet = 'abcdefghijklmnopqrst';</span><span class="s3">\n  </span><span class="s1">A[symbol] = 7;</span><span class="s3">\n  </span><span class="s1">alphabet.split('').forEach(function (chr) { B[chr] = chr; });</span><span class="s3">\n  </span><span class="s1">return nativeAssign({}, A)[symbol] != 7 || objectKeys(nativeAssign({}, B)).join('') != alphabet;</span><span class="s3">\n</span><span class="s1">}) ? function assign(target, source) { // eslint-disable-line no-unused-vars</span><span class="s3">\n  </span><span class="s1">var T = toObject(target);</span><span class="s3">\n  </span><span class="s1">var argumentsLength = arguments.length;</span><span class="s3">\n  </span><span class="s1">var index = 1;</span><span class="s3">\n  </span><span class="s1">var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;</span><span class="s3">\n  </span><span class="s1">var propertyIsEnumerable = propertyIsEnumerableModule.f;</span><span class="s3">\n  </span><span class="s1">while (argumentsLength &gt; index) {</span><span class="s3">\n    </span><span class="s1">var S = IndexedObject(arguments[index++]);</span><span class="s3">\n    </span><span class="s1">var keys = getOwnPropertySymbols ? objectKeys(S).concat(getOwnPropertySymbols(S)) : objectKeys(S);</span><span class="s3">\n    </span><span class="s1">var length = keys.length;</span><span class="s3">\n    </span><span class="s1">var j = 0;</span><span class="s3">\n    </span><span class="s1">var key;</span><span class="s3">\n    </span><span class="s1">while (length &gt; j) {</span><span class="s3">\n      </span><span class="s1">key = keys[j++];</span><span class="s3">\n      </span><span class="s1">if (!DESCRIPTORS || propertyIsEnumerable.call(S, key)) T[key] = S[key];</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">} return T;</span><span class="s3">\n</span><span class="s1">} : nativeAssign;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 菜单配置</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">// 表情菜单数据结构类型</span><span class="s3">\n</span><span class="s1">export type EmotionsContentType = {</span><span class="s3">\n    </span><span class="s1">alt: string</span><span class="s3">\n    </span><span class="s1">src: string</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">export type EmotionsType = {</span><span class="s3">\n    </span><span class="s1">title: string</span><span class="s3">\n    </span><span class="s1">type: string</span><span class="s3">\n    </span><span class="s1">content: Array&lt;EmotionsContentType | string&gt;</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// font-size 类型</span><span class="s3">\n</span><span class="s1">export type FontSizeConfType = {</span><span class="s3">\n    </span><span class="s1">[key: string]: {</span><span class="s3">\n        </span><span class="s1">name: string</span><span class="s3">\n        </span><span class="s1">value: string</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// liuWei 2020-04-17 对于字体增加扩展类型</span><span class="s3">\n</span><span class="s1">// font-style 类型</span><span class="s3">\n</span><span class="s1">export type FontStyleType = Array&lt;</span><span class="s3">\n    </span><span class="s1">| {</span><span class="s3">\n          </span><span class="s1">name: string</span><span class="s3">\n          </span><span class="s1">value: string</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">| string</span><span class="s3">\n</span><span class="s1">&gt;</span><span class="s3">\n\n</span><span class="s1">// indent</span><span class="s3">\n</span><span class="s1">export interface IndentationOptions {</span><span class="s3">\n    </span><span class="s1">value: number</span><span class="s3">\n    </span><span class="s1">unit: string</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">export type IndentationType = string | IndentationOptions</span><span class="s3">\n\n</span><span class="s1">// tooltip-position类型</span><span class="s3">\n</span><span class="s1">export type tooltipPositionType = 'up' | 'down'</span><span class="s3">\n\n</span><span class="s1">/*表情菜单数据结构类型END*/</span><span class="s3">\n</span><span class="s1">export default {</span><span class="s3">\n    </span><span class="s1">menus: [</span><span class="s3">\n        </span><span class="s1">'head',</span><span class="s3">\n        </span><span class="s1">'bold',</span><span class="s3">\n        </span><span class="s1">'fontSize',</span><span class="s3">\n        </span><span class="s1">// 'customFontSize',</span><span class="s3">\n        </span><span class="s1">'fontName',</span><span class="s3">\n        </span><span class="s1">'italic',</span><span class="s3">\n        </span><span class="s1">'underline',</span><span class="s3">\n        </span><span class="s1">'strikeThrough',</span><span class="s3">\n        </span><span class="s1">'indent',</span><span class="s3">\n        </span><span class="s1">'lineHeight',</span><span class="s3">\n        </span><span class="s1">'foreColor',</span><span class="s3">\n        </span><span class="s1">'backColor',</span><span class="s3">\n        </span><span class="s1">'link',</span><span class="s3">\n        </span><span class="s1">'list',</span><span class="s3">\n        </span><span class="s1">'todo',</span><span class="s3">\n        </span><span class="s1">'justify',</span><span class="s3">\n        </span><span class="s1">'quote',</span><span class="s3">\n        </span><span class="s1">'emoticon',</span><span class="s3">\n        </span><span class="s1">'image',</span><span class="s3">\n        </span><span class="s1">'video',</span><span class="s3">\n        </span><span class="s1">'table',</span><span class="s3">\n        </span><span class="s1">'code',</span><span class="s3">\n        </span><span class="s1">'splitLine',</span><span class="s3">\n        </span><span class="s1">'undo',</span><span class="s3">\n        </span><span class="s1">'redo',</span><span class="s3">\n    </span><span class="s1">],</span><span class="s3">\n\n    </span><span class="s1">fontNames: [</span><span class="s3">\n        </span><span class="s1">'黑体',</span><span class="s3">\n        </span><span class="s1">'仿宋',</span><span class="s3">\n        </span><span class="s1">'楷体',</span><span class="s3">\n        </span><span class="s1">'标楷体',</span><span class="s3">\n        </span><span class="s1">'华文仿宋',</span><span class="s3">\n        </span><span class="s1">'华文楷体',</span><span class="s3">\n        </span><span class="s1">'宋体',</span><span class="s3">\n        </span><span class="s1">'微软雅黑',</span><span class="s3">\n        </span><span class="s1">'Arial',</span><span class="s3">\n        </span><span class="s1">'Tahoma',</span><span class="s3">\n        </span><span class="s1">'Verdana',</span><span class="s3">\n        </span><span class="s1">'Times New Roman',</span><span class="s3">\n        </span><span class="s1">'Courier New',</span><span class="s3">\n    </span><span class="s1">],</span><span class="s3">\n    </span><span class="s1">//  fontNames: [{ name: '宋体', value: '宋体' }],</span><span class="s3">\n\n    </span><span class="s1">fontSizes: {</span><span class="s3">\n        </span><span class="s1">'x-small': {</span><span class="s3">\n            </span><span class="s1">name: '10px',</span><span class="s3">\n            </span><span class="s1">value: '1',</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">small: {</span><span class="s3">\n            </span><span class="s1">name: '13px',</span><span class="s3">\n            </span><span class="s1">value: '2',</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">normal: {</span><span class="s3">\n            </span><span class="s1">name: '16px',</span><span class="s3">\n            </span><span class="s1">value: '3',</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">large: {</span><span class="s3">\n            </span><span class="s1">name: '18px',</span><span class="s3">\n            </span><span class="s1">value: '4',</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">'x-large': {</span><span class="s3">\n            </span><span class="s1">name: '24px',</span><span class="s3">\n            </span><span class="s1">value: '5',</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">'xx-large': {</span><span class="s3">\n            </span><span class="s1">name: '32px',</span><span class="s3">\n            </span><span class="s1">value: '6',</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">'xxx-large': {</span><span class="s3">\n            </span><span class="s1">name: '48px',</span><span class="s3">\n            </span><span class="s1">value: '7',</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n\n    </span><span class="s1">// customFontSize: [ // 该菜单暂时不用 - 王福朋 20200924</span><span class="s3">\n    </span><span class="s1">//     { value: '9px', text: '9' },</span><span class="s3">\n    </span><span class="s1">//     { value: '10px', text: '10' },</span><span class="s3">\n    </span><span class="s1">//     { value: '12px', text: '12' },</span><span class="s3">\n    </span><span class="s1">//     { value: '14px', text: '14' },</span><span class="s3">\n    </span><span class="s1">//     { value: '16px', text: '16' },</span><span class="s3">\n    </span><span class="s1">//     { value: '20px', text: '20' },</span><span class="s3">\n    </span><span class="s1">//     { value: '42px', text: '42' },</span><span class="s3">\n    </span><span class="s1">//     { value: '72px', text: '72' },</span><span class="s3">\n    </span><span class="s1">// ],</span><span class="s3">\n\n    </span><span class="s1">colors: [</span><span class="s3">\n        </span><span class="s1">'#000000',</span><span class="s3">\n        </span><span class="s1">'#ffffff',</span><span class="s3">\n        </span><span class="s1">'#eeece0',</span><span class="s3">\n        </span><span class="s1">'#1c487f',</span><span class="s3">\n        </span><span class="s1">'#4d80bf',</span><span class="s3">\n        </span><span class="s1">'#c24f4a',</span><span class="s3">\n        </span><span class="s1">'#8baa4a',</span><span class="s3">\n        </span><span class="s1">'#7b5ba1',</span><span class="s3">\n        </span><span class="s1">'#46acc8',</span><span class="s3">\n        </span><span class="s1">'#f9963b',</span><span class="s3">\n    </span><span class="s1">],</span><span class="s3">\n\n    </span><span class="s1">//插入代码语言配置</span><span class="s3">\n    </span><span class="s1">languageType: [</span><span class="s3">\n        </span><span class="s1">'Bash',</span><span class="s3">\n        </span><span class="s1">'C',</span><span class="s3">\n        </span><span class="s1">'C#',</span><span class="s3">\n        </span><span class="s1">'C++',</span><span class="s3">\n        </span><span class="s1">'CSS',</span><span class="s3">\n        </span><span class="s1">'Java',</span><span class="s3">\n        </span><span class="s1">'JavaScript',</span><span class="s3">\n        </span><span class="s1">'JSON',</span><span class="s3">\n        </span><span class="s1">'TypeScript',</span><span class="s3">\n        </span><span class="s1">'Plain text',</span><span class="s3">\n        </span><span class="s1">'Html',</span><span class="s3">\n        </span><span class="s1">'XML',</span><span class="s3">\n        </span><span class="s1">'SQL',</span><span class="s3">\n        </span><span class="s1">'Go',</span><span class="s3">\n        </span><span class="s1">'Kotlin',</span><span class="s3">\n        </span><span class="s1">'Lua',</span><span class="s3">\n        </span><span class="s1">'Markdown',</span><span class="s3">\n        </span><span class="s1">'PHP',</span><span class="s3">\n        </span><span class="s1">'Python',</span><span class="s3">\n        </span><span class="s1">'Shell Session',</span><span class="s3">\n        </span><span class="s1">'Ruby',</span><span class="s3">\n    </span><span class="s1">],</span><span class="s3">\n\n    </span><span class="s1">languageTab: '　　　　',</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 表情配置菜单</span><span class="s3">\n     </span><span class="s1">* 如果为emoji表情直接作为元素插入</span><span class="s3">\n     </span><span class="s1">* emoticon:Array&lt;EmotionsType&gt;</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">emotions: [</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">// tab 的标题</span><span class="s3">\n            </span><span class="s1">title: '表情',</span><span class="s3">\n            </span><span class="s1">// type -&gt; 'emoji' / 'image'</span><span class="s3">\n            </span><span class="s1">type: 'emoji',</span><span class="s3">\n            </span><span class="s1">// content -&gt; 数组</span><span class="s3">\n            </span><span class="s1">content: '😀 😃 😄 😁 😆 😅 😂 🤣 😊 😇 🙂 🙃 😉 😌 😍 😘 😗 😙 😚 😋 😛 😝 😜 🤓 😎 😏 😒 😞 😔 😟 😕 🙁 😣 😖 😫 😩 😢 😭 😤 😠 😡 😳 😱 😨 🤗 🤔 😶 😑 😬 🙄 😯 😴 😷 🤑 😈 🤡 💩 👻 💀 👀 👣'.split(</span><span class="s3">\n                </span><span class="s1">/</span><span class="s3">\\</span><span class="s1">s/</span><span class="s3">\n            </span><span class="s1">),</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">// tab 的标题</span><span class="s3">\n            </span><span class="s1">title: '手势',</span><span class="s3">\n            </span><span class="s1">// type -&gt; 'emoji' / 'image'</span><span class="s3">\n            </span><span class="s1">type: 'emoji',</span><span class="s3">\n            </span><span class="s1">// content -&gt; 数组</span><span class="s3">\n            </span><span class="s1">content: '👐 🙌 👏 🤝 👍 👎 👊 ✊ 🤛 🤜 🤞 ✌️ 🤘 👌 👈 👉 👆 👇 ☝️ ✋ 🤚 🖐 🖖 👋 🤙 💪 🖕 ✍️ 🙏'.split(</span><span class="s3">\n                </span><span class="s1">/</span><span class="s3">\\</span><span class="s1">s/</span><span class="s3">\n            </span><span class="s1">),</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">],</span><span class="s3">\n\n    </span><span class="s1">lineHeights: ['1', '1.15', '1.6', '2', '2.5', '3'],</span><span class="s3">\n\n    </span><span class="s1">undoLimit: 20,</span><span class="s3">\n\n    </span><span class="s1">indentation: '2em',</span><span class="s3">\n\n    </span><span class="s1">showMenuTooltips: true,</span><span class="s3">\n\n    </span><span class="s1">// 菜单栏tooltip为上标还是下标</span><span class="s3">\n    </span><span class="s1">menuTooltipPosition: 'up',</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 事件配置</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { EMPTY_FN } from '../utils/const'</span><span class="s3">\n\n</span><span class="s1">export type TCatalog = {</span><span class="s3">\n    </span><span class="s1">tag: string</span><span class="s3">\n    </span><span class="s1">id: string</span><span class="s3">\n    </span><span class="s1">text: string</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 提示信息</span><span class="s3">\n </span><span class="s1">* @param alertInfo alert info</span><span class="s3">\n </span><span class="s1">* @param alertType 错误提示类型</span><span class="s3">\n </span><span class="s1">* @param debugInfo debug info</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function customAlert(alertInfo: string, alertType: string, debugInfo?: string): void {</span><span class="s3">\n    </span><span class="s1">window.alert(alertInfo)</span><span class="s3">\n    </span><span class="s1">if (debugInfo) {</span><span class="s3">\n        </span><span class="s1">console.error('wangEditor: ' + debugInfo)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default {</span><span class="s3">\n    </span><span class="s1">onchangeTimeout: 200,</span><span class="s3">\n\n    </span><span class="s1">onchange: null,</span><span class="s3">\n    </span><span class="s1">onfocus: EMPTY_FN,</span><span class="s3">\n    </span><span class="s1">onblur: EMPTY_FN,</span><span class="s3">\n\n    </span><span class="s1">onCatalogChange: null,</span><span class="s3">\n    </span><span class="s1">customAlert,</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 粘贴，配置文件</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">export default {</span><span class="s3">\n    </span><span class="s1">// 粘贴过滤样式，默认开启</span><span class="s3">\n    </span><span class="s1">pasteFilterStyle: true,</span><span class="s3">\n\n    </span><span class="s1">// 粘贴内容时，忽略图片。默认关闭</span><span class="s3">\n    </span><span class="s1">pasteIgnoreImg: false,</span><span class="s3">\n\n    </span><span class="s1">// 对粘贴的文字进行自定义处理，返回处理后的结果。编辑器会将处理后的结果粘贴到编辑区域中。</span><span class="s3">\n    </span><span class="s1">// IE 暂时不支持</span><span class="s3">\n    </span><span class="s1">pasteTextHandle: function (content: string): string {</span><span class="s3">\n        </span><span class="s1">// content 即粘贴过来的内容（html 或 纯文本），可进行自定义处理然后返回</span><span class="s3">\n        </span><span class="s1">return content</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 命令配置项</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">export default {</span><span class="s3">\n    </span><span class="s1">styleWithCSS: false, // 默认 false</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 图片相关的配置</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../editor/index'</span><span class="s3">\n</span><span class="s1">import { EMPTY_FN } from '../utils/const'</span><span class="s3">\n</span><span class="s1">import { ResType } from '../menus/img/upload-img'</span><span class="s3">\n\n</span><span class="s1">export type UploadImageHooksType = {</span><span class="s3">\n    </span><span class="s1">before?: (</span><span class="s3">\n        </span><span class="s1">xhr: XMLHttpRequest,</span><span class="s3">\n        </span><span class="s1">editor: Editor,</span><span class="s3">\n        </span><span class="s1">files: File[]</span><span class="s3">\n    </span><span class="s1">) =&gt; { prevent: boolean; msg: string } | void</span><span class="s3">\n    </span><span class="s1">success?: (xhr: XMLHttpRequest, editor: Editor, result: ResType) =&gt; void</span><span class="s3">\n    </span><span class="s1">fail?: (xhr: XMLHttpRequest, editor: Editor, err: ResType | string) =&gt; void</span><span class="s3">\n    </span><span class="s1">error?: (xhr: XMLHttpRequest, editor: Editor) =&gt; void</span><span class="s3">\n    </span><span class="s1">timeout?: (xhr: XMLHttpRequest, editor: Editor) =&gt; void</span><span class="s3">\n    </span><span class="s1">customInsert?: (</span><span class="s3">\n        </span><span class="s1">inserImg: (this: Editor, src: string) =&gt; void,</span><span class="s3">\n        </span><span class="s1">result: ResType,</span><span class="s3">\n        </span><span class="s1">editor: Editor</span><span class="s3">\n    </span><span class="s1">) =&gt; void</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default {</span><span class="s3">\n    </span><span class="s1">// 网络图片校验的配置函数</span><span class="s3">\n    </span><span class="s1">linkImgCheck: function (src: string, alt?: string, href?: string): string | boolean {</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">// 显示“插入网络图片”</span><span class="s3">\n    </span><span class="s1">showLinkImg: true,</span><span class="s3">\n\n    </span><span class="s1">// 显示“插入图片alt”</span><span class="s3">\n    </span><span class="s1">showLinkImgAlt: true,</span><span class="s3">\n\n    </span><span class="s1">// 显示“插入图片href”</span><span class="s3">\n    </span><span class="s1">showLinkImgHref: true,</span><span class="s3">\n\n    </span><span class="s1">// 插入图片成功之后的回调函数</span><span class="s3">\n    </span><span class="s1">linkImgCallback: EMPTY_FN,</span><span class="s3">\n\n    </span><span class="s1">// accept</span><span class="s3">\n    </span><span class="s1">uploadImgAccept: ['jpg', 'jpeg', 'png', 'gif', 'bmp'],</span><span class="s3">\n\n    </span><span class="s1">// 服务端地址</span><span class="s3">\n    </span><span class="s1">uploadImgServer: '',</span><span class="s3">\n\n    </span><span class="s1">// 使用 base64 存储图片</span><span class="s3">\n    </span><span class="s1">uploadImgShowBase64: false,</span><span class="s3">\n\n    </span><span class="s1">// 上传图片的最大体积，默认 5M</span><span class="s3">\n    </span><span class="s1">uploadImgMaxSize: 5 * 1024 * 1024,</span><span class="s3">\n\n    </span><span class="s1">// 一次最多上传多少个图片</span><span class="s3">\n    </span><span class="s1">uploadImgMaxLength: 100,</span><span class="s3">\n\n    </span><span class="s1">// 自定义上传图片的名称</span><span class="s3">\n    </span><span class="s1">uploadFileName: '',</span><span class="s3">\n\n    </span><span class="s1">// 上传图片自定义参数</span><span class="s3">\n    </span><span class="s1">uploadImgParams: {},</span><span class="s3">\n\n    </span><span class="s1">// 自定义参数拼接到 url 中</span><span class="s3">\n    </span><span class="s1">uploadImgParamsWithUrl: false,</span><span class="s3">\n\n    </span><span class="s1">// 上传图片自定义 header</span><span class="s3">\n    </span><span class="s1">uploadImgHeaders: {},</span><span class="s3">\n\n    </span><span class="s1">// 钩子函数</span><span class="s3">\n    </span><span class="s1">uploadImgHooks: {},</span><span class="s3">\n\n    </span><span class="s1">// 上传图片超时时间 ms</span><span class="s3">\n    </span><span class="s1">uploadImgTimeout: 10 * 1000,</span><span class="s3">\n\n    </span><span class="s1">// 跨域带 cookie</span><span class="s3">\n    </span><span class="s1">withCredentials: false,</span><span class="s3">\n\n    </span><span class="s1">// 自定义上传</span><span class="s3">\n    </span><span class="s1">customUploadImg: null,</span><span class="s3">\n\n    </span><span class="s1">// 从媒体库上传</span><span class="s3">\n    </span><span class="s1">uploadImgFromMedia: null,</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;export default {</span><span class="s3">\n    </span><span class="s1">lang: 'zh-CN',</span><span class="s3">\n    </span><span class="s1">languages: {</span><span class="s3">\n        </span><span class="s1">'zh-CN': {</span><span class="s3">\n            </span><span class="s1">wangEditor: {</span><span class="s3">\n                </span><span class="s1">重置: '重置',</span><span class="s3">\n                </span><span class="s1">插入: '插入',</span><span class="s3">\n                </span><span class="s1">默认: '默认',</span><span class="s3">\n                </span><span class="s1">创建: '创建',</span><span class="s3">\n                </span><span class="s1">修改: '修改',</span><span class="s3">\n                </span><span class="s1">如: '如',</span><span class="s3">\n                </span><span class="s1">请输入正文: '请输入正文',</span><span class="s3">\n                </span><span class="s1">menus: {</span><span class="s3">\n                    </span><span class="s1">title: {</span><span class="s3">\n                        </span><span class="s1">标题: '标题',</span><span class="s3">\n                        </span><span class="s1">加粗: '加粗',</span><span class="s3">\n                        </span><span class="s1">字号: '字号',</span><span class="s3">\n                        </span><span class="s1">字体: '字体',</span><span class="s3">\n                        </span><span class="s1">斜体: '斜体',</span><span class="s3">\n                        </span><span class="s1">下划线: '下划线',</span><span class="s3">\n                        </span><span class="s1">删除线: '删除线',</span><span class="s3">\n                        </span><span class="s1">缩进: '缩进',</span><span class="s3">\n                        </span><span class="s1">行高: '行高',</span><span class="s3">\n                        </span><span class="s1">文字颜色: '文字颜色',</span><span class="s3">\n                        </span><span class="s1">背景色: '背景色',</span><span class="s3">\n                        </span><span class="s1">链接: '链接',</span><span class="s3">\n                        </span><span class="s1">序列: '序列',</span><span class="s3">\n                        </span><span class="s1">对齐: '对齐',</span><span class="s3">\n                        </span><span class="s1">引用: '引用',</span><span class="s3">\n                        </span><span class="s1">表情: '表情',</span><span class="s3">\n                        </span><span class="s1">图片: '图片',</span><span class="s3">\n                        </span><span class="s1">视频: '视频',</span><span class="s3">\n                        </span><span class="s1">表格: '表格',</span><span class="s3">\n                        </span><span class="s1">代码: '代码',</span><span class="s3">\n                        </span><span class="s1">分割线: '分割线',</span><span class="s3">\n                        </span><span class="s1">恢复: '恢复',</span><span class="s3">\n                        </span><span class="s1">撤销: '撤销',</span><span class="s3">\n                        </span><span class="s1">全屏: '全屏',</span><span class="s3">\n                        </span><span class="s1">取消全屏: '取消全屏',</span><span class="s3">\n                        </span><span class="s1">待办事项: '待办事项',</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">dropListMenu: {</span><span class="s3">\n                        </span><span class="s1">设置标题: '设置标题',</span><span class="s3">\n                        </span><span class="s1">背景颜色: '背景颜色',</span><span class="s3">\n                        </span><span class="s1">文字颜色: '文字颜色',</span><span class="s3">\n                        </span><span class="s1">设置字号: '设置字号',</span><span class="s3">\n                        </span><span class="s1">设置字体: '设置字体',</span><span class="s3">\n                        </span><span class="s1">设置缩进: '设置缩进',</span><span class="s3">\n                        </span><span class="s1">对齐方式: '对齐方式',</span><span class="s3">\n                        </span><span class="s1">设置行高: '设置行高',</span><span class="s3">\n                        </span><span class="s1">序列: '序列',</span><span class="s3">\n                        </span><span class="s1">head: {</span><span class="s3">\n                            </span><span class="s1">正文: '正文',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">indent: {</span><span class="s3">\n                            </span><span class="s1">增加缩进: '增加缩进',</span><span class="s3">\n                            </span><span class="s1">减少缩进: '减少缩进',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">justify: {</span><span class="s3">\n                            </span><span class="s1">靠左: '靠左',</span><span class="s3">\n                            </span><span class="s1">居中: '居中',</span><span class="s3">\n                            </span><span class="s1">靠右: '靠右',</span><span class="s3">\n                            </span><span class="s1">两端: '两端',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">list: {</span><span class="s3">\n                            </span><span class="s1">无序列表: '无序列表',</span><span class="s3">\n                            </span><span class="s1">有序列表: '有序列表',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">panelMenus: {</span><span class="s3">\n                        </span><span class="s1">emoticon: {</span><span class="s3">\n                            </span><span class="s1">默认: '默认',</span><span class="s3">\n                            </span><span class="s1">新浪: '新浪',</span><span class="s3">\n                            </span><span class="s1">emoji: 'emoji',</span><span class="s3">\n                            </span><span class="s1">手势: '手势',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">image: {</span><span class="s3">\n                            </span><span class="s1">上传图片: '上传图片',</span><span class="s3">\n                            </span><span class="s1">网络图片: '网络图片',</span><span class="s3">\n                            </span><span class="s1">图片地址: '图片地址',</span><span class="s3">\n                            </span><span class="s1">图片文字说明: '图片文字说明',</span><span class="s3">\n                            </span><span class="s1">跳转链接: '跳转链接',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">link: {</span><span class="s3">\n                            </span><span class="s1">链接: '链接',</span><span class="s3">\n                            </span><span class="s1">链接文字: '链接文字',</span><span class="s3">\n                            </span><span class="s1">取消链接: '取消链接',</span><span class="s3">\n                            </span><span class="s1">查看链接: '查看链接',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">video: {</span><span class="s3">\n                            </span><span class="s1">插入视频: '插入视频',</span><span class="s3">\n                            </span><span class="s1">上传视频: '上传视频',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">table: {</span><span class="s3">\n                            </span><span class="s1">行: '行',</span><span class="s3">\n                            </span><span class="s1">列: '列',</span><span class="s3">\n                            </span><span class="s1">的: '的',</span><span class="s3">\n                            </span><span class="s1">表格: '表格',</span><span class="s3">\n                            </span><span class="s1">添加行: '添加行',</span><span class="s3">\n                            </span><span class="s1">删除行: '删除行',</span><span class="s3">\n                            </span><span class="s1">添加列: '添加列',</span><span class="s3">\n                            </span><span class="s1">删除列: '删除列',</span><span class="s3">\n                            </span><span class="s1">设置表头: '设置表头',</span><span class="s3">\n                            </span><span class="s1">取消表头: '取消表头',</span><span class="s3">\n                            </span><span class="s1">插入表格: '插入表格',</span><span class="s3">\n                            </span><span class="s1">删除表格: '删除表格',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">code: {</span><span class="s3">\n                            </span><span class="s1">删除代码: '删除代码',</span><span class="s3">\n                            </span><span class="s1">修改代码: '修改代码',</span><span class="s3">\n                            </span><span class="s1">插入代码: '插入代码',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">validate: {</span><span class="s3">\n                    </span><span class="s1">张图片: '张图片',</span><span class="s3">\n                    </span><span class="s1">大于: '大于',</span><span class="s3">\n                    </span><span class="s1">图片链接: '图片链接',</span><span class="s3">\n                    </span><span class="s1">不是图片: '不是图片',</span><span class="s3">\n                    </span><span class="s1">返回结果: '返回结果',</span><span class="s3">\n                    </span><span class="s1">上传图片超时: '上传图片超时',</span><span class="s3">\n                    </span><span class="s1">上传图片错误: '上传图片错误',</span><span class="s3">\n                    </span><span class="s1">上传图片失败: '上传图片失败',</span><span class="s3">\n                    </span><span class="s1">插入图片错误: '插入图片错误',</span><span class="s3">\n                    </span><span class="s1">一次最多上传: '一次最多上传',</span><span class="s3">\n                    </span><span class="s1">下载链接失败: '下载链接失败',</span><span class="s3">\n                    </span><span class="s1">图片验证未通过: '图片验证未通过',</span><span class="s3">\n                    </span><span class="s1">服务器返回状态: '服务器返回状态',</span><span class="s3">\n                    </span><span class="s1">上传图片返回结果错误: '上传图片返回结果错误',</span><span class="s3">\n                    </span><span class="s1">请替换为支持的图片类型: '请替换为支持的图片类型',</span><span class="s3">\n                    </span><span class="s1">您插入的网络图片无法识别: '您插入的网络图片无法识别',</span><span class="s3">\n                    </span><span class="s1">您刚才插入的图片链接未通过编辑器校验: '您刚才插入的图片链接未通过编辑器校验',</span><span class="s3">\n                    </span><span class="s1">插入视频错误: '插入视频错误',</span><span class="s3">\n                    </span><span class="s1">视频链接: '视频链接',</span><span class="s3">\n                    </span><span class="s1">不是视频: '不是视频',</span><span class="s3">\n                    </span><span class="s1">视频验证未通过: '视频验证未通过',</span><span class="s3">\n                    </span><span class="s1">个视频: '个视频',</span><span class="s3">\n                    </span><span class="s1">上传视频超时: '上传视频超时',</span><span class="s3">\n                    </span><span class="s1">上传视频错误: '上传视频错误',</span><span class="s3">\n                    </span><span class="s1">上传视频失败: '上传视频失败',</span><span class="s3">\n                    </span><span class="s1">上传视频返回结果错误: '上传视频返回结果错误',</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">en: {</span><span class="s3">\n            </span><span class="s1">wangEditor: {</span><span class="s3">\n                </span><span class="s1">重置: 'reset',</span><span class="s3">\n                </span><span class="s1">插入: 'insert',</span><span class="s3">\n                </span><span class="s1">默认: 'default',</span><span class="s3">\n                </span><span class="s1">创建: 'create',</span><span class="s3">\n                </span><span class="s1">修改: 'edit',</span><span class="s3">\n                </span><span class="s1">如: 'like',</span><span class="s3">\n                </span><span class="s1">请输入正文: 'please enter the text',</span><span class="s3">\n                </span><span class="s1">menus: {</span><span class="s3">\n                    </span><span class="s1">title: {</span><span class="s3">\n                        </span><span class="s1">标题: 'head',</span><span class="s3">\n                        </span><span class="s1">加粗: 'bold',</span><span class="s3">\n                        </span><span class="s1">字号: 'font size',</span><span class="s3">\n                        </span><span class="s1">字体: 'font family',</span><span class="s3">\n                        </span><span class="s1">斜体: 'italic',</span><span class="s3">\n                        </span><span class="s1">下划线: 'underline',</span><span class="s3">\n                        </span><span class="s1">删除线: 'strikethrough',</span><span class="s3">\n                        </span><span class="s1">缩进: 'indent',</span><span class="s3">\n                        </span><span class="s1">行高: 'line heihgt',</span><span class="s3">\n                        </span><span class="s1">文字颜色: 'font color',</span><span class="s3">\n                        </span><span class="s1">背景色: 'background',</span><span class="s3">\n                        </span><span class="s1">链接: 'link',</span><span class="s3">\n                        </span><span class="s1">序列: 'numbered list',</span><span class="s3">\n                        </span><span class="s1">对齐: 'align',</span><span class="s3">\n                        </span><span class="s1">引用: 'quote',</span><span class="s3">\n                        </span><span class="s1">表情: 'emoticons',</span><span class="s3">\n                        </span><span class="s1">图片: 'image',</span><span class="s3">\n                        </span><span class="s1">视频: 'media',</span><span class="s3">\n                        </span><span class="s1">表格: 'table',</span><span class="s3">\n                        </span><span class="s1">代码: 'code',</span><span class="s3">\n                        </span><span class="s1">分割线: 'split line',</span><span class="s3">\n                        </span><span class="s1">恢复: 'redo',</span><span class="s3">\n                        </span><span class="s1">撤销: 'undo',</span><span class="s3">\n                        </span><span class="s1">全屏: 'fullscreen',</span><span class="s3">\n                        </span><span class="s1">取消全屏: 'cancel fullscreen',</span><span class="s3">\n                        </span><span class="s1">待办事项: 'todo',</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">dropListMenu: {</span><span class="s3">\n                        </span><span class="s1">设置标题: 'title',</span><span class="s3">\n                        </span><span class="s1">背景颜色: 'background',</span><span class="s3">\n                        </span><span class="s1">文字颜色: 'font color',</span><span class="s3">\n                        </span><span class="s1">设置字号: 'font size',</span><span class="s3">\n                        </span><span class="s1">设置字体: 'font family',</span><span class="s3">\n                        </span><span class="s1">设置缩进: 'indent',</span><span class="s3">\n                        </span><span class="s1">对齐方式: 'align',</span><span class="s3">\n                        </span><span class="s1">设置行高: 'line heihgt',</span><span class="s3">\n                        </span><span class="s1">序列: 'list',</span><span class="s3">\n                        </span><span class="s1">head: {</span><span class="s3">\n                            </span><span class="s1">正文: 'text',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">indent: {</span><span class="s3">\n                            </span><span class="s1">增加缩进: 'indent',</span><span class="s3">\n                            </span><span class="s1">减少缩进: 'outdent',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">justify: {</span><span class="s3">\n                            </span><span class="s1">靠左: 'left',</span><span class="s3">\n                            </span><span class="s1">居中: 'center',</span><span class="s3">\n                            </span><span class="s1">靠右: 'right',</span><span class="s3">\n                            </span><span class="s1">两端: 'justify',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">list: {</span><span class="s3">\n                            </span><span class="s1">无序列表: 'unordered',</span><span class="s3">\n                            </span><span class="s1">有序列表: 'ordered',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">panelMenus: {</span><span class="s3">\n                        </span><span class="s1">emoticon: {</span><span class="s3">\n                            </span><span class="s1">表情: 'emoji',</span><span class="s3">\n                            </span><span class="s1">手势: 'gesture',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">image: {</span><span class="s3">\n                            </span><span class="s1">上传图片: 'upload image',</span><span class="s3">\n                            </span><span class="s1">网络图片: 'network image',</span><span class="s3">\n                            </span><span class="s1">图片地址: 'image link',</span><span class="s3">\n                            </span><span class="s1">图片文字说明: 'image alt',</span><span class="s3">\n                            </span><span class="s1">跳转链接: 'hyperlink',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">link: {</span><span class="s3">\n                            </span><span class="s1">链接: 'link',</span><span class="s3">\n                            </span><span class="s1">链接文字: 'link text',</span><span class="s3">\n                            </span><span class="s1">取消链接: 'unlink',</span><span class="s3">\n                            </span><span class="s1">查看链接: 'view links',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">video: {</span><span class="s3">\n                            </span><span class="s1">插入视频: 'insert video',</span><span class="s3">\n                            </span><span class="s1">上传视频: 'upload local video',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">table: {</span><span class="s3">\n                            </span><span class="s1">行: 'rows',</span><span class="s3">\n                            </span><span class="s1">列: 'columns',</span><span class="s3">\n                            </span><span class="s1">的: ' ',</span><span class="s3">\n                            </span><span class="s1">表格: 'table',</span><span class="s3">\n                            </span><span class="s1">添加行: 'insert row',</span><span class="s3">\n                            </span><span class="s1">删除行: 'delete row',</span><span class="s3">\n                            </span><span class="s1">添加列: 'insert column',</span><span class="s3">\n                            </span><span class="s1">删除列: 'delete column',</span><span class="s3">\n                            </span><span class="s1">设置表头: 'set header',</span><span class="s3">\n                            </span><span class="s1">取消表头: 'cancel header',</span><span class="s3">\n                            </span><span class="s1">插入表格: 'insert table',</span><span class="s3">\n                            </span><span class="s1">删除表格: 'delete table',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">code: {</span><span class="s3">\n                            </span><span class="s1">删除代码: 'delete code',</span><span class="s3">\n                            </span><span class="s1">修改代码: 'edit code',</span><span class="s3">\n                            </span><span class="s1">插入代码: 'insert code',</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">validate: {</span><span class="s3">\n                    </span><span class="s1">张图片: 'images',</span><span class="s3">\n                    </span><span class="s1">大于: 'greater than',</span><span class="s3">\n                    </span><span class="s1">图片链接: 'image link',</span><span class="s3">\n                    </span><span class="s1">不是图片: 'is not image',</span><span class="s3">\n                    </span><span class="s1">返回结果: 'return results',</span><span class="s3">\n                    </span><span class="s1">上传图片超时: 'upload image timeout',</span><span class="s3">\n                    </span><span class="s1">上传图片错误: 'upload image error',</span><span class="s3">\n                    </span><span class="s1">上传图片失败: 'upload image failed',</span><span class="s3">\n                    </span><span class="s1">插入图片错误: 'insert image error',</span><span class="s3">\n                    </span><span class="s1">一次最多上传: 'once most at upload',</span><span class="s3">\n                    </span><span class="s1">下载链接失败: 'download link failed',</span><span class="s3">\n                    </span><span class="s1">图片验证未通过: 'image validate failed',</span><span class="s3">\n                    </span><span class="s1">服务器返回状态: 'server return status',</span><span class="s3">\n                    </span><span class="s1">上传图片返回结果错误: 'upload image return results error',</span><span class="s3">\n                    </span><span class="s1">请替换为支持的图片类型: 'please replace with a supported image type',</span><span class="s3">\n                    </span><span class="s1">您插入的网络图片无法识别: 'the network picture you inserted is not recognized',</span><span class="s3">\n                    </span><span class="s1">您刚才插入的图片链接未通过编辑器校验:</span><span class="s3">\n                        </span><span class="s1">'the image link you just inserted did not pass the editor verification',</span><span class="s3">\n                    </span><span class="s1">插入视频错误: 'insert video error',</span><span class="s3">\n                    </span><span class="s1">视频链接: 'video link',</span><span class="s3">\n                    </span><span class="s1">不是视频: 'is not video',</span><span class="s3">\n                    </span><span class="s1">视频验证未通过: 'video validate failed',</span><span class="s3">\n                    </span><span class="s1">个视频: 'videos',</span><span class="s3">\n                    </span><span class="s1">上传视频超时: 'upload video timeout',</span><span class="s3">\n                    </span><span class="s1">上传视频错误: 'upload video error',</span><span class="s3">\n                    </span><span class="s1">上传视频失败: 'upload video failed',</span><span class="s3">\n                    </span><span class="s1">上传视频返回结果错误: 'upload video return results error',</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 历史记录 - 数据缓存的模式</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { UA } from '../utils/util'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 是否为兼容模式。返回 true 表示当前使用兼容（内容备份）模式，否则使用标准（差异备份）模式</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function compatibleMode() {</span><span class="s3">\n    </span><span class="s1">if (UA.isIE() || UA.isOldEdge) {</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return false</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default {</span><span class="s3">\n    </span><span class="s1">compatibleMode,</span><span class="s3">\n    </span><span class="s1">historyMaxSize: 30,</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 视频相关的配置</span><span class="s3">\n </span><span class="s1">* @author hutianhao</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../editor/index'</span><span class="s3">\n</span><span class="s1">import { EMPTY_FN } from '../utils/const'</span><span class="s3">\n</span><span class="s1">import { ResType } from '../menus/video/upload-video'</span><span class="s3">\n\n</span><span class="s1">export type UploadVideoHooksType = {</span><span class="s3">\n    </span><span class="s1">before?: (</span><span class="s3">\n        </span><span class="s1">xhr: XMLHttpRequest,</span><span class="s3">\n        </span><span class="s1">editor: Editor,</span><span class="s3">\n        </span><span class="s1">files: File[]</span><span class="s3">\n    </span><span class="s1">) =&gt; { prevent: boolean; msg: string } | void</span><span class="s3">\n    </span><span class="s1">success?: (xhr: XMLHttpRequest, editor: Editor, result: ResType) =&gt; void</span><span class="s3">\n    </span><span class="s1">fail?: (xhr: XMLHttpRequest, editor: Editor, err: ResType | string) =&gt; void</span><span class="s3">\n    </span><span class="s1">error?: (xhr: XMLHttpRequest, editor: Editor) =&gt; void</span><span class="s3">\n    </span><span class="s1">timeout?: (xhr: XMLHttpRequest, editor: Editor) =&gt; void</span><span class="s3">\n    </span><span class="s1">customInsert?: (</span><span class="s3">\n        </span><span class="s1">inserVideo: (this: Editor, src: string) =&gt; void,</span><span class="s3">\n        </span><span class="s1">result: ResType,</span><span class="s3">\n        </span><span class="s1">editor: Editor</span><span class="s3">\n    </span><span class="s1">) =&gt; void</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default {</span><span class="s3">\n    </span><span class="s1">// 插入网络视频前的回调函数</span><span class="s3">\n    </span><span class="s1">onlineVideoCheck: (video: string): string | boolean =&gt; {</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n\n    </span><span class="s1">// 插入网络视频成功之后的回调函数</span><span class="s3">\n    </span><span class="s1">onlineVideoCallback: EMPTY_FN,</span><span class="s3">\n\n    </span><span class="s1">// 显示“插入视频”</span><span class="s3">\n    </span><span class="s1">showLinkVideo: true,</span><span class="s3">\n\n    </span><span class="s1">// accept</span><span class="s3">\n    </span><span class="s1">uploadVideoAccept: ['mp4'],</span><span class="s3">\n\n    </span><span class="s1">// 服务端地址</span><span class="s3">\n    </span><span class="s1">uploadVideoServer: '',</span><span class="s3">\n\n    </span><span class="s1">// 上传视频的最大体积，默认 1024M</span><span class="s3">\n    </span><span class="s1">uploadVideoMaxSize: 1 * 1024 * 1024 * 1024,</span><span class="s3">\n\n    </span><span class="s1">// 一次最多上传多少个视频</span><span class="s3">\n    </span><span class="s1">// uploadVideoMaxLength: 2,</span><span class="s3">\n\n    </span><span class="s1">// 自定义上传视频的名称</span><span class="s3">\n    </span><span class="s1">uploadVideoName: '',</span><span class="s3">\n\n    </span><span class="s1">// 上传视频自定义参数</span><span class="s3">\n    </span><span class="s1">uploadVideoParams: {},</span><span class="s3">\n\n    </span><span class="s1">// 自定义参数拼接到 url 中</span><span class="s3">\n    </span><span class="s1">uploadVideoParamsWithUrl: false,</span><span class="s3">\n\n    </span><span class="s1">// 上传视频自定义 header</span><span class="s3">\n    </span><span class="s1">uploadVideoHeaders: {},</span><span class="s3">\n\n    </span><span class="s1">// 钩子函数</span><span class="s3">\n    </span><span class="s1">uploadVideoHooks: {},</span><span class="s3">\n\n    </span><span class="s1">// 上传视频超时时间 ms 默认2个小时</span><span class="s3">\n    </span><span class="s1">uploadVideoTimeout: 1000 * 60 * 60 * 2,</span><span class="s3">\n\n    </span><span class="s1">// 跨域带 cookie</span><span class="s3">\n    </span><span class="s1">withVideoCredentials: false,</span><span class="s3">\n\n    </span><span class="s1">// 自定义上传</span><span class="s3">\n    </span><span class="s1">customUploadVideo: null,</span><span class="s3">\n\n    </span><span class="s1">// 自定义插入视频</span><span class="s3">\n    </span><span class="s1">customInsertVideo: null,</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description selection range API</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { UA } from '../utils/util'</span><span class="s3">\n</span><span class="s1">import Editor from './index'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../utils/const'</span><span class="s3">\n\n</span><span class="s1">class SelectionAndRange {</span><span class="s3">\n    </span><span class="s1">public editor: Editor</span><span class="s3">\n    </span><span class="s1">private _currentRange: Range | null | undefined = null</span><span class="s3">\n\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">this.editor = editor</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取当前 range</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public getRange(): Range | null | undefined {</span><span class="s3">\n        </span><span class="s1">return this._currentRange</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 保存选区范围</span><span class="s3">\n     </span><span class="s1">* @param _range 选区范围</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public saveRange(_range?: Range): void {</span><span class="s3">\n        </span><span class="s1">if (_range) {</span><span class="s3">\n            </span><span class="s1">// 保存已有选区</span><span class="s3">\n            </span><span class="s1">this._currentRange = _range</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 获取当前的选区</span><span class="s3">\n        </span><span class="s1">const selection = window.getSelection() as Selection</span><span class="s3">\n        </span><span class="s1">if (selection.rangeCount === 0) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">const range = selection.getRangeAt(0)</span><span class="s3">\n\n        </span><span class="s1">// 获取选区范围的 DOM 元素</span><span class="s3">\n        </span><span class="s1">const $containerElem = this.getSelectionContainerElem(range)</span><span class="s3">\n        </span><span class="s1">if (!$containerElem?.length) {</span><span class="s3">\n            </span><span class="s1">// 当 选区范围内没有 DOM元素 则抛出</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (</span><span class="s3">\n            </span><span class="s1">$containerElem.attr('contenteditable') === 'false' ||</span><span class="s3">\n            </span><span class="s1">$containerElem.parentUntil('[contenteditable=false]')</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n            </span><span class="s1">// 这里大体意义上就是个保险</span><span class="s3">\n            </span><span class="s1">// 确保 编辑区域 的 contenteditable属性 的值为 true</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n        </span><span class="s1">if ($textElem.isContain($containerElem)) {</span><span class="s3">\n            </span><span class="s1">if ($textElem.elems[0] === $containerElem.elems[0]) {</span><span class="s3">\n                </span><span class="s1">if ($textElem.html().trim() === EMPTY_P) {</span><span class="s3">\n                    </span><span class="s1">const $children = $textElem.children()</span><span class="s3">\n                    </span><span class="s1">const $last = $children?.last()</span><span class="s3">\n                    </span><span class="s1">editor.selection.createRangeByElem($last as DomElement, true, true)</span><span class="s3">\n                    </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">// 是编辑内容之内的</span><span class="s3">\n            </span><span class="s1">this._currentRange = range</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 折叠选区范围</span><span class="s3">\n     </span><span class="s1">* @param toStart true 开始位置，false 结束位置</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public collapseRange(toStart: boolean = false): void {</span><span class="s3">\n        </span><span class="s1">const range = this._currentRange</span><span class="s3">\n        </span><span class="s1">if (range) {</span><span class="s3">\n            </span><span class="s1">range.collapse(toStart)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取选区范围内的文字</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public getSelectionText(): string {</span><span class="s3">\n        </span><span class="s1">const range = this._currentRange</span><span class="s3">\n        </span><span class="s1">if (range) {</span><span class="s3">\n            </span><span class="s1">return range.toString()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">return ''</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取选区范围的 DOM 元素</span><span class="s3">\n     </span><span class="s1">* @param range 选区范围</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public getSelectionContainerElem(range?: Range): DomElement | undefined {</span><span class="s3">\n        </span><span class="s1">let r: Range | null | undefined</span><span class="s3">\n        </span><span class="s1">r = range || this._currentRange</span><span class="s3">\n        </span><span class="s1">let elem: Node</span><span class="s3">\n        </span><span class="s1">if (r) {</span><span class="s3">\n            </span><span class="s1">elem = r.commonAncestorContainer</span><span class="s3">\n            </span><span class="s1">return $(elem.nodeType === 1 ? elem : elem.parentNode)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 选区范围开始的 DOM 元素</span><span class="s3">\n     </span><span class="s1">* @param range 选区范围</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public getSelectionStartElem(range?: Range): DomElement | undefined {</span><span class="s3">\n        </span><span class="s1">let r: Range | null | undefined</span><span class="s3">\n        </span><span class="s1">r = range || this._currentRange</span><span class="s3">\n        </span><span class="s1">let elem: Node</span><span class="s3">\n        </span><span class="s1">if (r) {</span><span class="s3">\n            </span><span class="s1">elem = r.startContainer</span><span class="s3">\n            </span><span class="s1">return $(elem.nodeType === 1 ? elem : elem.parentNode)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 选区范围结束的 DOM 元素</span><span class="s3">\n     </span><span class="s1">* @param range 选区范围</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public getSelectionEndElem(range?: Range): DomElement | undefined {</span><span class="s3">\n        </span><span class="s1">let r: Range | null | undefined</span><span class="s3">\n        </span><span class="s1">r = range || this._currentRange</span><span class="s3">\n        </span><span class="s1">let elem: Node</span><span class="s3">\n        </span><span class="s1">if (r) {</span><span class="s3">\n            </span><span class="s1">elem = r.endContainer</span><span class="s3">\n            </span><span class="s1">return $(elem.nodeType === 1 ? elem : elem.parentNode)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 选区是否为空（没有选择文字）</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public isSelectionEmpty(): boolean {</span><span class="s3">\n        </span><span class="s1">const range = this._currentRange</span><span class="s3">\n        </span><span class="s1">if (range &amp;&amp; range.startContainer) {</span><span class="s3">\n            </span><span class="s1">if (range.startContainer === range.endContainer) {</span><span class="s3">\n                </span><span class="s1">if (range.startOffset === range.endOffset) {</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 恢复选区范围</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public restoreSelection(): void {</span><span class="s3">\n        </span><span class="s1">const selection = window.getSelection()</span><span class="s3">\n        </span><span class="s1">const r = this._currentRange</span><span class="s3">\n        </span><span class="s1">if (selection &amp;&amp; r) {</span><span class="s3">\n            </span><span class="s1">selection.removeAllRanges()</span><span class="s3">\n            </span><span class="s1">selection.addRange(r)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 创建一个空白（即 &amp;#8203 字符）选区</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public createEmptyRange(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const range = this.getRange()</span><span class="s3">\n        </span><span class="s1">let $elem: DomElement</span><span class="s3">\n\n        </span><span class="s1">if (!range) {</span><span class="s3">\n            </span><span class="s1">// 当前无 range</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (!this.isSelectionEmpty()) {</span><span class="s3">\n            </span><span class="s1">// 当前选区必须没有内容才可以，有内容就直接 return</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">try {</span><span class="s3">\n            </span><span class="s1">// 目前只支持 webkit 内核</span><span class="s3">\n            </span><span class="s1">if (UA.isWebkit()) {</span><span class="s3">\n                </span><span class="s1">// 插入 &amp;#8203</span><span class="s3">\n                </span><span class="s1">editor.cmd.do('insertHTML', '&amp;#8203;')</span><span class="s3">\n                </span><span class="s1">// 修改 offset 位置</span><span class="s3">\n                </span><span class="s1">range.setEnd(range.endContainer, range.endOffset + 1)</span><span class="s3">\n                </span><span class="s1">// 存储</span><span class="s3">\n                </span><span class="s1">this.saveRange(range)</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">$elem = $('&lt;strong&gt;&amp;#8203;&lt;/strong&gt;')</span><span class="s3">\n                </span><span class="s1">editor.cmd.do('insertElem', $elem)</span><span class="s3">\n                </span><span class="s1">this.createRangeByElem($elem, true)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">} catch (ex) {</span><span class="s3">\n            </span><span class="s1">// 部分情况下会报错，兼容一下</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 重新设置选区</span><span class="s3">\n     </span><span class="s1">* @param startDom 选区开始的元素</span><span class="s3">\n     </span><span class="s1">* @param endDom 选区结束的元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public createRangeByElems(startDom: Node, endDom: Node): void {</span><span class="s3">\n        </span><span class="s1">let selection = window.getSelection ? window.getSelection() : document.getSelection()</span><span class="s3">\n        </span><span class="s1">//清除所有的选区</span><span class="s3">\n        </span><span class="s1">selection?.removeAllRanges()</span><span class="s3">\n        </span><span class="s1">const range = document.createRange()</span><span class="s3">\n        </span><span class="s1">range.setStart(startDom, 0)</span><span class="s3">\n        </span><span class="s1">// 设置多行标签之后，第二个参数会被h标签内的b、font标签等影响range范围的选取</span><span class="s3">\n        </span><span class="s1">range.setEnd(endDom, endDom.childNodes.length || 1)</span><span class="s3">\n        </span><span class="s1">// 保存设置好的选区</span><span class="s3">\n        </span><span class="s1">this.saveRange(range)</span><span class="s3">\n        </span><span class="s1">//恢复选区</span><span class="s3">\n        </span><span class="s1">this.restoreSelection()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 根据 DOM 元素设置选区</span><span class="s3">\n     </span><span class="s1">* @param $elem DOM 元素</span><span class="s3">\n     </span><span class="s1">* @param toStart true 开始位置，false 结束位置</span><span class="s3">\n     </span><span class="s1">* @param isContent 是否选中 $elem 的内容</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public createRangeByElem($elem: DomElement, toStart?: boolean, isContent?: boolean): void {</span><span class="s3">\n        </span><span class="s1">if (!$elem.length) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const elem = $elem.elems[0]</span><span class="s3">\n        </span><span class="s1">const range = document.createRange()</span><span class="s3">\n\n        </span><span class="s1">if (isContent) {</span><span class="s3">\n            </span><span class="s1">range.selectNodeContents(elem)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 如果用户没有传入 isContent 参数，那就默认为 false</span><span class="s3">\n            </span><span class="s1">range.selectNode(elem)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (toStart != null) {</span><span class="s3">\n            </span><span class="s1">// 传入了 toStart 参数，折叠选区。如果没传入 toStart 参数，则忽略这一步</span><span class="s3">\n            </span><span class="s1">range.collapse(toStart)</span><span class="s3">\n\n            </span><span class="s1">if (!toStart) {</span><span class="s3">\n                </span><span class="s1">this.saveRange(range)</span><span class="s3">\n                </span><span class="s1">this.editor.selection.moveCursor(elem)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 存储 range</span><span class="s3">\n        </span><span class="s1">this.saveRange(range)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取 当前 选取范围的 顶级(段落) 元素</span><span class="s3">\n     </span><span class="s1">* @param $editor</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public getSelectionRangeTopNodes(): DomElement[] {</span><span class="s3">\n        </span><span class="s1">// 清空，防止叠加元素</span><span class="s3">\n        </span><span class="s1">let $nodeList: DomElement[]</span><span class="s3">\n\n        </span><span class="s1">const $startElem = this.getSelectionStartElem()?.getNodeTop(this.editor)</span><span class="s3">\n        </span><span class="s1">const $endElem = this.getSelectionEndElem()?.getNodeTop(this.editor)</span><span class="s3">\n\n        </span><span class="s1">$nodeList = this.recordSelectionNodes($($startElem), $($endElem))</span><span class="s3">\n\n        </span><span class="s1">return $nodeList</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 移动光标位置,默认情况下在尾部</span><span class="s3">\n     </span><span class="s1">* 有一个特殊情况是firefox下的文本节点会自动补充一个br元素，会导致自动换行</span><span class="s3">\n     </span><span class="s1">* 所以默认情况下在firefox下的文本节点会自动移动到br前面</span><span class="s3">\n     </span><span class="s1">* @param {Node} node 元素节点</span><span class="s3">\n     </span><span class="s1">* @param {number} position 光标的位置</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public moveCursor(node: Node, position?: number): void {</span><span class="s3">\n        </span><span class="s1">const range = this.getRange()</span><span class="s3">\n        </span><span class="s1">//对文本节点特殊处理</span><span class="s3">\n        </span><span class="s1">let len: number =</span><span class="s3">\n            </span><span class="s1">node.nodeType === 3 ? (node.nodeValue?.length as number) : node.childNodes.length</span><span class="s3">\n        </span><span class="s1">if ((UA.isFirefox || UA.isIE()) &amp;&amp; len !== 0) {</span><span class="s3">\n            </span><span class="s1">// firefox下在节点为文本节点和节点最后一个元素为文本节点的情况下</span><span class="s3">\n            </span><span class="s1">if (node.nodeType === 3 || node.childNodes[len - 1].nodeName === 'BR') {</span><span class="s3">\n                </span><span class="s1">len = len - 1</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">let pos: number = position ?? len</span><span class="s3">\n        </span><span class="s1">if (!range) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (node) {</span><span class="s3">\n            </span><span class="s1">range.setStart(node, pos)</span><span class="s3">\n            </span><span class="s1">range.setEnd(node, pos)</span><span class="s3">\n            </span><span class="s1">this.restoreSelection()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取光标在当前选区的位置</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public getCursorPos(): number | undefined {</span><span class="s3">\n        </span><span class="s1">const selection = window.getSelection()</span><span class="s3">\n\n        </span><span class="s1">return selection?.anchorOffset</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 清除当前选区的Range,notice:不影响已保存的Range</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clearWindowSelectionRange(): void {</span><span class="s3">\n        </span><span class="s1">const selection = window.getSelection()</span><span class="s3">\n        </span><span class="s1">if (selection) {</span><span class="s3">\n            </span><span class="s1">selection.removeAllRanges()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 记录节点 - 从选区开始节点开始 一直到匹配到选区结束节点为止</span><span class="s3">\n     </span><span class="s1">* @param $node 节点</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public recordSelectionNodes($node: DomElement, $endElem: DomElement): DomElement[] {</span><span class="s3">\n        </span><span class="s1">let $list: DomElement[] = []</span><span class="s3">\n        </span><span class="s1">let isEnd = true</span><span class="s3">\n        </span><span class="s1">/**  </span><span class="s3">\n        </span><span class="s1">@author:lw</span><span class="s3">\n        </span><span class="s1">@description 解决ctrl+a全选报错的bug $elem.getNodeName()可能会触发$elem[0]未定义</span><span class="s3">\n        </span><span class="s1">**/</span><span class="s3">\n        </span><span class="s1">try {</span><span class="s3">\n            </span><span class="s1">let $NODE: DomElement = $node</span><span class="s3">\n            </span><span class="s1">const $textElem = this.editor.$textElem</span><span class="s3">\n            </span><span class="s1">// $NODE元素为空时不需要进行循环</span><span class="s3">\n            </span><span class="s1">while (isEnd) {</span><span class="s3">\n                </span><span class="s1">const $elem = $NODE?.getNodeTop(this.editor)</span><span class="s3">\n                </span><span class="s1">if ($elem.getNodeName() === 'BODY') isEnd = false // 兜底</span><span class="s3">\n                </span><span class="s1">if ($elem.length &gt; 0) {</span><span class="s3">\n                    </span><span class="s1">$list.push($($NODE))</span><span class="s3">\n                    </span><span class="s1">// 两个边界情况：</span><span class="s3">\n                    </span><span class="s1">// 1. 当前元素就是我们要找的末尾元素</span><span class="s3">\n                    </span><span class="s1">// 2. 当前元素已经是编辑区顶级元素（否则会找到编辑区的兄弟节点，比如placeholder元素）</span><span class="s3">\n                    </span><span class="s1">if ($endElem?.equal($elem) || $textElem.equal($elem)) {</span><span class="s3">\n                        </span><span class="s1">isEnd = false</span><span class="s3">\n                    </span><span class="s1">} else {</span><span class="s3">\n                        </span><span class="s1">$NODE = $elem.getNextSibling()</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">} catch (e) {</span><span class="s3">\n            </span><span class="s1">isEnd = false</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return $list</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 将当前 range 设置到 node 元素并初始化位置</span><span class="s3">\n     </span><span class="s1">* 解决编辑器内容为空时，菜单不生效的问题</span><span class="s3">\n     </span><span class="s1">* @param node 元素节点</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public setRangeToElem(node: Node): void {</span><span class="s3">\n        </span><span class="s1">const range = this.getRange()</span><span class="s3">\n        </span><span class="s1">range?.setStart(node, 0)</span><span class="s3">\n        </span><span class="s1">range?.setEnd(node, 0)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default SelectionAndRange</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 封装 document.execCommand</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from './index'</span><span class="s3">\n\n</span><span class="s1">class Command {</span><span class="s3">\n    </span><span class="s1">public editor: Editor</span><span class="s3">\n\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">this.editor = editor</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行富文本操作的命令</span><span class="s3">\n     </span><span class="s1">* @param name name</span><span class="s3">\n     </span><span class="s1">* @param value value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public do(name: string, value?: string | DomElement): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n\n        </span><span class="s1">if (editor.config.styleWithCSS) {</span><span class="s3">\n            </span><span class="s1">document.execCommand('styleWithCSS', false, 'true')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const selection = editor.selection</span><span class="s3">\n\n        </span><span class="s1">// 如果无选区，忽略</span><span class="s3">\n        </span><span class="s1">if (!selection.getRange()) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 恢复选取</span><span class="s3">\n        </span><span class="s1">selection.restoreSelection()</span><span class="s3">\n\n        </span><span class="s1">// 执行</span><span class="s3">\n        </span><span class="s1">switch (name) {</span><span class="s3">\n            </span><span class="s1">case 'insertHTML':</span><span class="s3">\n                </span><span class="s1">this.insertHTML(value as string)</span><span class="s3">\n                </span><span class="s1">break</span><span class="s3">\n            </span><span class="s1">case 'insertElem':</span><span class="s3">\n                </span><span class="s1">this.insertElem(value as DomElement)</span><span class="s3">\n                </span><span class="s1">break</span><span class="s3">\n            </span><span class="s1">default:</span><span class="s3">\n                </span><span class="s1">// 默认 command</span><span class="s3">\n                </span><span class="s1">this.execCommand(name, value as string)</span><span class="s3">\n                </span><span class="s1">break</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 修改菜单状态</span><span class="s3">\n        </span><span class="s1">editor.menus.changeActive()</span><span class="s3">\n\n        </span><span class="s1">// 最后，恢复选取保证光标在原来的位置闪烁</span><span class="s3">\n        </span><span class="s1">selection.saveRange()</span><span class="s3">\n        </span><span class="s1">selection.restoreSelection()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 插入 html</span><span class="s3">\n     </span><span class="s1">* @param html html 字符串</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private insertHTML(html: string): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const range = editor.selection.getRange()</span><span class="s3">\n        </span><span class="s1">if (range == null) return</span><span class="s3">\n\n        </span><span class="s1">if (this.queryCommandSupported('insertHTML')) {</span><span class="s3">\n            </span><span class="s1">// W3C</span><span class="s3">\n            </span><span class="s1">this.execCommand('insertHTML', html)</span><span class="s3">\n        </span><span class="s1">} else if (range.insertNode) {</span><span class="s3">\n            </span><span class="s1">// IE</span><span class="s3">\n            </span><span class="s1">range.deleteContents()</span><span class="s3">\n            </span><span class="s1">if ($(html).elems.length &gt; 0) {</span><span class="s3">\n                </span><span class="s1">range.insertNode($(html).elems[0])</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">let newNode = document.createElement('p')</span><span class="s3">\n                </span><span class="s1">newNode.appendChild(document.createTextNode(html))</span><span class="s3">\n                </span><span class="s1">range.insertNode(newNode)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">editor.selection.collapseRange()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// else if (range.pasteHTML) {</span><span class="s3">\n        </span><span class="s1">//     // IE &lt;= 10</span><span class="s3">\n        </span><span class="s1">//     range.pasteHTML(html)</span><span class="s3">\n        </span><span class="s1">// }</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 插入 DOM 元素</span><span class="s3">\n     </span><span class="s1">* @param $elem DOM 元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private insertElem($elem: DomElement): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const range = editor.selection.getRange()</span><span class="s3">\n        </span><span class="s1">if (range == null) return</span><span class="s3">\n\n        </span><span class="s1">if (range.insertNode) {</span><span class="s3">\n            </span><span class="s1">range.deleteContents()</span><span class="s3">\n            </span><span class="s1">range.insertNode($elem.elems[0])</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行 document.execCommand</span><span class="s3">\n     </span><span class="s1">* @param name name</span><span class="s3">\n     </span><span class="s1">* @param value value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private execCommand(name: string, value: string): void {</span><span class="s3">\n        </span><span class="s1">document.execCommand(name, false, value)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行 document.queryCommandValue</span><span class="s3">\n     </span><span class="s1">* @param name name</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public queryCommandValue(name: string): string {</span><span class="s3">\n        </span><span class="s1">return document.queryCommandValue(name)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行 document.queryCommandState</span><span class="s3">\n     </span><span class="s1">* @param name name</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public queryCommandState(name: string): boolean {</span><span class="s3">\n        </span><span class="s1">return document.queryCommandState(name)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行 document.queryCommandSupported</span><span class="s3">\n     </span><span class="s1">* @param name name</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public queryCommandSupported(name: string): boolean {</span><span class="s3">\n        </span><span class="s1">return document.queryCommandSupported(name)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Command</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 编辑区域，入口文件</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../editor/index'</span><span class="s3">\n</span><span class="s1">import initEventHooks from './event-hooks/index'</span><span class="s3">\n</span><span class="s1">import { UA, throttle } from '../utils/util'</span><span class="s3">\n</span><span class="s1">import getChildrenJSON, { NodeListType } from './getChildrenJSON'</span><span class="s3">\n</span><span class="s1">import getHtmlByNodeList from './getHtmlByNodeList'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P, EMPTY_P_LAST_REGEX, EMPTY_P_REGEX } from '../utils/const'</span><span class="s3">\n\n</span><span class="s1">/** 按键函数 */</span><span class="s3">\n</span><span class="s1">type KeyBoardHandler = (event: KeyboardEvent) =&gt; unknown</span><span class="s3">\n</span><span class="s1">/** 普通事件回调 */</span><span class="s3">\n</span><span class="s1">type EventHandler = (event?: Event) =&gt; unknown</span><span class="s3">\n</span><span class="s1">// 各个事件钩子函数</span><span class="s3">\n</span><span class="s1">type TextEventHooks = {</span><span class="s3">\n    </span><span class="s1">onBlurEvents: EventHandler[]</span><span class="s3">\n    </span><span class="s1">changeEvents: (() =&gt; void)[] // 内容修改时</span><span class="s3">\n    </span><span class="s1">dropEvents: ((event: DragEvent) =&gt; unknown)[]</span><span class="s3">\n    </span><span class="s1">clickEvents: EventHandler[]</span><span class="s3">\n    </span><span class="s1">keydownEvents: KeyBoardHandler[]</span><span class="s3">\n    </span><span class="s1">keyupEvents: KeyBoardHandler[]</span><span class="s3">\n    </span><span class="s1">/** tab 键（keyCode === ）Up 时 */</span><span class="s3">\n    </span><span class="s1">tabUpEvents: KeyBoardHandler[]</span><span class="s3">\n    </span><span class="s1">/** tab 键（keyCode === 9）Down 时 */</span><span class="s3">\n    </span><span class="s1">tabDownEvents: KeyBoardHandler[]</span><span class="s3">\n    </span><span class="s1">/** enter 键（keyCode === 13）up 时 */</span><span class="s3">\n    </span><span class="s1">enterUpEvents: KeyBoardHandler[]</span><span class="s3">\n    </span><span class="s1">/** enter 键（keyCode === 13）down 时 */</span><span class="s3">\n    </span><span class="s1">enterDownEvents: KeyBoardHandler[]</span><span class="s3">\n    </span><span class="s1">/** 删除键（keyCode === 8）up 时 */</span><span class="s3">\n    </span><span class="s1">deleteUpEvents: KeyBoardHandler[]</span><span class="s3">\n    </span><span class="s1">/** 删除键（keyCode === 8）down 时 */</span><span class="s3">\n    </span><span class="s1">deleteDownEvents: KeyBoardHandler[]</span><span class="s3">\n    </span><span class="s1">/** 粘贴事件 */</span><span class="s3">\n    </span><span class="s1">pasteEvents: ((e: ClipboardEvent) =&gt; void)[]</span><span class="s3">\n    </span><span class="s1">/** 点击链接事件 */</span><span class="s3">\n    </span><span class="s1">linkClickEvents: ((e: DomElement) =&gt; void)[]</span><span class="s3">\n    </span><span class="s1">/** 点击代码事件 */</span><span class="s3">\n    </span><span class="s1">codeClickEvents: ((e: DomElement) =&gt; void)[]</span><span class="s3">\n    </span><span class="s1">/** 编辑区域滑动事件 */</span><span class="s3">\n    </span><span class="s1">textScrollEvents: EventHandler[]</span><span class="s3">\n    </span><span class="s1">/** 菜单栏被点击 */</span><span class="s3">\n    </span><span class="s1">toolbarClickEvents: EventHandler[]</span><span class="s3">\n    </span><span class="s1">/** 图片被点击事件 */</span><span class="s3">\n    </span><span class="s1">imgClickEvents: ((e: DomElement) =&gt; void)[]</span><span class="s3">\n    </span><span class="s1">/** 图片拖拽MouseDown */</span><span class="s3">\n    </span><span class="s1">imgDragBarMouseDownEvents: (() =&gt; void)[]</span><span class="s3">\n    </span><span class="s1">/** 表格点击 */</span><span class="s3">\n    </span><span class="s1">tableClickEvents: (($dom: DomElement, e: MouseEvent) =&gt; void)[]</span><span class="s3">\n    </span><span class="s1">/** 每个菜单被点击时，按理说这个不属于 txt 的，先暂时在这放着吧 */</span><span class="s3">\n    </span><span class="s1">menuClickEvents: (() =&gt; void)[]</span><span class="s3">\n    </span><span class="s1">/** droplist 菜单悬浮事件。暂时放这里 */</span><span class="s3">\n    </span><span class="s1">dropListMenuHoverEvents: (() =&gt; void)[]</span><span class="s3">\n    </span><span class="s1">/** 点击分割线时 */</span><span class="s3">\n    </span><span class="s1">splitLineEvents: ((e: DomElement) =&gt; void)[]</span><span class="s3">\n    </span><span class="s1">/** 视频点击事件 */</span><span class="s3">\n    </span><span class="s1">videoClickEvents: ((e: DomElement) =&gt; void)[]</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">class Text {</span><span class="s3">\n    </span><span class="s1">public editor: Editor</span><span class="s3">\n    </span><span class="s1">public eventHooks: TextEventHooks // Text 各个事件的钩子函数，如 keyup 时要执行哪些函数</span><span class="s3">\n\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">this.editor = editor</span><span class="s3">\n\n        </span><span class="s1">this.eventHooks = {</span><span class="s3">\n            </span><span class="s1">onBlurEvents: [],</span><span class="s3">\n            </span><span class="s1">changeEvents: [],</span><span class="s3">\n            </span><span class="s1">dropEvents: [],</span><span class="s3">\n            </span><span class="s1">clickEvents: [],</span><span class="s3">\n            </span><span class="s1">keydownEvents: [],</span><span class="s3">\n            </span><span class="s1">keyupEvents: [],</span><span class="s3">\n            </span><span class="s1">tabUpEvents: [],</span><span class="s3">\n            </span><span class="s1">tabDownEvents: [],</span><span class="s3">\n            </span><span class="s1">enterUpEvents: [],</span><span class="s3">\n            </span><span class="s1">enterDownEvents: [],</span><span class="s3">\n            </span><span class="s1">deleteUpEvents: [],</span><span class="s3">\n            </span><span class="s1">deleteDownEvents: [],</span><span class="s3">\n            </span><span class="s1">pasteEvents: [],</span><span class="s3">\n            </span><span class="s1">linkClickEvents: [],</span><span class="s3">\n            </span><span class="s1">codeClickEvents: [],</span><span class="s3">\n            </span><span class="s1">textScrollEvents: [],</span><span class="s3">\n            </span><span class="s1">toolbarClickEvents: [],</span><span class="s3">\n            </span><span class="s1">imgClickEvents: [],</span><span class="s3">\n            </span><span class="s1">imgDragBarMouseDownEvents: [],</span><span class="s3">\n            </span><span class="s1">tableClickEvents: [],</span><span class="s3">\n            </span><span class="s1">menuClickEvents: [],</span><span class="s3">\n            </span><span class="s1">dropListMenuHoverEvents: [],</span><span class="s3">\n            </span><span class="s1">splitLineEvents: [],</span><span class="s3">\n            </span><span class="s1">videoClickEvents: [],</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 初始化</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public init(): void {</span><span class="s3">\n        </span><span class="s1">// 实时保存选取范围</span><span class="s3">\n        </span><span class="s1">this._saveRange()</span><span class="s3">\n\n        </span><span class="s1">// 绑定事件</span><span class="s3">\n        </span><span class="s1">this._bindEventHooks()</span><span class="s3">\n\n        </span><span class="s1">// 初始化 text 事件钩子函数</span><span class="s3">\n        </span><span class="s1">initEventHooks(this)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 切换placeholder</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public togglePlaceholder(): void {</span><span class="s3">\n        </span><span class="s1">const html = this.html()</span><span class="s3">\n        </span><span class="s1">const $placeholder = this.editor.$textContainerElem.find('.placeholder')</span><span class="s3">\n        </span><span class="s1">$placeholder.hide()</span><span class="s3">\n        </span><span class="s1">if (this.editor.isComposing) return</span><span class="s3">\n        </span><span class="s1">if (!html || html === ' ') $placeholder.show()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 清空内容</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clear(): void {</span><span class="s3">\n        </span><span class="s1">this.html(EMPTY_P)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 设置/获取 html</span><span class="s3">\n     </span><span class="s1">* @param val html 字符串</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public html(val?: string): void | string {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n\n        </span><span class="s1">// 没有 val ，则是获取 html</span><span class="s3">\n        </span><span class="s1">if (val == null) {</span><span class="s3">\n            </span><span class="s1">let html = $textElem.html()</span><span class="s3">\n            </span><span class="s1">// 未选中任何内容的时候点击“加粗”或者“斜体”等按钮，就得需要一个空的占位符 &amp;#8203 ，这里替换掉</span><span class="s3">\n            </span><span class="s1">html = html.replace(/</span><span class="s3">\\</span><span class="s1">u200b/gm, '')</span><span class="s3">\n            </span><span class="s1">// 去掉空行</span><span class="s3">\n            </span><span class="s1">html = html.replace(/&lt;p&gt;&lt;</span><span class="s3">\\</span><span class="s1">/p&gt;/gim, '')</span><span class="s3">\n            </span><span class="s1">// 去掉最后的 空标签</span><span class="s3">\n            </span><span class="s1">html = html.replace(EMPTY_P_LAST_REGEX, '')</span><span class="s3">\n            </span><span class="s1">// 为了避免用户在最后生成的EMPTY_P标签中编辑数据, 最后产生多余标签, 去除所有p标签上的data-we-empty-p属性</span><span class="s3">\n            </span><span class="s1">html = html.replace(EMPTY_P_REGEX, '&lt;p&gt;')</span><span class="s3">\n\n            </span><span class="s1">/**</span><span class="s3">\n             </span><span class="s1">* 这里的代码为了处理火狐多余的空行标签,但是强制删除空行标签会带来其他问题</span><span class="s3">\n             </span><span class="s1">* html()方法返回的的值,EMPTY_P中pr会被删除,只留下&lt;p&gt;,点不进去,从而产生垃圾数据</span><span class="s3">\n             </span><span class="s1">* 目前在末位有多个空行的情况下执行撤销重做操作,会产生一种不记录末尾空行的错觉</span><span class="s3">\n             </span><span class="s1">* 暂时注释, 等待进一步的兼容处理</span><span class="s3">\n             </span><span class="s1">*/</span><span class="s3">\n            </span><span class="s1">// html = html.replace(/&gt;&lt;br&gt;(?!&lt;)/gi, '&gt;') // 过滤 &lt;p&gt;&lt;br&gt;内容&lt;/p&gt; 中的br</span><span class="s3">\n            </span><span class="s1">// html = html.replace(/(?!&gt;)&lt;br&gt;&lt;/gi, '&lt;') // 过滤 &lt;p&gt;内容&lt;br&gt;&lt;/p&gt; 中的br</span><span class="s3">\n\n            </span><span class="s1">/**</span><span class="s3">\n             </span><span class="s1">* pre标签格式化</span><span class="s3">\n             </span><span class="s1">* html()方法理论上应当输出纯净的代码文本,但是对于是否解析html标签还没有良好的判断</span><span class="s3">\n             </span><span class="s1">* 如果去除hljs的标签,在解析状态下回显,会造成显示错误并且无法再通过hljs方法渲染</span><span class="s3">\n             </span><span class="s1">* 暂且其弃用</span><span class="s3">\n             </span><span class="s1">*/</span><span class="s3">\n            </span><span class="s1">// html = formatCodeHtml(editor, html)</span><span class="s3">\n\n            </span><span class="s1">// 将没有自闭和的标签过滤为自闭和</span><span class="s3">\n            </span><span class="s1">const selfCloseHtmls: RegExpMatchArray | null = html.match(/&lt;(img|br|hr|input)[^&gt;]*&gt;/gi)</span><span class="s3">\n            </span><span class="s1">if (selfCloseHtmls !== null) {</span><span class="s3">\n                </span><span class="s1">selfCloseHtmls.forEach(item =&gt; {</span><span class="s3">\n                    </span><span class="s1">if (!item.match(/</span><span class="s3">\\</span><span class="s1">/&gt;/)) {</span><span class="s3">\n                        </span><span class="s1">html = html.replace(item, item.substring(0, item.length - 1) + '/&gt;')</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">return html</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 有 val ，则是设置 html</span><span class="s3">\n        </span><span class="s1">val = val.trim()</span><span class="s3">\n        </span><span class="s1">if (val === '') {</span><span class="s3">\n            </span><span class="s1">val = EMPTY_P</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (val.indexOf('&lt;') !== 0) {</span><span class="s3">\n            </span><span class="s1">// 内容用 p 标签包裹</span><span class="s3">\n            </span><span class="s1">val = `&lt;p&gt;${val}&lt;/p&gt;`</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">$textElem.html(val)</span><span class="s3">\n\n        </span><span class="s1">// 初始化选区，将光标定位到内容尾部</span><span class="s3">\n        </span><span class="s1">editor.initSelection()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 将json设置成html至编辑器</span><span class="s3">\n     </span><span class="s1">* @param nodeList json格式</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public setJSON(nodeList: NodeListType): void {</span><span class="s3">\n        </span><span class="s1">const html = getHtmlByNodeList(nodeList).children()</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n        </span><span class="s1">// 没有获取到元素的情况</span><span class="s3">\n        </span><span class="s1">if (!html) return</span><span class="s3">\n        </span><span class="s1">// 替换文本节点下全部子节点</span><span class="s3">\n        </span><span class="s1">$textElem.replaceChildAll(html)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取 json 格式的数据</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public getJSON(): NodeListType {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n        </span><span class="s1">return getChildrenJSON($textElem)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 设置 字符串内容</span><span class="s3">\n     </span><span class="s1">* @param val text 字符串</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public text(val: string): void</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取 字符串内容</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public text(): string</span><span class="s3">\n    </span><span class="s1">public text(val?: string): void | string {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n\n        </span><span class="s1">// 没有 val ，是获取 text</span><span class="s3">\n        </span><span class="s1">if (val == null) {</span><span class="s3">\n            </span><span class="s1">let text = $textElem.text()</span><span class="s3">\n            </span><span class="s1">// 未选中任何内容的时候点击“加粗”或者“斜体”等按钮，就得需要一个空的占位符 &amp;#8203 ，这里替换掉</span><span class="s3">\n            </span><span class="s1">text = text.replace(/</span><span class="s3">\\</span><span class="s1">u200b/gm, '')</span><span class="s3">\n            </span><span class="s1">return text</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 有 val ，则是设置 text</span><span class="s3">\n        </span><span class="s1">$textElem.text(`&lt;p&gt;${val}&lt;/p&gt;`)</span><span class="s3">\n\n        </span><span class="s1">// 初始化选区，将光标定位到内容尾部</span><span class="s3">\n        </span><span class="s1">editor.initSelection()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 追加 html 内容</span><span class="s3">\n     </span><span class="s1">* @param html html 字符串</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public append(html: string): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">if (html.indexOf('&lt;') !== 0) {</span><span class="s3">\n            </span><span class="s1">// 普通字符串，用 &lt;p&gt; 包裹</span><span class="s3">\n            </span><span class="s1">html = `&lt;p&gt;${html}&lt;/p&gt;`</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">this.html(this.html() + html)</span><span class="s3">\n        </span><span class="s1">// 初始化选区，将光标定位到内容尾部</span><span class="s3">\n        </span><span class="s1">editor.initSelection()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 每一步操作，都实时保存选区范围</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private _saveRange(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n        </span><span class="s1">const $document = $(document)</span><span class="s3">\n\n        </span><span class="s1">// 保存当前的选区</span><span class="s3">\n        </span><span class="s1">function saveRange() {</span><span class="s3">\n            </span><span class="s1">// 随时保存选区</span><span class="s3">\n            </span><span class="s1">editor.selection.saveRange()</span><span class="s3">\n            </span><span class="s1">// 更新按钮 active 状态</span><span class="s3">\n            </span><span class="s1">editor.menus.changeActive()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 按键后保存</span><span class="s3">\n        </span><span class="s1">$textElem.on('keyup', saveRange)</span><span class="s3">\n\n        </span><span class="s1">// 点击后保存，为了避免被多次执行而导致造成浪费，这里对 click 使用一次性绑定</span><span class="s3">\n        </span><span class="s1">function onceClickSaveRange() {</span><span class="s3">\n            </span><span class="s1">saveRange()</span><span class="s3">\n            </span><span class="s1">$textElem.off('click', onceClickSaveRange)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">$textElem.on('click', onceClickSaveRange)</span><span class="s3">\n\n        </span><span class="s1">function handleMouseUp() {</span><span class="s3">\n            </span><span class="s1">// 在编辑器区域之外完成抬起，保存此时编辑区内的新选区，取消此时鼠标抬起事件</span><span class="s3">\n            </span><span class="s1">saveRange()</span><span class="s3">\n            </span><span class="s1">$document.off('mouseup', handleMouseUp)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">function listenMouseLeave() {</span><span class="s3">\n            </span><span class="s1">// 当鼠标移动到外面，要监听鼠标抬起操作</span><span class="s3">\n            </span><span class="s1">$document.on('mouseup', handleMouseUp)</span><span class="s3">\n            </span><span class="s1">// 首次移出时即接触leave监听，防止用户不断移入移出多次注册handleMouseUp</span><span class="s3">\n            </span><span class="s1">$textElem.off('mouseleave', listenMouseLeave)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">$textElem.on('mousedown', () =&gt; {</span><span class="s3">\n            </span><span class="s1">// mousedown 状态下，要坚听鼠标滑动到编辑区域外面</span><span class="s3">\n            </span><span class="s1">$textElem.on('mouseleave', listenMouseLeave)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">$textElem.on('mouseup', (e: MouseEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">// 记得移除$textElem的mouseleave事件, 避免内存泄露</span><span class="s3">\n            </span><span class="s1">$textElem.off('mouseleave', listenMouseLeave)</span><span class="s3">\n            </span><span class="s1">// fix：避免当选中一段文字之后，再次点击文字中间位置无法更新selection问题。issue#3096</span><span class="s3">\n            </span><span class="s1">setTimeout(() =&gt; {</span><span class="s3">\n                </span><span class="s1">const selection = editor.selection</span><span class="s3">\n                </span><span class="s1">const range = selection.getRange()</span><span class="s3">\n                </span><span class="s1">if (range === null) return</span><span class="s3">\n                </span><span class="s1">saveRange()</span><span class="s3">\n            </span><span class="s1">}, 0)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 绑定事件，事件会触发钩子函数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private _bindEventHooks(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n        </span><span class="s1">const eventHooks = this.eventHooks</span><span class="s3">\n\n        </span><span class="s1">// click hooks</span><span class="s3">\n        </span><span class="s1">$textElem.on('click', (e: Event) =&gt; {</span><span class="s3">\n            </span><span class="s1">const clickEvents = eventHooks.clickEvents</span><span class="s3">\n            </span><span class="s1">clickEvents.forEach(fn =&gt; fn(e))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// enter 键 up 时的 hooks</span><span class="s3">\n        </span><span class="s1">$textElem.on('keyup', (e: KeyboardEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (e.keyCode !== 13) return</span><span class="s3">\n            </span><span class="s1">const enterUpEvents = eventHooks.enterUpEvents</span><span class="s3">\n            </span><span class="s1">enterUpEvents.forEach(fn =&gt; fn(e))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// 键盘 up 时的 hooks</span><span class="s3">\n        </span><span class="s1">$textElem.on('keyup', (e: KeyboardEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">const keyupEvents = eventHooks.keyupEvents</span><span class="s3">\n            </span><span class="s1">keyupEvents.forEach(fn =&gt; fn(e))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// 键盘 down 时的 hooks</span><span class="s3">\n        </span><span class="s1">$textElem.on('keydown', (e: KeyboardEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">const keydownEvents = eventHooks.keydownEvents</span><span class="s3">\n            </span><span class="s1">keydownEvents.forEach(fn =&gt; fn(e))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// delete 键 up 时 hooks</span><span class="s3">\n        </span><span class="s1">$textElem.on('keyup', (e: KeyboardEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (e.keyCode !== 8 &amp;&amp; e.keyCode !== 46) return</span><span class="s3">\n            </span><span class="s1">const deleteUpEvents = eventHooks.deleteUpEvents</span><span class="s3">\n            </span><span class="s1">deleteUpEvents.forEach(fn =&gt; fn(e))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// delete 键 down 时 hooks</span><span class="s3">\n        </span><span class="s1">$textElem.on('keydown', (e: KeyboardEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (e.keyCode !== 8 &amp;&amp; e.keyCode !== 46) return</span><span class="s3">\n            </span><span class="s1">const deleteDownEvents = eventHooks.deleteDownEvents</span><span class="s3">\n            </span><span class="s1">deleteDownEvents.forEach(fn =&gt; fn(e))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// 粘贴</span><span class="s3">\n        </span><span class="s1">$textElem.on('paste', (e: ClipboardEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (UA.isIE()) return // IE 不支持</span><span class="s3">\n\n            </span><span class="s1">// 阻止默认行为，使用 execCommand 的粘贴命令</span><span class="s3">\n            </span><span class="s1">e.preventDefault()</span><span class="s3">\n\n            </span><span class="s1">const pasteEvents = eventHooks.pasteEvents</span><span class="s3">\n            </span><span class="s1">pasteEvents.forEach(fn =&gt; fn(e))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// 撤销/恢复 快捷键</span><span class="s3">\n        </span><span class="s1">$textElem.on('keydown', (e: KeyboardEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (</span><span class="s3">\n                </span><span class="s1">// 编辑器处于聚焦状态下（多编辑器实例） || 当前处于兼容模式（兼容模式撤销/恢复后不聚焦，所以直接过，但会造成多编辑器同时撤销/恢复）</span><span class="s3">\n                </span><span class="s1">(editor.isFocus || editor.isCompatibleMode) &amp;&amp;</span><span class="s3">\n                </span><span class="s1">(e.ctrlKey || e.metaKey) &amp;&amp;</span><span class="s3">\n                </span><span class="s1">e.keyCode === 90</span><span class="s3">\n            </span><span class="s1">) {</span><span class="s3">\n                </span><span class="s1">// 取消默认行为</span><span class="s3">\n                </span><span class="s1">e.preventDefault()</span><span class="s3">\n                </span><span class="s1">// 执行事件</span><span class="s3">\n                </span><span class="s1">if (e.shiftKey) {</span><span class="s3">\n                    </span><span class="s1">// 恢复</span><span class="s3">\n                    </span><span class="s1">editor.history.restore()</span><span class="s3">\n                </span><span class="s1">} else {</span><span class="s3">\n                    </span><span class="s1">// 撤销</span><span class="s3">\n                    </span><span class="s1">editor.history.revoke()</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// tab up</span><span class="s3">\n        </span><span class="s1">$textElem.on('keyup', (e: KeyboardEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (e.keyCode !== 9) return</span><span class="s3">\n            </span><span class="s1">e.preventDefault()</span><span class="s3">\n            </span><span class="s1">const tabUpEvents = eventHooks.tabUpEvents</span><span class="s3">\n            </span><span class="s1">tabUpEvents.forEach(fn =&gt; fn(e))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// tab down</span><span class="s3">\n        </span><span class="s1">$textElem.on('keydown', (e: KeyboardEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (e.keyCode !== 9) return</span><span class="s3">\n            </span><span class="s1">e.preventDefault()</span><span class="s3">\n            </span><span class="s1">const tabDownEvents = eventHooks.tabDownEvents</span><span class="s3">\n            </span><span class="s1">tabDownEvents.forEach(fn =&gt; fn(e))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// 文本编辑区域 滚动时触发</span><span class="s3">\n        </span><span class="s1">$textElem.on(</span><span class="s3">\n            </span><span class="s1">'scroll',</span><span class="s3">\n            </span><span class="s1">// 使用节流</span><span class="s3">\n            </span><span class="s1">throttle((e: Event) =&gt; {</span><span class="s3">\n                </span><span class="s1">const textScrollEvents = eventHooks.textScrollEvents</span><span class="s3">\n                </span><span class="s1">textScrollEvents.forEach(fn =&gt; fn(e))</span><span class="s3">\n            </span><span class="s1">}, 100)</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">// 拖拽相关的事件</span><span class="s3">\n        </span><span class="s1">function preventDefault(e: Event) {</span><span class="s3">\n            </span><span class="s1">// 禁用 document 拖拽事件</span><span class="s3">\n            </span><span class="s1">e.preventDefault()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">$(document)</span><span class="s3">\n            </span><span class="s1">.on('dragleave', preventDefault)</span><span class="s3">\n            </span><span class="s1">.on('drop', preventDefault)</span><span class="s3">\n            </span><span class="s1">.on('dragenter', preventDefault)</span><span class="s3">\n            </span><span class="s1">.on('dragover', preventDefault)</span><span class="s3">\n        </span><span class="s1">// 全局事件在编辑器实例销毁的时候进行解绑</span><span class="s3">\n        </span><span class="s1">editor.beforeDestroy(function () {</span><span class="s3">\n            </span><span class="s1">$(document)</span><span class="s3">\n                </span><span class="s1">.off('dragleave', preventDefault)</span><span class="s3">\n                </span><span class="s1">.off('drop', preventDefault)</span><span class="s3">\n                </span><span class="s1">.off('dragenter', preventDefault)</span><span class="s3">\n                </span><span class="s1">.off('dragover', preventDefault)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">$textElem.on('drop', (e: DragEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">e.preventDefault()</span><span class="s3">\n            </span><span class="s1">const events = eventHooks.dropEvents</span><span class="s3">\n            </span><span class="s1">events.forEach(fn =&gt; fn(e))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// link click</span><span class="s3">\n        </span><span class="s1">$textElem.on('click', (e: Event) =&gt; {</span><span class="s3">\n            </span><span class="s1">// 存储链接元素</span><span class="s3">\n            </span><span class="s1">let $link: DomElement | null = null</span><span class="s3">\n\n            </span><span class="s1">const target = e.target as HTMLElement</span><span class="s3">\n            </span><span class="s1">const $target = $(target)</span><span class="s3">\n            </span><span class="s1">if ($target.getNodeName() === 'A') {</span><span class="s3">\n                </span><span class="s1">// 当前点击的就是一个链接</span><span class="s3">\n                </span><span class="s1">$link = $target</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">// 否则，向父节点中寻找链接</span><span class="s3">\n                </span><span class="s1">const $parent = $target.parentUntil('a')</span><span class="s3">\n                </span><span class="s1">if ($parent != null) {</span><span class="s3">\n                    </span><span class="s1">// 找到了</span><span class="s3">\n                    </span><span class="s1">$link = $parent</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">if (!$link) return // 没有点击链接，则返回</span><span class="s3">\n\n            </span><span class="s1">const linkClickEvents = eventHooks.linkClickEvents</span><span class="s3">\n            </span><span class="s1">linkClickEvents.forEach(fn =&gt; fn($link as DomElement))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// img click</span><span class="s3">\n        </span><span class="s1">$textElem.on('click', (e: Event) =&gt; {</span><span class="s3">\n            </span><span class="s1">// 存储图片元素</span><span class="s3">\n            </span><span class="s1">let $img: DomElement | null = null</span><span class="s3">\n\n            </span><span class="s1">const target = e.target as HTMLElement</span><span class="s3">\n            </span><span class="s1">const $target = $(target)</span><span class="s3">\n\n            </span><span class="s1">//处理图片点击 去除掉emoji图片的情况</span><span class="s3">\n            </span><span class="s1">if ($target.getNodeName() === 'IMG' &amp;&amp; !$target.elems[0].getAttribute('data-emoji')) {</span><span class="s3">\n                </span><span class="s1">// 当前点击的就是img</span><span class="s3">\n                </span><span class="s1">e.stopPropagation()</span><span class="s3">\n                </span><span class="s1">$img = $target</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">if (!$img) return // 没有点击图片，则返回</span><span class="s3">\n\n            </span><span class="s1">const imgClickEvents = eventHooks.imgClickEvents</span><span class="s3">\n            </span><span class="s1">imgClickEvents.forEach(fn =&gt; fn($img as DomElement))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// code click</span><span class="s3">\n        </span><span class="s1">$textElem.on('click', (e: Event) =&gt; {</span><span class="s3">\n            </span><span class="s1">// 存储代码元素</span><span class="s3">\n            </span><span class="s1">let $code: DomElement | null = null</span><span class="s3">\n\n            </span><span class="s1">const target = e.target as HTMLElement</span><span class="s3">\n            </span><span class="s1">const $target = $(target)</span><span class="s3">\n            </span><span class="s1">if ($target.getNodeName() === 'PRE') {</span><span class="s3">\n                </span><span class="s1">// 当前点击的就是一个链接</span><span class="s3">\n                </span><span class="s1">$code = $target</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">// 否则，向父节点中寻找链接</span><span class="s3">\n                </span><span class="s1">const $parent = $target.parentUntil('pre')</span><span class="s3">\n                </span><span class="s1">if ($parent !== null) {</span><span class="s3">\n                    </span><span class="s1">// 找到了</span><span class="s3">\n                    </span><span class="s1">$code = $parent</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">if (!$code) return</span><span class="s3">\n\n            </span><span class="s1">const codeClickEvents = eventHooks.codeClickEvents</span><span class="s3">\n            </span><span class="s1">codeClickEvents.forEach(fn =&gt; fn($code as DomElement))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// splitLine click</span><span class="s3">\n        </span><span class="s1">$textElem.on('click', (e: Event) =&gt; {</span><span class="s3">\n            </span><span class="s1">// 存储分割线元素</span><span class="s3">\n            </span><span class="s1">let $splitLine: DomElement | null = null</span><span class="s3">\n\n            </span><span class="s1">const target = e.target as HTMLElement</span><span class="s3">\n            </span><span class="s1">const $target = $(target)</span><span class="s3">\n            </span><span class="s1">// 判断当前点击元素</span><span class="s3">\n            </span><span class="s1">if ($target.getNodeName() === 'HR') {</span><span class="s3">\n                </span><span class="s1">$splitLine = $target</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">$target == null</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">if (!$splitLine) return // 没有点击分割线，则返回</span><span class="s3">\n            </span><span class="s1">// 设置、恢复选区</span><span class="s3">\n            </span><span class="s1">editor.selection.createRangeByElem($splitLine)</span><span class="s3">\n            </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n            </span><span class="s1">const splitLineClickEvents = eventHooks.splitLineEvents</span><span class="s3">\n            </span><span class="s1">splitLineClickEvents.forEach(fn =&gt; fn($splitLine as DomElement))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// 菜单栏被点击</span><span class="s3">\n        </span><span class="s1">editor.$toolbarElem.on('click', (e: Event) =&gt; {</span><span class="s3">\n            </span><span class="s1">const toolbarClickEvents = eventHooks.toolbarClickEvents</span><span class="s3">\n            </span><span class="s1">toolbarClickEvents.forEach(fn =&gt; fn(e))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">//mousedown事件</span><span class="s3">\n        </span><span class="s1">editor.$textContainerElem.on('mousedown', (e: MouseEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">const target = e.target as HTMLElement</span><span class="s3">\n            </span><span class="s1">const $target = $(target)</span><span class="s3">\n            </span><span class="s1">if ($target.hasClass('w-e-img-drag-rb')) {</span><span class="s3">\n                </span><span class="s1">// 点击的元素，是图片拖拽调整大小的 bar</span><span class="s3">\n                </span><span class="s1">const imgDragBarMouseDownEvents = eventHooks.imgDragBarMouseDownEvents</span><span class="s3">\n                </span><span class="s1">imgDragBarMouseDownEvents.forEach(fn =&gt; fn())</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">//table click</span><span class="s3">\n        </span><span class="s1">$textElem.on('click', (e: MouseEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">// 存储元素</span><span class="s3">\n            </span><span class="s1">let $dom: DomElement | null = null</span><span class="s3">\n\n            </span><span class="s1">const target = e.target as HTMLElement</span><span class="s3">\n\n            </span><span class="s1">//获取最祖父元素</span><span class="s3">\n            </span><span class="s1">$dom = $(target).parentUntilEditor('TABLE', editor, target)</span><span class="s3">\n\n            </span><span class="s1">// 没有table范围内，则返回</span><span class="s3">\n            </span><span class="s1">if (!$dom) return</span><span class="s3">\n\n            </span><span class="s1">const tableClickEvents = eventHooks.tableClickEvents</span><span class="s3">\n            </span><span class="s1">tableClickEvents.forEach(fn =&gt; fn($dom as DomElement, e))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// enter 键 down</span><span class="s3">\n        </span><span class="s1">$textElem.on('keydown', (e: KeyboardEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (e.keyCode !== 13) return</span><span class="s3">\n            </span><span class="s1">const enterDownEvents = eventHooks.enterDownEvents</span><span class="s3">\n            </span><span class="s1">enterDownEvents.forEach(fn =&gt; fn(e))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// 视频 click</span><span class="s3">\n        </span><span class="s1">$textElem.on('click', (e: Event) =&gt; {</span><span class="s3">\n            </span><span class="s1">// 存储视频</span><span class="s3">\n            </span><span class="s1">let $video: DomElement | null = null</span><span class="s3">\n\n            </span><span class="s1">const target = e.target as HTMLElement</span><span class="s3">\n            </span><span class="s1">const $target = $(target)</span><span class="s3">\n\n            </span><span class="s1">//处理视频点击 简单的video 标签</span><span class="s3">\n            </span><span class="s1">if ($target.getNodeName() === 'VIDEO') {</span><span class="s3">\n                </span><span class="s1">// 当前点击的就是视频</span><span class="s3">\n                </span><span class="s1">e.stopPropagation()</span><span class="s3">\n                </span><span class="s1">$video = $target</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">if (!$video) return // 没有点击视频，则返回</span><span class="s3">\n\n            </span><span class="s1">const videoClickEvents = eventHooks.videoClickEvents</span><span class="s3">\n            </span><span class="s1">videoClickEvents.forEach(fn =&gt; fn($video as DomElement))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Text</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/instance/find');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var find = require('../array/virtual/find');</span><span class="s3">\n\n</span><span class="s1">var ArrayPrototype = Array.prototype;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">var own = it.find;</span><span class="s3">\n  </span><span class="s1">return it === ArrayPrototype || (it instanceof Array &amp;&amp; own === ArrayPrototype.find) ? find : own;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../../modules/es.array.find');</span><span class="s3">\n</span><span class="s1">var entryVirtual = require('../../../internals/entry-virtual');</span><span class="s3">\n\n</span><span class="s1">module.exports = entryVirtual('Array').find;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var $find = require('../internals/array-iteration').find;</span><span class="s3">\n</span><span class="s1">var addToUnscopables = require('../internals/add-to-unscopables');</span><span class="s3">\n</span><span class="s1">var arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');</span><span class="s3">\n\n</span><span class="s1">var FIND = 'find';</span><span class="s3">\n</span><span class="s1">var SKIPS_HOLES = true;</span><span class="s3">\n\n</span><span class="s1">var USES_TO_LENGTH = arrayMethodUsesToLength(FIND);</span><span class="s3">\n\n</span><span class="s1">// Shouldn't skip holes</span><span class="s3">\n</span><span class="s1">if (FIND in []) Array(1)[FIND](function () { SKIPS_HOLES = false; });</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.find` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.find</span><span class="s3">\n</span><span class="s1">$({ target: 'Array', proto: true, forced: SKIPS_HOLES || !USES_TO_LENGTH }, {</span><span class="s3">\n  </span><span class="s1">find: function find(callbackfn /* , that = undefined */) {</span><span class="s3">\n    </span><span class="s1">return $find(this, callbackfn, arguments.length &gt; 1 ? arguments[1] : undefined);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables</span><span class="s3">\n</span><span class="s1">addToUnscopables(FIND);</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description Text 事件钩子函数。Text 公共的，不是某个菜单独有的</span><span class="s3">\n </span><span class="s1">* @wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Text from '../index'</span><span class="s3">\n</span><span class="s1">import enterToCreateP from './enter-to-create-p'</span><span class="s3">\n</span><span class="s1">import deleteToKeepP, { cutToKeepP } from './del-to-keep-p'</span><span class="s3">\n</span><span class="s1">import tabToSpan from './tab-to-space'</span><span class="s3">\n</span><span class="s1">import pasteTextHtml from './paste-text-html'</span><span class="s3">\n</span><span class="s1">import imgClickActive from './img-click-active'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 初始化 text 事件钩子函数</span><span class="s3">\n </span><span class="s1">* @param text text 实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function initTextHooks(text: Text): void {</span><span class="s3">\n    </span><span class="s1">const editor = text.editor</span><span class="s3">\n    </span><span class="s1">const eventHooks = text.eventHooks</span><span class="s3">\n\n    </span><span class="s1">// 回车时，保证生成的是 &lt;p&gt; 标签</span><span class="s3">\n    </span><span class="s1">enterToCreateP(editor, eventHooks.enterUpEvents, eventHooks.enterDownEvents)</span><span class="s3">\n\n    </span><span class="s1">// 删除时，保留 EMPTY_P</span><span class="s3">\n    </span><span class="s1">deleteToKeepP(editor, eventHooks.deleteUpEvents, eventHooks.deleteDownEvents)</span><span class="s3">\n\n    </span><span class="s1">// 剪切时, 保留p</span><span class="s3">\n    </span><span class="s1">cutToKeepP(editor, eventHooks.keyupEvents)</span><span class="s3">\n\n    </span><span class="s1">// tab 转换为空格</span><span class="s3">\n    </span><span class="s1">tabToSpan(editor, eventHooks.tabDownEvents)</span><span class="s3">\n\n    </span><span class="s1">// 粘贴 text html</span><span class="s3">\n    </span><span class="s1">pasteTextHtml(editor, eventHooks.pasteEvents)</span><span class="s3">\n\n    </span><span class="s1">// img click active</span><span class="s3">\n    </span><span class="s1">imgClickActive(editor, eventHooks.imgClickEvents)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default initTextHooks</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 回车时，保证生成的是 &lt;p&gt; 标签</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../../utils/const'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 回车时，保证生成的是 &lt;p&gt; 标签</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">* @param enterUpEvents enter 键 up 时的 hooks</span><span class="s3">\n </span><span class="s1">* @param enterDownEvents enter 键 down 时的 hooks</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function enterToCreateP(editor: Editor, enterUpEvents: Function[], enterDownEvents: Function[]) {</span><span class="s3">\n    </span><span class="s1">function insertEmptyP($selectionElem: DomElement) {</span><span class="s3">\n        </span><span class="s1">const $p = $(EMPTY_P)</span><span class="s3">\n        </span><span class="s1">$p.insertBefore($selectionElem)</span><span class="s3">\n        </span><span class="s1">if ($selectionElem.html().indexOf('&lt;img') &gt;= 0) {</span><span class="s3">\n            </span><span class="s1">// 有图片的回车键弹起时</span><span class="s3">\n            </span><span class="s1">$p.remove()</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">editor.selection.createRangeByElem($p, true, true)</span><span class="s3">\n        </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n        </span><span class="s1">$selectionElem.remove()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// enter up 时</span><span class="s3">\n    </span><span class="s1">function fn() {</span><span class="s3">\n        </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n        </span><span class="s1">const $selectionElem = editor.selection.getSelectionContainerElem() as DomElement</span><span class="s3">\n        </span><span class="s1">const $parentElem = $selectionElem.parent()</span><span class="s3">\n\n        </span><span class="s1">if ($parentElem.html() === '&lt;code&gt;&lt;br&gt;&lt;/code&gt;') {</span><span class="s3">\n            </span><span class="s1">// 回车之前光标所在一个 &lt;p&gt;&lt;code&gt;.....&lt;/code&gt;&lt;/p&gt; ，忽然回车生成一个空的 &lt;p&gt;&lt;code&gt;&lt;br&gt;&lt;/code&gt;&lt;/p&gt;</span><span class="s3">\n            </span><span class="s1">// 而且继续回车跳不出去，因此只能特殊处理</span><span class="s3">\n            </span><span class="s1">insertEmptyP($parentElem)</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (</span><span class="s3">\n            </span><span class="s1">$selectionElem.getNodeName() === 'FONT' &amp;&amp;</span><span class="s3">\n            </span><span class="s1">$selectionElem.text() === '' &amp;&amp;</span><span class="s3">\n            </span><span class="s1">$selectionElem.attr('face') === 'monospace'</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n            </span><span class="s1">// 行内code回车时会产生一个&lt;font face=</span><span class="s3">\&quot;</span><span class="s1">monospace</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;br&gt;&lt;/font&gt;，导致样式问题</span><span class="s3">\n            </span><span class="s1">insertEmptyP($parentElem)</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (!$parentElem.equal($textElem)) {</span><span class="s3">\n            </span><span class="s1">// 不是顶级标签</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const nodeName = $selectionElem.getNodeName()</span><span class="s3">\n        </span><span class="s1">if (nodeName === 'P' &amp;&amp; $selectionElem.attr('data-we-empty-p') === null) {</span><span class="s3">\n            </span><span class="s1">// 当前的标签是 P 且不为 editor 生成的空白占位 p 标签，不用做处理</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if ($selectionElem.text()) {</span><span class="s3">\n            </span><span class="s1">// 有内容，不做处理</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 插入 &lt;p&gt; ，并将选取定位到 &lt;p&gt;，删除当前标签</span><span class="s3">\n        </span><span class="s1">insertEmptyP($selectionElem)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">enterUpEvents.push(fn)</span><span class="s3">\n\n    </span><span class="s1">// enter down 时</span><span class="s3">\n    </span><span class="s1">function createPWhenEnterText(e: Event) {</span><span class="s3">\n        </span><span class="s1">// selection中的range缓存还有问题,更新不及时,此处手动更新range,处理enter的bug</span><span class="s3">\n        </span><span class="s1">editor.selection.saveRange(getSelection()?.getRangeAt(0))</span><span class="s3">\n        </span><span class="s1">const $selectElem = editor.selection.getSelectionContainerElem() as DomElement</span><span class="s3">\n        </span><span class="s1">if ($selectElem.id === editor.textElemId) {</span><span class="s3">\n            </span><span class="s1">// 回车时，默认创建了 text 标签（没有 p 标签包裹），父元素直接就是 $textElem</span><span class="s3">\n            </span><span class="s1">// 例如，光标放在 table 最后侧，回车时，默认就是这个情况</span><span class="s3">\n            </span><span class="s1">e.preventDefault()</span><span class="s3">\n            </span><span class="s1">editor.cmd.do('insertHTML', '&lt;p&gt;&lt;br&gt;&lt;/p&gt;')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">enterDownEvents.push(createPWhenEnterText)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default enterToCreateP</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 删除时保留 EMPTY_P</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { EMPTY_P } from '../../utils/const'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 删除时保留 EMPTY_P</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">* @param deleteUpEvents delete 键 up 时的 hooks</span><span class="s3">\n </span><span class="s1">* @param deleteDownEvents delete 建 down 时的 hooks</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function deleteToKeepP(editor: Editor, deleteUpEvents: Function[], deleteDownEvents: Function[]) {</span><span class="s3">\n    </span><span class="s1">function upFn() {</span><span class="s3">\n        </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n        </span><span class="s1">const html = editor.$textElem.html()</span><span class="s3">\n        </span><span class="s1">const text = editor.$textElem.text()</span><span class="s3">\n        </span><span class="s1">const txtHtml = html.trim()</span><span class="s3">\n        </span><span class="s1">/**</span><span class="s3">\n          </span><span class="s1">@description </span><span class="s3">\n            </span><span class="s1">如果编辑区清空的状态下，单单插入一张图片，删除图片后，会存在空的情况：'&lt;p data-we-empty-p=</span><span class="s3">\&quot;\&quot;</span><span class="s1">&gt;&lt;/p&gt;'</span><span class="s3">\n            </span><span class="s1">需要包含这种边界情况</span><span class="s3">\n        </span><span class="s1">**/</span><span class="s3">\n\n        </span><span class="s1">const emptyTags: string[] = ['&lt;p&gt;&lt;br&gt;&lt;/p&gt;', '&lt;br&gt;', '&lt;p data-we-empty-p=</span><span class="s3">\&quot;\&quot;</span><span class="s1">&gt;&lt;/p&gt;', EMPTY_P]</span><span class="s3">\n\n        </span><span class="s1">// 编辑器中的字符是</span><span class="s3">\&quot;\&quot;</span><span class="s1">或空白，说明内容为空</span><span class="s3">\n        </span><span class="s1">if (/^</span><span class="s3">\\</span><span class="s1">s*$/.test(text) &amp;&amp; (!txtHtml || emptyTags.includes(txtHtml))) {</span><span class="s3">\n            </span><span class="s1">// 内容空了</span><span class="s3">\n            </span><span class="s1">$textElem.html(EMPTY_P)</span><span class="s3">\n\n            </span><span class="s1">/**</span><span class="s3">\n             </span><span class="s1">* 当编辑器 - 文本区内容为空的情况下，会插入一个空的P，此时应该将选区移动到这个空标签上，重置选区</span><span class="s3">\n             </span><span class="s1">* bug: 如果选区没有从$textElem上调整到p上，就会有问题，在清空内容，设置标题时，会报错。</span><span class="s3">\n             </span><span class="s1">*/</span><span class="s3">\n            </span><span class="s1">const containerElem = $textElem.getNode()</span><span class="s3">\n\n            </span><span class="s1">// 设置新的选区</span><span class="s3">\n            </span><span class="s1">editor.selection.createRangeByElems(</span><span class="s3">\n                </span><span class="s1">containerElem.childNodes[0],</span><span class="s3">\n                </span><span class="s1">containerElem.childNodes[0]</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n\n            </span><span class="s1">const $selectionElem = editor.selection.getSelectionContainerElem()!</span><span class="s3">\n\n            </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n\n            </span><span class="s1">// 设置折叠后的光标位置，在firebox等浏览器下</span><span class="s3">\n            </span><span class="s1">// 光标设置在end位置会自动换行</span><span class="s3">\n            </span><span class="s1">editor.selection.moveCursor($selectionElem.getNode(), 0)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">deleteUpEvents.push(upFn)</span><span class="s3">\n\n    </span><span class="s1">function downFn(e: Event) {</span><span class="s3">\n        </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n        </span><span class="s1">const txtHtml = $textElem.html().toLowerCase().trim()</span><span class="s3">\n        </span><span class="s1">if (txtHtml === EMPTY_P) {</span><span class="s3">\n            </span><span class="s1">// 最后剩下一个空行，就不再删除了</span><span class="s3">\n            </span><span class="s1">e.preventDefault()</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">deleteDownEvents.push(downFn)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 剪切时保留 EMPTY_P</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">* @param cutEvents keydown hooks</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function cutToKeepP(editor: Editor, cutEvents: Function[]) {</span><span class="s3">\n    </span><span class="s1">function upFn(e: KeyboardEvent) {</span><span class="s3">\n        </span><span class="s1">if (e.keyCode !== 88) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n        </span><span class="s1">const txtHtml = $textElem.html().toLowerCase().trim()</span><span class="s3">\n\n        </span><span class="s1">// firefox 时用 txtHtml === '&lt;br&gt;' 判断，其他用 !txtHtml 判断</span><span class="s3">\n        </span><span class="s1">if (!txtHtml || txtHtml === '&lt;br&gt;') {</span><span class="s3">\n            </span><span class="s1">// 内容空了</span><span class="s3">\n            </span><span class="s1">const $p = $(EMPTY_P)</span><span class="s3">\n            </span><span class="s1">$textElem.html(' ') // 一定要先清空，否则在 firefox 下有问题</span><span class="s3">\n            </span><span class="s1">$textElem.append($p)</span><span class="s3">\n            </span><span class="s1">editor.selection.createRangeByElem($p, false, true)</span><span class="s3">\n            </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n            </span><span class="s1">// 设置折叠后的光标位置，在firebox等浏览器下</span><span class="s3">\n            </span><span class="s1">// 光标设置在end位置会自动换行</span><span class="s3">\n            </span><span class="s1">editor.selection.moveCursor($p.getNode(), 0)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">cutEvents.push(upFn)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default deleteToKeepP</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 编辑区域 tab 的特殊处理</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 编辑区域 tab 的特殊处理，转换为空格</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">* @param tabDownEvents tab down 事件钩子</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function tabHandler(editor: Editor, tabDownEvents: Function[]) {</span><span class="s3">\n    </span><span class="s1">// 定义函数</span><span class="s3">\n    </span><span class="s1">function fn() {</span><span class="s3">\n        </span><span class="s1">if (!editor.cmd.queryCommandSupported('insertHTML')) {</span><span class="s3">\n            </span><span class="s1">// 必须原生支持 insertHTML 命令</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">const $selectionElem = editor.selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">if (!$selectionElem) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">const $parentElem = $selectionElem.parent()</span><span class="s3">\n        </span><span class="s1">const selectionNodeName = $selectionElem.getNodeName()</span><span class="s3">\n        </span><span class="s1">const parentNodeName = $parentElem.getNodeName()</span><span class="s3">\n\n        </span><span class="s1">if (</span><span class="s3">\n            </span><span class="s1">selectionNodeName == 'CODE' ||</span><span class="s3">\n            </span><span class="s1">parentNodeName === 'CODE' ||</span><span class="s3">\n            </span><span class="s1">parentNodeName === 'PRE' ||</span><span class="s3">\n            </span><span class="s1">/hljs/.test(parentNodeName)</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n            </span><span class="s1">// &lt;pre&gt;&lt;code&gt; 里面</span><span class="s3">\n            </span><span class="s1">editor.cmd.do('insertHTML', editor.config.languageTab)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 普通文字</span><span class="s3">\n            </span><span class="s1">editor.cmd.do('insertHTML', '&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 保留函数</span><span class="s3">\n    </span><span class="s1">tabDownEvents.push(fn)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default tabHandler</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 粘贴 text html</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { getPasteText, getPasteHtml } from '../paste/paste-event'</span><span class="s3">\n</span><span class="s1">import { isFunction } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import { urlRegex } from '../../utils/const'</span><span class="s3">\n</span><span class="s1">import { DomElement } from '../../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 格式化html</span><span class="s3">\n </span><span class="s1">* @param val 粘贴的html</span><span class="s3">\n </span><span class="s1">* @author Gavin</span><span class="s3">\n </span><span class="s1">* @description</span><span class="s3">\n    </span><span class="s1">格式化html，需要特别注意</span><span class="s3">\n    </span><span class="s1">功能：</span><span class="s3">\n        </span><span class="s1">1. 将htmlText中的div，都替换成p标签</span><span class="s3">\n        </span><span class="s1">2. 将处理后的htmlText模拟先插入到真实dom中，处理P截断问题。</span><span class="s3">\n\n    </span><span class="s1">注意点：</span><span class="s3">\n        </span><span class="s1">由于P不能嵌套p，会导致标签截断，从而将&lt;p&gt;&lt;p&gt;xx&lt;/p&gt;&lt;/p&gt;这样一个结构插入到页面时，会出现很多问题，包括光标位置问题，页面凭空多很多元素的问题。</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function formatHtml(htmlText: string) {</span><span class="s3">\n    </span><span class="s1">const paste = htmlText</span><span class="s3">\n        </span><span class="s1">.replace(/&lt;div&gt;/gim, '&lt;p&gt;') // div 全部替换为 p 标签</span><span class="s3">\n        </span><span class="s1">.replace(/&lt;</span><span class="s3">\\</span><span class="s1">/div&gt;/gim, '&lt;/p&gt;')</span><span class="s3">\n        </span><span class="s1">.trim() // 去除''</span><span class="s3">\n\n    </span><span class="s1">// 模拟插入到真实dom中</span><span class="s3">\n    </span><span class="s1">const tempContainer = document.createElement('div')</span><span class="s3">\n\n    </span><span class="s1">tempContainer.innerHTML = paste</span><span class="s3">\n\n    </span><span class="s1">return tempContainer.innerHTML.replace(/&lt;p&gt;&lt;</span><span class="s3">\\</span><span class="s1">/p&gt;/gim, '') // 将被截断的p，都替换掉</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 格式化html</span><span class="s3">\n </span><span class="s1">* @param val 粘贴的html</span><span class="s3">\n </span><span class="s1">* @author liuwei</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function formatCode(val: string) {</span><span class="s3">\n    </span><span class="s1">let pasteText = val.replace(/&lt;br&gt;|&lt;br</span><span class="s3">\\</span><span class="s1">/&gt;/gm, '</span><span class="s3">\\</span><span class="s1">n').replace(/&lt;[^&gt;]+&gt;/gm, '')</span><span class="s3">\n\n    </span><span class="s1">return pasteText</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 判断html是否使用P标签包裹</span><span class="s3">\n </span><span class="s1">* @param html 粘贴的html</span><span class="s3">\n </span><span class="s1">* @author luochao</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function isParagraphHtml(html: string): boolean {</span><span class="s3">\n    </span><span class="s1">if (html === '') return false</span><span class="s3">\n\n    </span><span class="s1">const container = document.createElement('div')</span><span class="s3">\n    </span><span class="s1">container.innerHTML = html</span><span class="s3">\n\n    </span><span class="s1">return container.firstChild?.nodeName === 'P'</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 判断当前选区是否是空段落</span><span class="s3">\n </span><span class="s1">* @param topElem 选区顶层元素</span><span class="s3">\n </span><span class="s1">* @author luochao</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function isEmptyParagraph(topElem: DomElement | undefined): boolean {</span><span class="s3">\n    </span><span class="s1">if (!topElem?.length) return false</span><span class="s3">\n\n    </span><span class="s1">const dom = topElem.elems[0]</span><span class="s3">\n\n    </span><span class="s1">return dom.nodeName === 'P' &amp;&amp; dom.innerHTML === '&lt;br&gt;'</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 粘贴文本和 html</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器对象</span><span class="s3">\n </span><span class="s1">* @param pasteEvents 粘贴事件列表</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function pasteTextHtml(editor: Editor, pasteEvents: Function[]) {</span><span class="s3">\n    </span><span class="s1">function fn(e: Event) {</span><span class="s3">\n        </span><span class="s1">// 获取配置</span><span class="s3">\n        </span><span class="s1">const config = editor.config</span><span class="s3">\n        </span><span class="s1">const pasteFilterStyle = config.pasteFilterStyle</span><span class="s3">\n        </span><span class="s1">const pasteIgnoreImg = config.pasteIgnoreImg</span><span class="s3">\n        </span><span class="s1">const pasteTextHandle = config.pasteTextHandle</span><span class="s3">\n\n        </span><span class="s1">// 获取粘贴的文字</span><span class="s3">\n        </span><span class="s1">let pasteHtml = getPasteHtml(e as ClipboardEvent, pasteFilterStyle, pasteIgnoreImg)</span><span class="s3">\n        </span><span class="s1">let pasteText = getPasteText(e as ClipboardEvent)</span><span class="s3">\n        </span><span class="s1">pasteText = pasteText.replace(/</span><span class="s3">\\</span><span class="s1">n/gm, '&lt;br&gt;')</span><span class="s3">\n        </span><span class="s1">// 当前选区所在的 DOM 节点</span><span class="s3">\n        </span><span class="s1">const $selectionElem = editor.selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">if (!$selectionElem) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">const nodeName = $selectionElem?.getNodeName()</span><span class="s3">\n        </span><span class="s1">const $topElem = $selectionElem?.getNodeTop(editor)</span><span class="s3">\n        </span><span class="s1">// 当前节点顶级可能没有</span><span class="s3">\n        </span><span class="s1">let topNodeName: string = ''</span><span class="s3">\n        </span><span class="s1">if ($topElem.elems[0]) {</span><span class="s3">\n            </span><span class="s1">topNodeName = $topElem?.getNodeName()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// code 中只能粘贴纯文本</span><span class="s3">\n        </span><span class="s1">if (nodeName === 'CODE' || topNodeName === 'PRE') {</span><span class="s3">\n            </span><span class="s1">if (pasteTextHandle &amp;&amp; isFunction(pasteTextHandle)) {</span><span class="s3">\n                </span><span class="s1">// 用户自定义过滤处理粘贴内容</span><span class="s3">\n                </span><span class="s1">pasteText = '' + (pasteTextHandle(pasteText) || '')</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">editor.cmd.do('insertHTML', formatCode(pasteText))</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 如果用户开启闭粘贴样式注释则将复制进来为url的直接转为链接 否则不转换。</span><span class="s3">\n        </span><span class="s1">//  在群中有用户提到关闭样式粘贴复制的文字进来后链接直接转为文字了，不符合预期，这里优化下</span><span class="s3">\n        </span><span class="s1">if (urlRegex.test(pasteText) &amp;&amp; pasteFilterStyle) {</span><span class="s3">\n            </span><span class="s1">//当复制的内容为链接时，也应该判断用户是否定义了处理粘贴的事件</span><span class="s3">\n            </span><span class="s1">if (pasteTextHandle &amp;&amp; isFunction(pasteTextHandle)) {</span><span class="s3">\n                </span><span class="s1">// 用户自定义过滤处理粘贴内容</span><span class="s3">\n                </span><span class="s1">pasteText = '' + (pasteTextHandle(pasteText) || '') // html</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 当复制一个链接和文本时，需要区分出文本和a链接, 如：http://www.baidu.com  搜索。 issue: #3129</span><span class="s3">\n            </span><span class="s1">// 目前也支持粘贴文案：粘贴http://www.baidu.com粘贴http://www.baidu.com，连个链接。</span><span class="s3">\n            </span><span class="s1">const resultText = pasteText.replace(urlRegex, function (link: string) {</span><span class="s3">\n                </span><span class="s1">return `&lt;a href=</span><span class="s3">\&quot;</span><span class="s1">${link}</span><span class="s3">\&quot; </span><span class="s1">target=</span><span class="s3">\&quot;</span><span class="s1">_blank</span><span class="s3">\&quot;</span><span class="s1">&gt;${link}&lt;/a&gt;`</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">const range = editor.selection.getRange()</span><span class="s3">\n\n            </span><span class="s1">// 文本转义问题，如果直接使用innerHTML插入html结构，地址中的特殊字符会被转义</span><span class="s3">\n            </span><span class="s1">// 先生成元素，替换里面的文本，利用insertElem插入到页面</span><span class="s3">\n            </span><span class="s1">const div = document.createElement('div')</span><span class="s3">\n            </span><span class="s1">const fragment = document.createDocumentFragment()</span><span class="s3">\n\n            </span><span class="s1">div.innerHTML = resultText</span><span class="s3">\n\n            </span><span class="s1">if (range == null) return</span><span class="s3">\n\n            </span><span class="s1">// 将div里的dom结构，搬到fragment里</span><span class="s3">\n            </span><span class="s1">while (div.childNodes.length) {</span><span class="s3">\n                </span><span class="s1">fragment.append(div.childNodes[0])</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 修改a 链接文案，使用innerText插入文本，这样就避免了使用innerHTML时把特殊符号转义</span><span class="s3">\n            </span><span class="s1">const linkEle = fragment.querySelectorAll('a')</span><span class="s3">\n            </span><span class="s1">linkEle.forEach(ele =&gt; {</span><span class="s3">\n                </span><span class="s1">ele.innerText = ele.href</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n\n            </span><span class="s1">if (range.insertNode) {</span><span class="s3">\n                </span><span class="s1">range.deleteContents()</span><span class="s3">\n                </span><span class="s1">range.insertNode(fragment)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">editor.selection.clearWindowSelectionRange()</span><span class="s3">\n\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// table 中（td、th），待开发。。。</span><span class="s3">\n        </span><span class="s1">if (!pasteHtml) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">try {</span><span class="s3">\n            </span><span class="s1">// firefox 中，获取的 pasteHtml 可能是没有 &lt;ul&gt; 包裹的 &lt;li&gt;</span><span class="s3">\n            </span><span class="s1">// 因此执行 insertHTML 会报错</span><span class="s3">\n            </span><span class="s1">if (pasteTextHandle &amp;&amp; isFunction(pasteTextHandle)) {</span><span class="s3">\n                </span><span class="s1">// 用户自定义过滤处理粘贴内容</span><span class="s3">\n                </span><span class="s1">pasteHtml = '' + (pasteTextHandle(pasteHtml) || '') // html</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">// 粘贴的html的是否是css的style样式</span><span class="s3">\n            </span><span class="s1">let isCssStyle: boolean = /[</span><span class="s3">\\</span><span class="s1">.</span><span class="s3">\\</span><span class="s1">#</span><span class="s3">\\</span><span class="s1">@]?</span><span class="s3">\\</span><span class="s1">w+[ ]+</span><span class="s3">\\</span><span class="s1">{[^}]*</span><span class="s3">\\</span><span class="s1">}/.test(pasteHtml) // eslint-disable-line</span><span class="s3">\n            </span><span class="s1">// 经过处理后还是包含暴露的css样式则直接插入它的text</span><span class="s3">\n            </span><span class="s1">if (isCssStyle &amp;&amp; pasteFilterStyle) {</span><span class="s3">\n                </span><span class="s1">editor.cmd.do('insertHTML', `${formatHtml(pasteText)}`) // text</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">const html = formatHtml(pasteHtml)</span><span class="s3">\n                </span><span class="s1">// 如果是段落，为了兼容 firefox 和 chrome差异，自定义插入</span><span class="s3">\n                </span><span class="s1">if (isParagraphHtml(html)) {</span><span class="s3">\n                    </span><span class="s1">const $textEl = editor.$textElem</span><span class="s3">\n                    </span><span class="s1">editor.cmd.do('insertHTML', html)</span><span class="s3">\n                    </span><span class="s1">// 全选的情况下覆盖原有内容</span><span class="s3">\n                    </span><span class="s1">if ($textEl.equal($selectionElem)) {</span><span class="s3">\n                        </span><span class="s1">// 更新选区</span><span class="s3">\n                        </span><span class="s1">editor.selection.createEmptyRange()</span><span class="s3">\n                        </span><span class="s1">return</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">// 如果选区是空段落，移除空段落</span><span class="s3">\n                    </span><span class="s1">if (isEmptyParagraph($topElem)) {</span><span class="s3">\n                        </span><span class="s1">$topElem.remove()</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">} else {</span><span class="s3">\n                    </span><span class="s1">editor.cmd.do('insertHTML', html)</span><span class="s3">\n\n                    </span><span class="s1">// 如果用户从百度等网站点击复制得到的图片是一串img标签且待src的http地址</span><span class="s3">\n                    </span><span class="s1">// 见 https://github.com/wangeditor-team/wangEditor/issues/3119</span><span class="s3">\n                    </span><span class="s1">// 如果是走用户定义的图片上传逻辑</span><span class="s3">\n                    </span><span class="s1">// const isHasOnlyImgEleReg = /^&lt;img [^&gt;]*src=['</span><span class="s3">\&quot;</span><span class="s1">]([^'</span><span class="s3">\&quot;</span><span class="s1">]+)[^&gt;]*&gt;$/g</span><span class="s3">\n                    </span><span class="s1">// if (!isHasOnlyImgEleReg.test(html)) {</span><span class="s3">\n                    </span><span class="s1">//     editor.cmd.do('insertHTML', html)</span><span class="s3">\n                    </span><span class="s1">// }</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">} catch (ex) {</span><span class="s3">\n            </span><span class="s1">// 此时使用 pasteText 来兼容一下</span><span class="s3">\n            </span><span class="s1">if (pasteTextHandle &amp;&amp; isFunction(pasteTextHandle)) {</span><span class="s3">\n                </span><span class="s1">// 用户自定义过滤处理粘贴内容</span><span class="s3">\n                </span><span class="s1">pasteText = '' + (pasteTextHandle(pasteText) || '')</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">editor.cmd.do('insertHTML', `${formatHtml(pasteText)}`) // text</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">pasteEvents.push(fn)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default pasteTextHtml</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 将粘贴的 html 字符串，转换为正确、简洁的 html 代码。剔除不必要的标签和属性。</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { EMPTY_TAGS, IGNORE_TAGS, NECESSARY_ATTRS } from './tags'</span><span class="s3">\n</span><span class="s1">import HtmlParser from '../../lib/simplehtmlparser.js'</span><span class="s3">\n\n</span><span class="s1">type AttrType = {</span><span class="s3">\n    </span><span class="s1">name: string</span><span class="s3">\n    </span><span class="s1">value: string</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 过滤掉空 span</span><span class="s3">\n </span><span class="s1">* @param html html</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function filterEmptySpan(html: string): string {</span><span class="s3">\n    </span><span class="s1">const regForReplace = /&lt;span&gt;.*?&lt;</span><span class="s3">\\</span><span class="s1">/span&gt;/gi</span><span class="s3">\n    </span><span class="s1">const regForMatch = /&lt;span&gt;(.*?)&lt;</span><span class="s3">\\</span><span class="s1">/span&gt;/</span><span class="s3">\n    </span><span class="s1">return html.replace(regForReplace, (s: string): string =&gt; {</span><span class="s3">\n        </span><span class="s1">// s 是单个 span ，如 &lt;span&gt;文字&lt;/span&gt;</span><span class="s3">\n        </span><span class="s1">const result = s.match(regForMatch)</span><span class="s3">\n        </span><span class="s1">if (result == null) return ''</span><span class="s3">\n        </span><span class="s1">return result[1]</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 是否忽略标签</span><span class="s3">\n </span><span class="s1">* @param tag tag</span><span class="s3">\n </span><span class="s1">* @param ignoreImg 是否忽略 img 标签</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function isIgnoreTag(tag: string, ignoreImg: boolean): boolean {</span><span class="s3">\n    </span><span class="s1">tag = tag.toLowerCase().trim()</span><span class="s3">\n\n    </span><span class="s1">// 忽略的标签</span><span class="s3">\n    </span><span class="s1">if (IGNORE_TAGS.has(tag)) {</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 是否忽略图片</span><span class="s3">\n    </span><span class="s1">if (ignoreImg) {</span><span class="s3">\n        </span><span class="s1">if (tag === 'img') {</span><span class="s3">\n            </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return false</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 为 tag 生成 html 字符串，开始部分</span><span class="s3">\n </span><span class="s1">* @param tag tag</span><span class="s3">\n </span><span class="s1">* @param attrs 属性</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function genStartHtml(tag: string, attrs: AttrType[]): string {</span><span class="s3">\n    </span><span class="s1">let result = ''</span><span class="s3">\n\n    </span><span class="s1">// tag &lt; 符号</span><span class="s3">\n    </span><span class="s1">result = `&lt;${tag}`</span><span class="s3">\n\n    </span><span class="s1">// 拼接属性</span><span class="s3">\n    </span><span class="s1">let attrStrArr: string[] = []</span><span class="s3">\n    </span><span class="s1">attrs.forEach((attr: AttrType) =&gt; {</span><span class="s3">\n        </span><span class="s1">attrStrArr.push(`${attr.name}=</span><span class="s3">\&quot;</span><span class="s1">${attr.value}</span><span class="s3">\&quot;</span><span class="s1">`)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">if (attrStrArr.length &gt; 0) {</span><span class="s3">\n        </span><span class="s1">result = result + ' ' + attrStrArr.join(' ')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// tag &gt; 符号</span><span class="s3">\n    </span><span class="s1">const isEmpty = EMPTY_TAGS.has(tag) // 没有子节点或文本的标签，如 img</span><span class="s3">\n    </span><span class="s1">result = result + (isEmpty ? '/' : '') + '&gt;'</span><span class="s3">\n\n    </span><span class="s1">return result</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 为 tag 生成 html 字符串，结尾部分</span><span class="s3">\n </span><span class="s1">* @param tag tag</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function genEndHtml(tag: string) {</span><span class="s3">\n    </span><span class="s1">return `&lt;/${tag}&gt;`</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 处理粘贴的 html</span><span class="s3">\n </span><span class="s1">* @param html html 字符串</span><span class="s3">\n </span><span class="s1">* @param filterStyle 是否过滤 style 样式</span><span class="s3">\n </span><span class="s1">* @param ignoreImg 是否忽略 img 标签</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function parseHtml(html: string, filterStyle: boolean = true, ignoreImg: boolean = false): string {</span><span class="s3">\n    </span><span class="s1">let resultArr: string[] = [] // 存储结果，数组形式，最后再 join</span><span class="s3">\n\n    </span><span class="s1">// 当前正在处理的标签，以及记录和清除的方法</span><span class="s3">\n    </span><span class="s1">let CUR_TAG = ''</span><span class="s3">\n    </span><span class="s1">function markTagStart(tag: string): void {</span><span class="s3">\n        </span><span class="s1">tag = tag.trim()</span><span class="s3">\n        </span><span class="s1">if (!tag) return</span><span class="s3">\n        </span><span class="s1">if (EMPTY_TAGS.has(tag)) return // 内容为空的标签，如 img ，不用记录</span><span class="s3">\n        </span><span class="s1">CUR_TAG = tag</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">function markTagEnd(): void {</span><span class="s3">\n        </span><span class="s1">CUR_TAG = ''</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 能通过 'text/html' 格式获取 html</span><span class="s3">\n    </span><span class="s1">const htmlParser = new HtmlParser()</span><span class="s3">\n    </span><span class="s1">htmlParser.parse(html, {</span><span class="s3">\n        </span><span class="s1">startElement(tag: string, attrs: []) {</span><span class="s3">\n            </span><span class="s1">// 首先，标记开始</span><span class="s3">\n            </span><span class="s1">markTagStart(tag)</span><span class="s3">\n\n            </span><span class="s1">// 忽略的标签</span><span class="s3">\n            </span><span class="s1">if (isIgnoreTag(tag, ignoreImg)) {</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 找出该标签必须的属性（其他的属性忽略）</span><span class="s3">\n            </span><span class="s1">const necessaryAttrKeys = NECESSARY_ATTRS.get(tag) || []</span><span class="s3">\n            </span><span class="s1">const attrsForTag: AttrType[] = []</span><span class="s3">\n            </span><span class="s1">attrs.forEach((attr: AttrType) =&gt; {</span><span class="s3">\n                </span><span class="s1">// 属性名</span><span class="s3">\n                </span><span class="s1">const name = attr.name</span><span class="s3">\n\n                </span><span class="s1">// style 单独处理</span><span class="s3">\n                </span><span class="s1">if (name === 'style') {</span><span class="s3">\n                    </span><span class="s1">// 保留 style 样式</span><span class="s3">\n                    </span><span class="s1">if (!filterStyle) {</span><span class="s3">\n                        </span><span class="s1">attrsForTag.push(attr)</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">return</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// 除了 style 之外的其他属性</span><span class="s3">\n                </span><span class="s1">if (necessaryAttrKeys.includes(name) === false) {</span><span class="s3">\n                    </span><span class="s1">// 不是必须的属性，忽略</span><span class="s3">\n                    </span><span class="s1">return</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">attrsForTag.push(attr)</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n\n            </span><span class="s1">// 拼接为 HTML 标签</span><span class="s3">\n            </span><span class="s1">const html = genStartHtml(tag, attrsForTag)</span><span class="s3">\n            </span><span class="s1">resultArr.push(html)</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">characters(str: string) {</span><span class="s3">\n            </span><span class="s1">if (!str) {</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 忽略的标签</span><span class="s3">\n            </span><span class="s1">if (isIgnoreTag(CUR_TAG, ignoreImg)) return</span><span class="s3">\n            </span><span class="s1">resultArr.push(str)</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">endElement(tag: string) {</span><span class="s3">\n            </span><span class="s1">// 忽略的标签</span><span class="s3">\n            </span><span class="s1">if (isIgnoreTag(tag, ignoreImg)) {</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 拼接为 HTML 标签</span><span class="s3">\n            </span><span class="s1">const html = genEndHtml(tag)</span><span class="s3">\n            </span><span class="s1">resultArr.push(html)</span><span class="s3">\n\n            </span><span class="s1">// 最后，标记结束</span><span class="s3">\n            </span><span class="s1">markTagEnd()</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">comment(str: string) {</span><span class="s3">\n            </span><span class="s1">/* 注释，不做处理 */</span><span class="s3">\n            </span><span class="s1">markTagStart(str)</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">let result = resultArr.join('') // 转换为字符串</span><span class="s3">\n\n    </span><span class="s1">// 过滤掉空 span 标签</span><span class="s3">\n    </span><span class="s1">result = filterEmptySpan(result)</span><span class="s3">\n\n    </span><span class="s1">return result</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default parseHtml</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 粘贴相关的 tags</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">// 忽略的标签</span><span class="s3">\n</span><span class="s1">export const IGNORE_TAGS = new Set([</span><span class="s3">\n    </span><span class="s1">'doctype',</span><span class="s3">\n    </span><span class="s1">'!doctype',</span><span class="s3">\n    </span><span class="s1">'html',</span><span class="s3">\n    </span><span class="s1">'head',</span><span class="s3">\n    </span><span class="s1">'meta',</span><span class="s3">\n    </span><span class="s1">'body',</span><span class="s3">\n    </span><span class="s1">'script',</span><span class="s3">\n    </span><span class="s1">'style',</span><span class="s3">\n    </span><span class="s1">'link',</span><span class="s3">\n    </span><span class="s1">'frame',</span><span class="s3">\n    </span><span class="s1">'iframe',</span><span class="s3">\n    </span><span class="s1">'title',</span><span class="s3">\n    </span><span class="s1">'svg', // 暂时忽略，有需要再修改</span><span class="s3">\n    </span><span class="s1">'center',</span><span class="s3">\n    </span><span class="s1">'o:p', // 复制 word 内容包含 o:p 标签</span><span class="s3">\n</span><span class="s1">])</span><span class="s3">\n\n</span><span class="s1">// 指定标签必要的属性</span><span class="s3">\n</span><span class="s1">export const NECESSARY_ATTRS = new Map([</span><span class="s3">\n    </span><span class="s1">['img', ['src', 'alt']],</span><span class="s3">\n    </span><span class="s1">['a', ['href', 'target']],</span><span class="s3">\n    </span><span class="s1">['td', ['colspan', 'rowspan']],</span><span class="s3">\n    </span><span class="s1">['th', ['colspan', 'rowspan']],</span><span class="s3">\n</span><span class="s1">])</span><span class="s3">\n\n</span><span class="s1">// 没有子节点或文本的标签</span><span class="s3">\n</span><span class="s1">export const EMPTY_TAGS = new Set([</span><span class="s3">\n    </span><span class="s1">'area',</span><span class="s3">\n    </span><span class="s1">'base',</span><span class="s3">\n    </span><span class="s1">'basefont',</span><span class="s3">\n    </span><span class="s1">'br',</span><span class="s3">\n    </span><span class="s1">'col',</span><span class="s3">\n    </span><span class="s1">'hr',</span><span class="s3">\n    </span><span class="s1">'img',</span><span class="s3">\n    </span><span class="s1">'input',</span><span class="s3">\n    </span><span class="s1">'isindex',</span><span class="s3">\n    </span><span class="s1">'embed',</span><span class="s3">\n</span><span class="s1">])</span><span class="s3">\n\n</span><span class="s1">// 编辑区域顶级节点</span><span class="s3">\n</span><span class="s1">export const TOP_LEVEL_TAGS = new Set([</span><span class="s3">\n    </span><span class="s1">'h1',</span><span class="s3">\n    </span><span class="s1">'h2',</span><span class="s3">\n    </span><span class="s1">'h3',</span><span class="s3">\n    </span><span class="s1">'h4',</span><span class="s3">\n    </span><span class="s1">'h5',</span><span class="s3">\n    </span><span class="s1">'p',</span><span class="s3">\n    </span><span class="s1">'ul',</span><span class="s3">\n    </span><span class="s1">'ol',</span><span class="s3">\n    </span><span class="s1">'table',</span><span class="s3">\n    </span><span class="s1">'blockquote', // 引用</span><span class="s3">\n    </span><span class="s1">'pre', // 代码</span><span class="s3">\n    </span><span class="s1">'hr',</span><span class="s3">\n    </span><span class="s1">'form',</span><span class="s3">\n</span><span class="s1">])</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/set');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.set');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.object.to-string');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.string.iterator');</span><span class="s3">\n</span><span class="s1">require('../../modules/web.dom-collections.iterator');</span><span class="s3">\n</span><span class="s1">var path = require('../../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.Set;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var collection = require('../internals/collection');</span><span class="s3">\n</span><span class="s1">var collectionStrong = require('../internals/collection-strong');</span><span class="s3">\n\n</span><span class="s1">// `Set` constructor</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-set-objects</span><span class="s3">\n</span><span class="s1">module.exports = collection('Set', function (init) {</span><span class="s3">\n  </span><span class="s1">return function Set() { return init(this, arguments.length ? arguments[0] : undefined); };</span><span class="s3">\n</span><span class="s1">}, collectionStrong);</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;// Copyright 2004 Erik Arvidsson. All Rights Reserved.</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">// This code is triple licensed using Apache Software License 2.0,</span><span class="s3">\n</span><span class="s1">// Mozilla Public License or GNU Public License</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">///////////////////////////////////////////////////////////////////////////////</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">// Licensed under the Apache License, Version 2.0 (the </span><span class="s3">\&quot;</span><span class="s1">License</span><span class="s3">\&quot;</span><span class="s1">); you may not</span><span class="s3">\n</span><span class="s1">// use this file except in compliance with the License.  You may obtain a copy</span><span class="s3">\n</span><span class="s1">// of the License at http://www.apache.org/licenses/LICENSE-2.0</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">///////////////////////////////////////////////////////////////////////////////</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">// The contents of this file are subject to the Mozilla Public License</span><span class="s3">\n</span><span class="s1">// Version 1.1 (the </span><span class="s3">\&quot;</span><span class="s1">License</span><span class="s3">\&quot;</span><span class="s1">); you may not use this file except in</span><span class="s3">\n</span><span class="s1">// compliance with the License. You may obtain a copy of the License at</span><span class="s3">\n</span><span class="s1">// http://www.mozilla.org/MPL/</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">// Software distributed under the License is distributed on an </span><span class="s3">\&quot;</span><span class="s1">AS IS</span><span class="s3">\&quot;\n</span><span class="s1">// basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the</span><span class="s3">\n</span><span class="s1">// License for the specific language governing rights and limitations</span><span class="s3">\n</span><span class="s1">// under the License.</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">// The Original Code is Simple HTML Parser.</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">// The Initial Developer of the Original Code is Erik Arvidsson.</span><span class="s3">\n</span><span class="s1">// Portions created by Erik Arvidssson are Copyright (C) 2004. All Rights</span><span class="s3">\n</span><span class="s1">// Reserved.</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">///////////////////////////////////////////////////////////////////////////////</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">// This program is free software; you can redistribute it and/or</span><span class="s3">\n</span><span class="s1">// modify it under the terms of the GNU General Public License</span><span class="s3">\n</span><span class="s1">// as published by the Free Software Foundation; either version 2</span><span class="s3">\n</span><span class="s1">// of the License, or (at your option) any later version.</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">// This program is distributed in the hope that it will be useful,</span><span class="s3">\n</span><span class="s1">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span><span class="s3">\n</span><span class="s1">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><span class="s3">\n</span><span class="s1">// GNU General Public License for more details.</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">// You should have received a copy of the GNU General Public License</span><span class="s3">\n</span><span class="s1">// along with this program; if not, write to the Free Software</span><span class="s3">\n</span><span class="s1">// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">///////////////////////////////////////////////////////////////////////////////</span><span class="s3">\n\n</span><span class="s1">/*</span><span class="s3">\n</span><span class="s1">var handler ={</span><span class="s3">\n\t</span><span class="s1">startElement:   function (sTagName, oAttrs) {},</span><span class="s3">\n\t</span><span class="s1">endElement:     function (sTagName) {},</span><span class="s3">\n    </span><span class="s1">characters:</span><span class="s3">\t\t</span><span class="s1">function (s) {},</span><span class="s3">\n    </span><span class="s1">comment:</span><span class="s3">\t\t</span><span class="s1">function (s) {}</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">function SimpleHtmlParser() {}</span><span class="s3">\n\n</span><span class="s1">SimpleHtmlParser.prototype = {</span><span class="s3">\n    </span><span class="s1">handler: null,</span><span class="s3">\n\n    </span><span class="s1">// regexps</span><span class="s3">\n\n    </span><span class="s1">startTagRe: /^&lt;([^&gt;</span><span class="s3">\\</span><span class="s1">s</span><span class="s3">\\</span><span class="s1">/]+)((</span><span class="s3">\\</span><span class="s1">s+[^=&gt;</span><span class="s3">\\</span><span class="s1">s]+(</span><span class="s3">\\</span><span class="s1">s*=</span><span class="s3">\\</span><span class="s1">s*((</span><span class="s3">\\\&quot;</span><span class="s1">[^</span><span class="s3">\&quot;</span><span class="s1">]*</span><span class="s3">\\\&quot;</span><span class="s1">)|(</span><span class="s3">\\</span><span class="s1">'[^']*</span><span class="s3">\\</span><span class="s1">')|[^&gt;</span><span class="s3">\\</span><span class="s1">s]+))?)*)</span><span class="s3">\\</span><span class="s1">s*</span><span class="s3">\\</span><span class="s1">/?</span><span class="s3">\\</span><span class="s1">s*&gt;/m,</span><span class="s3">\n    </span><span class="s1">endTagRe: /^&lt;</span><span class="s3">\\</span><span class="s1">/([^&gt;</span><span class="s3">\\</span><span class="s1">s]+)[^&gt;]*&gt;/m,</span><span class="s3">\n    </span><span class="s1">attrRe: /([^=</span><span class="s3">\\</span><span class="s1">s]+)(</span><span class="s3">\\</span><span class="s1">s*=</span><span class="s3">\\</span><span class="s1">s*((</span><span class="s3">\\\&quot;</span><span class="s1">([^</span><span class="s3">\&quot;</span><span class="s1">]*)</span><span class="s3">\\\&quot;</span><span class="s1">)|(</span><span class="s3">\\</span><span class="s1">'([^']*)</span><span class="s3">\\</span><span class="s1">')|[^&gt;</span><span class="s3">\\</span><span class="s1">s]+))?/gm,</span><span class="s3">\n\n    </span><span class="s1">parse: function (s, oHandler) {</span><span class="s3">\n        </span><span class="s1">if (oHandler) this.contentHandler = oHandler</span><span class="s3">\n\n        </span><span class="s1">var i = 0</span><span class="s3">\n        </span><span class="s1">var res, lc, lm, rc, index</span><span class="s3">\n        </span><span class="s1">var treatAsChars = false</span><span class="s3">\n        </span><span class="s1">var oThis = this</span><span class="s3">\n        </span><span class="s1">while (s.length &gt; 0) {</span><span class="s3">\n            </span><span class="s1">// Comment</span><span class="s3">\n            </span><span class="s1">if (s.substring(0, 4) == '&lt;!--') {</span><span class="s3">\n                </span><span class="s1">index = s.indexOf('--&gt;')</span><span class="s3">\n                </span><span class="s1">if (index != -1) {</span><span class="s3">\n                    </span><span class="s1">this.contentHandler.comment(s.substring(4, index))</span><span class="s3">\n                    </span><span class="s1">s = s.substring(index + 3)</span><span class="s3">\n                    </span><span class="s1">treatAsChars = false</span><span class="s3">\n                </span><span class="s1">} else {</span><span class="s3">\n                    </span><span class="s1">treatAsChars = true</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// end tag</span><span class="s3">\n            </span><span class="s1">else if (s.substring(0, 2) == '&lt;/') {</span><span class="s3">\n                </span><span class="s1">if (this.endTagRe.test(s)) {</span><span class="s3">\n                    </span><span class="s1">lc = RegExp.leftContext</span><span class="s3">\n                    </span><span class="s1">lm = RegExp.lastMatch</span><span class="s3">\n                    </span><span class="s1">rc = RegExp.rightContext</span><span class="s3">\n\n                    </span><span class="s1">lm.replace(this.endTagRe, function () {</span><span class="s3">\n                        </span><span class="s1">return oThis.parseEndTag.apply(oThis, arguments)</span><span class="s3">\n                    </span><span class="s1">})</span><span class="s3">\n\n                    </span><span class="s1">s = rc</span><span class="s3">\n                    </span><span class="s1">treatAsChars = false</span><span class="s3">\n                </span><span class="s1">} else {</span><span class="s3">\n                    </span><span class="s1">treatAsChars = true</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">// start tag</span><span class="s3">\n            </span><span class="s1">else if (s.charAt(0) == '&lt;') {</span><span class="s3">\n                </span><span class="s1">if (this.startTagRe.test(s)) {</span><span class="s3">\n                    </span><span class="s1">lc = RegExp.leftContext</span><span class="s3">\n                    </span><span class="s1">lm = RegExp.lastMatch</span><span class="s3">\n                    </span><span class="s1">rc = RegExp.rightContext</span><span class="s3">\n\n                    </span><span class="s1">lm.replace(this.startTagRe, function () {</span><span class="s3">\n                        </span><span class="s1">return oThis.parseStartTag.apply(oThis, arguments)</span><span class="s3">\n                    </span><span class="s1">})</span><span class="s3">\n\n                    </span><span class="s1">s = rc</span><span class="s3">\n                    </span><span class="s1">treatAsChars = false</span><span class="s3">\n                </span><span class="s1">} else {</span><span class="s3">\n                    </span><span class="s1">treatAsChars = true</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">if (treatAsChars) {</span><span class="s3">\n                </span><span class="s1">index = s.indexOf('&lt;')</span><span class="s3">\n                </span><span class="s1">if (index == -1) {</span><span class="s3">\n                    </span><span class="s1">this.contentHandler.characters(s)</span><span class="s3">\n                    </span><span class="s1">s = ''</span><span class="s3">\n                </span><span class="s1">} else {</span><span class="s3">\n                    </span><span class="s1">this.contentHandler.characters(s.substring(0, index))</span><span class="s3">\n                    </span><span class="s1">s = s.substring(index)</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">treatAsChars = true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n\n    </span><span class="s1">parseStartTag: function (sTag, sTagName, sRest) {</span><span class="s3">\n        </span><span class="s1">var attrs = this.parseAttributes(sTagName, sRest)</span><span class="s3">\n        </span><span class="s1">this.contentHandler.startElement(sTagName, attrs)</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n\n    </span><span class="s1">parseEndTag: function (sTag, sTagName) {</span><span class="s3">\n        </span><span class="s1">this.contentHandler.endElement(sTagName)</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n\n    </span><span class="s1">parseAttributes: function (sTagName, s) {</span><span class="s3">\n        </span><span class="s1">var oThis = this</span><span class="s3">\n        </span><span class="s1">var attrs = []</span><span class="s3">\n        </span><span class="s1">s.replace(this.attrRe, function (a0, a1, a2, a3, a4, a5, a6, a7) {</span><span class="s3">\n            </span><span class="s1">attrs.push(oThis.parseAttribute(sTagName, a0, a1, a2, a3, a4, a5, a6, a7))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">return attrs</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n\n    </span><span class="s1">parseAttribute: function (sTagName, sAttribute, sName) {</span><span class="s3">\n        </span><span class="s1">var value = ''</span><span class="s3">\n        </span><span class="s1">if (arguments[7]) value = arguments[8]</span><span class="s3">\n        </span><span class="s1">else if (arguments[5]) value = arguments[6]</span><span class="s3">\n        </span><span class="s1">else if (arguments[3]) value = arguments[4]</span><span class="s3">\n\n        </span><span class="s1">var empty = !value &amp;&amp; !arguments[3]</span><span class="s3">\n        </span><span class="s1">return { name: sName, value: empty ? null : value }</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// export default SimpleHtmlParser</span><span class="s3">\n</span><span class="s1">module.exports = SimpleHtmlParser</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 图片点击后选区更新到img的位置</span><span class="s3">\n </span><span class="s1">* @author tonghan</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { DomElement } from '../../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 图片点击后选区更新到img的位置</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">* @param imgClickEvents delete 键 up 时的 hooks</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function imgClickActive(editor: Editor, imgClickEvents: Function[]) {</span><span class="s3">\n    </span><span class="s1">function clickFn($img: DomElement) {</span><span class="s3">\n        </span><span class="s1">editor.selection.createRangeByElem($img)</span><span class="s3">\n        </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">imgClickEvents.push(clickFn)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default imgClickActive</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 获取子元素的 JSON 格式数据</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { replaceHtmlSymbol } from '../utils/util'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">type AttrType = {</span><span class="s3">\n    </span><span class="s1">name: string</span><span class="s3">\n    </span><span class="s1">value: string</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">export type NodeType = {</span><span class="s3">\n    </span><span class="s1">tag: string</span><span class="s3">\n    </span><span class="s1">attrs: AttrType[]</span><span class="s3">\n    </span><span class="s1">children: NodeListType</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">export type NodeListType = Array&lt;string | NodeType&gt;</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 获取子元素的 JSON 格式数据</span><span class="s3">\n </span><span class="s1">* @param $elem DOM 节点</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function getChildrenJSON($elem: DomElement): NodeListType {</span><span class="s3">\n    </span><span class="s1">const result: NodeListType = [] // 存储结果</span><span class="s3">\n\n    </span><span class="s1">const $children = $elem.childNodes() || [] // 注意 childNodes() 可以获取文本节点</span><span class="s3">\n    </span><span class="s1">$children.forEach((curElem: HTMLElement) =&gt; {</span><span class="s3">\n        </span><span class="s1">let elemResult</span><span class="s3">\n        </span><span class="s1">const nodeType = curElem.nodeType</span><span class="s3">\n\n        </span><span class="s1">// 文本节点</span><span class="s3">\n        </span><span class="s1">if (nodeType === 3) {</span><span class="s3">\n            </span><span class="s1">elemResult = curElem.textContent || ''</span><span class="s3">\n            </span><span class="s1">elemResult = replaceHtmlSymbol(elemResult)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 普通 DOM 节点</span><span class="s3">\n        </span><span class="s1">if (nodeType === 1) {</span><span class="s3">\n            </span><span class="s1">elemResult = {}</span><span class="s3">\n            </span><span class="s1">elemResult = elemResult as NodeType</span><span class="s3">\n\n            </span><span class="s1">// tag</span><span class="s3">\n            </span><span class="s1">elemResult.tag = curElem.nodeName.toLowerCase()</span><span class="s3">\n            </span><span class="s1">// attr</span><span class="s3">\n            </span><span class="s1">const attrData = []</span><span class="s3">\n            </span><span class="s1">const attrList = curElem.attributes</span><span class="s3">\n            </span><span class="s1">const attrListLength = attrList.length || 0</span><span class="s3">\n            </span><span class="s1">for (let i = 0; i &lt; attrListLength; i++) {</span><span class="s3">\n                </span><span class="s1">const attr = attrList[i]</span><span class="s3">\n                </span><span class="s1">attrData.push({</span><span class="s3">\n                    </span><span class="s1">name: attr.name,</span><span class="s3">\n                    </span><span class="s1">value: attr.value,</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">elemResult.attrs = attrData</span><span class="s3">\n            </span><span class="s1">// children（递归）</span><span class="s3">\n            </span><span class="s1">elemResult.children = getChildrenJSON($(curElem))</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (elemResult) {</span><span class="s3">\n            </span><span class="s1">result.push(elemResult)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">return result</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default getChildrenJSON</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 从nodeList json格式中遍历生成dom元素</span><span class="s3">\n </span><span class="s1">* @author zhengwenjian</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from './../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { NodeListType } from './getChildrenJSON'</span><span class="s3">\n\n</span><span class="s1">function getHtmlByNodeList(</span><span class="s3">\n    </span><span class="s1">nodeList: NodeListType,</span><span class="s3">\n    </span><span class="s1">parent: Node = document.createElement('div')</span><span class="s3">\n</span><span class="s1">): DomElement {</span><span class="s3">\n    </span><span class="s1">// 设置一个父节点存储所有子节点</span><span class="s3">\n    </span><span class="s1">let root = parent</span><span class="s3">\n\n    </span><span class="s1">// 遍历节点JSON</span><span class="s3">\n    </span><span class="s1">nodeList.forEach(item =&gt; {</span><span class="s3">\n        </span><span class="s1">let elem: Text | Node | undefined</span><span class="s3">\n\n        </span><span class="s1">// 当为文本节点时</span><span class="s3">\n        </span><span class="s1">if (typeof item === 'string') {</span><span class="s3">\n            </span><span class="s1">elem = document.createTextNode(item)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 当为普通节点时</span><span class="s3">\n        </span><span class="s1">if (typeof item === 'object') {</span><span class="s3">\n            </span><span class="s1">elem = document.createElement(item.tag)</span><span class="s3">\n            </span><span class="s1">item.attrs.forEach(attr =&gt; {</span><span class="s3">\n                </span><span class="s1">$(elem).attr(attr.name, attr.value)</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n\n            </span><span class="s1">// 有子节点时递归将子节点加入当前节点</span><span class="s3">\n            </span><span class="s1">if (item.children &amp;&amp; item.children.length &gt; 0) {</span><span class="s3">\n                </span><span class="s1">getHtmlByNodeList(item.children, elem.getRootNode())</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">elem &amp;&amp; root.appendChild(elem)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">return $(root)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default getHtmlByNodeList</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description Menus 菜单栏 入口文件</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../editor/index'</span><span class="s3">\n</span><span class="s1">import Menu from './menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import MenuConstructorList, { MenuListType } from './menu-list'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from './../utils/dom-core'</span><span class="s3">\n</span><span class="s1">// import { MenuActive } from './menu-constructors/Menu'</span><span class="s3">\n\n</span><span class="s1">class Menus {</span><span class="s3">\n    </span><span class="s1">public editor: Editor</span><span class="s3">\n    </span><span class="s1">public menuList: Menu[]</span><span class="s3">\n    </span><span class="s1">public constructorList: MenuListType</span><span class="s3">\n\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">this.editor = editor</span><span class="s3">\n        </span><span class="s1">this.menuList = []</span><span class="s3">\n        </span><span class="s1">this.constructorList = MenuConstructorList // 所有菜单构造函数的列表</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 自定义添加菜单</span><span class="s3">\n     </span><span class="s1">* @param key 菜单 key ，和 editor.config.menus 对应</span><span class="s3">\n     </span><span class="s1">* @param Menu 菜单构造函数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public extend(key: string, Menu: any) {</span><span class="s3">\n        </span><span class="s1">if (!Menu || typeof Menu !== 'function') return</span><span class="s3">\n        </span><span class="s1">this.constructorList[key] = Menu</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 初始化菜单</span><span class="s3">\n    </span><span class="s1">public init(): void {</span><span class="s3">\n        </span><span class="s1">// 从用户配置的 menus 入手，看需要初始化哪些菜单</span><span class="s3">\n        </span><span class="s1">const config = this.editor.config</span><span class="s3">\n\n        </span><span class="s1">// 排除exclude包含的菜单</span><span class="s3">\n        </span><span class="s1">let excludeMenus: string[] | any = config.excludeMenus</span><span class="s3">\n        </span><span class="s1">if (Array.isArray(excludeMenus) === false) excludeMenus = []</span><span class="s3">\n        </span><span class="s1">config.menus = config.menus.filter(key =&gt; excludeMenus.includes(key) === false)</span><span class="s3">\n\n        </span><span class="s1">// 排除自扩展中exclude包含的菜单</span><span class="s3">\n        </span><span class="s1">let CustomMenuKeysList: string[] = Object.keys(Editor.globalCustomMenuConstructorList)</span><span class="s3">\n        </span><span class="s1">CustomMenuKeysList = CustomMenuKeysList.filter(key =&gt; excludeMenus.includes(key))</span><span class="s3">\n        </span><span class="s1">CustomMenuKeysList.forEach((key: string) =&gt; {</span><span class="s3">\n            </span><span class="s1">delete Editor.globalCustomMenuConstructorList[key]</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">config.menus.forEach(menuKey =&gt; {</span><span class="s3">\n            </span><span class="s1">const MenuConstructor = this.constructorList[menuKey] // 暂用 any ，后面再替换</span><span class="s3">\n            </span><span class="s1">this._initMenuList(menuKey, MenuConstructor)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// 全局注册</span><span class="s3">\n        </span><span class="s1">for (let [menuKey, menuFun] of Object.entries(Editor.globalCustomMenuConstructorList)) {</span><span class="s3">\n            </span><span class="s1">const MenuConstructor = menuFun // 暂用 any ，后面再替换</span><span class="s3">\n            </span><span class="s1">this._initMenuList(menuKey, MenuConstructor)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 渲染 DOM</span><span class="s3">\n        </span><span class="s1">this._addToToolbar()</span><span class="s3">\n\n        </span><span class="s1">if (config.showMenuTooltips) {</span><span class="s3">\n            </span><span class="s1">// 添加菜单栏tooltips</span><span class="s3">\n            </span><span class="s1">this._bindMenuTooltips()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 创建 menu 实例，并放到 menuList 中</span><span class="s3">\n     </span><span class="s1">* @param menuKey 菜单 key ，和 editor.config.menus 对应</span><span class="s3">\n     </span><span class="s1">* @param MenuConstructor 菜单构造函数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private _initMenuList(menuKey: String, MenuConstructor: any): void {</span><span class="s3">\n        </span><span class="s1">if (MenuConstructor == null || typeof MenuConstructor !== 'function') {</span><span class="s3">\n            </span><span class="s1">// 必须是 class</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (this.menuList.some(menu =&gt; menu.key === menuKey)) {</span><span class="s3">\n            </span><span class="s1">console.warn('菜单名称重复:' + menuKey)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">const m = new MenuConstructor(this.editor)</span><span class="s3">\n            </span><span class="s1">m.key = menuKey</span><span class="s3">\n            </span><span class="s1">this.menuList.push(m)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 绑定菜单栏tooltips</span><span class="s3">\n    </span><span class="s1">private _bindMenuTooltips(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $toolbarElem = editor.$toolbarElem</span><span class="s3">\n        </span><span class="s1">const config = editor.config</span><span class="s3">\n\n        </span><span class="s1">// 若isTooltipShowTop为true则伪元素为下三角，反之为上三角</span><span class="s3">\n        </span><span class="s1">const menuTooltipPosition = config.menuTooltipPosition</span><span class="s3">\n        </span><span class="s1">const $tooltipEl = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu-tooltip w-e-menu-tooltip-${menuTooltipPosition}</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n            </span><span class="s1">&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu-tooltip-item-wrapper</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n              </span><span class="s1">&lt;div&gt;&lt;/div&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;</span><span class="s3">\n          </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">$tooltipEl.css('visibility', 'hidden')</span><span class="s3">\n        </span><span class="s1">$toolbarElem.append($tooltipEl)</span><span class="s3">\n        </span><span class="s1">// 设置 z-index</span><span class="s3">\n        </span><span class="s1">$tooltipEl.css('z-index', editor.zIndex.get('tooltip'))</span><span class="s3">\n\n        </span><span class="s1">let showTimeoutId: number = 0 // 定时器，延时200ms显示tooltips</span><span class="s3">\n        </span><span class="s1">// 清空计时器</span><span class="s3">\n        </span><span class="s1">function clearShowTimeoutId() {</span><span class="s3">\n            </span><span class="s1">if (showTimeoutId) {</span><span class="s3">\n                </span><span class="s1">clearTimeout(showTimeoutId)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 隐藏tooltip</span><span class="s3">\n        </span><span class="s1">function hide() {</span><span class="s3">\n            </span><span class="s1">clearShowTimeoutId()</span><span class="s3">\n            </span><span class="s1">$tooltipEl.css('visibility', 'hidden')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 事件监听</span><span class="s3">\n        </span><span class="s1">$toolbarElem</span><span class="s3">\n            </span><span class="s1">.on('mouseover', (e: MouseEvent) =&gt; {</span><span class="s3">\n                </span><span class="s1">const target = e.target as HTMLElement</span><span class="s3">\n                </span><span class="s1">const $target = $(target)</span><span class="s3">\n                </span><span class="s1">let title: string | undefined</span><span class="s3">\n                </span><span class="s1">let $menuEl: DomElement | undefined</span><span class="s3">\n\n                </span><span class="s1">if ($target.isContain($toolbarElem)) {</span><span class="s3">\n                    </span><span class="s1">hide()</span><span class="s3">\n                    </span><span class="s1">return</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">if ($target.parentUntil('.w-e-droplist') != null) {</span><span class="s3">\n                    </span><span class="s1">// 处于droplist中时隐藏</span><span class="s3">\n                    </span><span class="s1">hide()</span><span class="s3">\n                </span><span class="s1">} else {</span><span class="s3">\n                    </span><span class="s1">if ($target.attr('data-title')) {</span><span class="s3">\n                        </span><span class="s1">title = $target.attr('data-title')</span><span class="s3">\n                        </span><span class="s1">$menuEl = $target</span><span class="s3">\n                    </span><span class="s1">} else {</span><span class="s3">\n                        </span><span class="s1">const $parent = $target.parentUntil('.w-e-menu')</span><span class="s3">\n                        </span><span class="s1">if ($parent != null) {</span><span class="s3">\n                            </span><span class="s1">title = $parent.attr('data-title')</span><span class="s3">\n                            </span><span class="s1">$menuEl = $parent</span><span class="s3">\n                        </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">if (title &amp;&amp; $menuEl) {</span><span class="s3">\n                    </span><span class="s1">clearShowTimeoutId()</span><span class="s3">\n                    </span><span class="s1">const targetOffset = $menuEl.getOffsetData()</span><span class="s3">\n                    </span><span class="s1">$tooltipEl.text(editor.i18next.t('menus.title.' + title))</span><span class="s3">\n                    </span><span class="s1">const tooltipOffset = $tooltipEl.getOffsetData()</span><span class="s3">\n                    </span><span class="s1">const left =</span><span class="s3">\n                        </span><span class="s1">targetOffset.left + targetOffset.width / 2 - tooltipOffset.width / 2</span><span class="s3">\n                    </span><span class="s1">$tooltipEl.css('left', `${left}px`)</span><span class="s3">\n\n                    </span><span class="s1">// 2. 高度设置</span><span class="s3">\n                    </span><span class="s1">if (menuTooltipPosition === 'up') {</span><span class="s3">\n                        </span><span class="s1">$tooltipEl.css('top', `${targetOffset.top - tooltipOffset.height - 8}px`)</span><span class="s3">\n                    </span><span class="s1">} else if (menuTooltipPosition === 'down') {</span><span class="s3">\n                        </span><span class="s1">$tooltipEl.css('top', `${targetOffset.top + targetOffset.height + 8}px`)</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n\n                    </span><span class="s1">showTimeoutId = window.setTimeout(() =&gt; {</span><span class="s3">\n                        </span><span class="s1">$tooltipEl.css('visibility', 'visible')</span><span class="s3">\n                    </span><span class="s1">}, 200)</span><span class="s3">\n                </span><span class="s1">} else {</span><span class="s3">\n                    </span><span class="s1">hide()</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">.on('mouseleave', () =&gt; {</span><span class="s3">\n                </span><span class="s1">hide()</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// 添加到菜单栏</span><span class="s3">\n    </span><span class="s1">private _addToToolbar(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $toolbarElem = editor.$toolbarElem</span><span class="s3">\n\n        </span><span class="s1">// 遍历添加到 DOM</span><span class="s3">\n        </span><span class="s1">this.menuList.forEach(menu =&gt; {</span><span class="s3">\n            </span><span class="s1">const $elem = menu.$elem</span><span class="s3">\n            </span><span class="s1">if ($elem) {</span><span class="s3">\n                </span><span class="s1">$toolbarElem.append($elem)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取菜单对象</span><span class="s3">\n     </span><span class="s1">* @param 菜单名称 小写</span><span class="s3">\n     </span><span class="s1">* @return Menus 菜单对象</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public menuFind(key: string): Menu {</span><span class="s3">\n        </span><span class="s1">const menuList = this.menuList</span><span class="s3">\n        </span><span class="s1">for (let i = 0, l = menuList.length; i &lt; l; i++) {</span><span class="s3">\n            </span><span class="s1">if (menuList[i].key === key) return menuList[i]</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">return menuList[0]</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* @description 修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public changeActive(): void {</span><span class="s3">\n        </span><span class="s1">this.menuList.forEach(menu =&gt; {</span><span class="s3">\n            </span><span class="s1">setTimeout((menu as any).tryChangeActive.bind(menu), 100) // 暂用 any ，后面再替换</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Menus</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/object/keys</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/object/keys');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.object.keys');</span><span class="s3">\n</span><span class="s1">var path = require('../../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.Object.keys;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var toObject = require('../internals/to-object');</span><span class="s3">\n</span><span class="s1">var nativeKeys = require('../internals/object-keys');</span><span class="s3">\n</span><span class="s1">var fails = require('../internals/fails');</span><span class="s3">\n\n</span><span class="s1">var FAILS_ON_PRIMITIVES = fails(function () { nativeKeys(1); });</span><span class="s3">\n\n</span><span class="s1">// `Object.keys` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.keys</span><span class="s3">\n</span><span class="s1">$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {</span><span class="s3">\n  </span><span class="s1">keys: function keys(it) {</span><span class="s3">\n    </span><span class="s1">return nativeKeys(toObject(it));</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/object/entries');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.object.entries');</span><span class="s3">\n</span><span class="s1">var path = require('../../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.Object.entries;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var $entries = require('../internals/object-to-array').entries;</span><span class="s3">\n\n</span><span class="s1">// `Object.entries` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.entries</span><span class="s3">\n</span><span class="s1">$({ target: 'Object', stat: true }, {</span><span class="s3">\n  </span><span class="s1">entries: function entries(O) {</span><span class="s3">\n    </span><span class="s1">return $entries(O);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var DESCRIPTORS = require('../internals/descriptors');</span><span class="s3">\n</span><span class="s1">var objectKeys = require('../internals/object-keys');</span><span class="s3">\n</span><span class="s1">var toIndexedObject = require('../internals/to-indexed-object');</span><span class="s3">\n</span><span class="s1">var propertyIsEnumerable = require('../internals/object-property-is-enumerable').f;</span><span class="s3">\n\n</span><span class="s1">// `Object.{ entries, values }` methods implementation</span><span class="s3">\n</span><span class="s1">var createMethod = function (TO_ENTRIES) {</span><span class="s3">\n  </span><span class="s1">return function (it) {</span><span class="s3">\n    </span><span class="s1">var O = toIndexedObject(it);</span><span class="s3">\n    </span><span class="s1">var keys = objectKeys(O);</span><span class="s3">\n    </span><span class="s1">var length = keys.length;</span><span class="s3">\n    </span><span class="s1">var i = 0;</span><span class="s3">\n    </span><span class="s1">var result = [];</span><span class="s3">\n    </span><span class="s1">var key;</span><span class="s3">\n    </span><span class="s1">while (length &gt; i) {</span><span class="s3">\n      </span><span class="s1">key = keys[i++];</span><span class="s3">\n      </span><span class="s1">if (!DESCRIPTORS || propertyIsEnumerable.call(O, key)) {</span><span class="s3">\n        </span><span class="s1">result.push(TO_ENTRIES ? [key, O[key]] : O[key]);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return result;</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">module.exports = {</span><span class="s3">\n  </span><span class="s1">// `Object.entries` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.entries</span><span class="s3">\n  </span><span class="s1">entries: createMethod(true),</span><span class="s3">\n  </span><span class="s1">// `Object.values` method</span><span class="s3">\n  </span><span class="s1">// https://tc39.github.io/ecma262/#sec-object.values</span><span class="s3">\n  </span><span class="s1">values: createMethod(false)</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/instance/some');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var some = require('../array/virtual/some');</span><span class="s3">\n\n</span><span class="s1">var ArrayPrototype = Array.prototype;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">var own = it.some;</span><span class="s3">\n  </span><span class="s1">return it === ArrayPrototype || (it instanceof Array &amp;&amp; own === ArrayPrototype.some) ? some : own;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../../modules/es.array.some');</span><span class="s3">\n</span><span class="s1">var entryVirtual = require('../../../internals/entry-virtual');</span><span class="s3">\n\n</span><span class="s1">module.exports = entryVirtual('Array').some;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var $some = require('../internals/array-iteration').some;</span><span class="s3">\n</span><span class="s1">var arrayMethodIsStrict = require('../internals/array-method-is-strict');</span><span class="s3">\n</span><span class="s1">var arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');</span><span class="s3">\n\n</span><span class="s1">var STRICT_METHOD = arrayMethodIsStrict('some');</span><span class="s3">\n</span><span class="s1">var USES_TO_LENGTH = arrayMethodUsesToLength('some');</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.some` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.some</span><span class="s3">\n</span><span class="s1">$({ target: 'Array', proto: true, forced: !STRICT_METHOD || !USES_TO_LENGTH }, {</span><span class="s3">\n  </span><span class="s1">some: function some(callbackfn /* , thisArg */) {</span><span class="s3">\n    </span><span class="s1">return $some(this, callbackfn, arguments.length &gt; 1 ? arguments[1] : undefined);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 所有菜单的构造函数</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Bold from './bold/index'</span><span class="s3">\n</span><span class="s1">import Head from './head/index'</span><span class="s3">\n</span><span class="s1">import Link from './link/index'</span><span class="s3">\n</span><span class="s1">import Italic from './italic/index'</span><span class="s3">\n</span><span class="s1">import Underline from './underline/index'</span><span class="s3">\n</span><span class="s1">import StrikeThrough from './strike-through/index'</span><span class="s3">\n</span><span class="s1">import FontStyle from './font-style/index'</span><span class="s3">\n</span><span class="s1">import FontSize from './font-size'</span><span class="s3">\n</span><span class="s1">import Justify from './justify/index'</span><span class="s3">\n</span><span class="s1">import Quote from './quote/index'</span><span class="s3">\n</span><span class="s1">import BackColor from './back-color/index'</span><span class="s3">\n</span><span class="s1">import FontColor from './font-color/index'</span><span class="s3">\n</span><span class="s1">import Video from './video/index'</span><span class="s3">\n</span><span class="s1">import Image from './img/index'</span><span class="s3">\n</span><span class="s1">import Indent from './indent/index'</span><span class="s3">\n</span><span class="s1">import Emoticon from './emoticon/index'</span><span class="s3">\n</span><span class="s1">import List from './list/index'</span><span class="s3">\n</span><span class="s1">import LineHeight from './lineHeight/index'</span><span class="s3">\n</span><span class="s1">import Undo from './undo/index'</span><span class="s3">\n</span><span class="s1">import Redo from './redo/index'</span><span class="s3">\n</span><span class="s1">import Table from './table/index'</span><span class="s3">\n</span><span class="s1">import Code from './code'</span><span class="s3">\n</span><span class="s1">import SplitLine from './split-line/index'</span><span class="s3">\n</span><span class="s1">import Todo from './todo'</span><span class="s3">\n\n</span><span class="s1">export type MenuListType = {</span><span class="s3">\n    </span><span class="s1">[key: string]: any</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default {</span><span class="s3">\n    </span><span class="s1">bold: Bold,</span><span class="s3">\n    </span><span class="s1">head: Head,</span><span class="s3">\n    </span><span class="s1">italic: Italic,</span><span class="s3">\n    </span><span class="s1">link: Link,</span><span class="s3">\n    </span><span class="s1">underline: Underline,</span><span class="s3">\n    </span><span class="s1">strikeThrough: StrikeThrough,</span><span class="s3">\n    </span><span class="s1">fontName: FontStyle,</span><span class="s3">\n    </span><span class="s1">fontSize: FontSize,</span><span class="s3">\n    </span><span class="s1">justify: Justify,</span><span class="s3">\n    </span><span class="s1">quote: Quote,</span><span class="s3">\n    </span><span class="s1">backColor: BackColor,</span><span class="s3">\n    </span><span class="s1">foreColor: FontColor,</span><span class="s3">\n    </span><span class="s1">video: Video,</span><span class="s3">\n    </span><span class="s1">image: Image,</span><span class="s3">\n    </span><span class="s1">indent: Indent,</span><span class="s3">\n    </span><span class="s1">emoticon: Emoticon,</span><span class="s3">\n    </span><span class="s1">list: List,</span><span class="s3">\n    </span><span class="s1">lineHeight: LineHeight,</span><span class="s3">\n    </span><span class="s1">undo: Undo,</span><span class="s3">\n    </span><span class="s1">redo: Redo,</span><span class="s3">\n    </span><span class="s1">table: Table,</span><span class="s3">\n    </span><span class="s1">code: Code,</span><span class="s3">\n    </span><span class="s1">splitLine: SplitLine,</span><span class="s3">\n    </span><span class="s1">todo: Todo,</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 加粗</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import BtnMenu from '../menu-constructors/BtnMenu'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n\n</span><span class="s1">class Bold extends BtnMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">加粗</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-bold</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const isSelectEmpty = editor.selection.isSelectionEmpty()</span><span class="s3">\n\n        </span><span class="s1">if (isSelectEmpty) {</span><span class="s3">\n            </span><span class="s1">// 选区范围是空的，插入并选中一个“空白”</span><span class="s3">\n            </span><span class="s1">editor.selection.createEmptyRange()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 执行 bold 命令</span><span class="s3">\n        </span><span class="s1">editor.cmd.do('bold')</span><span class="s3">\n\n        </span><span class="s1">if (isSelectEmpty) {</span><span class="s3">\n            </span><span class="s1">// 需要将选区范围折叠起来</span><span class="s3">\n            </span><span class="s1">editor.selection.collapseRange()</span><span class="s3">\n            </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">if (editor.cmd.queryCommandState('bold')) {</span><span class="s3">\n            </span><span class="s1">this.active()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">this.unActive()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Bold</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 标题</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import DropListMenu from '../menu-constructors/DropListMenu'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import { getRandomCode } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import { TCatalog } from '../../config/events'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../../utils/const'</span><span class="s3">\n\n</span><span class="s1">class Head extends DropListMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">oldCatalogs: TCatalog[] | undefined</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">'&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">标题</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-header</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;&lt;/div&gt;'</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">const dropListConf = {</span><span class="s3">\n            </span><span class="s1">width: 100,</span><span class="s3">\n            </span><span class="s1">title: '设置标题',</span><span class="s3">\n            </span><span class="s1">type: 'list', // droplist 以列表形式展示</span><span class="s3">\n            </span><span class="s1">list: [</span><span class="s3">\n                </span><span class="s1">{ $elem: $('&lt;h1&gt;H1&lt;/h1&gt;'), value: '&lt;h1&gt;' },</span><span class="s3">\n                </span><span class="s1">{ $elem: $('&lt;h2&gt;H2&lt;/h2&gt;'), value: '&lt;h2&gt;' },</span><span class="s3">\n                </span><span class="s1">{ $elem: $('&lt;h3&gt;H3&lt;/h3&gt;'), value: '&lt;h3&gt;' },</span><span class="s3">\n                </span><span class="s1">{ $elem: $('&lt;h4&gt;H4&lt;/h4&gt;'), value: '&lt;h4&gt;' },</span><span class="s3">\n                </span><span class="s1">{ $elem: $('&lt;h5&gt;H5&lt;/h5&gt;'), value: '&lt;h5&gt;' },</span><span class="s3">\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">$elem: $(`&lt;p&gt;${editor.i18next.t('menus.dropListMenu.head.正文')}&lt;/p&gt;`),</span><span class="s3">\n                    </span><span class="s1">value: '&lt;p&gt;',</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">],</span><span class="s3">\n            </span><span class="s1">clickHandler: (value: string) =&gt; {</span><span class="s3">\n                </span><span class="s1">// 注意 this 是指向当前的 Head 对象</span><span class="s3">\n                </span><span class="s1">this.command(value)</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">super($elem, editor, dropListConf)</span><span class="s3">\n\n        </span><span class="s1">const onCatalogChange = editor.config.onCatalogChange</span><span class="s3">\n        </span><span class="s1">// 未配置目录change监听回调时不运行下面操作</span><span class="s3">\n        </span><span class="s1">if (onCatalogChange) {</span><span class="s3">\n            </span><span class="s1">this.oldCatalogs = []</span><span class="s3">\n            </span><span class="s1">this.addListenerCatalog() // 监听文本框编辑时的大纲信息</span><span class="s3">\n            </span><span class="s1">this.getCatalogs() // 初始有值的情况获取一遍大纲信息</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行命令</span><span class="s3">\n     </span><span class="s1">* @param value value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public command(value: string): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $selectionElem = editor.selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">if ($selectionElem &amp;&amp; editor.$textElem.equal($selectionElem)) {</span><span class="s3">\n            </span><span class="s1">// 不能选中多行来设置标题，否则会出现问题</span><span class="s3">\n            </span><span class="s1">// 例如选中的是 &lt;p&gt;xxx&lt;/p&gt;&lt;p&gt;yyy&lt;/p&gt; 来设置标题，设置之后会成为 &lt;h1&gt;xxx&lt;br&gt;yyy&lt;/h1&gt; 不符合预期</span><span class="s3">\n            </span><span class="s1">this.setMultilineHead(value)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 选中内容包含序列，code，表格，分割线时不处理</span><span class="s3">\n            </span><span class="s1">if (</span><span class="s3">\n                </span><span class="s1">['OL', 'UL', 'LI', 'TABLE', 'TH', 'TR', 'CODE', 'HR'].indexOf(</span><span class="s3">\n                    </span><span class="s1">$($selectionElem).getNodeName()</span><span class="s3">\n                </span><span class="s1">) &gt; -1</span><span class="s3">\n            </span><span class="s1">) {</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">editor.cmd.do('formatBlock', value)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 标题设置成功且不是&lt;p&gt;正文标签就配置大纲id</span><span class="s3">\n        </span><span class="s1">value !== '&lt;p&gt;' &amp;&amp; this.addUidForSelectionElem()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 为标题设置大纲</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private addUidForSelectionElem() {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const tag = editor.selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">const id = getRandomCode() // 默认五位数id</span><span class="s3">\n        </span><span class="s1">$(tag).attr('id', id)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 监听change事件来返回大纲信息</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private addListenerCatalog() {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">editor.txt.eventHooks.changeEvents.push(() =&gt; {</span><span class="s3">\n            </span><span class="s1">this.getCatalogs()</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取大纲数组</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private getCatalogs() {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $textElem = this.editor.$textElem</span><span class="s3">\n        </span><span class="s1">const onCatalogChange = editor.config.onCatalogChange</span><span class="s3">\n        </span><span class="s1">const elems = $textElem.find('h1,h2,h3,h4,h5')</span><span class="s3">\n        </span><span class="s1">const catalogs: TCatalog[] = []</span><span class="s3">\n        </span><span class="s1">elems.forEach((elem, index) =&gt; {</span><span class="s3">\n            </span><span class="s1">const $elem = $(elem)</span><span class="s3">\n            </span><span class="s1">let id = $elem.attr('id')</span><span class="s3">\n            </span><span class="s1">const tag = $elem.getNodeName()</span><span class="s3">\n            </span><span class="s1">const text = $elem.text()</span><span class="s3">\n            </span><span class="s1">if (!id) {</span><span class="s3">\n                </span><span class="s1">id = getRandomCode()</span><span class="s3">\n                </span><span class="s1">$elem.attr('id', id)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">// 标题为空的情况不生成目录</span><span class="s3">\n            </span><span class="s1">if (!text) return</span><span class="s3">\n            </span><span class="s1">catalogs.push({</span><span class="s3">\n                </span><span class="s1">tag,</span><span class="s3">\n                </span><span class="s1">id,</span><span class="s3">\n                </span><span class="s1">text,</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">// 旧目录和新目录对比是否相等，不相等则运行回调并保存新目录到旧目录变量，以方便下一次对比</span><span class="s3">\n        </span><span class="s1">if (JSON.stringify(this.oldCatalogs) !== JSON.stringify(catalogs)) {</span><span class="s3">\n            </span><span class="s1">this.oldCatalogs = catalogs</span><span class="s3">\n            </span><span class="s1">onCatalogChange &amp;&amp; onCatalogChange(catalogs)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 设置选中的多行标题</span><span class="s3">\n     </span><span class="s1">* @param value  需要执行的命令值</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private setMultilineHead(value: string) {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $selection = editor.selection</span><span class="s3">\n        </span><span class="s1">// 初始选区的父节点</span><span class="s3">\n        </span><span class="s1">const containerElem = $selection.getSelectionContainerElem()?.elems[0]!</span><span class="s3">\n        </span><span class="s1">// 白名单：用户选区里如果有该元素则不进行转换</span><span class="s3">\n        </span><span class="s1">const _WHITE_LIST = [</span><span class="s3">\n            </span><span class="s1">'IMG',</span><span class="s3">\n            </span><span class="s1">'VIDEO',</span><span class="s3">\n            </span><span class="s1">'TABLE',</span><span class="s3">\n            </span><span class="s1">'TH',</span><span class="s3">\n            </span><span class="s1">'TR',</span><span class="s3">\n            </span><span class="s1">'UL',</span><span class="s3">\n            </span><span class="s1">'OL',</span><span class="s3">\n            </span><span class="s1">'PRE',</span><span class="s3">\n            </span><span class="s1">'HR',</span><span class="s3">\n            </span><span class="s1">'BLOCKQUOTE',</span><span class="s3">\n        </span><span class="s1">]</span><span class="s3">\n        </span><span class="s1">// 获取选中的首、尾元素</span><span class="s3">\n        </span><span class="s1">const startElem = $($selection.getSelectionStartElem())</span><span class="s3">\n        </span><span class="s1">let endElem = $($selection.getSelectionEndElem())</span><span class="s3">\n        </span><span class="s1">// 判断用户选中元素是否为最后一个空元素，如果是将endElem指向上一个元素</span><span class="s3">\n        </span><span class="s1">if (</span><span class="s3">\n            </span><span class="s1">endElem.elems[0].outerHTML === $(EMPTY_P).elems[0].outerHTML &amp;&amp;</span><span class="s3">\n            </span><span class="s1">!endElem.elems[0].nextSibling</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n            </span><span class="s1">endElem = endElem.prev()!</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// 存放选中的所有元素</span><span class="s3">\n        </span><span class="s1">const cacheDomList: DomElement[] = []</span><span class="s3">\n        </span><span class="s1">cacheDomList.push(startElem.getNodeTop(editor))</span><span class="s3">\n        </span><span class="s1">// 选中首尾元素在父级下的坐标</span><span class="s3">\n        </span><span class="s1">const indexList: number[] = []</span><span class="s3">\n        </span><span class="s1">// 选区共同祖先元素的所有子节点</span><span class="s3">\n        </span><span class="s1">const childList = $selection.getRange()?.commonAncestorContainer.childNodes</span><span class="s3">\n        </span><span class="s1">// 找到选区的首尾元素的下标，方便最后恢复选区</span><span class="s3">\n        </span><span class="s1">childList?.forEach((item, index) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (item === cacheDomList[0].getNode()) {</span><span class="s3">\n                </span><span class="s1">indexList.push(index)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">if (item === endElem.getNodeTop(editor).getNode()) {</span><span class="s3">\n                </span><span class="s1">indexList.push(index)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">// 找到首尾元素中间所包含的所有dom</span><span class="s3">\n        </span><span class="s1">let i = 0</span><span class="s3">\n        </span><span class="s1">// 数组中的当前元素不等于选区最后一个节点时循环寻找中间节点</span><span class="s3">\n        </span><span class="s1">while (cacheDomList[i].getNode() !== endElem.getNodeTop(editor).getNode()) {</span><span class="s3">\n            </span><span class="s1">// 严谨性判断，是否元素为空</span><span class="s3">\n            </span><span class="s1">if (!cacheDomList[i].elems[0]) return</span><span class="s3">\n            </span><span class="s1">let d = $(cacheDomList[i].next().getNode())</span><span class="s3">\n            </span><span class="s1">cacheDomList.push(d)</span><span class="s3">\n            </span><span class="s1">i++</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// 将选区内的所有子节点进行遍历生成对应的标签</span><span class="s3">\n        </span><span class="s1">cacheDomList?.forEach((_node, index) =&gt; {</span><span class="s3">\n            </span><span class="s1">// 判断元素是否含有白名单内的标签元素</span><span class="s3">\n            </span><span class="s1">if (!this.hasTag(_node, _WHITE_LIST)) {</span><span class="s3">\n                </span><span class="s1">const $h = $(value)</span><span class="s3">\n                </span><span class="s1">const $parentNode = _node.parent().getNode()</span><span class="s3">\n                </span><span class="s1">// 设置标签内容</span><span class="s3">\n                </span><span class="s1">$h.html(`${_node.html()}`)</span><span class="s3">\n                </span><span class="s1">// 插入生成的新标签</span><span class="s3">\n                </span><span class="s1">$parentNode.insertBefore($h.getNode(), _node.getNode())</span><span class="s3">\n                </span><span class="s1">// 移除原有的标签</span><span class="s3">\n                </span><span class="s1">_node.remove()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">// 重新设置选区起始位置，保留拖蓝区域</span><span class="s3">\n        </span><span class="s1">$selection.createRangeByElems(</span><span class="s3">\n            </span><span class="s1">containerElem.children[indexList[0]],</span><span class="s3">\n            </span><span class="s1">containerElem.children[indexList[1]]</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 是否含有某元素</span><span class="s3">\n     </span><span class="s1">* @param elem 需要检查的元素</span><span class="s3">\n     </span><span class="s1">* @param whiteList 白名单</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private hasTag(elem: DomElement, whiteList: string[]): boolean {</span><span class="s3">\n        </span><span class="s1">if (!elem) return false</span><span class="s3">\n        </span><span class="s1">if (whiteList.includes(elem?.getNodeName())) return true</span><span class="s3">\n        </span><span class="s1">let _flag = false</span><span class="s3">\n        </span><span class="s1">elem.children()?.forEach(child =&gt; {</span><span class="s3">\n            </span><span class="s1">_flag = this.hasTag($(child), whiteList)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">return _flag</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试改变菜单激活（高亮）状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive() {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const reg = /^h/i</span><span class="s3">\n        </span><span class="s1">const cmdValue = editor.cmd.queryCommandValue('formatBlock')</span><span class="s3">\n        </span><span class="s1">if (reg.test(cmdValue)) {</span><span class="s3">\n            </span><span class="s1">this.active()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">this.unActive()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Head</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/json/stringify</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/json/stringify');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.json.stringify');</span><span class="s3">\n</span><span class="s1">var core = require('../../internals/path');</span><span class="s3">\n\n</span><span class="s1">if (!core.JSON) core.JSON = { stringify: JSON.stringify };</span><span class="s3">\n\n</span><span class="s1">// eslint-disable-next-line no-unused-vars</span><span class="s3">\n</span><span class="s1">module.exports = function stringify(it, replacer, space) {</span><span class="s3">\n  </span><span class="s1">return core.JSON.stringify.apply(null, arguments);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var getBuiltIn = require('../internals/get-built-in');</span><span class="s3">\n</span><span class="s1">var fails = require('../internals/fails');</span><span class="s3">\n\n</span><span class="s1">var $stringify = getBuiltIn('JSON', 'stringify');</span><span class="s3">\n</span><span class="s1">var re = /[</span><span class="s3">\\</span><span class="s1">uD800-</span><span class="s3">\\</span><span class="s1">uDFFF]/g;</span><span class="s3">\n</span><span class="s1">var low = /^[</span><span class="s3">\\</span><span class="s1">uD800-</span><span class="s3">\\</span><span class="s1">uDBFF]$/;</span><span class="s3">\n</span><span class="s1">var hi = /^[</span><span class="s3">\\</span><span class="s1">uDC00-</span><span class="s3">\\</span><span class="s1">uDFFF]$/;</span><span class="s3">\n\n</span><span class="s1">var fix = function (match, offset, string) {</span><span class="s3">\n  </span><span class="s1">var prev = string.charAt(offset - 1);</span><span class="s3">\n  </span><span class="s1">var next = string.charAt(offset + 1);</span><span class="s3">\n  </span><span class="s1">if ((low.test(match) &amp;&amp; !hi.test(next)) || (hi.test(match) &amp;&amp; !low.test(prev))) {</span><span class="s3">\n    </span><span class="s1">return '</span><span class="s3">\\\\</span><span class="s1">u' + match.charCodeAt(0).toString(16);</span><span class="s3">\n  </span><span class="s1">} return match;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">var FORCED = fails(function () {</span><span class="s3">\n  </span><span class="s1">return $stringify('</span><span class="s3">\\</span><span class="s1">uDF06</span><span class="s3">\\</span><span class="s1">uD834') !== '</span><span class="s3">\&quot;\\\\</span><span class="s1">udf06</span><span class="s3">\\\\</span><span class="s1">ud834</span><span class="s3">\&quot;</span><span class="s1">'</span><span class="s3">\n    </span><span class="s1">|| $stringify('</span><span class="s3">\\</span><span class="s1">uDEAD') !== '</span><span class="s3">\&quot;\\\\</span><span class="s1">udead</span><span class="s3">\&quot;</span><span class="s1">';</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">if ($stringify) {</span><span class="s3">\n  </span><span class="s1">// https://github.com/tc39/proposal-well-formed-stringify</span><span class="s3">\n  </span><span class="s1">$({ target: 'JSON', stat: true, forced: FORCED }, {</span><span class="s3">\n    </span><span class="s1">// eslint-disable-next-line no-unused-vars</span><span class="s3">\n    </span><span class="s1">stringify: function stringify(it, replacer, space) {</span><span class="s3">\n      </span><span class="s1">var result = $stringify.apply(null, arguments);</span><span class="s3">\n      </span><span class="s1">return typeof result == 'string' ? result.replace(re, fix) : result;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 链接 菜单</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import PanelMenu from '../menu-constructors/PanelMenu'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import createPanelConf from './create-panel-conf'</span><span class="s3">\n</span><span class="s1">import isActive, { getParentNodeA } from './is-active'</span><span class="s3">\n</span><span class="s1">import Panel from '../menu-constructors/Panel'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import bindEvent from './bind-event/index'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../../utils/const'</span><span class="s3">\n\n</span><span class="s1">class Link extends PanelMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">'&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">链接</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-link</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;&lt;/div&gt;'</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n\n        </span><span class="s1">// 绑定事件，如点击链接时，可以查看链接</span><span class="s3">\n        </span><span class="s1">bindEvent(editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 菜单点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">let $linkElem</span><span class="s3">\n\n        </span><span class="s1">/**</span><span class="s3">\n            </span><span class="s1">@author:Gavin</span><span class="s3">\n            </span><span class="s1">@description </span><span class="s3">\n                </span><span class="s1">解决当全选删除编辑区内容时，点击链接没反应的问题(因为选区有问题)</span><span class="s3">\n              \n        </span><span class="s1">**/</span><span class="s3">\n        </span><span class="s1">let $selectionElem = editor.selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n        </span><span class="s1">const html = $textElem.html()</span><span class="s3">\n        </span><span class="s1">const $txtHtml = html.trim()</span><span class="s3">\n\n        </span><span class="s1">if ($txtHtml === EMPTY_P) {</span><span class="s3">\n            </span><span class="s1">const $emptyChild = $textElem.children()</span><span class="s3">\n            </span><span class="s1">// 调整选区</span><span class="s3">\n            </span><span class="s1">editor.selection.createRangeByElem($emptyChild as DomElement, true, true)</span><span class="s3">\n\n            </span><span class="s1">// 重新获取选区</span><span class="s3">\n            </span><span class="s1">$selectionElem = editor.selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 判断是否是多行 多行则退出 否则会出现问题</span><span class="s3">\n        </span><span class="s1">if ($selectionElem &amp;&amp; editor.$textElem.equal($selectionElem)) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (this.isActive) {</span><span class="s3">\n            </span><span class="s1">let text = ''</span><span class="s3">\n            </span><span class="s1">let href = ''</span><span class="s3">\n\n            </span><span class="s1">// 菜单被激活，说明选区在链接里</span><span class="s3">\n            </span><span class="s1">$linkElem = editor.selection.getSelectionContainerElem()</span><span class="s3">\n\n            </span><span class="s1">if (!$linkElem) {</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">if ($linkElem.getNodeName() !== 'A') {</span><span class="s3">\n                </span><span class="s1">const parentNodeA = getParentNodeA($linkElem)!</span><span class="s3">\n\n                </span><span class="s1">$linkElem = $(parentNodeA)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">text = $linkElem.elems[0].innerText</span><span class="s3">\n            </span><span class="s1">href = $linkElem.attr('href')</span><span class="s3">\n\n            </span><span class="s1">// 弹出 panel</span><span class="s3">\n            </span><span class="s1">this.createPanel(text, href)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 菜单未被激活，说明选区不在链接里</span><span class="s3">\n            </span><span class="s1">if (editor.selection.isSelectionEmpty()) {</span><span class="s3">\n                </span><span class="s1">// 选区是空的，未选中内容</span><span class="s3">\n                </span><span class="s1">this.createPanel('', '')</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">// 选中内容了</span><span class="s3">\n                </span><span class="s1">this.createPanel(editor.selection.getSelectionText(), '')</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 创建 panel</span><span class="s3">\n     </span><span class="s1">* @param text 文本</span><span class="s3">\n     </span><span class="s1">* @param link 链接</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private createPanel(text: string, link: string): void {</span><span class="s3">\n        </span><span class="s1">const conf = createPanelConf(this.editor, text, link)</span><span class="s3">\n        </span><span class="s1">const panel = new Panel(this, conf)</span><span class="s3">\n        </span><span class="s1">panel.create()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单 active 状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive() {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">if (isActive(editor)) {</span><span class="s3">\n            </span><span class="s1">this.active()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">this.unActive()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Link</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description link 菜单 panel tab 配置</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { PanelConf } from '../menu-constructors/Panel'</span><span class="s3">\n</span><span class="s1">import { getRandom } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import isActive, { getParentNodeA, EXTRA_TAG } from './is-active'</span><span class="s3">\n</span><span class="s1">import { insertHtml } from './util'</span><span class="s3">\n\n</span><span class="s1">export default function (editor: Editor, text: string, link: string): PanelConf {</span><span class="s3">\n    </span><span class="s1">// panel 中需要用到的id</span><span class="s3">\n    </span><span class="s1">const inputLinkId = getRandom('input-link')</span><span class="s3">\n    </span><span class="s1">const inputTextId = getRandom('input-text')</span><span class="s3">\n    </span><span class="s1">const btnOkId = getRandom('btn-ok')</span><span class="s3">\n    </span><span class="s1">const btnDelId = getRandom('btn-del')</span><span class="s3">\n\n    </span><span class="s1">// 是否显示“取消链接”</span><span class="s3">\n    </span><span class="s1">const delBtnDisplay = isActive(editor) ? 'inline-block' : 'none'</span><span class="s3">\n\n    </span><span class="s1">let $selectedLink: DomElement</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 选中整个链接元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function selectLinkElem(): void {</span><span class="s3">\n        </span><span class="s1">if (!isActive(editor)) return</span><span class="s3">\n\n        </span><span class="s1">const $linkElem = editor.selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">if (!$linkElem) return</span><span class="s3">\n        </span><span class="s1">editor.selection.createRangeByElem($linkElem)</span><span class="s3">\n        </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n\n        </span><span class="s1">$selectedLink = $linkElem // 赋值给函数内全局变量</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 插入链接</span><span class="s3">\n     </span><span class="s1">* @param text 文字</span><span class="s3">\n     </span><span class="s1">* @param link 链接</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function insertLink(text: string, link: string): void {</span><span class="s3">\n        </span><span class="s1">// fix: 修复列表下无法设置超链接的问题(替换选中文字中的标签)</span><span class="s3">\n\n        </span><span class="s1">// const TagRegExp = new RegExp(/(&lt;</span><span class="s3">\\</span><span class="s1">/?ul&gt;)|(&lt;</span><span class="s3">\\</span><span class="s1">/?li&gt;)|(&lt;</span><span class="s3">\\</span><span class="s1">/?ol&gt;)/g)</span><span class="s3">\n\n        </span><span class="s1">// const resultText = text.replace(TagRegExp, '')</span><span class="s3">\n\n        </span><span class="s1">/**</span><span class="s3">\n         </span><span class="s1">* fix: 插入链接后再修改链接地址问题，会导致页面链接有问题</span><span class="s3">\n         </span><span class="s1">*</span><span class="s3">\n         </span><span class="s1">* 同上，列表无法插入链接的原因，是因为在insertLink, 处理text时有问题。</span><span class="s3">\n         </span><span class="s1">*/</span><span class="s3">\n        </span><span class="s1">const resultText = text.replace(/&lt;/g, '&amp;lt;').replace(/&gt;/g, '&amp;gt;') // Link xss</span><span class="s3">\n\n        </span><span class="s1">const $elem: DomElement = $(`&lt;a target=</span><span class="s3">\&quot;</span><span class="s1">_blank</span><span class="s3">\&quot;</span><span class="s1">&gt;${resultText}&lt;/a&gt;`)</span><span class="s3">\n        </span><span class="s1">const linkDom = $elem.elems[0] as HTMLAnchorElement</span><span class="s3">\n\n        </span><span class="s1">// fix: 字符转义问题，https://xxx.org?bar=1&amp;macro=2 =&gt; https://xxx.org?bar=1¯o=2</span><span class="s3">\n        </span><span class="s1">linkDom.innerText = text</span><span class="s3">\n\n        </span><span class="s1">// 避免拼接字符串，带来的字符串嵌套问题：如: &lt;a href=</span><span class="s3">\&quot;\&quot;</span><span class="s1">&gt;&lt;img src=1 xx /&gt;</span><span class="s3">\&quot;</span><span class="s1">&gt; 造成xss攻击</span><span class="s3">\n        </span><span class="s1">linkDom.href = link</span><span class="s3">\n\n        </span><span class="s1">if (isActive(editor)) {</span><span class="s3">\n            </span><span class="s1">// 选区处于链接中，则选中整个菜单，再执行 insertHTML</span><span class="s3">\n            </span><span class="s1">selectLinkElem()</span><span class="s3">\n            </span><span class="s1">editor.cmd.do('insertElem', $elem)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 选区未处于链接中，直接插入即可</span><span class="s3">\n            </span><span class="s1">editor.cmd.do('insertElem', $elem)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 取消链接</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function delLink(): void {</span><span class="s3">\n        </span><span class="s1">if (!isActive(editor)) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// 选中整个链接</span><span class="s3">\n        </span><span class="s1">selectLinkElem()</span><span class="s3">\n\n        </span><span class="s1">/**</span><span class="s3">\n         </span><span class="s1">* 替换链接</span><span class="s3">\n         </span><span class="s1">*</span><span class="s3">\n         </span><span class="s1">* 两种情况</span><span class="s3">\n         </span><span class="s1">* 1. 特殊标签里嵌套a，也要保留特殊标签：&lt;b&gt;&lt;a&gt;&lt;/a&gt;&lt;/b&gt;  先加粗后添加链接</span><span class="s3">\n         </span><span class="s1">* 2. a标签里面可能会含有其他元素如：b, i等，要保留： &lt;a&gt;&lt;b&gt;&lt;/b&gt;&lt;/a&gt; 先添加链接后加粗</span><span class="s3">\n         </span><span class="s1">*/</span><span class="s3">\n\n        </span><span class="s1">if ($selectedLink.getNodeName() === 'A') {</span><span class="s3">\n            </span><span class="s1">const linkElem = $selectedLink.elems[0]</span><span class="s3">\n            </span><span class="s1">const linkParentNode = linkElem.parentElement</span><span class="s3">\n\n            </span><span class="s1">// 判断父级元素是不是特殊元素</span><span class="s3">\n            </span><span class="s1">if (linkParentNode &amp;&amp; EXTRA_TAG.includes(linkParentNode.nodeName)) {</span><span class="s3">\n                </span><span class="s1">// 将特殊元素的内容设置为a标签的内容</span><span class="s3">\n                </span><span class="s1">linkParentNode.innerHTML = linkElem.innerHTML</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">// 如果父级不是特殊元素，直接设置内容</span><span class="s3">\n                </span><span class="s1">editor.cmd.do('insertHTML', '&lt;span&gt;' + linkElem.innerHTML + '&lt;/span&gt;')</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 如果链接上选区是特殊元素，需要获取最近的a标签，获取html结果，以保留特殊元素</span><span class="s3">\n            </span><span class="s1">const parentNodeA = getParentNodeA($selectedLink)!</span><span class="s3">\n\n            </span><span class="s1">const selectionContent = parentNodeA.innerHTML</span><span class="s3">\n\n            </span><span class="s1">editor.cmd.do('insertHTML', '&lt;span&gt;' + selectionContent + '&lt;/span&gt;')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 校验链接是否合法</span><span class="s3">\n     </span><span class="s1">* @param link 链接</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function checkLink(text: string, link: string): boolean {</span><span class="s3">\n        </span><span class="s1">//查看开发者自定义配置的返回值</span><span class="s3">\n        </span><span class="s1">const check = editor.config.linkCheck(text, link)</span><span class="s3">\n        </span><span class="s1">if (check === undefined) {</span><span class="s3">\n            </span><span class="s1">//用户未能通过开发者的校验，且开发者不希望编辑器提示用户</span><span class="s3">\n        </span><span class="s1">} else if (check === true) {</span><span class="s3">\n            </span><span class="s1">//用户通过了开发者的校验</span><span class="s3">\n            </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">//用户未能通过开发者的校验，开发者希望我们提示这一字符串</span><span class="s3">\n            </span><span class="s1">editor.config.customAlert(check, 'warning')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const conf = {</span><span class="s3">\n        </span><span class="s1">width: 300,</span><span class="s3">\n        </span><span class="s1">height: 0,</span><span class="s3">\n\n        </span><span class="s1">// 拼接字符串的：xss 攻击：</span><span class="s3">\n        </span><span class="s1">//    如值为：</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;img src=1 onerror=alert(/xss/)&gt;， 插入后：value=</span><span class="s3">\&quot;\&quot;</span><span class="s1">&gt;&lt;img src=1 onerror=alert(/xss/)&gt;</span><span class="s3">\&quot;</span><span class="s1">, 插入一个img元素</span><span class="s3">\n\n        </span><span class="s1">// panel 中可包含多个 tab</span><span class="s3">\n        </span><span class="s1">tabs: [</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">// tab 的标题</span><span class="s3">\n                </span><span class="s1">title: editor.i18next.t('menus.panelMenus.link.链接'),</span><span class="s3">\n                </span><span class="s1">// 模板</span><span class="s3">\n                </span><span class="s1">tpl: `&lt;div&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;input</span><span class="s3">\n                            </span><span class="s1">id=</span><span class="s3">\&quot;</span><span class="s1">${inputTextId}</span><span class="s3">\&quot;\n                            </span><span class="s1">type=</span><span class="s3">\&quot;</span><span class="s1">text</span><span class="s3">\&quot;\n                            </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">block</span><span class="s3">\&quot;\n                            </span><span class="s1">placeholder=</span><span class="s3">\&quot;</span><span class="s1">${editor.i18next.t('menus.panelMenus.link.链接文字')}</span><span class="s3">\&quot;</span><span class="s1">/&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;/td&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;input</span><span class="s3">\n                            </span><span class="s1">id=</span><span class="s3">\&quot;</span><span class="s1">${inputLinkId}</span><span class="s3">\&quot;\n                            </span><span class="s1">type=</span><span class="s3">\&quot;</span><span class="s1">text</span><span class="s3">\&quot;\n                            </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">block</span><span class="s3">\&quot;\n                            </span><span class="s1">placeholder=</span><span class="s3">\&quot;</span><span class="s1">${editor.i18next.t('如')} https://...</span><span class="s3">\&quot;</span><span class="s1">/&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;/td&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-button-container</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                            </span><span class="s1">&lt;button type=</span><span class="s3">\&quot;</span><span class="s1">button</span><span class="s3">\&quot; </span><span class="s1">id=</span><span class="s3">\&quot;</span><span class="s1">${btnOkId}</span><span class="s3">\&quot; </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">right</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                                </span><span class="s1">${editor.i18next.t('插入')}</span><span class="s3">\n                            </span><span class="s1">&lt;/button&gt;</span><span class="s3">\n                            </span><span class="s1">&lt;button type=</span><span class="s3">\&quot;</span><span class="s1">button</span><span class="s3">\&quot; </span><span class="s1">id=</span><span class="s3">\&quot;</span><span class="s1">${btnDelId}</span><span class="s3">\&quot; </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">gray right</span><span class="s3">\&quot; </span><span class="s1">style=</span><span class="s3">\&quot;</span><span class="s1">display:${delBtnDisplay}</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                                </span><span class="s1">${editor.i18next.t('menus.panelMenus.link.取消链接')}</span><span class="s3">\n                            </span><span class="s1">&lt;/button&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;/div&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;/div&gt;`,</span><span class="s3">\n                </span><span class="s1">// 事件绑定</span><span class="s3">\n                </span><span class="s1">events: [</span><span class="s3">\n                    </span><span class="s1">// 插入链接</span><span class="s3">\n                    </span><span class="s1">{</span><span class="s3">\n                        </span><span class="s1">selector: '#' + btnOkId,</span><span class="s3">\n                        </span><span class="s1">type: 'click',</span><span class="s3">\n                        </span><span class="s1">fn: () =&gt; {</span><span class="s3">\n                            </span><span class="s1">// 获取链接区间的顶层元素</span><span class="s3">\n                            </span><span class="s1">const $selectionContainerElem = editor.selection.getSelectionContainerElem()!</span><span class="s3">\n                            </span><span class="s1">const $elem = $selectionContainerElem?.elems[0]</span><span class="s3">\n\n                            </span><span class="s1">// 获取选取</span><span class="s3">\n                            </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n                            </span><span class="s1">const topNode = editor.selection</span><span class="s3">\n                                </span><span class="s1">.getSelectionRangeTopNodes()[0]</span><span class="s3">\n                                </span><span class="s1">.getNode()</span><span class="s3">\n                            </span><span class="s1">const selection = window.getSelection()</span><span class="s3">\n                            </span><span class="s1">// 执行插入链接</span><span class="s3">\n                            </span><span class="s1">const $link = $('#' + inputLinkId)</span><span class="s3">\n                            </span><span class="s1">const $text = $('#' + inputTextId)</span><span class="s3">\n                            </span><span class="s1">let link = $link.val().trim()</span><span class="s3">\n                            </span><span class="s1">let text = $text.val().trim()</span><span class="s3">\n\n                            </span><span class="s1">let html: string = ''</span><span class="s3">\n\n                            </span><span class="s1">if (selection &amp;&amp; !selection?.isCollapsed) {</span><span class="s3">\n                                </span><span class="s1">html = insertHtml(selection, topNode)?.trim()</span><span class="s3">\n                            </span><span class="s1">}</span><span class="s3">\n\n                            </span><span class="s1">// 去除html的tag标签</span><span class="s3">\n                            </span><span class="s1">const htmlText = html?.replace(/&lt;.*?&gt;/g, '')</span><span class="s3">\n                            </span><span class="s1">const htmlTextLen = htmlText?.length ?? 0</span><span class="s3">\n\n                            </span><span class="s1">// 当input中的text的长度大于等于选区的文字时</span><span class="s3">\n                            </span><span class="s1">// 需要判断两者相同的长度的text内容是否相同</span><span class="s3">\n                            </span><span class="s1">// 相同则只需把多余的部分添加上去即可，否则使用input中的内容</span><span class="s3">\n                            </span><span class="s1">if (htmlTextLen &lt;= text.length) {</span><span class="s3">\n                                </span><span class="s1">const startText = text.substring(0, htmlTextLen)</span><span class="s3">\n                                </span><span class="s1">const endText = text.substring(htmlTextLen)</span><span class="s3">\n                                </span><span class="s1">if (htmlText === startText) {</span><span class="s3">\n                                    </span><span class="s1">text = htmlText + endText</span><span class="s3">\n                                </span><span class="s1">}</span><span class="s3">\n                            </span><span class="s1">}</span><span class="s3">\n                            </span><span class="s1">// 链接为空，则不插入</span><span class="s3">\n                            </span><span class="s1">if (!link) return</span><span class="s3">\n                            </span><span class="s1">// 文本为空，则用链接代替</span><span class="s3">\n                            </span><span class="s1">if (!text) text = link</span><span class="s3">\n                            </span><span class="s1">// 校验链接是否满足用户的规则，若不满足则不插入</span><span class="s3">\n                            </span><span class="s1">if (!checkLink(text, link)) return</span><span class="s3">\n\n                            </span><span class="s1">/**</span><span class="s3">\n                             </span><span class="s1">* 插入链接</span><span class="s3">\n                             </span><span class="s1">* 1、针对首次插入链接，利用选区插入a标签即可</span><span class="s3">\n                             </span><span class="s1">* 1、针对：&lt;a&gt;&lt;b&gt;xxxx&lt;/b&gt;&lt;/a&gt; 情况，用户操作修改或者替换链接时，编辑得到a，修改已有a标签的href</span><span class="s3">\n                             </span><span class="s1">* 2、针对：&lt;b&gt;&lt;a&gt;xxxx&lt;/a&gt;&lt;/b&gt; 情况, 用户操作修改或者替换链接时，只要修改已有a标签的href</span><span class="s3">\n                             </span><span class="s1">*/</span><span class="s3">\n\n                            </span><span class="s1">// 选区范围是a标签，直接替换href链接即可</span><span class="s3">\n                            </span><span class="s1">if ($elem?.nodeName === 'A') {</span><span class="s3">\n                                </span><span class="s1">$elem.setAttribute('href', link)</span><span class="s3">\n                                </span><span class="s1">$elem.innerText = text</span><span class="s3">\n\n                                </span><span class="s1">return true</span><span class="s3">\n                            </span><span class="s1">}</span><span class="s3">\n\n                            </span><span class="s1">// 不是a标签，并且为特殊元素, 需要检查是不是首次设置链接，还是已经设置过链接。</span><span class="s3">\n                            </span><span class="s1">if ($elem?.nodeName !== 'A' &amp;&amp; EXTRA_TAG.includes($elem.nodeName)) {</span><span class="s3">\n                                </span><span class="s1">const nodeA = getParentNodeA($selectionContainerElem)</span><span class="s3">\n\n                                </span><span class="s1">// 防止第一次设置就为特殊元素，这种情况应该为首次设置链接</span><span class="s3">\n                                </span><span class="s1">if (nodeA) {</span><span class="s3">\n                                    </span><span class="s1">// 链接设置a</span><span class="s3">\n                                    </span><span class="s1">nodeA.setAttribute('href', link)</span><span class="s3">\n\n                                    </span><span class="s1">// 文案还是要设置刚开始的元素内的文字，比如加粗的元素，不然会将加粗替代</span><span class="s3">\n                                    </span><span class="s1">$elem.innerText = text</span><span class="s3">\n\n                                    </span><span class="s1">return true</span><span class="s3">\n                                </span><span class="s1">}</span><span class="s3">\n                            </span><span class="s1">}</span><span class="s3">\n\n                            </span><span class="s1">// 首次插入链接</span><span class="s3">\n                            </span><span class="s1">insertLink(text, link)</span><span class="s3">\n\n                            </span><span class="s1">// 返回 true，表示该事件执行完之后，panel 要关闭。否则 panel 不会关闭</span><span class="s3">\n                            </span><span class="s1">return true</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                        </span><span class="s1">bindEnter: true,</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">// 取消链接</span><span class="s3">\n                    </span><span class="s1">{</span><span class="s3">\n                        </span><span class="s1">selector: '#' + btnDelId,</span><span class="s3">\n                        </span><span class="s1">type: 'click',</span><span class="s3">\n                        </span><span class="s1">fn: () =&gt; {</span><span class="s3">\n                            </span><span class="s1">// 执行取消链接</span><span class="s3">\n                            </span><span class="s1">delLink()</span><span class="s3">\n\n                            </span><span class="s1">// 返回 true，表示该事件执行完之后，panel 要关闭。否则 panel 不会关闭</span><span class="s3">\n                            </span><span class="s1">return true</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">],</span><span class="s3">\n            </span><span class="s1">}, // tab end</span><span class="s3">\n        </span><span class="s1">], // tabs end</span><span class="s3">\n        </span><span class="s1">/**</span><span class="s3">\n         </span><span class="s1">* 设置input的值，分别为文案和链接地址设置值</span><span class="s3">\n         </span><span class="s1">*</span><span class="s3">\n         </span><span class="s1">* 利用dom 设置链接文案的值，防止回填拼接引号问题, 出现xss攻击</span><span class="s3">\n         </span><span class="s1">*</span><span class="s3">\n         </span><span class="s1">* @param $container 对应上面生成的dom容器</span><span class="s3">\n         </span><span class="s1">* @param type text | link</span><span class="s3">\n         </span><span class="s1">*/</span><span class="s3">\n        </span><span class="s1">setLinkValue($container: DomElement, type: string) {</span><span class="s3">\n            </span><span class="s1">let inputId = ''</span><span class="s3">\n            </span><span class="s1">let inputValue = ''</span><span class="s3">\n            </span><span class="s1">let inputDom</span><span class="s3">\n\n            </span><span class="s1">// 设置链接文案</span><span class="s3">\n            </span><span class="s1">if (type === 'text') {</span><span class="s3">\n                </span><span class="s1">inputId = `#${inputTextId}`</span><span class="s3">\n                </span><span class="s1">inputValue = text</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 这只链接地址</span><span class="s3">\n            </span><span class="s1">if (type === 'link') {</span><span class="s3">\n                </span><span class="s1">inputId = `#${inputLinkId}`</span><span class="s3">\n                </span><span class="s1">inputValue = link</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">inputDom = $container.find(inputId).elems[0] as HTMLInputElement</span><span class="s3">\n\n            </span><span class="s1">inputDom.value = inputValue</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return conf</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* 获取除了包裹在整行区域的顶级Node</span><span class="s3">\n </span><span class="s1">* @param node 最外层node下的某个childNode</span><span class="s3">\n </span><span class="s1">* @param topText 最外层node中文本内容</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function getTopNode(node: Node, topText: string): Node {</span><span class="s3">\n    </span><span class="s1">let pointerNode: Node = node</span><span class="s3">\n    </span><span class="s1">let topNode: Node = node</span><span class="s3">\n    </span><span class="s1">do {</span><span class="s3">\n        </span><span class="s1">if (pointerNode.textContent === topText) break</span><span class="s3">\n        </span><span class="s1">topNode = pointerNode</span><span class="s3">\n        </span><span class="s1">if (pointerNode.parentNode) {</span><span class="s3">\n            </span><span class="s1">pointerNode = pointerNode?.parentNode</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">} while (pointerNode?.nodeName !== 'P')</span><span class="s3">\n\n    </span><span class="s1">return topNode</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 生成html的string形式</span><span class="s3">\n </span><span class="s1">* @param tagName 标签名</span><span class="s3">\n </span><span class="s1">* @param content 需要包裹的内容</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function makeHtmlString(node: Node, content: string): string {</span><span class="s3">\n    </span><span class="s1">let tagName = node.nodeName</span><span class="s3">\n    </span><span class="s1">let attr = ''</span><span class="s3">\n    </span><span class="s1">if (node.nodeType === 3 || /^(h|H)[1-6]$/.test(tagName)) {</span><span class="s3">\n        </span><span class="s1">return content</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (node.nodeType === 1) {</span><span class="s3">\n        </span><span class="s1">const style = (node as Element).getAttribute('style')</span><span class="s3">\n        </span><span class="s1">const face = (node as Element).getAttribute('face')</span><span class="s3">\n        </span><span class="s1">const color = (node as Element).getAttribute('color')</span><span class="s3">\n        </span><span class="s1">if (style) attr = attr + ` style=</span><span class="s3">\&quot;</span><span class="s1">${style}</span><span class="s3">\&quot;</span><span class="s1">`</span><span class="s3">\n        </span><span class="s1">if (face) attr = attr + ` face=</span><span class="s3">\&quot;</span><span class="s1">${face}</span><span class="s3">\&quot;</span><span class="s1">`</span><span class="s3">\n        </span><span class="s1">if (color) attr = attr + ` color=</span><span class="s3">\&quot;</span><span class="s1">${color}</span><span class="s3">\&quot;</span><span class="s1">`</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">tagName = tagName.toLowerCase()</span><span class="s3">\n    </span><span class="s1">return `&lt;${tagName}${attr}&gt;${content}&lt;/${tagName}&gt;`</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 生成开始或者结束位置的html字符片段</span><span class="s3">\n </span><span class="s1">* @param topText 选区所在的行的文本内容</span><span class="s3">\n </span><span class="s1">* @param node 选区给出的node节点</span><span class="s3">\n </span><span class="s1">* @param startPos node文本内容选取的开始位置</span><span class="s3">\n </span><span class="s1">* @param endPos node文本内容选取的结束位置</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function createPartHtml(topText: string, node: Node, startPos: number, endPost?: number): string {</span><span class="s3">\n    </span><span class="s1">let selectionContent = node.textContent?.substring(startPos, endPost)</span><span class="s3">\n    </span><span class="s1">let pointerNode: Node | null = node</span><span class="s3">\n    </span><span class="s1">let content = ''</span><span class="s3">\n    </span><span class="s1">do {</span><span class="s3">\n        </span><span class="s1">content = makeHtmlString(pointerNode, selectionContent ?? '')</span><span class="s3">\n        </span><span class="s1">selectionContent = content</span><span class="s3">\n        </span><span class="s1">pointerNode = pointerNode?.parentElement</span><span class="s3">\n    </span><span class="s1">} while (pointerNode &amp;&amp; pointerNode.textContent !== topText)</span><span class="s3">\n\n    </span><span class="s1">return content</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 生成需要插入的html内容的字符串形式</span><span class="s3">\n </span><span class="s1">* @param selection 选区对象</span><span class="s3">\n </span><span class="s1">* @param topNode 选区所在行的顶级node节点</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function insertHtml(selection: Selection, topNode: Node): string {</span><span class="s3">\n    </span><span class="s1">const { anchorNode, focusNode, anchorOffset: anchorPos, focusOffset: focusPos } = selection</span><span class="s3">\n    </span><span class="s1">const topText = topNode.textContent ?? ''</span><span class="s3">\n    </span><span class="s1">const TagArr = getContainerTag(topNode)</span><span class="s3">\n\n    </span><span class="s1">let content: string = ''</span><span class="s3">\n    </span><span class="s1">let startContent: string = ''</span><span class="s3">\n    </span><span class="s1">let middleContent: string = ''</span><span class="s3">\n    </span><span class="s1">let endContent: string = ''</span><span class="s3">\n\n    </span><span class="s1">let startNode = anchorNode</span><span class="s3">\n    </span><span class="s1">let endNode = focusNode</span><span class="s3">\n    </span><span class="s1">// 用来保存 anchorNode的非p最外层节点</span><span class="s3">\n    </span><span class="s1">let pointerNode = anchorNode</span><span class="s3">\n\n    </span><span class="s1">// 节点是同一个的处理</span><span class="s3">\n    </span><span class="s1">if (anchorNode?.isEqualNode(focusNode ?? null)) {</span><span class="s3">\n        </span><span class="s1">let innerContent = createPartHtml(topText, anchorNode, anchorPos, focusPos)</span><span class="s3">\n        </span><span class="s1">innerContent = addContainer(TagArr, innerContent)</span><span class="s3">\n        </span><span class="s1">return innerContent</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 选中开始位置节点的处理</span><span class="s3">\n    </span><span class="s1">if (anchorNode) startContent = createPartHtml(topText, anchorNode, anchorPos ?? 0)</span><span class="s3">\n\n    </span><span class="s1">// 结束位置节点的处理</span><span class="s3">\n    </span><span class="s1">if (focusNode) endContent = createPartHtml(topText, focusNode, 0, focusPos)</span><span class="s3">\n\n    </span><span class="s1">// 将指针节点位置放置到开始的节点</span><span class="s3">\n    </span><span class="s1">if (anchorNode) {</span><span class="s3">\n        </span><span class="s1">// 获取start的非p顶级node</span><span class="s3">\n        </span><span class="s1">startNode = getTopNode(anchorNode, topText)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (focusNode) {</span><span class="s3">\n        </span><span class="s1">// 获取end的非p顶级node</span><span class="s3">\n        </span><span class="s1">endNode = getTopNode(focusNode, topText)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 处于开始和结束节点位置之间的节点的处理</span><span class="s3">\n    </span><span class="s1">pointerNode = startNode?.nextSibling ?? anchorNode</span><span class="s3">\n    </span><span class="s1">while (!pointerNode?.isEqualNode(endNode ?? null)) {</span><span class="s3">\n        </span><span class="s1">const pointerNodeName = pointerNode?.nodeName</span><span class="s3">\n        </span><span class="s1">if (pointerNodeName === '#text') {</span><span class="s3">\n            </span><span class="s1">middleContent = middleContent + pointerNode?.textContent</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">let htmlString = pointerNode?.firstChild?.parentElement?.innerHTML</span><span class="s3">\n            </span><span class="s1">if (pointerNode)</span><span class="s3">\n                </span><span class="s1">middleContent = middleContent + makeHtmlString(pointerNode, htmlString ?? '')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// 解决文字和图片同一行时会触发无限循环, 到不了endNode === pointerNode条件</span><span class="s3">\n        </span><span class="s1">const nextPointNode = pointerNode?.nextSibling ?? pointerNode</span><span class="s3">\n        </span><span class="s1">if (nextPointNode === pointerNode) break</span><span class="s3">\n        </span><span class="s1">pointerNode = nextPointNode</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">content = `${startContent}${middleContent}${endContent}`</span><span class="s3">\n\n    </span><span class="s1">// 增加最外层包裹标签</span><span class="s3">\n    </span><span class="s1">content = addContainer(TagArr, content)</span><span class="s3">\n\n    </span><span class="s1">return content</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 获取包裹在最外层的非p Node tagName 数组</span><span class="s3">\n </span><span class="s1">* @param node 选区所在行的node节点</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function getContainerTag(node: Node): Node[] {</span><span class="s3">\n    </span><span class="s1">const topText = node.textContent ?? ''</span><span class="s3">\n    </span><span class="s1">let tagArr = []</span><span class="s3">\n    </span><span class="s1">while (node?.textContent === topText) {</span><span class="s3">\n        </span><span class="s1">if (node.nodeName !== 'P' &amp;&amp; node.nodeName !== 'TABLE') {</span><span class="s3">\n            </span><span class="s1">tagArr.push(node)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">node = node.childNodes[0]</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return tagArr</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 为内容增加包裹标签</span><span class="s3">\n </span><span class="s1">* @param tagArr 最外层包裹的tag数组，索引越小tag越在外面</span><span class="s3">\n </span><span class="s1">* @param content tag要包裹的内容</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function addContainer(tagArr: Node[], content: string): string {</span><span class="s3">\n    </span><span class="s1">tagArr.forEach(v =&gt; {</span><span class="s3">\n        </span><span class="s1">content = makeHtmlString(v, content)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">return content</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export { getTopNode, makeHtmlString, createPartHtml, insertHtml }</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 绑定链接元素的事件，入口</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import bindTooltipEvent from './tooltip-event'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function bindEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">// tooltip 事件</span><span class="s3">\n    </span><span class="s1">bindTooltipEvent(editor)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default bindEvent</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description tooltip 事件</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Tooltip, { TooltipConfType } from '../../menu-constructors/Tooltip'</span><span class="s3">\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import { EXTRA_TAG } from '../is-active'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 生成 Tooltip 的显示隐藏函数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function createShowHideFn(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">let tooltip: Tooltip | null</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 显示 tooltip</span><span class="s3">\n     </span><span class="s1">* @param $link 链接元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function showLinkTooltip($link: DomElement) {</span><span class="s3">\n        </span><span class="s1">const conf: TooltipConfType = [</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${editor.i18next.t('menus.panelMenus.link.查看链接')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $link: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">const link = $link.attr('href')</span><span class="s3">\n                    </span><span class="s1">window.open(link, '_target')</span><span class="s3">\n\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${editor.i18next.t('menus.panelMenus.link.取消链接')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $link: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">// 选中链接元素</span><span class="s3">\n                    </span><span class="s1">editor.selection.createRangeByElem($link)</span><span class="s3">\n                    </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n\n                    </span><span class="s1">const $childNodes = $link.childNodes()</span><span class="s3">\n                    </span><span class="s1">// 如果链接是图片</span><span class="s3">\n                    </span><span class="s1">if ($childNodes?.getNodeName() === 'IMG') {</span><span class="s3">\n                        </span><span class="s1">// 获取选中的图片</span><span class="s3">\n                        </span><span class="s1">const $selectIMG = editor.selection.getSelectionContainerElem()?.children()</span><span class="s3">\n                            </span><span class="s1">?.elems[0].children[0]</span><span class="s3">\n                        </span><span class="s1">// 插入图片</span><span class="s3">\n                        </span><span class="s1">editor.cmd.do(</span><span class="s3">\n                            </span><span class="s1">'insertHTML',</span><span class="s3">\n                            </span><span class="s1">`&lt;img </span><span class="s3">\n                                </span><span class="s1">src=${$selectIMG?.getAttribute('src')} </span><span class="s3">\n                                </span><span class="s1">style=${$selectIMG?.getAttribute('style')}&gt;`</span><span class="s3">\n                        </span><span class="s1">)</span><span class="s3">\n                    </span><span class="s1">} else {</span><span class="s3">\n                        </span><span class="s1">/**</span><span class="s3">\n                         </span><span class="s1">* 替换链接</span><span class="s3">\n                         </span><span class="s1">*</span><span class="s3">\n                         </span><span class="s1">* 两种情况</span><span class="s3">\n                         </span><span class="s1">* 1. a标签里面可能会含有其他元素如：b, i等，要保留： &lt;a&gt;&lt;b&gt;&lt;/b&gt;&lt;/a&gt; 先添加链接后加粗</span><span class="s3">\n                         </span><span class="s1">* 2. 特殊标签里嵌套a，也要保留特殊标签：&lt;b&gt;&lt;a&gt;&lt;/a&gt;&lt;/b&gt;  先加粗后添加链接</span><span class="s3">\n                         </span><span class="s1">*/</span><span class="s3">\n                        </span><span class="s1">const linkElem = $link.elems[0]</span><span class="s3">\n\n                        </span><span class="s1">// a标签里面的html结构</span><span class="s3">\n                        </span><span class="s1">const selectionContent = linkElem.innerHTML</span><span class="s3">\n\n                        </span><span class="s1">// a标签的父元素</span><span class="s3">\n                        </span><span class="s1">const linkParentNode = linkElem.parentElement</span><span class="s3">\n\n                        </span><span class="s1">if (linkParentNode &amp;&amp; EXTRA_TAG.includes(linkParentNode.nodeName)) {</span><span class="s3">\n                            </span><span class="s1">linkParentNode.innerHTML = selectionContent</span><span class="s3">\n                        </span><span class="s1">} else {</span><span class="s3">\n                            </span><span class="s1">editor.cmd.do('insertHTML', '&lt;span&gt;' + selectionContent + '&lt;/span&gt;')</span><span class="s3">\n                        </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">]</span><span class="s3">\n\n        </span><span class="s1">// 创建 tooltip</span><span class="s3">\n        </span><span class="s1">tooltip = new Tooltip(editor, $link, conf)</span><span class="s3">\n        </span><span class="s1">tooltip.create()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 隐藏 tooltip</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function hideLinkTooltip() {</span><span class="s3">\n        </span><span class="s1">// 移除 tooltip</span><span class="s3">\n        </span><span class="s1">if (tooltip) {</span><span class="s3">\n            </span><span class="s1">tooltip.remove()</span><span class="s3">\n            </span><span class="s1">tooltip = null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return {</span><span class="s3">\n        </span><span class="s1">showLinkTooltip,</span><span class="s3">\n        </span><span class="s1">hideLinkTooltip,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定 tooltip 事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function bindTooltipEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const { showLinkTooltip, hideLinkTooltip } = createShowHideFn(editor)</span><span class="s3">\n\n    </span><span class="s1">// 点击链接元素是，显示 tooltip</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.linkClickEvents.push(showLinkTooltip)</span><span class="s3">\n\n    </span><span class="s1">// 点击其他地方，或者滚动时，隐藏 tooltip</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.clickEvents.push(hideLinkTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.keyupEvents.push(hideLinkTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.toolbarClickEvents.push(hideLinkTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.menuClickEvents.push(hideLinkTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.textScrollEvents.push(hideLinkTooltip)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default bindTooltipEvent</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 斜体</span><span class="s3">\n </span><span class="s1">* @author liuwei</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import BtnMenu from '../menu-constructors/BtnMenu'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n\n</span><span class="s1">class Italic extends BtnMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">斜体</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-italic</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const isSelectEmpty = editor.selection.isSelectionEmpty()</span><span class="s3">\n\n        </span><span class="s1">if (isSelectEmpty) {</span><span class="s3">\n            </span><span class="s1">// 选区范围是空的，插入并选中一个“空白”</span><span class="s3">\n            </span><span class="s1">editor.selection.createEmptyRange()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 执行 italic 命令</span><span class="s3">\n        </span><span class="s1">editor.cmd.do('italic')</span><span class="s3">\n\n        </span><span class="s1">if (isSelectEmpty) {</span><span class="s3">\n            </span><span class="s1">// 需要将选区范围折叠起来</span><span class="s3">\n            </span><span class="s1">editor.selection.collapseRange()</span><span class="s3">\n            </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">if (editor.cmd.queryCommandState('italic')) {</span><span class="s3">\n            </span><span class="s1">this.active()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">this.unActive()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Italic</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 下划线 underline</span><span class="s3">\n </span><span class="s1">* @author dyl</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import BtnMenu from '../menu-constructors/BtnMenu'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n\n</span><span class="s1">class Underline extends BtnMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">下划线</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-underline</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const isSelectEmpty = editor.selection.isSelectionEmpty()</span><span class="s3">\n\n        </span><span class="s1">if (isSelectEmpty) {</span><span class="s3">\n            </span><span class="s1">// 选区范围是空的，插入并选中一个“空白”</span><span class="s3">\n            </span><span class="s1">editor.selection.createEmptyRange()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 执行 Underline 命令</span><span class="s3">\n        </span><span class="s1">editor.cmd.do('underline')</span><span class="s3">\n\n        </span><span class="s1">if (isSelectEmpty) {</span><span class="s3">\n            </span><span class="s1">// 需要将选区范围折叠起来</span><span class="s3">\n            </span><span class="s1">editor.selection.collapseRange()</span><span class="s3">\n            </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">if (editor.cmd.queryCommandState('underline')) {</span><span class="s3">\n            </span><span class="s1">this.active()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">this.unActive()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Underline</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 删除线</span><span class="s3">\n </span><span class="s1">* @author lkw</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import BtnMenu from '../menu-constructors/BtnMenu'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n\n</span><span class="s1">class StrikeThrough extends BtnMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">删除线</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-strikethrough</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const isSelectEmpty = editor.selection.isSelectionEmpty()</span><span class="s3">\n\n        </span><span class="s1">if (isSelectEmpty) {</span><span class="s3">\n            </span><span class="s1">// 选区范围是空的，插入并选中一个“空白”</span><span class="s3">\n            </span><span class="s1">editor.selection.createEmptyRange()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 执行 strikeThrough 命令</span><span class="s3">\n        </span><span class="s1">editor.cmd.do('strikeThrough')</span><span class="s3">\n\n        </span><span class="s1">if (isSelectEmpty) {</span><span class="s3">\n            </span><span class="s1">// 需要将选区范围折叠起来</span><span class="s3">\n            </span><span class="s1">editor.selection.collapseRange()</span><span class="s3">\n            </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">if (editor.cmd.queryCommandState('strikeThrough')) {</span><span class="s3">\n            </span><span class="s1">this.active()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">this.unActive()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default StrikeThrough</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 字体样式 FontStyle</span><span class="s3">\n </span><span class="s1">* @author dyl</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import DropListMenu from '../menu-constructors/DropListMenu'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import FontStyleList from './FontStyleList'</span><span class="s3">\n\n</span><span class="s1">class FontStyle extends DropListMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">字体</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-font</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">let fontStyleList = new FontStyleList(editor.config.fontNames)</span><span class="s3">\n        </span><span class="s1">const fontListConf = {</span><span class="s3">\n            </span><span class="s1">width: 100,</span><span class="s3">\n            </span><span class="s1">title: '设置字体',</span><span class="s3">\n            </span><span class="s1">type: 'list',</span><span class="s3">\n            </span><span class="s1">list: fontStyleList.getItemList(),</span><span class="s3">\n            </span><span class="s1">clickHandler: (value: string) =&gt; {</span><span class="s3">\n                </span><span class="s1">// this 是指向当前的 FontStyle 对象</span><span class="s3">\n                </span><span class="s1">this.command(value)</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">super($elem, editor, fontListConf)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行命令</span><span class="s3">\n     </span><span class="s1">* @param value value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public command(value: string): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const isEmptySelection = editor.selection.isSelectionEmpty()</span><span class="s3">\n\n        </span><span class="s1">const $selectionElem = editor.selection.getSelectionContainerElem()?.elems[0]</span><span class="s3">\n\n        </span><span class="s1">if ($selectionElem == null) return</span><span class="s3">\n\n        </span><span class="s1">const isFont = $selectionElem?.nodeName.toLowerCase() !== 'p'</span><span class="s3">\n        </span><span class="s1">const isSameValue = $selectionElem?.getAttribute('face') === value</span><span class="s3">\n\n        </span><span class="s1">if (isEmptySelection) {</span><span class="s3">\n            </span><span class="s1">if (isFont &amp;&amp; !isSameValue) {</span><span class="s3">\n                </span><span class="s1">const $elems = editor.selection.getSelectionRangeTopNodes()</span><span class="s3">\n                </span><span class="s1">editor.selection.createRangeByElem($elems[0])</span><span class="s3">\n                </span><span class="s1">editor.selection.moveCursor($elems[0].elems[0])</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">editor.selection.setRangeToElem($selectionElem)</span><span class="s3">\n            </span><span class="s1">// 插入空白选区</span><span class="s3">\n            </span><span class="s1">editor.selection.createEmptyRange()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">editor.cmd.do('fontName', value)</span><span class="s3">\n\n        </span><span class="s1">if (isEmptySelection) {</span><span class="s3">\n            </span><span class="s1">// 需要将选区范围折叠起来</span><span class="s3">\n            </span><span class="s1">editor.selection.collapseRange()</span><span class="s3">\n            </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">* ?字体是否需要有激活状态这个操作?</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {</span><span class="s3">\n        </span><span class="s1">// const editor = this.editor</span><span class="s3">\n        </span><span class="s1">// const cmdValue = editor.cmd.queryCommandValue('fontName')</span><span class="s3">\n        </span><span class="s1">// if (menusConfig.fontNames.indexOf(cmdValue) &gt;= 0) {</span><span class="s3">\n        </span><span class="s1">//     this.active()</span><span class="s3">\n        </span><span class="s1">// } else {</span><span class="s3">\n        </span><span class="s1">//     this.unActive()</span><span class="s3">\n        </span><span class="s1">// }</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default FontStyle</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 字体 class</span><span class="s3">\n </span><span class="s1">* @author dyl</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { FontStyleType } from '../../config/menus'</span><span class="s3">\n</span><span class="s1">import { DropListItem } from '../menu-constructors/DropList'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 封装的一个字体菜单列表数据的组装对象,</span><span class="s3">\n </span><span class="s1">* 原因是因为在constructor函数中,直接执行此流程,会让代码量看起来较多,</span><span class="s3">\n </span><span class="s1">* 如果要在constructor调用外部函数,个人目前发现会有错误提示,</span><span class="s3">\n </span><span class="s1">* 因此,想着顺便研究实践下ts,遍创建了这样一个类</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">class FontStyleList {</span><span class="s3">\n    </span><span class="s1">private itemList: DropListItem[]</span><span class="s3">\n    </span><span class="s1">constructor(list: FontStyleType) {</span><span class="s3">\n        </span><span class="s1">this.itemList = []</span><span class="s3">\n        </span><span class="s1">list.forEach(fontValue =&gt; {</span><span class="s3">\n            </span><span class="s1">// fontValue 2种情况一种是string类型的直接value等同于font-family</span><span class="s3">\n            </span><span class="s1">// Object类型value为font-family name为ui视图呈现</span><span class="s3">\n            </span><span class="s1">const fontFamily = typeof fontValue === 'string' ? fontValue : fontValue.value</span><span class="s3">\n            </span><span class="s1">const fontName = typeof fontValue === 'string' ? fontValue : fontValue.name</span><span class="s3">\n            </span><span class="s1">this.itemList.push({</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;p style=</span><span class="s3">\&quot;</span><span class="s1">font-family:'${fontFamily}'</span><span class="s3">\&quot;</span><span class="s1">&gt;${fontName}&lt;/p&gt;`),</span><span class="s3">\n                </span><span class="s1">value: fontName,</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public getItemList(): DropListItem[] {</span><span class="s3">\n        </span><span class="s1">return this.itemList</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default FontStyleList</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 字号 FontSize</span><span class="s3">\n </span><span class="s1">* @author lkw</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import DropListMenu from '../menu-constructors/DropListMenu'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import FontSizeList from './FontSizeList'</span><span class="s3">\n\n</span><span class="s1">class FontSize extends DropListMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">字号</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-text-heigh</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">let fontStyleList = new FontSizeList(editor.config.fontSizes)</span><span class="s3">\n        </span><span class="s1">const fontListConf = {</span><span class="s3">\n            </span><span class="s1">width: 160,</span><span class="s3">\n            </span><span class="s1">title: '设置字号',</span><span class="s3">\n            </span><span class="s1">type: 'list',</span><span class="s3">\n            </span><span class="s1">list: fontStyleList.getItemList(),</span><span class="s3">\n            </span><span class="s1">clickHandler: (value: string) =&gt; {</span><span class="s3">\n                </span><span class="s1">// this 是指向当前的 FontSize 对象</span><span class="s3">\n                </span><span class="s1">this.command(value)</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">super($elem, editor, fontListConf)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行命令</span><span class="s3">\n     </span><span class="s1">* @param value value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public command(value: string): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const isEmptySelection = editor.selection.isSelectionEmpty()</span><span class="s3">\n\n        </span><span class="s1">let selectionElem = editor.selection.getSelectionContainerElem()?.elems[0]</span><span class="s3">\n\n        </span><span class="s1">if (selectionElem == null) return</span><span class="s3">\n\n        </span><span class="s1">editor.cmd.do('fontSize', value)</span><span class="s3">\n        </span><span class="s1">if (isEmptySelection) {</span><span class="s3">\n            </span><span class="s1">// 需要将选区范围折叠起来</span><span class="s3">\n            </span><span class="s1">editor.selection.collapseRange()</span><span class="s3">\n            </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">* ?字号是否需要有激活状态这个操作?</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default FontSize</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 字号 class</span><span class="s3">\n </span><span class="s1">* @author lkw</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { DropListItem } from '../menu-constructors/DropList'</span><span class="s3">\n</span><span class="s1">import { FontSizeConfType } from '../../config/menus'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* FontSizeList 字号配置列表</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">class FontSizeList {</span><span class="s3">\n    </span><span class="s1">private itemList: DropListItem[]</span><span class="s3">\n\n    </span><span class="s1">constructor(list: FontSizeConfType) {</span><span class="s3">\n        </span><span class="s1">this.itemList = []</span><span class="s3">\n        </span><span class="s1">for (let key in list) {</span><span class="s3">\n            </span><span class="s1">const item = list[key]</span><span class="s3">\n            </span><span class="s1">this.itemList.push({</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;p style=</span><span class="s3">\&quot;</span><span class="s1">font-size:${key}</span><span class="s3">\&quot;</span><span class="s1">&gt;${item.name}&lt;/p&gt;`),</span><span class="s3">\n                </span><span class="s1">value: item.value,</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public getItemList(): DropListItem[] {</span><span class="s3">\n        </span><span class="s1">return this.itemList</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default FontSizeList</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 对齐方式</span><span class="s3">\n </span><span class="s1">* @author liuwei</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import DropListMenu from '../menu-constructors/DropListMenu'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n\n</span><span class="s1">const SPECIAL_NODE_LIST = ['LI']</span><span class="s3">\n</span><span class="s1">const SPECIAL_TOP_NODE_LIST = ['BLOCKQUOTE']</span><span class="s3">\n\n</span><span class="s1">class Justify extends DropListMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">'&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">对齐</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-paragraph-left</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;&lt;/div&gt;'</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">const dropListConf = {</span><span class="s3">\n            </span><span class="s1">width: 100,</span><span class="s3">\n            </span><span class="s1">title: '对齐方式',</span><span class="s3">\n            </span><span class="s1">type: 'list', // droplist 以列表形式展示</span><span class="s3">\n            </span><span class="s1">list: [</span><span class="s3">\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">$elem: $(</span><span class="s3">\n                        </span><span class="s1">`&lt;p&gt;</span><span class="s3">\n                            </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-paragraph-left w-e-drop-list-item</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n                            </span><span class="s1">${editor.i18next.t('menus.dropListMenu.justify.靠左')}</span><span class="s3">\n                        </span><span class="s1">&lt;/p&gt;`</span><span class="s3">\n                    </span><span class="s1">),</span><span class="s3">\n                    </span><span class="s1">value: 'left',</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">$elem: $(</span><span class="s3">\n                        </span><span class="s1">`&lt;p&gt;</span><span class="s3">\n                            </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-paragraph-center w-e-drop-list-item</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n                            </span><span class="s1">${editor.i18next.t('menus.dropListMenu.justify.居中')}</span><span class="s3">\n                        </span><span class="s1">&lt;/p&gt;`</span><span class="s3">\n                    </span><span class="s1">),</span><span class="s3">\n                    </span><span class="s1">value: 'center',</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">$elem: $(</span><span class="s3">\n                        </span><span class="s1">`&lt;p&gt;</span><span class="s3">\n                            </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-paragraph-right w-e-drop-list-item</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n                            </span><span class="s1">${editor.i18next.t('menus.dropListMenu.justify.靠右')}</span><span class="s3">\n                        </span><span class="s1">&lt;/p&gt;`</span><span class="s3">\n                    </span><span class="s1">),</span><span class="s3">\n                    </span><span class="s1">value: 'right',</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">$elem: $(</span><span class="s3">\n                        </span><span class="s1">`&lt;p&gt;</span><span class="s3">\n                            </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-paragraph-justify w-e-drop-list-item</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n                            </span><span class="s1">${editor.i18next.t('menus.dropListMenu.justify.两端')}</span><span class="s3">\n                        </span><span class="s1">&lt;/p&gt;`</span><span class="s3">\n                    </span><span class="s1">),</span><span class="s3">\n                    </span><span class="s1">value: 'justify',</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">],</span><span class="s3">\n            </span><span class="s1">clickHandler: (value: string) =&gt; {</span><span class="s3">\n                </span><span class="s1">// 执行对应的value操作</span><span class="s3">\n                </span><span class="s1">this.command(value)</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">super($elem, editor, dropListConf)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行命令</span><span class="s3">\n     </span><span class="s1">* @param value value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public command(value: string): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const selection = editor.selection</span><span class="s3">\n        </span><span class="s1">const $selectionElem = selection.getSelectionContainerElem()</span><span class="s3">\n\n        </span><span class="s1">// 保存选区</span><span class="s3">\n        </span><span class="s1">selection.saveRange()</span><span class="s3">\n\n        </span><span class="s1">// 获取顶级元素</span><span class="s3">\n        </span><span class="s1">const $elems = editor.selection.getSelectionRangeTopNodes()</span><span class="s3">\n        </span><span class="s1">if ($selectionElem?.length) {</span><span class="s3">\n            </span><span class="s1">// list 在chrome下默认多包裹一个 p，导致不能通过顶层元素判断，所以单独加个判断</span><span class="s3">\n            </span><span class="s1">if (this.isSpecialNode($selectionElem, $elems[0]) || this.isSpecialTopNode($elems[0])) {</span><span class="s3">\n                </span><span class="s1">const el = this.getSpecialNodeUntilTop($selectionElem, $elems[0])</span><span class="s3">\n                </span><span class="s1">if (el == null) return</span><span class="s3">\n\n                </span><span class="s1">$(el).css('text-align', value)</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">$elems.forEach((el: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">el.css('text-align', value)</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">//恢复选区</span><span class="s3">\n        </span><span class="s1">selection.restoreSelection()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取选区中的特殊元素，如果不存在，则直接返回顶层元素子元素</span><span class="s3">\n     </span><span class="s1">* @param el DomElement</span><span class="s3">\n     </span><span class="s1">* @param topEl DomElement</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private getSpecialNodeUntilTop(el: DomElement, topEl: DomElement) {</span><span class="s3">\n        </span><span class="s1">let parentNode: Node | null = el.elems[0]</span><span class="s3">\n        </span><span class="s1">const topNode = topEl.elems[0]</span><span class="s3">\n        </span><span class="s1">// 可能出现嵌套的情况，所以一级一级向上找，是否是特殊元素</span><span class="s3">\n        </span><span class="s1">while (parentNode != null) {</span><span class="s3">\n            </span><span class="s1">if (SPECIAL_NODE_LIST.indexOf(parentNode?.nodeName) !== -1) {</span><span class="s3">\n                </span><span class="s1">return parentNode</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">// 如果再到 top 元素之前还没找到特殊元素，直接返回元素</span><span class="s3">\n            </span><span class="s1">if (parentNode.parentNode === topNode) {</span><span class="s3">\n                </span><span class="s1">return parentNode</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">parentNode = parentNode.parentNode</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return parentNode</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 当选区元素或者顶层元素是某些特殊元素时，只需要修改子元素的对齐样式的元素</span><span class="s3">\n     </span><span class="s1">* @param el DomElement</span><span class="s3">\n     </span><span class="s1">* @param topEl DomElement</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private isSpecialNode(el: DomElement, topEl: DomElement) {</span><span class="s3">\n        </span><span class="s1">// 如果以后有类似的元素要这样处理，直接修改这个数组即可</span><span class="s3">\n        </span><span class="s1">const parentNode = this.getSpecialNodeUntilTop(el, topEl)</span><span class="s3">\n\n        </span><span class="s1">if (parentNode == null) return false</span><span class="s3">\n\n        </span><span class="s1">return SPECIAL_NODE_LIST.indexOf(parentNode.nodeName) !== -1</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 当选区 top 元素为某些特殊元素时，只需要修改子元素的对齐样式的元素</span><span class="s3">\n     </span><span class="s1">* @param el DomElement</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private isSpecialTopNode(topEl: DomElement) {</span><span class="s3">\n        </span><span class="s1">if (topEl == null) return false</span><span class="s3">\n\n        </span><span class="s1">return SPECIAL_TOP_NODE_LIST.indexOf(topEl.elems[0]?.nodeName) !== -1</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试改变菜单激活（高亮）状态</span><span class="s3">\n     </span><span class="s1">* 默认左对齐,若选择其他对其方式对active进行高亮否则unActive</span><span class="s3">\n     </span><span class="s1">* ?考虑优化的话 是否可以对具体选中的进行高亮</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Justify</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 引用</span><span class="s3">\n </span><span class="s1">* @author tonghan</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import BtnMenu from '../menu-constructors/BtnMenu'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import bindEvent from './bind-event'</span><span class="s3">\n</span><span class="s1">import createQuote from './create-quote-node'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../../utils/const'</span><span class="s3">\n\n</span><span class="s1">class Quote extends BtnMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">引用</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-quotes-left</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n        </span><span class="s1">bindEvent(editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const isSelectEmpty = editor.selection.isSelectionEmpty()</span><span class="s3">\n        </span><span class="s1">let topNodeElem: DomElement[] = editor.selection.getSelectionRangeTopNodes()</span><span class="s3">\n        </span><span class="s1">const $topNodeElem: DomElement = topNodeElem[topNodeElem.length - 1]</span><span class="s3">\n        </span><span class="s1">const nodeName = this.getTopNodeName()</span><span class="s3">\n        </span><span class="s1">// IE 中不支持 formatBlock &lt;BLOCKQUOTE&gt; ，要用其他方式兼容</span><span class="s3">\n        </span><span class="s1">// 兼容firefox无法取消blockquote的问题</span><span class="s3">\n        </span><span class="s1">if (nodeName === 'BLOCKQUOTE') {</span><span class="s3">\n            </span><span class="s1">// 撤销 quote</span><span class="s3">\n            </span><span class="s1">const $targetELem = $($topNodeElem.childNodes())</span><span class="s3">\n            </span><span class="s1">const len = $targetELem.length</span><span class="s3">\n            </span><span class="s1">let $middle = $topNodeElem</span><span class="s3">\n            </span><span class="s1">$targetELem.forEach((elem: Node) =&gt; {</span><span class="s3">\n                </span><span class="s1">const $elem = $(elem)</span><span class="s3">\n                </span><span class="s1">$elem.insertAfter($middle)</span><span class="s3">\n                </span><span class="s1">$middle = $elem</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">$topNodeElem.remove()</span><span class="s3">\n            </span><span class="s1">editor.selection.moveCursor($targetELem.elems[len - 1])</span><span class="s3">\n            </span><span class="s1">// 即时更新btn状态</span><span class="s3">\n            </span><span class="s1">this.tryChangeActive()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 将 P 转换为 quote</span><span class="s3">\n\n            </span><span class="s1">/**</span><span class="s3">\n            </span><span class="s1">@author:gavin</span><span class="s3">\n            </span><span class="s1">@description </span><span class="s3">\n                </span><span class="s1">1. 解决ctrl+a全选删除后，选区错位的问题。</span><span class="s3">\n                </span><span class="s1">2. 或者内容清空，按删除键后，选区错位。</span><span class="s3">\n\n                </span><span class="s1">导致topNodeElem选择的是编辑器顶层元素，在进行dom操作时，quote插入的位置有问题。</span><span class="s3">\n            </span><span class="s1">**/</span><span class="s3">\n            </span><span class="s1">let $quote = createQuote(topNodeElem)</span><span class="s3">\n\n            </span><span class="s1">//如果选择的元素时顶层元素，就将选区移动到正确的位置</span><span class="s3">\n            </span><span class="s1">if (editor.$textElem.equal($topNodeElem)) {</span><span class="s3">\n                </span><span class="s1">const containerElem = editor.selection.getSelectionContainerElem()?.elems[0]!</span><span class="s3">\n                </span><span class="s1">editor.selection.createRangeByElems(</span><span class="s3">\n                    </span><span class="s1">containerElem.children[0],</span><span class="s3">\n                    </span><span class="s1">containerElem.children[0]</span><span class="s3">\n                </span><span class="s1">)</span><span class="s3">\n\n                </span><span class="s1">topNodeElem = editor.selection.getSelectionRangeTopNodes()</span><span class="s3">\n                </span><span class="s1">$quote = createQuote(topNodeElem)</span><span class="s3">\n                </span><span class="s1">$topNodeElem.append($quote)</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">$quote.insertAfter($topNodeElem)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">this.delSelectNode(topNodeElem)</span><span class="s3">\n            </span><span class="s1">const moveNode = $quote.childNodes()?.last().getNode() as Node</span><span class="s3">\n\n            </span><span class="s1">if (moveNode == null) return</span><span class="s3">\n\n            </span><span class="s1">// 兼容firefox（firefox下空行情况下选区会在br后，造成自动换行的问题）</span><span class="s3">\n            </span><span class="s1">moveNode.textContent</span><span class="s3">\n                </span><span class="s1">? editor.selection.moveCursor(moveNode)</span><span class="s3">\n                </span><span class="s1">: editor.selection.moveCursor(moveNode, 0)</span><span class="s3">\n            </span><span class="s1">// 即时更新btn状态</span><span class="s3">\n            </span><span class="s1">this.tryChangeActive()</span><span class="s3">\n            </span><span class="s1">// 防止最后一行无法跳出</span><span class="s3">\n            </span><span class="s1">$(EMPTY_P).insertAfter($quote)</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (isSelectEmpty) {</span><span class="s3">\n            </span><span class="s1">// 需要将选区范围折叠起来</span><span class="s3">\n            </span><span class="s1">editor.selection.collapseRange()</span><span class="s3">\n            </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const cmdValue = editor.selection.getSelectionRangeTopNodes()[0]?.getNodeName()</span><span class="s3">\n        </span><span class="s1">if (cmdValue === 'BLOCKQUOTE') {</span><span class="s3">\n            </span><span class="s1">this.active()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">this.unActive()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取包裹在最外层的节点(防止内部嵌入多个样式)</span><span class="s3">\n     </span><span class="s1">* @param selectionElem 选中的节点</span><span class="s3">\n     </span><span class="s1">* @returns {string} 最终要处理的节点名称</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private getTopNodeName(): string {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $topNodeElem = editor.selection.getSelectionRangeTopNodes()[0]</span><span class="s3">\n        </span><span class="s1">const nodeName = $topNodeElem?.getNodeName()</span><span class="s3">\n\n        </span><span class="s1">return nodeName</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 删除选中的元素</span><span class="s3">\n     </span><span class="s1">* @param selectElem 选中的元素节点数组</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private delSelectNode(selectElem: DomElement[]) {</span><span class="s3">\n        </span><span class="s1">selectElem.forEach(node =&gt; {</span><span class="s3">\n            </span><span class="s1">node.remove()</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Quote</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import { EMPTY_P } from '../../../utils/const'</span><span class="s3">\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">function bindEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">function quoteEnter(e: Event) {</span><span class="s3">\n        </span><span class="s1">const $selectElem = editor.selection.getSelectionContainerElem() as DomElement</span><span class="s3">\n        </span><span class="s1">const $topSelectElem = editor.selection.getSelectionRangeTopNodes()[0]</span><span class="s3">\n        </span><span class="s1">// 对quote的enter进行特殊处理</span><span class="s3">\n        </span><span class="s1">//最后一行为空标签时再按会出跳出blockquote</span><span class="s3">\n        </span><span class="s1">if ($topSelectElem?.getNodeName() === 'BLOCKQUOTE') {</span><span class="s3">\n            </span><span class="s1">// firefox下点击引用按钮会选中外容器&lt;blockquote&gt;&lt;/blockquote&gt;</span><span class="s3">\n            </span><span class="s1">if ($selectElem.getNodeName() === 'BLOCKQUOTE') {</span><span class="s3">\n                </span><span class="s1">const selectNode = $selectElem.childNodes()?.getNode() as Node</span><span class="s3">\n                </span><span class="s1">editor.selection.moveCursor(selectNode)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">if ($selectElem.text() === '') {</span><span class="s3">\n                </span><span class="s1">e.preventDefault()</span><span class="s3">\n                </span><span class="s1">$selectElem.remove()</span><span class="s3">\n                </span><span class="s1">const $newLine = $(EMPTY_P)</span><span class="s3">\n                </span><span class="s1">$newLine.insertAfter($topSelectElem)</span><span class="s3">\n                </span><span class="s1">// 将光标移动br前面</span><span class="s3">\n                </span><span class="s1">editor.selection.moveCursor($newLine.getNode(), 0)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 当blockQuote中没有内容回车后移除blockquote</span><span class="s3">\n            </span><span class="s1">if ($topSelectElem.text() === '') {</span><span class="s3">\n                </span><span class="s1">$topSelectElem.remove()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.enterDownEvents.push(quoteEnter)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default bindEvent</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 创建一个blockquote元素节点</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function createQuote($childElem: DomElement[]): DomElement {</span><span class="s3">\n    </span><span class="s1">const $targetElem = $(`&lt;blockquote&gt;&lt;/blockquote&gt;`)</span><span class="s3">\n    </span><span class="s1">$childElem.forEach(node =&gt; {</span><span class="s3">\n        </span><span class="s1">$targetElem.append(node.clone(true))</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">return $targetElem</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default createQuote</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 背景颜色 BackColor</span><span class="s3">\n </span><span class="s1">* @author lkw</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import DropListMenu from '../menu-constructors/DropListMenu'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import { hexToRgb } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">class BackColor extends DropListMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">背景色</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-paint-brush</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">const colorListConf = {</span><span class="s3">\n            </span><span class="s1">width: 120,</span><span class="s3">\n            </span><span class="s1">title: '背景颜色',</span><span class="s3">\n            </span><span class="s1">// droplist 内容以 block 形式展示</span><span class="s3">\n            </span><span class="s1">type: 'inline-block',</span><span class="s3">\n            </span><span class="s1">list: editor.config.colors.map(color =&gt; {</span><span class="s3">\n                </span><span class="s1">return {</span><span class="s3">\n                    </span><span class="s1">$elem: $(`&lt;i style=</span><span class="s3">\&quot;</span><span class="s1">color:${color};</span><span class="s3">\&quot; </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-paint-brush</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;`),</span><span class="s3">\n                    </span><span class="s1">value: color,</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}),</span><span class="s3">\n            </span><span class="s1">clickHandler: (value: string) =&gt; {</span><span class="s3">\n                </span><span class="s1">// this 是指向当前的 BackColor 对象</span><span class="s3">\n                </span><span class="s1">this.command(value)</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">super($elem, editor, colorListConf)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行命令</span><span class="s3">\n     </span><span class="s1">* @param value value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public command(value: string): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const isEmptySelection = editor.selection.isSelectionEmpty()</span><span class="s3">\n        </span><span class="s1">const $selectionElem = editor.selection.getSelectionContainerElem()?.elems[0]</span><span class="s3">\n\n        </span><span class="s1">if ($selectionElem == null) return</span><span class="s3">\n\n        </span><span class="s1">const isSpan = $selectionElem?.nodeName.toLowerCase() !== 'p'</span><span class="s3">\n        </span><span class="s1">const bgColor = $selectionElem?.style.backgroundColor</span><span class="s3">\n        </span><span class="s1">const isSameColor = hexToRgb(value) === bgColor</span><span class="s3">\n\n        </span><span class="s1">if (isEmptySelection) {</span><span class="s3">\n            </span><span class="s1">if (isSpan &amp;&amp; !isSameColor) {</span><span class="s3">\n                </span><span class="s1">const $elems = editor.selection.getSelectionRangeTopNodes()</span><span class="s3">\n                </span><span class="s1">editor.selection.createRangeByElem($elems[0])</span><span class="s3">\n                </span><span class="s1">editor.selection.moveCursor($elems[0].elems[0])</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">// 插入空白选区</span><span class="s3">\n            </span><span class="s1">editor.selection.createEmptyRange()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">editor.cmd.do('backColor', value)</span><span class="s3">\n\n        </span><span class="s1">if (isEmptySelection) {</span><span class="s3">\n            </span><span class="s1">// 需要将选区范围折叠起来</span><span class="s3">\n            </span><span class="s1">editor.selection.collapseRange()</span><span class="s3">\n            </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default BackColor</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 文字颜色 FontColor</span><span class="s3">\n </span><span class="s1">* @author lkw</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import DropListMenu from '../menu-constructors/DropListMenu'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n\n</span><span class="s1">class FontColor extends DropListMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">文字颜色</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-pencil2</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">const colorListConf = {</span><span class="s3">\n            </span><span class="s1">width: 120,</span><span class="s3">\n            </span><span class="s1">title: '文字颜色',</span><span class="s3">\n            </span><span class="s1">// droplist 内容以 block 形式展示</span><span class="s3">\n            </span><span class="s1">type: 'inline-block',</span><span class="s3">\n            </span><span class="s1">list: editor.config.colors.map(color =&gt; {</span><span class="s3">\n                </span><span class="s1">return {</span><span class="s3">\n                    </span><span class="s1">$elem: $(`&lt;i style=</span><span class="s3">\&quot;</span><span class="s1">color:${color};</span><span class="s3">\&quot; </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-pencil2</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;`),</span><span class="s3">\n                    </span><span class="s1">value: color,</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}),</span><span class="s3">\n            </span><span class="s1">clickHandler: (value: string) =&gt; {</span><span class="s3">\n                </span><span class="s1">// this 是指向当前的 BackColor 对象</span><span class="s3">\n                </span><span class="s1">this.command(value)</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">super($elem, editor, colorListConf)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行命令</span><span class="s3">\n     </span><span class="s1">* @param value value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public command(value: string): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const isEmptySelection = editor.selection.isSelectionEmpty()</span><span class="s3">\n        </span><span class="s1">const $selectionElem = editor.selection.getSelectionContainerElem()?.elems[0]</span><span class="s3">\n\n        </span><span class="s1">if ($selectionElem == null) return</span><span class="s3">\n\n        </span><span class="s1">// 获取选区范围的文字</span><span class="s3">\n        </span><span class="s1">const $selectionText = editor.selection.getSelectionText()</span><span class="s3">\n        </span><span class="s1">// 如果设置的是 a 标签就特殊处理一下，避免回车换行设置颜色无效的情况</span><span class="s3">\n        </span><span class="s1">// 只处理选中a标签内全部文字的情况，因为选中部分文字不存在换行颜色失效的情况</span><span class="s3">\n        </span><span class="s1">if ($selectionElem.nodeName === 'A' &amp;&amp; $selectionElem.textContent === $selectionText) {</span><span class="s3">\n            </span><span class="s1">// 创建一个相当于占位的元素</span><span class="s3">\n            </span><span class="s1">const _payloadElem = $('&lt;span&gt;&amp;#8203;&lt;/span&gt;').getNode()</span><span class="s3">\n            </span><span class="s1">// 添加到a标签之后</span><span class="s3">\n            </span><span class="s1">$selectionElem.appendChild(_payloadElem)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">editor.cmd.do('foreColor', value)</span><span class="s3">\n\n        </span><span class="s1">if (isEmptySelection) {</span><span class="s3">\n            </span><span class="s1">// 需要将选区范围折叠起来</span><span class="s3">\n            </span><span class="s1">editor.selection.collapseRange()</span><span class="s3">\n            </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default FontColor</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 视频 菜单</span><span class="s3">\n </span><span class="s1">* @author tonghan</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Panel from '../menu-constructors/Panel'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import PanelMenu from '../menu-constructors/PanelMenu'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import createPanelConf from './create-panel-conf'</span><span class="s3">\n</span><span class="s1">import bindEvent from './bind-event/index'</span><span class="s3">\n\n</span><span class="s1">class Video extends PanelMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">视频</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-play</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n\n        </span><span class="s1">// 绑定事件 tootip</span><span class="s3">\n        </span><span class="s1">bindEvent(editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 菜单点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">// 弹出 panel</span><span class="s3">\n        </span><span class="s1">this.createPanel('')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 创建 panel</span><span class="s3">\n     </span><span class="s1">* @param link 链接</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private createPanel(iframe: string): void {</span><span class="s3">\n        </span><span class="s1">const conf = createPanelConf(this.editor, iframe)</span><span class="s3">\n        </span><span class="s1">const panel = new Panel(this, conf)</span><span class="s3">\n        </span><span class="s1">panel.create()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单 active 状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive() {}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Video</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description video 菜单 panel tab 配置</span><span class="s3">\n </span><span class="s1">* @author tonghan</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { PanelConf, PanelTabConf } from '../menu-constructors/Panel'</span><span class="s3">\n</span><span class="s1">import { getRandom } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import UploadVideo from './upload-video'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../../utils/const'</span><span class="s3">\n\n</span><span class="s1">export default function (editor: Editor, video: string): PanelConf {</span><span class="s3">\n    </span><span class="s1">const config = editor.config</span><span class="s3">\n    </span><span class="s1">const uploadVideo = new UploadVideo(editor)</span><span class="s3">\n\n    </span><span class="s1">// panel 中需要用到的id</span><span class="s3">\n    </span><span class="s1">const inputIFrameId = getRandom('input-iframe')</span><span class="s3">\n    </span><span class="s1">const btnOkId = getRandom('btn-ok')</span><span class="s3">\n    </span><span class="s1">const inputUploadId = getRandom('input-upload')</span><span class="s3">\n    </span><span class="s1">const btnStartId = getRandom('btn-local-ok')</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 插入链接</span><span class="s3">\n     </span><span class="s1">* @param iframe html标签</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function insertVideo(video: string): void {</span><span class="s3">\n        </span><span class="s1">editor.cmd.do('insertHTML', video + EMPTY_P)</span><span class="s3">\n\n        </span><span class="s1">// video添加后的回调</span><span class="s3">\n        </span><span class="s1">editor.config.onlineVideoCallback(video)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 校验在线视频链接</span><span class="s3">\n     </span><span class="s1">* @param video 在线视频链接</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function checkOnlineVideo(video: string): boolean {</span><span class="s3">\n        </span><span class="s1">// 查看开发者自定义配置的返回值</span><span class="s3">\n        </span><span class="s1">const check = editor.config.onlineVideoCheck(video)</span><span class="s3">\n        </span><span class="s1">if (check === true) {</span><span class="s3">\n            </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (typeof check === 'string') {</span><span class="s3">\n            </span><span class="s1">//用户未能通过开发者的校验，开发者希望我们提示这一字符串</span><span class="s3">\n            </span><span class="s1">editor.config.customAlert(check, 'error')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// tabs配置</span><span class="s3">\n    </span><span class="s1">// const fileMultipleAttr = config.uploadVideoMaxLength === 1 ? '' : 'multiple=</span><span class="s3">\&quot;</span><span class="s1">multiple</span><span class="s3">\&quot;</span><span class="s1">'</span><span class="s3">\n    </span><span class="s1">const tabsConf: PanelTabConf[] = [</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">// tab 的标题</span><span class="s3">\n            </span><span class="s1">title: editor.i18next.t('menus.panelMenus.video.上传视频'),</span><span class="s3">\n            </span><span class="s1">tpl: `&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-up-video-container</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;div id=</span><span class="s3">\&quot;</span><span class="s1">${btnStartId}</span><span class="s3">\&quot; </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">w-e-up-btn</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-upload2</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;/div&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;div style=</span><span class="s3">\&quot;</span><span class="s1">display:none;</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;input id=</span><span class="s3">\&quot;</span><span class="s1">${inputUploadId}</span><span class="s3">\&quot; </span><span class="s1">type=</span><span class="s3">\&quot;</span><span class="s1">file</span><span class="s3">\&quot; </span><span class="s1">accept=</span><span class="s3">\&quot;</span><span class="s1">video/*</span><span class="s3">\&quot;</span><span class="s1">/&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;/div&gt;</span><span class="s3">\n                 </span><span class="s1">&lt;/div&gt;`,</span><span class="s3">\n            </span><span class="s1">events: [</span><span class="s3">\n                </span><span class="s1">// 触发选择视频</span><span class="s3">\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">selector: '#' + btnStartId,</span><span class="s3">\n                    </span><span class="s1">type: 'click',</span><span class="s3">\n                    </span><span class="s1">fn: () =&gt; {</span><span class="s3">\n                        </span><span class="s1">const $file = $('#' + inputUploadId)</span><span class="s3">\n                        </span><span class="s1">const fileElem = $file.elems[0]</span><span class="s3">\n                        </span><span class="s1">if (fileElem) {</span><span class="s3">\n                            </span><span class="s1">fileElem.click()</span><span class="s3">\n                        </span><span class="s1">} else {</span><span class="s3">\n                            </span><span class="s1">// 返回 true 可关闭 panel</span><span class="s3">\n                            </span><span class="s1">return true</span><span class="s3">\n                        </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">// 选择视频完毕</span><span class="s3">\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">selector: '#' + inputUploadId,</span><span class="s3">\n                    </span><span class="s1">type: 'change',</span><span class="s3">\n                    </span><span class="s1">fn: () =&gt; {</span><span class="s3">\n                        </span><span class="s1">const $file = $('#' + inputUploadId)</span><span class="s3">\n                        </span><span class="s1">const fileElem = $file.elems[0]</span><span class="s3">\n                        </span><span class="s1">if (!fileElem) {</span><span class="s3">\n                            </span><span class="s1">// 返回 true 可关闭 panel</span><span class="s3">\n                            </span><span class="s1">return true</span><span class="s3">\n                        </span><span class="s1">}</span><span class="s3">\n\n                        </span><span class="s1">// 获取选中的 file 对象列表</span><span class="s3">\n                        </span><span class="s1">const fileList = (fileElem as any).files</span><span class="s3">\n                        </span><span class="s1">if (fileList.length) {</span><span class="s3">\n                            </span><span class="s1">uploadVideo.uploadVideo(fileList)</span><span class="s3">\n                        </span><span class="s1">}</span><span class="s3">\n\n                        </span><span class="s1">// 返回 true 可关闭 panel</span><span class="s3">\n                        </span><span class="s1">return true</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">],</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">// tab 的标题</span><span class="s3">\n            </span><span class="s1">title: editor.i18next.t('menus.panelMenus.video.插入视频'),</span><span class="s3">\n            </span><span class="s1">// 模板</span><span class="s3">\n            </span><span class="s1">tpl: `&lt;div&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;input </span><span class="s3">\n                        </span><span class="s1">id=</span><span class="s3">\&quot;</span><span class="s1">${inputIFrameId}</span><span class="s3">\&quot; \n                        </span><span class="s1">type=</span><span class="s3">\&quot;</span><span class="s1">text</span><span class="s3">\&quot; \n                        </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">block</span><span class="s3">\&quot; \n                        </span><span class="s1">placeholder=</span><span class="s3">\&quot;</span><span class="s1">${editor.i18next.t('如')}：&lt;iframe src=... &gt;&lt;/iframe&gt;</span><span class="s3">\&quot;</span><span class="s1">/&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;/td&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-button-container</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;button type=</span><span class="s3">\&quot;</span><span class="s1">button</span><span class="s3">\&quot; </span><span class="s1">id=</span><span class="s3">\&quot;</span><span class="s1">${btnOkId}</span><span class="s3">\&quot; </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">right</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                            </span><span class="s1">${editor.i18next.t('插入')}</span><span class="s3">\n                        </span><span class="s1">&lt;/button&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;/div&gt;</span><span class="s3">\n                </span><span class="s1">&lt;/div&gt;`,</span><span class="s3">\n            </span><span class="s1">// 事件绑定</span><span class="s3">\n            </span><span class="s1">events: [</span><span class="s3">\n                </span><span class="s1">// 插入视频</span><span class="s3">\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">selector: '#' + btnOkId,</span><span class="s3">\n                    </span><span class="s1">type: 'click',</span><span class="s3">\n                    </span><span class="s1">fn: () =&gt; {</span><span class="s3">\n                        </span><span class="s1">// 执行插入视频</span><span class="s3">\n                        </span><span class="s1">const $video = $('#' + inputIFrameId)</span><span class="s3">\n                        </span><span class="s1">let video = $video.val().trim()</span><span class="s3">\n\n                        </span><span class="s1">// 视频为空，则不插入</span><span class="s3">\n                        </span><span class="s1">if (!video) return</span><span class="s3">\n                        </span><span class="s1">// 对当前用户插入的内容进行判断，插入为空，或者返回false，都停止插入</span><span class="s3">\n                        </span><span class="s1">if (!checkOnlineVideo(video)) return</span><span class="s3">\n\n                        </span><span class="s1">insertVideo(video)</span><span class="s3">\n\n                        </span><span class="s1">// 返回 true，表示该事件执行完之后，panel 要关闭。否则 panel 不会关闭</span><span class="s3">\n                        </span><span class="s1">return true</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">bindEnter: true,</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">],</span><span class="s3">\n        </span><span class="s1">}, // tab end</span><span class="s3">\n    </span><span class="s1">]</span><span class="s3">\n\n    </span><span class="s1">const conf: PanelConf = {</span><span class="s3">\n        </span><span class="s1">width: 300,</span><span class="s3">\n        </span><span class="s1">height: 0,</span><span class="s3">\n\n        </span><span class="s1">// panel 中可包含多个 tab</span><span class="s3">\n        </span><span class="s1">tabs: [], // tabs end</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 显示“上传视频”</span><span class="s3">\n    </span><span class="s1">if (window.FileReader &amp;&amp; (config.uploadVideoServer || config.customUploadVideo)) {</span><span class="s3">\n        </span><span class="s1">conf.tabs.push(tabsConf[0])</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// 显示“插入视频”</span><span class="s3">\n    </span><span class="s1">if (config.showLinkVideo) {</span><span class="s3">\n        </span><span class="s1">conf.tabs.push(tabsConf[1])</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return conf</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 上传视频</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { arrForEach, forEach } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import post from '../../editor/upload/upload-core'</span><span class="s3">\n</span><span class="s1">import Progress from '../../editor/upload/progress'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../../utils/const'</span><span class="s3">\n</span><span class="s1">import { UA } from '../../utils/util'</span><span class="s3">\n\n</span><span class="s1">type ResData = {</span><span class="s3">\n    </span><span class="s1">url: string</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// 后台返回的格式</span><span class="s3">\n</span><span class="s1">export type ResType = {</span><span class="s3">\n    </span><span class="s1">errno: number | string</span><span class="s3">\n    </span><span class="s1">data: ResData</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">class UploadVideo {</span><span class="s3">\n    </span><span class="s1">private editor: Editor</span><span class="s3">\n\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">this.editor = editor</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 上传视频</span><span class="s3">\n     </span><span class="s1">* @param files 文件列表</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public uploadVideo(files: FileList | File[]): void {</span><span class="s3">\n        </span><span class="s1">if (!files.length) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const config = editor.config</span><span class="s3">\n\n        </span><span class="s1">// ------------------------------ i18next ------------------------------</span><span class="s3">\n\n        </span><span class="s1">const i18nPrefix = 'validate.'</span><span class="s3">\n        </span><span class="s1">const t = (text: string): string =&gt; {</span><span class="s3">\n            </span><span class="s1">return editor.i18next.t(i18nPrefix + text)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// ------------------------------ 获取配置信息 ------------------------------</span><span class="s3">\n        </span><span class="s1">// 服务端地址</span><span class="s3">\n        </span><span class="s1">let uploadVideoServer = config.uploadVideoServer</span><span class="s3">\n        </span><span class="s1">// 上传视频的最大体积，默认 1024M</span><span class="s3">\n        </span><span class="s1">const maxSize = config.uploadVideoMaxSize</span><span class="s3">\n        </span><span class="s1">const uploadVideoMaxSize = maxSize / 1024</span><span class="s3">\n        </span><span class="s1">// 一次最多上传多少个视频</span><span class="s3">\n        </span><span class="s1">// const uploadVideoMaxLength = config.uploadVideoMaxLength</span><span class="s3">\n        </span><span class="s1">// 自定义上传视频的名称</span><span class="s3">\n        </span><span class="s1">const uploadVideoName = config.uploadVideoName</span><span class="s3">\n        </span><span class="s1">// 上传视频自定义参数</span><span class="s3">\n        </span><span class="s1">const uploadVideoParams = config.uploadVideoParams</span><span class="s3">\n        </span><span class="s1">// 自定义参数拼接到 url 中</span><span class="s3">\n        </span><span class="s1">const uploadVideoParamsWithUrl = config.uploadVideoParamsWithUrl</span><span class="s3">\n        </span><span class="s1">// 上传视频自定义 header</span><span class="s3">\n        </span><span class="s1">const uploadVideoHeaders = config.uploadVideoHeaders</span><span class="s3">\n        </span><span class="s1">// 钩子函数</span><span class="s3">\n        </span><span class="s1">const uploadVideoHooks = config.uploadVideoHooks</span><span class="s3">\n        </span><span class="s1">// 上传视频超时时间 ms 默认2个小时</span><span class="s3">\n        </span><span class="s1">const uploadVideoTimeout = config.uploadVideoTimeout</span><span class="s3">\n        </span><span class="s1">// 跨域带 cookie</span><span class="s3">\n        </span><span class="s1">const withVideoCredentials = config.withVideoCredentials</span><span class="s3">\n        </span><span class="s1">// 自定义上传</span><span class="s3">\n        </span><span class="s1">const customUploadVideo = config.customUploadVideo</span><span class="s3">\n        </span><span class="s1">// 格式校验</span><span class="s3">\n        </span><span class="s1">const uploadVideoAccept = config.uploadVideoAccept</span><span class="s3">\n\n        </span><span class="s1">// ------------------------------ 验证文件信息 ------------------------------</span><span class="s3">\n        </span><span class="s1">const resultFiles: File[] = []</span><span class="s3">\n        </span><span class="s1">const errInfos: string[] = []</span><span class="s3">\n        </span><span class="s1">arrForEach(files, file =&gt; {</span><span class="s3">\n            </span><span class="s1">const name = file.name</span><span class="s3">\n            </span><span class="s1">const size = file.size / 1024 / 1024</span><span class="s3">\n\n            </span><span class="s1">// chrome 低版本 name === undefined</span><span class="s3">\n            </span><span class="s1">if (!name || !size) {</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">if (!(uploadVideoAccept instanceof Array)) {</span><span class="s3">\n                </span><span class="s1">// 格式不是数组</span><span class="s3">\n                </span><span class="s1">errInfos.push(`【${uploadVideoAccept}】${t('uploadVideoAccept 不是Array')}`)</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">if (</span><span class="s3">\n                </span><span class="s1">!uploadVideoAccept.some(</span><span class="s3">\n                    </span><span class="s1">item =&gt; item === name.split('.')[name.split('.').length - 1]</span><span class="s3">\n                </span><span class="s1">)</span><span class="s3">\n            </span><span class="s1">) {</span><span class="s3">\n                </span><span class="s1">// 后缀名不合法，不是视频</span><span class="s3">\n                </span><span class="s1">errInfos.push(`【${name}】${t('不是视频')}`)</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">if (uploadVideoMaxSize &lt; size) {</span><span class="s3">\n                </span><span class="s1">// 上传视频过大</span><span class="s3">\n                </span><span class="s1">errInfos.push(`【${name}】${t('大于')} ${uploadVideoMaxSize}M`)</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">//验证通过的加入结果列表</span><span class="s3">\n            </span><span class="s1">resultFiles.push(file)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">// 抛出验证信息</span><span class="s3">\n        </span><span class="s1">if (errInfos.length) {</span><span class="s3">\n            </span><span class="s1">config.customAlert(`${t('视频验证未通过')}: </span><span class="s3">\\</span><span class="s1">n` + errInfos.join('</span><span class="s3">\\</span><span class="s1">n'), 'warning')</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// 如果过滤后文件列表为空直接返回</span><span class="s3">\n        </span><span class="s1">if (resultFiles.length === 0) {</span><span class="s3">\n            </span><span class="s1">config.customAlert(t('传入的文件不合法'), 'warning')</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// ------------------------------ 自定义上传 ------------------------------</span><span class="s3">\n        </span><span class="s1">if (customUploadVideo &amp;&amp; typeof customUploadVideo === 'function') {</span><span class="s3">\n            </span><span class="s1">customUploadVideo(resultFiles, this.insertVideo.bind(this))</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 添加视频数据</span><span class="s3">\n        </span><span class="s1">const formData = new FormData()</span><span class="s3">\n        </span><span class="s1">resultFiles.forEach((file: File, index: number) =&gt; {</span><span class="s3">\n            </span><span class="s1">let name = uploadVideoName || file.name</span><span class="s3">\n            </span><span class="s1">if (resultFiles.length &gt; 1) {</span><span class="s3">\n                </span><span class="s1">// 多个文件时，filename 不能重复</span><span class="s3">\n                </span><span class="s1">name = name + (index + 1)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">formData.append(name, file)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// ------------------------------ 上传视频 ------------------------------</span><span class="s3">\n\n        </span><span class="s1">//添加自定义参数  基于有服务端地址的情况下</span><span class="s3">\n        </span><span class="s1">if (uploadVideoServer) {</span><span class="s3">\n            </span><span class="s1">// 添加自定义参数</span><span class="s3">\n            </span><span class="s1">const uploadVideoServerArr = uploadVideoServer.split('#')</span><span class="s3">\n            </span><span class="s1">uploadVideoServer = uploadVideoServerArr[0]</span><span class="s3">\n            </span><span class="s1">const uploadVideoServerHash = uploadVideoServerArr[1] || ''</span><span class="s3">\n            </span><span class="s1">forEach(uploadVideoParams, (key: string, val: string) =&gt; {</span><span class="s3">\n                </span><span class="s1">// 因使用者反应，自定义参数不能默认 encode ，由 v3.1.1 版本开始注释掉</span><span class="s3">\n                </span><span class="s1">// val = encodeURIComponent(val)</span><span class="s3">\n\n                </span><span class="s1">// 第一，将参数拼接到 url 中</span><span class="s3">\n                </span><span class="s1">if (uploadVideoParamsWithUrl) {</span><span class="s3">\n                    </span><span class="s1">if (uploadVideoServer.indexOf('?') &gt; 0) {</span><span class="s3">\n                        </span><span class="s1">uploadVideoServer += '&amp;'</span><span class="s3">\n                    </span><span class="s1">} else {</span><span class="s3">\n                        </span><span class="s1">uploadVideoServer += '?'</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">uploadVideoServer = uploadVideoServer + key + '=' + val</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// 第二，将参数添加到 formData 中</span><span class="s3">\n                </span><span class="s1">formData.append(key, val)</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">if (uploadVideoServerHash) {</span><span class="s3">\n                </span><span class="s1">uploadVideoServer += '#' + uploadVideoServerHash</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 开始上传</span><span class="s3">\n            </span><span class="s1">const xhr = post(uploadVideoServer, {</span><span class="s3">\n                </span><span class="s1">timeout: uploadVideoTimeout,</span><span class="s3">\n                </span><span class="s1">formData,</span><span class="s3">\n                </span><span class="s1">headers: uploadVideoHeaders,</span><span class="s3">\n                </span><span class="s1">withCredentials: !!withVideoCredentials,</span><span class="s3">\n                </span><span class="s1">beforeSend: xhr =&gt; {</span><span class="s3">\n                    </span><span class="s1">if (uploadVideoHooks.before)</span><span class="s3">\n                        </span><span class="s1">return uploadVideoHooks.before(xhr, editor, resultFiles)</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">onTimeout: xhr =&gt; {</span><span class="s3">\n                    </span><span class="s1">config.customAlert(t('上传视频超时'), 'error')</span><span class="s3">\n                    </span><span class="s1">if (uploadVideoHooks.timeout) uploadVideoHooks.timeout(xhr, editor)</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">onProgress: (percent, e) =&gt; {</span><span class="s3">\n                    </span><span class="s1">const progressBar = new Progress(editor)</span><span class="s3">\n                    </span><span class="s1">if (e.lengthComputable) {</span><span class="s3">\n                        </span><span class="s1">percent = e.loaded / e.total</span><span class="s3">\n                        </span><span class="s1">progressBar.show(percent)</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">onError: xhr =&gt; {</span><span class="s3">\n                    </span><span class="s1">config.customAlert(</span><span class="s3">\n                        </span><span class="s1">t('上传视频错误'),</span><span class="s3">\n                        </span><span class="s1">'error',</span><span class="s3">\n                        </span><span class="s1">`${t('上传视频错误')}，${t('服务器返回状态')}: ${xhr.status}`</span><span class="s3">\n                    </span><span class="s1">)</span><span class="s3">\n                    </span><span class="s1">if (uploadVideoHooks.error) uploadVideoHooks.error(xhr, editor)</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">onFail: (xhr, resultStr) =&gt; {</span><span class="s3">\n                    </span><span class="s1">config.customAlert(</span><span class="s3">\n                        </span><span class="s1">t('上传视频失败'),</span><span class="s3">\n                        </span><span class="s1">'error',</span><span class="s3">\n                        </span><span class="s1">t('上传视频返回结果错误') + `，${t('返回结果')}: ` + resultStr</span><span class="s3">\n                    </span><span class="s1">)</span><span class="s3">\n                    </span><span class="s1">if (uploadVideoHooks.fail) uploadVideoHooks.fail(xhr, editor, resultStr)</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">onSuccess: (xhr, result: ResType) =&gt; {</span><span class="s3">\n                    </span><span class="s1">if (uploadVideoHooks.customInsert) {</span><span class="s3">\n                        </span><span class="s1">// 自定义插入视频</span><span class="s3">\n                        </span><span class="s1">uploadVideoHooks.customInsert(this.insertVideo.bind(this), result, editor)</span><span class="s3">\n                        </span><span class="s1">return</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">if (result.errno != '0') {</span><span class="s3">\n                        </span><span class="s1">// 返回格式不对，应该为 { errno: 0, data: [...] }</span><span class="s3">\n                        </span><span class="s1">config.customAlert(</span><span class="s3">\n                            </span><span class="s1">t('上传视频失败'),</span><span class="s3">\n                            </span><span class="s1">'error',</span><span class="s3">\n                            </span><span class="s1">`${t('上传视频返回结果错误')}，${t('返回结果')} errno=${result.errno}`</span><span class="s3">\n                        </span><span class="s1">)</span><span class="s3">\n                        </span><span class="s1">if (uploadVideoHooks.fail) uploadVideoHooks.fail(xhr, editor, result)</span><span class="s3">\n                        </span><span class="s1">return</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n\n                    </span><span class="s1">// 成功，插入视频</span><span class="s3">\n                    </span><span class="s1">const data = result.data</span><span class="s3">\n\n                    </span><span class="s1">this.insertVideo(data.url)</span><span class="s3">\n\n                    </span><span class="s1">// 钩子函数</span><span class="s3">\n                    </span><span class="s1">if (uploadVideoHooks.success) uploadVideoHooks.success(xhr, editor, result)</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">if (typeof xhr === 'string') {</span><span class="s3">\n                </span><span class="s1">// 上传被阻止</span><span class="s3">\n                </span><span class="s1">config.customAlert(xhr, 'error')</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 往编辑器区域插入视频</span><span class="s3">\n     </span><span class="s1">* @param url 视频访问地址</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public insertVideo(url: string): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const config = editor.config</span><span class="s3">\n\n        </span><span class="s1">const i18nPrefix = 'validate.'</span><span class="s3">\n        </span><span class="s1">const t = (text: string, prefix: string = i18nPrefix): string =&gt; {</span><span class="s3">\n            </span><span class="s1">return editor.i18next.t(prefix + text)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 判断用户是否自定义插入视频</span><span class="s3">\n        </span><span class="s1">if (!config.customInsertVideo) {</span><span class="s3">\n            </span><span class="s1">if (UA.isFirefox) {</span><span class="s3">\n                </span><span class="s1">editor.cmd.do(</span><span class="s3">\n                    </span><span class="s1">'insertHTML',</span><span class="s3">\n                    </span><span class="s1">`&lt;p data-we-video-p=</span><span class="s3">\&quot;</span><span class="s1">true</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;video src=</span><span class="s3">\&quot;</span><span class="s1">${url}</span><span class="s3">\&quot; </span><span class="s1">controls=</span><span class="s3">\&quot;</span><span class="s1">controls</span><span class="s3">\&quot; </span><span class="s1">style=</span><span class="s3">\&quot;</span><span class="s1">max-width:100%</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/video&gt;&lt;/p&gt;&lt;p&gt;&amp;#8203&lt;/p&gt;`</span><span class="s3">\n                </span><span class="s1">)</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">editor.cmd.do(</span><span class="s3">\n                    </span><span class="s1">'insertHTML',</span><span class="s3">\n                    </span><span class="s1">`&lt;video src=</span><span class="s3">\&quot;</span><span class="s1">${url}</span><span class="s3">\&quot; </span><span class="s1">controls=</span><span class="s3">\&quot;</span><span class="s1">controls</span><span class="s3">\&quot; </span><span class="s1">style=</span><span class="s3">\&quot;</span><span class="s1">max-width:100%</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/video&gt;${EMPTY_P}`</span><span class="s3">\n                </span><span class="s1">)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">config.customInsertVideo(url)</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 加载视频</span><span class="s3">\n        </span><span class="s1">let video: any = document.createElement('video')</span><span class="s3">\n        </span><span class="s1">video.onload = () =&gt; {</span><span class="s3">\n            </span><span class="s1">video = null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">video.onerror = () =&gt; {</span><span class="s3">\n            </span><span class="s1">config.customAlert(</span><span class="s3">\n                </span><span class="s1">t('插入视频错误'),</span><span class="s3">\n                </span><span class="s1">'error',</span><span class="s3">\n                </span><span class="s1">`wangEditor: ${t('插入视频错误')}，${t('视频链接')} </span><span class="s3">\&quot;</span><span class="s1">${url}</span><span class="s3">\&quot;</span><span class="s1">，${t('下载链接失败')}`</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n            </span><span class="s1">video = null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">video.onabort = () =&gt; (video = null)</span><span class="s3">\n        </span><span class="s1">video.src = url</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default UploadVideo</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/date/now</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/date/now');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.date.now');</span><span class="s3">\n</span><span class="s1">var path = require('../../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.Date.now;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var $ = require('../internals/export');</span><span class="s3">\n\n</span><span class="s1">// `Date.now` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-date.now</span><span class="s3">\n</span><span class="s1">$({ target: 'Date', stat: true }, {</span><span class="s3">\n  </span><span class="s1">now: function now() {</span><span class="s3">\n    </span><span class="s1">return new Date().getTime();</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 绑定视频的事件</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import bindTooltipVideo from './tooltip-event'</span><span class="s3">\n</span><span class="s1">import bindEventKeyboardEvent from './keyboard'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function bindEvent(editor: Editor): void {</span><span class="s3">\n    </span><span class="s1">//Tooltip</span><span class="s3">\n    </span><span class="s1">bindTooltipVideo(editor)</span><span class="s3">\n    </span><span class="s1">bindEventKeyboardEvent(editor)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default bindEvent</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description tooltip 事件</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Tooltip, { TooltipConfType } from '../../menu-constructors/Tooltip'</span><span class="s3">\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import setAlignment from './video-alignment'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 生成 Tooltip 的显示隐藏函数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function createShowHideFn(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">let tooltip: Tooltip | null</span><span class="s3">\n    </span><span class="s1">const t = (text: string, prefix: string = ''): string =&gt; {</span><span class="s3">\n        </span><span class="s1">return editor.i18next.t(prefix + text)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 显示 tooltip</span><span class="s3">\n     </span><span class="s1">* @param $node 链接元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function showVideoTooltip($node: DomElement) {</span><span class="s3">\n        </span><span class="s1">const conf: TooltipConfType = [</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(</span><span class="s3">\&quot;</span><span class="s1">&lt;span class='w-e-icon-trash-o'&gt;&lt;/span&gt;</span><span class="s3">\&quot;</span><span class="s1">),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">// 选中video元素 删除</span><span class="s3">\n                    </span><span class="s1">$node.remove()</span><span class="s3">\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $('&lt;span&gt;100%&lt;/span&gt;'),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">$node.attr('width', '100%')</span><span class="s3">\n                    </span><span class="s1">$node.removeAttr('height')</span><span class="s3">\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $('&lt;span&gt;50%&lt;/span&gt;'),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">$node.attr('width', '50%')</span><span class="s3">\n                    </span><span class="s1">$node.removeAttr('height')</span><span class="s3">\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $('&lt;span&gt;30%&lt;/span&gt;'),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">$node.attr('width', '30%')</span><span class="s3">\n                    </span><span class="s1">$node.removeAttr('height')</span><span class="s3">\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${t('重置')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">$node.removeAttr('width')</span><span class="s3">\n                    </span><span class="s1">$node.removeAttr('height')</span><span class="s3">\n\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${t('menus.justify.靠左')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">// 获取顶级元素</span><span class="s3">\n                    </span><span class="s1">setAlignment($node, 'left')</span><span class="s3">\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${t('menus.justify.居中')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">// 获取顶级元素</span><span class="s3">\n                    </span><span class="s1">setAlignment($node, 'center')</span><span class="s3">\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${t('menus.justify.靠右')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">// 获取顶级元素</span><span class="s3">\n                    </span><span class="s1">setAlignment($node, 'right')</span><span class="s3">\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">]</span><span class="s3">\n\n        </span><span class="s1">tooltip = new Tooltip(editor, $node, conf)</span><span class="s3">\n        </span><span class="s1">tooltip.create()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 隐藏 tooltip</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function hideVideoTooltip() {</span><span class="s3">\n        </span><span class="s1">// 移除 tooltip</span><span class="s3">\n        </span><span class="s1">if (tooltip) {</span><span class="s3">\n            </span><span class="s1">tooltip.remove()</span><span class="s3">\n            </span><span class="s1">tooltip = null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return {</span><span class="s3">\n        </span><span class="s1">showVideoTooltip,</span><span class="s3">\n        </span><span class="s1">hideVideoTooltip,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定 tooltip 事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default function bindTooltipEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const { showVideoTooltip, hideVideoTooltip } = createShowHideFn(editor)</span><span class="s3">\n\n    </span><span class="s1">// 点击视频元素是，显示 tooltip</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.videoClickEvents.push(showVideoTooltip)</span><span class="s3">\n\n    </span><span class="s1">// 点击其他地方，或者滚动时，隐藏 tooltip</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.clickEvents.push(hideVideoTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.keyupEvents.push(hideVideoTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.toolbarClickEvents.push(hideVideoTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.menuClickEvents.push(hideVideoTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.textScrollEvents.push(hideVideoTooltip)</span><span class="s3">\n\n    </span><span class="s1">// change 时隐藏</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.changeEvents.push(hideVideoTooltip)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 视频布局 事件</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">// 设置布局方式</span><span class="s3">\n</span><span class="s1">export default function setAlignment($node: DomElement, value: string) {</span><span class="s3">\n    </span><span class="s1">// 设置顶级元素匹配</span><span class="s3">\n    </span><span class="s1">const NODENAME = ['P']</span><span class="s3">\n    </span><span class="s1">// 获取匹配得顶级元素</span><span class="s3">\n    </span><span class="s1">const topNode = getSelectedTopNode($node, NODENAME)</span><span class="s3">\n    </span><span class="s1">// 判断是否存在</span><span class="s3">\n    </span><span class="s1">if (topNode) {</span><span class="s3">\n        </span><span class="s1">$(topNode).css('text-align', value)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 获取选中的元素的顶级元素</span><span class="s3">\n </span><span class="s1">* @params el 选中的元素</span><span class="s3">\n </span><span class="s1">* @params tag 匹配顶级的元素 如 P LI ....</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function getSelectedTopNode(el: DomElement, tag: string[]): Node | null {</span><span class="s3">\n    </span><span class="s1">let parentNode: Node | null = el.elems[0]</span><span class="s3">\n    </span><span class="s1">// 可能出现嵌套的情况，所以一级一级向上找，找到指定得顶级元素</span><span class="s3">\n    </span><span class="s1">while (parentNode != null) {</span><span class="s3">\n        </span><span class="s1">if (tag.includes(parentNode?.nodeName)) {</span><span class="s3">\n            </span><span class="s1">return parentNode</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// 兜底 body</span><span class="s3">\n        </span><span class="s1">if (parentNode?.parentNode?.nodeName === 'BODY') {</span><span class="s3">\n            </span><span class="s1">return null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">parentNode = parentNode.parentNode</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return parentNode</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 兼容火狐浏览器内核有video标签时光标定位不对问题</span><span class="s3">\n </span><span class="s1">* @author yanbiao(86driver)</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import { UA } from '../../../utils/util'</span><span class="s3">\n\n</span><span class="s1">export default function bindEventKeyboardEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">if (!UA.isFirefox) return</span><span class="s3">\n    </span><span class="s1">const { txt, selection } = editor</span><span class="s3">\n    </span><span class="s1">const { keydownEvents } = txt.eventHooks</span><span class="s3">\n\n    </span><span class="s1">keydownEvents.push(function (e) {</span><span class="s3">\n        </span><span class="s1">// 实时保存选区</span><span class="s3">\n        </span><span class="s1">// editor.selection.saveRange()</span><span class="s3">\n        </span><span class="s1">const $selectionContainerElem = selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">if ($selectionContainerElem) {</span><span class="s3">\n            </span><span class="s1">const $topElem = $selectionContainerElem.getNodeTop(editor)</span><span class="s3">\n            </span><span class="s1">const $preElem = $topElem.length</span><span class="s3">\n                </span><span class="s1">? $topElem.prev().length</span><span class="s3">\n                    </span><span class="s1">? $topElem.prev()</span><span class="s3">\n                    </span><span class="s1">: null</span><span class="s3">\n                </span><span class="s1">: null</span><span class="s3">\n            </span><span class="s1">if ($preElem &amp;&amp; $preElem.attr('data-we-video-p')) {</span><span class="s3">\n                </span><span class="s1">// 光标处于选区开头</span><span class="s3">\n                </span><span class="s1">if (selection.getCursorPos() === 0) {</span><span class="s3">\n                    </span><span class="s1">// 如果上一个dom是包含video， 按下删除连video一块删除</span><span class="s3">\n                    </span><span class="s1">if (e.keyCode === 8) {</span><span class="s3">\n                        </span><span class="s1">$preElem.remove()</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 插入、上传图片</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { EMPTY_FN } from '../../utils/const'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import Panel from '../menu-constructors/Panel'</span><span class="s3">\n</span><span class="s1">import PanelMenu from '../menu-constructors/PanelMenu'</span><span class="s3">\n</span><span class="s1">import bindEvent from './bind-event/index'</span><span class="s3">\n</span><span class="s1">import createPanelConf, { ImgPanelConf } from './create-panel-conf'</span><span class="s3">\n\n</span><span class="s1">class Image extends PanelMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">private imgPanelConfig: ImgPanelConf</span><span class="s3">\n\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">let $elem = $(</span><span class="s3">\n            </span><span class="s1">'&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">图片</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-image</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;&lt;/div&gt;'</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">let imgPanelConfig = createPanelConf(editor)</span><span class="s3">\n        </span><span class="s1">if (imgPanelConfig.onlyUploadConf) {</span><span class="s3">\n            </span><span class="s1">$elem = imgPanelConfig.onlyUploadConf.$elem</span><span class="s3">\n            </span><span class="s1">imgPanelConfig.onlyUploadConf.events.map(event =&gt; {</span><span class="s3">\n                </span><span class="s1">const type = event.type</span><span class="s3">\n                </span><span class="s1">const fn = event.fn || EMPTY_FN</span><span class="s3">\n                </span><span class="s1">$elem.on(type, (e: Event) =&gt; {</span><span class="s3">\n                    </span><span class="s1">e.stopPropagation()</span><span class="s3">\n                    </span><span class="s1">fn(e)</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n        </span><span class="s1">this.imgPanelConfig = imgPanelConfig</span><span class="s3">\n\n        </span><span class="s1">// 绑定事件，如粘贴图片</span><span class="s3">\n        </span><span class="s1">bindEvent(editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 菜单点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">if (!this.imgPanelConfig.onlyUploadConf) {</span><span class="s3">\n            </span><span class="s1">this.createPanel()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 创建 panel</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private createPanel(): void {</span><span class="s3">\n        </span><span class="s1">const conf = this.imgPanelConfig</span><span class="s3">\n        </span><span class="s1">const panel = new Panel(this, conf)</span><span class="s3">\n        </span><span class="s1">this.setPanel(panel)</span><span class="s3">\n        </span><span class="s1">panel.create()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单 active 状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive() {}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Image</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 绑定图片的事件</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import bindPasteImg from './paste-img'</span><span class="s3">\n</span><span class="s1">import bindDropImg from './drop-img'</span><span class="s3">\n</span><span class="s1">import bindDragImgSize from './drag-size'</span><span class="s3">\n</span><span class="s1">import bindTooltipImg from './tooltip-event'</span><span class="s3">\n</span><span class="s1">import bindKeyboardEvent from './keyboard-event'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function bindEvent(editor: Editor): void {</span><span class="s3">\n    </span><span class="s1">// 粘贴图片</span><span class="s3">\n    </span><span class="s1">bindPasteImg(editor)</span><span class="s3">\n\n    </span><span class="s1">// 拖拽图片</span><span class="s3">\n    </span><span class="s1">bindDropImg(editor)</span><span class="s3">\n\n    </span><span class="s1">// 可再扩展其他事件...如图片 tooltip 等</span><span class="s3">\n    </span><span class="s1">// 拖拽图片尺寸</span><span class="s3">\n    </span><span class="s1">bindDragImgSize(editor)</span><span class="s3">\n\n    </span><span class="s1">//Tooltip</span><span class="s3">\n    </span><span class="s1">bindTooltipImg(editor)</span><span class="s3">\n\n    </span><span class="s1">bindKeyboardEvent(editor)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default bindEvent</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 粘贴图片</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import { getPasteText, getPasteHtml, getPasteImgs } from '../../../text/paste/paste-event'</span><span class="s3">\n</span><span class="s1">import UploadImg from '../upload-img'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 剪切板是否有 text 或者 html ？</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器对象</span><span class="s3">\n </span><span class="s1">* @param e 粘贴事件参数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function _haveTextOrHtml(editor: Editor, e: ClipboardEvent): boolean {</span><span class="s3">\n    </span><span class="s1">const config = editor.config</span><span class="s3">\n    </span><span class="s1">const pasteFilterStyle = config.pasteFilterStyle</span><span class="s3">\n    </span><span class="s1">const pasteIgnoreImg = config.pasteIgnoreImg</span><span class="s3">\n    </span><span class="s1">let pasteHtml = getPasteHtml(e, pasteFilterStyle, pasteIgnoreImg)</span><span class="s3">\n    </span><span class="s1">if (pasteHtml) return true</span><span class="s3">\n    </span><span class="s1">let pasteText = getPasteText(e)</span><span class="s3">\n    </span><span class="s1">if (pasteText) return true</span><span class="s3">\n\n    </span><span class="s1">return false // text html 都没有，则返回 false</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 剪切板是否有 Files</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器对象</span><span class="s3">\n </span><span class="s1">* @param e 粘贴事件参数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function _haveFiles(editor: Editor, e: ClipboardEvent): boolean {</span><span class="s3">\n    </span><span class="s1">const types = e.clipboardData?.types || []</span><span class="s3">\n\n    </span><span class="s1">for (let i = 0; i &lt; types.length; i++) {</span><span class="s3">\n        </span><span class="s1">const type = types[i]</span><span class="s3">\n        </span><span class="s1">if (type === 'Files') {</span><span class="s3">\n            </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return false</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 粘贴图片事件方法</span><span class="s3">\n </span><span class="s1">* @param e 事件参数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function pasteImgHandler(e: ClipboardEvent, editor: Editor): void {</span><span class="s3">\n    </span><span class="s1">// 粘贴过来的没有 file 时，判断 text 或者 html</span><span class="s3">\n    </span><span class="s1">if (!_haveFiles(editor, e)) {</span><span class="s3">\n        </span><span class="s1">if (_haveTextOrHtml(editor, e)) {</span><span class="s3">\n            </span><span class="s1">// 粘贴过来的有 text 或者 html ，则不执行粘贴图片逻辑</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 获取粘贴的图片列表</span><span class="s3">\n    </span><span class="s1">const pastedFiles = getPasteImgs(e)</span><span class="s3">\n    </span><span class="s1">if (!pastedFiles.length) {</span><span class="s3">\n        </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// code 中忽略（暂不管它）</span><span class="s3">\n\n    </span><span class="s1">// 执行上传</span><span class="s3">\n    </span><span class="s1">const uploadImg = new UploadImg(editor)</span><span class="s3">\n    </span><span class="s1">uploadImg.uploadImg(pastedFiles)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 粘贴图片</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器对象</span><span class="s3">\n </span><span class="s1">* @param pasteEvents 粘贴事件列表</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function bindPasteImg(editor: Editor): void {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 绑定 paste 事件</span><span class="s3">\n     </span><span class="s1">* 这里使用了unshift，以前是push</span><span class="s3">\n     </span><span class="s1">* 在以前的流程中，pasteImgHandler触发之前，会调用到window.getSelection().removeAllRanges()</span><span class="s3">\n     </span><span class="s1">* 会导致性能变差。在编辑器中粘贴，粘贴耗时多了100+ms，根本原因未知</span><span class="s3">\n     </span><span class="s1">* 最小复现demo，在div内粘贴图片就可以看到getData耗时异常得长</span><span class="s3">\n     </span><span class="s1">* &lt;html&gt;</span><span class="s3">\n     </span><span class="s1">*     &lt;div id=</span><span class="s3">\&quot;</span><span class="s1">a</span><span class="s3">\&quot; </span><span class="s1">contenteditable=</span><span class="s3">\&quot;</span><span class="s1">true</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/div&gt;</span><span class="s3">\n     </span><span class="s1">*     &lt;script&gt;</span><span class="s3">\n     </span><span class="s1">*         const div = document.getElementById('a')</span><span class="s3">\n     </span><span class="s1">*         div.addEventListener('paste', (e) =&gt; {</span><span class="s3">\n     </span><span class="s1">*             window.getSelection().removeAllRanges()</span><span class="s3">\n     </span><span class="s1">*             e.clipboardData.getData('text/html')</span><span class="s3">\n     </span><span class="s1">*         })</span><span class="s3">\n     </span><span class="s1">*     &lt;/script&gt;</span><span class="s3">\n     </span><span class="s1">* &lt;/html&gt;</span><span class="s3">\n     </span><span class="s1">* 因此改成unshift，先触发pasteImgHandler就不会有性能问题</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.pasteEvents.unshift((e: ClipboardEvent) =&gt; {</span><span class="s3">\n        </span><span class="s1">pasteImgHandler(e, editor)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default bindPasteImg</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 拖拽上传图片</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import UploadImg from '../upload-img'</span><span class="s3">\n\n</span><span class="s1">export default function bindDropImg(editor: Editor): void {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 拖拽图片的事件</span><span class="s3">\n     </span><span class="s1">* @param e 事件参数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function dropImgHandler(e: any): void {</span><span class="s3">\n        </span><span class="s1">const files = e.dataTransfer &amp;&amp; e.dataTransfer.files</span><span class="s3">\n        </span><span class="s1">if (!files || !files.length) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 上传图片</span><span class="s3">\n        </span><span class="s1">const uploadImg = new UploadImg(editor)</span><span class="s3">\n        </span><span class="s1">uploadImg.uploadImg(files)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 绑定 drop 事件</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.dropEvents.push(dropImgHandler)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 图片拖拽事件绑定</span><span class="s3">\n </span><span class="s1">* @author xiaokyo</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../../editor'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import '../../../assets/style/drag-size.less'</span><span class="s3">\n</span><span class="s1">import { UA } from '../../../utils/util'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 设置拖拽框的rect</span><span class="s3">\n </span><span class="s1">* @param $drag drag Dom</span><span class="s3">\n </span><span class="s1">* @param width 要设置的宽度</span><span class="s3">\n </span><span class="s1">* @param height 要设置的高度</span><span class="s3">\n </span><span class="s1">* @param left 要设置的左边</span><span class="s3">\n </span><span class="s1">* @param top 要设置的顶部距离</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function setDragStyle($drag: DomElement, width: number, height: number, left: number, top: number) {</span><span class="s3">\n    </span><span class="s1">$drag.attr('style', `width:${width}px; height:${height}px; left:${left}px; top:${top}px;`)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 生成一个图片指定大小的拖拽框</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">* @param $textContainerElem 编辑框对象</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function createDragBox(editor: Editor, $textContainerElem: DomElement): DomElement {</span><span class="s3">\n    </span><span class="s1">const $drag = $(</span><span class="s3">\n        </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-img-drag-mask</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n            </span><span class="s1">&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-img-drag-show-size</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/div&gt;</span><span class="s3">\n            </span><span class="s1">&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-img-drag-rb</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/div&gt;</span><span class="s3">\n         </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">$drag.hide()</span><span class="s3">\n    </span><span class="s1">$textContainerElem.append($drag)</span><span class="s3">\n    </span><span class="s1">return $drag</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 显示拖拽框并设置宽度</span><span class="s3">\n </span><span class="s1">* @param $textContainerElem 编辑框实例</span><span class="s3">\n </span><span class="s1">* @param $drag 拖拽框对象</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function showDargBox($textContainerElem: DomElement, $drag: DomElement, $img: DomElement) {</span><span class="s3">\n    </span><span class="s1">const boxRect = $textContainerElem.getBoundingClientRect()</span><span class="s3">\n    </span><span class="s1">const rect = $img.getBoundingClientRect()</span><span class="s3">\n    </span><span class="s1">const rectW = rect.width.toFixed(2)</span><span class="s3">\n    </span><span class="s1">const rectH = rect.height.toFixed(2)</span><span class="s3">\n    </span><span class="s1">$drag.find('.w-e-img-drag-show-size').text(`${rectW}px * ${rectH}px`)</span><span class="s3">\n    </span><span class="s1">setDragStyle(</span><span class="s3">\n        </span><span class="s1">$drag,</span><span class="s3">\n        </span><span class="s1">parseFloat(rectW),</span><span class="s3">\n        </span><span class="s1">parseFloat(rectH),</span><span class="s3">\n        </span><span class="s1">rect.left - boxRect.left,</span><span class="s3">\n        </span><span class="s1">rect.top - boxRect.top</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">$drag.show()</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 生成图片拖拽框的 显示/隐藏 函数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function createShowHideFn(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const $textContainerElem = editor.$textContainerElem</span><span class="s3">\n    </span><span class="s1">let $imgTarget: DomElement</span><span class="s3">\n\n    </span><span class="s1">// 生成拖拽框</span><span class="s3">\n    </span><span class="s1">const $drag = createDragBox(editor, $textContainerElem)</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 设置拖拽事件</span><span class="s3">\n     </span><span class="s1">* @param $drag 拖拽框的domElement</span><span class="s3">\n     </span><span class="s1">* @param $textContainerElem 编辑器实例</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function bindDragEvents($drag: DomElement, $container: DomElement) {</span><span class="s3">\n        </span><span class="s1">$drag.on('click', function (e: Event) {</span><span class="s3">\n            </span><span class="s1">e.stopPropagation()</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">$drag.on('mousedown', '.w-e-img-drag-rb', (e: MouseEvent) =&gt; {</span><span class="s3">\n            </span><span class="s1">// e.stopPropagation()</span><span class="s3">\n            </span><span class="s1">e.preventDefault()</span><span class="s3">\n\n            </span><span class="s1">if (!$imgTarget) return</span><span class="s3">\n\n            </span><span class="s1">const firstX = e.clientX</span><span class="s3">\n            </span><span class="s1">const firstY = e.clientY</span><span class="s3">\n            </span><span class="s1">const boxRect = $container.getBoundingClientRect()</span><span class="s3">\n            </span><span class="s1">const imgRect = $imgTarget.getBoundingClientRect()</span><span class="s3">\n            </span><span class="s1">const width = imgRect.width</span><span class="s3">\n            </span><span class="s1">const height = imgRect.height</span><span class="s3">\n            </span><span class="s1">const left = imgRect.left - boxRect.left</span><span class="s3">\n            </span><span class="s1">const top = imgRect.top - boxRect.top</span><span class="s3">\n            </span><span class="s1">const ratio = width / height</span><span class="s3">\n\n            </span><span class="s1">let setW = width</span><span class="s3">\n            </span><span class="s1">let setH = height</span><span class="s3">\n            </span><span class="s1">const $document = $(document)</span><span class="s3">\n\n            </span><span class="s1">function offEvents() {</span><span class="s3">\n                </span><span class="s1">$document.off('mousemove', mouseMoveHandler)</span><span class="s3">\n                </span><span class="s1">$document.off('mouseup', mouseUpHandler)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">function mouseMoveHandler(ev: MouseEvent) {</span><span class="s3">\n                </span><span class="s1">ev.stopPropagation()</span><span class="s3">\n                </span><span class="s1">ev.preventDefault()</span><span class="s3">\n\n                </span><span class="s1">setW = width + (ev.clientX - firstX)</span><span class="s3">\n                </span><span class="s1">setH = height + (ev.clientY - firstY)</span><span class="s3">\n\n                </span><span class="s1">// 等比计算</span><span class="s3">\n                </span><span class="s1">if (setW / setH != ratio) {</span><span class="s3">\n                    </span><span class="s1">setH = setW / ratio</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">setW = parseFloat(setW.toFixed(2))</span><span class="s3">\n                </span><span class="s1">setH = parseFloat(setH.toFixed(2))</span><span class="s3">\n\n                </span><span class="s1">$drag</span><span class="s3">\n                    </span><span class="s1">.find('.w-e-img-drag-show-size')</span><span class="s3">\n                    </span><span class="s1">.text(</span><span class="s3">\n                        </span><span class="s1">`${setW.toFixed(2).replace('.00', '')}px * ${setH</span><span class="s3">\n                            </span><span class="s1">.toFixed(2)</span><span class="s3">\n                            </span><span class="s1">.replace('.00', '')}px`</span><span class="s3">\n                    </span><span class="s1">)</span><span class="s3">\n                </span><span class="s1">setDragStyle($drag, setW, setH, left, top)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">$document.on('mousemove', mouseMoveHandler)</span><span class="s3">\n\n            </span><span class="s1">function mouseUpHandler() {</span><span class="s3">\n                </span><span class="s1">$imgTarget.attr('width', setW + '')</span><span class="s3">\n                </span><span class="s1">$imgTarget.attr('height', setH + '')</span><span class="s3">\n                </span><span class="s1">const newImgRect = $imgTarget.getBoundingClientRect()</span><span class="s3">\n                </span><span class="s1">setDragStyle(</span><span class="s3">\n                    </span><span class="s1">$drag,</span><span class="s3">\n                    </span><span class="s1">setW,</span><span class="s3">\n                    </span><span class="s1">setH,</span><span class="s3">\n                    </span><span class="s1">newImgRect.left - boxRect.left,</span><span class="s3">\n                    </span><span class="s1">newImgRect.top - boxRect.top</span><span class="s3">\n                </span><span class="s1">)</span><span class="s3">\n\n                </span><span class="s1">// 解绑事件</span><span class="s3">\n                </span><span class="s1">offEvents()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">$document.on('mouseup', mouseUpHandler)</span><span class="s3">\n\n            </span><span class="s1">// 解绑事件</span><span class="s3">\n            </span><span class="s1">$document.on('mouseleave', offEvents)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 显示拖拽框</span><span class="s3">\n    </span><span class="s1">function showDrag($target: DomElement) {</span><span class="s3">\n        </span><span class="s1">if (UA.isIE()) return false</span><span class="s3">\n        </span><span class="s1">if ($target) {</span><span class="s3">\n            </span><span class="s1">$imgTarget = $target</span><span class="s3">\n            </span><span class="s1">showDargBox($textContainerElem, $drag, $imgTarget)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 隐藏拖拽框</span><span class="s3">\n    </span><span class="s1">function hideDrag() {</span><span class="s3">\n        </span><span class="s1">$textContainerElem.find('.w-e-img-drag-mask').hide()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 事件绑定</span><span class="s3">\n    </span><span class="s1">bindDragEvents($drag, $textContainerElem)</span><span class="s3">\n\n    </span><span class="s1">// 后期改成 blur 触发</span><span class="s3">\n    </span><span class="s1">$(document).on('click', hideDrag)</span><span class="s3">\n    </span><span class="s1">editor.beforeDestroy(function () {</span><span class="s3">\n        </span><span class="s1">$(document).off('click', hideDrag)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">return {</span><span class="s3">\n        </span><span class="s1">showDrag,</span><span class="s3">\n        </span><span class="s1">hideDrag,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 点击事件委托</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default function bindDragImgSize(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const { showDrag, hideDrag } = createShowHideFn(editor)</span><span class="s3">\n\n    </span><span class="s1">// 显示拖拽框</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.imgClickEvents.push(showDrag)</span><span class="s3">\n\n    </span><span class="s1">// 隐藏拖拽框</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.textScrollEvents.push(hideDrag)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.keyupEvents.push(hideDrag)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.toolbarClickEvents.push(hideDrag)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.menuClickEvents.push(hideDrag)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.changeEvents.push(hideDrag)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/parse-float</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../es/parse-float');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../modules/es.parse-float');</span><span class="s3">\n</span><span class="s1">var path = require('../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.parseFloat;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var parseFloatImplementation = require('../internals/number-parse-float');</span><span class="s3">\n\n</span><span class="s1">// `parseFloat` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-parsefloat-string</span><span class="s3">\n</span><span class="s1">$({ global: true, forced: parseFloat != parseFloatImplementation }, {</span><span class="s3">\n  </span><span class="s1">parseFloat: parseFloatImplementation</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var global = require('../internals/global');</span><span class="s3">\n</span><span class="s1">var trim = require('../internals/string-trim').trim;</span><span class="s3">\n</span><span class="s1">var whitespaces = require('../internals/whitespaces');</span><span class="s3">\n\n</span><span class="s1">var $parseFloat = global.parseFloat;</span><span class="s3">\n</span><span class="s1">var FORCED = 1 / $parseFloat(whitespaces + '-0') !== -Infinity;</span><span class="s3">\n\n</span><span class="s1">// `parseFloat` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-parsefloat-string</span><span class="s3">\n</span><span class="s1">module.exports = FORCED ? function parseFloat(string) {</span><span class="s3">\n  </span><span class="s1">var trimmedString = trim(String(string));</span><span class="s3">\n  </span><span class="s1">var result = $parseFloat(trimmedString);</span><span class="s3">\n  </span><span class="s1">return result === 0 &amp;&amp; trimmedString.charAt(0) == '-' ? -0 : result;</span><span class="s3">\n</span><span class="s1">} : $parseFloat;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var api = require(</span><span class="s3">\&quot;</span><span class="s1">!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n            </span><span class="s1">var content = require(</span><span class="s3">\&quot;</span><span class="s1">!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/postcss-loader/src/index.js!../../../node_modules/less-loader/dist/cjs.js!./drag-size.less</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n\n            </span><span class="s1">content = content.__esModule ? content.default : content;</span><span class="s3">\n\n            </span><span class="s1">if (typeof content === 'string') {</span><span class="s3">\n              </span><span class="s1">content = [[module.id, content, '']];</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">var options = {};</span><span class="s3">\n\n</span><span class="s1">options.insert = </span><span class="s3">\&quot;</span><span class="s1">head</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n</span><span class="s1">options.singleton = false;</span><span class="s3">\n\n</span><span class="s1">var update = api(content, options);</span><span class="s3">\n\n\n\n</span><span class="s1">module.exports = content.locals || {};&quot;</span><span class="s0">,</span><span class="s1">&quot;// Imports</span><span class="s3">\n</span><span class="s1">var ___CSS_LOADER_API_IMPORT___ = require(</span><span class="s3">\&quot;</span><span class="s1">../../../node_modules/css-loader/dist/runtime/api.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">exports = ___CSS_LOADER_API_IMPORT___(false);</span><span class="s3">\n</span><span class="s1">// Module</span><span class="s3">\n</span><span class="s1">exports.push([module.id, </span><span class="s3">\&quot;</span><span class="s1">.w-e-text-container {</span><span class="s3">\\</span><span class="s1">n  overflow: hidden;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-img-drag-mask {</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  z-index: 1;</span><span class="s3">\\</span><span class="s1">n  border: 1px dashed #ccc;</span><span class="s3">\\</span><span class="s1">n  box-sizing: border-box;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-img-drag-mask .w-e-img-drag-rb {</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  right: -5px;</span><span class="s3">\\</span><span class="s1">n  bottom: -5px;</span><span class="s3">\\</span><span class="s1">n  width: 16px;</span><span class="s3">\\</span><span class="s1">n  height: 16px;</span><span class="s3">\\</span><span class="s1">n  border-radius: 50%;</span><span class="s3">\\</span><span class="s1">n  background: #ccc;</span><span class="s3">\\</span><span class="s1">n  cursor: se-resize;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-img-drag-mask .w-e-img-drag-show-size {</span><span class="s3">\\</span><span class="s1">n  min-width: 110px;</span><span class="s3">\\</span><span class="s1">n  height: 22px;</span><span class="s3">\\</span><span class="s1">n  line-height: 22px;</span><span class="s3">\\</span><span class="s1">n  font-size: 14px;</span><span class="s3">\\</span><span class="s1">n  color: #999;</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  left: 0;</span><span class="s3">\\</span><span class="s1">n  top: 0;</span><span class="s3">\\</span><span class="s1">n  background-color: #999;</span><span class="s3">\\</span><span class="s1">n  color: #fff;</span><span class="s3">\\</span><span class="s1">n  border-radius: 2px;</span><span class="s3">\\</span><span class="s1">n  padding: 0 5px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n</span><span class="s3">\&quot;</span><span class="s1">, </span><span class="s3">\&quot;\&quot;</span><span class="s1">]);</span><span class="s3">\n</span><span class="s1">// Exports</span><span class="s3">\n</span><span class="s1">module.exports = exports;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description tooltip 事件</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Tooltip, { TooltipConfType } from '../../menu-constructors/Tooltip'</span><span class="s3">\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 生成 Tooltip 的显示隐藏函数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function createShowHideFn(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">let tooltip: Tooltip | null</span><span class="s3">\n    </span><span class="s1">const t = (text: string, prefix: string = ''): string =&gt; {</span><span class="s3">\n        </span><span class="s1">return editor.i18next.t(prefix + text)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 显示 tooltip</span><span class="s3">\n     </span><span class="s1">* @param $node 链接元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function showImgTooltip($node: DomElement) {</span><span class="s3">\n        </span><span class="s1">const conf: TooltipConfType = [</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(</span><span class="s3">\&quot;</span><span class="s1">&lt;span class='w-e-icon-trash-o'&gt;&lt;/span&gt;</span><span class="s3">\&quot;</span><span class="s1">),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">// 选中img元素</span><span class="s3">\n                    </span><span class="s1">editor.selection.createRangeByElem($node)</span><span class="s3">\n                    </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n                    </span><span class="s1">editor.cmd.do('delete')</span><span class="s3">\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $('&lt;span&gt;30%&lt;/span&gt;'),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">$node.attr('width', '30%')</span><span class="s3">\n                    </span><span class="s1">$node.removeAttr('height')</span><span class="s3">\n\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $('&lt;span&gt;50%&lt;/span&gt;'),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">$node.attr('width', '50%')</span><span class="s3">\n                    </span><span class="s1">$node.removeAttr('height')</span><span class="s3">\n\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $('&lt;span&gt;100%&lt;/span&gt;'),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">$node.attr('width', '100%')</span><span class="s3">\n                    </span><span class="s1">$node.removeAttr('height')</span><span class="s3">\n\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">]</span><span class="s3">\n\n        </span><span class="s1">conf.push({</span><span class="s3">\n            </span><span class="s1">$elem: $(`&lt;span&gt;${t('重置')}&lt;/span&gt;`),</span><span class="s3">\n            </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                </span><span class="s1">$node.removeAttr('width')</span><span class="s3">\n                </span><span class="s1">$node.removeAttr('height')</span><span class="s3">\n\n                </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                </span><span class="s1">return true</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">if ($node.attr('data-href')) {</span><span class="s3">\n            </span><span class="s1">conf.push({</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${t('查看链接')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">let link = $node.attr('data-href')</span><span class="s3">\n                    </span><span class="s1">if (link) {</span><span class="s3">\n                        </span><span class="s1">link = decodeURIComponent(link)</span><span class="s3">\n                        </span><span class="s1">window.open(link, '_target')</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">tooltip = new Tooltip(editor, $node, conf)</span><span class="s3">\n        </span><span class="s1">tooltip.create()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 隐藏 tooltip</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function hideImgTooltip() {</span><span class="s3">\n        </span><span class="s1">// 移除 tooltip</span><span class="s3">\n        </span><span class="s1">if (tooltip) {</span><span class="s3">\n            </span><span class="s1">tooltip.remove()</span><span class="s3">\n            </span><span class="s1">tooltip = null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return {</span><span class="s3">\n        </span><span class="s1">showImgTooltip,</span><span class="s3">\n        </span><span class="s1">hideImgTooltip,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定 tooltip 事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default function bindTooltipEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const { showImgTooltip, hideImgTooltip } = createShowHideFn(editor)</span><span class="s3">\n\n    </span><span class="s1">// 点击图片元素是，显示 tooltip</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.imgClickEvents.push(showImgTooltip)</span><span class="s3">\n\n    </span><span class="s1">// 点击其他地方，或者滚动时，隐藏 tooltip</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.clickEvents.push(hideImgTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.keyupEvents.push(hideImgTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.toolbarClickEvents.push(hideImgTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.menuClickEvents.push(hideImgTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.textScrollEvents.push(hideImgTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.imgDragBarMouseDownEvents.push(hideImgTooltip)</span><span class="s3">\n\n    </span><span class="s1">// change 时隐藏</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.changeEvents.push(hideImgTooltip)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import Editor from '../../../editor'</span><span class="s3">\n\n</span><span class="s1">export default function bindEventKeyboardEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const { txt, selection } = editor</span><span class="s3">\n    </span><span class="s1">const { keydownEvents } = txt.eventHooks</span><span class="s3">\n\n    </span><span class="s1">keydownEvents.push(function (e) {</span><span class="s3">\n        </span><span class="s1">// 删除图片时，有时会因为浏览器bug删不掉。因此这里手动判断光标前面是不是图片，是就删掉</span><span class="s3">\n        </span><span class="s1">const $selectionContainerElem = selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">const range = selection.getRange()</span><span class="s3">\n\n        </span><span class="s1">if (</span><span class="s3">\n            </span><span class="s1">!range ||</span><span class="s3">\n            </span><span class="s1">!$selectionContainerElem ||</span><span class="s3">\n            </span><span class="s1">e.keyCode !== 8 ||</span><span class="s3">\n            </span><span class="s1">!selection.isSelectionEmpty()</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">let { startContainer, startOffset } = range</span><span class="s3">\n\n        </span><span class="s1">// 同一段落内上一个节点</span><span class="s3">\n        </span><span class="s1">let prevNode: Node | null = null</span><span class="s3">\n        </span><span class="s1">if (startOffset === 0) {</span><span class="s3">\n            </span><span class="s1">// 此时上一个节点需要通过previousSibling去找</span><span class="s3">\n            </span><span class="s1">while (</span><span class="s3">\n                </span><span class="s1">startContainer !== $selectionContainerElem.elems[0] &amp;&amp;</span><span class="s3">\n                </span><span class="s1">$selectionContainerElem.elems[0].contains(startContainer) &amp;&amp;</span><span class="s3">\n                </span><span class="s1">startContainer.parentNode &amp;&amp;</span><span class="s3">\n                </span><span class="s1">!prevNode</span><span class="s3">\n            </span><span class="s1">) {</span><span class="s3">\n                </span><span class="s1">if (startContainer.previousSibling) {</span><span class="s3">\n                    </span><span class="s1">prevNode = startContainer.previousSibling as Node</span><span class="s3">\n                    </span><span class="s1">break</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">startContainer = startContainer.parentNode</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">} else if (startContainer.nodeType !== 3) {</span><span class="s3">\n            </span><span class="s1">// 非文本节点才需要被处理，比如p</span><span class="s3">\n            </span><span class="s1">prevNode = startContainer.childNodes[startOffset - 1]</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (!prevNode) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">let lastChildNodeInPrevNode = prevNode</span><span class="s3">\n\n        </span><span class="s1">// 找到最右侧叶子节点</span><span class="s3">\n        </span><span class="s1">while (lastChildNodeInPrevNode.childNodes.length) {</span><span class="s3">\n            </span><span class="s1">lastChildNodeInPrevNode =</span><span class="s3">\n                </span><span class="s1">lastChildNodeInPrevNode.childNodes[lastChildNodeInPrevNode.childNodes.length - 1]</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (</span><span class="s3">\n            </span><span class="s1">lastChildNodeInPrevNode instanceof HTMLElement &amp;&amp;</span><span class="s3">\n            </span><span class="s1">lastChildNodeInPrevNode.tagName === 'IMG'</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n            </span><span class="s1">lastChildNodeInPrevNode.remove()</span><span class="s3">\n            </span><span class="s1">e.preventDefault()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description image 菜单 panel tab 配置</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { getRandom } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import { PanelConf, PanelTabConf, TabEventConf } from '../menu-constructors/Panel'</span><span class="s3">\n</span><span class="s1">import UploadImg from './upload-img'</span><span class="s3">\n\n</span><span class="s1">export type ImgPanelConf = {</span><span class="s3">\n    </span><span class="s1">onlyUploadConf?: {</span><span class="s3">\n        </span><span class="s1">$elem: DomElement</span><span class="s3">\n        </span><span class="s1">events: TabEventConf[]</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">} &amp; PanelConf</span><span class="s3">\n\n</span><span class="s1">export default function (editor: Editor): ImgPanelConf {</span><span class="s3">\n    </span><span class="s1">const config = editor.config</span><span class="s3">\n    </span><span class="s1">const uploadImg = new UploadImg(editor)</span><span class="s3">\n\n    </span><span class="s1">// panel 中需要用到的id</span><span class="s3">\n    </span><span class="s1">const upTriggerId = getRandom('up-trigger-id')</span><span class="s3">\n    </span><span class="s1">const upFileId = getRandom('up-file-id')</span><span class="s3">\n    </span><span class="s1">const linkUrlId = getRandom('input-link-url')</span><span class="s3">\n    </span><span class="s1">const linkUrlAltId = getRandom('input-link-url-alt')</span><span class="s3">\n    </span><span class="s1">const linkUrlHrefId = getRandom('input-link-url-href')</span><span class="s3">\n    </span><span class="s1">const linkBtnId = getRandom('btn-link')</span><span class="s3">\n\n    </span><span class="s1">const i18nPrefix = 'menus.panelMenus.image.'</span><span class="s3">\n    </span><span class="s1">const t = (text: string, prefix: string = i18nPrefix): string =&gt; {</span><span class="s3">\n        </span><span class="s1">return editor.i18next.t(prefix + text)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 校验网络图片链接是否合法</span><span class="s3">\n     </span><span class="s1">* @param linkImg 网络图片链接</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function checkLinkImg(src: string, linkUrlAltText?: string, linkUrlHrefText?: string): boolean {</span><span class="s3">\n        </span><span class="s1">//查看开发者自定义配置的返回值</span><span class="s3">\n        </span><span class="s1">const check = config.linkImgCheck(src)</span><span class="s3">\n        </span><span class="s1">if (check === true) {</span><span class="s3">\n            </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">} else if (typeof check === 'string') {</span><span class="s3">\n            </span><span class="s1">//用户未能通过开发者的校验，开发者希望我们提示这一字符串</span><span class="s3">\n            </span><span class="s1">config.customAlert(check, 'error')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// tabs 配置 -----------------------------------------</span><span class="s3">\n    </span><span class="s1">const fileMultipleAttr = config.uploadImgMaxLength === 1 ? '' : 'multiple=</span><span class="s3">\&quot;</span><span class="s1">multiple</span><span class="s3">\&quot;</span><span class="s1">'</span><span class="s3">\n    </span><span class="s1">const accepts: string = config.uploadImgAccept.map((item: string) =&gt; `image/${item}`).join(',')</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 设置模板的类名和icon图标</span><span class="s3">\n     </span><span class="s1">* w-e-menu是作为button菜单的模板</span><span class="s3">\n     </span><span class="s1">* w-e-up-img-container是做为panel菜单的窗口内容的模板</span><span class="s3">\n     </span><span class="s1">* @param containerClass 模板最外层的类名</span><span class="s3">\n     </span><span class="s1">* @param iconClass 模板中icon的类名</span><span class="s3">\n     </span><span class="s1">* @param titleName 模板中标题的名称 需要则设置不需要则设为空字符</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">const getUploadImgTpl = (containerClass: string, iconClass: string, titleName: string) =&gt;</span><span class="s3">\n        </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">${containerClass}</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">${titleName}</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n            </span><span class="s1">&lt;div id=</span><span class="s3">\&quot;</span><span class="s1">${upTriggerId}</span><span class="s3">\&quot; </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">w-e-up-btn</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">${iconClass}</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;</span><span class="s3">\n            </span><span class="s1">&lt;div style=</span><span class="s3">\&quot;</span><span class="s1">display:none;</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;input id=</span><span class="s3">\&quot;</span><span class="s1">${upFileId}</span><span class="s3">\&quot; </span><span class="s1">type=</span><span class="s3">\&quot;</span><span class="s1">file</span><span class="s3">\&quot; </span><span class="s1">${fileMultipleAttr} accept=</span><span class="s3">\&quot;</span><span class="s1">${accepts}</span><span class="s3">\&quot;</span><span class="s1">/&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;</span><span class="s3">\n        </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n    </span><span class="s1">const uploadEvents: TabEventConf[] = [</span><span class="s3">\n        </span><span class="s1">// 触发选择图片</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">selector: '#' + upTriggerId,</span><span class="s3">\n            </span><span class="s1">type: 'click',</span><span class="s3">\n            </span><span class="s1">fn: () =&gt; {</span><span class="s3">\n                </span><span class="s1">const uploadImgFromMedia = config.uploadImgFromMedia</span><span class="s3">\n                </span><span class="s1">if (uploadImgFromMedia &amp;&amp; typeof uploadImgFromMedia === 'function') {</span><span class="s3">\n                    </span><span class="s1">uploadImgFromMedia()</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">const $file = $('#' + upFileId)</span><span class="s3">\n                </span><span class="s1">const fileElem = $file.elems[0]</span><span class="s3">\n                </span><span class="s1">if (fileElem) {</span><span class="s3">\n                    </span><span class="s1">fileElem.click()</span><span class="s3">\n                </span><span class="s1">} else {</span><span class="s3">\n                    </span><span class="s1">// 返回 true 可关闭 panel</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">// 选择图片完毕</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">selector: '#' + upFileId,</span><span class="s3">\n            </span><span class="s1">type: 'change',</span><span class="s3">\n            </span><span class="s1">fn: () =&gt; {</span><span class="s3">\n                </span><span class="s1">const $file = $('#' + upFileId)</span><span class="s3">\n                </span><span class="s1">const fileElem = $file.elems[0] as HTMLInputElement</span><span class="s3">\n                </span><span class="s1">if (!fileElem) {</span><span class="s3">\n                    </span><span class="s1">// 返回 true 可关闭 panel</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// 获取选中的 file 对象列表</span><span class="s3">\n                </span><span class="s1">const fileList = fileElem.files</span><span class="s3">\n                </span><span class="s1">if (fileList?.length) {</span><span class="s3">\n                    </span><span class="s1">uploadImg.uploadImg(fileList)</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// 判断用于打开文件的input，有没有值，如果有就清空，以防上传同一张图片时，不会触发change事件</span><span class="s3">\n                </span><span class="s1">// input的功能只是单单为了打开文件而已，获取到需要的文件参数，当文件数据获取到后，可以清空。</span><span class="s3">\n                </span><span class="s1">if (fileElem) {</span><span class="s3">\n                    </span><span class="s1">fileElem.value = ''</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// 返回 true 可关闭 panel</span><span class="s3">\n                </span><span class="s1">return true</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">]</span><span class="s3">\n\n    </span><span class="s1">const linkImgInputs = [</span><span class="s3">\n        </span><span class="s1">`&lt;input</span><span class="s3">\n            </span><span class="s1">id=</span><span class="s3">\&quot;</span><span class="s1">${linkUrlId}</span><span class="s3">\&quot;\n            </span><span class="s1">type=</span><span class="s3">\&quot;</span><span class="s1">text</span><span class="s3">\&quot;\n            </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">block</span><span class="s3">\&quot;\n            </span><span class="s1">placeholder=</span><span class="s3">\&quot;</span><span class="s1">${t('图片地址')}</span><span class="s3">\&quot;</span><span class="s1">/&gt;`,</span><span class="s3">\n    </span><span class="s1">]</span><span class="s3">\n\n    </span><span class="s1">if (config.showLinkImgAlt) {</span><span class="s3">\n        </span><span class="s1">linkImgInputs.push(`</span><span class="s3">\n        </span><span class="s1">&lt;input</span><span class="s3">\n            </span><span class="s1">id=</span><span class="s3">\&quot;</span><span class="s1">${linkUrlAltId}</span><span class="s3">\&quot;\n            </span><span class="s1">type=</span><span class="s3">\&quot;</span><span class="s1">text</span><span class="s3">\&quot;\n            </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">block</span><span class="s3">\&quot;\n            </span><span class="s1">placeholder=</span><span class="s3">\&quot;</span><span class="s1">${t('图片文字说明')}</span><span class="s3">\&quot;</span><span class="s1">/&gt;`)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (config.showLinkImgHref) {</span><span class="s3">\n        </span><span class="s1">linkImgInputs.push(`</span><span class="s3">\n        </span><span class="s1">&lt;input</span><span class="s3">\n            </span><span class="s1">id=</span><span class="s3">\&quot;</span><span class="s1">${linkUrlHrefId}</span><span class="s3">\&quot;\n            </span><span class="s1">type=</span><span class="s3">\&quot;</span><span class="s1">text</span><span class="s3">\&quot;\n            </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">block</span><span class="s3">\&quot;\n            </span><span class="s1">placeholder=</span><span class="s3">\&quot;</span><span class="s1">${t('跳转链接')}</span><span class="s3">\&quot;</span><span class="s1">/&gt;`)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const tabsConf: PanelTabConf[] = [</span><span class="s3">\n        </span><span class="s1">// first tab</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">// 标题</span><span class="s3">\n            </span><span class="s1">title: t('上传图片'),</span><span class="s3">\n            </span><span class="s1">// 模板</span><span class="s3">\n            </span><span class="s1">tpl: getUploadImgTpl('w-e-up-img-container', 'w-e-icon-upload2', ''),</span><span class="s3">\n            </span><span class="s1">// 事件绑定</span><span class="s3">\n            </span><span class="s1">events: uploadEvents,</span><span class="s3">\n        </span><span class="s1">}, // first tab end</span><span class="s3">\n        </span><span class="s1">// second tab</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">title: t('网络图片'),</span><span class="s3">\n            </span><span class="s1">tpl: `&lt;div&gt;</span><span class="s3">\n                    </span><span class="s1">${linkImgInputs.join('')}</span><span class="s3">\n                    </span><span class="s1">&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-button-container</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;button type=</span><span class="s3">\&quot;</span><span class="s1">button</span><span class="s3">\&quot; </span><span class="s1">id=</span><span class="s3">\&quot;</span><span class="s1">${linkBtnId}</span><span class="s3">\&quot; </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">right</span><span class="s3">\&quot;</span><span class="s1">&gt;${t(</span><span class="s3">\n                </span><span class="s1">'插入',</span><span class="s3">\n                </span><span class="s1">''</span><span class="s3">\n            </span><span class="s1">)}&lt;/button&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;/div&gt;</span><span class="s3">\n                </span><span class="s1">&lt;/div&gt;`,</span><span class="s3">\n            </span><span class="s1">events: [</span><span class="s3">\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">selector: '#' + linkBtnId,</span><span class="s3">\n                    </span><span class="s1">type: 'click',</span><span class="s3">\n                    </span><span class="s1">fn: () =&gt; {</span><span class="s3">\n                        </span><span class="s1">const $linkUrl = $('#' + linkUrlId)</span><span class="s3">\n                        </span><span class="s1">const url = $linkUrl.val().trim()</span><span class="s3">\n\n                        </span><span class="s1">//如果url为空则直接返回</span><span class="s3">\n                        </span><span class="s1">if (!url) return</span><span class="s3">\n\n                        </span><span class="s1">let linkUrlAltText</span><span class="s3">\n                        </span><span class="s1">if (config.showLinkImgAlt) {</span><span class="s3">\n                            </span><span class="s1">linkUrlAltText = $('#' + linkUrlAltId)</span><span class="s3">\n                                </span><span class="s1">.val()</span><span class="s3">\n                                </span><span class="s1">.trim()</span><span class="s3">\n                        </span><span class="s1">}</span><span class="s3">\n                        </span><span class="s1">let linkUrlHrefText</span><span class="s3">\n                        </span><span class="s1">if (config.showLinkImgHref) {</span><span class="s3">\n                            </span><span class="s1">linkUrlHrefText = $('#' + linkUrlHrefId)</span><span class="s3">\n                                </span><span class="s1">.val()</span><span class="s3">\n                                </span><span class="s1">.trim()</span><span class="s3">\n                        </span><span class="s1">}</span><span class="s3">\n                        </span><span class="s1">//如果不能通过校验也直接返回</span><span class="s3">\n                        </span><span class="s1">if (!checkLinkImg(url, linkUrlAltText, linkUrlHrefText)) return</span><span class="s3">\n                        </span><span class="s1">//插入图片url</span><span class="s3">\n                        </span><span class="s1">uploadImg.insertImg(url, linkUrlAltText, linkUrlHrefText)</span><span class="s3">\n                        </span><span class="s1">// 返回 true 表示函数执行结束之后关闭 panel</span><span class="s3">\n                        </span><span class="s1">return true</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">bindEnter: true,</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">],</span><span class="s3">\n        </span><span class="s1">}, // second tab end</span><span class="s3">\n    </span><span class="s1">]</span><span class="s3">\n    </span><span class="s1">// tabs end</span><span class="s3">\n\n    </span><span class="s1">// 最终的配置 -----------------------------------------</span><span class="s3">\n    </span><span class="s1">const conf: ImgPanelConf = {</span><span class="s3">\n        </span><span class="s1">width: 300,</span><span class="s3">\n        </span><span class="s1">height: 0,</span><span class="s3">\n        </span><span class="s1">tabs: [],</span><span class="s3">\n        </span><span class="s1">onlyUploadConf: {</span><span class="s3">\n            </span><span class="s1">$elem: $(getUploadImgTpl('w-e-menu', 'w-e-icon-image', '图片')),</span><span class="s3">\n            </span><span class="s1">events: uploadEvents,</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// 显示“上传图片”</span><span class="s3">\n    </span><span class="s1">if (</span><span class="s3">\n        </span><span class="s1">window.FileReader &amp;&amp;</span><span class="s3">\n        </span><span class="s1">(config.uploadImgShowBase64 ||</span><span class="s3">\n            </span><span class="s1">config.uploadImgServer ||</span><span class="s3">\n            </span><span class="s1">config.customUploadImg ||</span><span class="s3">\n            </span><span class="s1">config.uploadImgFromMedia)</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n        </span><span class="s1">conf.tabs.push(tabsConf[0])</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// 显示“插入网络图片”</span><span class="s3">\n    </span><span class="s1">if (config.showLinkImg) {</span><span class="s3">\n        </span><span class="s1">conf.tabs.push(tabsConf[1])</span><span class="s3">\n        </span><span class="s1">conf.onlyUploadConf = undefined</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return conf</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 增加缩进/减少缩进</span><span class="s3">\n </span><span class="s1">* @author tonghan</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import DropListMenu from '../menu-constructors/DropListMenu'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import operateElement from './operate-element'</span><span class="s3">\n\n</span><span class="s1">class Indent extends DropListMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">缩进</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-indent-increase</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">const dropListConf = {</span><span class="s3">\n            </span><span class="s1">width: 130,</span><span class="s3">\n            </span><span class="s1">title: '设置缩进',</span><span class="s3">\n            </span><span class="s1">type: 'list',</span><span class="s3">\n            </span><span class="s1">list: [</span><span class="s3">\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">$elem: $(</span><span class="s3">\n                        </span><span class="s1">`&lt;p&gt;</span><span class="s3">\n                            </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-indent-increase w-e-drop-list-item</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n                            </span><span class="s1">${editor.i18next.t('menus.dropListMenu.indent.增加缩进')}</span><span class="s3">\n                        </span><span class="s1">&lt;p&gt;`</span><span class="s3">\n                    </span><span class="s1">),</span><span class="s3">\n                    </span><span class="s1">value: 'increase',</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">$elem: $(</span><span class="s3">\n                        </span><span class="s1">`&lt;p&gt;</span><span class="s3">\n                            </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-indent-decrease w-e-drop-list-item</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n                            </span><span class="s1">${editor.i18next.t('menus.dropListMenu.indent.减少缩进')}</span><span class="s3">\n                        </span><span class="s1">&lt;p&gt;`</span><span class="s3">\n                    </span><span class="s1">),</span><span class="s3">\n                    </span><span class="s1">value: 'decrease',</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">],</span><span class="s3">\n            </span><span class="s1">clickHandler: (value: string) =&gt; {</span><span class="s3">\n                </span><span class="s1">// 注意 this 是指向当前的 Indent 对象</span><span class="s3">\n                </span><span class="s1">this.command(value)</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">super($elem, editor, dropListConf)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行命令</span><span class="s3">\n     </span><span class="s1">* @param value value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public command(value: string): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $selectionElem = editor.selection.getSelectionContainerElem()</span><span class="s3">\n\n        </span><span class="s1">// 判断 当前选区为 textElem 时</span><span class="s3">\n        </span><span class="s1">if ($selectionElem &amp;&amp; editor.$textElem.equal($selectionElem)) {</span><span class="s3">\n            </span><span class="s1">// 当 当前选区 等于 textElem 时</span><span class="s3">\n            </span><span class="s1">// 代表 当前选区 可能是一个选择了一个完整的段落或者多个段落</span><span class="s3">\n            </span><span class="s1">const $elems = editor.selection.getSelectionRangeTopNodes()</span><span class="s3">\n            </span><span class="s1">if ($elems.length &gt; 0) {</span><span class="s3">\n                </span><span class="s1">$elems.forEach((item: any) =&gt; {</span><span class="s3">\n                    </span><span class="s1">operateElement($(item), value, editor)</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 当 当前选区 不等于 textElem 时</span><span class="s3">\n            </span><span class="s1">// 代表 当前选区要么是一个段落，要么是段落中的一部分</span><span class="s3">\n            </span><span class="s1">if ($selectionElem &amp;&amp; $selectionElem.length &gt; 0) {</span><span class="s3">\n                </span><span class="s1">$selectionElem.forEach((item: any) =&gt; {</span><span class="s3">\n                    </span><span class="s1">operateElement($(item), value, editor)</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 恢复选区</span><span class="s3">\n        </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n        </span><span class="s1">this.tryChangeActive()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试改变菜单激活（高亮）状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $selectionElem = editor.selection.getSelectionStartElem()</span><span class="s3">\n        </span><span class="s1">const $selectionStartElem = $($selectionElem).getNodeTop(editor)</span><span class="s3">\n\n        </span><span class="s1">if ($selectionStartElem.length &lt;= 0) return</span><span class="s3">\n\n        </span><span class="s1">if ($selectionStartElem.elems[0].style['paddingLeft'] != '') {</span><span class="s3">\n            </span><span class="s1">this.active()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">this.unActive()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Indent</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 对节点 操作 进行封装</span><span class="s3">\n </span><span class="s1">*                  获取当前节点的段落</span><span class="s3">\n </span><span class="s1">*                  根据type判断是增加还是减少缩进</span><span class="s3">\n </span><span class="s1">* @author tonghan</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { IndentationOptions } from '../../config/menus'</span><span class="s3">\n</span><span class="s1">import increaseIndentStyle from './increase-indent-style'</span><span class="s3">\n</span><span class="s1">import decreaseIndentStyle from './decrease-indent-style'</span><span class="s3">\n\n</span><span class="s1">const lengthRegex = /^(</span><span class="s3">\\</span><span class="s1">d+)(</span><span class="s3">\\</span><span class="s1">w+)$/</span><span class="s3">\n</span><span class="s1">const percentRegex = /^(</span><span class="s3">\\</span><span class="s1">d+)%$/</span><span class="s3">\n\n</span><span class="s1">function parseIndentation(editor: Editor): IndentationOptions {</span><span class="s3">\n    </span><span class="s1">const { indentation } = editor.config</span><span class="s3">\n\n    </span><span class="s1">if (typeof indentation === 'string') {</span><span class="s3">\n        </span><span class="s1">if (lengthRegex.test(indentation)) {</span><span class="s3">\n            </span><span class="s1">const [value, unit] = indentation.trim().match(lengthRegex)!.slice(1, 3)</span><span class="s3">\n            </span><span class="s1">return {</span><span class="s3">\n                </span><span class="s1">value: Number(value),</span><span class="s3">\n                </span><span class="s1">unit,</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">} else if (percentRegex.test(indentation)) {</span><span class="s3">\n            </span><span class="s1">return {</span><span class="s3">\n                </span><span class="s1">value: Number(indentation.trim().match(percentRegex)![1]),</span><span class="s3">\n                </span><span class="s1">unit: '%',</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">} else if (indentation.value !== void 0 &amp;&amp; indentation.unit) {</span><span class="s3">\n        </span><span class="s1">return indentation</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return {</span><span class="s3">\n        </span><span class="s1">value: 2,</span><span class="s3">\n        </span><span class="s1">unit: 'em',</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function operateElement($node: DomElement, type: String, editor: Editor): void {</span><span class="s3">\n    </span><span class="s1">const $elem = $node.getNodeTop(editor)</span><span class="s3">\n    </span><span class="s1">const reg = /^(P|H[0-9]*)$/</span><span class="s3">\n\n    </span><span class="s1">if (reg.test($elem.getNodeName())) {</span><span class="s3">\n        </span><span class="s1">if (type === 'increase') increaseIndentStyle($elem, parseIndentation(editor))</span><span class="s3">\n        </span><span class="s1">else if (type === 'decrease') decreaseIndentStyle($elem, parseIndentation(editor))</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default operateElement</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 增加缩进</span><span class="s3">\n </span><span class="s1">* @author tonghan</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { IndentationOptions } from '../../config/menus'</span><span class="s3">\n\n</span><span class="s1">function increaseIndentStyle($node: DomElement, options: IndentationOptions): void {</span><span class="s3">\n    </span><span class="s1">const $elem = $node.elems[0]</span><span class="s3">\n    </span><span class="s1">if ($elem.style['paddingLeft'] === '') {</span><span class="s3">\n        </span><span class="s1">$node.css('padding-left', options.value + options.unit)</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">const oldPL = $elem.style['paddingLeft']</span><span class="s3">\n        </span><span class="s1">const oldVal = oldPL.slice(0, oldPL.length - options.unit.length)</span><span class="s3">\n        </span><span class="s1">const newVal = Number(oldVal) + options.value</span><span class="s3">\n        </span><span class="s1">$node.css('padding-left', `${newVal}${options.unit}`)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default increaseIndentStyle</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 减少缩进</span><span class="s3">\n </span><span class="s1">* @author tonghan</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { IndentationOptions } from '../../config/menus'</span><span class="s3">\n\n</span><span class="s1">function decreaseIndentStyle($node: DomElement, options: IndentationOptions): void {</span><span class="s3">\n    </span><span class="s1">const $elem = $node.elems[0]</span><span class="s3">\n    </span><span class="s1">if ($elem.style['paddingLeft'] !== '') {</span><span class="s3">\n        </span><span class="s1">const oldPL = $elem.style['paddingLeft']</span><span class="s3">\n        </span><span class="s1">const oldVal = oldPL.slice(0, oldPL.length - options.unit.length)</span><span class="s3">\n        </span><span class="s1">const newVal = Number(oldVal) - options.value</span><span class="s3">\n        </span><span class="s1">if (newVal &gt; 0) {</span><span class="s3">\n            </span><span class="s1">$node.css('padding-left', `${newVal}${options.unit}`)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">$node.css('padding-left', '')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default decreaseIndentStyle</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 插入表情</span><span class="s3">\n </span><span class="s1">* @author liuwe</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import PanelMenu from '../menu-constructors/PanelMenu'</span><span class="s3">\n</span><span class="s1">import Panel from '../menu-constructors/Panel'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import createPanelConf from './create-panel-conf'</span><span class="s3">\n\n</span><span class="s1">class Emoticon extends PanelMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">表情</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-happy</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 创建 panel</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private createPanel(): void {</span><span class="s3">\n        </span><span class="s1">const conf = createPanelConf(this.editor)</span><span class="s3">\n        </span><span class="s1">const panel = new Panel(this, conf)</span><span class="s3">\n        </span><span class="s1">panel.create()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 菜单表情点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">this.createPanel()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public tryChangeActive() {}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Emoticon</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description  表情菜单 panel配置</span><span class="s3">\n </span><span class="s1">* @author liuwei</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { PanelConf, PanelTabConf } from '../menu-constructors/Panel'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { EmotionsType, EmotionsContentType } from '../../config/menus'</span><span class="s3">\n\n</span><span class="s1">export default function (editor: Editor): PanelConf {</span><span class="s3">\n    </span><span class="s1">// 声明emotions数据结构</span><span class="s3">\n    </span><span class="s1">const emotions: Array&lt;EmotionsType&gt; = editor.config.emotions</span><span class="s3">\n\n    </span><span class="s1">/* tabs配置项 ==================================================================*/</span><span class="s3">\n\n    </span><span class="s1">// 生成表情结构 TODO jele type类型待优化</span><span class="s3">\n    </span><span class="s1">function GenerateExpressionStructure(ele: EmotionsType) {</span><span class="s3">\n        </span><span class="s1">// 返回为一个数组对象</span><span class="s3">\n        </span><span class="s1">let res: string[] = []</span><span class="s3">\n\n        </span><span class="s1">// 如果type是image类型则生成一个img标签</span><span class="s3">\n        </span><span class="s1">if (ele.type == 'image') {</span><span class="s3">\n            </span><span class="s1">res = ele.content.map((con: EmotionsContentType | string) =&gt; {</span><span class="s3">\n                </span><span class="s1">if (typeof con == 'string') return ''</span><span class="s3">\n                </span><span class="s1">return `&lt;span  title=</span><span class="s3">\&quot;</span><span class="s1">${con.alt}</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;img class=</span><span class="s3">\&quot;</span><span class="s1">eleImg</span><span class="s3">\&quot; </span><span class="s1">data-emoji=</span><span class="s3">\&quot;</span><span class="s1">${con.alt}</span><span class="s3">\&quot; </span><span class="s1">style src=</span><span class="s3">\&quot;</span><span class="s1">${con.src}</span><span class="s3">\&quot; </span><span class="s1">alt=</span><span class="s3">\&quot;</span><span class="s1">[${con.alt}]</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;/span&gt;`</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">res = res.filter((s: string) =&gt; s !== '')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">//否则直接当内容处理</span><span class="s3">\n        </span><span class="s1">else {</span><span class="s3">\n            </span><span class="s1">res = ele.content.map((con: EmotionsContentType | string) =&gt; {</span><span class="s3">\n                </span><span class="s1">return `&lt;span class=</span><span class="s3">\&quot;</span><span class="s1">eleImg</span><span class="s3">\&quot; </span><span class="s1">title=</span><span class="s3">\&quot;</span><span class="s1">${con}</span><span class="s3">\&quot;</span><span class="s1">&gt;${con}&lt;/span&gt;`</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">return res.join('').replace(/&amp;nbsp;/g, '')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const tabsConf: PanelTabConf[] = emotions.map((ele: EmotionsType) =&gt; {</span><span class="s3">\n        </span><span class="s1">return {</span><span class="s3">\n            </span><span class="s1">title: editor.i18next.t(`menus.panelMenus.emoticon.${ele.title}`),</span><span class="s3">\n\n            </span><span class="s1">// 判断type类型如果是image则以img的形式插入否则以内容</span><span class="s3">\n            </span><span class="s1">tpl: `&lt;div&gt;${GenerateExpressionStructure(ele)}&lt;/div&gt;`,</span><span class="s3">\n\n            </span><span class="s1">events: [</span><span class="s3">\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">selector: '.eleImg',</span><span class="s3">\n                    </span><span class="s1">type: 'click',</span><span class="s3">\n                    </span><span class="s1">fn: (e: Event) =&gt; {</span><span class="s3">\n                        </span><span class="s1">// e为事件对象</span><span class="s3">\n                        </span><span class="s1">const $target = $(e.target)</span><span class="s3">\n                        </span><span class="s1">const nodeName = $target.getNodeName()</span><span class="s3">\n                        </span><span class="s1">let insertHtml</span><span class="s3">\n\n                        </span><span class="s1">if (nodeName === 'IMG') {</span><span class="s3">\n                            </span><span class="s1">// 插入图片</span><span class="s3">\n                            </span><span class="s1">insertHtml = $target.parent().html().trim()</span><span class="s3">\n                        </span><span class="s1">} else {</span><span class="s3">\n                            </span><span class="s1">// 插入 emoji</span><span class="s3">\n                            </span><span class="s1">insertHtml = '&lt;span&gt;' + $target.html() + '&lt;/span&gt;'</span><span class="s3">\n                        </span><span class="s1">}</span><span class="s3">\n\n                        </span><span class="s1">editor.cmd.do('insertHTML', insertHtml)</span><span class="s3">\n                        </span><span class="s1">// 示函数执行结束之后关闭 panel</span><span class="s3">\n                        </span><span class="s1">return true</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">],</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">/* tabs配置项 =================================================================end*/</span><span class="s3">\n\n    </span><span class="s1">// 最终的配置 -----------------------------------------</span><span class="s3">\n    </span><span class="s1">const conf: PanelConf = {</span><span class="s3">\n        </span><span class="s1">width: 300, // Panel容器宽度</span><span class="s3">\n        </span><span class="s1">height: 230, // Panel容器高度</span><span class="s3">\n        </span><span class="s1">tabs: tabsConf,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return conf</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import WrapListHandle from './WrapListHandle'</span><span class="s3">\n</span><span class="s1">import JoinListHandle from './JoinListHandle'</span><span class="s3">\n</span><span class="s1">import StartJoinListHandle from './StartJoinListHandle'</span><span class="s3">\n</span><span class="s1">import EndJoinListHandle from './EndJoinListHandle'</span><span class="s3">\n</span><span class="s1">import OtherListHandle from './OtherListHandle'</span><span class="s3">\n\n</span><span class="s1">import { HandlerListOptions } from './ListHandle'</span><span class="s3">\n\n</span><span class="s1">// 片段类型</span><span class="s3">\n</span><span class="s1">export type ContainerFragment = HTMLElement | DocumentFragment</span><span class="s3">\n\n</span><span class="s1">// 处理类</span><span class="s3">\n</span><span class="s1">export type ListHandleClass =</span><span class="s3">\n    </span><span class="s1">| WrapListHandle</span><span class="s3">\n    </span><span class="s1">| JoinListHandle</span><span class="s3">\n    </span><span class="s1">| StartJoinListHandle</span><span class="s3">\n    </span><span class="s1">| EndJoinListHandle</span><span class="s3">\n    </span><span class="s1">| OtherListHandle</span><span class="s3">\n\n</span><span class="s1">export enum ClassType {</span><span class="s3">\n    </span><span class="s1">Wrap = 'WrapListHandle',</span><span class="s3">\n    </span><span class="s1">Join = 'JoinListHandle',</span><span class="s3">\n    </span><span class="s1">StartJoin = 'StartJoinListHandle',</span><span class="s3">\n    </span><span class="s1">EndJoin = 'EndJoinListHandle',</span><span class="s3">\n    </span><span class="s1">Other = 'OtherListHandle',</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">const handle = {</span><span class="s3">\n    </span><span class="s1">WrapListHandle,</span><span class="s3">\n    </span><span class="s1">JoinListHandle,</span><span class="s3">\n    </span><span class="s1">StartJoinListHandle,</span><span class="s3">\n    </span><span class="s1">EndJoinListHandle,</span><span class="s3">\n    </span><span class="s1">OtherListHandle,</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function createListHandle(</span><span class="s3">\n    </span><span class="s1">classType: ClassType,</span><span class="s3">\n    </span><span class="s1">options: HandlerListOptions,</span><span class="s3">\n    </span><span class="s1">range?: Range</span><span class="s3">\n</span><span class="s1">): ListHandleClass {</span><span class="s3">\n    </span><span class="s1">if (classType === ClassType.Other &amp;&amp; range === undefined) {</span><span class="s3">\n        </span><span class="s1">throw new Error('other 类需要传入 range')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return classType !== ClassType.Other</span><span class="s3">\n        </span><span class="s1">? new handle[classType](options)</span><span class="s3">\n        </span><span class="s1">: new handle[classType](options, range as Range)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 统一执行的接口</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default class ListHandleCommand {</span><span class="s3">\n    </span><span class="s1">private handle: ListHandleClass</span><span class="s3">\n\n    </span><span class="s1">constructor(handle: ListHandleClass) {</span><span class="s3">\n        </span><span class="s1">this.handle = handle</span><span class="s3">\n        </span><span class="s1">this.handle.exec()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">getSelectionRangeElem(): DomElement {</span><span class="s3">\n        </span><span class="s1">return $(this.handle.selectionRangeElem.get())</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import { ContainerFragment } from '.'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { Exec, HandlerListOptions, ListHandle } from './ListHandle'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n    </span><span class="s1">insertBefore,</span><span class="s3">\n    </span><span class="s1">createElement,</span><span class="s3">\n    </span><span class="s1">createDocumentFragment,</span><span class="s3">\n    </span><span class="s1">createElementFragment,</span><span class="s3">\n</span><span class="s1">} from '../utils'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 选区在序列内的处理</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default class WrapListHandle extends ListHandle implements Exec {</span><span class="s3">\n    </span><span class="s1">constructor(options: HandlerListOptions) {</span><span class="s3">\n        </span><span class="s1">super(options)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">exec(): void {</span><span class="s3">\n        </span><span class="s1">const { listType, listTarget, $selectionElem, $startElem, $endElem } = this.options</span><span class="s3">\n\n        </span><span class="s1">let $containerFragment: ContainerFragment // 容器 - HTML 文档片段</span><span class="s3">\n        </span><span class="s1">const $nodes: DomElement[] = [] // 获取选中的段落</span><span class="s3">\n\n        </span><span class="s1">// 获取 selectionElem 的标签名</span><span class="s3">\n        </span><span class="s1">const containerNodeName = $selectionElem?.getNodeName()</span><span class="s3">\n\n        </span><span class="s1">// 获取开始以及结束的 li 元素</span><span class="s3">\n        </span><span class="s1">const $start = $startElem.prior</span><span class="s3">\n        </span><span class="s1">const $end = $endElem.prior</span><span class="s3">\n\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">// 当 开始节点 和 结束节点 没有 prior</span><span class="s3">\n        </span><span class="s1">// 并且 开始节点 没有前一个兄弟节点</span><span class="s3">\n        </span><span class="s1">// 并且 结束节点 没有后一个兄弟节点</span><span class="s3">\n        </span><span class="s1">// 即代表 全选序列</span><span class="s3">\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">if (</span><span class="s3">\n            </span><span class="s1">(!$startElem.prior &amp;&amp; !$endElem.prior) ||</span><span class="s3">\n            </span><span class="s1">(!$start?.prev().length &amp;&amp; !$end?.next().length)</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n            </span><span class="s1">// 获取当前序列下的所有 li 标签</span><span class="s3">\n            </span><span class="s1">;($selectionElem?.children() as DomElement).forEach(($node: HTMLElement) =&gt; {</span><span class="s3">\n                </span><span class="s1">$nodes.push($($node))</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">// 当 selectionElem 的标签名和按钮类型 一致 的时候</span><span class="s3">\n            </span><span class="s1">// 代表着当前的操作是 取消 序列</span><span class="s3">\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">if (containerNodeName === listType) {</span><span class="s3">\n                </span><span class="s1">// 生成对应的段落(p)并添加到文档片段中，然后删除掉无用的 li</span><span class="s3">\n                </span><span class="s1">$containerFragment = createElementFragment(</span><span class="s3">\n                    </span><span class="s1">$nodes,</span><span class="s3">\n                    </span><span class="s1">createDocumentFragment(), // 创建 文档片段</span><span class="s3">\n                    </span><span class="s1">'p'</span><span class="s3">\n                </span><span class="s1">)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">// 当 selectionElem 的标签名和按钮类型 不一致 的时候</span><span class="s3">\n            </span><span class="s1">// 代表着当前的操作是 转换 序列</span><span class="s3">\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">else {</span><span class="s3">\n                </span><span class="s1">// 创建 序列节点</span><span class="s3">\n                </span><span class="s1">$containerFragment = createElement(listTarget)</span><span class="s3">\n\n                </span><span class="s1">// 因为是转换，所以 li 元素可以直接使用</span><span class="s3">\n                </span><span class="s1">$nodes.forEach($node =&gt; {</span><span class="s3">\n                    </span><span class="s1">$containerFragment.appendChild($node.elems[0])</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 把 文档片段 或 序列节点 插入到 selectionElem 的前面</span><span class="s3">\n            </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n\n            </span><span class="s1">// 插入到 $selectionElem 之前</span><span class="s3">\n            </span><span class="s1">insertBefore($selectionElem, $containerFragment, $selectionElem.elems[0])</span><span class="s3">\n\n            </span><span class="s1">// 删除无用的 selectionElem 因为它被掏空了</span><span class="s3">\n            </span><span class="s1">$selectionElem.remove()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">// 当不是全选序列的时候就代表是非全选序列(废话)</span><span class="s3">\n        </span><span class="s1">// 非全选序列的情况</span><span class="s3">\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">else {</span><span class="s3">\n            </span><span class="s1">// 获取选中的内容</span><span class="s3">\n            </span><span class="s1">let $startDom: DomElement = $start as DomElement</span><span class="s3">\n            </span><span class="s1">while ($startDom.length) {</span><span class="s3">\n                </span><span class="s1">$nodes.push($startDom)</span><span class="s3">\n                </span><span class="s1">$end?.equal($startDom)</span><span class="s3">\n                    </span><span class="s1">? ($startDom = $(undefined)) // 结束</span><span class="s3">\n                    </span><span class="s1">: ($startDom = $startDom.next()) // 继续</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 获取开始节点的上一个兄弟节点</span><span class="s3">\n            </span><span class="s1">const $prveDom: DomElement = ($start as DomElement).prev()</span><span class="s3">\n            </span><span class="s1">// 获取结束节点的下一个兄弟节点</span><span class="s3">\n            </span><span class="s1">let $nextDom: DomElement = ($end as DomElement).next()</span><span class="s3">\n\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">// 当 selectionElem 的标签名和按钮类型一致的时候</span><span class="s3">\n            </span><span class="s1">// 代表着当前的操作是 取消 序列</span><span class="s3">\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">if (containerNodeName === listType) {</span><span class="s3">\n                </span><span class="s1">// 生成对应的段落(p)并添加到文档片段中，然后删除掉无用的 li</span><span class="s3">\n                </span><span class="s1">$containerFragment = createElementFragment(</span><span class="s3">\n                    </span><span class="s1">$nodes,</span><span class="s3">\n                    </span><span class="s1">createDocumentFragment(), // 创建 文档片段</span><span class="s3">\n                    </span><span class="s1">'p'</span><span class="s3">\n                </span><span class="s1">)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">// 当 selectionElem 的标签名和按钮类型不一致的时候</span><span class="s3">\n            </span><span class="s1">// 代表着当前的操作是 转换 序列</span><span class="s3">\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">else {</span><span class="s3">\n                </span><span class="s1">// 创建 文档片段</span><span class="s3">\n                </span><span class="s1">$containerFragment = createElement(listTarget)</span><span class="s3">\n\n                </span><span class="s1">// 因为是转换，所以 li 元素可以直接使用</span><span class="s3">\n                </span><span class="s1">$nodes.forEach(($node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">$containerFragment.append($node.elems[0])</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">// 当 prveDom 和 nextDom 都存在的时候</span><span class="s3">\n            </span><span class="s1">// 代表着当前选区是在序列的中间</span><span class="s3">\n            </span><span class="s1">// 所以要先把 下半部分 未选择的 li 元素独立出来生成一个 序列</span><span class="s3">\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">if ($prveDom.length &amp;&amp; $nextDom.length) {</span><span class="s3">\n                </span><span class="s1">// 获取尾部的元素</span><span class="s3">\n                </span><span class="s1">const $tailDomArr: DomElement[] = []</span><span class="s3">\n                </span><span class="s1">while ($nextDom.length) {</span><span class="s3">\n                    </span><span class="s1">$tailDomArr.push($nextDom)</span><span class="s3">\n                    </span><span class="s1">$nextDom = $nextDom.next()</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// 创建 尾部序列节点</span><span class="s3">\n                </span><span class="s1">const $tailDocFragment = createElement(containerNodeName)</span><span class="s3">\n\n                </span><span class="s1">// 把尾部元素节点添加到尾部序列节点中</span><span class="s3">\n                </span><span class="s1">$tailDomArr.forEach(($node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">$tailDocFragment.append($node.elems[0])</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n\n                </span><span class="s1">// 把尾部序列节点插入到 selectionElem 的后面</span><span class="s3">\n                </span><span class="s1">$($tailDocFragment).insertAfter($selectionElem)</span><span class="s3">\n\n                </span><span class="s1">// =====================================</span><span class="s3">\n                </span><span class="s1">// 获取选区容器元素的父元素，一般就是编辑区域</span><span class="s3">\n                </span><span class="s1">// 然后判断 selectionElem 是否还有下一个兄弟节点</span><span class="s3">\n                </span><span class="s1">// 如果有，就把文档片段添加到 selectionElem 下一个兄弟节点前</span><span class="s3">\n                </span><span class="s1">// 如果没有，就把文档片段添加到 编辑区域 末尾</span><span class="s3">\n                </span><span class="s1">// =====================================</span><span class="s3">\n                </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n                </span><span class="s1">const $selectionNextDom: DomElement = $selectionElem.next()</span><span class="s3">\n                </span><span class="s1">$selectionNextDom.length</span><span class="s3">\n                    </span><span class="s1">? insertBefore($selectionElem, $containerFragment, $selectionNextDom.elems[0])</span><span class="s3">\n                    </span><span class="s1">: $selectionElem.parent().elems[0].append($containerFragment)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">// 不管是 取消 还是 转换 都需要重新插入节点</span><span class="s3">\n            </span><span class="s1">//</span><span class="s3">\n            </span><span class="s1">// prveDom.length 等于 0 即代表选区是 selectionElem 序列的上半部分</span><span class="s3">\n            </span><span class="s1">// 上半部分的 li 元素</span><span class="s3">\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">else if (!$prveDom.length) {</span><span class="s3">\n                </span><span class="s1">// 文档片段插入到 selectionElem 之前</span><span class="s3">\n                </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n                </span><span class="s1">insertBefore($selectionElem, $containerFragment, $selectionElem.elems[0])</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">// 不管是 取消 还是 转换 都需要重新插入节点</span><span class="s3">\n            </span><span class="s1">//</span><span class="s3">\n            </span><span class="s1">// nextDom.length 等于 0 即代表选区是 selectionElem 序列的下半部分</span><span class="s3">\n            </span><span class="s1">// 下半部分的 li 元素  if (!$nextDom.length)</span><span class="s3">\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">else {</span><span class="s3">\n                </span><span class="s1">// 文档片段插入到 selectionElem 之后</span><span class="s3">\n                </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n                </span><span class="s1">const $selectionNextDom: DomElement = $selectionElem.next()</span><span class="s3">\n                </span><span class="s1">$selectionNextDom.length</span><span class="s3">\n                    </span><span class="s1">? insertBefore($selectionElem, $containerFragment, $selectionNextDom.elems[0])</span><span class="s3">\n                    </span><span class="s1">: $selectionElem.parent().elems[0].append($containerFragment)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;type SelectionRangeType = HTMLElement | ChildNode[]</span><span class="s3">\n</span><span class="s1">type SetSelectionRangeType = SelectionRangeType | DocumentFragment</span><span class="s3">\n</span><span class="s1">export type SelectionRangeElemType = SelectionRangeType | null</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* @description 选区的 Element</span><span class="s3">\n </span><span class="s1">* @author tonghan</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">class SelectionRangeElem {</span><span class="s3">\n    </span><span class="s1">private _element: SelectionRangeElemType</span><span class="s3">\n\n    </span><span class="s1">constructor() {</span><span class="s3">\n        </span><span class="s1">this._element = null</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 设置 SelectionRangeElem 的值</span><span class="s3">\n     </span><span class="s1">* @param { SetSelectionRangeType } data</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public set(data: SetSelectionRangeType) {</span><span class="s3">\n        </span><span class="s1">//</span><span class="s3">\n        </span><span class="s1">if (data instanceof DocumentFragment) {</span><span class="s3">\n            </span><span class="s1">const childNode: ChildNode[] = []</span><span class="s3">\n            </span><span class="s1">data.childNodes.forEach(($node: ChildNode) =&gt; {</span><span class="s3">\n                </span><span class="s1">childNode.push($node)</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">data = childNode</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">this._element = data</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取 SelectionRangeElem 的值</span><span class="s3">\n     </span><span class="s1">* @returns { SelectionRangeType } Elem</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public get(): SelectionRangeElemType {</span><span class="s3">\n        </span><span class="s1">return this._element</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 清除 SelectionRangeElem 的值</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clear() {</span><span class="s3">\n        </span><span class="s1">this._element = null</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default SelectionRangeElem</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import { ContainerFragment } from '.'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { Exec, HandlerListOptions, ListHandle } from './ListHandle'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n    </span><span class="s1">filterSelectionNodes,</span><span class="s3">\n    </span><span class="s1">getStartPoint,</span><span class="s3">\n    </span><span class="s1">getEndPoint,</span><span class="s3">\n    </span><span class="s1">insertBefore,</span><span class="s3">\n    </span><span class="s1">createElement,</span><span class="s3">\n    </span><span class="s1">createDocumentFragment,</span><span class="s3">\n    </span><span class="s1">createElementFragment,</span><span class="s3">\n</span><span class="s1">} from '../utils'</span><span class="s3">\n\n</span><span class="s1">export default class JoinListHandle extends ListHandle implements Exec {</span><span class="s3">\n    </span><span class="s1">constructor(options: HandlerListOptions) {</span><span class="s3">\n        </span><span class="s1">super(options)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">exec(): void {</span><span class="s3">\n        </span><span class="s1">const { editor, listType, listTarget, $startElem, $endElem } = this.options</span><span class="s3">\n\n        </span><span class="s1">// 容器 - HTML 文档片段</span><span class="s3">\n        </span><span class="s1">let $containerFragment: ContainerFragment</span><span class="s3">\n\n        </span><span class="s1">// 获取选中的段落</span><span class="s3">\n        </span><span class="s1">const $nodes: DomElement[] = editor.selection.getSelectionRangeTopNodes()</span><span class="s3">\n\n        </span><span class="s1">// 获取开始段落和结束段落 标签名</span><span class="s3">\n        </span><span class="s1">const startNodeName = $startElem?.getNodeName()</span><span class="s3">\n        </span><span class="s1">const endNodeName = $endElem?.getNodeName()</span><span class="s3">\n\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">// 开头结尾都是序列的情况下</span><span class="s3">\n        </span><span class="s1">// 开头序列 和 结尾序列的标签名一致的时候</span><span class="s3">\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">if (startNodeName === endNodeName) {</span><span class="s3">\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">// 开头序列 和 结尾序列 中间还有其他的段落的时候</span><span class="s3">\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">if ($nodes.length &gt; 2) {</span><span class="s3">\n                </span><span class="s1">// 弹出 开头 和 结尾</span><span class="s3">\n                </span><span class="s1">$nodes.shift()</span><span class="s3">\n                </span><span class="s1">$nodes.pop()</span><span class="s3">\n\n                </span><span class="s1">// 把中间部分的节点元素转换成 li 元素并添加到文档片段后删除</span><span class="s3">\n                </span><span class="s1">$containerFragment = createElementFragment(</span><span class="s3">\n                    </span><span class="s1">filterSelectionNodes($nodes), // 过滤 $nodes 获取到符合要求的选中元素节点</span><span class="s3">\n                    </span><span class="s1">createDocumentFragment() // 创建 文档片段</span><span class="s3">\n                </span><span class="s1">)</span><span class="s3">\n\n                </span><span class="s1">// =====================================</span><span class="s3">\n                </span><span class="s1">// 由于开头序列 和 结尾序列的标签名一样，所以只判断了开头序列的</span><span class="s3">\n                </span><span class="s1">// 当开头序列的标签名和按钮类型 一致 的时候</span><span class="s3">\n                </span><span class="s1">// 代表着当前是一个 设置序列 的操作</span><span class="s3">\n                </span><span class="s1">// =====================================</span><span class="s3">\n                </span><span class="s1">if (startNodeName === listType) {</span><span class="s3">\n                    </span><span class="s1">// 把结束序列的 li 元素添加到 文档片段中</span><span class="s3">\n                    </span><span class="s1">$endElem.children()?.forEach(($list: HTMLElement) =&gt; {</span><span class="s3">\n                        </span><span class="s1">$containerFragment.append($list)</span><span class="s3">\n                    </span><span class="s1">})</span><span class="s3">\n\n                    </span><span class="s1">// 下序列全选被掏空了，就卸磨杀驴吧</span><span class="s3">\n                    </span><span class="s1">$endElem.remove()</span><span class="s3">\n\n                    </span><span class="s1">// 在开始序列中添加 文档片段</span><span class="s3">\n                    </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n                    </span><span class="s1">$startElem.elems[0].append($containerFragment)</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// =====================================</span><span class="s3">\n                </span><span class="s1">// 由于开头序列 和 结尾序列的标签名一样，所以只判断了开头序列的</span><span class="s3">\n                </span><span class="s1">// 当开头序列的标签名和按钮类型 不一致 的时候</span><span class="s3">\n                </span><span class="s1">// 代表着当前是一个 转换序列 的操作</span><span class="s3">\n                </span><span class="s1">// =====================================</span><span class="s3">\n                </span><span class="s1">else {</span><span class="s3">\n                    </span><span class="s1">// 创建 开始序列和结束序列的文档片段</span><span class="s3">\n                    </span><span class="s1">const $startFragment = document.createDocumentFragment()</span><span class="s3">\n                    </span><span class="s1">const $endFragment = document.createDocumentFragment()</span><span class="s3">\n\n                    </span><span class="s1">// 获取起点元素</span><span class="s3">\n                    </span><span class="s1">let $startDom: DomElement = getStartPoint($startElem)</span><span class="s3">\n                    </span><span class="s1">// 获取上半序列中的选中内容，并添加到文档片段中</span><span class="s3">\n                    </span><span class="s1">while ($startDom.length) {</span><span class="s3">\n                        </span><span class="s1">const _element = $startDom.elems[0]</span><span class="s3">\n                        </span><span class="s1">$startDom = $startDom.next()</span><span class="s3">\n                        </span><span class="s1">$startFragment.append(_element)</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n\n                    </span><span class="s1">// 获取结束元素</span><span class="s3">\n                    </span><span class="s1">let $endDom: DomElement = getEndPoint($endElem)</span><span class="s3">\n                    </span><span class="s1">// 获取下半序列中选中的内容</span><span class="s3">\n                    </span><span class="s1">const domArr: Element[] = []</span><span class="s3">\n                    </span><span class="s1">while ($endDom.length) {</span><span class="s3">\n                        </span><span class="s1">domArr.unshift($endDom.elems[0])</span><span class="s3">\n                        </span><span class="s1">$endDom = $endDom.prev()</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">// 添加到文档片段中</span><span class="s3">\n                    </span><span class="s1">domArr.forEach(($node: Element) =&gt; {</span><span class="s3">\n                        </span><span class="s1">$endFragment.append($node)</span><span class="s3">\n                    </span><span class="s1">})</span><span class="s3">\n\n                    </span><span class="s1">// 合并文档片段</span><span class="s3">\n                    </span><span class="s1">const $orderFragment = createElement(listTarget)</span><span class="s3">\n                    </span><span class="s1">$orderFragment.append($startFragment)</span><span class="s3">\n                    </span><span class="s1">$orderFragment.append($containerFragment)</span><span class="s3">\n                    </span><span class="s1">$orderFragment.append($endFragment)</span><span class="s3">\n                    </span><span class="s1">$containerFragment = $orderFragment</span><span class="s3">\n\n                    </span><span class="s1">// 插入</span><span class="s3">\n                    </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n                    </span><span class="s1">$($orderFragment).insertAfter($startElem)</span><span class="s3">\n\n                    </span><span class="s1">// 序列全选被掏空了后，就卸磨杀驴吧</span><span class="s3">\n                    </span><span class="s1">!$startElem.children()?.length &amp;&amp; $startElem.remove()</span><span class="s3">\n                    </span><span class="s1">!$endElem.children()?.length &amp;&amp; $endElem.remove()</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">// 开头序列 和 结尾序列 中间没有其他的段落</span><span class="s3">\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">else {</span><span class="s3">\n                </span><span class="s1">$nodes.length = 0</span><span class="s3">\n\n                </span><span class="s1">// 获取起点元素</span><span class="s3">\n                </span><span class="s1">let $startDom: DomElement = getStartPoint($startElem)</span><span class="s3">\n                </span><span class="s1">// 获取上半序列中的选中内容</span><span class="s3">\n                </span><span class="s1">while ($startDom.length) {</span><span class="s3">\n                    </span><span class="s1">$nodes.push($startDom)</span><span class="s3">\n                    </span><span class="s1">$startDom = $startDom.next()</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// 获取结束元素</span><span class="s3">\n                </span><span class="s1">let $endDom: DomElement = getEndPoint($endElem)</span><span class="s3">\n                </span><span class="s1">// 获取下半序列中选中的内容</span><span class="s3">\n                </span><span class="s1">const domArr: DomElement[] = []</span><span class="s3">\n                </span><span class="s1">// 获取下半序列中的选中内容</span><span class="s3">\n                </span><span class="s1">while ($endDom.length) {</span><span class="s3">\n                    </span><span class="s1">domArr.unshift($endDom)</span><span class="s3">\n                    </span><span class="s1">$endDom = $endDom.prev()</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// 融合内容</span><span class="s3">\n                </span><span class="s1">$nodes.push(...domArr)</span><span class="s3">\n\n                </span><span class="s1">// =====================================</span><span class="s3">\n                </span><span class="s1">// 由于开头序列 和 结尾序列的标签名一样，所以只判断了开头序列的</span><span class="s3">\n                </span><span class="s1">// 当开头序列的标签名和按钮类型 一致 的时候</span><span class="s3">\n                </span><span class="s1">// 代表着当前是一个 取消序列 的操作</span><span class="s3">\n                </span><span class="s1">// =====================================</span><span class="s3">\n                </span><span class="s1">if (startNodeName === listType) {</span><span class="s3">\n                    </span><span class="s1">// 创建 文档片段</span><span class="s3">\n                    </span><span class="s1">// 把 li 转换为 p 标签</span><span class="s3">\n                    </span><span class="s1">$containerFragment = createElementFragment(</span><span class="s3">\n                        </span><span class="s1">$nodes,</span><span class="s3">\n                        </span><span class="s1">createDocumentFragment(),</span><span class="s3">\n                        </span><span class="s1">'p'</span><span class="s3">\n                    </span><span class="s1">)</span><span class="s3">\n\n                    </span><span class="s1">// 插入到 endElem 前</span><span class="s3">\n                    </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n                    </span><span class="s1">insertBefore($startElem, $containerFragment, $endElem.elems[0])</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// =====================================</span><span class="s3">\n                </span><span class="s1">// 由于开头序列 和 结尾序列的标签名一样，所以只判断了开头序列的</span><span class="s3">\n                </span><span class="s1">// 当开头序列的标签名和按钮类型 不一致 的时候</span><span class="s3">\n                </span><span class="s1">// 代表着当前是一个 设置序列 的操作</span><span class="s3">\n                </span><span class="s1">// =====================================</span><span class="s3">\n                </span><span class="s1">else {</span><span class="s3">\n                    </span><span class="s1">// 创建 序列元素</span><span class="s3">\n                    </span><span class="s1">$containerFragment = createElement(listTarget)</span><span class="s3">\n                    </span><span class="s1">// li 元素添加到 序列元素 中</span><span class="s3">\n                    </span><span class="s1">$nodes.forEach(($list: DomElement) =&gt; {</span><span class="s3">\n                        </span><span class="s1">$containerFragment.append($list.elems[0])</span><span class="s3">\n                    </span><span class="s1">})</span><span class="s3">\n                    </span><span class="s1">// 插入到 startElem 之后</span><span class="s3">\n                    </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n                    </span><span class="s1">$($containerFragment).insertAfter($startElem)</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// 序列全选被掏空了后，就卸磨杀驴吧</span><span class="s3">\n                </span><span class="s1">!$startElem.children()?.length &amp;&amp; $endElem.remove()</span><span class="s3">\n                </span><span class="s1">!$endElem.children()?.length &amp;&amp; $endElem.remove()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">// 由于开头序列 和 结尾序列的标签名不一样</span><span class="s3">\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">else {</span><span class="s3">\n            </span><span class="s1">// 下序列元素数组</span><span class="s3">\n            </span><span class="s1">const lowerListElems: DomElement[] = []</span><span class="s3">\n            </span><span class="s1">// 获取结束元素</span><span class="s3">\n            </span><span class="s1">let $endDom: DomElement = getEndPoint($endElem)</span><span class="s3">\n            </span><span class="s1">// 获取下半序列中选中的内容</span><span class="s3">\n            </span><span class="s1">while ($endDom.length) {</span><span class="s3">\n                </span><span class="s1">lowerListElems.unshift($endDom)</span><span class="s3">\n                </span><span class="s1">$endDom = $endDom.prev()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 上序列元素数组</span><span class="s3">\n            </span><span class="s1">const upperListElems: DomElement[] = []</span><span class="s3">\n            </span><span class="s1">// 获取起点元素</span><span class="s3">\n            </span><span class="s1">let $startDom: DomElement = getStartPoint($startElem)</span><span class="s3">\n            </span><span class="s1">// 获取上半序列中的选中内容，并添加到文档片段中</span><span class="s3">\n            </span><span class="s1">while ($startDom.length) {</span><span class="s3">\n                </span><span class="s1">upperListElems.push($startDom)</span><span class="s3">\n                </span><span class="s1">$startDom = $startDom.next()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 创建 文档片段</span><span class="s3">\n            </span><span class="s1">$containerFragment = createDocumentFragment()</span><span class="s3">\n\n            </span><span class="s1">// 弹出开头和结尾的序列</span><span class="s3">\n            </span><span class="s1">$nodes.shift()</span><span class="s3">\n            </span><span class="s1">$nodes.pop()</span><span class="s3">\n\n            </span><span class="s1">// 把头部序列的内容添加到文档片段当中</span><span class="s3">\n            </span><span class="s1">upperListElems.forEach($list =&gt; $containerFragment.append($list.elems[0]))</span><span class="s3">\n\n            </span><span class="s1">// 生成 li 标签，并且添加到 文档片段中，删除无用节点</span><span class="s3">\n            </span><span class="s1">$containerFragment = createElementFragment(</span><span class="s3">\n                </span><span class="s1">filterSelectionNodes($nodes), // 序列中间的数据 - 进行数据过滤</span><span class="s3">\n                </span><span class="s1">$containerFragment</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n\n            </span><span class="s1">// 把尾部序列的内容添加到文档片段当中</span><span class="s3">\n            </span><span class="s1">lowerListElems.forEach($list =&gt; $containerFragment.append($list.elems[0]))</span><span class="s3">\n\n            </span><span class="s1">// 记录</span><span class="s3">\n            </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">// 开头序列 和 设置序列类型相同</span><span class="s3">\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">if (startNodeName === listType) {</span><span class="s3">\n                </span><span class="s1">// 插入到 开始序列的尾部(作为子元素)</span><span class="s3">\n                </span><span class="s1">$startElem.elems[0].append($containerFragment)</span><span class="s3">\n\n                </span><span class="s1">// 序列全选被掏空了后，就卸磨杀驴吧</span><span class="s3">\n                </span><span class="s1">!$endElem.children()?.length &amp;&amp; $endElem.remove()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">// 结尾序列 和 设置序列类型相同</span><span class="s3">\n            </span><span class="s1">// =====================================</span><span class="s3">\n            </span><span class="s1">else {</span><span class="s3">\n                </span><span class="s1">// 插入到结束序列的顶部(作为子元素)</span><span class="s3">\n                </span><span class="s1">if ($endElem.children()?.length) {</span><span class="s3">\n                    </span><span class="s1">const $endElemChild = $endElem.children() as DomElement</span><span class="s3">\n                    </span><span class="s1">insertBefore($endElemChild, $containerFragment, $endElemChild.elems[0])</span><span class="s3">\n                </span><span class="s1">} else {</span><span class="s3">\n                    </span><span class="s1">$endElem.elems[0].append($containerFragment)</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import { ContainerFragment } from '.'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { Exec, HandlerListOptions, ListHandle } from './ListHandle'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n    </span><span class="s1">filterSelectionNodes,</span><span class="s3">\n    </span><span class="s1">getStartPoint,</span><span class="s3">\n    </span><span class="s1">createElement,</span><span class="s3">\n    </span><span class="s1">createDocumentFragment,</span><span class="s3">\n    </span><span class="s1">createElementFragment,</span><span class="s3">\n</span><span class="s1">} from '../utils'</span><span class="s3">\n\n</span><span class="s1">export default class StartJoinListHandle extends ListHandle implements Exec {</span><span class="s3">\n    </span><span class="s1">constructor(options: HandlerListOptions) {</span><span class="s3">\n        </span><span class="s1">super(options)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">exec(): void {</span><span class="s3">\n        </span><span class="s1">const { editor, listType, listTarget, $startElem } = this.options</span><span class="s3">\n\n        </span><span class="s1">// 容器 - HTML 文档片段</span><span class="s3">\n        </span><span class="s1">let $containerFragment: ContainerFragment</span><span class="s3">\n\n        </span><span class="s1">// 获取选中的段落</span><span class="s3">\n        </span><span class="s1">const $nodes: DomElement[] = editor.selection.getSelectionRangeTopNodes()</span><span class="s3">\n\n        </span><span class="s1">// 获取开始段落标签名</span><span class="s3">\n        </span><span class="s1">const startNodeName = $startElem?.getNodeName()</span><span class="s3">\n\n        </span><span class="s1">// 弹出 开头序列</span><span class="s3">\n        </span><span class="s1">$nodes.shift()</span><span class="s3">\n\n        </span><span class="s1">// 上序列元素数组</span><span class="s3">\n        </span><span class="s1">const upperListElems: DomElement[] = []</span><span class="s3">\n        </span><span class="s1">// 获取起点元素</span><span class="s3">\n        </span><span class="s1">let $startDom: DomElement = getStartPoint($startElem)</span><span class="s3">\n        </span><span class="s1">// 获取上半序列中的选中内容，并添加到文档片段中</span><span class="s3">\n        </span><span class="s1">while ($startDom.length) {</span><span class="s3">\n            </span><span class="s1">upperListElems.push($startDom)</span><span class="s3">\n            </span><span class="s1">$startDom = $startDom.next()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">// 当前序列类型和开头序列的类型 一致</span><span class="s3">\n        </span><span class="s1">// 代表当前是一个 融合(把其他段落加入到开头序列中) 的操作</span><span class="s3">\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">if (startNodeName === listType) {</span><span class="s3">\n            </span><span class="s1">$containerFragment = createDocumentFragment()</span><span class="s3">\n\n            </span><span class="s1">upperListElems.forEach($list =&gt; $containerFragment.append($list.elems[0]))</span><span class="s3">\n\n            </span><span class="s1">// 生成 li 元属，并删除</span><span class="s3">\n            </span><span class="s1">$containerFragment = createElementFragment(</span><span class="s3">\n                </span><span class="s1">filterSelectionNodes($nodes), // 过滤元素节点数据</span><span class="s3">\n                </span><span class="s1">$containerFragment</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n\n            </span><span class="s1">// 插入到开始序列末尾</span><span class="s3">\n            </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n            </span><span class="s1">// this.selectionRangeElem.set($startElem.elems[0])</span><span class="s3">\n            </span><span class="s1">$startElem.elems[0].append($containerFragment)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">// 当前序列类型和开头序列的类型 不一致</span><span class="s3">\n        </span><span class="s1">// 代表当前是一个 设置序列 的操作</span><span class="s3">\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">else {</span><span class="s3">\n            </span><span class="s1">// 创建 序列节点</span><span class="s3">\n            </span><span class="s1">$containerFragment = createElement(listTarget)</span><span class="s3">\n\n            </span><span class="s1">upperListElems.forEach($list =&gt; $containerFragment.append($list.elems[0]))</span><span class="s3">\n\n            </span><span class="s1">// 生成 li 元素，并添加到 序列节点 当中，删除无用节点</span><span class="s3">\n            </span><span class="s1">$containerFragment = createElementFragment(</span><span class="s3">\n                </span><span class="s1">filterSelectionNodes($nodes), // 过滤普通节点</span><span class="s3">\n                </span><span class="s1">$containerFragment</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n\n            </span><span class="s1">// 插入到开始元素</span><span class="s3">\n            </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n            </span><span class="s1">$($containerFragment).insertAfter($startElem)</span><span class="s3">\n\n            </span><span class="s1">// 序列全选被掏空了后，就卸磨杀驴吧</span><span class="s3">\n            </span><span class="s1">!$startElem.children()?.length &amp;&amp; $startElem.remove()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import { ContainerFragment } from '.'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { Exec, HandlerListOptions, ListHandle } from './ListHandle'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n    </span><span class="s1">filterSelectionNodes,</span><span class="s3">\n    </span><span class="s1">getEndPoint,</span><span class="s3">\n    </span><span class="s1">insertBefore,</span><span class="s3">\n    </span><span class="s1">createElement,</span><span class="s3">\n    </span><span class="s1">createDocumentFragment,</span><span class="s3">\n    </span><span class="s1">createElementFragment,</span><span class="s3">\n</span><span class="s1">} from '../utils'</span><span class="s3">\n\n</span><span class="s1">export default class EndJoinListHandle extends ListHandle implements Exec {</span><span class="s3">\n    </span><span class="s1">constructor(options: HandlerListOptions) {</span><span class="s3">\n        </span><span class="s1">super(options)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">exec(): void {</span><span class="s3">\n        </span><span class="s1">const { editor, listType, listTarget, $endElem } = this.options</span><span class="s3">\n\n        </span><span class="s1">// 容器 - HTML 文档片段</span><span class="s3">\n        </span><span class="s1">let $containerFragment: ContainerFragment</span><span class="s3">\n\n        </span><span class="s1">// 获取选中的段落</span><span class="s3">\n        </span><span class="s1">const $nodes: DomElement[] = editor.selection.getSelectionRangeTopNodes()</span><span class="s3">\n\n        </span><span class="s1">// 获取结束段落标签名</span><span class="s3">\n        </span><span class="s1">const endNodeName = $endElem?.getNodeName()</span><span class="s3">\n\n        </span><span class="s1">// 弹出 结束序列</span><span class="s3">\n        </span><span class="s1">$nodes.pop()</span><span class="s3">\n\n        </span><span class="s1">// 下序列元素数组</span><span class="s3">\n        </span><span class="s1">const lowerListElems: DomElement[] = []</span><span class="s3">\n        </span><span class="s1">// 获取结束元素</span><span class="s3">\n        </span><span class="s1">let $endDom: DomElement = getEndPoint($endElem)</span><span class="s3">\n        </span><span class="s1">// 获取下半序列中选中的内容</span><span class="s3">\n        </span><span class="s1">while ($endDom.length) {</span><span class="s3">\n            </span><span class="s1">lowerListElems.unshift($endDom)</span><span class="s3">\n            </span><span class="s1">$endDom = $endDom.prev()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">// 当前序列类型和结束序列的类型 一致</span><span class="s3">\n        </span><span class="s1">// 代表当前是一个 融合(把其他段落加入到结束序列中) 的操作</span><span class="s3">\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">if (endNodeName === listType) {</span><span class="s3">\n            </span><span class="s1">// 生成 li 元属，并删除原来的 dom 元素</span><span class="s3">\n            </span><span class="s1">$containerFragment = createElementFragment(</span><span class="s3">\n                </span><span class="s1">filterSelectionNodes($nodes), // 过滤元素节点数据</span><span class="s3">\n                </span><span class="s1">createDocumentFragment() // 创建 文档片段</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n\n            </span><span class="s1">lowerListElems.forEach($list =&gt; $containerFragment.append($list.elems[0]))</span><span class="s3">\n\n            </span><span class="s1">// 插入到结束序列之前</span><span class="s3">\n            </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n\n            </span><span class="s1">if ($endElem.children()?.length) {</span><span class="s3">\n                </span><span class="s1">const $endElemChild = $endElem.children() as DomElement</span><span class="s3">\n                </span><span class="s1">insertBefore($endElemChild, $containerFragment, $endElemChild.elems[0])</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">$endElem.elems[0].append($containerFragment)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">// 当前序列类型和结束序列的类型 不一致</span><span class="s3">\n        </span><span class="s1">// 代表当前是一个 设置序列 的操作</span><span class="s3">\n        </span><span class="s1">// =====================================</span><span class="s3">\n        </span><span class="s1">else {</span><span class="s3">\n            </span><span class="s1">// 过滤元素节点数据</span><span class="s3">\n            </span><span class="s1">const $selectionNodes = filterSelectionNodes($nodes)</span><span class="s3">\n            </span><span class="s1">// 把下序列的内容添加到过滤元素中</span><span class="s3">\n            </span><span class="s1">$selectionNodes.push(...lowerListElems)</span><span class="s3">\n            </span><span class="s1">// 生成 li 元素并且添加到序列节点后删除原节点</span><span class="s3">\n            </span><span class="s1">$containerFragment = createElementFragment(</span><span class="s3">\n                </span><span class="s1">$selectionNodes,</span><span class="s3">\n                </span><span class="s1">createElement(listTarget) // 创建 序列节点</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n\n            </span><span class="s1">// 插入到结束序列之前</span><span class="s3">\n            </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n            </span><span class="s1">$($containerFragment).insertBefore($endElem)</span><span class="s3">\n\n            </span><span class="s1">// 序列全选被掏空了后，就卸磨杀驴吧</span><span class="s3">\n            </span><span class="s1">!$endElem.children()?.length &amp;&amp; $endElem.remove()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import { ContainerFragment } from '.'</span><span class="s3">\n</span><span class="s1">import { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { Exec, HandlerListOptions, ListHandle } from './ListHandle'</span><span class="s3">\n</span><span class="s1">import { filterSelectionNodes, createElement, createElementFragment } from '../utils'</span><span class="s3">\n\n</span><span class="s1">export default class OtherListHandle extends ListHandle implements Exec {</span><span class="s3">\n    </span><span class="s1">public range: Range</span><span class="s3">\n\n    </span><span class="s1">constructor(options: HandlerListOptions, range: Range) {</span><span class="s3">\n        </span><span class="s1">super(options)</span><span class="s3">\n        </span><span class="s1">this.range = range</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">exec(): void {</span><span class="s3">\n        </span><span class="s1">const { editor, listTarget } = this.options</span><span class="s3">\n\n        </span><span class="s1">// 获取选中的段落</span><span class="s3">\n        </span><span class="s1">const $nodes: DomElement[] = editor.selection.getSelectionRangeTopNodes()</span><span class="s3">\n\n        </span><span class="s1">// 生成 li 元素并且添加到序列节点后删除原节点</span><span class="s3">\n        </span><span class="s1">const $containerFragment: ContainerFragment = createElementFragment(</span><span class="s3">\n            </span><span class="s1">filterSelectionNodes($nodes), // 过滤选取的元素</span><span class="s3">\n            </span><span class="s1">createElement(listTarget) // 创建 序列节点</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">// 插入节点到选区</span><span class="s3">\n        </span><span class="s1">this.selectionRangeElem.set($containerFragment)</span><span class="s3">\n        </span><span class="s1">this.range.insertNode($containerFragment)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 段落行高 LineHeight</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import DropListMenu from '../menu-constructors/DropListMenu'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import lineHeightList from './lineHeightList'</span><span class="s3">\n\n</span><span class="s1">class LineHeight extends DropListMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">行高</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-row-height</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n                </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">let lineHeightMenu = new lineHeightList(editor, editor.config.lineHeights)</span><span class="s3">\n        </span><span class="s1">const DropListMenu = {</span><span class="s3">\n            </span><span class="s1">width: 100,</span><span class="s3">\n            </span><span class="s1">title: '设置行高',</span><span class="s3">\n            </span><span class="s1">type: 'list', // droplist 以列表形式展示</span><span class="s3">\n            </span><span class="s1">list: lineHeightMenu.getItemList(),</span><span class="s3">\n            </span><span class="s1">clickHandler: (value: string) =&gt; {</span><span class="s3">\n                </span><span class="s1">//保存焦点</span><span class="s3">\n                </span><span class="s1">editor.selection.saveRange()</span><span class="s3">\n                </span><span class="s1">this.command(value)</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">super($elem, editor, DropListMenu)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行命令</span><span class="s3">\n     </span><span class="s1">* @param value value</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public command(value: string): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n\n        </span><span class="s1">//重置选区</span><span class="s3">\n        </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n\n        </span><span class="s1">// 获取选区的祖先元素</span><span class="s3">\n        </span><span class="s1">const $containerElem = $(editor.selection.getSelectionContainerElem())</span><span class="s3">\n\n        </span><span class="s1">if (!$containerElem.elems.length) return</span><span class="s3">\n\n        </span><span class="s1">//选中多行操作</span><span class="s3">\n        </span><span class="s1">if ($containerElem &amp;&amp; editor.$textElem.equal($containerElem)) {</span><span class="s3">\n            </span><span class="s1">// 标识是否可以设置行高的样式</span><span class="s3">\n            </span><span class="s1">let setStyleLock: boolean = false</span><span class="s3">\n\n            </span><span class="s1">//获取range 开头结束的dom</span><span class="s3">\n            </span><span class="s1">const selectionStartElem: HTMLElement = $(editor.selection.getSelectionStartElem())</span><span class="s3">\n                </span><span class="s1">.elems[0]</span><span class="s3">\n            </span><span class="s1">const SelectionEndElem: HTMLElement = $(editor.selection.getSelectionEndElem()).elems[0]</span><span class="s3">\n\n            </span><span class="s1">// 获取选区中，在contenteditable下的直接父元素</span><span class="s3">\n            </span><span class="s1">const StartElemWrap: HTMLElement = this.getDom(selectionStartElem)</span><span class="s3">\n            </span><span class="s1">const EndElemWrap: HTMLElement = this.getDom(SelectionEndElem)</span><span class="s3">\n\n            </span><span class="s1">const containerElemChildren = $containerElem.elems[0].children</span><span class="s3">\n\n            </span><span class="s1">for (let i = 0; i &lt; containerElemChildren.length; i++) {</span><span class="s3">\n                </span><span class="s1">const item: HTMLElement = containerElemChildren[i] as HTMLElement</span><span class="s3">\n\n                </span><span class="s1">// 目前只支持p 段落标签设置行高</span><span class="s3">\n                </span><span class="s1">if ($(item).getNodeName() !== 'P') {</span><span class="s3">\n                    </span><span class="s1">continue</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">if (item === StartElemWrap) {</span><span class="s3">\n                    </span><span class="s1">setStyleLock = true</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">// 证明在区间节点里</span><span class="s3">\n                </span><span class="s1">if (setStyleLock) {</span><span class="s3">\n                    </span><span class="s1">$(item).css('line-height', value)</span><span class="s3">\n\n                    </span><span class="s1">if (item === EndElemWrap) {</span><span class="s3">\n                        </span><span class="s1">setStyleLock = false</span><span class="s3">\n\n                        </span><span class="s1">// 当设置完选择的EndElemWrap时，就可以退出</span><span class="s3">\n                        </span><span class="s1">return</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">//重新设置选区</span><span class="s3">\n            </span><span class="s1">editor.selection.createRangeByElems(selectionStartElem, SelectionEndElem)</span><span class="s3">\n\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 单行操作</span><span class="s3">\n        </span><span class="s1">// 选中区间的dom元素</span><span class="s3">\n        </span><span class="s1">const selectElem = $containerElem.elems[0]</span><span class="s3">\n\n        </span><span class="s1">// 获取选区中，在contenteditable下的直接父元素</span><span class="s3">\n        </span><span class="s1">const selectElemWrapdom = this.getDom(selectElem)</span><span class="s3">\n\n        </span><span class="s1">// 目前只支持p 段落标签设置行高</span><span class="s3">\n        </span><span class="s1">if ($(selectElemWrapdom).getNodeName() !== 'P') {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">$(selectElemWrapdom).css('line-height', value)</span><span class="s3">\n\n        </span><span class="s1">//重新设置选区</span><span class="s3">\n        </span><span class="s1">editor.selection.createRangeByElems(selectElemWrapdom, selectElemWrapdom)</span><span class="s3">\n\n        </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 遍历dom 获取祖父元素 直到contenteditable属性的div标签</span><span class="s3">\n     </span><span class="s1">*</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public getDom(dom: HTMLElement): HTMLElement {</span><span class="s3">\n        </span><span class="s1">let DOM: HTMLElement = $(dom).elems[0]</span><span class="s3">\n        </span><span class="s1">if (!DOM.parentNode) {</span><span class="s3">\n            </span><span class="s1">return DOM</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">function getParentNode($node: HTMLElement, editor: Editor): HTMLElement {</span><span class="s3">\n            </span><span class="s1">const $parent = $($node.parentNode)</span><span class="s3">\n            </span><span class="s1">if (editor.$textElem.equal($parent)) {</span><span class="s3">\n                </span><span class="s1">return $node</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">return getParentNode($parent.elems[0], editor)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">DOM = getParentNode(DOM, this.editor)</span><span class="s3">\n\n        </span><span class="s1">return DOM</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* style 处理</span><span class="s3">\n     </span><span class="s1">*</span><span class="s3">\n     </span><span class="s1">* 废弃的方法</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public styleProcessing(styleList: Array&lt;string&gt;): string {</span><span class="s3">\n        </span><span class="s1">let styleStr = ''</span><span class="s3">\n        </span><span class="s1">styleList.forEach(item =&gt; {</span><span class="s3">\n            </span><span class="s1">item !== '' &amp;&amp; item.indexOf('line-height') === -1</span><span class="s3">\n                </span><span class="s1">? (styleStr = styleStr + item + ';')</span><span class="s3">\n                </span><span class="s1">: ''</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">return styleStr</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 段落全选 比如：避免11变成111</span><span class="s3">\n     </span><span class="s1">*</span><span class="s3">\n     </span><span class="s1">* 废弃的方法</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public setRange(startDom: Node, endDom: Node): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">let selection = window.getSelection ? window.getSelection() : document.getSelection()</span><span class="s3">\n        </span><span class="s1">//清除所有的选区</span><span class="s3">\n        </span><span class="s1">selection?.removeAllRanges()</span><span class="s3">\n        </span><span class="s1">const range = document.createRange()</span><span class="s3">\n        </span><span class="s1">let star = startDom</span><span class="s3">\n        </span><span class="s1">let end = endDom</span><span class="s3">\n        </span><span class="s1">range.setStart(star, 0)</span><span class="s3">\n        </span><span class="s1">range.setEnd(end, 1)</span><span class="s3">\n        </span><span class="s1">selection?.addRange(range)</span><span class="s3">\n        </span><span class="s1">//保存设置好的选区</span><span class="s3">\n        </span><span class="s1">editor.selection.saveRange()</span><span class="s3">\n        </span><span class="s1">//清除所有的选区</span><span class="s3">\n        </span><span class="s1">selection?.removeAllRanges()</span><span class="s3">\n        </span><span class="s1">//恢复选区</span><span class="s3">\n        </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $selectionElem = editor.selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">if ($selectionElem &amp;&amp; editor.$textElem.equal($selectionElem)) {</span><span class="s3">\n            </span><span class="s1">//避免选中多行设置</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">let dom: DomElement | HTMLElement = $(editor.selection.getSelectionStartElem())</span><span class="s3">\n        </span><span class="s1">// 有些情况下 dom 可能为空，比如编辑器初始化</span><span class="s3">\n        </span><span class="s1">if (dom.length === 0) return</span><span class="s3">\n\n        </span><span class="s1">dom = this.getDom(dom.elems[0])</span><span class="s3">\n        </span><span class="s1">let style: string | null = dom.getAttribute('style') ? dom.getAttribute('style') : ''</span><span class="s3">\n\n        </span><span class="s1">//判断当前标签是否具有line-height属性</span><span class="s3">\n        </span><span class="s1">if (style &amp;&amp; style.indexOf('line-height') !== -1) {</span><span class="s3">\n            </span><span class="s1">this.active()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">this.unActive()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default LineHeight</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 行高 菜单</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { DropListItem } from '../menu-constructors/DropList'</span><span class="s3">\n\n</span><span class="s1">class lineHeightList {</span><span class="s3">\n    </span><span class="s1">private itemList: DropListItem[]</span><span class="s3">\n\n    </span><span class="s1">constructor(editor: Editor, list: string[]) {</span><span class="s3">\n        </span><span class="s1">this.itemList = [{ $elem: $(`&lt;span&gt;${editor.i18next.t('默认')}&lt;/span&gt;`), value: '' }]</span><span class="s3">\n        </span><span class="s1">list.forEach(item =&gt; {</span><span class="s3">\n            </span><span class="s1">this.itemList.push({</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${item}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">value: item,</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public getItemList(): DropListItem[] {</span><span class="s3">\n        </span><span class="s1">return this.itemList</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default lineHeightList</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 撤销</span><span class="s3">\n </span><span class="s1">* @author tonghan</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import BtnMenu from '../menu-constructors/BtnMenu'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n\n</span><span class="s1">class Undo extends BtnMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">撤销</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-undo</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">editor.history.revoke()</span><span class="s3">\n\n        </span><span class="s1">// 重新创建 range，是处理当初始化编辑器，API插入内容后撤销，range 不在编辑器内部的问题</span><span class="s3">\n        </span><span class="s1">const children = editor.$textElem.children()</span><span class="s3">\n\n        </span><span class="s1">if (!children?.length) return</span><span class="s3">\n\n        </span><span class="s1">const $last = children.last()</span><span class="s3">\n        </span><span class="s1">editor.selection.createRangeByElem($last, false, true)</span><span class="s3">\n        </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {</span><span class="s3">\n        </span><span class="s1">// 标准模式下才进行操作</span><span class="s3">\n        </span><span class="s1">if (!this.editor.isCompatibleMode) {</span><span class="s3">\n            </span><span class="s1">if (this.editor.history.size[0]) {</span><span class="s3">\n                </span><span class="s1">this.active()</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">this.unActive()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Undo</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 重做</span><span class="s3">\n </span><span class="s1">* @author tonghan</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import BtnMenu from '../menu-constructors/BtnMenu'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n\n</span><span class="s1">class Redo extends BtnMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">恢复</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-redo</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">editor.history.restore()</span><span class="s3">\n\n        </span><span class="s1">// 重新创建 range，是处理当初始化编辑器，API插入内容后撤销，range 不在编辑器内部的问题</span><span class="s3">\n        </span><span class="s1">const children = editor.$textElem.children()</span><span class="s3">\n\n        </span><span class="s1">if (!children?.length) return</span><span class="s3">\n\n        </span><span class="s1">const $last = children.last()</span><span class="s3">\n        </span><span class="s1">editor.selection.createRangeByElem($last, false, true)</span><span class="s3">\n        </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {</span><span class="s3">\n        </span><span class="s1">// 标准模式下才进行操作</span><span class="s3">\n        </span><span class="s1">if (!this.editor.isCompatibleMode) {</span><span class="s3">\n            </span><span class="s1">if (this.editor.history.size[1]) {</span><span class="s3">\n                </span><span class="s1">this.active()</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">this.unActive()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Redo</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 创建table</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import PanelMenu from '../menu-constructors/PanelMenu'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import createPanelConf from './create-panel-conf'</span><span class="s3">\n</span><span class="s1">import Panel from '../menu-constructors/Panel'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import bindEvent from './bind-event/index'</span><span class="s3">\n\n</span><span class="s1">class Table extends PanelMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">'&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">表格</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-table2</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;&lt;/div&gt;'</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n\n        </span><span class="s1">// 绑定事件</span><span class="s3">\n        </span><span class="s1">bindEvent(editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 菜单点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">this.createPanel()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 创建 panel</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private createPanel(): void {</span><span class="s3">\n        </span><span class="s1">const conf = createPanelConf(this.editor)</span><span class="s3">\n        </span><span class="s1">const panel = new Panel(this, conf)</span><span class="s3">\n        </span><span class="s1">panel.create()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单 active 状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive() {}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Table</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description table 菜单 panel tab 配置</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { PanelConf, PanelTabConf } from '../menu-constructors/Panel'</span><span class="s3">\n</span><span class="s1">import { getRandom } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import '../../assets/style/create-panel-conf.less'</span><span class="s3">\n</span><span class="s1">import CreateTable from './create-table'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 判断一个数值是否为正整数</span><span class="s3">\n </span><span class="s1">* @param { number } n 被验证的值</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function isPositiveInteger(n: number): boolean {</span><span class="s3">\n    </span><span class="s1">//是否为正整数</span><span class="s3">\n    </span><span class="s1">return n &gt; 0 &amp;&amp; Number.isInteger(n)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default function (editor: Editor): PanelConf {</span><span class="s3">\n    </span><span class="s1">const createTable = new CreateTable(editor)</span><span class="s3">\n\n    </span><span class="s1">// panel 中需要用到的id</span><span class="s3">\n    </span><span class="s1">const colId = getRandom('w-col-id')</span><span class="s3">\n    </span><span class="s1">const rowId = getRandom('w-row-id')</span><span class="s3">\n    </span><span class="s1">const insertBtnId = getRandom('btn-link')</span><span class="s3">\n\n    </span><span class="s1">const i18nPrefix = 'menus.panelMenus.table.'</span><span class="s3">\n    </span><span class="s1">const t = (text: string): string =&gt; {</span><span class="s3">\n        </span><span class="s1">return editor.i18next.t(text)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// tabs 配置 -----------------------------------------</span><span class="s3">\n    </span><span class="s1">const tabsConf: PanelTabConf[] = [</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">title: t(`${i18nPrefix}插入表格`),</span><span class="s3">\n            </span><span class="s1">tpl: `&lt;div&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-table</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;span&gt;${t('创建')}&lt;/span&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;input id=</span><span class="s3">\&quot;</span><span class="s1">${rowId}</span><span class="s3">\&quot;  </span><span class="s1">type=</span><span class="s3">\&quot;</span><span class="s1">text</span><span class="s3">\&quot; </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">w-e-table-input</span><span class="s3">\&quot; </span><span class="s1">value=</span><span class="s3">\&quot;</span><span class="s1">5</span><span class="s3">\&quot;</span><span class="s1">/&gt;&lt;/td&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;span&gt;${t(`${i18nPrefix}行`)}&lt;/span&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;input id=</span><span class="s3">\&quot;</span><span class="s1">${colId}</span><span class="s3">\&quot; </span><span class="s1">type=</span><span class="s3">\&quot;</span><span class="s1">text</span><span class="s3">\&quot; </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">w-e-table-input</span><span class="s3">\&quot; </span><span class="s1">value=</span><span class="s3">\&quot;</span><span class="s1">5</span><span class="s3">\&quot;</span><span class="s1">/&gt;&lt;/td&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;span&gt;${</span><span class="s3">\n                            </span><span class="s1">t(`${i18nPrefix}列`) + t(`${i18nPrefix}的`) + t(`${i18nPrefix}表格`)</span><span class="s3">\n                        </span><span class="s1">}&lt;/span&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;/div&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-button-container</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;button type=</span><span class="s3">\&quot;</span><span class="s1">button</span><span class="s3">\&quot; </span><span class="s1">id=</span><span class="s3">\&quot;</span><span class="s1">${insertBtnId}</span><span class="s3">\&quot; </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">right</span><span class="s3">\&quot;</span><span class="s1">&gt;${t(</span><span class="s3">\n                </span><span class="s1">'插入'</span><span class="s3">\n            </span><span class="s1">)}&lt;/button&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;/div&gt;</span><span class="s3">\n                </span><span class="s1">&lt;/div&gt;`,</span><span class="s3">\n            </span><span class="s1">events: [</span><span class="s3">\n                </span><span class="s1">{</span><span class="s3">\n                    </span><span class="s1">selector: '#' + insertBtnId,</span><span class="s3">\n                    </span><span class="s1">type: 'click',</span><span class="s3">\n                    </span><span class="s1">fn: () =&gt; {</span><span class="s3">\n                        </span><span class="s1">const colValue = Number($('#' + colId).val())</span><span class="s3">\n                        </span><span class="s1">const rowValue = Number($('#' + rowId).val())</span><span class="s3">\n                        </span><span class="s1">//校验是否传值</span><span class="s3">\n                        </span><span class="s1">if (isPositiveInteger(rowValue) &amp;&amp; isPositiveInteger(colValue)) {</span><span class="s3">\n                            </span><span class="s1">createTable.createAction(rowValue, colValue)</span><span class="s3">\n                            </span><span class="s1">return true</span><span class="s3">\n                        </span><span class="s1">} else {</span><span class="s3">\n                            </span><span class="s1">editor.config.customAlert('表格行列请输入正整数', 'warning')</span><span class="s3">\n                            </span><span class="s1">return false</span><span class="s3">\n                        </span><span class="s1">}</span><span class="s3">\n                        </span><span class="s1">// 返回 true 表示函数执行结束之后关闭 panel</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">bindEnter: true,</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">],</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">]</span><span class="s3">\n    </span><span class="s1">// tabs end</span><span class="s3">\n\n    </span><span class="s1">// 最终的配置 -----------------------------------------</span><span class="s3">\n    </span><span class="s1">const conf: PanelConf = {</span><span class="s3">\n        </span><span class="s1">width: 330,</span><span class="s3">\n        </span><span class="s1">height: 0,</span><span class="s3">\n        </span><span class="s1">tabs: [],</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">conf.tabs.push(tabsConf[0])</span><span class="s3">\n\n    </span><span class="s1">return conf</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/number/is-integer</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/number/is-integer');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.number.is-integer');</span><span class="s3">\n</span><span class="s1">var path = require('../../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.Number.isInteger;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var isInteger = require('../internals/is-integer');</span><span class="s3">\n\n</span><span class="s1">// `Number.isInteger` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-number.isinteger</span><span class="s3">\n</span><span class="s1">$({ target: 'Number', stat: true }, {</span><span class="s3">\n  </span><span class="s1">isInteger: isInteger</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var isObject = require('../internals/is-object');</span><span class="s3">\n\n</span><span class="s1">var floor = Math.floor;</span><span class="s3">\n\n</span><span class="s1">// `Number.isInteger` method implementation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-number.isinteger</span><span class="s3">\n</span><span class="s1">module.exports = function isInteger(it) {</span><span class="s3">\n  </span><span class="s1">return !isObject(it) &amp;&amp; isFinite(it) &amp;&amp; floor(it) === it;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var api = require(</span><span class="s3">\&quot;</span><span class="s1">!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n            </span><span class="s1">var content = require(</span><span class="s3">\&quot;</span><span class="s1">!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/postcss-loader/src/index.js!../../../node_modules/less-loader/dist/cjs.js!./create-panel-conf.less</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n\n            </span><span class="s1">content = content.__esModule ? content.default : content;</span><span class="s3">\n\n            </span><span class="s1">if (typeof content === 'string') {</span><span class="s3">\n              </span><span class="s1">content = [[module.id, content, '']];</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">var options = {};</span><span class="s3">\n\n</span><span class="s1">options.insert = </span><span class="s3">\&quot;</span><span class="s1">head</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n</span><span class="s1">options.singleton = false;</span><span class="s3">\n\n</span><span class="s1">var update = api(content, options);</span><span class="s3">\n\n\n\n</span><span class="s1">module.exports = content.locals || {};&quot;</span><span class="s0">,</span><span class="s1">&quot;// Imports</span><span class="s3">\n</span><span class="s1">var ___CSS_LOADER_API_IMPORT___ = require(</span><span class="s3">\&quot;</span><span class="s1">../../../node_modules/css-loader/dist/runtime/api.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">exports = ___CSS_LOADER_API_IMPORT___(false);</span><span class="s3">\n</span><span class="s1">// Module</span><span class="s3">\n</span><span class="s1">exports.push([module.id, </span><span class="s3">\&quot;</span><span class="s1">.w-e-table {</span><span class="s3">\\</span><span class="s1">n  display: flex;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-table .w-e-table-input {</span><span class="s3">\\</span><span class="s1">n  width: 40px;</span><span class="s3">\\</span><span class="s1">n  text-align: center!important;</span><span class="s3">\\</span><span class="s1">n  margin: 0 5px;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n</span><span class="s3">\&quot;</span><span class="s1">, </span><span class="s3">\&quot;\&quot;</span><span class="s1">]);</span><span class="s3">\n</span><span class="s1">// Exports</span><span class="s3">\n</span><span class="s1">module.exports = exports;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 创建tabel</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { EMPTY_P } from '../../utils/const'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">class CreateTable {</span><span class="s3">\n    </span><span class="s1">private editor: Editor</span><span class="s3">\n\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">this.editor = editor</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 执行创建</span><span class="s3">\n     </span><span class="s1">* @param rowValue 行数</span><span class="s3">\n     </span><span class="s1">* @param colValue 列数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public createAction(rowValue: number, colValue: number) {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n\n        </span><span class="s1">//不允许在有序列表中添加table</span><span class="s3">\n        </span><span class="s1">let $selectionElem = $(editor.selection.getSelectionContainerElem())</span><span class="s3">\n        </span><span class="s1">const $ul = $($selectionElem.elems[0]).parentUntilEditor('UL', editor)</span><span class="s3">\n        </span><span class="s1">const $ol = $($selectionElem.elems[0]).parentUntilEditor('OL', editor)</span><span class="s3">\n        </span><span class="s1">if ($ul || $ol) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const tableDom: string = this.createTableHtml(rowValue, colValue)</span><span class="s3">\n        </span><span class="s1">editor.cmd.do('insertHTML', tableDom)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 创建table、行、列</span><span class="s3">\n     </span><span class="s1">* @param rowValue 行数</span><span class="s3">\n     </span><span class="s1">* @param colValue 列数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public createTableHtml(rowValue: number, colValue: number): string {</span><span class="s3">\n        </span><span class="s1">let rowStr: string = ''</span><span class="s3">\n        </span><span class="s1">let colStr: string = ''</span><span class="s3">\n        </span><span class="s1">for (let i = 0; i &lt; rowValue; i++) {</span><span class="s3">\n            </span><span class="s1">colStr = ''</span><span class="s3">\n            </span><span class="s1">for (let j = 0; j &lt; colValue; j++) {</span><span class="s3">\n                </span><span class="s1">if (i === 0) {</span><span class="s3">\n                    </span><span class="s1">colStr = colStr + '&lt;th&gt;&lt;/th&gt;'</span><span class="s3">\n                </span><span class="s1">} else {</span><span class="s3">\n                    </span><span class="s1">colStr = colStr + '&lt;td&gt;&lt;/td&gt;'</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">rowStr = rowStr + '&lt;tr&gt;' + colStr + '&lt;/tr&gt;'</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">const tableDom =</span><span class="s3">\n            </span><span class="s1">`&lt;table border=</span><span class="s3">\&quot;</span><span class="s1">0</span><span class="s3">\&quot; </span><span class="s1">width=</span><span class="s3">\&quot;</span><span class="s1">100%</span><span class="s3">\&quot; </span><span class="s1">cellpadding=</span><span class="s3">\&quot;</span><span class="s1">0</span><span class="s3">\&quot; </span><span class="s1">cellspacing=</span><span class="s3">\&quot;</span><span class="s1">0</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;tbody&gt;` +</span><span class="s3">\n            </span><span class="s1">rowStr +</span><span class="s3">\n            </span><span class="s1">`&lt;/tbody&gt;&lt;/table&gt;${EMPTY_P}`</span><span class="s3">\n        </span><span class="s1">return tableDom</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default CreateTable</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 绑定点击事件</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import bindTooltip from './tooltip-event'</span><span class="s3">\n</span><span class="s1">import { bindEventKeyboardEvent, bindClickEvent } from './table-event'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function bindEvent(editor: Editor): void {</span><span class="s3">\n    </span><span class="s1">//Tooltip</span><span class="s3">\n    </span><span class="s1">bindTooltip(editor)</span><span class="s3">\n\n    </span><span class="s1">bindEventKeyboardEvent(editor)</span><span class="s3">\n\n    </span><span class="s1">bindClickEvent(editor)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default bindEvent</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description tooltip 事件</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Tooltip, { TooltipConfType } from '../../menu-constructors/Tooltip'</span><span class="s3">\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n\n</span><span class="s1">//操作事件</span><span class="s3">\n</span><span class="s1">import operatingEvent from './event/operating-event'</span><span class="s3">\n\n</span><span class="s1">import getNode from './event/getNode'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../../../utils/const'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 生成 Tooltip 的显示隐藏函数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function createShowHideFn(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">let tooltip: Tooltip | null</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 显示 tooltip</span><span class="s3">\n     </span><span class="s1">* @param  table元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function showTableTooltip($node: DomElement) {</span><span class="s3">\n        </span><span class="s1">const getnode = new getNode(editor)</span><span class="s3">\n\n        </span><span class="s1">const i18nPrefix = 'menus.panelMenus.table.'</span><span class="s3">\n        </span><span class="s1">const t = (text: string, prefix: string = i18nPrefix): string =&gt; {</span><span class="s3">\n            </span><span class="s1">return editor.i18next.t(prefix + text)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const conf: TooltipConfType = [</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">// $elem: $(</span><span class="s3">\&quot;</span><span class="s1">&lt;span class='w-e-icon-trash-o'&gt;&lt;/span&gt;</span><span class="s3">\&quot;</span><span class="s1">),</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${t('删除表格')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">// 选中img元素</span><span class="s3">\n                    </span><span class="s1">editor.selection.createRangeByElem($node)</span><span class="s3">\n                    </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n                    </span><span class="s1">editor.cmd.do('insertHTML', EMPTY_P)</span><span class="s3">\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${t('添加行')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">// 禁止多选操作</span><span class="s3">\n                    </span><span class="s1">let isMore = isMoreRowAction(editor)</span><span class="s3">\n                    </span><span class="s1">if (isMore) {</span><span class="s3">\n                        </span><span class="s1">return true</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">//当前元素</span><span class="s3">\n                    </span><span class="s1">let selectDom = $(editor.selection.getSelectionStartElem())</span><span class="s3">\n                    </span><span class="s1">//当前行</span><span class="s3">\n                    </span><span class="s1">let $currentRow = getnode.getRowNode(selectDom.elems[0])</span><span class="s3">\n                    </span><span class="s1">if (!$currentRow) {</span><span class="s3">\n                        </span><span class="s1">return true</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">//获取当前行的index</span><span class="s3">\n                    </span><span class="s1">const index = Number(getnode.getCurrentRowIndex($node.elems[0], $currentRow))</span><span class="s3">\n                    </span><span class="s1">//生成要替换的html</span><span class="s3">\n                    </span><span class="s1">let htmlStr = getnode.getTableHtml($node.elems[0])</span><span class="s3">\n                    </span><span class="s1">//生成新的table</span><span class="s3">\n                    </span><span class="s1">let newdom: string = getnode.getTableHtml(</span><span class="s3">\n                        </span><span class="s1">operatingEvent.ProcessingRow($(htmlStr), index).elems[0]</span><span class="s3">\n                    </span><span class="s1">)</span><span class="s3">\n                    </span><span class="s1">newdom = _isEmptyP($node, newdom)</span><span class="s3">\n                    </span><span class="s1">// 选中table</span><span class="s3">\n                    </span><span class="s1">editor.selection.createRangeByElem($node)</span><span class="s3">\n                    </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n\n                    </span><span class="s1">editor.cmd.do('insertHTML', newdom)</span><span class="s3">\n\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${t('删除行')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">// 禁止多选操作</span><span class="s3">\n                    </span><span class="s1">let isMore = isMoreRowAction(editor)</span><span class="s3">\n                    </span><span class="s1">if (isMore) {</span><span class="s3">\n                        </span><span class="s1">return true</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">//当前元素</span><span class="s3">\n                    </span><span class="s1">let selectDom = $(editor.selection.getSelectionStartElem())</span><span class="s3">\n                    </span><span class="s1">//当前行</span><span class="s3">\n                    </span><span class="s1">let $currentRow = getnode.getRowNode(selectDom.elems[0])</span><span class="s3">\n                    </span><span class="s1">if (!$currentRow) {</span><span class="s3">\n                        </span><span class="s1">return true</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">//获取当前行的index</span><span class="s3">\n                    </span><span class="s1">const index = Number(getnode.getCurrentRowIndex($node.elems[0], $currentRow))</span><span class="s3">\n                    </span><span class="s1">//生成要替换的html</span><span class="s3">\n                    </span><span class="s1">let htmlStr = getnode.getTableHtml($node.elems[0])</span><span class="s3">\n                    </span><span class="s1">//获取新生成的table 判断是否是最后一行被删除 是 删除整个table</span><span class="s3">\n                    </span><span class="s1">const trLength: number = operatingEvent.DeleteRow($(htmlStr), index).elems[0]</span><span class="s3">\n                        </span><span class="s1">.children[0].children.length</span><span class="s3">\n                    </span><span class="s1">//生成新的table</span><span class="s3">\n                    </span><span class="s1">let newdom: string = ''</span><span class="s3">\n                    </span><span class="s1">// 选中table</span><span class="s3">\n                    </span><span class="s1">editor.selection.createRangeByElem($node)</span><span class="s3">\n                    </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n\n                    </span><span class="s1">if (trLength === 0) {</span><span class="s3">\n                        </span><span class="s1">newdom = EMPTY_P</span><span class="s3">\n                    </span><span class="s1">} else {</span><span class="s3">\n                        </span><span class="s1">newdom = getnode.getTableHtml(</span><span class="s3">\n                            </span><span class="s1">operatingEvent.DeleteRow($(htmlStr), index).elems[0]</span><span class="s3">\n                        </span><span class="s1">)</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">newdom = _isEmptyP($node, newdom)</span><span class="s3">\n                    </span><span class="s1">editor.cmd.do('insertHTML', newdom)</span><span class="s3">\n\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${t('添加列')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">// 禁止多选操作</span><span class="s3">\n                    </span><span class="s1">let isMore = isMoreRowAction(editor)</span><span class="s3">\n                    </span><span class="s1">if (isMore) {</span><span class="s3">\n                        </span><span class="s1">return true</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">//当前元素</span><span class="s3">\n                    </span><span class="s1">let selectDom = $(editor.selection.getSelectionStartElem())</span><span class="s3">\n                    </span><span class="s1">//当前列的index</span><span class="s3">\n                    </span><span class="s1">const index = getnode.getCurrentColIndex(selectDom.elems[0])</span><span class="s3">\n                    </span><span class="s1">//生成要替换的html</span><span class="s3">\n                    </span><span class="s1">let htmlStr = getnode.getTableHtml($node.elems[0])</span><span class="s3">\n                    </span><span class="s1">//生成新的table</span><span class="s3">\n                    </span><span class="s1">let newdom: string = getnode.getTableHtml(</span><span class="s3">\n                        </span><span class="s1">operatingEvent.ProcessingCol($(htmlStr), index).elems[0]</span><span class="s3">\n                    </span><span class="s1">)</span><span class="s3">\n                    </span><span class="s1">newdom = _isEmptyP($node, newdom)</span><span class="s3">\n                    </span><span class="s1">// 选中table</span><span class="s3">\n                    </span><span class="s1">editor.selection.createRangeByElem($node)</span><span class="s3">\n                    </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n\n                    </span><span class="s1">editor.cmd.do('insertHTML', newdom)</span><span class="s3">\n\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${t('删除列')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">// 禁止多选操作</span><span class="s3">\n                    </span><span class="s1">let isMore = isMoreRowAction(editor)</span><span class="s3">\n                    </span><span class="s1">if (isMore) {</span><span class="s3">\n                        </span><span class="s1">return true</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">//当前元素</span><span class="s3">\n                    </span><span class="s1">let selectDom = $(editor.selection.getSelectionStartElem())</span><span class="s3">\n                    </span><span class="s1">//当前列的index</span><span class="s3">\n                    </span><span class="s1">const index = getnode.getCurrentColIndex(selectDom.elems[0])</span><span class="s3">\n                    </span><span class="s1">//生成要替换的html</span><span class="s3">\n                    </span><span class="s1">let htmlStr = getnode.getTableHtml($node.elems[0])</span><span class="s3">\n                    </span><span class="s1">//获取新生成的table 判断是否是最后一列被删除 是 删除整个table</span><span class="s3">\n                    </span><span class="s1">const newDom = operatingEvent.DeleteCol($(htmlStr), index)</span><span class="s3">\n                    </span><span class="s1">// 获取子节点的数量</span><span class="s3">\n                    </span><span class="s1">const tdLength: number = newDom.elems[0].children[0].children[0].children.length</span><span class="s3">\n\n                    </span><span class="s1">//生成新的table</span><span class="s3">\n                    </span><span class="s1">let newdom: string = ''</span><span class="s3">\n                    </span><span class="s1">// 选中table</span><span class="s3">\n                    </span><span class="s1">editor.selection.createRangeByElem($node)</span><span class="s3">\n                    </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n\n                    </span><span class="s1">// 如果没有列了 则替换成空行</span><span class="s3">\n                    </span><span class="s1">if (tdLength === 0) {</span><span class="s3">\n                        </span><span class="s1">newdom = EMPTY_P</span><span class="s3">\n                    </span><span class="s1">} else {</span><span class="s3">\n                        </span><span class="s1">newdom = getnode.getTableHtml(newDom.elems[0])</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">newdom = _isEmptyP($node, newdom)</span><span class="s3">\n                    </span><span class="s1">editor.cmd.do('insertHTML', newdom)</span><span class="s3">\n\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${t('设置表头')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">// 禁止多选操作</span><span class="s3">\n                    </span><span class="s1">let isMore = isMoreRowAction(editor)</span><span class="s3">\n                    </span><span class="s1">if (isMore) {</span><span class="s3">\n                        </span><span class="s1">return true</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">//当前元素</span><span class="s3">\n                    </span><span class="s1">let selectDom = $(editor.selection.getSelectionStartElem())</span><span class="s3">\n                    </span><span class="s1">//当前行</span><span class="s3">\n                    </span><span class="s1">let $currentRow = getnode.getRowNode(selectDom.elems[0])</span><span class="s3">\n                    </span><span class="s1">if (!$currentRow) {</span><span class="s3">\n                        </span><span class="s1">return true</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">//获取当前行的index</span><span class="s3">\n                    </span><span class="s1">let index = Number(getnode.getCurrentRowIndex($node.elems[0], $currentRow))</span><span class="s3">\n                    </span><span class="s1">if (index !== 0) {</span><span class="s3">\n                        </span><span class="s1">//控制在table的第一行</span><span class="s3">\n                        </span><span class="s1">index = 0</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">//生成要替换的html</span><span class="s3">\n                    </span><span class="s1">let htmlStr = getnode.getTableHtml($node.elems[0])</span><span class="s3">\n                    </span><span class="s1">//生成新的table</span><span class="s3">\n                    </span><span class="s1">let newdom: string = getnode.getTableHtml(</span><span class="s3">\n                        </span><span class="s1">operatingEvent.setTheHeader($(htmlStr), index, 'th').elems[0]</span><span class="s3">\n                    </span><span class="s1">)</span><span class="s3">\n                    </span><span class="s1">newdom = _isEmptyP($node, newdom)</span><span class="s3">\n                    </span><span class="s1">// 选中table</span><span class="s3">\n                    </span><span class="s1">editor.selection.createRangeByElem($node)</span><span class="s3">\n                    </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n\n                    </span><span class="s1">editor.cmd.do('insertHTML', newdom)</span><span class="s3">\n\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${t('取消表头')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $node: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">//当前元素</span><span class="s3">\n                    </span><span class="s1">let selectDom = $(editor.selection.getSelectionStartElem())</span><span class="s3">\n                    </span><span class="s1">//当前行</span><span class="s3">\n                    </span><span class="s1">let $currentRow = getnode.getRowNode(selectDom.elems[0])</span><span class="s3">\n                    </span><span class="s1">if (!$currentRow) {</span><span class="s3">\n                        </span><span class="s1">return true</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">//获取当前行的index</span><span class="s3">\n                    </span><span class="s1">let index = Number(getnode.getCurrentRowIndex($node.elems[0], $currentRow))</span><span class="s3">\n                    </span><span class="s1">if (index !== 0) {</span><span class="s3">\n                        </span><span class="s1">//控制在table的第一行</span><span class="s3">\n                        </span><span class="s1">index = 0</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                    </span><span class="s1">//生成要替换的html</span><span class="s3">\n                    </span><span class="s1">let htmlStr = getnode.getTableHtml($node.elems[0])</span><span class="s3">\n                    </span><span class="s1">//生成新的table</span><span class="s3">\n                    </span><span class="s1">let newdom: string = getnode.getTableHtml(</span><span class="s3">\n                        </span><span class="s1">operatingEvent.setTheHeader($(htmlStr), index, 'td').elems[0]</span><span class="s3">\n                    </span><span class="s1">)</span><span class="s3">\n                    </span><span class="s1">newdom = _isEmptyP($node, newdom)</span><span class="s3">\n                    </span><span class="s1">// 选中table</span><span class="s3">\n                    </span><span class="s1">editor.selection.createRangeByElem($node)</span><span class="s3">\n                    </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n\n                    </span><span class="s1">editor.cmd.do('insertHTML', newdom)</span><span class="s3">\n\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">]</span><span class="s3">\n\n        </span><span class="s1">tooltip = new Tooltip(editor, $node, conf)</span><span class="s3">\n        </span><span class="s1">tooltip.create()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 隐藏 tooltip</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function hideTableTooltip() {</span><span class="s3">\n        </span><span class="s1">// 移除 tooltip</span><span class="s3">\n        </span><span class="s1">if (tooltip) {</span><span class="s3">\n            </span><span class="s1">tooltip.remove()</span><span class="s3">\n            </span><span class="s1">tooltip = null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return {</span><span class="s3">\n        </span><span class="s1">showTableTooltip,</span><span class="s3">\n        </span><span class="s1">hideTableTooltip,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 判断是否是多行</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function isMoreRowAction(editor: Editor): boolean {</span><span class="s3">\n    </span><span class="s1">const $startElem = editor.selection.getSelectionStartElem()</span><span class="s3">\n    </span><span class="s1">const $endElem = editor.selection.getSelectionEndElem()</span><span class="s3">\n    </span><span class="s1">if ($startElem?.elems[0] !== $endElem?.elems[0]) {</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定 tooltip 事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default function bindTooltipEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const { showTableTooltip, hideTableTooltip } = createShowHideFn(editor)</span><span class="s3">\n\n    </span><span class="s1">// 点击table元素是，显示 tooltip</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.tableClickEvents.push(showTableTooltip)</span><span class="s3">\n\n    </span><span class="s1">// 点击其他地方，或者滚动时，隐藏 tooltip</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.clickEvents.push(hideTableTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.keyupEvents.push(hideTableTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.toolbarClickEvents.push(hideTableTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.menuClickEvents.push(hideTableTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.textScrollEvents.push(hideTableTooltip)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 判断表格的下一个节点是否是空行</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function _isEmptyP($node: DomElement, newdom: string): string {</span><span class="s3">\n    </span><span class="s1">// 当表格的下一个兄弟节点是空行时，在 newdom 后添加 EMPTY_P</span><span class="s3">\n    </span><span class="s1">let nextNode = $node.elems[0].nextSibling as HTMLElement</span><span class="s3">\n    </span><span class="s1">if (!nextNode || nextNode.innerHTML === '&lt;br&gt;') {</span><span class="s3">\n        </span><span class="s1">newdom += `${EMPTY_P}`</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return newdom</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import $, { DomElement } from '../../../../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 处理新添加行</span><span class="s3">\n </span><span class="s1">* @param $node 整个table</span><span class="s3">\n </span><span class="s1">* @param _index 行的inde</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function ProcessingRow($node: DomElement, _index: number): DomElement {</span><span class="s3">\n    </span><span class="s1">//执行获取tbody节点</span><span class="s3">\n    </span><span class="s1">let $dom = generateDomAction($node)</span><span class="s3">\n    </span><span class="s1">//取出所有的行</span><span class="s3">\n    </span><span class="s1">let domArray: HTMLElement[] = Array.prototype.slice.apply($dom.children)</span><span class="s3">\n    </span><span class="s1">//列的数量</span><span class="s3">\n    </span><span class="s1">const childrenLength = domArray[0].children.length</span><span class="s3">\n    </span><span class="s1">//创建新tr</span><span class="s3">\n    </span><span class="s1">let tr = document.createElement('tr')</span><span class="s3">\n    </span><span class="s1">for (let i = 0; i &lt; childrenLength; i++) {</span><span class="s3">\n        </span><span class="s1">const td = document.createElement('td')</span><span class="s3">\n        </span><span class="s1">tr.appendChild(td)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">//插入集合中</span><span class="s3">\n    </span><span class="s1">domArray.splice(_index + 1, 0, tr)</span><span class="s3">\n    </span><span class="s1">//移除、新增节点事件</span><span class="s3">\n    </span><span class="s1">removeAndInsertAction($dom, domArray)</span><span class="s3">\n    </span><span class="s1">return $($dom.parentNode)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 处理新添加列</span><span class="s3">\n </span><span class="s1">* @param $node 整个table</span><span class="s3">\n </span><span class="s1">* @param _index 列的inde</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function ProcessingCol($node: DomElement, _index: number): DomElement {</span><span class="s3">\n    </span><span class="s1">//执行获取tbody节点</span><span class="s3">\n    </span><span class="s1">let $dom = generateDomAction($node)</span><span class="s3">\n    </span><span class="s1">//取出所有的行</span><span class="s3">\n    </span><span class="s1">let domArray: HTMLElement[] = Array.prototype.slice.apply($dom.children)</span><span class="s3">\n    </span><span class="s1">//创建td</span><span class="s3">\n    </span><span class="s1">for (let i = 0; i &lt; domArray.length; i++) {</span><span class="s3">\n        </span><span class="s1">let cArray: Node[] = []</span><span class="s3">\n        </span><span class="s1">//取出所有的列</span><span class="s3">\n        </span><span class="s1">Array.from(domArray[i].children).forEach(item =&gt; {</span><span class="s3">\n            </span><span class="s1">cArray.push(item)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">//移除行的旧的子节点</span><span class="s3">\n        </span><span class="s1">while (domArray[i].children.length !== 0) {</span><span class="s3">\n            </span><span class="s1">domArray[i].removeChild(domArray[i].children[0])</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">//列分th td</span><span class="s3">\n        </span><span class="s1">let td =</span><span class="s3">\n            </span><span class="s1">$(cArray[0]).getNodeName() !== 'TH'</span><span class="s3">\n                </span><span class="s1">? document.createElement('td')</span><span class="s3">\n                </span><span class="s1">: document.createElement('th')</span><span class="s3">\n        </span><span class="s1">// let td = document.createElement('td')</span><span class="s3">\n        </span><span class="s1">cArray.splice(_index + 1, 0, td)</span><span class="s3">\n        </span><span class="s1">//插入新的子节点</span><span class="s3">\n        </span><span class="s1">for (let j = 0; j &lt; cArray.length; j++) {</span><span class="s3">\n            </span><span class="s1">domArray[i].appendChild(cArray[j])</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">//移除、新增节点事件</span><span class="s3">\n    </span><span class="s1">removeAndInsertAction($dom, domArray)</span><span class="s3">\n    </span><span class="s1">return $($dom.parentNode)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 处理删除行</span><span class="s3">\n </span><span class="s1">* @param $node  整个table</span><span class="s3">\n </span><span class="s1">* @param _index  行的inde</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function DeleteRow($node: DomElement, _index: number): DomElement {</span><span class="s3">\n    </span><span class="s1">//执行获取tbody节点</span><span class="s3">\n    </span><span class="s1">let $dom = generateDomAction($node)</span><span class="s3">\n    </span><span class="s1">//取出所有的行</span><span class="s3">\n    </span><span class="s1">let domArray: HTMLElement[] = Array.prototype.slice.apply($dom.children)</span><span class="s3">\n    </span><span class="s1">//删除行</span><span class="s3">\n    </span><span class="s1">domArray.splice(_index, 1)</span><span class="s3">\n    </span><span class="s1">//移除、新增节点事件</span><span class="s3">\n    </span><span class="s1">removeAndInsertAction($dom, domArray)</span><span class="s3">\n    </span><span class="s1">return $($dom.parentNode)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 处理删除列</span><span class="s3">\n </span><span class="s1">* @param $node</span><span class="s3">\n </span><span class="s1">* @param _index</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function DeleteCol($node: DomElement, _index: number): DomElement {</span><span class="s3">\n    </span><span class="s1">//执行获取tbody节点</span><span class="s3">\n    </span><span class="s1">let $dom = generateDomAction($node)</span><span class="s3">\n    </span><span class="s1">//取出所有的行</span><span class="s3">\n    </span><span class="s1">let domArray: HTMLElement[] = Array.prototype.slice.apply($dom.children)</span><span class="s3">\n    </span><span class="s1">//创建td</span><span class="s3">\n    </span><span class="s1">for (let i = 0; i &lt; domArray.length; i++) {</span><span class="s3">\n        </span><span class="s1">let cArray: Node[] = []</span><span class="s3">\n        </span><span class="s1">//取出所有的列</span><span class="s3">\n        </span><span class="s1">Array.from(domArray[i].children).forEach(item =&gt; {</span><span class="s3">\n            </span><span class="s1">cArray.push(item)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">//移除行的旧的子节点</span><span class="s3">\n        </span><span class="s1">while (domArray[i].children.length !== 0) {</span><span class="s3">\n            </span><span class="s1">domArray[i].removeChild(domArray[i].children[0])</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">cArray.splice(_index, 1)</span><span class="s3">\n        </span><span class="s1">//插入新的子节点</span><span class="s3">\n        </span><span class="s1">for (let j = 0; j &lt; cArray.length; j++) {</span><span class="s3">\n            </span><span class="s1">domArray[i].appendChild(cArray[j])</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">//移除、新增节点事件</span><span class="s3">\n    </span><span class="s1">removeAndInsertAction($dom, domArray)</span><span class="s3">\n    </span><span class="s1">return $($dom.parentNode)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 处理设置/取消表头</span><span class="s3">\n </span><span class="s1">* @param $node</span><span class="s3">\n </span><span class="s1">* @param _index</span><span class="s3">\n </span><span class="s1">* @type 替换的标签 th还是td</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function setTheHeader($node: DomElement, _index: number, type: string): DomElement {</span><span class="s3">\n    </span><span class="s1">// 执行获取tbody节点</span><span class="s3">\n    </span><span class="s1">let $dom = generateDomAction($node)</span><span class="s3">\n    </span><span class="s1">// 取出所有的行</span><span class="s3">\n    </span><span class="s1">let domArray: HTMLElement[] = Array.prototype.slice.apply($dom.children)</span><span class="s3">\n    </span><span class="s1">// 列的数量</span><span class="s3">\n    </span><span class="s1">const cols = domArray[_index].children</span><span class="s3">\n    </span><span class="s1">// 创建新tr</span><span class="s3">\n    </span><span class="s1">let tr = document.createElement('tr')</span><span class="s3">\n    </span><span class="s1">for (let i = 0; i &lt; cols.length; i++) {</span><span class="s3">\n        </span><span class="s1">// 根据type(td 或者 th)生成对应的el</span><span class="s3">\n        </span><span class="s1">const el = document.createElement(type)</span><span class="s3">\n        </span><span class="s1">const col = cols[i]</span><span class="s3">\n        </span><span class="s1">/**</span><span class="s3">\n         </span><span class="s1">* 没有使用children是因为谷歌纯文本内容children数组就为空，而火狐纯文本内容是“xxx&lt;br&gt;”使用children只能获取br</span><span class="s3">\n         </span><span class="s1">* 当然使用childNodes也涵盖支持我们表头使用表情，代码块等，不管是设置还是取消都会保留第一行</span><span class="s3">\n         </span><span class="s1">*/</span><span class="s3">\n        </span><span class="s1">Array.from(col.childNodes).forEach(item =&gt; {</span><span class="s3">\n            </span><span class="s1">el.appendChild(item)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">tr.appendChild(el)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">//插入集合中</span><span class="s3">\n    </span><span class="s1">domArray.splice(_index, 1, tr)</span><span class="s3">\n    </span><span class="s1">//移除、新增节点事件</span><span class="s3">\n    </span><span class="s1">removeAndInsertAction($dom, domArray)</span><span class="s3">\n    </span><span class="s1">return $($dom.parentNode)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 封装移除、新增节点事件</span><span class="s3">\n </span><span class="s1">* @param $dom tbody节点</span><span class="s3">\n </span><span class="s1">* @param domArray  所有的行</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function removeAndInsertAction($dom: Element, domArray: Node[]) {</span><span class="s3">\n    </span><span class="s1">//移除所有的旧的子节点</span><span class="s3">\n    </span><span class="s1">while ($dom.children.length !== 0) {</span><span class="s3">\n        </span><span class="s1">$dom.removeChild($dom.children[0])</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">//插入新的子节点</span><span class="s3">\n    </span><span class="s1">for (let i = 0; i &lt; domArray.length; i++) {</span><span class="s3">\n        </span><span class="s1">$dom.appendChild(domArray[i])</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 封装判断是否tbody节点</span><span class="s3">\n </span><span class="s1">* 粘贴的table 第一个节点是&lt;colgroup&gt; 最后的节点&lt;tbody&gt;</span><span class="s3">\n </span><span class="s1">* @param dom</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function generateDomAction($node: DomElement) {</span><span class="s3">\n    </span><span class="s1">let $dom = $node.elems[0].children[0]</span><span class="s3">\n    </span><span class="s1">if ($dom.nodeName === 'COLGROUP') {</span><span class="s3">\n        </span><span class="s1">$dom = $node.elems[0].children[$node.elems[0].children.length - 1]</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return $dom</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default {</span><span class="s3">\n    </span><span class="s1">ProcessingRow,</span><span class="s3">\n    </span><span class="s1">ProcessingCol,</span><span class="s3">\n    </span><span class="s1">DeleteRow,</span><span class="s3">\n    </span><span class="s1">DeleteCol,</span><span class="s3">\n    </span><span class="s1">setTheHeader,</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/array/from');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../modules/es.string.iterator');</span><span class="s3">\n</span><span class="s1">require('../../modules/es.array.from');</span><span class="s3">\n</span><span class="s1">var path = require('../../internals/path');</span><span class="s3">\n\n</span><span class="s1">module.exports = path.Array.from;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var from = require('../internals/array-from');</span><span class="s3">\n</span><span class="s1">var checkCorrectnessOfIteration = require('../internals/check-correctness-of-iteration');</span><span class="s3">\n\n</span><span class="s1">var INCORRECT_ITERATION = !checkCorrectnessOfIteration(function (iterable) {</span><span class="s3">\n  </span><span class="s1">Array.from(iterable);</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n\n</span><span class="s1">// `Array.from` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.from</span><span class="s3">\n</span><span class="s1">$({ target: 'Array', stat: true, forced: INCORRECT_ITERATION }, {</span><span class="s3">\n  </span><span class="s1">from: from</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var bind = require('../internals/function-bind-context');</span><span class="s3">\n</span><span class="s1">var toObject = require('../internals/to-object');</span><span class="s3">\n</span><span class="s1">var callWithSafeIterationClosing = require('../internals/call-with-safe-iteration-closing');</span><span class="s3">\n</span><span class="s1">var isArrayIteratorMethod = require('../internals/is-array-iterator-method');</span><span class="s3">\n</span><span class="s1">var toLength = require('../internals/to-length');</span><span class="s3">\n</span><span class="s1">var createProperty = require('../internals/create-property');</span><span class="s3">\n</span><span class="s1">var getIteratorMethod = require('../internals/get-iterator-method');</span><span class="s3">\n\n</span><span class="s1">// `Array.from` method implementation</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.from</span><span class="s3">\n</span><span class="s1">module.exports = function from(arrayLike /* , mapfn = undefined, thisArg = undefined */) {</span><span class="s3">\n  </span><span class="s1">var O = toObject(arrayLike);</span><span class="s3">\n  </span><span class="s1">var C = typeof this == 'function' ? this : Array;</span><span class="s3">\n  </span><span class="s1">var argumentsLength = arguments.length;</span><span class="s3">\n  </span><span class="s1">var mapfn = argumentsLength &gt; 1 ? arguments[1] : undefined;</span><span class="s3">\n  </span><span class="s1">var mapping = mapfn !== undefined;</span><span class="s3">\n  </span><span class="s1">var iteratorMethod = getIteratorMethod(O);</span><span class="s3">\n  </span><span class="s1">var index = 0;</span><span class="s3">\n  </span><span class="s1">var length, result, step, iterator, next, value;</span><span class="s3">\n  </span><span class="s1">if (mapping) mapfn = bind(mapfn, argumentsLength &gt; 2 ? arguments[2] : undefined, 2);</span><span class="s3">\n  </span><span class="s1">// if the target is not iterable or it's an array with the default iterator - use a simple case</span><span class="s3">\n  </span><span class="s1">if (iteratorMethod != undefined &amp;&amp; !(C == Array &amp;&amp; isArrayIteratorMethod(iteratorMethod))) {</span><span class="s3">\n    </span><span class="s1">iterator = iteratorMethod.call(O);</span><span class="s3">\n    </span><span class="s1">next = iterator.next;</span><span class="s3">\n    </span><span class="s1">result = new C();</span><span class="s3">\n    </span><span class="s1">for (;!(step = next.call(iterator)).done; index++) {</span><span class="s3">\n      </span><span class="s1">value = mapping ? callWithSafeIterationClosing(iterator, mapfn, [step.value, index], true) : step.value;</span><span class="s3">\n      </span><span class="s1">createProperty(result, index, value);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">length = toLength(O.length);</span><span class="s3">\n    </span><span class="s1">result = new C(length);</span><span class="s3">\n    </span><span class="s1">for (;length &gt; index; index++) {</span><span class="s3">\n      </span><span class="s1">value = mapping ? mapfn(O[index], index) : O[index];</span><span class="s3">\n      </span><span class="s1">createProperty(result, index, value);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">result.length = index;</span><span class="s3">\n  </span><span class="s1">return result;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 获取dom节点</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $ from '../../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../../../editor/index'</span><span class="s3">\n\n</span><span class="s1">class getNode {</span><span class="s3">\n    </span><span class="s1">public editor: Editor</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">this.editor = editor</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取焦点所在行</span><span class="s3">\n     </span><span class="s1">* @param $node 当前table</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public getRowNode($node: HTMLElement): HTMLElement | null | undefined {</span><span class="s3">\n        </span><span class="s1">let DOM: HTMLElement | null | undefined = $($node).elems[0]</span><span class="s3">\n        </span><span class="s1">if (!DOM.parentNode) {</span><span class="s3">\n            </span><span class="s1">return DOM</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">DOM = $(DOM).parentUntil('TR', DOM)?.elems[0]</span><span class="s3">\n        </span><span class="s1">return DOM</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取当前行的下标</span><span class="s3">\n     </span><span class="s1">* @param $node 当前table</span><span class="s3">\n     </span><span class="s1">* @param $dmo 当前行节点</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public getCurrentRowIndex($node: HTMLElement, $dom: HTMLElement): Number {</span><span class="s3">\n        </span><span class="s1">let _index: number = 0</span><span class="s3">\n        </span><span class="s1">let $nodeChild = $node.children[0]</span><span class="s3">\n        </span><span class="s1">//粘贴的table 最后一个节点才是tbody</span><span class="s3">\n        </span><span class="s1">if ($nodeChild.nodeName === 'COLGROUP') {</span><span class="s3">\n            </span><span class="s1">$nodeChild = $node.children[$node.children.length - 1]</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">Array.from($nodeChild.children).forEach((item, index) =&gt; {</span><span class="s3">\n            </span><span class="s1">item === $dom ? (_index = index) : ''</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">return _index</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取当前列的下标</span><span class="s3">\n     </span><span class="s1">* @param $node 当前点击元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public getCurrentColIndex($node: HTMLElement): number {</span><span class="s3">\n        </span><span class="s1">//当前行</span><span class="s3">\n        </span><span class="s1">let _index: number = 0</span><span class="s3">\n        </span><span class="s1">//获取当前列 td或th</span><span class="s3">\n        </span><span class="s1">let rowDom =</span><span class="s3">\n            </span><span class="s1">$($node).getNodeName() === 'TD' || $($node).getNodeName() === 'TH'</span><span class="s3">\n                </span><span class="s1">? $node</span><span class="s3">\n                </span><span class="s1">: $($node).parentUntil('TD', $node)?.elems[0]</span><span class="s3">\n        </span><span class="s1">let colDom = $(rowDom).parent()</span><span class="s3">\n        </span><span class="s1">Array.from(colDom.elems[0].children).forEach((item, index) =&gt; {</span><span class="s3">\n            </span><span class="s1">item === rowDom ? (_index = index) : ''</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">return _index</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 返回元素html字符串</span><span class="s3">\n     </span><span class="s1">* @param $node</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public getTableHtml($node: HTMLElement): string {</span><span class="s3">\n        </span><span class="s1">const htmlStr = `&lt;table border=</span><span class="s3">\&quot;</span><span class="s1">0</span><span class="s3">\&quot; </span><span class="s1">width=</span><span class="s3">\&quot;</span><span class="s1">100%</span><span class="s3">\&quot; </span><span class="s1">cellpadding=</span><span class="s3">\&quot;</span><span class="s1">0</span><span class="s3">\&quot; </span><span class="s1">cellspacing=</span><span class="s3">\&quot;</span><span class="s1">0</span><span class="s3">\&quot;</span><span class="s1">&gt;${$(</span><span class="s3">\n            </span><span class="s1">$node</span><span class="s3">\n        </span><span class="s1">).html()}&lt;/table&gt;`</span><span class="s3">\n        </span><span class="s1">return htmlStr</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default getNode</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 保证table后面始终有dom</span><span class="s3">\n </span><span class="s1">* @author yanbiao(86driver)</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* @description 是否是空行</span><span class="s3">\n </span><span class="s1">* @param topElem</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function isEmptyLine(topElem: DomElement): boolean {</span><span class="s3">\n    </span><span class="s1">if (!topElem.length) {</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const dom = topElem.elems[0]</span><span class="s3">\n\n    </span><span class="s1">return dom.nodeName === 'P' &amp;&amp; dom.innerHTML === '&lt;br&gt;'</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">export function bindClickEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">function handleTripleClick($dom: DomElement, e: MouseEvent) {</span><span class="s3">\n        </span><span class="s1">// 处理三击事件，此时选区可能离开table，修正回来</span><span class="s3">\n        </span><span class="s1">if (e.detail &gt;= 3) {</span><span class="s3">\n            </span><span class="s1">const selection = window.getSelection()</span><span class="s3">\n            </span><span class="s1">if (selection) {</span><span class="s3">\n                </span><span class="s1">const { focusNode, anchorNode } = selection</span><span class="s3">\n                </span><span class="s1">const $anchorNode = $(anchorNode?.parentElement)</span><span class="s3">\n                </span><span class="s1">// 当focusNode离开了table</span><span class="s3">\n                </span><span class="s1">if (!$dom.isContain($(focusNode))) {</span><span class="s3">\n                    </span><span class="s1">const $td =</span><span class="s3">\n                        </span><span class="s1">$anchorNode.elems[0].tagName === 'TD'</span><span class="s3">\n                            </span><span class="s1">? $anchorNode</span><span class="s3">\n                            </span><span class="s1">: $anchorNode.parentUntilEditor('td', editor)</span><span class="s3">\n                    </span><span class="s1">if ($td) {</span><span class="s3">\n                        </span><span class="s1">const range = editor.selection.getRange()</span><span class="s3">\n                        </span><span class="s1">range?.setEnd($td.elems[0], $td.elems[0].childNodes.length)</span><span class="s3">\n                        </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">editor.txt.eventHooks.tableClickEvents.push(handleTripleClick)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function bindEventKeyboardEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const { txt, selection } = editor</span><span class="s3">\n    </span><span class="s1">const { keydownEvents } = txt.eventHooks</span><span class="s3">\n\n    </span><span class="s1">keydownEvents.push(function (e) {</span><span class="s3">\n        </span><span class="s1">// 实时保存选区</span><span class="s3">\n        </span><span class="s1">editor.selection.saveRange()</span><span class="s3">\n        </span><span class="s1">const $selectionContainerElem = selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">if ($selectionContainerElem) {</span><span class="s3">\n            </span><span class="s1">const $topElem = $selectionContainerElem.getNodeTop(editor)</span><span class="s3">\n            </span><span class="s1">const $preElem = $topElem.length</span><span class="s3">\n                </span><span class="s1">? $topElem.prev().length</span><span class="s3">\n                    </span><span class="s1">? $topElem.prev()</span><span class="s3">\n                    </span><span class="s1">: null</span><span class="s3">\n                </span><span class="s1">: null</span><span class="s3">\n\n            </span><span class="s1">// 删除时，选区前面是table，且选区没有选中文本，阻止默认行为</span><span class="s3">\n            </span><span class="s1">if (</span><span class="s3">\n                </span><span class="s1">$preElem &amp;&amp;</span><span class="s3">\n                </span><span class="s1">$preElem.getNodeName() === 'TABLE' &amp;&amp;</span><span class="s3">\n                </span><span class="s1">selection.isSelectionEmpty() &amp;&amp;</span><span class="s3">\n                </span><span class="s1">selection.getCursorPos() === 0 &amp;&amp;</span><span class="s3">\n                </span><span class="s1">e.keyCode === 8</span><span class="s3">\n            </span><span class="s1">) {</span><span class="s3">\n                </span><span class="s1">const $nextElem = $topElem.next()</span><span class="s3">\n                </span><span class="s1">const hasNext = !!$nextElem.length</span><span class="s3">\n\n                </span><span class="s1">/**</span><span class="s3">\n                 </span><span class="s1">* 如果当前是空行，并且当前行下面还有内容，删除当前行</span><span class="s3">\n                 </span><span class="s1">* 浏览器默认行为不会删除掉当前行的&lt;br&gt;标签</span><span class="s3">\n                 </span><span class="s1">* 因此阻止默认行为，特殊处理</span><span class="s3">\n                 </span><span class="s1">*/</span><span class="s3">\n                </span><span class="s1">if (hasNext &amp;&amp; isEmptyLine($topElem)) {</span><span class="s3">\n                    </span><span class="s1">$topElem.remove()</span><span class="s3">\n                    </span><span class="s1">editor.selection.setRangeToElem($nextElem.elems[0])</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">e.preventDefault()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 代码 菜单</span><span class="s3">\n </span><span class="s1">* @author lkw</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import PanelMenu from '../menu-constructors/PanelMenu'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { replaceSpecialSymbol, deepClone } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import createPanelConf from './create-panel-conf'</span><span class="s3">\n</span><span class="s1">import isActive from './is-active'</span><span class="s3">\n</span><span class="s1">import Panel from '../menu-constructors/Panel'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import bindEvent from './bind-event/index'</span><span class="s3">\n\n</span><span class="s1">export function formatCodeHtml(editor: Editor, html: string) {</span><span class="s3">\n    </span><span class="s1">if (!html) return html</span><span class="s3">\n\n    </span><span class="s1">html = deleteHighlightCode(html)</span><span class="s3">\n\n    </span><span class="s1">html = formatEnterCode(html)</span><span class="s3">\n\n    </span><span class="s1">html = replaceSpecialSymbol(html)</span><span class="s3">\n\n    </span><span class="s1">return html</span><span class="s3">\n\n    </span><span class="s1">// 格式化换换所产生的code标签</span><span class="s3">\n    </span><span class="s1">function formatEnterCode(html: string): string {</span><span class="s3">\n        </span><span class="s1">let preArr = html.match(/&lt;pre[</span><span class="s3">\\</span><span class="s1">s|</span><span class="s3">\\</span><span class="s1">S]+?</span><span class="s3">\\</span><span class="s1">/pre&gt;/g)</span><span class="s3">\n\n        </span><span class="s1">if (preArr === null) return html</span><span class="s3">\n\n        </span><span class="s1">preArr.map(item =&gt; {</span><span class="s3">\n            </span><span class="s1">//将连续的code标签换为</span><span class="s3">\\</span><span class="s1">n换行</span><span class="s3">\n            </span><span class="s1">html = html.replace(item, item.replace(/&lt;</span><span class="s3">\\</span><span class="s1">/code&gt;&lt;code&gt;/g, '</span><span class="s3">\\</span><span class="s1">n').replace(/&lt;br&gt;/g, ''))</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">return html</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// highlight格式化方法</span><span class="s3">\n    </span><span class="s1">function deleteHighlightCode(html: string): string {</span><span class="s3">\n        </span><span class="s1">// 获取所有hljs文本</span><span class="s3">\n        </span><span class="s1">let m = html.match(/&lt;span</span><span class="s3">\\</span><span class="s1">sclass=</span><span class="s3">\&quot;</span><span class="s1">hljs[</span><span class="s3">\\</span><span class="s1">s|</span><span class="s3">\\</span><span class="s1">S]+?</span><span class="s3">\\</span><span class="s1">/span&gt;/gm)</span><span class="s3">\n\n        </span><span class="s1">// 没有代码渲染文本则退出</span><span class="s3">\n        </span><span class="s1">// @ts-ignore</span><span class="s3">\n        </span><span class="s1">if (!m || !m.length) return html</span><span class="s3">\n\n        </span><span class="s1">// 获取替换文本</span><span class="s3">\n        </span><span class="s1">let r = deepClone(m).map((i: string) =&gt; {</span><span class="s3">\n            </span><span class="s1">i = i.replace(/&lt;span</span><span class="s3">\\</span><span class="s1">sclass=</span><span class="s3">\&quot;</span><span class="s1">hljs[^&gt;]+&gt;/, '')</span><span class="s3">\n            </span><span class="s1">return i.replace(/&lt;</span><span class="s3">\\</span><span class="s1">/span&gt;/, '')</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// @ts-ignore</span><span class="s3">\n        </span><span class="s1">for (let i = 0; i &lt; m.length; i++) {</span><span class="s3">\n            </span><span class="s1">html = html.replace(m[i], r[i])</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">return deleteHighlightCode(html)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">class Code extends PanelMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">'&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">代码</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-terminal</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;&lt;/div&gt;'</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n\n        </span><span class="s1">// 绑定事件，如点击链接时，可以查看链接</span><span class="s3">\n        </span><span class="s1">bindEvent(editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 插入行内代码</span><span class="s3">\n     </span><span class="s1">* @param text</span><span class="s3">\n     </span><span class="s1">* @return null</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private insertLineCode(text: string) {</span><span class="s3">\n        </span><span class="s1">let editor = this.editor</span><span class="s3">\n        </span><span class="s1">// 行内代码处理</span><span class="s3">\n        </span><span class="s1">let $code = $(`&lt;code&gt;${text}&lt;/code&gt;`)</span><span class="s3">\n        </span><span class="s1">editor.cmd.do('insertElem', $code)</span><span class="s3">\n        </span><span class="s1">editor.selection.createRangeByElem($code, false)</span><span class="s3">\n        </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 菜单点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const selectionText = editor.selection.getSelectionText()</span><span class="s3">\n\n        </span><span class="s1">if (this.isActive) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 菜单未被激活，说明选区不在链接里</span><span class="s3">\n            </span><span class="s1">if (editor.selection.isSelectionEmpty()) {</span><span class="s3">\n                </span><span class="s1">// 选区是空的，未选中内容</span><span class="s3">\n                </span><span class="s1">this.createPanel('', '')</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">// 行内代码处理 选中了非代码内容</span><span class="s3">\n                </span><span class="s1">this.insertLineCode(selectionText)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 创建 panel</span><span class="s3">\n     </span><span class="s1">* @param text 代码文本</span><span class="s3">\n     </span><span class="s1">* @param languageType 代码类型</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public createPanel(text: string, languageType: string): void {</span><span class="s3">\n        </span><span class="s1">const conf = createPanelConf(this.editor, text, languageType)</span><span class="s3">\n        </span><span class="s1">const panel = new Panel(this, conf)</span><span class="s3">\n        </span><span class="s1">panel.create()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单 active 状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive() {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">if (isActive(editor)) {</span><span class="s3">\n            </span><span class="s1">this.active()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">this.unActive()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Code</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description code 菜单 panel tab 配置</span><span class="s3">\n </span><span class="s1">* @author lkw</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { PanelConf } from '../menu-constructors/Panel'</span><span class="s3">\n</span><span class="s1">import { getRandom } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import isActive from './is-active'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../../utils/const'</span><span class="s3">\n\n</span><span class="s1">export default function (editor: Editor, text: string, languageType: string): PanelConf {</span><span class="s3">\n    </span><span class="s1">// panel 中需要用到的id</span><span class="s3">\n    </span><span class="s1">const inputIFrameId = getRandom('input-iframe')</span><span class="s3">\n    </span><span class="s1">const languageId = getRandom('select')</span><span class="s3">\n    </span><span class="s1">const btnOkId = getRandom('btn-ok')</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 插入代码块</span><span class="s3">\n     </span><span class="s1">* @param text 文字</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function insertCode(languateType: string, code: string): void {</span><span class="s3">\n        </span><span class="s1">// 选区处于链接中，则选中整个菜单，再执行 insertHTML</span><span class="s3">\n        </span><span class="s1">let active = isActive(editor)</span><span class="s3">\n\n        </span><span class="s1">if (active) {</span><span class="s3">\n            </span><span class="s1">selectCodeElem()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const content = editor.selection.getSelectionStartElem()?.elems[0].innerHTML</span><span class="s3">\n\n        </span><span class="s1">if (content) {</span><span class="s3">\n            </span><span class="s1">editor.cmd.do('insertHTML', EMPTY_P)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// 过滤标签，防止xss</span><span class="s3">\n        </span><span class="s1">let formatCode = code.replace(/&lt;/g, '&amp;lt;').replace(/&gt;/g, '&amp;gt;')</span><span class="s3">\n\n        </span><span class="s1">// 高亮渲染</span><span class="s3">\n        </span><span class="s1">if (editor.highlight) {</span><span class="s3">\n            </span><span class="s1">formatCode = editor.highlight.highlightAuto(formatCode).value</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">//增加pre标签</span><span class="s3">\n        </span><span class="s1">editor.cmd.do('insertHTML', `&lt;pre&gt;&lt;code class=</span><span class="s3">\&quot;</span><span class="s1">${languateType}</span><span class="s3">\&quot;</span><span class="s1">&gt;${formatCode}&lt;/code&gt;&lt;/pre&gt;`)</span><span class="s3">\n\n        </span><span class="s1">const $code = editor.selection.getSelectionStartElem()</span><span class="s3">\n        </span><span class="s1">const $codeElem = $code?.getNodeTop(editor)</span><span class="s3">\n\n        </span><span class="s1">// 通过dom操作添加换行标签</span><span class="s3">\n        </span><span class="s1">if ($codeElem?.getNextSibling().elems.length === 0) {</span><span class="s3">\n            </span><span class="s1">// @ts-ignore</span><span class="s3">\n            </span><span class="s1">$(EMPTY_P).insertAfter($codeElem)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 选中整个链接元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function selectCodeElem(): void {</span><span class="s3">\n        </span><span class="s1">if (!isActive(editor)) return</span><span class="s3">\n\n        </span><span class="s1">// eslint-disable-next-line @typescript-eslint/no-unused-vars</span><span class="s3">\n        </span><span class="s1">let $selectedCode: DomElement</span><span class="s3">\n\n        </span><span class="s1">const $code = editor.selection.getSelectionStartElem()</span><span class="s3">\n        </span><span class="s1">const $codeElem = $code?.getNodeTop(editor)</span><span class="s3">\n        </span><span class="s1">if (!$codeElem) return</span><span class="s3">\n\n        </span><span class="s1">editor.selection.createRangeByElem($codeElem)</span><span class="s3">\n        </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n\n        </span><span class="s1">$selectedCode = $codeElem // 赋值给函数内全局变量</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const t = (text: string): string =&gt; {</span><span class="s3">\n        </span><span class="s1">return editor.i18next.t(text)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// @ts-ignore</span><span class="s3">\n    </span><span class="s1">const conf = {</span><span class="s3">\n        </span><span class="s1">width: 500,</span><span class="s3">\n        </span><span class="s1">height: 0,</span><span class="s3">\n\n        </span><span class="s1">// panel 中可包含多个 tab</span><span class="s3">\n        </span><span class="s1">tabs: [</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">// tab 的标题</span><span class="s3">\n                </span><span class="s1">title: t('menus.panelMenus.code.插入代码'),</span><span class="s3">\n                </span><span class="s1">// 模板</span><span class="s3">\n                </span><span class="s1">tpl: `&lt;div&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;select name=</span><span class="s3">\&quot;\&quot; </span><span class="s1">id=</span><span class="s3">\&quot;</span><span class="s1">${languageId}</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                            </span><span class="s1">${editor.config.languageType.map(language =&gt; {</span><span class="s3">\n                                </span><span class="s1">return (</span><span class="s3">\n                                    </span><span class="s1">'&lt;option ' +</span><span class="s3">\n                                    </span><span class="s1">(languageType == language ? 'selected' : '') +</span><span class="s3">\n                                    </span><span class="s1">' value =</span><span class="s3">\&quot;</span><span class="s1">' +</span><span class="s3">\n                                    </span><span class="s1">language +</span><span class="s3">\n                                    </span><span class="s1">'</span><span class="s3">\&quot;</span><span class="s1">&gt;' +</span><span class="s3">\n                                    </span><span class="s1">language +</span><span class="s3">\n                                    </span><span class="s1">'&lt;/option&gt;'</span><span class="s3">\n                                </span><span class="s1">)</span><span class="s3">\n                            </span><span class="s1">})}</span><span class="s3">\n                        </span><span class="s1">&lt;/select&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;textarea id=</span><span class="s3">\&quot;</span><span class="s1">${inputIFrameId}</span><span class="s3">\&quot; </span><span class="s1">type=</span><span class="s3">\&quot;</span><span class="s1">text</span><span class="s3">\&quot; </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">wang-code-textarea</span><span class="s3">\&quot; </span><span class="s1">placeholder=</span><span class="s3">\&quot;\&quot; </span><span class="s1">style=</span><span class="s3">\&quot;</span><span class="s1">height: 160px</span><span class="s3">\&quot;</span><span class="s1">&gt;${text.replace(</span><span class="s3">\n                    </span><span class="s1">/&amp;quot;/g,</span><span class="s3">\n                    </span><span class="s1">'</span><span class="s3">\&quot;</span><span class="s1">'</span><span class="s3">\n                </span><span class="s1">)}&lt;/textarea&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-button-container</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                            </span><span class="s1">&lt;button type=</span><span class="s3">\&quot;</span><span class="s1">button</span><span class="s3">\&quot; </span><span class="s1">id=</span><span class="s3">\&quot;</span><span class="s1">${btnOkId}</span><span class="s3">\&quot; </span><span class="s1">class=</span><span class="s3">\&quot;</span><span class="s1">right</span><span class="s3">\&quot;</span><span class="s1">&gt;${</span><span class="s3">\n                    </span><span class="s1">isActive(editor) ? t('修改') : t('插入')</span><span class="s3">\n                </span><span class="s1">}&lt;/button&gt;</span><span class="s3">\n                        </span><span class="s1">&lt;/div&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;/div&gt;`,</span><span class="s3">\n                </span><span class="s1">// 事件绑定</span><span class="s3">\n                </span><span class="s1">events: [</span><span class="s3">\n                    </span><span class="s1">// 插入链接</span><span class="s3">\n                    </span><span class="s1">{</span><span class="s3">\n                        </span><span class="s1">selector: '#' + btnOkId,</span><span class="s3">\n                        </span><span class="s1">type: 'click',</span><span class="s3">\n                        </span><span class="s1">fn: () =&gt; {</span><span class="s3">\n                            </span><span class="s1">const $code = document.getElementById(inputIFrameId)</span><span class="s3">\n                            </span><span class="s1">const $select = $('#' + languageId)</span><span class="s3">\n\n                            </span><span class="s1">let languageType = $select.val()</span><span class="s3">\n                            </span><span class="s1">// @ts-ignore</span><span class="s3">\n                            </span><span class="s1">let code = $code.value</span><span class="s3">\n\n                            </span><span class="s1">// 代码为空，则不插入</span><span class="s3">\n                            </span><span class="s1">if (!code) return</span><span class="s3">\n\n                            </span><span class="s1">//增加标签</span><span class="s3">\n                            </span><span class="s1">if (isActive(editor)) {</span><span class="s3">\n                                </span><span class="s1">return false</span><span class="s3">\n                            </span><span class="s1">} else {</span><span class="s3">\n                                </span><span class="s1">// @ts-ignore</span><span class="s3">\n                                </span><span class="s1">insertCode(languageType, code)</span><span class="s3">\n                            </span><span class="s1">}</span><span class="s3">\n\n                            </span><span class="s1">// 返回 true，表示该事件执行完之后，panel 要关闭。否则 panel 不会关闭</span><span class="s3">\n                            </span><span class="s1">return true</span><span class="s3">\n                        </span><span class="s1">},</span><span class="s3">\n                    </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">],</span><span class="s3">\n            </span><span class="s1">}, // tab end</span><span class="s3">\n        </span><span class="s1">], // tabs end</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return conf</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 绑定链接元素的事件，入口</span><span class="s3">\n </span><span class="s1">* @author lkw</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import bindTooltipEvent from './tooltip-event'</span><span class="s3">\n</span><span class="s1">import bindEventJumpCodeBlock from './jump-code-block-down'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function bindEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">// tooltip 事件</span><span class="s3">\n    </span><span class="s1">bindTooltipEvent(editor)</span><span class="s3">\n\n    </span><span class="s1">// 代码块为最后内容的跳出处理</span><span class="s3">\n    </span><span class="s1">bindEventJumpCodeBlock(editor)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default bindEvent</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description tooltip 事件</span><span class="s3">\n </span><span class="s1">* @author lkw</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Tooltip from '../../menu-constructors/Tooltip'</span><span class="s3">\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 生成 Tooltip 的显示隐藏函数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function createShowHideFn(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">let tooltip: Tooltip | null</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 显示 tooltip</span><span class="s3">\n     </span><span class="s1">* @param $code 链接元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function showCodeTooltip($code: DomElement) {</span><span class="s3">\n        </span><span class="s1">const i18nPrefix = 'menus.panelMenus.code.'</span><span class="s3">\n        </span><span class="s1">const t = (text: string, prefix: string = i18nPrefix): string =&gt; {</span><span class="s3">\n            </span><span class="s1">return editor.i18next.t(prefix + text)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const conf = [</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${t('删除代码')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $code: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">//dom操作删除</span><span class="s3">\n                    </span><span class="s1">$code.remove()</span><span class="s3">\n\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">]</span><span class="s3">\n\n        </span><span class="s1">// 创建 tooltip</span><span class="s3">\n        </span><span class="s1">tooltip = new Tooltip(editor, $code, conf)</span><span class="s3">\n        </span><span class="s1">tooltip.create()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 隐藏 tooltip</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function hideCodeTooltip() {</span><span class="s3">\n        </span><span class="s1">// 移除 tooltip</span><span class="s3">\n        </span><span class="s1">if (tooltip) {</span><span class="s3">\n            </span><span class="s1">tooltip.remove()</span><span class="s3">\n            </span><span class="s1">tooltip = null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return {</span><span class="s3">\n        </span><span class="s1">showCodeTooltip,</span><span class="s3">\n        </span><span class="s1">hideCodeTooltip,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* preEnterListener是为了统一浏览器 在pre标签内的enter行为而进行的监听</span><span class="s3">\n </span><span class="s1">* 目前并没有使用, 但是在未来处理与Firefox和ie的兼容性时需要用到 暂且放置</span><span class="s3">\n </span><span class="s1">* pre标签内的回车监听</span><span class="s3">\n </span><span class="s1">* @param e</span><span class="s3">\n </span><span class="s1">* @param editor</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">/* istanbul ignore next */</span><span class="s3">\n</span><span class="s1">// eslint-disable-next-line @typescript-eslint/no-unused-vars</span><span class="s3">\n</span><span class="s1">function preEnterListener(e: KeyboardEvent, editor: Editor) {</span><span class="s3">\n    </span><span class="s1">// 获取当前标签元素</span><span class="s3">\n    </span><span class="s1">const $selectionElem = editor.selection.getSelectionContainerElem() as DomElement</span><span class="s3">\n\n    </span><span class="s1">// 获取当前节点最顶级标签元素</span><span class="s3">\n    </span><span class="s1">const $topElem = $selectionElem?.getNodeTop(editor)</span><span class="s3">\n\n    </span><span class="s1">// 获取顶级节点节点名</span><span class="s3">\n    </span><span class="s1">const topNodeName = $topElem?.getNodeName()</span><span class="s3">\n\n    </span><span class="s1">// 非pre标签退出</span><span class="s3">\n    </span><span class="s1">if (topNodeName !== 'PRE') return</span><span class="s3">\n\n    </span><span class="s1">// 取消默认行为</span><span class="s3">\n    </span><span class="s1">e.preventDefault()</span><span class="s3">\n\n    </span><span class="s1">// 执行换行</span><span class="s3">\n    </span><span class="s1">editor.cmd.do('insertHTML', '</span><span class="s3">\\</span><span class="s1">n</span><span class="s3">\\</span><span class="s1">r')</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定 tooltip 事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default function bindTooltipEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const { showCodeTooltip, hideCodeTooltip } = createShowHideFn(editor)</span><span class="s3">\n\n    </span><span class="s1">// 点击代码元素时，显示 tooltip</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.codeClickEvents.push(showCodeTooltip)</span><span class="s3">\n\n    </span><span class="s1">// 点击其他地方，或者滚动时，隐藏 tooltip</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.clickEvents.push(hideCodeTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.toolbarClickEvents.push(hideCodeTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.menuClickEvents.push(hideCodeTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.textScrollEvents.push(hideCodeTooltip)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 代码块为最后一块内容时往下跳出代码块</span><span class="s3">\n </span><span class="s1">* @author zhengwenjian</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../../../utils/const'</span><span class="s3">\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import $ from '../../../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 在代码块最后一行 按方向下键跳出代码块的处理</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default function bindEventJumpCodeBlock(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const { $textElem, selection, txt } = editor</span><span class="s3">\n    </span><span class="s1">const { keydownEvents } = txt.eventHooks</span><span class="s3">\n\n    </span><span class="s1">keydownEvents.push(function (e) {</span><span class="s3">\n        </span><span class="s1">// 40 是键盘中的下方向键</span><span class="s3">\n        </span><span class="s1">if (e.keyCode !== 40) return</span><span class="s3">\n        </span><span class="s1">const node = selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">const $lastNode = $textElem.children()?.last()</span><span class="s3">\n        </span><span class="s1">if (node?.elems[0].tagName === 'XMP' &amp;&amp; $lastNode?.elems[0].tagName === 'PRE') {</span><span class="s3">\n            </span><span class="s1">// 就是最后一块是代码块的情况插入空p标签并光标移至p</span><span class="s3">\n            </span><span class="s1">const $emptyP = $(EMPTY_P)</span><span class="s3">\n            </span><span class="s1">$textElem.append($emptyP)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">// fix: 修复代码块作为最后一个元素时，用户无法再进行输入的问题</span><span class="s3">\n    </span><span class="s1">keydownEvents.push(function (e) {</span><span class="s3">\n        </span><span class="s1">// 实时保存选区</span><span class="s3">\n        </span><span class="s1">editor.selection.saveRange()</span><span class="s3">\n        </span><span class="s1">const $selectionContainerElem = selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">if ($selectionContainerElem) {</span><span class="s3">\n            </span><span class="s1">const $topElem = $selectionContainerElem.getNodeTop(editor)</span><span class="s3">\n            </span><span class="s1">// 获取选区所在节点的上一元素</span><span class="s3">\n            </span><span class="s1">const $preElem = $topElem?.prev()</span><span class="s3">\n            </span><span class="s1">// 判断该元素后面是否还存在元素</span><span class="s3">\n            </span><span class="s1">// 如果存在则允许删除</span><span class="s3">\n            </span><span class="s1">const $nextElem = $topElem?.getNextSibling()</span><span class="s3">\n\n            </span><span class="s1">if ($preElem.length &amp;&amp; $preElem?.getNodeName() === 'PRE' &amp;&amp; $nextElem.length === 0) {</span><span class="s3">\n                </span><span class="s1">// 光标处于选区开头</span><span class="s3">\n                </span><span class="s1">if (selection.getCursorPos() === 0) {</span><span class="s3">\n                    </span><span class="s1">// 按下delete键时末尾追加空行</span><span class="s3">\n                    </span><span class="s1">if (e.keyCode === 8) {</span><span class="s3">\n                        </span><span class="s1">const $emptyP = $(EMPTY_P)</span><span class="s3">\n                        </span><span class="s1">$textElem.append($emptyP)</span><span class="s3">\n                    </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 分割线</span><span class="s3">\n </span><span class="s1">* @author wangqiaoling</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import BtnMenu from '../menu-constructors/BtnMenu'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import bindEvent from './bind-event/index'</span><span class="s3">\n</span><span class="s1">import { UA } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../../utils/const'</span><span class="s3">\n</span><span class="s1">class splitLine extends BtnMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">'&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">分割线</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-split-line</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;&lt;/div&gt;'</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n        </span><span class="s1">// 绑定事件</span><span class="s3">\n        </span><span class="s1">bindEvent(editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 菜单点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const range = editor.selection.getRange()</span><span class="s3">\n\n        </span><span class="s1">const $selectionElem = editor.selection.getSelectionContainerElem()</span><span class="s3">\n        </span><span class="s1">if (!$selectionElem?.length) return</span><span class="s3">\n\n        </span><span class="s1">const $DomElement = $($selectionElem.elems[0])</span><span class="s3">\n        </span><span class="s1">const $tableDOM = $DomElement.parentUntil('TABLE', $selectionElem.elems[0])</span><span class="s3">\n        </span><span class="s1">const $imgDOM = $DomElement.children()</span><span class="s3">\n\n        </span><span class="s1">// 禁止在代码块中添加分割线</span><span class="s3">\n        </span><span class="s1">if ($DomElement.getNodeName() === 'CODE') return</span><span class="s3">\n        </span><span class="s1">// 禁止在表格中添加分割线</span><span class="s3">\n        </span><span class="s1">if ($tableDOM &amp;&amp; $($tableDOM.elems[0]).getNodeName() === 'TABLE') return</span><span class="s3">\n\n        </span><span class="s1">// 禁止在图片处添加分割线</span><span class="s3">\n        </span><span class="s1">if (</span><span class="s3">\n            </span><span class="s1">$imgDOM &amp;&amp;</span><span class="s3">\n            </span><span class="s1">$imgDOM.length !== 0 &amp;&amp;</span><span class="s3">\n            </span><span class="s1">$($imgDOM.elems[0]).getNodeName() === 'IMG' &amp;&amp;</span><span class="s3">\n            </span><span class="s1">!range?.collapsed // 处理光标在 img 后面的情况</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">this.createSplitLine()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 创建 splitLine</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private createSplitLine(): void {</span><span class="s3">\n        </span><span class="s1">// 防止插入分割线时没有占位元素的尴尬</span><span class="s3">\n        </span><span class="s1">let splitLineDOM: string = `&lt;hr/&gt;${EMPTY_P}`</span><span class="s3">\n        </span><span class="s1">// 火狐浏览器不需要br标签占位</span><span class="s3">\n        </span><span class="s1">if (UA.isFirefox) {</span><span class="s3">\n            </span><span class="s1">splitLineDOM = '&lt;hr/&gt;&lt;p&gt;&lt;/p&gt;'</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">this.editor.cmd.do('insertHTML', splitLineDOM)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尝试修改菜单激活状态</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public tryChangeActive(): void {}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">export default splitLine</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 绑定分割线元素的事件入口</span><span class="s3">\n </span><span class="s1">* @author wangqiaoling</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import bindTooltipEvent from './tooltip-event'</span><span class="s3">\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function bindEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">// 分割线的 tooltip 事件</span><span class="s3">\n    </span><span class="s1">bindTooltipEvent(editor)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default bindEvent</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description tooltip 事件</span><span class="s3">\n </span><span class="s1">* @author wangqiaoling</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import Tooltip, { TooltipConfType } from '../../menu-constructors/Tooltip'</span><span class="s3">\n</span><span class="s1">import Editor from '../../../editor/index'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 生成 Tooltip 的显示隐藏函数</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function createShowHideFn(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">let tooltip: Tooltip | null</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 显示分割线的 tooltip</span><span class="s3">\n     </span><span class="s1">* @param $splitLine 分割线元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function showSplitLineTooltip($splitLine: DomElement): void {</span><span class="s3">\n        </span><span class="s1">// 定义 splitLine tooltip 配置</span><span class="s3">\n        </span><span class="s1">const conf: TooltipConfType = [</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">$elem: $(`&lt;span&gt;${editor.i18next.t('menus.panelMenus.删除')}&lt;/span&gt;`),</span><span class="s3">\n                </span><span class="s1">onClick: (editor: Editor, $splitLine: DomElement) =&gt; {</span><span class="s3">\n                    </span><span class="s1">// 选中 分割线 元素</span><span class="s3">\n                    </span><span class="s1">editor.selection.createRangeByElem($splitLine)</span><span class="s3">\n                    </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n                    </span><span class="s1">editor.cmd.do('delete')</span><span class="s3">\n\n                    </span><span class="s1">// 返回 true，表示执行完之后，隐藏 tooltip。否则不隐藏。</span><span class="s3">\n                    </span><span class="s1">return true</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">]</span><span class="s3">\n        </span><span class="s1">// 实例化 tooltip</span><span class="s3">\n        </span><span class="s1">tooltip = new Tooltip(editor, $splitLine, conf)</span><span class="s3">\n        </span><span class="s1">// 创建 tooltip</span><span class="s3">\n        </span><span class="s1">tooltip.create()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 隐藏分割线的 tooltip</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function hideSplitLineTooltip(): void {</span><span class="s3">\n        </span><span class="s1">if (tooltip) {</span><span class="s3">\n            </span><span class="s1">tooltip.remove()</span><span class="s3">\n            </span><span class="s1">tooltip = null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return {</span><span class="s3">\n        </span><span class="s1">showSplitLineTooltip,</span><span class="s3">\n        </span><span class="s1">hideSplitLineTooltip,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default function bindTooltipEvent(editor: Editor): void {</span><span class="s3">\n    </span><span class="s1">const { showSplitLineTooltip, hideSplitLineTooltip } = createShowHideFn(editor)</span><span class="s3">\n\n    </span><span class="s1">// 点击分割线时，显示 tooltip</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.splitLineEvents.push(showSplitLineTooltip)</span><span class="s3">\n\n    </span><span class="s1">// 点击其他地方（工具栏、滚动、keyup）时，隐藏 tooltip</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.clickEvents.push(hideSplitLineTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.keyupEvents.push(hideSplitLineTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.toolbarClickEvents.push(hideSplitLineTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.menuClickEvents.push(hideSplitLineTooltip)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.textScrollEvents.push(hideSplitLineTooltip)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import BtnMenu from '../menu-constructors/BtnMenu'</span><span class="s3">\n</span><span class="s1">import Editor from '../../editor/index'</span><span class="s3">\n</span><span class="s1">import { MenuActive } from '../menu-constructors/Menu'</span><span class="s3">\n</span><span class="s1">import { isAllTodo } from './util'</span><span class="s3">\n</span><span class="s1">import bindEvent from './bind-event'</span><span class="s3">\n</span><span class="s1">import createTodo from './todo'</span><span class="s3">\n\n</span><span class="s1">class Todo extends BtnMenu implements MenuActive {</span><span class="s3">\n    </span><span class="s1">constructor(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">const $elem = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">待办事项</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                    </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">w-e-icon-checkbox-checked</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n                </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">super($elem, editor)</span><span class="s3">\n        </span><span class="s1">bindEvent(editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 点击事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clickHandler(): void {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">if (!isAllTodo(editor)) {</span><span class="s3">\n            </span><span class="s1">// 设置todolist</span><span class="s3">\n            </span><span class="s1">this.setTodo()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 取消设置todolist</span><span class="s3">\n            </span><span class="s1">this.cancelTodo()</span><span class="s3">\n            </span><span class="s1">this.tryChangeActive()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">tryChangeActive() {</span><span class="s3">\n        </span><span class="s1">if (isAllTodo(this.editor)) {</span><span class="s3">\n            </span><span class="s1">this.active()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">this.unActive()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 设置todo</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private setTodo() {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const topNodeElem: DomElement[] = editor.selection.getSelectionRangeTopNodes()</span><span class="s3">\n        </span><span class="s1">topNodeElem.forEach($node =&gt; {</span><span class="s3">\n            </span><span class="s1">const nodeName = $node?.getNodeName()</span><span class="s3">\n            </span><span class="s1">if (nodeName === 'P') {</span><span class="s3">\n                </span><span class="s1">const todo = createTodo($node)</span><span class="s3">\n                </span><span class="s1">const todoNode = todo.getTodo()</span><span class="s3">\n                </span><span class="s1">const child = todoNode.children()?.getNode() as Node</span><span class="s3">\n                </span><span class="s1">todoNode.insertAfter($node)</span><span class="s3">\n                </span><span class="s1">editor.selection.moveCursor(child)</span><span class="s3">\n                </span><span class="s1">$node.remove()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">this.tryChangeActive()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 取消设置todo</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private cancelTodo() {</span><span class="s3">\n        </span><span class="s1">const editor = this.editor</span><span class="s3">\n        </span><span class="s1">const $topNodeElems: DomElement[] = editor.selection.getSelectionRangeTopNodes()</span><span class="s3">\n\n        </span><span class="s1">$topNodeElems.forEach($topNodeElem =&gt; {</span><span class="s3">\n            </span><span class="s1">let content = $topNodeElem.childNodes()?.childNodes()?.clone(true) as DomElement</span><span class="s3">\n            </span><span class="s1">const $p = $(`&lt;p&gt;&lt;/p&gt;`)</span><span class="s3">\n            </span><span class="s1">$p.append(content)</span><span class="s3">\n            </span><span class="s1">$p.insertAfter($topNodeElem)</span><span class="s3">\n            </span><span class="s1">// 移除input</span><span class="s3">\n            </span><span class="s1">$p.childNodes()?.get(0).remove()</span><span class="s3">\n            </span><span class="s1">editor.selection.moveCursor($p.getNode())</span><span class="s3">\n            </span><span class="s1">$topNodeElem.remove()</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default Todo</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;module.exports = require(</span><span class="s3">\&quot;</span><span class="s1">core-js-pure/stable/instance/every</span><span class="s3">\&quot;</span><span class="s1">);&quot;</span><span class="s0">,</span><span class="s1">&quot;var parent = require('../../es/instance/every');</span><span class="s3">\n\n</span><span class="s1">module.exports = parent;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var every = require('../array/virtual/every');</span><span class="s3">\n\n</span><span class="s1">var ArrayPrototype = Array.prototype;</span><span class="s3">\n\n</span><span class="s1">module.exports = function (it) {</span><span class="s3">\n  </span><span class="s1">var own = it.every;</span><span class="s3">\n  </span><span class="s1">return it === ArrayPrototype || (it instanceof Array &amp;&amp; own === ArrayPrototype.every) ? every : own;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;require('../../../modules/es.array.every');</span><span class="s3">\n</span><span class="s1">var entryVirtual = require('../../../internals/entry-virtual');</span><span class="s3">\n\n</span><span class="s1">module.exports = entryVirtual('Array').every;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;'use strict';</span><span class="s3">\n</span><span class="s1">var $ = require('../internals/export');</span><span class="s3">\n</span><span class="s1">var $every = require('../internals/array-iteration').every;</span><span class="s3">\n</span><span class="s1">var arrayMethodIsStrict = require('../internals/array-method-is-strict');</span><span class="s3">\n</span><span class="s1">var arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');</span><span class="s3">\n\n</span><span class="s1">var STRICT_METHOD = arrayMethodIsStrict('every');</span><span class="s3">\n</span><span class="s1">var USES_TO_LENGTH = arrayMethodUsesToLength('every');</span><span class="s3">\n\n</span><span class="s1">// `Array.prototype.every` method</span><span class="s3">\n</span><span class="s1">// https://tc39.github.io/ecma262/#sec-array.prototype.every</span><span class="s3">\n</span><span class="s1">$({ target: 'Array', proto: true, forced: !STRICT_METHOD || !USES_TO_LENGTH }, {</span><span class="s3">\n  </span><span class="s1">every: function every(callbackfn /* , thisArg */) {</span><span class="s3">\n    </span><span class="s1">return $every(this, callbackfn, arguments.length &gt; 1 ? arguments[1] : undefined);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">});</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import Editor from '../../../editor/index'</span><span class="s3">\n</span><span class="s1">import $ from '../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { getCursorNextNode, isAllTodo } from '../util'</span><span class="s3">\n</span><span class="s1">import createTodo from '../todo'</span><span class="s3">\n</span><span class="s1">import { dealTextNode, isTodo } from '../util'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../../../utils/const'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* todolist 内部逻辑</span><span class="s3">\n </span><span class="s1">* @param editor</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function bindEvent(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* todo的自定义回车事件</span><span class="s3">\n     </span><span class="s1">* @param e 事件属性</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function todoEnter(e: Event) {</span><span class="s3">\n        </span><span class="s1">// 判断是否为todo节点</span><span class="s3">\n        </span><span class="s1">if (isAllTodo(editor)) {</span><span class="s3">\n            </span><span class="s1">e.preventDefault()</span><span class="s3">\n            </span><span class="s1">const selection = editor.selection</span><span class="s3">\n            </span><span class="s1">const $topSelectElem = selection.getSelectionRangeTopNodes()[0]</span><span class="s3">\n            </span><span class="s1">const $li = $topSelectElem.childNodes()?.get(0)</span><span class="s3">\n            </span><span class="s1">const selectionNode = window.getSelection()?.anchorNode as Node</span><span class="s3">\n            </span><span class="s1">const range = selection.getRange()</span><span class="s3">\n\n            </span><span class="s1">if (!range?.collapsed) {</span><span class="s3">\n                </span><span class="s1">const rangeChildNodes = range?.commonAncestorContainer.childNodes</span><span class="s3">\n                </span><span class="s1">const startContainer = range?.startContainer as Node</span><span class="s3">\n                </span><span class="s1">const endContainer = range?.endContainer as Node</span><span class="s3">\n                </span><span class="s1">const startPos = range?.startOffset as number</span><span class="s3">\n                </span><span class="s1">const endPos = range?.endOffset as number</span><span class="s3">\n                </span><span class="s1">let startElemIndex: number = 0</span><span class="s3">\n                </span><span class="s1">let endElemIndex: number = 0</span><span class="s3">\n                </span><span class="s1">let delList: ChildNode[] = []</span><span class="s3">\n                </span><span class="s1">// 找出startContainer和endContainer在rangeChildNodes中的位置</span><span class="s3">\n                </span><span class="s1">rangeChildNodes?.forEach((v, i) =&gt; {</span><span class="s3">\n                    </span><span class="s1">if (v.contains(startContainer)) startElemIndex = i</span><span class="s3">\n                    </span><span class="s1">if (v.contains(endContainer)) endElemIndex = i</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n                </span><span class="s1">// 删除两个容器间的内容</span><span class="s3">\n                </span><span class="s1">if (endElemIndex - startElemIndex &gt; 1) {</span><span class="s3">\n                    </span><span class="s1">rangeChildNodes?.forEach((v, i) =&gt; {</span><span class="s3">\n                        </span><span class="s1">if (i &lt;= startElemIndex) return</span><span class="s3">\n                        </span><span class="s1">if (i &gt;= endElemIndex) return</span><span class="s3">\n                        </span><span class="s1">delList.push(v)</span><span class="s3">\n                    </span><span class="s1">})</span><span class="s3">\n                    </span><span class="s1">delList.forEach(v =&gt; {</span><span class="s3">\n                        </span><span class="s1">v.remove()</span><span class="s3">\n                    </span><span class="s1">})</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">// 删除两个容器里拖蓝的内容</span><span class="s3">\n                </span><span class="s1">dealTextNode(startContainer, startPos)</span><span class="s3">\n                </span><span class="s1">dealTextNode(endContainer, endPos, false)</span><span class="s3">\n                </span><span class="s1">editor.selection.moveCursor(endContainer, 0)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 回车时内容为空时，删去此行</span><span class="s3">\n            </span><span class="s1">if ($topSelectElem.text() === '') {</span><span class="s3">\n                </span><span class="s1">const $p = $(EMPTY_P)</span><span class="s3">\n                </span><span class="s1">$p.insertAfter($topSelectElem)</span><span class="s3">\n                </span><span class="s1">selection.moveCursor($p.getNode())</span><span class="s3">\n                </span><span class="s1">$topSelectElem.remove()</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">const pos = selection.getCursorPos() as number</span><span class="s3">\n            </span><span class="s1">const CursorNextNode = getCursorNextNode($li?.getNode() as Node, selectionNode, pos)</span><span class="s3">\n            </span><span class="s1">const todo = createTodo($(CursorNextNode))</span><span class="s3">\n            </span><span class="s1">const $inputcontainer = todo.getInputContainer()</span><span class="s3">\n            </span><span class="s1">const todoLiElem = $inputcontainer.parent().getNode()</span><span class="s3">\n            </span><span class="s1">const $newTodo = todo.getTodo()</span><span class="s3">\n            </span><span class="s1">const contentSection = $inputcontainer.getNode().nextSibling</span><span class="s3">\n            </span><span class="s1">// 处理光标在最前面时回车input不显示的问题</span><span class="s3">\n            </span><span class="s1">if ($li?.text() === '') {</span><span class="s3">\n                </span><span class="s1">$li?.append($(`&lt;br&gt;`))</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">$newTodo.insertAfter($topSelectElem)</span><span class="s3">\n            </span><span class="s1">// 处理在google中光标在最后面的，input不显示的问题(必须插入之后移动光标)</span><span class="s3">\n            </span><span class="s1">if (!contentSection || contentSection?.textContent === '') {</span><span class="s3">\n                </span><span class="s1">// 防止多个br出现的情况</span><span class="s3">\n                </span><span class="s1">if (contentSection?.nodeName !== 'BR') {</span><span class="s3">\n                    </span><span class="s1">const $br = $(`&lt;br&gt;`)</span><span class="s3">\n                    </span><span class="s1">$br.insertAfter($inputcontainer)</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">selection.moveCursor(todoLiElem, 1)</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">selection.moveCursor(todoLiElem)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 自定义删除事件，用来处理光标在最前面删除input产生的问题</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function delDown(e: Event) {</span><span class="s3">\n        </span><span class="s1">if (isAllTodo(editor)) {</span><span class="s3">\n            </span><span class="s1">const selection = editor.selection</span><span class="s3">\n            </span><span class="s1">const $topSelectElem = selection.getSelectionRangeTopNodes()[0]</span><span class="s3">\n            </span><span class="s1">const $li = $topSelectElem.childNodes()?.getNode()</span><span class="s3">\n            </span><span class="s1">const $p = $(`&lt;p&gt;&lt;/p&gt;`)</span><span class="s3">\n            </span><span class="s1">const p = $p.getNode()</span><span class="s3">\n            </span><span class="s1">const selectionNode = window.getSelection()?.anchorNode as Node</span><span class="s3">\n            </span><span class="s1">const pos = selection.getCursorPos()</span><span class="s3">\n            </span><span class="s1">const prevNode = selectionNode.previousSibling</span><span class="s3">\n\n            </span><span class="s1">// 处理内容为空的情况</span><span class="s3">\n            </span><span class="s1">if ($topSelectElem.text() === '') {</span><span class="s3">\n                </span><span class="s1">e.preventDefault()</span><span class="s3">\n                </span><span class="s1">const $newP = $(EMPTY_P)</span><span class="s3">\n                </span><span class="s1">$newP.insertAfter($topSelectElem)</span><span class="s3">\n                </span><span class="s1">$topSelectElem.remove()</span><span class="s3">\n                </span><span class="s1">selection.moveCursor($newP.getNode(), 0)</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// 处理有内容时，光标在最前面的情况</span><span class="s3">\n            </span><span class="s1">if (</span><span class="s3">\n                </span><span class="s1">prevNode?.nodeName === 'SPAN' &amp;&amp;</span><span class="s3">\n                </span><span class="s1">prevNode.childNodes[0].nodeName === 'INPUT' &amp;&amp;</span><span class="s3">\n                </span><span class="s1">pos === 0</span><span class="s3">\n            </span><span class="s1">) {</span><span class="s3">\n                </span><span class="s1">e.preventDefault()</span><span class="s3">\n                </span><span class="s1">$li?.childNodes.forEach((v, index) =&gt; {</span><span class="s3">\n                    </span><span class="s1">if (index === 0) return</span><span class="s3">\n                    </span><span class="s1">p.appendChild(v.cloneNode(true))</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n                </span><span class="s1">$p.insertAfter($topSelectElem)</span><span class="s3">\n\n                </span><span class="s1">$topSelectElem.remove()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 自定义删除键up事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function deleteUp() {</span><span class="s3">\n        </span><span class="s1">const selection = editor.selection</span><span class="s3">\n        </span><span class="s1">const $topSelectElem = selection.getSelectionRangeTopNodes()[0]</span><span class="s3">\n        </span><span class="s1">if ($topSelectElem &amp;&amp; isTodo($topSelectElem)) {</span><span class="s3">\n            </span><span class="s1">if ($topSelectElem.text() === '') {</span><span class="s3">\n                </span><span class="s1">$(EMPTY_P).insertAfter($topSelectElem)</span><span class="s3">\n                </span><span class="s1">$topSelectElem.remove()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* input 的点击事件（ input 默认不会产生 attribute 的改变 ）</span><span class="s3">\n     </span><span class="s1">* @param e 事件属性</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">function inputClick(e?: Event): void {</span><span class="s3">\n        </span><span class="s1">if (e &amp;&amp; e.target instanceof HTMLInputElement) {</span><span class="s3">\n            </span><span class="s1">if (e.target.type === 'checkbox') {</span><span class="s3">\n                </span><span class="s1">if (e.target.checked) {</span><span class="s3">\n                    </span><span class="s1">e.target.setAttribute('checked', 'true')</span><span class="s3">\n                </span><span class="s1">} else {</span><span class="s3">\n                    </span><span class="s1">e.target.removeAttribute('checked')</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">editor.txt.eventHooks.enterDownEvents.push(todoEnter)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.deleteUpEvents.push(deleteUp)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.deleteDownEvents.push(delDown)</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.clickEvents.push(inputClick)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default bindEvent</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 初始化编辑器 DOM 结构</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../index'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { getRandom } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../../utils/const'</span><span class="s3">\n</span><span class="s1">import CONFIG from '../../config/text'</span><span class="s3">\n</span><span class="s1">const styleSettings = {</span><span class="s3">\n    </span><span class="s1">border: '1px solid #c9d8db',</span><span class="s3">\n    </span><span class="s1">toolbarBgColor: '#FFF',</span><span class="s3">\n    </span><span class="s1">toolbarBottomBorder: '1px solid #EEE',</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default function (editor: Editor): void {</span><span class="s3">\n    </span><span class="s1">const toolbarSelector = editor.toolbarSelector</span><span class="s3">\n    </span><span class="s1">const $toolbarSelector = $(toolbarSelector)</span><span class="s3">\n    </span><span class="s1">const textSelector = editor.textSelector</span><span class="s3">\n\n    </span><span class="s1">const config = editor.config</span><span class="s3">\n    </span><span class="s1">const height = config.height</span><span class="s3">\n    </span><span class="s1">const i18next = editor.i18next</span><span class="s3">\n\n    </span><span class="s1">const $toolbarElem: DomElement = $('&lt;div&gt;&lt;/div&gt;')</span><span class="s3">\n    </span><span class="s1">const $textContainerElem: DomElement = $('&lt;div&gt;&lt;/div&gt;')</span><span class="s3">\n    </span><span class="s1">let $textElem: DomElement</span><span class="s3">\n    </span><span class="s1">let $children: DomElement | null</span><span class="s3">\n    </span><span class="s1">let $subChildren: DomElement | null = null</span><span class="s3">\n\n    </span><span class="s1">if (textSelector == null) {</span><span class="s3">\n        </span><span class="s1">// 将编辑器区域原有的内容，暂存起来</span><span class="s3">\n        </span><span class="s1">$children = $toolbarSelector.children()</span><span class="s3">\n\n        </span><span class="s1">// 添加到 DOM 结构中</span><span class="s3">\n        </span><span class="s1">$toolbarSelector.append($toolbarElem).append($textContainerElem)</span><span class="s3">\n\n        </span><span class="s1">// 自行创建的，需要配置默认的样式</span><span class="s3">\n        </span><span class="s1">$toolbarElem</span><span class="s3">\n            </span><span class="s1">.css('background-color', styleSettings.toolbarBgColor)</span><span class="s3">\n            </span><span class="s1">.css('border', styleSettings.border)</span><span class="s3">\n            </span><span class="s1">.css('border-bottom', styleSettings.toolbarBottomBorder)</span><span class="s3">\n        </span><span class="s1">$textContainerElem</span><span class="s3">\n            </span><span class="s1">.css('border', styleSettings.border)</span><span class="s3">\n            </span><span class="s1">.css('border-top', 'none')</span><span class="s3">\n            </span><span class="s1">.css('height', `${height}px`)</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">// toolbarSelector 和 textSelector 都有</span><span class="s3">\n        </span><span class="s1">$toolbarSelector.append($toolbarElem)</span><span class="s3">\n        </span><span class="s1">// 菜单分离后，文本区域内容暂存</span><span class="s3">\n        </span><span class="s1">$subChildren = $(textSelector).children()</span><span class="s3">\n        </span><span class="s1">$(textSelector).append($textContainerElem)</span><span class="s3">\n        </span><span class="s1">// 将编辑器区域原有的内容，暂存起来</span><span class="s3">\n        </span><span class="s1">$children = $textContainerElem.children()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 编辑区域</span><span class="s3">\n    </span><span class="s1">$textElem = $('&lt;div&gt;&lt;/div&gt;')</span><span class="s3">\n    </span><span class="s1">$textElem.attr('contenteditable', 'true').css('width', '100%').css('height', '100%')</span><span class="s3">\n\n    </span><span class="s1">// 添加 placeholder</span><span class="s3">\n    </span><span class="s1">let $placeholder: DomElement</span><span class="s3">\n    </span><span class="s1">const placeholder = editor.config.placeholder</span><span class="s3">\n    </span><span class="s1">if (placeholder !== CONFIG.placeholder) {</span><span class="s3">\n        </span><span class="s1">$placeholder = $(`&lt;div&gt;${placeholder}&lt;/div&gt;`)</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">$placeholder = $(`&lt;div&gt;${i18next.t(placeholder)}&lt;/div&gt;`)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">$placeholder.addClass('placeholder')</span><span class="s3">\n\n    </span><span class="s1">// 初始化编辑区域内容</span><span class="s3">\n    </span><span class="s1">if ($children &amp;&amp; $children.length) {</span><span class="s3">\n        </span><span class="s1">$textElem.append($children)</span><span class="s3">\n        </span><span class="s1">// 编辑器有默认值的时候隐藏placeholder</span><span class="s3">\n        </span><span class="s1">$placeholder.hide()</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">$textElem.append($(EMPTY_P)) // 新增一行，方便继续编辑</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 菜单分离后，文本区域有标签的带入编辑器内</span><span class="s3">\n    </span><span class="s1">if ($subChildren &amp;&amp; $subChildren.length) {</span><span class="s3">\n        </span><span class="s1">$textElem.append($subChildren)</span><span class="s3">\n        </span><span class="s1">// 编辑器有默认值的时候隐藏placeholder</span><span class="s3">\n        </span><span class="s1">$placeholder.hide()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 编辑区域加入DOM</span><span class="s3">\n    </span><span class="s1">$textContainerElem.append($textElem)</span><span class="s3">\n\n    </span><span class="s1">// 添加placeholder</span><span class="s3">\n    </span><span class="s1">$textContainerElem.append($placeholder)</span><span class="s3">\n\n    </span><span class="s1">// 设置通用的 class</span><span class="s3">\n    </span><span class="s1">$toolbarElem.addClass('w-e-toolbar').css('z-index', editor.zIndex.get('toolbar'))</span><span class="s3">\n    </span><span class="s1">$textContainerElem.addClass('w-e-text-container')</span><span class="s3">\n    </span><span class="s1">$textContainerElem.css('z-index', editor.zIndex.get())</span><span class="s3">\n    </span><span class="s1">$textElem.addClass('w-e-text')</span><span class="s3">\n\n    </span><span class="s1">// 添加 ID</span><span class="s3">\n    </span><span class="s1">const toolbarElemId = getRandom('toolbar-elem')</span><span class="s3">\n    </span><span class="s1">$toolbarElem.attr('id', toolbarElemId)</span><span class="s3">\n    </span><span class="s1">const textElemId = getRandom('text-elem')</span><span class="s3">\n    </span><span class="s1">$textElem.attr('id', textElemId)</span><span class="s3">\n\n    </span><span class="s1">// 判断编辑区与容器高度是否一致</span><span class="s3">\n    </span><span class="s1">const textContainerCliheight = $textContainerElem.getBoundingClientRect().height</span><span class="s3">\n    </span><span class="s1">const textElemClientHeight = $textElem.getBoundingClientRect().height</span><span class="s3">\n    </span><span class="s1">if (textContainerCliheight !== textElemClientHeight) {</span><span class="s3">\n        </span><span class="s1">$textElem.css('min-height', textContainerCliheight + 'px')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 记录属性</span><span class="s3">\n    </span><span class="s1">editor.$toolbarElem = $toolbarElem</span><span class="s3">\n    </span><span class="s1">editor.$textContainerElem = $textContainerElem</span><span class="s3">\n    </span><span class="s1">editor.$textElem = $textElem</span><span class="s3">\n    </span><span class="s1">editor.toolbarElemId = toolbarElemId</span><span class="s3">\n    </span><span class="s1">editor.textElemId = textElemId</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 工具栏/文本区域 DOM selector 有效性验证</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function selectorValidator(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const name = 'data-we-id'</span><span class="s3">\n    </span><span class="s1">const regexp = /^wangEditor-</span><span class="s3">\\</span><span class="s1">d+$/</span><span class="s3">\n    </span><span class="s1">const { textSelector, toolbarSelector } = editor</span><span class="s3">\n\n    </span><span class="s1">const $el = {</span><span class="s3">\n        </span><span class="s1">bar: $('&lt;div&gt;&lt;/div&gt;'),</span><span class="s3">\n        </span><span class="s1">text: $('&lt;div&gt;&lt;/div&gt;'),</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (toolbarSelector == null) {</span><span class="s3">\n        </span><span class="s1">throw new Error('错误：初始化编辑器时候未传入任何参数，请查阅文档')</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">$el.bar = $(toolbarSelector)</span><span class="s3">\n        </span><span class="s1">if (!$el.bar.elems.length) {</span><span class="s3">\n            </span><span class="s1">throw new Error(`无效的节点选择器：${toolbarSelector}`)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (regexp.test($el.bar.attr(name))) {</span><span class="s3">\n            </span><span class="s1">throw new Error('初始化节点已存在编辑器实例，无法重复创建编辑器')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (textSelector) {</span><span class="s3">\n        </span><span class="s1">$el.text = $(textSelector)</span><span class="s3">\n        </span><span class="s1">if (!$el.text.elems.length) {</span><span class="s3">\n            </span><span class="s1">throw new Error(`无效的节点选择器：${textSelector}`)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (regexp.test($el.text.attr(name))) {</span><span class="s3">\n            </span><span class="s1">throw new Error('初始化节点已存在编辑器实例，无法重复创建编辑器')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 给节点做上标记</span><span class="s3">\n    </span><span class="s1">$el.bar.attr(name, editor.id)</span><span class="s3">\n    </span><span class="s1">$el.text.attr(name, editor.id)</span><span class="s3">\n\n    </span><span class="s1">// 在编辑器销毁前取消标记</span><span class="s3">\n    </span><span class="s1">editor.beforeDestroy(function () {</span><span class="s3">\n        </span><span class="s1">$el.bar.removeAttr(name)</span><span class="s3">\n        </span><span class="s1">$el.text.removeAttr(name)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 初始化编辑器选区，将光标定位到文档末尾</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../index'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { EMPTY_P } from '../../utils/const'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 初始化编辑器选区，将光标定位到文档末尾</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">* @param newLine 是否新增一行</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function initSelection(editor: Editor, newLine?: boolean) {</span><span class="s3">\n    </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n    </span><span class="s1">const $children = $textElem.children()</span><span class="s3">\n    </span><span class="s1">if (!$children || !$children.length) {</span><span class="s3">\n        </span><span class="s1">// 如果编辑器区域无内容，添加一个空行，重新设置选区</span><span class="s3">\n        </span><span class="s1">$textElem.append($(EMPTY_P))</span><span class="s3">\n        </span><span class="s1">initSelection(editor)</span><span class="s3">\n        </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const $last = $children.last()</span><span class="s3">\n\n    </span><span class="s1">if (newLine) {</span><span class="s3">\n        </span><span class="s1">// 新增一个空行</span><span class="s3">\n        </span><span class="s1">const html = $last.html().toLowerCase()</span><span class="s3">\n        </span><span class="s1">const nodeName = $last.getNodeName()</span><span class="s3">\n        </span><span class="s1">if ((html !== '&lt;br&gt;' &amp;&amp; html !== '&lt;br/&gt;') || nodeName !== 'P') {</span><span class="s3">\n            </span><span class="s1">// 最后一个元素不是 空标签，添加一个空行，重新设置选区</span><span class="s3">\n            </span><span class="s1">$textElem.append($(EMPTY_P))</span><span class="s3">\n            </span><span class="s1">initSelection(editor)</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">editor.selection.createRangeByElem($last, false, true)</span><span class="s3">\n    </span><span class="s1">if (editor.config.focus) {</span><span class="s3">\n        </span><span class="s1">editor.selection.restoreSelection()</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">// 防止focus=false受其他因素影响</span><span class="s3">\n        </span><span class="s1">editor.selection.clearWindowSelectionRange()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default initSelection</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 绑定编辑器事件 change blur focus</span><span class="s3">\n </span><span class="s1">* @author wangfupeng</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../index'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">function bindEvent(editor: Editor): void {</span><span class="s3">\n    </span><span class="s1">// 绑定 change 事件</span><span class="s3">\n    </span><span class="s1">_bindChange(editor)</span><span class="s3">\n\n    </span><span class="s1">// 绑定 focus blur 事件</span><span class="s3">\n    </span><span class="s1">_bindFocusAndBlur(editor)</span><span class="s3">\n\n    </span><span class="s1">// 绑定 input 输入</span><span class="s3">\n    </span><span class="s1">_bindInput(editor)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定 change 事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function _bindChange(editor: Editor): void {</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.changeEvents.push(function () {</span><span class="s3">\n        </span><span class="s1">const { onchange } = editor.config</span><span class="s3">\n        </span><span class="s1">if (onchange) {</span><span class="s3">\n            </span><span class="s1">const html = editor.txt.html() || ''</span><span class="s3">\n            </span><span class="s1">// onchange触发时，是focus状态，详见https://github.com/wangeditor-team/wangEditor/issues/3034</span><span class="s3">\n            </span><span class="s1">editor.isFocus = true</span><span class="s3">\n            </span><span class="s1">onchange(html)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">editor.txt.togglePlaceholder()</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定 focus blur 事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function _bindFocusAndBlur(editor: Editor): void {</span><span class="s3">\n    </span><span class="s1">// 当前编辑器是否是焦点状态</span><span class="s3">\n    </span><span class="s1">editor.isFocus = false</span><span class="s3">\n\n    </span><span class="s1">function listener(e: Event) {</span><span class="s3">\n        </span><span class="s1">const target = e.target</span><span class="s3">\n        </span><span class="s1">const $target = $(target)</span><span class="s3">\n        </span><span class="s1">const $textElem = editor.$textElem</span><span class="s3">\n        </span><span class="s1">const $toolbarElem = editor.$toolbarElem</span><span class="s3">\n\n        </span><span class="s1">//判断当前点击元素是否在编辑器内</span><span class="s3">\n        </span><span class="s1">const isChild = $textElem.isContain($target)</span><span class="s3">\n\n        </span><span class="s1">//判断当前点击元素是否为工具栏</span><span class="s3">\n        </span><span class="s1">const isToolbar = $toolbarElem.isContain($target)</span><span class="s3">\n        </span><span class="s1">const isMenu = $toolbarElem.elems[0] == e.target ? true : false</span><span class="s3">\n\n        </span><span class="s1">if (!isChild) {</span><span class="s3">\n            </span><span class="s1">// 若为选择工具栏中的功能，则不视为成 blur 操作</span><span class="s3">\n            </span><span class="s1">if ((isToolbar &amp;&amp; !isMenu) || !editor.isFocus) {</span><span class="s3">\n                </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">_blurHandler(editor)</span><span class="s3">\n            </span><span class="s1">editor.isFocus = false</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">if (!editor.isFocus) {</span><span class="s3">\n                </span><span class="s1">_focusHandler(editor)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">editor.isFocus = true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// fix: 增加判断条件，防止当用户设置isFocus=false时，初始化完成后点击其他元素依旧会触发blur事件的问题</span><span class="s3">\n    </span><span class="s1">if (document.activeElement === editor.$textElem.elems[0] &amp;&amp; editor.config.focus) {</span><span class="s3">\n        </span><span class="s1">_focusHandler(editor)</span><span class="s3">\n        </span><span class="s1">editor.isFocus = true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// 绑定监听事件</span><span class="s3">\n    </span><span class="s1">$(document).on('click', listener)</span><span class="s3">\n    </span><span class="s1">// 全局事件在编辑器实例销毁的时候进行解绑</span><span class="s3">\n    </span><span class="s1">editor.beforeDestroy(function () {</span><span class="s3">\n        </span><span class="s1">$(document).off('click', listener)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 绑定 input 事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function _bindInput(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">// 绑定中文输入</span><span class="s3">\n    </span><span class="s1">editor.$textElem</span><span class="s3">\n        </span><span class="s1">.on('compositionstart', () =&gt; {</span><span class="s3">\n            </span><span class="s1">editor.isComposing = true</span><span class="s3">\n            </span><span class="s1">editor.txt.togglePlaceholder()</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">.on('compositionend', () =&gt; {</span><span class="s3">\n            </span><span class="s1">editor.isComposing = false</span><span class="s3">\n            </span><span class="s1">editor.txt.togglePlaceholder()</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* blur 事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function _blurHandler(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const config = editor.config</span><span class="s3">\n    </span><span class="s1">const onblur = config.onblur</span><span class="s3">\n    </span><span class="s1">const currentHtml = editor.txt.html() || ''</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.onBlurEvents.forEach(fn =&gt; fn())</span><span class="s3">\n    </span><span class="s1">onblur(currentHtml)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* focus 事件</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function _focusHandler(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const config = editor.config</span><span class="s3">\n    </span><span class="s1">const onfocus = config.onfocus</span><span class="s3">\n    </span><span class="s1">const currentHtml = editor.txt.html() || ''</span><span class="s3">\n    </span><span class="s1">onfocus(currentHtml)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default bindEvent</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 国际化 初始化</span><span class="s3">\n </span><span class="s1">* @author tonghan</span><span class="s3">\n </span><span class="s1">* i18next 是使用 JavaScript 编写的国际化框架</span><span class="s3">\n </span><span class="s1">* i18next 提供了标准的i18n功能，例如（复数，上下文，插值，格式）等</span><span class="s3">\n </span><span class="s1">* i18next 文档地址： https://www.i18next.com/overview/getting-started</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../index'</span><span class="s3">\n\n</span><span class="s1">function i18nextInit(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const { lang, languages } = editor.config</span><span class="s3">\n\n    </span><span class="s1">if (editor.i18next != null) {</span><span class="s3">\n        </span><span class="s1">try {</span><span class="s3">\n            </span><span class="s1">editor.i18next.init({</span><span class="s3">\n                </span><span class="s1">ns: 'wangEditor',</span><span class="s3">\n                </span><span class="s1">lng: lang,</span><span class="s3">\n                </span><span class="s1">defaultNS: 'wangEditor',</span><span class="s3">\n                </span><span class="s1">resources: languages,</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">} catch (error) {</span><span class="s3">\n            </span><span class="s1">throw new Error('i18next:' + error)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 没有引入 i18next 的替代品</span><span class="s3">\n    </span><span class="s1">editor.i18next = {</span><span class="s3">\n        </span><span class="s1">t(str: string) {</span><span class="s3">\n            </span><span class="s1">const strArr = str.split('.')</span><span class="s3">\n            </span><span class="s1">return strArr[strArr.length - 1]</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default i18nextInit</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 全屏功能</span><span class="s3">\n </span><span class="s1">* @author xiaokyo</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../index'</span><span class="s3">\n</span><span class="s1">import $ from '../../utils/dom-core'</span><span class="s3">\n\n</span><span class="s1">import '../../assets/style/full-screen.less'</span><span class="s3">\n\n</span><span class="s1">const iconFullScreenText = 'w-e-icon-fullscreen' // 全屏icon class</span><span class="s3">\n</span><span class="s1">const iconExitFullScreenText = 'w-e-icon-fullscreen_exit' // 退出全屏icon class</span><span class="s3">\n</span><span class="s1">const classfullScreenEditor = 'w-e-full-screen-editor' // 全屏添加至编辑器的class</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 设置全屏</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export const setFullScreen = (editor: Editor) =&gt; {</span><span class="s3">\n    </span><span class="s1">const $editorParent = $(editor.toolbarSelector)</span><span class="s3">\n    </span><span class="s1">const $textContainerElem = editor.$textContainerElem</span><span class="s3">\n    </span><span class="s1">const $toolbarElem = editor.$toolbarElem</span><span class="s3">\n    </span><span class="s1">const $iconElem = $toolbarElem.find(`i.${iconFullScreenText}`)</span><span class="s3">\n    </span><span class="s1">const config = editor.config</span><span class="s3">\n\n    </span><span class="s1">$iconElem.removeClass(iconFullScreenText)</span><span class="s3">\n    </span><span class="s1">$iconElem.addClass(iconExitFullScreenText)</span><span class="s3">\n    </span><span class="s1">$editorParent.addClass(classfullScreenEditor)</span><span class="s3">\n    </span><span class="s1">$editorParent.css('z-index', config.zIndexFullScreen)</span><span class="s3">\n    </span><span class="s1">const bar = $toolbarElem.getBoundingClientRect()</span><span class="s3">\n    </span><span class="s1">$textContainerElem.css('height', `calc(100% - ${bar.height}px)`)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 取消全屏</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export const setUnFullScreen = (editor: Editor) =&gt; {</span><span class="s3">\n    </span><span class="s1">const $editorParent = $(editor.toolbarSelector)</span><span class="s3">\n    </span><span class="s1">const $textContainerElem = editor.$textContainerElem</span><span class="s3">\n    </span><span class="s1">const $toolbarElem = editor.$toolbarElem</span><span class="s3">\n    </span><span class="s1">const $iconElem = $toolbarElem.find(`i.${iconExitFullScreenText}`)</span><span class="s3">\n    </span><span class="s1">const config = editor.config</span><span class="s3">\n\n    </span><span class="s1">$iconElem.removeClass(iconExitFullScreenText)</span><span class="s3">\n    </span><span class="s1">$iconElem.addClass(iconFullScreenText)</span><span class="s3">\n    </span><span class="s1">$editorParent.removeClass(classfullScreenEditor)</span><span class="s3">\n    </span><span class="s1">$editorParent.css('z-index', 'auto')</span><span class="s3">\n    </span><span class="s1">$textContainerElem.css('height', config.height + 'px')</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 初始化全屏功能</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">const initFullScreen = (editor: Editor) =&gt; {</span><span class="s3">\n    </span><span class="s1">// 当textSelector有值的时候，也就是编辑器是工具栏和编辑区域分离的情况， 则不生成全屏功能按钮</span><span class="s3">\n    </span><span class="s1">if (editor.textSelector) return</span><span class="s3">\n    </span><span class="s1">if (!editor.config.showFullScreen) return</span><span class="s3">\n    </span><span class="s1">const $toolbarElem = editor.$toolbarElem</span><span class="s3">\n    </span><span class="s1">const $elem = $(</span><span class="s3">\n        </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menu</span><span class="s3">\&quot; </span><span class="s1">data-title=</span><span class="s3">\&quot;</span><span class="s1">全屏</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n            </span><span class="s1">&lt;i class=</span><span class="s3">\&quot;</span><span class="s1">${iconFullScreenText}</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/i&gt;</span><span class="s3">\n        </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">$elem.on('click', function (e: MouseEvent) {</span><span class="s3">\n        </span><span class="s1">const $elemIcon = $(e.currentTarget).find('i')</span><span class="s3">\n        </span><span class="s1">if ($elemIcon.hasClass(iconFullScreenText)) {</span><span class="s3">\n            </span><span class="s1">$elem.attr('data-title', '取消全屏')</span><span class="s3">\n            </span><span class="s1">setFullScreen(editor)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">$elem.attr('data-title', '全屏')</span><span class="s3">\n            </span><span class="s1">setUnFullScreen(editor)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">$toolbarElem.append($elem)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default initFullScreen</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var api = require(</span><span class="s3">\&quot;</span><span class="s1">!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n            </span><span class="s1">var content = require(</span><span class="s3">\&quot;</span><span class="s1">!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/postcss-loader/src/index.js!../../../node_modules/less-loader/dist/cjs.js!./full-screen.less</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n\n            </span><span class="s1">content = content.__esModule ? content.default : content;</span><span class="s3">\n\n            </span><span class="s1">if (typeof content === 'string') {</span><span class="s3">\n              </span><span class="s1">content = [[module.id, content, '']];</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">var options = {};</span><span class="s3">\n\n</span><span class="s1">options.insert = </span><span class="s3">\&quot;</span><span class="s1">head</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n</span><span class="s1">options.singleton = false;</span><span class="s3">\n\n</span><span class="s1">var update = api(content, options);</span><span class="s3">\n\n\n\n</span><span class="s1">module.exports = content.locals || {};&quot;</span><span class="s0">,</span><span class="s1">&quot;// Imports</span><span class="s3">\n</span><span class="s1">var ___CSS_LOADER_API_IMPORT___ = require(</span><span class="s3">\&quot;</span><span class="s1">../../../node_modules/css-loader/dist/runtime/api.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">exports = ___CSS_LOADER_API_IMPORT___(false);</span><span class="s3">\n</span><span class="s1">// Module</span><span class="s3">\n</span><span class="s1">exports.push([module.id, </span><span class="s3">\&quot;</span><span class="s1">.w-e-full-screen-editor {</span><span class="s3">\\</span><span class="s1">n  position: fixed;</span><span class="s3">\\</span><span class="s1">n  width: 100%!important;</span><span class="s3">\\</span><span class="s1">n  height: 100%!important;</span><span class="s3">\\</span><span class="s1">n  left: 0;</span><span class="s3">\\</span><span class="s1">n  top: 0;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n</span><span class="s3">\&quot;</span><span class="s1">, </span><span class="s3">\&quot;\&quot;</span><span class="s1">]);</span><span class="s3">\n</span><span class="s1">// Exports</span><span class="s3">\n</span><span class="s1">module.exports = exports;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 滚动到指定锚点</span><span class="s3">\n </span><span class="s1">* @author zhengwenjian</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../index'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 编辑器滚动到指定锚点</span><span class="s3">\n </span><span class="s1">* @param editor 编辑器实例</span><span class="s3">\n </span><span class="s1">* @param id 标题锚点id</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">const scrollToHead = (editor: Editor, id: string) =&gt; {</span><span class="s3">\n    </span><span class="s1">const $textElem = editor.isEnable</span><span class="s3">\n        </span><span class="s1">? editor.$textElem</span><span class="s3">\n        </span><span class="s1">: editor.$textContainerElem.find('.w-e-content-mantle')</span><span class="s3">\n    </span><span class="s1">const $targetHead = $textElem.find(`[id='${id}']`)</span><span class="s3">\n    </span><span class="s1">const targetTop = $targetHead.getOffsetData().top</span><span class="s3">\n    </span><span class="s1">$textElem.scrollTop(targetTop)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default scrollToHead</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description z-index 管理器</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import Editor from '../index'</span><span class="s3">\n</span><span class="s1">import style from '../../config/style'</span><span class="s3">\n\n</span><span class="s1">const tier = {</span><span class="s3">\n    </span><span class="s1">menu: 2, // 显示状态下的菜单栏</span><span class="s3">\n    </span><span class="s1">panel: 2,</span><span class="s3">\n    </span><span class="s1">toolbar: 1, // 菜单栏父容器</span><span class="s3">\n    </span><span class="s1">tooltip: 1, // tooltip</span><span class="s3">\n    </span><span class="s1">textContainer: 1, // 编辑区域</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">type Tier = typeof tier</span><span class="s3">\n\n</span><span class="s1">type TierKey = keyof Tier</span><span class="s3">\n</span><span class="s1">export default class ZIndex {</span><span class="s3">\n    </span><span class="s1">// 层级参数</span><span class="s3">\n    </span><span class="s1">private tier: Tier = tier</span><span class="s3">\n\n    </span><span class="s1">// 默认值</span><span class="s3">\n    </span><span class="s1">private baseZIndex = style.zIndex</span><span class="s3">\n\n    </span><span class="s1">// 获取 tierName 对应的 z-index 的值。如果 tierName 未定义则返回默认的 z-index 值</span><span class="s3">\n    </span><span class="s1">get(tierName?: TierKey): number {</span><span class="s3">\n        </span><span class="s1">if (tierName &amp;&amp; this.tier[tierName]) {</span><span class="s3">\n            </span><span class="s1">return this.baseZIndex + this.tier[tierName]</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return this.baseZIndex</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 初始化</span><span class="s3">\n    </span><span class="s1">init(editor: Editor) {</span><span class="s3">\n        </span><span class="s1">if (this.baseZIndex == style.zIndex) {</span><span class="s3">\n            </span><span class="s1">this.baseZIndex = editor.config.zIndex</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 编辑器 change 事件</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Editor from '../index'</span><span class="s3">\n</span><span class="s1">import Mutation from '../../utils/observer/mutation'</span><span class="s3">\n</span><span class="s1">import { debounce } from '../../utils/util'</span><span class="s3">\n</span><span class="s1">import { EMPTY_FN } from '../../utils/const'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 剔除编辑区容器的 attribute 变化中的非 contenteditable 变化</span><span class="s3">\n </span><span class="s1">* @param mutations MutationRecord[]</span><span class="s3">\n </span><span class="s1">* @param tar 编辑区容器的 DOM 节点</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function mutationsFilter(mutations: MutationRecord[], tar: Node) {</span><span class="s3">\n    </span><span class="s1">// 剔除编辑区容器的 attribute 变化中的非 contenteditable 变化</span><span class="s3">\n    </span><span class="s1">return mutations.filter(({ type, target, attributeName }) =&gt; {</span><span class="s3">\n        </span><span class="s1">return (</span><span class="s3">\n            </span><span class="s1">type != 'attributes' ||</span><span class="s3">\n            </span><span class="s1">(type == 'attributes' &amp;&amp; (attributeName == 'contenteditable' || target != tar))</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Change 实现</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default class Change extends Mutation {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 变化的数据集合</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private data: MutationRecord[] = []</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 异步保存数据</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private asyncSave: Function = EMPTY_FN</span><span class="s3">\n\n    </span><span class="s1">constructor(public editor: Editor) {</span><span class="s3">\n        </span><span class="s1">super((mutations, observer) =&gt; {</span><span class="s3">\n            </span><span class="s1">// 数据过滤</span><span class="s3">\n            </span><span class="s1">mutations = mutationsFilter(mutations, observer.target as Node)</span><span class="s3">\n\n            </span><span class="s1">// 存储数据</span><span class="s3">\n            </span><span class="s1">this.data.push(...mutations)</span><span class="s3">\n\n            </span><span class="s1">// 标准模式下</span><span class="s3">\n            </span><span class="s1">if (!editor.isCompatibleMode) {</span><span class="s3">\n                </span><span class="s1">// 在非中文输入状态下时才保存数据</span><span class="s3">\n                </span><span class="s1">if (!editor.isComposing) {</span><span class="s3">\n                    </span><span class="s1">return this.asyncSave()</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">// 兼容模式下</span><span class="s3">\n            </span><span class="s1">else {</span><span class="s3">\n                </span><span class="s1">this.asyncSave()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 保存变化的数据并发布 change event</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private save() {</span><span class="s3">\n        </span><span class="s1">// 有数据</span><span class="s3">\n        </span><span class="s1">if (this.data.length) {</span><span class="s3">\n            </span><span class="s1">// 保存变化数据</span><span class="s3">\n            </span><span class="s1">this.editor.history.save(this.data)</span><span class="s3">\n\n            </span><span class="s1">// 清除缓存</span><span class="s3">\n            </span><span class="s1">this.data.length = 0</span><span class="s3">\n\n            </span><span class="s1">this.emit()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 发布 change event</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public emit() {</span><span class="s3">\n        </span><span class="s1">// 执行 onchange 回调</span><span class="s3">\n        </span><span class="s1">this.editor.txt.eventHooks.changeEvents.forEach(fn =&gt; fn())</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 重写 observe</span><span class="s3">\n    </span><span class="s1">public observe() {</span><span class="s3">\n        </span><span class="s1">super.observe(this.editor.$textElem.elems[0])</span><span class="s3">\n\n        </span><span class="s1">let timeout = this.editor.config.onchangeTimeout</span><span class="s3">\n        </span><span class="s1">this.asyncSave = debounce(() =&gt; {</span><span class="s3">\n            </span><span class="s1">this.save()</span><span class="s3">\n        </span><span class="s1">}, timeout)</span><span class="s3">\n\n        </span><span class="s1">if (!this.editor.isCompatibleMode) {</span><span class="s3">\n            </span><span class="s1">this.editor.$textElem.on('compositionend', () =&gt; {</span><span class="s3">\n                </span><span class="s1">this.asyncSave()</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 封装 MutationObserver</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">export type callback = (mutations: MutationRecord[], observer: Mutation) =&gt; void</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 封装 MutationObserver，抽离成公共类</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default class Mutation {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* MutationObserver 实例</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected observer: MutationObserver</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 被监听的 Node 节点（可继承的，方便扩展但又不会在外部被修改）</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected node?: Node</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 默认的 MutationObserverInit 配置</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected options: MutationObserverInit = {</span><span class="s3">\n        </span><span class="s1">subtree: true,</span><span class="s3">\n        </span><span class="s1">childList: true,</span><span class="s3">\n        </span><span class="s1">attributes: true,</span><span class="s3">\n        </span><span class="s1">attributeOldValue: true,</span><span class="s3">\n        </span><span class="s1">characterData: true,</span><span class="s3">\n        </span><span class="s1">characterDataOldValue: true,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* MutationCallback</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected callback: (mutations: MutationRecord[]) =&gt; void</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 构造器</span><span class="s3">\n     </span><span class="s1">* @param fn 发生变化时执行的回调函数</span><span class="s3">\n     </span><span class="s1">* @param options 自定义配置项</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">constructor(fn: callback, options?: MutationObserverInit) {</span><span class="s3">\n        </span><span class="s1">this.callback = mutations =&gt; {</span><span class="s3">\n            </span><span class="s1">fn(mutations, this)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">this.observer = new MutationObserver(this.callback)</span><span class="s3">\n        </span><span class="s1">options &amp;&amp; (this.options = options)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public get target() {</span><span class="s3">\n        </span><span class="s1">return this.node</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 绑定监听节点（初次绑定有效）</span><span class="s3">\n     </span><span class="s1">* @param node 需要被监听的节点</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public observe(node: Node) {</span><span class="s3">\n        </span><span class="s1">if (!(this.node instanceof Node)) {</span><span class="s3">\n            </span><span class="s1">this.node = node</span><span class="s3">\n            </span><span class="s1">this.connect()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 连接监听器（开始观察）</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public connect() {</span><span class="s3">\n        </span><span class="s1">if (this.node) {</span><span class="s3">\n            </span><span class="s1">this.observer.observe(this.node, this.options)</span><span class="s3">\n            </span><span class="s1">return this</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">throw new Error('还未初始化绑定，请您先绑定有效的 Node 节点')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 断开监听器（停止观察）</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public disconnect() {</span><span class="s3">\n        </span><span class="s1">let list = this.observer.takeRecords()</span><span class="s3">\n        </span><span class="s1">list.length &amp;&amp; this.callback(list)</span><span class="s3">\n        </span><span class="s1">this.observer.disconnect()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 历史记录</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import ContentCache from './data/content'</span><span class="s3">\n</span><span class="s1">import ScrollCache from './data/scroll'</span><span class="s3">\n</span><span class="s1">import RangeCache from './data/range'</span><span class="s3">\n</span><span class="s1">import Editor from '../index'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 历史记录（撤销、恢复）</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default class History {</span><span class="s3">\n    </span><span class="s1">// 数据缓存器实例</span><span class="s3">\n    </span><span class="s1">private content: ContentCache</span><span class="s3">\n\n    </span><span class="s1">// scroll 缓存</span><span class="s3">\n    </span><span class="s1">private scroll: ScrollCache</span><span class="s3">\n\n    </span><span class="s1">// Range 缓存</span><span class="s3">\n    </span><span class="s1">private range: RangeCache</span><span class="s3">\n\n    </span><span class="s1">constructor(public editor: Editor) {</span><span class="s3">\n        </span><span class="s1">this.content = new ContentCache(editor)</span><span class="s3">\n        </span><span class="s1">this.scroll = new ScrollCache(editor)</span><span class="s3">\n        </span><span class="s1">this.range = new RangeCache(editor)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">*  获取缓存中的数据长度。格式为：[正常的数据的条数，被撤销的数据的条数]</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public get size() {</span><span class="s3">\n        </span><span class="s1">return this.scroll.size</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 初始化绑定。在 editor.create() 结尾时调用</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public observe() {</span><span class="s3">\n        </span><span class="s1">this.content.observe()</span><span class="s3">\n        </span><span class="s1">this.scroll.observe()</span><span class="s3">\n        </span><span class="s1">// 标准模式下才进行初始化绑定</span><span class="s3">\n        </span><span class="s1">!this.editor.isCompatibleMode &amp;&amp; this.range.observe()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 保存数据</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public save(mutations: MutationRecord[]) {</span><span class="s3">\n        </span><span class="s1">if (mutations.length) {</span><span class="s3">\n            </span><span class="s1">this.content.save(mutations)</span><span class="s3">\n            </span><span class="s1">this.scroll.save()</span><span class="s3">\n            </span><span class="s1">// 标准模式下才进行缓存</span><span class="s3">\n            </span><span class="s1">!this.editor.isCompatibleMode &amp;&amp; this.range.save()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 撤销</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public revoke() {</span><span class="s3">\n        </span><span class="s1">this.editor.change.disconnect()</span><span class="s3">\n        </span><span class="s1">const res = this.content.revoke()</span><span class="s3">\n        </span><span class="s1">if (res) {</span><span class="s3">\n            </span><span class="s1">this.scroll.revoke()</span><span class="s3">\n            </span><span class="s1">// 标准模式下才执行</span><span class="s3">\n            </span><span class="s1">if (!this.editor.isCompatibleMode) {</span><span class="s3">\n                </span><span class="s1">this.range.revoke()</span><span class="s3">\n                </span><span class="s1">this.editor.$textElem.focus()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">this.editor.change.connect()</span><span class="s3">\n        </span><span class="s1">// 如果用户在 onchange 中修改了内容（DOM），那么缓存中的节点数据可能不连贯了，不连贯的数据必将导致恢复失败，所以必须将用户的 onchange 处于监控状态中</span><span class="s3">\n        </span><span class="s1">res &amp;&amp; this.editor.change.emit()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 恢复</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public restore() {</span><span class="s3">\n        </span><span class="s1">this.editor.change.disconnect()</span><span class="s3">\n        </span><span class="s1">const res = this.content.restore()</span><span class="s3">\n        </span><span class="s1">if (res) {</span><span class="s3">\n            </span><span class="s1">this.scroll.restore()</span><span class="s3">\n            </span><span class="s1">// 标准模式下才执行</span><span class="s3">\n            </span><span class="s1">if (!this.editor.isCompatibleMode) {</span><span class="s3">\n                </span><span class="s1">this.range.restore()</span><span class="s3">\n                </span><span class="s1">this.editor.$textElem.focus()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">this.editor.change.connect()</span><span class="s3">\n        </span><span class="s1">// 与 revoke 同理</span><span class="s3">\n        </span><span class="s1">res &amp;&amp; this.editor.change.emit()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 整合差异备份和内容备份，进行统一管理</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import NodeCache from './node'</span><span class="s3">\n</span><span class="s1">import HtmlCache from './html'</span><span class="s3">\n</span><span class="s1">import Editor from '../../index'</span><span class="s3">\n\n</span><span class="s1">export default class ContentCache {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 内容备份的管理器</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public cache?: HtmlCache | NodeCache</span><span class="s3">\n\n    </span><span class="s1">constructor(public editor: Editor) {}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 初始化绑定</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">observe() {</span><span class="s3">\n        </span><span class="s1">if (this.editor.isCompatibleMode) {</span><span class="s3">\n            </span><span class="s1">// 兼容模式（内容备份）</span><span class="s3">\n            </span><span class="s1">this.cache = new HtmlCache(this.editor)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">// 标准模式（差异备份/节点备份）</span><span class="s3">\n            </span><span class="s1">this.cache = new NodeCache(this.editor)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">this.cache.observe()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 保存</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public save(mutations: MutationRecord[]) {</span><span class="s3">\n        </span><span class="s1">if (this.editor.isCompatibleMode) {</span><span class="s3">\n            </span><span class="s1">;(this.cache as HtmlCache).save()</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">;(this.cache as NodeCache).compile(mutations)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 撤销</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public revoke() {</span><span class="s3">\n        </span><span class="s1">return this.cache?.revoke()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 恢复</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public restore() {</span><span class="s3">\n        </span><span class="s1">return this.cache?.restore()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 差异备份</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Cache from '../../../../utils/data-structure/cache'</span><span class="s3">\n</span><span class="s1">import compile from './compile'</span><span class="s3">\n</span><span class="s1">import { revoke, restore } from './decompilation'</span><span class="s3">\n</span><span class="s1">import { Compile } from '../type'</span><span class="s3">\n</span><span class="s1">import Editor from '../../../index'</span><span class="s3">\n\n</span><span class="s1">export default class NodeCache extends Cache&lt;Compile[]&gt; {</span><span class="s3">\n    </span><span class="s1">constructor(public editor: Editor) {</span><span class="s3">\n        </span><span class="s1">super(editor.config.historyMaxSize)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public observe() {</span><span class="s3">\n        </span><span class="s1">this.resetMaxSize(this.editor.config.historyMaxSize)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 编译并保存数据</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public compile(data: MutationRecord[]) {</span><span class="s3">\n        </span><span class="s1">this.save(compile(data))</span><span class="s3">\n        </span><span class="s1">return this</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 撤销</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public revoke() {</span><span class="s3">\n        </span><span class="s1">return super.revoke(data =&gt; {</span><span class="s3">\n            </span><span class="s1">revoke(data)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 恢复</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public restore() {</span><span class="s3">\n        </span><span class="s1">return super.restore(data =&gt; {</span><span class="s3">\n            </span><span class="s1">restore(data)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 数据结构 - 栈</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 栈（限制最大数据条数，栈满后可以继续入栈，而先入栈的数据将失效）</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">// 取名灵感来自 Math.ceil，向上取有效值</span><span class="s3">\n</span><span class="s1">export class CeilStack&lt;T&gt; {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 数据缓存</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected data: T[] = []</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 栈的最大长度。为零则长度不限</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected max: number = 0</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 标识是否重设过 max 值</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected reset: boolean = false</span><span class="s3">\n\n    </span><span class="s1">constructor(max: number = 0) {</span><span class="s3">\n        </span><span class="s1">max = Math.abs(max)</span><span class="s3">\n        </span><span class="s1">max &amp;&amp; (this.max = max)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 允许用户重设一次 max 值</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public resetMax(maxSize: number) {</span><span class="s3">\n        </span><span class="s1">maxSize = Math.abs(maxSize)</span><span class="s3">\n        </span><span class="s1">if (!this.reset &amp;&amp; !isNaN(maxSize)) {</span><span class="s3">\n            </span><span class="s1">this.max = maxSize</span><span class="s3">\n            </span><span class="s1">this.reset = true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 当前栈中的数据条数</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public get size() {</span><span class="s3">\n        </span><span class="s1">return this.data.length</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 入栈</span><span class="s3">\n     </span><span class="s1">* @param data 入栈的数据</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public instack(data: T) {</span><span class="s3">\n        </span><span class="s1">this.data.unshift(data)</span><span class="s3">\n        </span><span class="s1">if (this.max &amp;&amp; this.size &gt; this.max) {</span><span class="s3">\n            </span><span class="s1">this.data.length = this.max</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return this</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 出栈</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public outstack(): T | undefined {</span><span class="s3">\n        </span><span class="s1">return this.data.shift()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 清空栈</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public clear() {</span><span class="s3">\n        </span><span class="s1">this.data.length = 0</span><span class="s3">\n        </span><span class="s1">return this</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 数据整理</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import { TargetPosition, DiffNodes, Compile } from '../type'</span><span class="s3">\n</span><span class="s1">import { UA, toArray } from '../../../../utils/util'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 数据类型</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function compileType(data: string) {</span><span class="s3">\n    </span><span class="s1">switch (data) {</span><span class="s3">\n        </span><span class="s1">case 'childList':</span><span class="s3">\n            </span><span class="s1">return 'node'</span><span class="s3">\n        </span><span class="s1">case 'attributes':</span><span class="s3">\n            </span><span class="s1">return 'attr'</span><span class="s3">\n        </span><span class="s1">default:</span><span class="s3">\n            </span><span class="s1">return 'text'</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 获取当前的文本内容</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function compileValue(data: MutationRecord) {</span><span class="s3">\n    </span><span class="s1">switch (data.type) {</span><span class="s3">\n        </span><span class="s1">case 'attributes':</span><span class="s3">\n            </span><span class="s1">return (data.target as Element).getAttribute(data.attributeName as string) || ''</span><span class="s3">\n        </span><span class="s1">case 'characterData':</span><span class="s3">\n            </span><span class="s1">return data.target.textContent</span><span class="s3">\n        </span><span class="s1">default:</span><span class="s3">\n            </span><span class="s1">return ''</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* addedNodes/removedNodes</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function complieNodes(data: MutationRecord) {</span><span class="s3">\n    </span><span class="s1">const temp: DiffNodes = {}</span><span class="s3">\n    </span><span class="s1">if (data.addedNodes.length) {</span><span class="s3">\n        </span><span class="s1">temp.add = toArray(data.addedNodes)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (data.removedNodes.length) {</span><span class="s3">\n        </span><span class="s1">temp.remove = toArray(data.removedNodes)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return temp</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* addedNodes/removedNodes 的相对位置</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function compliePosition(data: MutationRecord) {</span><span class="s3">\n    </span><span class="s1">let temp: TargetPosition</span><span class="s3">\n    </span><span class="s1">if (data.previousSibling) {</span><span class="s3">\n        </span><span class="s1">temp = {</span><span class="s3">\n            </span><span class="s1">type: 'before',</span><span class="s3">\n            </span><span class="s1">target: data.previousSibling,</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">} else if (data.nextSibling) {</span><span class="s3">\n        </span><span class="s1">temp = {</span><span class="s3">\n            </span><span class="s1">type: 'after',</span><span class="s3">\n            </span><span class="s1">target: data.nextSibling,</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">temp = {</span><span class="s3">\n            </span><span class="s1">type: 'parent',</span><span class="s3">\n            </span><span class="s1">target: data.target,</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return temp</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 补全 Firefox 数据的特殊标签</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">const tag = ['UL', 'OL', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6']</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 将 MutationRecord 转换成自定义格式的数据</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default function compile(data: MutationRecord[]) {</span><span class="s3">\n    </span><span class="s1">const temp: Compile[] = []</span><span class="s3">\n    </span><span class="s1">// 以下两个变量是兼容 Firefox 时使用到的</span><span class="s3">\n    </span><span class="s1">// 前一次操作为删除元素节点</span><span class="s3">\n    </span><span class="s1">let removeNode: Node | false = false</span><span class="s3">\n    </span><span class="s1">// 连续的节点删除记录</span><span class="s3">\n    </span><span class="s1">const removeCache: Node[] = []</span><span class="s3">\n    </span><span class="s1">data.forEach((record, index) =&gt; {</span><span class="s3">\n        </span><span class="s1">const item: Compile = {</span><span class="s3">\n            </span><span class="s1">type: compileType(record.type),</span><span class="s3">\n            </span><span class="s1">target: record.target,</span><span class="s3">\n            </span><span class="s1">attr: record.attributeName || '',</span><span class="s3">\n            </span><span class="s1">value: compileValue(record) || '',</span><span class="s3">\n            </span><span class="s1">oldValue: record.oldValue || '',</span><span class="s3">\n            </span><span class="s1">nodes: complieNodes(record),</span><span class="s3">\n            </span><span class="s1">position: compliePosition(record),</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">temp.push(item)</span><span class="s3">\n        </span><span class="s1">// 兼容 Firefox，补全数据（这几十行代码写得吐血，跟 IE 有得一拼）</span><span class="s3">\n        </span><span class="s1">if (!UA.isFirefox) {</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// 正常的数据：缩进、行高、超链接、对齐方式、引用、插入表情、插入图片、分割线、表格、插入代码</span><span class="s3">\n        </span><span class="s1">// 普通的数据补全：标题（纯文本内容）、加粗、斜体、删除线、下划线、颜色、背景色、字体、字号、列表（纯文本内容）</span><span class="s3">\n        </span><span class="s1">// 特殊的数据补全：标题（包含 HTMLElement）、列表（包含 HTMLElement 或 ul -&gt; ol 或 ol -&gt; ul 或 Enter）</span><span class="s3">\n        </span><span class="s1">if (removeNode &amp;&amp; record.addedNodes.length &amp;&amp; record.addedNodes[0].nodeType == 1) {</span><span class="s3">\n            </span><span class="s1">// 需要被全数据的目标节点</span><span class="s3">\n            </span><span class="s1">const replenishNode = record.addedNodes[0]</span><span class="s3">\n            </span><span class="s1">const replenishData: Compile = {</span><span class="s3">\n                </span><span class="s1">type: 'node',</span><span class="s3">\n                </span><span class="s1">target: replenishNode,</span><span class="s3">\n                </span><span class="s1">attr: '',</span><span class="s3">\n                </span><span class="s1">value: '',</span><span class="s3">\n                </span><span class="s1">oldValue: '',</span><span class="s3">\n                </span><span class="s1">nodes: {</span><span class="s3">\n                    </span><span class="s1">add: [removeNode],</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n                </span><span class="s1">position: {</span><span class="s3">\n                    </span><span class="s1">type: 'parent',</span><span class="s3">\n                    </span><span class="s1">target: replenishNode,</span><span class="s3">\n                </span><span class="s1">},</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">// 特殊的标签：['UL', 'OL', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6']</span><span class="s3">\n            </span><span class="s1">if (tag.indexOf(replenishNode.nodeName) != -1) {</span><span class="s3">\n                </span><span class="s1">replenishData.nodes.add = toArray(replenishNode.childNodes)</span><span class="s3">\n                </span><span class="s1">temp.push(replenishData)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">// 上一个删除元素是文本节点</span><span class="s3">\n            </span><span class="s1">else if (removeNode.nodeType == 3) {</span><span class="s3">\n                </span><span class="s1">if (contains(replenishNode, removeCache)) {</span><span class="s3">\n                    </span><span class="s1">replenishData.nodes.add = toArray(replenishNode.childNodes)</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n                </span><span class="s1">temp.push(replenishData)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">// 上一个删除元素是 Element &amp;&amp; 由近到远的删除元素至少有一个是需要补全数据节点的子节点</span><span class="s3">\n            </span><span class="s1">else if (</span><span class="s3">\n                </span><span class="s1">tag.indexOf(record.target.nodeName) == -1 &amp;&amp;</span><span class="s3">\n                </span><span class="s1">contains(replenishNode, removeCache)</span><span class="s3">\n            </span><span class="s1">) {</span><span class="s3">\n                </span><span class="s1">replenishData.nodes.add = toArray(replenishNode.childNodes)</span><span class="s3">\n                </span><span class="s1">temp.push(replenishData)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// 记录本次的节点信息</span><span class="s3">\n        </span><span class="s1">if (item.type == 'node' &amp;&amp; record.removedNodes.length == 1) {</span><span class="s3">\n            </span><span class="s1">removeNode = record.removedNodes[0]</span><span class="s3">\n            </span><span class="s1">removeCache.push(removeNode)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">removeNode = false</span><span class="s3">\n            </span><span class="s1">removeCache.length = 0</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">return temp</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// 删除元素的历史记录中包含有多少个目标节点的子元素</span><span class="s3">\n</span><span class="s1">function contains(tar: Node, childs: Node[]) {</span><span class="s3">\n    </span><span class="s1">let count = 0</span><span class="s3">\n    </span><span class="s1">for (let i = childs.length - 1; i &gt; 0; i--) {</span><span class="s3">\n        </span><span class="s1">if (tar.contains(childs[i])) {</span><span class="s3">\n            </span><span class="s1">count++</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">break</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return count</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 撤销 - 逆向操作，删除节点</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import { Compile } from '../type'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 将节点添加到 DOM 树中</span><span class="s3">\n </span><span class="s1">* @param data 数据项</span><span class="s3">\n </span><span class="s1">* @param list 节点集合（addedNodes 或 removedNodes）</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function insertNode(data: Compile, list: Node[]) {</span><span class="s3">\n    </span><span class="s1">let reference = data.position.target</span><span class="s3">\n    </span><span class="s1">switch (data.position.type) {</span><span class="s3">\n        </span><span class="s1">// reference 在这些节点的前面</span><span class="s3">\n        </span><span class="s1">case 'before':</span><span class="s3">\n            </span><span class="s1">if (reference.nextSibling) {</span><span class="s3">\n                </span><span class="s1">reference = reference.nextSibling</span><span class="s3">\n                </span><span class="s1">list.forEach((item: Node) =&gt; {</span><span class="s3">\n                    </span><span class="s1">data.target.insertBefore(item, reference)</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n                </span><span class="s1">list.forEach((item: Node) =&gt; {</span><span class="s3">\n                    </span><span class="s1">data.target.appendChild(item)</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">break</span><span class="s3">\n        </span><span class="s1">// reference 在这些节点的后面</span><span class="s3">\n        </span><span class="s1">case 'after':</span><span class="s3">\n            </span><span class="s1">list.forEach((item: Node) =&gt; {</span><span class="s3">\n                </span><span class="s1">data.target.insertBefore(item, reference)</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">break</span><span class="s3">\n        </span><span class="s1">// parent</span><span class="s3">\n        </span><span class="s1">// reference 是这些节点的父节点</span><span class="s3">\n        </span><span class="s1">default:</span><span class="s3">\n            </span><span class="s1">list.forEach((item: Node) =&gt; {</span><span class="s3">\n                </span><span class="s1">reference.appendChild(item)</span><span class="s3">\n            </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">break</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/* ------------------------------------------------------------------ 撤销逻辑 ------------------------------------------------------------------ */</span><span class="s3">\n\n</span><span class="s1">function revokeNode(data: Compile) {</span><span class="s3">\n    </span><span class="s1">for (let [relative, list] of Object.entries(data.nodes)) {</span><span class="s3">\n        </span><span class="s1">switch (relative) {</span><span class="s3">\n            </span><span class="s1">// 反向操作，将这些节点从 DOM 中移除</span><span class="s3">\n            </span><span class="s1">case 'add':</span><span class="s3">\n                </span><span class="s1">list.forEach((item: Node) =&gt; {</span><span class="s3">\n                    </span><span class="s1">data.target.removeChild(item)</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n                </span><span class="s1">break</span><span class="s3">\n            </span><span class="s1">// remove（反向操作，将这些节点添加到 DOM 中）</span><span class="s3">\n            </span><span class="s1">default: {</span><span class="s3">\n                </span><span class="s1">insertNode(data, list)</span><span class="s3">\n                </span><span class="s1">break</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 撤销 attribute</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function revokeAttr(data: Compile) {</span><span class="s3">\n    </span><span class="s1">let target = data.target as HTMLElement</span><span class="s3">\n    </span><span class="s1">if (data.oldValue == null) {</span><span class="s3">\n        </span><span class="s1">target.removeAttribute(data.attr)</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">target.setAttribute(data.attr, data.oldValue)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 撤销文本内容</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function revokeText(data: Compile) {</span><span class="s3">\n    </span><span class="s1">data.target.textContent = data.oldValue</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">const revokeFns = {</span><span class="s3">\n    </span><span class="s1">node: revokeNode,</span><span class="s3">\n    </span><span class="s1">text: revokeText,</span><span class="s3">\n    </span><span class="s1">attr: revokeAttr,</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// 撤销 - 对外暴露的接口</span><span class="s3">\n</span><span class="s1">export function revoke(data: Compile[]) {</span><span class="s3">\n    </span><span class="s1">for (let i = data.length - 1; i &gt; -1; i--) {</span><span class="s3">\n        </span><span class="s1">let item = data[i]</span><span class="s3">\n        </span><span class="s1">revokeFns[item.type](item)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/* ------------------------------------------------------------------ 恢复逻辑 ------------------------------------------------------------------ */</span><span class="s3">\n\n</span><span class="s1">function restoreNode(data: Compile) {</span><span class="s3">\n    </span><span class="s1">for (let [relative, list] of Object.entries(data.nodes)) {</span><span class="s3">\n        </span><span class="s1">switch (relative) {</span><span class="s3">\n            </span><span class="s1">case 'add': {</span><span class="s3">\n                </span><span class="s1">insertNode(data, list)</span><span class="s3">\n                </span><span class="s1">break</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">// remove</span><span class="s3">\n            </span><span class="s1">default: {</span><span class="s3">\n                </span><span class="s1">list.forEach((item: Node) =&gt; {</span><span class="s3">\n                    </span><span class="s1">;(item.parentNode as Node).removeChild(item)</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n                </span><span class="s1">break</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function restoreText(data: Compile) {</span><span class="s3">\n    </span><span class="s1">data.target.textContent = data.value</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function restoreAttr(data: Compile) {</span><span class="s3">\n    </span><span class="s1">;(data.target as HTMLElement).setAttribute(data.attr, data.value)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">const restoreFns = {</span><span class="s3">\n    </span><span class="s1">node: restoreNode,</span><span class="s3">\n    </span><span class="s1">text: restoreText,</span><span class="s3">\n    </span><span class="s1">attr: restoreAttr,</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// 恢复 - 对外暴露的接口</span><span class="s3">\n</span><span class="s1">export function restore(data: Compile[]) {</span><span class="s3">\n    </span><span class="s1">for (let item of data) {</span><span class="s3">\n        </span><span class="s1">restoreFns[item.type](item)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 完整的内容备份，每次变化都将备份整个编辑器的内容</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import Editor from '../../../index'</span><span class="s3">\n</span><span class="s1">import { TailChain } from '../../../../utils/data-structure/chain'</span><span class="s3">\n\n</span><span class="s1">export default class HtmlCache {</span><span class="s3">\n    </span><span class="s1">// 缓存数据</span><span class="s3">\n    </span><span class="s1">private data: TailChain&lt;string&gt;</span><span class="s3">\n\n    </span><span class="s1">constructor(public editor: Editor) {</span><span class="s3">\n        </span><span class="s1">this.data = new TailChain()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 初始化绑定</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">observe() {</span><span class="s3">\n        </span><span class="s1">this.data.resetMax(this.editor.config.historyMaxSize)</span><span class="s3">\n        </span><span class="s1">// 保存初始化值</span><span class="s3">\n        </span><span class="s1">this.data.insertLast(this.editor.$textElem.html())</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 保存</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public save() {</span><span class="s3">\n        </span><span class="s1">this.data.insertLast(this.editor.$textElem.html())</span><span class="s3">\n        </span><span class="s1">return this</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 撤销</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public revoke() {</span><span class="s3">\n        </span><span class="s1">let data = this.data.prev()</span><span class="s3">\n        </span><span class="s1">if (data) {</span><span class="s3">\n            </span><span class="s1">this.editor.$textElem.html(data)</span><span class="s3">\n            </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 恢复</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public restore() {</span><span class="s3">\n        </span><span class="s1">let data = this.data.next()</span><span class="s3">\n        </span><span class="s1">if (data) {</span><span class="s3">\n            </span><span class="s1">this.editor.$textElem.html(data)</span><span class="s3">\n            </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 数据结构 - 链表</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 特殊链表（数据尾插入、插入前自动清理指针后边的数据、插入后指针永远定位于最后一位元素、可限制链表长度、指针双向移动）</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export class TailChain&lt;T&gt; {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 链表数据</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected data: T[] = []</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 链表最大长度，零表示长度不限</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected max: number = 0</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 指针</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">protected point = 0</span><span class="s3">\n\n    </span><span class="s1">// 当前指针是否人为操作过</span><span class="s3">\n    </span><span class="s1">protected isRe = false</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 允许用户重设一次 max 值</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">resetMax(maxSize: number) {</span><span class="s3">\n        </span><span class="s1">maxSize = Math.abs(maxSize)</span><span class="s3">\n        </span><span class="s1">maxSize &amp;&amp; (this.max = maxSize)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 当前链表的长度</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">get size() {</span><span class="s3">\n        </span><span class="s1">return this.data.length</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 尾插入</span><span class="s3">\n     </span><span class="s1">* @param data 插入的数据</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public insertLast&lt;K extends T&gt;(data: K) {</span><span class="s3">\n        </span><span class="s1">// 人为操作过指针，清除指针后面的元素</span><span class="s3">\n        </span><span class="s1">if (this.isRe) {</span><span class="s3">\n            </span><span class="s1">this.data.splice(this.point + 1)</span><span class="s3">\n            </span><span class="s1">this.isRe = false</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">this.data.push(data)</span><span class="s3">\n        </span><span class="s1">// 超出链表最大长度</span><span class="s3">\n        </span><span class="s1">while (this.max &amp;&amp; this.size &gt; this.max) {</span><span class="s3">\n            </span><span class="s1">this.data.shift()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// 从新定位指针到最后一个元素</span><span class="s3">\n        </span><span class="s1">this.point = this.size - 1</span><span class="s3">\n        </span><span class="s1">return this</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取当前指针元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public current(): T | undefined {</span><span class="s3">\n        </span><span class="s1">return this.data[this.point]</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取上一指针元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public prev(): T | undefined {</span><span class="s3">\n        </span><span class="s1">!this.isRe &amp;&amp; (this.isRe = true)</span><span class="s3">\n        </span><span class="s1">this.point--</span><span class="s3">\n        </span><span class="s1">if (this.point &lt; 0) {</span><span class="s3">\n            </span><span class="s1">this.point = 0</span><span class="s3">\n            </span><span class="s1">return undefined</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return this.current()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 下一指针元素</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public next(): T | undefined {</span><span class="s3">\n        </span><span class="s1">!this.isRe &amp;&amp; (this.isRe = true)</span><span class="s3">\n        </span><span class="s1">this.point++</span><span class="s3">\n        </span><span class="s1">if (this.point &gt;= this.size) {</span><span class="s3">\n            </span><span class="s1">this.point = this.size - 1</span><span class="s3">\n            </span><span class="s1">return undefined</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return this.current()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 记录 scrollTop</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Cache from '../../../../utils/data-structure/cache'</span><span class="s3">\n</span><span class="s1">import Editor from '../../../index'</span><span class="s3">\n</span><span class="s1">import { ScrollItem } from '../type'</span><span class="s3">\n\n</span><span class="s1">export default class ScrollCache extends Cache&lt;ScrollItem&gt; {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 上一次的 scrollTop</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private last: number = 0</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 编辑区容器元素节点</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private target: Element</span><span class="s3">\n\n    </span><span class="s1">constructor(public editor: Editor) {</span><span class="s3">\n        </span><span class="s1">super(editor.config.historyMaxSize)</span><span class="s3">\n        </span><span class="s1">this.target = editor.$textElem.elems[0]</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 给编辑区容器绑定 scroll 事件</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public observe() {</span><span class="s3">\n        </span><span class="s1">this.target = this.editor.$textElem.elems[0]</span><span class="s3">\n        </span><span class="s1">this.editor.$textElem.on('scroll', () =&gt; {</span><span class="s3">\n            </span><span class="s1">this.last = this.target.scrollTop</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">this.resetMaxSize(this.editor.config.historyMaxSize)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 保存 scrollTop 值</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public save() {</span><span class="s3">\n        </span><span class="s1">super.save([this.last, this.target.scrollTop])</span><span class="s3">\n        </span><span class="s1">return this</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 撤销</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public revoke() {</span><span class="s3">\n        </span><span class="s1">return super.revoke(data =&gt; {</span><span class="s3">\n            </span><span class="s1">this.target.scrollTop = data[0]</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 恢复</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public restore() {</span><span class="s3">\n        </span><span class="s1">return super.restore(data =&gt; {</span><span class="s3">\n            </span><span class="s1">this.target.scrollTop = data[1]</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description 记录 range 变化</span><span class="s3">\n </span><span class="s1">* @author fangzhicong</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import Cache from '../../../../utils/data-structure/cache'</span><span class="s3">\n</span><span class="s1">import Editor from '../../../index'</span><span class="s3">\n</span><span class="s1">import { RangeItem } from '../type'</span><span class="s3">\n</span><span class="s1">import $ from '../../../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import { debounce } from '../../../../utils/util'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 把 Range 对象转换成缓存对象</span><span class="s3">\n </span><span class="s1">* @param range Range 对象</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function rangeToObject(range: Range): RangeItem {</span><span class="s3">\n    </span><span class="s1">return {</span><span class="s3">\n        </span><span class="s1">start: [range.startContainer, range.startOffset],</span><span class="s3">\n        </span><span class="s1">end: [range.endContainer, range.endOffset],</span><span class="s3">\n        </span><span class="s1">root: range.commonAncestorContainer,</span><span class="s3">\n        </span><span class="s1">collapsed: range.collapsed,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 编辑区 range 缓存管理器</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default class RangeCache extends Cache&lt;[RangeItem, RangeItem]&gt; {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 变化前的 Range 数据</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private lastRange: RangeItem</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 有效选区的根节点</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">private root: Element</span><span class="s3">\n\n    </span><span class="s1">public updateLastRange: Function</span><span class="s3">\n\n    </span><span class="s1">constructor(public editor: Editor) {</span><span class="s3">\n        </span><span class="s1">super(editor.config.historyMaxSize)</span><span class="s3">\n        </span><span class="s1">this.lastRange = rangeToObject(document.createRange())</span><span class="s3">\n        </span><span class="s1">this.root = editor.$textElem.elems[0]</span><span class="s3">\n        </span><span class="s1">this.updateLastRange = debounce(() =&gt; {</span><span class="s3">\n            </span><span class="s1">this.lastRange = rangeToObject(this.rangeHandle)</span><span class="s3">\n        </span><span class="s1">}, editor.config.onchangeTimeout)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 获取 Range 对象</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public get rangeHandle() {</span><span class="s3">\n        </span><span class="s1">const selection = document.getSelection()</span><span class="s3">\n        </span><span class="s1">return selection &amp;&amp; selection.rangeCount ? selection.getRangeAt(0) : document.createRange()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 初始化绑定</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public observe() {</span><span class="s3">\n        </span><span class="s1">const self = this</span><span class="s3">\n        </span><span class="s1">// 同步节点数据</span><span class="s3">\n        </span><span class="s1">this.root = this.editor.$textElem.elems[0]</span><span class="s3">\n        </span><span class="s1">this.resetMaxSize(this.editor.config.historyMaxSize)</span><span class="s3">\n        </span><span class="s1">// selection change 回调函数</span><span class="s3">\n        </span><span class="s1">function selectionchange() {</span><span class="s3">\n            </span><span class="s1">const handle = self.rangeHandle</span><span class="s3">\n            </span><span class="s1">if (</span><span class="s3">\n                </span><span class="s1">self.root === handle.commonAncestorContainer ||</span><span class="s3">\n                </span><span class="s1">self.root.contains(handle.commonAncestorContainer)</span><span class="s3">\n            </span><span class="s1">) {</span><span class="s3">\n                </span><span class="s1">// 非中文输入状态下才进行记录</span><span class="s3">\n                </span><span class="s1">if (!self.editor.isComposing) {</span><span class="s3">\n                    </span><span class="s1">self.updateLastRange()</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// backspace 和 delete 手动更新 Range 缓存</span><span class="s3">\n        </span><span class="s1">function deletecallback(e: KeyboardEvent) {</span><span class="s3">\n            </span><span class="s1">if (e.key == 'Backspace' || e.key == 'Delete') {</span><span class="s3">\n                </span><span class="s1">// self.lastRange = rangeToObject(self.rangeHandle)</span><span class="s3">\n                </span><span class="s1">self.updateLastRange()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// 绑定事件（必须绑定在 document 上，不能绑定在 window 上）</span><span class="s3">\n        </span><span class="s1">$(document).on('selectionchange', selectionchange)</span><span class="s3">\n        </span><span class="s1">// 解除事件绑定</span><span class="s3">\n        </span><span class="s1">this.editor.beforeDestroy(function () {</span><span class="s3">\n            </span><span class="s1">$(document).off('selectionchange', selectionchange)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// 删除文本时手动更新 range</span><span class="s3">\n        </span><span class="s1">self.editor.$textElem.on('keydown', deletecallback)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 保存 Range</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public save() {</span><span class="s3">\n        </span><span class="s1">let current = rangeToObject(this.rangeHandle)</span><span class="s3">\n        </span><span class="s1">super.save([this.lastRange, current])</span><span class="s3">\n        </span><span class="s1">this.lastRange = current</span><span class="s3">\n        </span><span class="s1">return this</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 设置 Range，在 撤销/恢复 中调用</span><span class="s3">\n     </span><span class="s1">* @param range 缓存的 Range 数据</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public set(range: RangeItem | undefined) {</span><span class="s3">\n        </span><span class="s1">try {</span><span class="s3">\n            </span><span class="s1">if (range) {</span><span class="s3">\n                </span><span class="s1">const handle = this.rangeHandle</span><span class="s3">\n                </span><span class="s1">handle.setStart(...range.start)</span><span class="s3">\n                </span><span class="s1">handle.setEnd(...range.end)</span><span class="s3">\n                </span><span class="s1">this.editor.menus.changeActive()</span><span class="s3">\n                </span><span class="s1">return true</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">} catch (err) {</span><span class="s3">\n            </span><span class="s1">return false</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 撤销</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public revoke() {</span><span class="s3">\n        </span><span class="s1">return super.revoke(data =&gt; {</span><span class="s3">\n            </span><span class="s1">this.set(data[0])</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* 恢复</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">public restore() {</span><span class="s3">\n        </span><span class="s1">return super.restore(data =&gt; {</span><span class="s3">\n            </span><span class="s1">this.set(data[1])</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description disable 内容编辑</span><span class="s3">\n </span><span class="s1">* @author lichunlin</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import Editor from '../index'</span><span class="s3">\n</span><span class="s1">import $, { DomElement } from '../../utils/dom-core'</span><span class="s3">\n</span><span class="s1">import '../../assets/style/disable.less'</span><span class="s3">\n\n</span><span class="s1">export default function disableInit(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">let isCurtain: Boolean = false // 避免重复生成幕布</span><span class="s3">\n    </span><span class="s1">let $contentDom: DomElement</span><span class="s3">\n    </span><span class="s1">let $menuDom: DomElement</span><span class="s3">\n\n    </span><span class="s1">// 禁用期间，通过 js 修改内容后，刷新内容</span><span class="s3">\n    </span><span class="s1">editor.txt.eventHooks.changeEvents.push(function () {</span><span class="s3">\n        </span><span class="s1">if (isCurtain) {</span><span class="s3">\n            </span><span class="s1">$contentDom.find('.w-e-content-preview').html(editor.$textElem.html())</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">// 创建幕布</span><span class="s3">\n    </span><span class="s1">function disable() {</span><span class="s3">\n        </span><span class="s1">if (isCurtain) return</span><span class="s3">\n        </span><span class="s1">// 隐藏编辑区域</span><span class="s3">\n        </span><span class="s1">editor.$textElem.hide()</span><span class="s3">\n        </span><span class="s1">// 生成div 渲染编辑内容</span><span class="s3">\n        </span><span class="s1">let textContainerZindexValue = editor.zIndex.get('textContainer')</span><span class="s3">\n        </span><span class="s1">const content = editor.txt.html()</span><span class="s3">\n        </span><span class="s1">$contentDom = $(</span><span class="s3">\n            </span><span class="s1">`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-content-mantle</span><span class="s3">\&quot; </span><span class="s1">style=</span><span class="s3">\&quot;</span><span class="s1">z-index:${textContainerZindexValue}</span><span class="s3">\&quot;</span><span class="s1">&gt;</span><span class="s3">\n                </span><span class="s1">&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-content-preview w-e-text</span><span class="s3">\&quot;</span><span class="s1">&gt;${content}&lt;/div&gt;</span><span class="s3">\n            </span><span class="s1">&lt;/div&gt;`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">editor.$textContainerElem.append($contentDom)</span><span class="s3">\n        </span><span class="s1">// 生成div 菜单膜布</span><span class="s3">\n        </span><span class="s1">let menuZindexValue = editor.zIndex.get('menu')</span><span class="s3">\n        </span><span class="s1">$menuDom = $(`&lt;div class=</span><span class="s3">\&quot;</span><span class="s1">w-e-menue-mantle</span><span class="s3">\&quot; </span><span class="s1">style=</span><span class="s3">\&quot;</span><span class="s1">z-index:${menuZindexValue}</span><span class="s3">\&quot;</span><span class="s1">&gt;&lt;/div&gt;`)</span><span class="s3">\n        </span><span class="s1">editor.$toolbarElem.append($menuDom)</span><span class="s3">\n        </span><span class="s1">isCurtain = true</span><span class="s3">\n        </span><span class="s1">editor.isEnable = false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// 销毁幕布并显示可编辑区域</span><span class="s3">\n    </span><span class="s1">function enable() {</span><span class="s3">\n        </span><span class="s1">if (!isCurtain) return</span><span class="s3">\n        </span><span class="s1">$contentDom.remove()</span><span class="s3">\n        </span><span class="s1">$menuDom.remove()</span><span class="s3">\n        </span><span class="s1">editor.$textElem.show()</span><span class="s3">\n        </span><span class="s1">isCurtain = false</span><span class="s3">\n        </span><span class="s1">editor.isEnable = true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return { disable, enable }</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;var api = require(</span><span class="s3">\&quot;</span><span class="s1">!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n            </span><span class="s1">var content = require(</span><span class="s3">\&quot;</span><span class="s1">!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/postcss-loader/src/index.js!../../../node_modules/less-loader/dist/cjs.js!./disable.less</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n\n            </span><span class="s1">content = content.__esModule ? content.default : content;</span><span class="s3">\n\n            </span><span class="s1">if (typeof content === 'string') {</span><span class="s3">\n              </span><span class="s1">content = [[module.id, content, '']];</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">var options = {};</span><span class="s3">\n\n</span><span class="s1">options.insert = </span><span class="s3">\&quot;</span><span class="s1">head</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n</span><span class="s1">options.singleton = false;</span><span class="s3">\n\n</span><span class="s1">var update = api(content, options);</span><span class="s3">\n\n\n\n</span><span class="s1">module.exports = content.locals || {};&quot;</span><span class="s0">,</span><span class="s1">&quot;// Imports</span><span class="s3">\n</span><span class="s1">var ___CSS_LOADER_API_IMPORT___ = require(</span><span class="s3">\&quot;</span><span class="s1">../../../node_modules/css-loader/dist/runtime/api.js</span><span class="s3">\&quot;</span><span class="s1">);</span><span class="s3">\n</span><span class="s1">exports = ___CSS_LOADER_API_IMPORT___(false);</span><span class="s3">\n</span><span class="s1">// Module</span><span class="s3">\n</span><span class="s1">exports.push([module.id, </span><span class="s3">\&quot;</span><span class="s1">.w-e-content-mantle {</span><span class="s3">\\</span><span class="s1">n  width: 100%;</span><span class="s3">\\</span><span class="s1">n  height: 100%;</span><span class="s3">\\</span><span class="s1">n  overflow-y: auto;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-content-mantle .w-e-content-preview {</span><span class="s3">\\</span><span class="s1">n  width: 100%;</span><span class="s3">\\</span><span class="s1">n  min-height: 100%;</span><span class="s3">\\</span><span class="s1">n  padding: 0 10px;</span><span class="s3">\\</span><span class="s1">n  line-height: 1.5;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-content-mantle .w-e-content-preview img {</span><span class="s3">\\</span><span class="s1">n  cursor: default;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-content-mantle .w-e-content-preview img:hover {</span><span class="s3">\\</span><span class="s1">n  box-shadow: none;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n.w-e-menue-mantle {</span><span class="s3">\\</span><span class="s1">n  position: absolute;</span><span class="s3">\\</span><span class="s1">n  height: 100%;</span><span class="s3">\\</span><span class="s1">n  width: 100%;</span><span class="s3">\\</span><span class="s1">n  top: 0;</span><span class="s3">\\</span><span class="s1">n  left: 0;</span><span class="s3">\\</span><span class="s1">n}</span><span class="s3">\\</span><span class="s1">n</span><span class="s3">\&quot;</span><span class="s1">, </span><span class="s3">\&quot;\&quot;</span><span class="s1">]);</span><span class="s3">\n</span><span class="s1">// Exports</span><span class="s3">\n</span><span class="s1">module.exports = exports;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* @description range变化</span><span class="s3">\n </span><span class="s1">* @author liuwei</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">import Editor from '../index'</span><span class="s3">\n</span><span class="s1">export default class SelectionChange {</span><span class="s3">\n    </span><span class="s1">constructor(public editor: Editor) {</span><span class="s3">\n        </span><span class="s1">// 绑定的事件</span><span class="s3">\n        </span><span class="s1">const init = () =&gt; {</span><span class="s3">\n            </span><span class="s1">const activeElement = document.activeElement</span><span class="s3">\n            </span><span class="s1">if (activeElement === editor.$textElem.elems[0]) {</span><span class="s3">\n                </span><span class="s1">this.emit()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">//  选取变化事件监听</span><span class="s3">\n        </span><span class="s1">window.document.addEventListener('selectionchange', init)</span><span class="s3">\n\n        </span><span class="s1">// 摧毁时移除监听</span><span class="s3">\n        </span><span class="s1">this.editor.beforeDestroy(() =&gt; {</span><span class="s3">\n            </span><span class="s1">window.document.removeEventListener('selectionchange', init)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">public emit(): void {</span><span class="s3">\n        </span><span class="s1">// 执行rangeChange函数</span><span class="s3">\n        </span><span class="s1">const { onSelectionChange } = this.editor.config</span><span class="s3">\n        </span><span class="s1">if (onSelectionChange) {</span><span class="s3">\n            </span><span class="s1">const selection = this.editor.selection</span><span class="s3">\n            </span><span class="s1">selection.saveRange()</span><span class="s3">\n            </span><span class="s1">if (!selection.isSelectionEmpty())</span><span class="s3">\n                </span><span class="s1">onSelectionChange({</span><span class="s3">\n                    </span><span class="s1">// 当前文本</span><span class="s3">\n                    </span><span class="s1">text: selection.getSelectionText(),</span><span class="s3">\n                    </span><span class="s1">// 当前的html</span><span class="s3">\n                    </span><span class="s1">html: selection.getSelectionContainerElem()?.elems[0].innerHTML,</span><span class="s3">\n                    </span><span class="s1">// select对象</span><span class="s3">\n                    </span><span class="s1">selection: selection,</span><span class="s3">\n                </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">,</span><span class="s1">&quot;import Editor from '../editor'</span><span class="s3">\n</span><span class="s1">import { deepClone } from '../utils/util'</span><span class="s3">\n\n</span><span class="s1">// 插件注册配置约束</span><span class="s3">\n</span><span class="s1">export interface RegisterOptions {</span><span class="s3">\n    </span><span class="s1">intention: any</span><span class="s3">\n    </span><span class="s1">config?: any</span><span class="s3">\n    </span><span class="s1">// example?: any // 原本是用来存放实例化后的插件对象的</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// 插件列表类型</span><span class="s3">\n</span><span class="s1">export type pluginsListType = {</span><span class="s3">\n    </span><span class="s1">[key: string]: RegisterOptions</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 插件注册</span><span class="s3">\n </span><span class="s1">* @param { string } name 插件名</span><span class="s3">\n </span><span class="s1">* @param { RegisterOptions } options 插件配置</span><span class="s3">\n </span><span class="s1">* @param { pluginsListType } memory 存储介质</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function registerPlugin(name: string, options: RegisterOptions, memory: pluginsListType) {</span><span class="s3">\n    </span><span class="s1">if (!name) {</span><span class="s3">\n        </span><span class="s1">throw new TypeError('name is not define')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (!options) {</span><span class="s3">\n        </span><span class="s1">throw new TypeError('options is not define')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (!options.intention) {</span><span class="s3">\n        </span><span class="s1">throw new TypeError('options.intention is not define')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (options.intention &amp;&amp; typeof options.intention !== 'function') {</span><span class="s3">\n        </span><span class="s1">throw new TypeError('options.intention is not function')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (memory[name]) {</span><span class="s3">\n        </span><span class="s1">console.warn(`plugin ${name} 已存在，已覆盖。`)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">memory[name] = options</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* 插件初始化</span><span class="s3">\n </span><span class="s1">* @param { Editor } editor 编辑器实例</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default function initPlugins(editor: Editor) {</span><span class="s3">\n    </span><span class="s1">const plugins: pluginsListType = Object.assign(</span><span class="s3">\n        </span><span class="s1">{},</span><span class="s3">\n        </span><span class="s1">deepClone(Editor.globalPluginsFunctionList),</span><span class="s3">\n        </span><span class="s1">deepClone(editor.pluginsFunctionList)</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">const values = Object.entries(plugins)</span><span class="s3">\n    </span><span class="s1">values.forEach(([name, options]) =&gt; {</span><span class="s3">\n        </span><span class="s1">console.info(`plugin ${name} initializing`)</span><span class="s3">\n        </span><span class="s1">const { intention, config } = options</span><span class="s3">\n        </span><span class="s1">intention(editor, config)</span><span class="s3">\n        </span><span class="s1">console.info(`plugin ${name} initialization complete`)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;sourceRoot&quot;</span><span class="s0">:</span><span class="s1">&quot;&quot;</span><span class="s0">}</span></pre>
</body>
</html>