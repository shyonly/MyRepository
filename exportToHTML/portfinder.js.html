<html>
<head>
<title>portfinder.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #6aab73;}
.s3 { color: #bcbec4;}
.s4 { color: #cf8e6d;}
.s5 { color: #2aacb8;}
.s6 { color: #42c3d4;}
.s7 { color: #5f826b; font-style: italic;}
.s8 { color: #67a37c; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
portfinder.js</font>
</center></td></tr></table>
<pre><span class="s0">/* 
 * portfinder.js: A simple tool to find an open port on the current machine. 
 * 
 * (C) 2011, Charlie Robbins 
 * 
 */</span>

<span class="s2">&quot;use strict&quot;</span><span class="s3">;</span>

<span class="s4">var </span><span class="s1">fs </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">'fs'</span><span class="s3">),</span>
    <span class="s1">os </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">'os'</span><span class="s3">),</span>
    <span class="s1">net </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">'net'</span><span class="s3">),</span>
    <span class="s1">path </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">'path'</span><span class="s3">),</span>
    <span class="s1">_async </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">'async'</span><span class="s3">),</span>
    <span class="s1">debug </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">'debug'</span><span class="s3">),</span>
    <span class="s1">mkdirp </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">'mkdirp'</span><span class="s3">).</span><span class="s1">mkdirp</span><span class="s3">;</span>

<span class="s4">var </span><span class="s1">debugTestPort </span><span class="s3">= </span><span class="s1">debug</span><span class="s3">(</span><span class="s2">'portfinder:testPort'</span><span class="s3">),</span>
    <span class="s1">debugGetPort </span><span class="s3">= </span><span class="s1">debug</span><span class="s3">(</span><span class="s2">'portfinder:getPort'</span><span class="s3">),</span>
    <span class="s1">debugDefaultHosts </span><span class="s3">= </span><span class="s1">debug</span><span class="s3">(</span><span class="s2">'portfinder:defaultHosts'</span><span class="s3">);</span>

<span class="s4">var </span><span class="s1">internals </span><span class="s3">= {};</span>

<span class="s1">internals</span><span class="s3">.</span><span class="s1">testPort </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">options</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
  <span class="s4">if </span><span class="s3">(!</span><span class="s1">callback</span><span class="s3">) {</span>
    <span class="s1">callback </span><span class="s3">= </span><span class="s1">options</span><span class="s3">;</span>
    <span class="s1">options </span><span class="s3">= {};</span>
  <span class="s3">}</span>

  <span class="s1">options</span><span class="s3">.</span><span class="s1">server </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">server  </span><span class="s3">|| </span><span class="s1">net</span><span class="s3">.</span><span class="s1">createServer</span><span class="s3">(</span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s0">//</span>
    <span class="s0">// Create an empty listener for the port testing server.</span>
    <span class="s0">//</span>
  <span class="s3">});</span>

  <span class="s1">debugTestPort</span><span class="s3">(</span><span class="s2">&quot;entered testPort(): trying&quot;</span><span class="s3">, </span><span class="s1">options</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s2">&quot;port&quot;</span><span class="s3">, </span><span class="s1">options</span><span class="s3">.</span><span class="s1">port</span><span class="s3">);</span>

  <span class="s4">function </span><span class="s1">onListen </span><span class="s3">() {</span>
    <span class="s1">debugTestPort</span><span class="s3">(</span><span class="s2">&quot;done w/ testPort(): OK&quot;</span><span class="s3">, </span><span class="s1">options</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s2">&quot;port&quot;</span><span class="s3">, </span><span class="s1">options</span><span class="s3">.</span><span class="s1">port</span><span class="s3">);</span>

    <span class="s1">options</span><span class="s3">.</span><span class="s1">server</span><span class="s3">.</span><span class="s1">removeListener</span><span class="s3">(</span><span class="s2">'error'</span><span class="s3">, </span><span class="s1">onError</span><span class="s3">);</span>
    <span class="s1">options</span><span class="s3">.</span><span class="s1">server</span><span class="s3">.</span><span class="s1">close</span><span class="s3">();</span>
    <span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">options</span><span class="s3">.</span><span class="s1">port</span><span class="s3">);</span>
  <span class="s3">}</span>

  <span class="s4">function </span><span class="s1">onError </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
    <span class="s1">debugTestPort</span><span class="s3">(</span><span class="s2">&quot;done w/ testPort(): failed&quot;</span><span class="s3">, </span><span class="s1">options</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s2">&quot;w/ port&quot;</span><span class="s3">, </span><span class="s1">options</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s2">&quot;with error&quot;</span><span class="s3">, </span><span class="s1">err</span><span class="s3">.</span><span class="s1">code</span><span class="s3">);</span>

    <span class="s1">options</span><span class="s3">.</span><span class="s1">server</span><span class="s3">.</span><span class="s1">removeListener</span><span class="s3">(</span><span class="s2">'listening'</span><span class="s3">, </span><span class="s1">onListen</span><span class="s3">);</span>

    <span class="s4">if </span><span class="s3">(!(</span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">== </span><span class="s2">'EADDRINUSE' </span><span class="s3">|| </span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">== </span><span class="s2">'EACCES'</span><span class="s3">)) {</span>
      <span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s4">var </span><span class="s1">nextPort </span><span class="s3">= </span><span class="s1">exports</span><span class="s3">.</span><span class="s1">nextPort</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">port</span><span class="s3">);</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">nextPort </span><span class="s3">&gt; </span><span class="s1">exports</span><span class="s3">.</span><span class="s1">highestPort</span><span class="s3">) {</span>
      <span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">new </span><span class="s1">Error</span><span class="s3">(</span><span class="s2">'No open ports available'</span><span class="s3">));</span>
    <span class="s3">}</span>

    <span class="s1">internals</span><span class="s3">.</span><span class="s1">testPort</span><span class="s3">({</span>
      <span class="s1">port</span><span class="s3">: </span><span class="s1">nextPort</span><span class="s3">,</span>
      <span class="s1">host</span><span class="s3">: </span><span class="s1">options</span><span class="s3">.</span><span class="s1">host</span><span class="s3">,</span>
      <span class="s1">server</span><span class="s3">: </span><span class="s1">options</span><span class="s3">.</span><span class="s1">server</span>
    <span class="s3">}, </span><span class="s1">callback</span><span class="s3">);</span>
  <span class="s3">}</span>

  <span class="s1">options</span><span class="s3">.</span><span class="s1">server</span><span class="s3">.</span><span class="s1">once</span><span class="s3">(</span><span class="s2">'error'</span><span class="s3">, </span><span class="s1">onError</span><span class="s3">);</span>
  <span class="s1">options</span><span class="s3">.</span><span class="s1">server</span><span class="s3">.</span><span class="s1">once</span><span class="s3">(</span><span class="s2">'listening'</span><span class="s3">, </span><span class="s1">onListen</span><span class="s3">);</span>

  <span class="s4">if </span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">host</span><span class="s3">) {</span>
    <span class="s1">options</span><span class="s3">.</span><span class="s1">server</span><span class="s3">.</span><span class="s1">listen</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">options</span><span class="s3">.</span><span class="s1">host</span><span class="s3">);</span>
  <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
    <span class="s0">/* 
      Judgement of service without host 
      example: 
        express().listen(options.port) 
    */</span>
    <span class="s1">options</span><span class="s3">.</span><span class="s1">server</span><span class="s3">.</span><span class="s1">listen</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">port</span><span class="s3">);</span>
  <span class="s3">}</span>
<span class="s3">};</span>

<span class="s0">//</span>
<span class="s0">// ### @basePort {Number}</span>
<span class="s0">// The lowest port to begin any port search from</span>
<span class="s0">//</span>
<span class="s1">exports</span><span class="s3">.</span><span class="s1">basePort </span><span class="s3">= </span><span class="s5">8000</span><span class="s3">;</span>

<span class="s0">//</span>
<span class="s0">// ### function setBasePort (port)</span>
<span class="s0">// #### @port {Number} The new base port</span>
<span class="s0">//</span>
<span class="s1">exports</span><span class="s3">.</span><span class="s1">setBasePort </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">port</span><span class="s3">) {</span>
  <span class="s1">exports</span><span class="s3">.</span><span class="s1">basePort </span><span class="s3">= </span><span class="s1">port</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s0">//</span>
<span class="s0">// ### @highestPort {Number}</span>
<span class="s0">// Largest port number is an unsigned short 2**16 -1=65335</span>
<span class="s0">//</span>
<span class="s1">exports</span><span class="s3">.</span><span class="s1">highestPort </span><span class="s3">= </span><span class="s5">65535</span><span class="s3">;</span>

<span class="s0">//</span>
<span class="s0">// ### function setHighestPort (port)</span>
<span class="s0">// #### @port {Number} The new highest port</span>
<span class="s0">//</span>
<span class="s1">exports</span><span class="s3">.</span><span class="s1">setHighestPort </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">port</span><span class="s3">) {</span>
  <span class="s1">exports</span><span class="s3">.</span><span class="s1">highestPort </span><span class="s3">= </span><span class="s1">port</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s0">//</span>
<span class="s0">// ### @basePath {string}</span>
<span class="s0">// Default path to begin any socket search from</span>
<span class="s0">//</span>
<span class="s1">exports</span><span class="s3">.</span><span class="s1">basePath </span><span class="s3">= </span><span class="s2">'/tmp/portfinder'</span>

<span class="s0">//</span>
<span class="s0">// ### function getPort (options, callback)</span>
<span class="s0">// #### @options {Object} Settings to use when finding the necessary port</span>
<span class="s0">// #### @callback {function} Continuation to respond to when complete.</span>
<span class="s0">// Responds with a unbound port on the current machine.</span>
<span class="s0">//</span>
<span class="s1">exports</span><span class="s3">.</span><span class="s1">getPort </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">options</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
  <span class="s4">if </span><span class="s3">(!</span><span class="s1">callback</span><span class="s3">) {</span>
    <span class="s1">callback </span><span class="s3">= </span><span class="s1">options</span><span class="s3">;</span>
    <span class="s1">options </span><span class="s3">= {};</span>

  <span class="s3">}</span>

  <span class="s1">options</span><span class="s3">.</span><span class="s1">port   </span><span class="s3">= </span><span class="s1">Number</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">port</span><span class="s3">) || </span><span class="s1">Number</span><span class="s3">(</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">basePort</span><span class="s3">);</span>
  <span class="s1">options</span><span class="s3">.</span><span class="s1">host   </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">host    </span><span class="s3">|| </span><span class="s4">null</span><span class="s3">;</span>
  <span class="s1">options</span><span class="s3">.</span><span class="s1">stopPort </span><span class="s3">= </span><span class="s1">Number</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">stopPort</span><span class="s3">) || </span><span class="s1">Number</span><span class="s3">(</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">highestPort</span><span class="s3">);</span>

  <span class="s4">if</span><span class="s3">(!</span><span class="s1">options</span><span class="s3">.</span><span class="s1">startPort</span><span class="s3">) {</span>
    <span class="s1">options</span><span class="s3">.</span><span class="s1">startPort </span><span class="s3">= </span><span class="s1">Number</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">port</span><span class="s3">);</span>
    <span class="s4">if</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">startPort </span><span class="s3">&lt; </span><span class="s5">0</span><span class="s3">) {</span>
      <span class="s4">throw </span><span class="s1">Error</span><span class="s3">(</span><span class="s2">'Provided options.startPort(' </span><span class="s3">+ </span><span class="s1">options</span><span class="s3">.</span><span class="s1">startPort </span><span class="s3">+ </span><span class="s2">') is less than 0, which are cannot be bound.'</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">if</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">stopPort </span><span class="s3">&lt; </span><span class="s1">options</span><span class="s3">.</span><span class="s1">startPort</span><span class="s3">) {</span>
      <span class="s4">throw </span><span class="s1">Error</span><span class="s3">(</span><span class="s2">'Provided options.stopPort(' </span><span class="s3">+ </span><span class="s1">options</span><span class="s3">.</span><span class="s1">stopPort </span><span class="s3">+ </span><span class="s2">'is less than options.startPort (' </span><span class="s3">+ </span><span class="s1">options</span><span class="s3">.</span><span class="s1">startPort </span><span class="s3">+ </span><span class="s2">')'</span><span class="s3">);</span>
    <span class="s3">}</span>
  <span class="s3">}</span>

  <span class="s4">if </span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">host</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">_defaultHosts</span><span class="s3">.</span><span class="s1">indexOf</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">host</span><span class="s3">) !== -</span><span class="s5">1</span><span class="s3">) {</span>
      <span class="s1">exports</span><span class="s3">.</span><span class="s1">_defaultHosts</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">host</span><span class="s3">)</span>
    <span class="s3">}</span>
  <span class="s3">}</span>

  <span class="s4">var </span><span class="s1">openPorts </span><span class="s3">= [], </span><span class="s1">currentHost</span><span class="s3">;</span>
  <span class="s4">return </span><span class="s1">_async</span><span class="s3">.</span><span class="s1">eachSeries</span><span class="s3">(</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">_defaultHosts</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">host</span><span class="s3">, </span><span class="s1">next</span><span class="s3">) {</span>
    <span class="s1">debugGetPort</span><span class="s3">(</span><span class="s2">&quot;in eachSeries() iteration callback: host is&quot;</span><span class="s3">, </span><span class="s1">host</span><span class="s3">);</span>

    <span class="s4">return </span><span class="s1">internals</span><span class="s3">.</span><span class="s1">testPort</span><span class="s3">({ </span><span class="s1">host</span><span class="s3">: </span><span class="s1">host</span><span class="s3">, </span><span class="s1">port</span><span class="s3">: </span><span class="s1">options</span><span class="s3">.</span><span class="s1">port </span><span class="s3">}, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">port</span><span class="s3">) {</span>
      <span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
        <span class="s1">debugGetPort</span><span class="s3">(</span><span class="s2">&quot;in eachSeries() iteration callback testPort() callback&quot;</span><span class="s3">, </span><span class="s2">&quot;with an err:&quot;</span><span class="s3">, </span><span class="s1">err</span><span class="s3">.</span><span class="s1">code</span><span class="s3">);</span>
        <span class="s1">currentHost </span><span class="s3">= </span><span class="s1">host</span><span class="s3">;</span>
        <span class="s4">return </span><span class="s1">next</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
      <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s1">debugGetPort</span><span class="s3">(</span><span class="s2">&quot;in eachSeries() iteration callback testPort() callback&quot;</span><span class="s3">,</span>
                    <span class="s2">&quot;with a success for port&quot;</span><span class="s3">, </span><span class="s1">port</span><span class="s3">);</span>
        <span class="s1">openPorts</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">port</span><span class="s3">);</span>
        <span class="s4">return </span><span class="s1">next</span><span class="s3">();</span>
      <span class="s3">}</span>
    <span class="s3">});</span>
  <span class="s3">}, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
      <span class="s1">debugGetPort</span><span class="s3">(</span><span class="s2">&quot;in eachSeries() result callback: err is&quot;</span><span class="s3">, </span><span class="s1">err</span><span class="s3">);</span>
      <span class="s0">// If we get EADDRNOTAVAIL it means the host is not bindable, so remove it</span>
      <span class="s0">// from exports._defaultHosts and start over. For ubuntu, we use EINVAL for the same</span>
      <span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">=== </span><span class="s2">'EADDRNOTAVAIL' </span><span class="s3">|| </span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">=== </span><span class="s2">'EINVAL'</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">host </span><span class="s3">=== </span><span class="s1">currentHost</span><span class="s3">) {</span>
          <span class="s0">// if bad address matches host given by user, tell them</span>
          <span class="s0">//</span>
          <span class="s0">// NOTE: We may need to one day handle `my-non-existent-host.local` if users</span>
          <span class="s0">// report frustration with passing in hostnames that DONT map to bindable</span>
          <span class="s0">// hosts, without showing them a good error.</span>
          <span class="s4">var </span><span class="s1">msg </span><span class="s3">= </span><span class="s2">'Provided host ' </span><span class="s3">+ </span><span class="s1">options</span><span class="s3">.</span><span class="s1">host </span><span class="s3">+ </span><span class="s2">' could NOT be bound. Please provide a different host address or hostname'</span><span class="s3">;</span>
          <span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">Error</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">));</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
          <span class="s4">var </span><span class="s1">idx </span><span class="s3">= </span><span class="s1">exports</span><span class="s3">.</span><span class="s1">_defaultHosts</span><span class="s3">.</span><span class="s1">indexOf</span><span class="s3">(</span><span class="s1">currentHost</span><span class="s3">);</span>
          <span class="s1">exports</span><span class="s3">.</span><span class="s1">_defaultHosts</span><span class="s3">.</span><span class="s1">splice</span><span class="s3">(</span><span class="s1">idx</span><span class="s3">, </span><span class="s5">1</span><span class="s3">);</span>
          <span class="s4">return </span><span class="s1">exports</span><span class="s3">.</span><span class="s1">getPort</span><span class="s3">(</span><span class="s1">options</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
        <span class="s3">}</span>
      <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s0">// error is not accounted for, file ticket, handle special case</span>
        <span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
      <span class="s3">}</span>
    <span class="s3">}</span>

    <span class="s0">// sort so we can compare first host to last host</span>
    <span class="s1">openPorts</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">) {</span>
      <span class="s4">return </span><span class="s1">a </span><span class="s3">- </span><span class="s1">b</span><span class="s3">;</span>
    <span class="s3">});</span>

    <span class="s1">debugGetPort</span><span class="s3">(</span><span class="s2">&quot;in eachSeries() result callback: openPorts is&quot;</span><span class="s3">, </span><span class="s1">openPorts</span><span class="s3">);</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">openPorts</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] === </span><span class="s1">openPorts</span><span class="s3">[</span><span class="s1">openPorts</span><span class="s3">.</span><span class="s1">length</span><span class="s3">-</span><span class="s5">1</span><span class="s3">]) {</span>
      <span class="s0">// if first === last, we found an open port</span>
      <span class="s4">if</span><span class="s3">(</span><span class="s1">openPorts</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] &lt;= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">stopPort</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">openPorts</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]);</span>
      <span class="s3">}</span>
      <span class="s4">else </span><span class="s3">{</span>
        <span class="s4">var </span><span class="s1">msg </span><span class="s3">= </span><span class="s2">'No open ports found in between '</span><span class="s3">+ </span><span class="s1">options</span><span class="s3">.</span><span class="s1">startPort </span><span class="s3">+ </span><span class="s2">' and ' </span><span class="s3">+ </span><span class="s1">options</span><span class="s3">.</span><span class="s1">stopPort</span><span class="s3">;</span>
        <span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">Error</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">));</span>
      <span class="s3">}</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
      <span class="s0">// otherwise, try again, using sorted port, aka, highest open for &gt;= 1 host</span>
      <span class="s4">return </span><span class="s1">exports</span><span class="s3">.</span><span class="s1">getPort</span><span class="s3">({ </span><span class="s1">port</span><span class="s3">: </span><span class="s1">openPorts</span><span class="s3">.</span><span class="s1">pop</span><span class="s3">(), </span><span class="s1">host</span><span class="s3">: </span><span class="s1">options</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s1">startPort</span><span class="s3">: </span><span class="s1">options</span><span class="s3">.</span><span class="s1">startPort</span><span class="s3">, </span><span class="s1">stopPort</span><span class="s3">: </span><span class="s1">options</span><span class="s3">.</span><span class="s1">stopPort </span><span class="s3">}, </span><span class="s1">callback</span><span class="s3">);</span>
    <span class="s3">}</span>

  <span class="s3">});</span>
<span class="s3">};</span>

<span class="s0">//</span>
<span class="s0">// ### function getPortPromise (options)</span>
<span class="s0">// #### @options {Object} Settings to use when finding the necessary port</span>
<span class="s0">// Responds a promise to an unbound port on the current machine.</span>
<span class="s0">//</span>
<span class="s1">exports</span><span class="s3">.</span><span class="s1">getPortPromise </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">options</span><span class="s3">) {</span>
  <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">Promise </span><span class="s3">!== </span><span class="s2">'function'</span><span class="s3">) {</span>
    <span class="s4">throw </span><span class="s1">Error</span><span class="s3">(</span><span class="s2">'Native promise support is not available in this version of node.' </span><span class="s3">+</span>
      <span class="s2">'Please install a polyfill and assign Promise to global.Promise before calling this method'</span><span class="s3">);</span>
  <span class="s3">}</span>
  <span class="s4">if </span><span class="s3">(!</span><span class="s1">options</span><span class="s3">) {</span>
    <span class="s1">options </span><span class="s3">= {};</span>
  <span class="s3">}</span>
  <span class="s4">return new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">resolve</span><span class="s3">, </span><span class="s1">reject</span><span class="s3">) {</span>
    <span class="s1">exports</span><span class="s3">.</span><span class="s1">getPort</span><span class="s3">(</span><span class="s1">options</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">port</span><span class="s3">) {</span>
      <span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">reject</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
      <span class="s3">}</span>
      <span class="s1">resolve</span><span class="s3">(</span><span class="s1">port</span><span class="s3">);</span>
    <span class="s3">});</span>
  <span class="s3">});</span>
<span class="s3">}</span>

<span class="s0">//</span>
<span class="s0">// ### function getPorts (count, options, callback)</span>
<span class="s0">// #### @count {Number} The number of ports to find</span>
<span class="s0">// #### @options {Object} Settings to use when finding the necessary port</span>
<span class="s0">// #### @callback {function} Continuation to respond to when complete.</span>
<span class="s0">// Responds with an array of unbound ports on the current machine.</span>
<span class="s0">//</span>
<span class="s1">exports</span><span class="s3">.</span><span class="s1">getPorts </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">count</span><span class="s3">, </span><span class="s1">options</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
  <span class="s4">if </span><span class="s3">(!</span><span class="s1">callback</span><span class="s3">) {</span>
    <span class="s1">callback </span><span class="s3">= </span><span class="s1">options</span><span class="s3">;</span>
    <span class="s1">options </span><span class="s3">= {};</span>
  <span class="s3">}</span>

  <span class="s4">var </span><span class="s1">lastPort </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
  <span class="s1">_async</span><span class="s3">.</span><span class="s1">timesSeries</span><span class="s3">(</span><span class="s1">count</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">index</span><span class="s3">, </span><span class="s1">asyncCallback</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">lastPort</span><span class="s3">) {</span>
      <span class="s1">options</span><span class="s3">.</span><span class="s1">port </span><span class="s3">= </span><span class="s1">exports</span><span class="s3">.</span><span class="s1">nextPort</span><span class="s3">(</span><span class="s1">lastPort</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s1">exports</span><span class="s3">.</span><span class="s1">getPort</span><span class="s3">(</span><span class="s1">options</span><span class="s3">, </span><span class="s4">function </span><span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">port</span><span class="s3">) {</span>
      <span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
        <span class="s1">asyncCallback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
      <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s1">lastPort </span><span class="s3">= </span><span class="s1">port</span><span class="s3">;</span>
        <span class="s1">asyncCallback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">port</span><span class="s3">);</span>
      <span class="s3">}</span>
    <span class="s3">});</span>
  <span class="s3">}, </span><span class="s1">callback</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s0">//</span>
<span class="s0">// ### function getSocket (options, callback)</span>
<span class="s0">// #### @options {Object} Settings to use when finding the necessary port</span>
<span class="s0">// #### @callback {function} Continuation to respond to when complete.</span>
<span class="s0">// Responds with a unbound socket using the specified directory and base</span>
<span class="s0">// name on the current machine.</span>
<span class="s0">//</span>
<span class="s1">exports</span><span class="s3">.</span><span class="s1">getSocket </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">options</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
  <span class="s4">if </span><span class="s3">(!</span><span class="s1">callback</span><span class="s3">) {</span>
    <span class="s1">callback </span><span class="s3">= </span><span class="s1">options</span><span class="s3">;</span>
    <span class="s1">options </span><span class="s3">= {};</span>
  <span class="s3">}</span>

  <span class="s1">options</span><span class="s3">.</span><span class="s1">mod  </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">mod    </span><span class="s3">|| </span><span class="s1">parseInt</span><span class="s3">(</span><span class="s5">755</span><span class="s3">, </span><span class="s5">8</span><span class="s3">);</span>
  <span class="s1">options</span><span class="s3">.</span><span class="s1">path </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">path   </span><span class="s3">|| </span><span class="s1">exports</span><span class="s3">.</span><span class="s1">basePath </span><span class="s3">+ </span><span class="s2">'.sock'</span><span class="s3">;</span>

  <span class="s0">//</span>
  <span class="s0">// Tests the specified socket</span>
  <span class="s0">//</span>
  <span class="s4">function </span><span class="s1">testSocket </span><span class="s3">() {</span>
    <span class="s1">fs</span><span class="s3">.</span><span class="s1">stat</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s4">function </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
      <span class="s0">//</span>
      <span class="s0">// If file we're checking doesn't exist (thus, stating it emits ENOENT),</span>
      <span class="s0">// we should be OK with listening on this socket.</span>
      <span class="s0">//</span>
      <span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">== </span><span class="s2">'ENOENT'</span><span class="s3">) {</span>
          <span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">options</span><span class="s3">.</span><span class="s1">path</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">else </span><span class="s3">{</span>
          <span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
        <span class="s3">}</span>
      <span class="s3">}</span>
      <span class="s4">else </span><span class="s3">{</span>
        <span class="s0">//</span>
        <span class="s0">// This file exists, so it isn't possible to listen on it. Lets try</span>
        <span class="s0">// next socket.</span>
        <span class="s0">//</span>
        <span class="s1">options</span><span class="s3">.</span><span class="s1">path </span><span class="s3">= </span><span class="s1">exports</span><span class="s3">.</span><span class="s1">nextSocket</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">path</span><span class="s3">);</span>
        <span class="s1">exports</span><span class="s3">.</span><span class="s1">getSocket</span><span class="s3">(</span><span class="s1">options</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
      <span class="s3">}</span>
    <span class="s3">});</span>
  <span class="s3">}</span>

  <span class="s0">//</span>
  <span class="s0">// Create the target `dir` then test connection</span>
  <span class="s0">// against the socket.</span>
  <span class="s0">//</span>
  <span class="s4">function </span><span class="s1">createAndTestSocket </span><span class="s3">(</span><span class="s1">dir</span><span class="s3">) {</span>
    <span class="s1">mkdirp</span><span class="s3">(</span><span class="s1">dir</span><span class="s3">, </span><span class="s1">options</span><span class="s3">.</span><span class="s1">mod</span><span class="s3">, </span><span class="s4">function </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
      <span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
      <span class="s3">}</span>

      <span class="s1">options</span><span class="s3">.</span><span class="s1">exists </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
      <span class="s1">testSocket</span><span class="s3">();</span>
    <span class="s3">});</span>
  <span class="s3">}</span>

  <span class="s0">//</span>
  <span class="s0">// Check if the parent directory of the target</span>
  <span class="s0">// socket path exists. If it does, test connection</span>
  <span class="s0">// against the socket. Otherwise, create the directory</span>
  <span class="s0">// then test connection.</span>
  <span class="s0">//</span>
  <span class="s4">function </span><span class="s1">checkAndTestSocket </span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">dir </span><span class="s3">= </span><span class="s1">path</span><span class="s3">.</span><span class="s1">dirname</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">path</span><span class="s3">);</span>

    <span class="s1">fs</span><span class="s3">.</span><span class="s1">stat</span><span class="s3">(</span><span class="s1">dir</span><span class="s3">, </span><span class="s4">function </span><span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">stats</span><span class="s3">) {</span>
      <span class="s4">if </span><span class="s3">(</span><span class="s1">err </span><span class="s3">|| !</span><span class="s1">stats</span><span class="s3">.</span><span class="s1">isDirectory</span><span class="s3">()) {</span>
        <span class="s4">return </span><span class="s1">createAndTestSocket</span><span class="s3">(</span><span class="s1">dir</span><span class="s3">);</span>
      <span class="s3">}</span>

      <span class="s1">options</span><span class="s3">.</span><span class="s1">exists </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
      <span class="s1">testSocket</span><span class="s3">();</span>
    <span class="s3">});</span>
  <span class="s3">}</span>

  <span class="s0">//</span>
  <span class="s0">// If it has been explicitly stated that the</span>
  <span class="s0">// target `options.path` already exists, then</span>
  <span class="s0">// simply test the socket.</span>
  <span class="s0">//</span>
  <span class="s4">return </span><span class="s1">options</span><span class="s3">.</span><span class="s1">exists</span>
    <span class="s3">? </span><span class="s1">testSocket</span><span class="s3">()</span>
    <span class="s3">: </span><span class="s1">checkAndTestSocket</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s0">//</span>
<span class="s0">// ### function nextPort (port)</span>
<span class="s0">// #### @port {Number} Port to increment from.</span>
<span class="s0">// Gets the next port in sequence from the</span>
<span class="s0">// specified `port`.</span>
<span class="s0">//</span>
<span class="s1">exports</span><span class="s3">.</span><span class="s1">nextPort </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">port</span><span class="s3">) {</span>
  <span class="s4">return </span><span class="s1">port </span><span class="s3">+ </span><span class="s5">1</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s0">//</span>
<span class="s0">// ### function nextSocket (socketPath)</span>
<span class="s0">// #### @socketPath {string} Path to increment from</span>
<span class="s0">// Gets the next socket path in sequence from the</span>
<span class="s0">// specified `socketPath`.</span>
<span class="s0">//</span>
<span class="s1">exports</span><span class="s3">.</span><span class="s1">nextSocket </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">socketPath</span><span class="s3">) {</span>
  <span class="s4">var </span><span class="s1">dir </span><span class="s3">= </span><span class="s1">path</span><span class="s3">.</span><span class="s1">dirname</span><span class="s3">(</span><span class="s1">socketPath</span><span class="s3">),</span>
      <span class="s1">name </span><span class="s3">= </span><span class="s1">path</span><span class="s3">.</span><span class="s1">basename</span><span class="s3">(</span><span class="s1">socketPath</span><span class="s3">, </span><span class="s2">'.sock'</span><span class="s3">),</span>
      <span class="s1">match </span><span class="s3">= </span><span class="s1">name</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s6">/^([a-zA-z]+)(\d*)$/i</span><span class="s3">),</span>
      <span class="s1">index </span><span class="s3">= </span><span class="s1">parseInt</span><span class="s3">(</span><span class="s1">match</span><span class="s3">[</span><span class="s5">2</span><span class="s3">]),</span>
      <span class="s1">base </span><span class="s3">= </span><span class="s1">match</span><span class="s3">[</span><span class="s5">1</span><span class="s3">];</span>
  <span class="s4">if </span><span class="s3">(</span><span class="s1">isNaN</span><span class="s3">(</span><span class="s1">index</span><span class="s3">)) {</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s5">0</span><span class="s3">;</span>
  <span class="s3">}</span>

  <span class="s1">index </span><span class="s3">+= </span><span class="s5">1</span><span class="s3">;</span>
  <span class="s4">return </span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">dir</span><span class="s3">, </span><span class="s1">base </span><span class="s3">+ </span><span class="s1">index </span><span class="s3">+ </span><span class="s2">'.sock'</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s7">/**</span>
 <span class="s7">* </span><span class="s8">@desc </span><span class="s7">List of internal hostnames provided by your machine. A user</span>
 <span class="s7">*       provided hostname may also be provided when calling portfinder.getPort,</span>
 <span class="s7">*       which would then be added to the default hosts we lookup and return here.</span>
 <span class="s7">*</span>
 <span class="s7">* </span><span class="s8">@return </span><span class="s7">{array}</span>
 <span class="s7">*</span>
 <span class="s7">* Long Form Explantion:</span>
 <span class="s7">*</span>
 <span class="s7">*    - Input: (os.networkInterfaces() w/ MacOS 10.11.5+ and running a VM)</span>
 <span class="s7">*</span>
 <span class="s7">*        { lo0:</span>
 <span class="s7">*         [ { address: '::1',</span>
 <span class="s7">*             netmask: 'ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff',</span>
 <span class="s7">*             family: 'IPv6',</span>
 <span class="s7">*             mac: '00:00:00:00:00:00',</span>
 <span class="s7">*             scopeid: 0,</span>
 <span class="s7">*             internal: true },</span>
 <span class="s7">*           { address: '127.0.0.1',</span>
 <span class="s7">*             netmask: '255.0.0.0',</span>
 <span class="s7">*             family: 'IPv4',</span>
 <span class="s7">*             mac: '00:00:00:00:00:00',</span>
 <span class="s7">*             internal: true },</span>
 <span class="s7">*           { address: 'fe80::1',</span>
 <span class="s7">*             netmask: 'ffff:ffff:ffff:ffff::',</span>
 <span class="s7">*             family: 'IPv6',</span>
 <span class="s7">*             mac: '00:00:00:00:00:00',</span>
 <span class="s7">*             scopeid: 1,</span>
 <span class="s7">*             internal: true } ],</span>
 <span class="s7">*        en0:</span>
 <span class="s7">*         [ { address: 'fe80::a299:9bff:fe17:766d',</span>
 <span class="s7">*             netmask: 'ffff:ffff:ffff:ffff::',</span>
 <span class="s7">*             family: 'IPv6',</span>
 <span class="s7">*             mac: 'a0:99:9b:17:76:6d',</span>
 <span class="s7">*             scopeid: 4,</span>
 <span class="s7">*             internal: false },</span>
 <span class="s7">*           { address: '10.0.1.22',</span>
 <span class="s7">*             netmask: '255.255.255.0',</span>
 <span class="s7">*             family: 'IPv4',</span>
 <span class="s7">*             mac: 'a0:99:9b:17:76:6d',</span>
 <span class="s7">*             internal: false } ],</span>
 <span class="s7">*        awdl0:</span>
 <span class="s7">*         [ { address: 'fe80::48a8:37ff:fe34:aaef',</span>
 <span class="s7">*             netmask: 'ffff:ffff:ffff:ffff::',</span>
 <span class="s7">*             family: 'IPv6',</span>
 <span class="s7">*             mac: '4a:a8:37:34:aa:ef',</span>
 <span class="s7">*             scopeid: 8,</span>
 <span class="s7">*             internal: false } ],</span>
 <span class="s7">*        vnic0:</span>
 <span class="s7">*         [ { address: '10.211.55.2',</span>
 <span class="s7">*             netmask: '255.255.255.0',</span>
 <span class="s7">*             family: 'IPv4',</span>
 <span class="s7">*             mac: '00:1c:42:00:00:08',</span>
 <span class="s7">*             internal: false } ],</span>
 <span class="s7">*        vnic1:</span>
 <span class="s7">*         [ { address: '10.37.129.2',</span>
 <span class="s7">*             netmask: '255.255.255.0',</span>
 <span class="s7">*             family: 'IPv4',</span>
 <span class="s7">*             mac: '00:1c:42:00:00:09',</span>
 <span class="s7">*             internal: false } ] }</span>
 <span class="s7">*</span>
 <span class="s7">*    - Output:</span>
 <span class="s7">*</span>
 <span class="s7">*         [</span>
 <span class="s7">*          '0.0.0.0',</span>
 <span class="s7">*          '::1',</span>
 <span class="s7">*          '127.0.0.1',</span>
 <span class="s7">*          'fe80::1',</span>
 <span class="s7">*          '10.0.1.22',</span>
 <span class="s7">*          'fe80::48a8:37ff:fe34:aaef',</span>
 <span class="s7">*          '10.211.55.2',</span>
 <span class="s7">*          '10.37.129.2'</span>
 <span class="s7">*         ]</span>
 <span class="s7">*</span>
 <span class="s7">*     Note we export this so we can use it in our tests, otherwise this API is private</span>
 <span class="s7">*/</span>
<span class="s1">exports</span><span class="s3">.</span><span class="s1">_defaultHosts </span><span class="s3">= (</span><span class="s4">function</span><span class="s3">() {</span>
  <span class="s4">var </span><span class="s1">interfaces </span><span class="s3">= {};</span>
  <span class="s4">try</span><span class="s3">{</span>
    <span class="s1">interfaces </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">networkInterfaces</span><span class="s3">();</span>
  <span class="s3">}</span>
  <span class="s4">catch</span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
    <span class="s0">// As of October 2016, Windows Subsystem for Linux (WSL) does not support</span>
    <span class="s0">// the os.networkInterfaces() call and throws instead. For this platform,</span>
    <span class="s0">// assume 0.0.0.0 as the only address</span>
    <span class="s0">//</span>
    <span class="s0">// - https://github.com/Microsoft/BashOnWindows/issues/468</span>
    <span class="s0">//</span>
    <span class="s0">// - Workaround is a mix of good work from the community:</span>
    <span class="s0">//   - https://github.com/http-party/node-portfinder/commit/8d7e30a648ff5034186551fa8a6652669dec2f2f</span>
    <span class="s0">//   - https://github.com/yarnpkg/yarn/pull/772/files</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">e</span><span class="s3">.</span><span class="s1">syscall </span><span class="s3">=== </span><span class="s2">'uv_interface_addresses'</span><span class="s3">) {</span>
      <span class="s0">// swallow error because we're just going to use defaults</span>
      <span class="s0">// documented @ https://github.com/nodejs/node/blob/4b65a65e75f48ff447cabd5500ce115fb5ad4c57/doc/api/net.md#L231</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
      <span class="s4">throw </span><span class="s1">e</span><span class="s3">;</span>
    <span class="s3">}</span>
  <span class="s3">}</span>

  <span class="s4">var </span><span class="s1">interfaceNames </span><span class="s3">= </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">(</span><span class="s1">interfaces</span><span class="s3">),</span>
      <span class="s1">hiddenButImportantHost </span><span class="s3">= </span><span class="s2">'0.0.0.0'</span><span class="s3">, </span><span class="s0">// !important - dont remove, hence the naming :)</span>
      <span class="s1">results </span><span class="s3">= [</span><span class="s1">hiddenButImportantHost</span><span class="s3">];</span>
  <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s5">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">interfaceNames</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; </span><span class="s1">i</span><span class="s3">++) {</span>
    <span class="s4">var </span><span class="s1">_interface </span><span class="s3">= </span><span class="s1">interfaces</span><span class="s3">[</span><span class="s1">interfaceNames</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]];</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">j </span><span class="s3">= </span><span class="s5">0</span><span class="s3">; </span><span class="s1">j </span><span class="s3">&lt; </span><span class="s1">_interface</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; </span><span class="s1">j</span><span class="s3">++) {</span>
      <span class="s4">var </span><span class="s1">curr </span><span class="s3">= </span><span class="s1">_interface</span><span class="s3">[</span><span class="s1">j</span><span class="s3">];</span>
      <span class="s1">results</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">curr</span><span class="s3">.</span><span class="s1">address</span><span class="s3">);</span>
    <span class="s3">}</span>
  <span class="s3">}</span>

  <span class="s0">// add null value, For createServer function, do not use host.</span>
  <span class="s1">results</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s4">null</span><span class="s3">);</span>

  <span class="s1">debugDefaultHosts</span><span class="s3">(</span><span class="s2">&quot;exports._defaultHosts is: %o&quot;</span><span class="s3">, </span><span class="s1">results</span><span class="s3">);</span>

  <span class="s4">return </span><span class="s1">results</span><span class="s3">;</span>
<span class="s3">}());</span>
</pre>
</body>
</html>