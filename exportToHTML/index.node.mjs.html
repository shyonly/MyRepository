<html>
<head>
<title>index.node.mjs</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
index.node.mjs</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s2">{ </span><span class="s1">declare </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'@babel/helper-plugin-utils'</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">_getTargets</span><span class="s2">, { </span><span class="s1">prettifyTargets</span><span class="s2">, </span><span class="s1">getInclusionReasons</span><span class="s2">, </span><span class="s1">isRequired </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'@babel/helper-compilation-targets'</span><span class="s2">;</span>
<span class="s0">import </span><span class="s2">* as </span><span class="s1">_babel from </span><span class="s3">'@babel/core'</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">path from </span><span class="s3">'path'</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">debounce from </span><span class="s3">'lodash.debounce'</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">requireResolve from </span><span class="s3">'resolve'</span><span class="s2">;</span>
<span class="s0">import </span><span class="s2">{ </span><span class="s1">createRequire </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'module'</span><span class="s2">;</span>

<span class="s0">const </span><span class="s2">{</span>
  <span class="s1">types</span><span class="s2">: </span><span class="s1">t$1</span><span class="s2">,</span>
  <span class="s1">template</span><span class="s2">: </span><span class="s1">template</span>
<span class="s2">} = </span><span class="s1">_babel</span><span class="s2">.</span><span class="s1">default </span><span class="s2">|| </span><span class="s1">_babel</span><span class="s2">;</span>
<span class="s0">function </span><span class="s1">intersection</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">) {</span>
  <span class="s0">const </span><span class="s1">result </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">();</span>
  <span class="s1">a</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s1">v </span><span class="s2">=&gt; </span><span class="s1">b</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">v</span><span class="s2">) &amp;&amp; </span><span class="s1">result</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">v</span><span class="s2">));</span>
  <span class="s0">return </span><span class="s1">result</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">has$1</span><span class="s2">(</span><span class="s1">object</span><span class="s2">, </span><span class="s1">key</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">object</span><span class="s2">, </span><span class="s1">key</span><span class="s2">);</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">getType</span><span class="s2">(</span><span class="s1">target</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">target</span><span class="s2">).</span><span class="s1">slice</span><span class="s2">(</span><span class="s4">8</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">);</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">resolveId</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">isIdentifier</span><span class="s2">() &amp;&amp; !</span><span class="s1">path</span><span class="s2">.</span><span class="s1">scope</span><span class="s2">.</span><span class="s1">hasBinding</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s5">/* noGlobals */</span><span class="s0">true</span><span class="s2">)) {</span>
    <span class="s0">return </span><span class="s1">path</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">isPure</span><span class="s2">()) {</span>
    <span class="s0">const </span><span class="s2">{</span>
      <span class="s1">deopt</span>
    <span class="s2">} = </span><span class="s1">path</span><span class="s2">.</span><span class="s1">evaluate</span><span class="s2">();</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">deopt </span><span class="s2">&amp;&amp; </span><span class="s1">deopt</span><span class="s2">.</span><span class="s1">isIdentifier</span><span class="s2">()) {</span>
      <span class="s0">return </span><span class="s1">deopt</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">resolveKey</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">computed </span><span class="s2">= </span><span class="s0">false</span><span class="s2">) {</span>
  <span class="s0">const </span><span class="s2">{</span>
    <span class="s1">scope</span>
  <span class="s2">} = </span><span class="s1">path</span><span class="s2">;</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">isStringLiteral</span><span class="s2">()) </span><span class="s0">return </span><span class="s1">path</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">value</span><span class="s2">;</span>
  <span class="s0">const </span><span class="s1">isIdentifier </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">isIdentifier</span><span class="s2">();</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">isIdentifier </span><span class="s2">&amp;&amp; !(</span><span class="s1">computed </span><span class="s2">|| </span><span class="s1">path</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">.</span><span class="s1">computed</span><span class="s2">)) {</span>
    <span class="s0">return </span><span class="s1">path</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">computed </span><span class="s2">&amp;&amp; </span><span class="s1">path</span><span class="s2">.</span><span class="s1">isMemberExpression</span><span class="s2">() &amp;&amp; </span><span class="s1">path</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;object&quot;</span><span class="s2">).</span><span class="s1">isIdentifier</span><span class="s2">({</span>
    <span class="s1">name</span><span class="s2">: </span><span class="s3">&quot;Symbol&quot;</span>
  <span class="s2">}) &amp;&amp; !</span><span class="s1">scope</span><span class="s2">.</span><span class="s1">hasBinding</span><span class="s2">(</span><span class="s3">&quot;Symbol&quot;</span><span class="s2">, </span><span class="s5">/* noGlobals */</span><span class="s0">true</span><span class="s2">)) {</span>
    <span class="s0">const </span><span class="s1">sym </span><span class="s2">= </span><span class="s1">resolveKey</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;property&quot;</span><span class="s2">), </span><span class="s1">path</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">computed</span><span class="s2">);</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">sym</span><span class="s2">) </span><span class="s0">return </span><span class="s3">&quot;Symbol.&quot; </span><span class="s2">+ </span><span class="s1">sym</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">isIdentifier </span><span class="s2">? </span><span class="s1">scope</span><span class="s2">.</span><span class="s1">hasBinding</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s5">/* noGlobals */</span><span class="s0">true</span><span class="s2">) : </span><span class="s1">path</span><span class="s2">.</span><span class="s1">isPure</span><span class="s2">()) {</span>
    <span class="s0">const </span><span class="s2">{</span>
      <span class="s1">value</span>
    <span class="s2">} = </span><span class="s1">path</span><span class="s2">.</span><span class="s1">evaluate</span><span class="s2">();</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">value </span><span class="s2">=== </span><span class="s3">&quot;string&quot;</span><span class="s2">) </span><span class="s0">return </span><span class="s1">value</span><span class="s2">;</span>
  <span class="s2">}</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">resolveSource</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) {</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">isMemberExpression</span><span class="s2">() &amp;&amp; </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;property&quot;</span><span class="s2">).</span><span class="s1">isIdentifier</span><span class="s2">({</span>
    <span class="s1">name</span><span class="s2">: </span><span class="s3">&quot;prototype&quot;</span>
  <span class="s2">})) {</span>
    <span class="s0">const </span><span class="s1">id </span><span class="s2">= </span><span class="s1">resolveId</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;object&quot;</span><span class="s2">));</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
      <span class="s0">return </span><span class="s2">{</span>
        <span class="s1">id</span><span class="s2">,</span>
        <span class="s1">placement</span><span class="s2">: </span><span class="s3">&quot;prototype&quot;</span>
      <span class="s2">};</span>
    <span class="s2">}</span>
    <span class="s0">return </span><span class="s2">{</span>
      <span class="s1">id</span><span class="s2">: </span><span class="s0">null</span><span class="s2">,</span>
      <span class="s1">placement</span><span class="s2">: </span><span class="s0">null</span>
    <span class="s2">};</span>
  <span class="s2">}</span>
  <span class="s0">const </span><span class="s1">id </span><span class="s2">= </span><span class="s1">resolveId</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">);</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
    <span class="s0">return </span><span class="s2">{</span>
      <span class="s1">id</span><span class="s2">,</span>
      <span class="s1">placement</span><span class="s2">: </span><span class="s3">&quot;static&quot;</span>
    <span class="s2">};</span>
  <span class="s2">}</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">isRegExpLiteral</span><span class="s2">()) {</span>
    <span class="s0">return </span><span class="s2">{</span>
      <span class="s1">id</span><span class="s2">: </span><span class="s3">&quot;RegExp&quot;</span><span class="s2">,</span>
      <span class="s1">placement</span><span class="s2">: </span><span class="s3">&quot;prototype&quot;</span>
    <span class="s2">};</span>
  <span class="s2">} </span><span class="s0">else if </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">isFunction</span><span class="s2">()) {</span>
    <span class="s0">return </span><span class="s2">{</span>
      <span class="s1">id</span><span class="s2">: </span><span class="s3">&quot;Function&quot;</span><span class="s2">,</span>
      <span class="s1">placement</span><span class="s2">: </span><span class="s3">&quot;prototype&quot;</span>
    <span class="s2">};</span>
  <span class="s2">} </span><span class="s0">else if </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">isPure</span><span class="s2">()) {</span>
    <span class="s0">const </span><span class="s2">{</span>
      <span class="s1">value</span>
    <span class="s2">} = </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">evaluate</span><span class="s2">();</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">value </span><span class="s2">!== </span><span class="s1">undefined</span><span class="s2">) {</span>
      <span class="s0">return </span><span class="s2">{</span>
        <span class="s1">id</span><span class="s2">: </span><span class="s1">getType</span><span class="s2">(</span><span class="s1">value</span><span class="s2">),</span>
        <span class="s1">placement</span><span class="s2">: </span><span class="s3">&quot;prototype&quot;</span>
      <span class="s2">};</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s0">return </span><span class="s2">{</span>
    <span class="s1">id</span><span class="s2">: </span><span class="s0">null</span><span class="s2">,</span>
    <span class="s1">placement</span><span class="s2">: </span><span class="s0">null</span>
  <span class="s2">};</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">getImportSource</span><span class="s2">({</span>
  <span class="s1">node</span>
<span class="s2">}) {</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">specifiers</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s4">0</span><span class="s2">) </span><span class="s0">return </span><span class="s1">node</span><span class="s2">.</span><span class="s1">source</span><span class="s2">.</span><span class="s1">value</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">getRequireSource</span><span class="s2">({</span>
  <span class="s1">node</span>
<span class="s2">}) {</span>
  <span class="s0">if </span><span class="s2">(!</span><span class="s1">t$1</span><span class="s2">.</span><span class="s1">isExpressionStatement</span><span class="s2">(</span><span class="s1">node</span><span class="s2">)) </span><span class="s0">return</span><span class="s2">;</span>
  <span class="s0">const </span><span class="s2">{</span>
    <span class="s1">expression</span>
  <span class="s2">} = </span><span class="s1">node</span><span class="s2">;</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">t$1</span><span class="s2">.</span><span class="s1">isCallExpression</span><span class="s2">(</span><span class="s1">expression</span><span class="s2">) &amp;&amp; </span><span class="s1">t$1</span><span class="s2">.</span><span class="s1">isIdentifier</span><span class="s2">(</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">callee</span><span class="s2">) &amp;&amp; </span><span class="s1">expression</span><span class="s2">.</span><span class="s1">callee</span><span class="s2">.</span><span class="s1">name </span><span class="s2">=== </span><span class="s3">&quot;require&quot; </span><span class="s2">&amp;&amp; </span><span class="s1">expression</span><span class="s2">.</span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s4">1 </span><span class="s2">&amp;&amp; </span><span class="s1">t$1</span><span class="s2">.</span><span class="s1">isStringLiteral</span><span class="s2">(</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">arguments</span><span class="s2">[</span><span class="s4">0</span><span class="s2">])) {</span>
    <span class="s0">return </span><span class="s1">expression</span><span class="s2">.</span><span class="s1">arguments</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">value</span><span class="s2">;</span>
  <span class="s2">}</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">hoist</span><span class="s2">(</span><span class="s1">node</span><span class="s2">) {</span>
  <span class="s5">// @ts-expect-error</span>
  <span class="s1">node</span><span class="s2">.</span><span class="s1">_blockHoist </span><span class="s2">= </span><span class="s4">3</span><span class="s2">;</span>
  <span class="s0">return </span><span class="s1">node</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">createUtilsGetter</span><span class="s2">(</span><span class="s1">cache</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s1">path </span><span class="s2">=&gt; {</span>
    <span class="s0">const </span><span class="s1">prog </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">findParent</span><span class="s2">(</span><span class="s1">p </span><span class="s2">=&gt; </span><span class="s1">p</span><span class="s2">.</span><span class="s1">isProgram</span><span class="s2">());</span>
    <span class="s0">return </span><span class="s2">{</span>
      <span class="s1">injectGlobalImport</span><span class="s2">(</span><span class="s1">url</span><span class="s2">) {</span>
        <span class="s1">cache</span><span class="s2">.</span><span class="s1">storeAnonymous</span><span class="s2">(</span><span class="s1">prog</span><span class="s2">, </span><span class="s1">url</span><span class="s2">, (</span><span class="s1">isScript</span><span class="s2">, </span><span class="s1">source</span><span class="s2">) =&gt; {</span>
          <span class="s0">return </span><span class="s1">isScript </span><span class="s2">? </span><span class="s1">template</span><span class="s2">.</span><span class="s1">statement</span><span class="s2">.</span><span class="s1">ast</span><span class="s3">`require(</span><span class="s1">$</span><span class="s2">{</span><span class="s1">source</span><span class="s2">}</span><span class="s3">)` </span><span class="s2">: </span><span class="s1">t$1</span><span class="s2">.</span><span class="s1">importDeclaration</span><span class="s2">([], </span><span class="s1">source</span><span class="s2">);</span>
        <span class="s2">});</span>
      <span class="s2">},</span>
      <span class="s1">injectNamedImport</span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">hint </span><span class="s2">= </span><span class="s1">name</span><span class="s2">) {</span>
        <span class="s0">return </span><span class="s1">cache</span><span class="s2">.</span><span class="s1">storeNamed</span><span class="s2">(</span><span class="s1">prog</span><span class="s2">, </span><span class="s1">url</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, (</span><span class="s1">isScript</span><span class="s2">, </span><span class="s1">source</span><span class="s2">, </span><span class="s1">name</span><span class="s2">) =&gt; {</span>
          <span class="s0">const </span><span class="s1">id </span><span class="s2">= </span><span class="s1">prog</span><span class="s2">.</span><span class="s1">scope</span><span class="s2">.</span><span class="s1">generateUidIdentifier</span><span class="s2">(</span><span class="s1">hint</span><span class="s2">);</span>
          <span class="s0">return </span><span class="s2">{</span>
            <span class="s1">node</span><span class="s2">: </span><span class="s1">isScript </span><span class="s2">? </span><span class="s1">hoist</span><span class="s2">(</span><span class="s1">template</span><span class="s2">.</span><span class="s1">statement</span><span class="s2">.</span><span class="s1">ast</span><span class="s3">`</span>
                  <span class="s3">var </span><span class="s1">$</span><span class="s2">{</span><span class="s1">id</span><span class="s2">} </span><span class="s3">= require(</span><span class="s1">$</span><span class="s2">{</span><span class="s1">source</span><span class="s2">}</span><span class="s3">).</span><span class="s1">$</span><span class="s2">{</span><span class="s1">name</span><span class="s2">}</span>
                <span class="s3">`</span><span class="s2">) : </span><span class="s1">t$1</span><span class="s2">.</span><span class="s1">importDeclaration</span><span class="s2">([</span><span class="s1">t$1</span><span class="s2">.</span><span class="s1">importSpecifier</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)], </span><span class="s1">source</span><span class="s2">),</span>
            <span class="s1">name</span><span class="s2">: </span><span class="s1">id</span><span class="s2">.</span><span class="s1">name</span>
          <span class="s2">};</span>
        <span class="s2">});</span>
      <span class="s2">},</span>
      <span class="s1">injectDefaultImport</span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">hint </span><span class="s2">= </span><span class="s1">url</span><span class="s2">) {</span>
        <span class="s0">return </span><span class="s1">cache</span><span class="s2">.</span><span class="s1">storeNamed</span><span class="s2">(</span><span class="s1">prog</span><span class="s2">, </span><span class="s1">url</span><span class="s2">, </span><span class="s3">&quot;default&quot;</span><span class="s2">, (</span><span class="s1">isScript</span><span class="s2">, </span><span class="s1">source</span><span class="s2">) =&gt; {</span>
          <span class="s0">const </span><span class="s1">id </span><span class="s2">= </span><span class="s1">prog</span><span class="s2">.</span><span class="s1">scope</span><span class="s2">.</span><span class="s1">generateUidIdentifier</span><span class="s2">(</span><span class="s1">hint</span><span class="s2">);</span>
          <span class="s0">return </span><span class="s2">{</span>
            <span class="s1">node</span><span class="s2">: </span><span class="s1">isScript </span><span class="s2">? </span><span class="s1">hoist</span><span class="s2">(</span><span class="s1">template</span><span class="s2">.</span><span class="s1">statement</span><span class="s2">.</span><span class="s1">ast</span><span class="s3">`var </span><span class="s1">$</span><span class="s2">{</span><span class="s1">id</span><span class="s2">} </span><span class="s3">= require(</span><span class="s1">$</span><span class="s2">{</span><span class="s1">source</span><span class="s2">}</span><span class="s3">)`</span><span class="s2">) : </span><span class="s1">t$1</span><span class="s2">.</span><span class="s1">importDeclaration</span><span class="s2">([</span><span class="s1">t$1</span><span class="s2">.</span><span class="s1">importDefaultSpecifier</span><span class="s2">(</span><span class="s1">id</span><span class="s2">)], </span><span class="s1">source</span><span class="s2">),</span>
            <span class="s1">name</span><span class="s2">: </span><span class="s1">id</span><span class="s2">.</span><span class="s1">name</span>
          <span class="s2">};</span>
        <span class="s2">});</span>
      <span class="s2">}</span>
    <span class="s2">};</span>
  <span class="s2">};</span>
<span class="s2">}</span>

<span class="s0">const </span><span class="s2">{</span>
  <span class="s1">types</span><span class="s2">: </span><span class="s1">t</span>
<span class="s2">} = </span><span class="s1">_babel</span><span class="s2">.</span><span class="s1">default </span><span class="s2">|| </span><span class="s1">_babel</span><span class="s2">;</span>
<span class="s0">class </span><span class="s1">ImportsCache </span><span class="s2">{</span>
  <span class="s1">constructor</span><span class="s2">(</span><span class="s1">resolver</span><span class="s2">) {</span>
    <span class="s0">this</span><span class="s2">.</span><span class="s1">_imports </span><span class="s2">= </span><span class="s0">new </span><span class="s1">WeakMap</span><span class="s2">();</span>
    <span class="s0">this</span><span class="s2">.</span><span class="s1">_anonymousImports </span><span class="s2">= </span><span class="s0">new </span><span class="s1">WeakMap</span><span class="s2">();</span>
    <span class="s0">this</span><span class="s2">.</span><span class="s1">_lastImports </span><span class="s2">= </span><span class="s0">new </span><span class="s1">WeakMap</span><span class="s2">();</span>
    <span class="s0">this</span><span class="s2">.</span><span class="s1">_resolver </span><span class="s2">= </span><span class="s1">resolver</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s1">storeAnonymous</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">, </span><span class="s1">url</span><span class="s2">,</span>
  <span class="s5">// eslint-disable-next-line no-undef</span>
  <span class="s1">getVal</span><span class="s2">) {</span>
    <span class="s0">const </span><span class="s1">key </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">_normalizeKey</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">, </span><span class="s1">url</span><span class="s2">);</span>
    <span class="s0">const </span><span class="s1">imports </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">_ensure</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">_anonymousImports</span><span class="s2">, </span><span class="s1">programPath</span><span class="s2">, </span><span class="s1">Set</span><span class="s2">);</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">imports</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">key</span><span class="s2">)) </span><span class="s0">return</span><span class="s2">;</span>
    <span class="s0">const </span><span class="s1">node </span><span class="s2">= </span><span class="s1">getVal</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">sourceType </span><span class="s2">=== </span><span class="s3">&quot;script&quot;</span><span class="s2">, </span><span class="s1">t</span><span class="s2">.</span><span class="s1">stringLiteral</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">_resolver</span><span class="s2">(</span><span class="s1">url</span><span class="s2">)));</span>
    <span class="s1">imports</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">key</span><span class="s2">);</span>
    <span class="s0">this</span><span class="s2">.</span><span class="s1">_injectImport</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">, </span><span class="s1">node</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s1">storeNamed</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">, </span><span class="s1">url</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">getVal</span><span class="s2">) {</span>
    <span class="s0">const </span><span class="s1">key </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">_normalizeKey</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">, </span><span class="s1">url</span><span class="s2">, </span><span class="s1">name</span><span class="s2">);</span>
    <span class="s0">const </span><span class="s1">imports </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">_ensure</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">_imports</span><span class="s2">, </span><span class="s1">programPath</span><span class="s2">, </span><span class="s1">Map</span><span class="s2">);</span>
    <span class="s0">if </span><span class="s2">(!</span><span class="s1">imports</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">key</span><span class="s2">)) {</span>
      <span class="s0">const </span><span class="s2">{</span>
        <span class="s1">node</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">: </span><span class="s1">id</span>
      <span class="s2">} = </span><span class="s1">getVal</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">sourceType </span><span class="s2">=== </span><span class="s3">&quot;script&quot;</span><span class="s2">, </span><span class="s1">t</span><span class="s2">.</span><span class="s1">stringLiteral</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">_resolver</span><span class="s2">(</span><span class="s1">url</span><span class="s2">)), </span><span class="s1">t</span><span class="s2">.</span><span class="s1">identifier</span><span class="s2">(</span><span class="s1">name</span><span class="s2">));</span>
      <span class="s1">imports</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">id</span><span class="s2">);</span>
      <span class="s0">this</span><span class="s2">.</span><span class="s1">_injectImport</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">, </span><span class="s1">node</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s0">return </span><span class="s1">t</span><span class="s2">.</span><span class="s1">identifier</span><span class="s2">(</span><span class="s1">imports</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">key</span><span class="s2">));</span>
  <span class="s2">}</span>
  <span class="s1">_injectImport</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">, </span><span class="s1">node</span><span class="s2">) {</span>
    <span class="s0">const </span><span class="s1">lastImport </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">_lastImports</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">);</span>
    <span class="s0">let </span><span class="s1">newNodes</span><span class="s2">;</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">lastImport </span><span class="s2">&amp;&amp; </span><span class="s1">lastImport</span><span class="s2">.</span><span class="s1">node </span><span class="s2">&amp;&amp;</span>
    <span class="s5">// Sometimes the AST is modified and the &quot;last import&quot;</span>
    <span class="s5">// we have has been replaced</span>
    <span class="s1">lastImport</span><span class="s2">.</span><span class="s1">parent </span><span class="s2">=== </span><span class="s1">programPath</span><span class="s2">.</span><span class="s1">node </span><span class="s2">&amp;&amp; </span><span class="s1">lastImport</span><span class="s2">.</span><span class="s1">container </span><span class="s2">=== </span><span class="s1">programPath</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">) {</span>
      <span class="s1">newNodes </span><span class="s2">= </span><span class="s1">lastImport</span><span class="s2">.</span><span class="s1">insertAfter</span><span class="s2">(</span><span class="s1">node</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
      <span class="s1">newNodes </span><span class="s2">= </span><span class="s1">programPath</span><span class="s2">.</span><span class="s1">unshiftContainer</span><span class="s2">(</span><span class="s3">&quot;body&quot;</span><span class="s2">, </span><span class="s1">node</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s0">const </span><span class="s1">newNode </span><span class="s2">= </span><span class="s1">newNodes</span><span class="s2">[</span><span class="s1">newNodes</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s4">1</span><span class="s2">];</span>
    <span class="s0">this</span><span class="s2">.</span><span class="s1">_lastImports</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">, </span><span class="s1">newNode</span><span class="s2">);</span>

    <span class="s5">/* 
    let lastImport; 
     programPath.get(&quot;body&quot;).forEach(path =&gt; { 
      if (path.isImportDeclaration()) lastImport = path; 
      if ( 
        path.isExpressionStatement() &amp;&amp; 
        isRequireCall(path.get(&quot;expression&quot;)) 
      ) { 
        lastImport = path; 
      } 
      if ( 
        path.isVariableDeclaration() &amp;&amp; 
        path.get(&quot;declarations&quot;).length === 1 &amp;&amp; 
        (isRequireCall(path.get(&quot;declarations.0.init&quot;)) || 
          (path.get(&quot;declarations.0.init&quot;).isMemberExpression() &amp;&amp; 
            isRequireCall(path.get(&quot;declarations.0.init.object&quot;)))) 
      ) { 
        lastImport = path; 
      } 
    });*/</span>
  <span class="s2">}</span>

  <span class="s1">_ensure</span><span class="s2">(</span><span class="s1">map</span><span class="s2">, </span><span class="s1">programPath</span><span class="s2">, </span><span class="s1">Collection</span><span class="s2">) {</span>
    <span class="s0">let </span><span class="s1">collection </span><span class="s2">= </span><span class="s1">map</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">);</span>
    <span class="s0">if </span><span class="s2">(!</span><span class="s1">collection</span><span class="s2">) {</span>
      <span class="s1">collection </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Collection</span><span class="s2">();</span>
      <span class="s1">map</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">, </span><span class="s1">collection</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s0">return </span><span class="s1">collection</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s1">_normalizeKey</span><span class="s2">(</span><span class="s1">programPath</span><span class="s2">, </span><span class="s1">url</span><span class="s2">, </span><span class="s1">name </span><span class="s2">= </span><span class="s3">&quot;&quot;</span><span class="s2">) {</span>
    <span class="s0">const </span><span class="s2">{</span>
      <span class="s1">sourceType</span>
    <span class="s2">} = </span><span class="s1">programPath</span><span class="s2">.</span><span class="s1">node</span><span class="s2">;</span>

    <span class="s5">// If we rely on the imported binding (the &quot;name&quot; parameter), we also need to cache</span>
    <span class="s5">// based on the sourceType. This is because the module transforms change the names</span>
    <span class="s5">// of the import variables.</span>
    <span class="s0">return </span><span class="s3">`</span><span class="s1">$</span><span class="s2">{</span><span class="s1">name </span><span class="s2">&amp;&amp; </span><span class="s1">sourceType</span><span class="s2">}</span><span class="s3">::</span><span class="s1">$</span><span class="s2">{</span><span class="s1">url</span><span class="s2">}</span><span class="s3">::</span><span class="s1">$</span><span class="s2">{</span><span class="s1">name</span><span class="s2">}</span><span class="s3">`</span><span class="s2">;</span>
  <span class="s2">}</span>
<span class="s2">}</span>

<span class="s0">const </span><span class="s1">presetEnvSilentDebugHeader </span><span class="s2">= </span><span class="s3">&quot;#__secret_key__@babel/preset-env__don't_log_debug_header_and_resolved_targets&quot;</span><span class="s2">;</span>
<span class="s0">function </span><span class="s1">stringifyTargetsMultiline</span><span class="s2">(</span><span class="s1">targets</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">prettifyTargets</span><span class="s2">(</span><span class="s1">targets</span><span class="s2">), </span><span class="s0">null</span><span class="s2">, </span><span class="s4">2</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">patternToRegExp</span><span class="s2">(</span><span class="s1">pattern</span><span class="s2">) {</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">pattern </span><span class="s0">instanceof </span><span class="s1">RegExp</span><span class="s2">) </span><span class="s0">return </span><span class="s1">pattern</span><span class="s2">;</span>
  <span class="s0">try </span><span class="s2">{</span>
    <span class="s0">return new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s3">`^</span><span class="s1">$</span><span class="s2">{</span><span class="s1">pattern</span><span class="s2">}</span><span class="s3">$`</span><span class="s2">);</span>
  <span class="s2">} </span><span class="s0">catch </span><span class="s2">{</span>
    <span class="s0">return null</span><span class="s2">;</span>
  <span class="s2">}</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">buildUnusedError</span><span class="s2">(</span><span class="s1">label</span><span class="s2">, </span><span class="s1">unused</span><span class="s2">) {</span>
  <span class="s0">if </span><span class="s2">(!</span><span class="s1">unused</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) </span><span class="s0">return </span><span class="s3">&quot;&quot;</span><span class="s2">;</span>
  <span class="s0">return </span><span class="s3">`  - The following &quot;</span><span class="s1">$</span><span class="s2">{</span><span class="s1">label</span><span class="s2">}</span><span class="s3">&quot; patterns didn't match any polyfill:</span><span class="s0">\n</span><span class="s3">` </span><span class="s2">+ </span><span class="s1">unused</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">original </span><span class="s2">=&gt; </span><span class="s3">`    </span><span class="s1">$</span><span class="s2">{</span><span class="s1">String</span><span class="s2">(</span><span class="s1">original</span><span class="s2">)}</span><span class="s0">\n</span><span class="s3">`</span><span class="s2">).</span><span class="s1">join</span><span class="s2">(</span><span class="s3">&quot;&quot;</span><span class="s2">);</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">buldDuplicatesError</span><span class="s2">(</span><span class="s1">duplicates</span><span class="s2">) {</span>
  <span class="s0">if </span><span class="s2">(!</span><span class="s1">duplicates</span><span class="s2">.</span><span class="s1">size</span><span class="s2">) </span><span class="s0">return </span><span class="s3">&quot;&quot;</span><span class="s2">;</span>
  <span class="s0">return </span><span class="s3">`  - The following polyfills were matched both by &quot;include&quot; and &quot;exclude&quot; patterns:</span><span class="s0">\n</span><span class="s3">` </span><span class="s2">+ </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">from</span><span class="s2">(</span><span class="s1">duplicates</span><span class="s2">, </span><span class="s1">name </span><span class="s2">=&gt; </span><span class="s3">`    </span><span class="s1">$</span><span class="s2">{</span><span class="s1">name</span><span class="s2">}</span><span class="s0">\n</span><span class="s3">`</span><span class="s2">).</span><span class="s1">join</span><span class="s2">(</span><span class="s3">&quot;&quot;</span><span class="s2">);</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">validateIncludeExclude</span><span class="s2">(</span><span class="s1">provider</span><span class="s2">, </span><span class="s1">polyfills</span><span class="s2">, </span><span class="s1">includePatterns</span><span class="s2">, </span><span class="s1">excludePatterns</span><span class="s2">) {</span>
  <span class="s0">let </span><span class="s1">current</span><span class="s2">;</span>
  <span class="s0">const </span><span class="s1">filter </span><span class="s2">= </span><span class="s1">pattern </span><span class="s2">=&gt; {</span>
    <span class="s0">const </span><span class="s1">regexp </span><span class="s2">= </span><span class="s1">patternToRegExp</span><span class="s2">(</span><span class="s1">pattern</span><span class="s2">);</span>
    <span class="s0">if </span><span class="s2">(!</span><span class="s1">regexp</span><span class="s2">) </span><span class="s0">return false</span><span class="s2">;</span>
    <span class="s0">let </span><span class="s1">matched </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
    <span class="s0">for </span><span class="s2">(</span><span class="s0">const </span><span class="s1">polyfill of polyfills</span><span class="s2">) {</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">regexp</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">polyfill</span><span class="s2">)) {</span>
        <span class="s1">matched </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
        <span class="s1">current</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">polyfill</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">return </span><span class="s2">!</span><span class="s1">matched</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s5">// prettier-ignore</span>
  <span class="s0">const </span><span class="s1">include </span><span class="s2">= </span><span class="s1">current </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">();</span>
  <span class="s0">const </span><span class="s1">unusedInclude </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">from</span><span class="s2">(</span><span class="s1">includePatterns</span><span class="s2">).</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">filter</span><span class="s2">);</span>

  <span class="s5">// prettier-ignore</span>
  <span class="s0">const </span><span class="s1">exclude </span><span class="s2">= </span><span class="s1">current </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">();</span>
  <span class="s0">const </span><span class="s1">unusedExclude </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">from</span><span class="s2">(</span><span class="s1">excludePatterns</span><span class="s2">).</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">filter</span><span class="s2">);</span>
  <span class="s0">const </span><span class="s1">duplicates </span><span class="s2">= </span><span class="s1">intersection</span><span class="s2">(</span><span class="s1">include</span><span class="s2">, </span><span class="s1">exclude</span><span class="s2">);</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">duplicates</span><span class="s2">.</span><span class="s1">size </span><span class="s2">&gt; </span><span class="s4">0 </span><span class="s2">|| </span><span class="s1">unusedInclude</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s4">0 </span><span class="s2">|| </span><span class="s1">unusedExclude</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">) {</span>
    <span class="s0">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s3">`Error while validating the &quot;</span><span class="s1">$</span><span class="s2">{</span><span class="s1">provider</span><span class="s2">}</span><span class="s3">&quot; provider options:</span><span class="s0">\n</span><span class="s3">` </span><span class="s2">+ </span><span class="s1">buildUnusedError</span><span class="s2">(</span><span class="s3">&quot;include&quot;</span><span class="s2">, </span><span class="s1">unusedInclude</span><span class="s2">) + </span><span class="s1">buildUnusedError</span><span class="s2">(</span><span class="s3">&quot;exclude&quot;</span><span class="s2">, </span><span class="s1">unusedExclude</span><span class="s2">) + </span><span class="s1">buldDuplicatesError</span><span class="s2">(</span><span class="s1">duplicates</span><span class="s2">));</span>
  <span class="s2">}</span>
  <span class="s0">return </span><span class="s2">{</span>
    <span class="s1">include</span><span class="s2">,</span>
    <span class="s1">exclude</span>
  <span class="s2">};</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">applyMissingDependenciesDefaults</span><span class="s2">(</span><span class="s1">options</span><span class="s2">, </span><span class="s1">babelApi</span><span class="s2">) {</span>
  <span class="s0">const </span><span class="s2">{</span>
    <span class="s1">missingDependencies </span><span class="s2">= {}</span>
  <span class="s2">} = </span><span class="s1">options</span><span class="s2">;</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">missingDependencies </span><span class="s2">=== </span><span class="s0">false</span><span class="s2">) </span><span class="s0">return false</span><span class="s2">;</span>
  <span class="s0">const </span><span class="s1">caller </span><span class="s2">= </span><span class="s1">babelApi</span><span class="s2">.</span><span class="s1">caller</span><span class="s2">(</span><span class="s1">caller </span><span class="s2">=&gt; </span><span class="s1">caller </span><span class="s2">== </span><span class="s0">null </span><span class="s2">? </span><span class="s0">void </span><span class="s4">0 </span><span class="s2">: </span><span class="s1">caller</span><span class="s2">.</span><span class="s1">name</span><span class="s2">);</span>
  <span class="s0">const </span><span class="s2">{</span>
    <span class="s1">log </span><span class="s2">= </span><span class="s3">&quot;deferred&quot;</span><span class="s2">,</span>
    <span class="s1">inject </span><span class="s2">= </span><span class="s1">caller </span><span class="s2">=== </span><span class="s3">&quot;rollup-plugin-babel&quot; </span><span class="s2">? </span><span class="s3">&quot;throw&quot; </span><span class="s2">: </span><span class="s3">&quot;import&quot;</span><span class="s2">,</span>
    <span class="s1">all </span><span class="s2">= </span><span class="s0">false</span>
  <span class="s2">} = </span><span class="s1">missingDependencies</span><span class="s2">;</span>
  <span class="s0">return </span><span class="s2">{</span>
    <span class="s1">log</span><span class="s2">,</span>
    <span class="s1">inject</span><span class="s2">,</span>
    <span class="s1">all</span>
  <span class="s2">};</span>
<span class="s2">}</span>

<span class="s0">var </span><span class="s1">usage </span><span class="s2">= (</span><span class="s1">callProvider </span><span class="s2">=&gt; {</span>
  <span class="s0">function </span><span class="s1">property</span><span class="s2">(</span><span class="s1">object</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">placement</span><span class="s2">, </span><span class="s1">path</span><span class="s2">) {</span>
    <span class="s0">return </span><span class="s1">callProvider</span><span class="s2">({</span>
      <span class="s1">kind</span><span class="s2">: </span><span class="s3">&quot;property&quot;</span><span class="s2">,</span>
      <span class="s1">object</span><span class="s2">,</span>
      <span class="s1">key</span><span class="s2">,</span>
      <span class="s1">placement</span>
    <span class="s2">}, </span><span class="s1">path</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s0">return </span><span class="s2">{</span>
    <span class="s5">// Symbol(), new Promise</span>
    <span class="s1">ReferencedIdentifier</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
      <span class="s0">const </span><span class="s2">{</span>
        <span class="s1">node</span><span class="s2">: {</span>
          <span class="s1">name</span>
        <span class="s2">},</span>
        <span class="s1">scope</span>
      <span class="s2">} = </span><span class="s1">path</span><span class="s2">;</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">scope</span><span class="s2">.</span><span class="s1">getBindingIdentifier</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)) </span><span class="s0">return</span><span class="s2">;</span>
      <span class="s1">callProvider</span><span class="s2">({</span>
        <span class="s1">kind</span><span class="s2">: </span><span class="s3">&quot;global&quot;</span><span class="s2">,</span>
        <span class="s1">name</span>
      <span class="s2">}, </span><span class="s1">path</span><span class="s2">);</span>
    <span class="s2">},</span>
    <span class="s1">MemberExpression</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
      <span class="s0">const </span><span class="s1">key </span><span class="s2">= </span><span class="s1">resolveKey</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;property&quot;</span><span class="s2">), </span><span class="s1">path</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">computed</span><span class="s2">);</span>
      <span class="s0">if </span><span class="s2">(!</span><span class="s1">key </span><span class="s2">|| </span><span class="s1">key </span><span class="s2">=== </span><span class="s3">&quot;prototype&quot;</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>
      <span class="s0">const </span><span class="s1">object </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;object&quot;</span><span class="s2">);</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">object</span><span class="s2">.</span><span class="s1">isIdentifier</span><span class="s2">()) {</span>
        <span class="s0">const </span><span class="s1">binding </span><span class="s2">= </span><span class="s1">object</span><span class="s2">.</span><span class="s1">scope</span><span class="s2">.</span><span class="s1">getBinding</span><span class="s2">(</span><span class="s1">object</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">);</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">binding </span><span class="s2">&amp;&amp; </span><span class="s1">binding</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">isImportNamespaceSpecifier</span><span class="s2">()) </span><span class="s0">return</span><span class="s2">;</span>
      <span class="s2">}</span>
      <span class="s0">const </span><span class="s1">source </span><span class="s2">= </span><span class="s1">resolveSource</span><span class="s2">(</span><span class="s1">object</span><span class="s2">);</span>
      <span class="s0">return </span><span class="s1">property</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">id</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">source</span><span class="s2">.</span><span class="s1">placement</span><span class="s2">, </span><span class="s1">path</span><span class="s2">);</span>
    <span class="s2">},</span>
    <span class="s1">ObjectPattern</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
      <span class="s0">const </span><span class="s2">{</span>
        <span class="s1">parentPath</span><span class="s2">,</span>
        <span class="s1">parent</span>
      <span class="s2">} = </span><span class="s1">path</span><span class="s2">;</span>
      <span class="s0">let </span><span class="s1">obj</span><span class="s2">;</span>

      <span class="s5">// const { keys, values } = Object</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">parentPath</span><span class="s2">.</span><span class="s1">isVariableDeclarator</span><span class="s2">()) {</span>
        <span class="s1">obj </span><span class="s2">= </span><span class="s1">parentPath</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;init&quot;</span><span class="s2">);</span>
        <span class="s5">// ({ keys, values } = Object)</span>
      <span class="s2">} </span><span class="s0">else if </span><span class="s2">(</span><span class="s1">parentPath</span><span class="s2">.</span><span class="s1">isAssignmentExpression</span><span class="s2">()) {</span>
        <span class="s1">obj </span><span class="s2">= </span><span class="s1">parentPath</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;right&quot;</span><span class="s2">);</span>
        <span class="s5">// !function ({ keys, values }) {...} (Object)</span>
        <span class="s5">// resolution does not work after properties transform :-(</span>
      <span class="s2">} </span><span class="s0">else if </span><span class="s2">(</span><span class="s1">parentPath</span><span class="s2">.</span><span class="s1">isFunction</span><span class="s2">()) {</span>
        <span class="s0">const </span><span class="s1">grand </span><span class="s2">= </span><span class="s1">parentPath</span><span class="s2">.</span><span class="s1">parentPath</span><span class="s2">;</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">grand</span><span class="s2">.</span><span class="s1">isCallExpression</span><span class="s2">() || </span><span class="s1">grand</span><span class="s2">.</span><span class="s1">isNewExpression</span><span class="s2">()) {</span>
          <span class="s0">if </span><span class="s2">(</span><span class="s1">grand</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">callee </span><span class="s2">=== </span><span class="s1">parent</span><span class="s2">) {</span>
            <span class="s1">obj </span><span class="s2">= </span><span class="s1">grand</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;arguments&quot;</span><span class="s2">)[</span><span class="s1">path</span><span class="s2">.</span><span class="s1">key</span><span class="s2">];</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
      <span class="s0">let </span><span class="s1">id </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
      <span class="s0">let </span><span class="s1">placement </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) ({</span>
        <span class="s1">id</span><span class="s2">,</span>
        <span class="s1">placement</span>
      <span class="s2">} = </span><span class="s1">resolveSource</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">));</span>
      <span class="s0">for </span><span class="s2">(</span><span class="s0">const </span><span class="s1">prop of path</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;properties&quot;</span><span class="s2">)) {</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">prop</span><span class="s2">.</span><span class="s1">isObjectProperty</span><span class="s2">()) {</span>
          <span class="s0">const </span><span class="s1">key </span><span class="s2">= </span><span class="s1">resolveKey</span><span class="s2">(</span><span class="s1">prop</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;key&quot;</span><span class="s2">));</span>
          <span class="s0">if </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) </span><span class="s1">property</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">placement</span><span class="s2">, </span><span class="s1">prop</span><span class="s2">);</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">},</span>
    <span class="s1">BinaryExpression</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">node</span><span class="s2">.</span><span class="s1">operator </span><span class="s2">!== </span><span class="s3">&quot;in&quot;</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>
      <span class="s0">const </span><span class="s1">source </span><span class="s2">= </span><span class="s1">resolveSource</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;right&quot;</span><span class="s2">));</span>
      <span class="s0">const </span><span class="s1">key </span><span class="s2">= </span><span class="s1">resolveKey</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;left&quot;</span><span class="s2">), </span><span class="s0">true</span><span class="s2">);</span>
      <span class="s0">if </span><span class="s2">(!</span><span class="s1">key</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>
      <span class="s1">callProvider</span><span class="s2">({</span>
        <span class="s1">kind</span><span class="s2">: </span><span class="s3">&quot;in&quot;</span><span class="s2">,</span>
        <span class="s1">object</span><span class="s2">: </span><span class="s1">source</span><span class="s2">.</span><span class="s1">id</span><span class="s2">,</span>
        <span class="s1">key</span><span class="s2">,</span>
        <span class="s1">placement</span><span class="s2">: </span><span class="s1">source</span><span class="s2">.</span><span class="s1">placement</span>
      <span class="s2">}, </span><span class="s1">path</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>
<span class="s2">});</span>

<span class="s0">var </span><span class="s1">entry </span><span class="s2">= (</span><span class="s1">callProvider </span><span class="s2">=&gt; ({</span>
  <span class="s1">ImportDeclaration</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
    <span class="s0">const </span><span class="s1">source </span><span class="s2">= </span><span class="s1">getImportSource</span><span class="s2">(</span><span class="s1">path</span><span class="s2">);</span>
    <span class="s0">if </span><span class="s2">(!</span><span class="s1">source</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>
    <span class="s1">callProvider</span><span class="s2">({</span>
      <span class="s1">kind</span><span class="s2">: </span><span class="s3">&quot;import&quot;</span><span class="s2">,</span>
      <span class="s1">source</span>
    <span class="s2">}, </span><span class="s1">path</span><span class="s2">);</span>
  <span class="s2">},</span>
  <span class="s1">Program</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
    <span class="s1">path</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;body&quot;</span><span class="s2">).</span><span class="s1">forEach</span><span class="s2">(</span><span class="s1">bodyPath </span><span class="s2">=&gt; {</span>
      <span class="s0">const </span><span class="s1">source </span><span class="s2">= </span><span class="s1">getRequireSource</span><span class="s2">(</span><span class="s1">bodyPath</span><span class="s2">);</span>
      <span class="s0">if </span><span class="s2">(!</span><span class="s1">source</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>
      <span class="s1">callProvider</span><span class="s2">({</span>
        <span class="s1">kind</span><span class="s2">: </span><span class="s3">&quot;import&quot;</span><span class="s2">,</span>
        <span class="s1">source</span>
      <span class="s2">}, </span><span class="s1">bodyPath</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">}</span>
<span class="s2">}));</span>

<span class="s0">const </span><span class="s1">nativeRequireResolve </span><span class="s2">= </span><span class="s1">parseFloat</span><span class="s2">(</span><span class="s1">process</span><span class="s2">.</span><span class="s1">versions</span><span class="s2">.</span><span class="s1">node</span><span class="s2">) &gt;= </span><span class="s4">8.9</span><span class="s2">;</span>
<span class="s0">const </span><span class="s1">require </span><span class="s2">= </span><span class="s1">createRequire</span><span class="s2">(</span><span class="s0">import </span><span class="s5">/*::(_)*/</span><span class="s2">.</span><span class="s1">meta</span><span class="s2">.</span><span class="s1">url</span><span class="s2">); </span><span class="s5">// eslint-disable-line</span>

<span class="s0">function </span><span class="s1">myResolve</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">basedir</span><span class="s2">) {</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">nativeRequireResolve</span><span class="s2">) {</span>
    <span class="s0">return </span><span class="s1">require</span><span class="s2">.</span><span class="s1">resolve</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, {</span>
      <span class="s1">paths</span><span class="s2">: [</span><span class="s1">basedir</span><span class="s2">]</span>
    <span class="s2">}).</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/\\/g</span><span class="s2">, </span><span class="s3">&quot;/&quot;</span><span class="s2">);</span>
  <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
    <span class="s0">return </span><span class="s1">requireResolve</span><span class="s2">.</span><span class="s1">sync</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, {</span>
      <span class="s1">basedir</span>
    <span class="s2">}).</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/\\/g</span><span class="s2">, </span><span class="s3">&quot;/&quot;</span><span class="s2">);</span>
  <span class="s2">}</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">resolve</span><span class="s2">(</span><span class="s1">dirname</span><span class="s2">, </span><span class="s1">moduleName</span><span class="s2">, </span><span class="s1">absoluteImports</span><span class="s2">) {</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">absoluteImports </span><span class="s2">=== </span><span class="s0">false</span><span class="s2">) </span><span class="s0">return </span><span class="s1">moduleName</span><span class="s2">;</span>
  <span class="s0">let </span><span class="s1">basedir </span><span class="s2">= </span><span class="s1">dirname</span><span class="s2">;</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">absoluteImports </span><span class="s2">=== </span><span class="s3">&quot;string&quot;</span><span class="s2">) {</span>
    <span class="s1">basedir </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">resolve</span><span class="s2">(</span><span class="s1">basedir</span><span class="s2">, </span><span class="s1">absoluteImports</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s0">try </span><span class="s2">{</span>
    <span class="s0">return </span><span class="s1">myResolve</span><span class="s2">(</span><span class="s1">moduleName</span><span class="s2">, </span><span class="s1">basedir</span><span class="s2">);</span>
  <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">err</span><span class="s2">) {</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">err</span><span class="s2">.</span><span class="s1">code </span><span class="s2">!== </span><span class="s3">&quot;MODULE_NOT_FOUND&quot;</span><span class="s2">) </span><span class="s0">throw </span><span class="s1">err</span><span class="s2">;</span>
    <span class="s0">throw </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">assign</span><span class="s2">(</span><span class="s0">new </span><span class="s1">Error</span><span class="s2">(</span><span class="s3">`Failed to resolve &quot;</span><span class="s1">$</span><span class="s2">{</span><span class="s1">moduleName</span><span class="s2">}</span><span class="s3">&quot; relative to &quot;</span><span class="s1">$</span><span class="s2">{</span><span class="s1">dirname</span><span class="s2">}</span><span class="s3">&quot;`</span><span class="s2">), {</span>
      <span class="s1">code</span><span class="s2">: </span><span class="s3">&quot;BABEL_POLYFILL_NOT_FOUND&quot;</span><span class="s2">,</span>
      <span class="s1">polyfill</span><span class="s2">: </span><span class="s1">moduleName</span><span class="s2">,</span>
      <span class="s1">dirname</span>
    <span class="s2">});</span>
  <span class="s2">}</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">has</span><span class="s2">(</span><span class="s1">basedir</span><span class="s2">, </span><span class="s1">name</span><span class="s2">) {</span>
  <span class="s0">try </span><span class="s2">{</span>
    <span class="s1">myResolve</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">basedir</span><span class="s2">);</span>
    <span class="s0">return true</span><span class="s2">;</span>
  <span class="s2">} </span><span class="s0">catch </span><span class="s2">{</span>
    <span class="s0">return false</span><span class="s2">;</span>
  <span class="s2">}</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">logMissing</span><span class="s2">(</span><span class="s1">missingDeps</span><span class="s2">) {</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">missingDeps</span><span class="s2">.</span><span class="s1">size </span><span class="s2">=== </span><span class="s4">0</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>
  <span class="s0">const </span><span class="s1">deps </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">from</span><span class="s2">(</span><span class="s1">missingDeps</span><span class="s2">).</span><span class="s1">sort</span><span class="s2">().</span><span class="s1">join</span><span class="s2">(</span><span class="s3">&quot; &quot;</span><span class="s2">);</span>
  <span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Some polyfills have been added but are not present in your dependencies.</span><span class="s0">\n</span><span class="s3">&quot; </span><span class="s2">+ </span><span class="s3">&quot;Please run one of the following commands:</span><span class="s0">\n</span><span class="s3">&quot; </span><span class="s2">+ </span><span class="s3">`</span><span class="s0">\t</span><span class="s3">npm install --save </span><span class="s1">$</span><span class="s2">{</span><span class="s1">deps</span><span class="s2">}</span><span class="s0">\n</span><span class="s3">` </span><span class="s2">+ </span><span class="s3">`</span><span class="s0">\t</span><span class="s3">yarn add </span><span class="s1">$</span><span class="s2">{</span><span class="s1">deps</span><span class="s2">}</span><span class="s0">\n</span><span class="s3">`</span><span class="s2">);</span>
  <span class="s1">process</span><span class="s2">.</span><span class="s1">exitCode </span><span class="s2">= </span><span class="s4">1</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s0">let </span><span class="s1">allMissingDeps </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">();</span>
<span class="s0">const </span><span class="s1">laterLogMissingDependencies </span><span class="s2">= </span><span class="s1">debounce</span><span class="s2">(() =&gt; {</span>
  <span class="s1">logMissing</span><span class="s2">(</span><span class="s1">allMissingDeps</span><span class="s2">);</span>
  <span class="s1">allMissingDeps </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">();</span>
<span class="s2">}, </span><span class="s4">100</span><span class="s2">);</span>
<span class="s0">function </span><span class="s1">laterLogMissing</span><span class="s2">(</span><span class="s1">missingDeps</span><span class="s2">) {</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">missingDeps</span><span class="s2">.</span><span class="s1">size </span><span class="s2">=== </span><span class="s4">0</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>
  <span class="s1">missingDeps</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s1">name </span><span class="s2">=&gt; </span><span class="s1">allMissingDeps</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">name</span><span class="s2">));</span>
  <span class="s1">laterLogMissingDependencies</span><span class="s2">();</span>
<span class="s2">}</span>

<span class="s0">const </span><span class="s1">PossibleGlobalObjects </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">([</span><span class="s3">&quot;global&quot;</span><span class="s2">, </span><span class="s3">&quot;globalThis&quot;</span><span class="s2">, </span><span class="s3">&quot;self&quot;</span><span class="s2">, </span><span class="s3">&quot;window&quot;</span><span class="s2">]);</span>
<span class="s0">function </span><span class="s1">createMetaResolver</span><span class="s2">(</span><span class="s1">polyfills</span><span class="s2">) {</span>
  <span class="s0">const </span><span class="s2">{</span>
    <span class="s0">static</span><span class="s2">: </span><span class="s1">staticP</span><span class="s2">,</span>
    <span class="s1">instance</span><span class="s2">: </span><span class="s1">instanceP</span><span class="s2">,</span>
    <span class="s1">global</span><span class="s2">: </span><span class="s1">globalP</span>
  <span class="s2">} = </span><span class="s1">polyfills</span><span class="s2">;</span>
  <span class="s0">return </span><span class="s1">meta </span><span class="s2">=&gt; {</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">meta</span><span class="s2">.</span><span class="s1">kind </span><span class="s2">=== </span><span class="s3">&quot;global&quot; </span><span class="s2">&amp;&amp; </span><span class="s1">globalP </span><span class="s2">&amp;&amp; </span><span class="s1">has$1</span><span class="s2">(</span><span class="s1">globalP</span><span class="s2">, </span><span class="s1">meta</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)) {</span>
      <span class="s0">return </span><span class="s2">{</span>
        <span class="s1">kind</span><span class="s2">: </span><span class="s3">&quot;global&quot;</span><span class="s2">,</span>
        <span class="s1">desc</span><span class="s2">: </span><span class="s1">globalP</span><span class="s2">[</span><span class="s1">meta</span><span class="s2">.</span><span class="s1">name</span><span class="s2">],</span>
        <span class="s1">name</span><span class="s2">: </span><span class="s1">meta</span><span class="s2">.</span><span class="s1">name</span>
      <span class="s2">};</span>
    <span class="s2">}</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">meta</span><span class="s2">.</span><span class="s1">kind </span><span class="s2">=== </span><span class="s3">&quot;property&quot; </span><span class="s2">|| </span><span class="s1">meta</span><span class="s2">.</span><span class="s1">kind </span><span class="s2">=== </span><span class="s3">&quot;in&quot;</span><span class="s2">) {</span>
      <span class="s0">const </span><span class="s2">{</span>
        <span class="s1">placement</span><span class="s2">,</span>
        <span class="s1">object</span><span class="s2">,</span>
        <span class="s1">key</span>
      <span class="s2">} = </span><span class="s1">meta</span><span class="s2">;</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">object </span><span class="s2">&amp;&amp; </span><span class="s1">placement </span><span class="s2">=== </span><span class="s3">&quot;static&quot;</span><span class="s2">) {</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">globalP </span><span class="s2">&amp;&amp; </span><span class="s1">PossibleGlobalObjects</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">object</span><span class="s2">) &amp;&amp; </span><span class="s1">has$1</span><span class="s2">(</span><span class="s1">globalP</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
          <span class="s0">return </span><span class="s2">{</span>
            <span class="s1">kind</span><span class="s2">: </span><span class="s3">&quot;global&quot;</span><span class="s2">,</span>
            <span class="s1">desc</span><span class="s2">: </span><span class="s1">globalP</span><span class="s2">[</span><span class="s1">key</span><span class="s2">],</span>
            <span class="s1">name</span><span class="s2">: </span><span class="s1">key</span>
          <span class="s2">};</span>
        <span class="s2">}</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">staticP </span><span class="s2">&amp;&amp; </span><span class="s1">has$1</span><span class="s2">(</span><span class="s1">staticP</span><span class="s2">, </span><span class="s1">object</span><span class="s2">) &amp;&amp; </span><span class="s1">has$1</span><span class="s2">(</span><span class="s1">staticP</span><span class="s2">[</span><span class="s1">object</span><span class="s2">], </span><span class="s1">key</span><span class="s2">)) {</span>
          <span class="s0">return </span><span class="s2">{</span>
            <span class="s1">kind</span><span class="s2">: </span><span class="s3">&quot;static&quot;</span><span class="s2">,</span>
            <span class="s1">desc</span><span class="s2">: </span><span class="s1">staticP</span><span class="s2">[</span><span class="s1">object</span><span class="s2">][</span><span class="s1">key</span><span class="s2">],</span>
            <span class="s1">name</span><span class="s2">: </span><span class="s3">`</span><span class="s1">$</span><span class="s2">{</span><span class="s1">object</span><span class="s2">}</span><span class="s3">$</span><span class="s1">$</span><span class="s2">{</span><span class="s1">key</span><span class="s2">}</span><span class="s3">`</span>
          <span class="s2">};</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">instanceP </span><span class="s2">&amp;&amp; </span><span class="s1">has$1</span><span class="s2">(</span><span class="s1">instanceP</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
        <span class="s0">return </span><span class="s2">{</span>
          <span class="s1">kind</span><span class="s2">: </span><span class="s3">&quot;instance&quot;</span><span class="s2">,</span>
          <span class="s1">desc</span><span class="s2">: </span><span class="s1">instanceP</span><span class="s2">[</span><span class="s1">key</span><span class="s2">],</span>
          <span class="s1">name</span><span class="s2">: </span><span class="s3">`</span><span class="s1">$</span><span class="s2">{</span><span class="s1">key</span><span class="s2">}</span><span class="s3">`</span>
        <span class="s2">};</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">};</span>
<span class="s2">}</span>

<span class="s0">const </span><span class="s1">getTargets </span><span class="s2">= </span><span class="s1">_getTargets</span><span class="s2">.</span><span class="s1">default </span><span class="s2">|| </span><span class="s1">_getTargets</span><span class="s2">;</span>
<span class="s0">function </span><span class="s1">resolveOptions</span><span class="s2">(</span><span class="s1">options</span><span class="s2">, </span><span class="s1">babelApi</span><span class="s2">) {</span>
  <span class="s0">const </span><span class="s2">{</span>
    <span class="s1">method</span><span class="s2">,</span>
    <span class="s1">targets</span><span class="s2">: </span><span class="s1">targetsOption</span><span class="s2">,</span>
    <span class="s1">ignoreBrowserslistConfig</span><span class="s2">,</span>
    <span class="s1">configPath</span><span class="s2">,</span>
    <span class="s1">debug</span><span class="s2">,</span>
    <span class="s1">shouldInjectPolyfill</span><span class="s2">,</span>
    <span class="s1">absoluteImports</span><span class="s2">,</span>
    <span class="s1">...providerOptions</span>
  <span class="s2">} = </span><span class="s1">options</span><span class="s2">;</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">isEmpty</span><span class="s2">(</span><span class="s1">options</span><span class="s2">)) {</span>
    <span class="s0">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s3">`</span><span class="s0">\ 
</span><span class="s3">This plugin requires options, for example: 
    { 
      &quot;plugins&quot;: [ 
        [&quot;&lt;plugin name&gt;&quot;, { method: &quot;usage-pure&quot; }] 
      ] 
    } 
 
See more options at https://github.com/babel/babel-polyfills/blob/main/docs/usage.md`</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s0">let </span><span class="s1">methodName</span><span class="s2">;</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">method </span><span class="s2">=== </span><span class="s3">&quot;usage-global&quot;</span><span class="s2">) </span><span class="s1">methodName </span><span class="s2">= </span><span class="s3">&quot;usageGlobal&quot;</span><span class="s2">;</span><span class="s0">else if </span><span class="s2">(</span><span class="s1">method </span><span class="s2">=== </span><span class="s3">&quot;entry-global&quot;</span><span class="s2">) </span><span class="s1">methodName </span><span class="s2">= </span><span class="s3">&quot;entryGlobal&quot;</span><span class="s2">;</span><span class="s0">else if </span><span class="s2">(</span><span class="s1">method </span><span class="s2">=== </span><span class="s3">&quot;usage-pure&quot;</span><span class="s2">) </span><span class="s1">methodName </span><span class="s2">= </span><span class="s3">&quot;usagePure&quot;</span><span class="s2">;</span><span class="s0">else if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">method </span><span class="s2">!== </span><span class="s3">&quot;string&quot;</span><span class="s2">) {</span>
    <span class="s0">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s3">&quot;.method must be a string&quot;</span><span class="s2">);</span>
  <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
    <span class="s0">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s3">`.method must be one of &quot;entry-global&quot;, &quot;usage-global&quot;` </span><span class="s2">+ </span><span class="s3">` or &quot;usage-pure&quot; (received </span><span class="s1">$</span><span class="s2">{</span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">method</span><span class="s2">)}</span><span class="s3">)`</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">shouldInjectPolyfill </span><span class="s2">=== </span><span class="s3">&quot;function&quot;</span><span class="s2">) {</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">include </span><span class="s2">|| </span><span class="s1">options</span><span class="s2">.</span><span class="s1">exclude</span><span class="s2">) {</span>
      <span class="s0">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s3">`.include and .exclude are not supported when using the` </span><span class="s2">+ </span><span class="s3">` .shouldInjectPolyfill function.`</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">} </span><span class="s0">else if </span><span class="s2">(</span><span class="s1">shouldInjectPolyfill </span><span class="s2">!= </span><span class="s0">null</span><span class="s2">) {</span>
    <span class="s0">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s3">`.shouldInjectPolyfill must be a function, or undefined` </span><span class="s2">+ </span><span class="s3">` (received </span><span class="s1">$</span><span class="s2">{</span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">shouldInjectPolyfill</span><span class="s2">)}</span><span class="s3">)`</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">absoluteImports </span><span class="s2">!= </span><span class="s0">null </span><span class="s2">&amp;&amp; </span><span class="s0">typeof </span><span class="s1">absoluteImports </span><span class="s2">!== </span><span class="s3">&quot;boolean&quot; </span><span class="s2">&amp;&amp; </span><span class="s0">typeof </span><span class="s1">absoluteImports </span><span class="s2">!== </span><span class="s3">&quot;string&quot;</span><span class="s2">) {</span>
    <span class="s0">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s3">`.absoluteImports must be a boolean, a string, or undefined` </span><span class="s2">+ </span><span class="s3">` (received </span><span class="s1">$</span><span class="s2">{</span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">absoluteImports</span><span class="s2">)}</span><span class="s3">)`</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s0">let </span><span class="s1">targets</span><span class="s2">;</span>
  <span class="s0">if </span><span class="s2">(</span>
  <span class="s5">// If any browserslist-related option is specified, fallback to the old</span>
  <span class="s5">// behavior of not using the targets specified in the top-level options.</span>
  <span class="s1">targetsOption </span><span class="s2">|| </span><span class="s1">configPath </span><span class="s2">|| </span><span class="s1">ignoreBrowserslistConfig</span><span class="s2">) {</span>
    <span class="s0">const </span><span class="s1">targetsObj </span><span class="s2">= </span><span class="s0">typeof </span><span class="s1">targetsOption </span><span class="s2">=== </span><span class="s3">&quot;string&quot; </span><span class="s2">|| </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">targetsOption</span><span class="s2">) ? {</span>
      <span class="s1">browsers</span><span class="s2">: </span><span class="s1">targetsOption</span>
    <span class="s2">} : </span><span class="s1">targetsOption</span><span class="s2">;</span>
    <span class="s1">targets </span><span class="s2">= </span><span class="s1">getTargets</span><span class="s2">(</span><span class="s1">targetsObj</span><span class="s2">, {</span>
      <span class="s1">ignoreBrowserslistConfig</span><span class="s2">,</span>
      <span class="s1">configPath</span>
    <span class="s2">});</span>
  <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
    <span class="s1">targets </span><span class="s2">= </span><span class="s1">babelApi</span><span class="s2">.</span><span class="s1">targets</span><span class="s2">();</span>
  <span class="s2">}</span>
  <span class="s0">return </span><span class="s2">{</span>
    <span class="s1">method</span><span class="s2">,</span>
    <span class="s1">methodName</span><span class="s2">,</span>
    <span class="s1">targets</span><span class="s2">,</span>
    <span class="s1">absoluteImports</span><span class="s2">: </span><span class="s1">absoluteImports </span><span class="s2">!= </span><span class="s0">null </span><span class="s2">? </span><span class="s1">absoluteImports </span><span class="s2">: </span><span class="s0">false</span><span class="s2">,</span>
    <span class="s1">shouldInjectPolyfill</span><span class="s2">,</span>
    <span class="s1">debug</span><span class="s2">: !!</span><span class="s1">debug</span><span class="s2">,</span>
    <span class="s1">providerOptions</span><span class="s2">: </span><span class="s1">providerOptions</span>
  <span class="s2">};</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">instantiateProvider</span><span class="s2">(</span><span class="s1">factory</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">missingDependencies</span><span class="s2">, </span><span class="s1">dirname</span><span class="s2">, </span><span class="s1">debugLog</span><span class="s2">, </span><span class="s1">babelApi</span><span class="s2">) {</span>
  <span class="s0">const </span><span class="s2">{</span>
    <span class="s1">method</span><span class="s2">,</span>
    <span class="s1">methodName</span><span class="s2">,</span>
    <span class="s1">targets</span><span class="s2">,</span>
    <span class="s1">debug</span><span class="s2">,</span>
    <span class="s1">shouldInjectPolyfill</span><span class="s2">,</span>
    <span class="s1">providerOptions</span><span class="s2">,</span>
    <span class="s1">absoluteImports</span>
  <span class="s2">} = </span><span class="s1">resolveOptions</span><span class="s2">(</span><span class="s1">options</span><span class="s2">, </span><span class="s1">babelApi</span><span class="s2">);</span>
  <span class="s0">const </span><span class="s1">getUtils </span><span class="s2">= </span><span class="s1">createUtilsGetter</span><span class="s2">(</span><span class="s0">new </span><span class="s1">ImportsCache</span><span class="s2">(</span><span class="s1">moduleName </span><span class="s2">=&gt; </span><span class="s1">resolve</span><span class="s2">(</span><span class="s1">dirname</span><span class="s2">, </span><span class="s1">moduleName</span><span class="s2">, </span><span class="s1">absoluteImports</span><span class="s2">)));</span>

  <span class="s5">// eslint-disable-next-line prefer-const</span>
  <span class="s0">let </span><span class="s1">include</span><span class="s2">, </span><span class="s1">exclude</span><span class="s2">;</span>
  <span class="s0">let </span><span class="s1">polyfillsSupport</span><span class="s2">;</span>
  <span class="s0">let </span><span class="s1">polyfillsNames</span><span class="s2">;</span>
  <span class="s0">let </span><span class="s1">filterPolyfills</span><span class="s2">;</span>
  <span class="s0">const </span><span class="s1">depsCache </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Map</span><span class="s2">();</span>
  <span class="s0">const </span><span class="s1">api </span><span class="s2">= {</span>
    <span class="s1">babel</span><span class="s2">: </span><span class="s1">babelApi</span><span class="s2">,</span>
    <span class="s1">getUtils</span><span class="s2">,</span>
    <span class="s1">method</span><span class="s2">: </span><span class="s1">options</span><span class="s2">.</span><span class="s1">method</span><span class="s2">,</span>
    <span class="s1">targets</span><span class="s2">,</span>
    <span class="s1">createMetaResolver</span><span class="s2">,</span>
    <span class="s1">shouldInjectPolyfill</span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">polyfillsNames </span><span class="s2">=== </span><span class="s1">undefined</span><span class="s2">) {</span>
        <span class="s0">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s3">`Internal error in the </span><span class="s1">$</span><span class="s2">{</span><span class="s1">factory</span><span class="s2">.</span><span class="s1">name</span><span class="s2">} </span><span class="s3">provider: ` </span><span class="s2">+ </span><span class="s3">`shouldInjectPolyfill() can't be called during initialization.`</span><span class="s2">);</span>
      <span class="s2">}</span>
      <span class="s0">if </span><span class="s2">(!</span><span class="s1">polyfillsNames</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)) {</span>
        <span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span><span class="s3">`Internal error in the </span><span class="s1">$</span><span class="s2">{</span><span class="s1">providerName</span><span class="s2">} </span><span class="s3">provider: ` </span><span class="s2">+ </span><span class="s3">`unknown polyfill &quot;</span><span class="s1">$</span><span class="s2">{</span><span class="s1">name</span><span class="s2">}</span><span class="s3">&quot;.`</span><span class="s2">);</span>
      <span class="s2">}</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">filterPolyfills </span><span class="s2">&amp;&amp; !</span><span class="s1">filterPolyfills</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)) </span><span class="s0">return false</span><span class="s2">;</span>
      <span class="s0">let </span><span class="s1">shouldInject </span><span class="s2">= </span><span class="s1">isRequired</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">targets</span><span class="s2">, {</span>
        <span class="s1">compatData</span><span class="s2">: </span><span class="s1">polyfillsSupport</span><span class="s2">,</span>
        <span class="s1">includes</span><span class="s2">: </span><span class="s1">include</span><span class="s2">,</span>
        <span class="s1">excludes</span><span class="s2">: </span><span class="s1">exclude</span>
      <span class="s2">});</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">shouldInjectPolyfill</span><span class="s2">) {</span>
        <span class="s1">shouldInject </span><span class="s2">= </span><span class="s1">shouldInjectPolyfill</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">shouldInject</span><span class="s2">);</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">shouldInject </span><span class="s2">!== </span><span class="s3">&quot;boolean&quot;</span><span class="s2">) {</span>
          <span class="s0">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s3">`.shouldInjectPolyfill must return a boolean.`</span><span class="s2">);</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
      <span class="s0">return </span><span class="s1">shouldInject</span><span class="s2">;</span>
    <span class="s2">},</span>
    <span class="s1">debug</span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
      <span class="s0">var </span><span class="s1">_debugLog</span><span class="s2">, </span><span class="s1">_debugLog$polyfillsSu</span><span class="s2">;</span>
      <span class="s1">debugLog</span><span class="s2">().</span><span class="s1">found </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
      <span class="s0">if </span><span class="s2">(!</span><span class="s1">debug </span><span class="s2">|| !</span><span class="s1">name</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">debugLog</span><span class="s2">().</span><span class="s1">polyfills</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">providerName</span><span class="s2">)) </span><span class="s0">return</span><span class="s2">;</span>
      <span class="s1">debugLog</span><span class="s2">().</span><span class="s1">polyfills</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">name</span><span class="s2">);</span>
      <span class="s2">(</span><span class="s1">_debugLog$polyfillsSu </span><span class="s2">= (</span><span class="s1">_debugLog </span><span class="s2">= </span><span class="s1">debugLog</span><span class="s2">()).</span><span class="s1">polyfillsSupport</span><span class="s2">) != </span><span class="s0">null </span><span class="s2">? </span><span class="s1">_debugLog$polyfillsSu </span><span class="s2">: </span><span class="s1">_debugLog</span><span class="s2">.</span><span class="s1">polyfillsSupport </span><span class="s2">= </span><span class="s1">polyfillsSupport</span><span class="s2">;</span>
    <span class="s2">},</span>
    <span class="s1">assertDependency</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">version </span><span class="s2">= </span><span class="s3">&quot;*&quot;</span><span class="s2">) {</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">missingDependencies </span><span class="s2">=== </span><span class="s0">false</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">absoluteImports</span><span class="s2">) {</span>
        <span class="s5">// If absoluteImports is not false, we will try resolving</span>
        <span class="s5">// the dependency and throw if it's not possible. We can</span>
        <span class="s5">// skip the check here.</span>
        <span class="s0">return</span><span class="s2">;</span>
      <span class="s2">}</span>
      <span class="s0">const </span><span class="s1">dep </span><span class="s2">= </span><span class="s1">version </span><span class="s2">=== </span><span class="s3">&quot;*&quot; </span><span class="s2">? </span><span class="s1">name </span><span class="s2">: </span><span class="s3">`</span><span class="s1">$</span><span class="s2">{</span><span class="s1">name</span><span class="s2">}</span><span class="s3">@^</span><span class="s1">$</span><span class="s2">{</span><span class="s1">version</span><span class="s2">}</span><span class="s3">`</span><span class="s2">;</span>
      <span class="s0">const </span><span class="s1">found </span><span class="s2">= </span><span class="s1">missingDependencies</span><span class="s2">.</span><span class="s1">all </span><span class="s2">? </span><span class="s0">false </span><span class="s2">: </span><span class="s1">mapGetOr</span><span class="s2">(</span><span class="s1">depsCache</span><span class="s2">, </span><span class="s3">`</span><span class="s1">$</span><span class="s2">{</span><span class="s1">name</span><span class="s2">} </span><span class="s3">:: </span><span class="s1">$</span><span class="s2">{</span><span class="s1">dirname</span><span class="s2">}</span><span class="s3">`</span><span class="s2">, () =&gt; </span><span class="s1">has</span><span class="s2">(</span><span class="s1">dirname</span><span class="s2">, </span><span class="s1">name</span><span class="s2">));</span>
      <span class="s0">if </span><span class="s2">(!</span><span class="s1">found</span><span class="s2">) {</span>
        <span class="s1">debugLog</span><span class="s2">().</span><span class="s1">missingDeps</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">dep</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">};</span>
  <span class="s0">const </span><span class="s1">provider </span><span class="s2">= </span><span class="s1">factory</span><span class="s2">(</span><span class="s1">api</span><span class="s2">, </span><span class="s1">providerOptions</span><span class="s2">, </span><span class="s1">dirname</span><span class="s2">);</span>
  <span class="s0">const </span><span class="s1">providerName </span><span class="s2">= </span><span class="s1">provider</span><span class="s2">.</span><span class="s1">name </span><span class="s2">|| </span><span class="s1">factory</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">provider</span><span class="s2">[</span><span class="s1">methodName</span><span class="s2">] !== </span><span class="s3">&quot;function&quot;</span><span class="s2">) {</span>
    <span class="s0">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s3">`The &quot;</span><span class="s1">$</span><span class="s2">{</span><span class="s1">providerName</span><span class="s2">}</span><span class="s3">&quot; provider doesn't support the &quot;</span><span class="s1">$</span><span class="s2">{</span><span class="s1">method</span><span class="s2">}</span><span class="s3">&quot; polyfilling method.`</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">provider</span><span class="s2">.</span><span class="s1">polyfills</span><span class="s2">)) {</span>
    <span class="s1">polyfillsNames </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">(</span><span class="s1">provider</span><span class="s2">.</span><span class="s1">polyfills</span><span class="s2">);</span>
    <span class="s1">filterPolyfills </span><span class="s2">= </span><span class="s1">provider</span><span class="s2">.</span><span class="s1">filterPolyfills</span><span class="s2">;</span>
  <span class="s2">} </span><span class="s0">else if </span><span class="s2">(</span><span class="s1">provider</span><span class="s2">.</span><span class="s1">polyfills</span><span class="s2">) {</span>
    <span class="s1">polyfillsNames </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">(</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">provider</span><span class="s2">.</span><span class="s1">polyfills</span><span class="s2">));</span>
    <span class="s1">polyfillsSupport </span><span class="s2">= </span><span class="s1">provider</span><span class="s2">.</span><span class="s1">polyfills</span><span class="s2">;</span>
    <span class="s1">filterPolyfills </span><span class="s2">= </span><span class="s1">provider</span><span class="s2">.</span><span class="s1">filterPolyfills</span><span class="s2">;</span>
  <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
    <span class="s1">polyfillsNames </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">();</span>
  <span class="s2">}</span>
  <span class="s2">({</span>
    <span class="s1">include</span><span class="s2">,</span>
    <span class="s1">exclude</span>
  <span class="s2">} = </span><span class="s1">validateIncludeExclude</span><span class="s2">(</span><span class="s1">providerName</span><span class="s2">, </span><span class="s1">polyfillsNames</span><span class="s2">, </span><span class="s1">providerOptions</span><span class="s2">.</span><span class="s1">include </span><span class="s2">|| [], </span><span class="s1">providerOptions</span><span class="s2">.</span><span class="s1">exclude </span><span class="s2">|| []));</span>
  <span class="s0">return </span><span class="s2">{</span>
    <span class="s1">debug</span><span class="s2">,</span>
    <span class="s1">method</span><span class="s2">,</span>
    <span class="s1">targets</span><span class="s2">,</span>
    <span class="s1">provider</span><span class="s2">,</span>
    <span class="s1">providerName</span><span class="s2">,</span>
    <span class="s1">callProvider</span><span class="s2">(</span><span class="s1">payload</span><span class="s2">, </span><span class="s1">path</span><span class="s2">) {</span>
      <span class="s0">const </span><span class="s1">utils </span><span class="s2">= </span><span class="s1">getUtils</span><span class="s2">(</span><span class="s1">path</span><span class="s2">);</span>
      <span class="s1">provider</span><span class="s2">[</span><span class="s1">methodName</span><span class="s2">](</span><span class="s1">payload</span><span class="s2">, </span><span class="s1">utils</span><span class="s2">, </span><span class="s1">path</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">definePolyfillProvider</span><span class="s2">(</span><span class="s1">factory</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s1">declare</span><span class="s2">((</span><span class="s1">babelApi</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">dirname</span><span class="s2">) =&gt; {</span>
    <span class="s1">babelApi</span><span class="s2">.</span><span class="s1">assertVersion</span><span class="s2">(</span><span class="s4">7</span><span class="s2">);</span>
    <span class="s0">const </span><span class="s2">{</span>
      <span class="s1">traverse</span>
    <span class="s2">} = </span><span class="s1">babelApi</span><span class="s2">;</span>
    <span class="s0">let </span><span class="s1">debugLog</span><span class="s2">;</span>
    <span class="s0">const </span><span class="s1">missingDependencies </span><span class="s2">= </span><span class="s1">applyMissingDependenciesDefaults</span><span class="s2">(</span><span class="s1">options</span><span class="s2">, </span><span class="s1">babelApi</span><span class="s2">);</span>
    <span class="s0">const </span><span class="s2">{</span>
      <span class="s1">debug</span><span class="s2">,</span>
      <span class="s1">method</span><span class="s2">,</span>
      <span class="s1">targets</span><span class="s2">,</span>
      <span class="s1">provider</span><span class="s2">,</span>
      <span class="s1">providerName</span><span class="s2">,</span>
      <span class="s1">callProvider</span>
    <span class="s2">} = </span><span class="s1">instantiateProvider</span><span class="s2">(</span><span class="s1">factory</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">missingDependencies</span><span class="s2">, </span><span class="s1">dirname</span><span class="s2">, () =&gt; </span><span class="s1">debugLog</span><span class="s2">, </span><span class="s1">babelApi</span><span class="s2">);</span>
    <span class="s0">const </span><span class="s1">createVisitor </span><span class="s2">= </span><span class="s1">method </span><span class="s2">=== </span><span class="s3">&quot;entry-global&quot; </span><span class="s2">? </span><span class="s1">entry </span><span class="s2">: </span><span class="s1">usage</span><span class="s2">;</span>
    <span class="s0">const </span><span class="s1">visitor </span><span class="s2">= </span><span class="s1">provider</span><span class="s2">.</span><span class="s1">visitor </span><span class="s2">? </span><span class="s1">traverse</span><span class="s2">.</span><span class="s1">visitors</span><span class="s2">.</span><span class="s1">merge</span><span class="s2">([</span><span class="s1">createVisitor</span><span class="s2">(</span><span class="s1">callProvider</span><span class="s2">), </span><span class="s1">provider</span><span class="s2">.</span><span class="s1">visitor</span><span class="s2">]) : </span><span class="s1">createVisitor</span><span class="s2">(</span><span class="s1">callProvider</span><span class="s2">);</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">debug </span><span class="s2">&amp;&amp; </span><span class="s1">debug </span><span class="s2">!== </span><span class="s1">presetEnvSilentDebugHeader</span><span class="s2">) {</span>
      <span class="s1">console</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s3">`</span><span class="s1">$</span><span class="s2">{</span><span class="s1">providerName</span><span class="s2">}</span><span class="s3">: </span><span class="s0">\`</span><span class="s3">DEBUG</span><span class="s0">\` </span><span class="s3">option`</span><span class="s2">);</span>
      <span class="s1">console</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s3">`</span><span class="s0">\n</span><span class="s3">Using targets: </span><span class="s1">$</span><span class="s2">{</span><span class="s1">stringifyTargetsMultiline</span><span class="s2">(</span><span class="s1">targets</span><span class="s2">)}</span><span class="s3">`</span><span class="s2">);</span>
      <span class="s1">console</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s3">`</span><span class="s0">\n</span><span class="s3">Using polyfills with </span><span class="s0">\`</span><span class="s1">$</span><span class="s2">{</span><span class="s1">method</span><span class="s2">}</span><span class="s0">\` </span><span class="s3">method:`</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s0">const </span><span class="s2">{</span>
      <span class="s1">runtimeName</span>
    <span class="s2">} = </span><span class="s1">provider</span><span class="s2">;</span>
    <span class="s0">return </span><span class="s2">{</span>
      <span class="s1">name</span><span class="s2">: </span><span class="s3">&quot;inject-polyfills&quot;</span><span class="s2">,</span>
      <span class="s1">visitor</span><span class="s2">,</span>
      <span class="s1">pre</span><span class="s2">(</span><span class="s1">file</span><span class="s2">) {</span>
        <span class="s0">var </span><span class="s1">_provider$pre</span><span class="s2">;</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">runtimeName</span><span class="s2">) {</span>
          <span class="s0">if </span><span class="s2">(</span><span class="s1">file</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;runtimeHelpersModuleName&quot;</span><span class="s2">) &amp;&amp; </span><span class="s1">file</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;runtimeHelpersModuleName&quot;</span><span class="s2">) !== </span><span class="s1">runtimeName</span><span class="s2">) {</span>
            <span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span><span class="s3">`Two different polyfill providers` </span><span class="s2">+ </span><span class="s3">` (</span><span class="s1">$</span><span class="s2">{</span><span class="s1">file</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;runtimeHelpersModuleProvider&quot;</span><span class="s2">)}</span><span class="s3">` </span><span class="s2">+ </span><span class="s3">` and </span><span class="s1">$</span><span class="s2">{</span><span class="s1">providerName</span><span class="s2">}</span><span class="s3">) are trying to define two` </span><span class="s2">+ </span><span class="s3">` conflicting @babel/runtime alternatives:` </span><span class="s2">+ </span><span class="s3">` </span><span class="s1">$</span><span class="s2">{</span><span class="s1">file</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;runtimeHelpersModuleName&quot;</span><span class="s2">)} </span><span class="s3">and </span><span class="s1">$</span><span class="s2">{</span><span class="s1">runtimeName</span><span class="s2">}</span><span class="s3">.` </span><span class="s2">+ </span><span class="s3">` The second one will be ignored.`</span><span class="s2">);</span>
          <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
            <span class="s1">file</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s3">&quot;runtimeHelpersModuleName&quot;</span><span class="s2">, </span><span class="s1">runtimeName</span><span class="s2">);</span>
            <span class="s1">file</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s3">&quot;runtimeHelpersModuleProvider&quot;</span><span class="s2">, </span><span class="s1">providerName</span><span class="s2">);</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s1">debugLog </span><span class="s2">= {</span>
          <span class="s1">polyfills</span><span class="s2">: </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">(),</span>
          <span class="s1">polyfillsSupport</span><span class="s2">: </span><span class="s1">undefined</span><span class="s2">,</span>
          <span class="s1">found</span><span class="s2">: </span><span class="s0">false</span><span class="s2">,</span>
          <span class="s1">providers</span><span class="s2">: </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">(),</span>
          <span class="s1">missingDeps</span><span class="s2">: </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">()</span>
        <span class="s2">};</span>
        <span class="s2">(</span><span class="s1">_provider$pre </span><span class="s2">= </span><span class="s1">provider</span><span class="s2">.</span><span class="s1">pre</span><span class="s2">) == </span><span class="s0">null </span><span class="s2">? </span><span class="s0">void </span><span class="s4">0 </span><span class="s2">: </span><span class="s1">_provider$pre</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s0">this</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
      <span class="s2">},</span>
      <span class="s1">post</span><span class="s2">() {</span>
        <span class="s0">var </span><span class="s1">_provider$post</span><span class="s2">;</span>
        <span class="s2">(</span><span class="s1">_provider$post </span><span class="s2">= </span><span class="s1">provider</span><span class="s2">.</span><span class="s1">post</span><span class="s2">) == </span><span class="s0">null </span><span class="s2">? </span><span class="s0">void </span><span class="s4">0 </span><span class="s2">: </span><span class="s1">_provider$post</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s0">this</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">missingDependencies </span><span class="s2">!== </span><span class="s0">false</span><span class="s2">) {</span>
          <span class="s0">if </span><span class="s2">(</span><span class="s1">missingDependencies</span><span class="s2">.</span><span class="s1">log </span><span class="s2">=== </span><span class="s3">&quot;per-file&quot;</span><span class="s2">) {</span>
            <span class="s1">logMissing</span><span class="s2">(</span><span class="s1">debugLog</span><span class="s2">.</span><span class="s1">missingDeps</span><span class="s2">);</span>
          <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
            <span class="s1">laterLogMissing</span><span class="s2">(</span><span class="s1">debugLog</span><span class="s2">.</span><span class="s1">missingDeps</span><span class="s2">);</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s0">if </span><span class="s2">(!</span><span class="s1">debug</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">filename</span><span class="s2">) </span><span class="s1">console</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s3">`</span><span class="s0">\n</span><span class="s3">[</span><span class="s1">$</span><span class="s2">{</span><span class="s0">this</span><span class="s2">.</span><span class="s1">filename</span><span class="s2">}</span><span class="s3">]`</span><span class="s2">);</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">debugLog</span><span class="s2">.</span><span class="s1">polyfills</span><span class="s2">.</span><span class="s1">size </span><span class="s2">=== </span><span class="s4">0</span><span class="s2">) {</span>
          <span class="s1">console</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s1">method </span><span class="s2">=== </span><span class="s3">&quot;entry-global&quot; </span><span class="s2">? </span><span class="s1">debugLog</span><span class="s2">.</span><span class="s1">found </span><span class="s2">? </span><span class="s3">`Based on your targets, the </span><span class="s1">$</span><span class="s2">{</span><span class="s1">providerName</span><span class="s2">} </span><span class="s3">polyfill did not add any polyfill.` </span><span class="s2">: </span><span class="s3">`The entry point for the </span><span class="s1">$</span><span class="s2">{</span><span class="s1">providerName</span><span class="s2">} </span><span class="s3">polyfill has not been found.` </span><span class="s2">: </span><span class="s3">`Based on your code and targets, the </span><span class="s1">$</span><span class="s2">{</span><span class="s1">providerName</span><span class="s2">} </span><span class="s3">polyfill did not add any polyfill.`</span><span class="s2">);</span>
          <span class="s0">return</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">method </span><span class="s2">=== </span><span class="s3">&quot;entry-global&quot;</span><span class="s2">) {</span>
          <span class="s1">console</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s3">`The </span><span class="s1">$</span><span class="s2">{</span><span class="s1">providerName</span><span class="s2">} </span><span class="s3">polyfill entry has been replaced with ` </span><span class="s2">+ </span><span class="s3">`the following polyfills:`</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
          <span class="s1">console</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s3">`The </span><span class="s1">$</span><span class="s2">{</span><span class="s1">providerName</span><span class="s2">} </span><span class="s3">polyfill added the following polyfills:`</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s0">for </span><span class="s2">(</span><span class="s0">const </span><span class="s1">name of debugLog</span><span class="s2">.</span><span class="s1">polyfills</span><span class="s2">) {</span>
          <span class="s0">var </span><span class="s1">_debugLog$polyfillsSu2</span><span class="s2">;</span>
          <span class="s0">if </span><span class="s2">((</span><span class="s1">_debugLog$polyfillsSu2 </span><span class="s2">= </span><span class="s1">debugLog</span><span class="s2">.</span><span class="s1">polyfillsSupport</span><span class="s2">) != </span><span class="s0">null </span><span class="s2">&amp;&amp; </span><span class="s1">_debugLog$polyfillsSu2</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]) {</span>
            <span class="s0">const </span><span class="s1">filteredTargets </span><span class="s2">= </span><span class="s1">getInclusionReasons</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">targets</span><span class="s2">, </span><span class="s1">debugLog</span><span class="s2">.</span><span class="s1">polyfillsSupport</span><span class="s2">);</span>
            <span class="s0">const </span><span class="s1">formattedTargets </span><span class="s2">= </span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">filteredTargets</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/,/g</span><span class="s2">, </span><span class="s3">&quot;, &quot;</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/^\{&quot;/</span><span class="s2">, </span><span class="s3">'{ &quot;'</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/&quot;\}$/</span><span class="s2">, </span><span class="s3">'&quot; }'</span><span class="s2">);</span>
            <span class="s1">console</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s3">`  </span><span class="s1">$</span><span class="s2">{</span><span class="s1">name</span><span class="s2">} </span><span class="s1">$</span><span class="s2">{</span><span class="s1">formattedTargets</span><span class="s2">}</span><span class="s3">`</span><span class="s2">);</span>
          <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
            <span class="s1">console</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s3">`  </span><span class="s1">$</span><span class="s2">{</span><span class="s1">name</span><span class="s2">}</span><span class="s3">`</span><span class="s2">);</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">};</span>
  <span class="s2">});</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">mapGetOr</span><span class="s2">(</span><span class="s1">map</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">getDefault</span><span class="s2">) {</span>
  <span class="s0">let </span><span class="s1">val </span><span class="s2">= </span><span class="s1">map</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">key</span><span class="s2">);</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">val </span><span class="s2">=== </span><span class="s1">undefined</span><span class="s2">) {</span>
    <span class="s1">val </span><span class="s2">= </span><span class="s1">getDefault</span><span class="s2">();</span>
    <span class="s1">map</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">val</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s0">return </span><span class="s1">val</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s0">function </span><span class="s1">isEmpty</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">).</span><span class="s1">length </span><span class="s2">=== </span><span class="s4">0</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s0">export default </span><span class="s1">definePolyfillProvider</span><span class="s2">;</span>
<span class="s5">//# sourceMappingURL=index.node.mjs.map</span>
</pre>
</body>
</html>