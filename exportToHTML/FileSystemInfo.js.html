<html>
<head>
<title>FileSystemInfo.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #6aab73;}
.s3 { color: #bcbec4;}
.s4 { color: #cf8e6d;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #67a37c; font-style: italic;}
.s7 { color: #2aacb8;}
.s8 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
FileSystemInfo.js</font>
</center></td></tr></table>
<pre><span class="s0">/* 
    MIT License http://www.opensource.org/licenses/mit-license.php 
    Author Tobias Koppers @sokra 
*/</span>

<span class="s2">&quot;use strict&quot;</span><span class="s3">;</span>

<span class="s4">const </span><span class="s3">{ </span><span class="s1">create</span><span class="s3">: </span><span class="s1">createResolver </span><span class="s3">} = </span><span class="s1">require</span><span class="s3">(</span><span class="s2">&quot;enhanced-resolve&quot;</span><span class="s3">);</span>
<span class="s4">const </span><span class="s1">nodeModule </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">&quot;module&quot;</span><span class="s3">);</span>
<span class="s4">const </span><span class="s1">asyncLib </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">&quot;neo-async&quot;</span><span class="s3">);</span>
<span class="s4">const </span><span class="s3">{ </span><span class="s1">isAbsolute </span><span class="s3">} = </span><span class="s1">require</span><span class="s3">(</span><span class="s2">&quot;path&quot;</span><span class="s3">);</span>
<span class="s4">const </span><span class="s1">AsyncQueue </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">&quot;./util/AsyncQueue&quot;</span><span class="s3">);</span>
<span class="s4">const </span><span class="s1">StackedCacheMap </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">&quot;./util/StackedCacheMap&quot;</span><span class="s3">);</span>
<span class="s4">const </span><span class="s1">createHash </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">&quot;./util/createHash&quot;</span><span class="s3">);</span>
<span class="s4">const </span><span class="s3">{ </span><span class="s1">join</span><span class="s3">, </span><span class="s1">dirname</span><span class="s3">, </span><span class="s1">relative</span><span class="s3">, </span><span class="s1">lstatReadlinkAbsolute </span><span class="s3">} = </span><span class="s1">require</span><span class="s3">(</span><span class="s2">&quot;./util/fs&quot;</span><span class="s3">);</span>
<span class="s4">const </span><span class="s1">makeSerializable </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">&quot;./util/makeSerializable&quot;</span><span class="s3">);</span>
<span class="s4">const </span><span class="s1">processAsyncTree </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">&quot;./util/processAsyncTree&quot;</span><span class="s3">);</span>

<span class="s5">/** </span><span class="s6">@typedef </span><span class="s5">{import(&quot;./WebpackError&quot;)} WebpackError */</span>
<span class="s5">/** </span><span class="s6">@typedef </span><span class="s5">{import(&quot;./logging/Logger&quot;).Logger} Logger */</span>
<span class="s5">/** </span><span class="s6">@typedef </span><span class="s5">{import(&quot;./serialization/ObjectMiddleware&quot;).ObjectDeserializerContext} ObjectDeserializerContext */</span>
<span class="s5">/** </span><span class="s6">@typedef </span><span class="s5">{import(&quot;./serialization/ObjectMiddleware&quot;).ObjectSerializerContext} ObjectSerializerContext */</span>
<span class="s5">/** </span><span class="s6">@typedef </span><span class="s5">{typeof import(&quot;./util/Hash&quot;)} Hash */</span>
<span class="s5">/** </span><span class="s6">@typedef </span><span class="s5">{import(&quot;./util/fs&quot;).IStats} IStats */</span>
<span class="s5">/** </span><span class="s6">@typedef </span><span class="s5">{import(&quot;./util/fs&quot;).InputFileSystem} InputFileSystem */</span>

<span class="s4">const </span><span class="s1">supportsEsm </span><span class="s3">= +</span><span class="s1">process</span><span class="s3">.</span><span class="s1">versions</span><span class="s3">.</span><span class="s1">modules </span><span class="s3">&gt;= </span><span class="s7">83</span><span class="s3">;</span>

<span class="s4">const </span><span class="s1">builtinModules </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">(</span><span class="s1">nodeModule</span><span class="s3">.</span><span class="s1">builtinModules</span><span class="s3">);</span>

<span class="s4">let </span><span class="s1">FS_ACCURACY </span><span class="s3">= </span><span class="s7">2000</span><span class="s3">;</span>

<span class="s4">const </span><span class="s1">EMPTY_SET </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>

<span class="s4">const </span><span class="s1">RBDT_RESOLVE_CJS </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
<span class="s4">const </span><span class="s1">RBDT_RESOLVE_ESM </span><span class="s3">= </span><span class="s7">1</span><span class="s3">;</span>
<span class="s4">const </span><span class="s1">RBDT_RESOLVE_DIRECTORY </span><span class="s3">= </span><span class="s7">2</span><span class="s3">;</span>
<span class="s4">const </span><span class="s1">RBDT_RESOLVE_CJS_FILE </span><span class="s3">= </span><span class="s7">3</span><span class="s3">;</span>
<span class="s4">const </span><span class="s1">RBDT_RESOLVE_CJS_FILE_AS_CHILD </span><span class="s3">= </span><span class="s7">4</span><span class="s3">;</span>
<span class="s4">const </span><span class="s1">RBDT_RESOLVE_ESM_FILE </span><span class="s3">= </span><span class="s7">5</span><span class="s3">;</span>
<span class="s4">const </span><span class="s1">RBDT_DIRECTORY </span><span class="s3">= </span><span class="s7">6</span><span class="s3">;</span>
<span class="s4">const </span><span class="s1">RBDT_FILE </span><span class="s3">= </span><span class="s7">7</span><span class="s3">;</span>
<span class="s4">const </span><span class="s1">RBDT_DIRECTORY_DEPENDENCIES </span><span class="s3">= </span><span class="s7">8</span><span class="s3">;</span>
<span class="s4">const </span><span class="s1">RBDT_FILE_DEPENDENCIES </span><span class="s3">= </span><span class="s7">9</span><span class="s3">;</span>

<span class="s4">const </span><span class="s1">INVALID </span><span class="s3">= </span><span class="s1">Symbol</span><span class="s3">(</span><span class="s2">&quot;invalid&quot;</span><span class="s3">);</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@typedef </span><span class="s5">{Object} FileSystemInfoEntry</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{number} safeTime</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{number=} timestamp</span>
 <span class="s5">*/</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@typedef </span><span class="s5">{Object} ResolvedContextFileSystemInfoEntry</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{number} safeTime</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{string=} timestampHash</span>
 <span class="s5">*/</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@typedef </span><span class="s5">{Object} ContextFileSystemInfoEntry</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{number} safeTime</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{string=} timestampHash</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{ResolvedContextFileSystemInfoEntry=} resolved</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Set&lt;string&gt;=} symlinks</span>
 <span class="s5">*/</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@typedef </span><span class="s5">{Object} TimestampAndHash</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{number} safeTime</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{number=} timestamp</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{string} hash</span>
 <span class="s5">*/</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@typedef </span><span class="s5">{Object} ResolvedContextTimestampAndHash</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{number} safeTime</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{string=} timestampHash</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{string} hash</span>
 <span class="s5">*/</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@typedef </span><span class="s5">{Object} ContextTimestampAndHash</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{number} safeTime</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{string=} timestampHash</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{string} hash</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{ResolvedContextTimestampAndHash=} resolved</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Set&lt;string&gt;=} symlinks</span>
 <span class="s5">*/</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@typedef </span><span class="s5">{Object} ContextHash</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{string} hash</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{string=} resolved</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Set&lt;string&gt;=} symlinks</span>
 <span class="s5">*/</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@typedef </span><span class="s5">{Object} SnapshotOptimizationEntry</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Snapshot} snapshot</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{number} shared</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Set&lt;string&gt; | undefined} snapshotContent</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Set&lt;SnapshotOptimizationEntry&gt; | undefined} children</span>
 <span class="s5">*/</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@typedef </span><span class="s5">{Object} ResolveBuildDependenciesResult</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Set&lt;string&gt;} files list of files</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Set&lt;string&gt;} directories list of directories</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Set&lt;string&gt;} missing list of missing entries</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Map&lt;string, string | false&gt;} resolveResults stored resolve results</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Object} resolveDependencies dependencies of the resolving</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Set&lt;string&gt;} resolveDependencies.files list of files</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Set&lt;string&gt;} resolveDependencies.directories list of directories</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{Set&lt;string&gt;} resolveDependencies.missing list of missing entries</span>
 <span class="s5">*/</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@typedef </span><span class="s5">{Object} SnapshotOptions</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{boolean=} hash should use hash to snapshot</span>
 <span class="s5">* </span><span class="s6">@property </span><span class="s5">{boolean=} timestamp should use timestamp to snapshot</span>
 <span class="s5">*/</span>

<span class="s4">const </span><span class="s1">DONE_ITERATOR_RESULT </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">().</span><span class="s1">keys</span><span class="s3">().</span><span class="s1">next</span><span class="s3">();</span>

<span class="s0">// cspell:word tshs</span>
<span class="s0">// Tsh = Timestamp + Hash</span>
<span class="s0">// Tshs = Timestamp + Hash combinations</span>

<span class="s4">class </span><span class="s1">SnapshotIterator </span><span class="s3">{</span>
	<span class="s1">constructor</span><span class="s3">(</span><span class="s1">next</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">next </span><span class="s3">= </span><span class="s1">next</span><span class="s3">;</span>
	<span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">class </span><span class="s1">SnapshotIterable </span><span class="s3">{</span>
	<span class="s1">constructor</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">getMaps</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">snapshot </span><span class="s3">= </span><span class="s1">snapshot</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">getMaps </span><span class="s3">= </span><span class="s1">getMaps</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s3">[</span><span class="s1">Symbol</span><span class="s3">.</span><span class="s1">iterator</span><span class="s3">]() {</span>
		<span class="s4">let </span><span class="s1">state </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{IterableIterator&lt;string&gt;} */</span>
		<span class="s4">let </span><span class="s1">it</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{(snapshot: Snapshot) =&gt; (Map&lt;string, any&gt; | Set&lt;string&gt;)[]} */</span>
		<span class="s4">let </span><span class="s1">getMaps</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{(Map&lt;string, any&gt; | Set&lt;string&gt;)[]} */</span>
		<span class="s4">let </span><span class="s1">maps</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Snapshot} */</span>
		<span class="s4">let </span><span class="s1">snapshot</span><span class="s3">;</span>
		<span class="s4">let </span><span class="s1">queue</span><span class="s3">;</span>
		<span class="s4">return new </span><span class="s1">SnapshotIterator</span><span class="s3">(() =&gt; {</span>
			<span class="s4">for </span><span class="s3">(;;) {</span>
				<span class="s4">switch </span><span class="s3">(</span><span class="s1">state</span><span class="s3">) {</span>
					<span class="s4">case </span><span class="s7">0</span><span class="s3">:</span>
						<span class="s1">snapshot </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">snapshot</span><span class="s3">;</span>
						<span class="s1">getMaps </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">getMaps</span><span class="s3">;</span>
						<span class="s1">maps </span><span class="s3">= </span><span class="s1">getMaps</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">);</span>
						<span class="s1">state </span><span class="s3">= </span><span class="s7">1</span><span class="s3">;</span>
					<span class="s0">/* falls through */</span>
					<span class="s4">case </span><span class="s7">1</span><span class="s3">:</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">maps</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) {</span>
							<span class="s4">const </span><span class="s1">map </span><span class="s3">= </span><span class="s1">maps</span><span class="s3">.</span><span class="s1">pop</span><span class="s3">();</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">map </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
								<span class="s1">it </span><span class="s3">= </span><span class="s1">map</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">();</span>
								<span class="s1">state </span><span class="s3">= </span><span class="s7">2</span><span class="s3">;</span>
							<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
								<span class="s4">break</span><span class="s3">;</span>
							<span class="s3">}</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">state </span><span class="s3">= </span><span class="s7">3</span><span class="s3">;</span>
							<span class="s4">break</span><span class="s3">;</span>
						<span class="s3">}</span>
					<span class="s0">/* falls through */</span>
					<span class="s4">case </span><span class="s7">2</span><span class="s3">: {</span>
						<span class="s4">const </span><span class="s1">result </span><span class="s3">= </span><span class="s1">it</span><span class="s3">.</span><span class="s1">next</span><span class="s3">();</span>
						<span class="s4">if </span><span class="s3">(!</span><span class="s1">result</span><span class="s3">.</span><span class="s1">done</span><span class="s3">) </span><span class="s4">return </span><span class="s1">result</span><span class="s3">;</span>
						<span class="s1">state </span><span class="s3">= </span><span class="s7">1</span><span class="s3">;</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s3">}</span>
					<span class="s4">case </span><span class="s7">3</span><span class="s3">: {</span>
						<span class="s4">const </span><span class="s1">children </span><span class="s3">= </span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">children</span><span class="s3">;</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">children </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">children</span><span class="s3">.</span><span class="s1">size </span><span class="s3">=== </span><span class="s7">1</span><span class="s3">) {</span>
								<span class="s0">// shortcut for a single child</span>
								<span class="s0">// avoids allocation of queue</span>
								<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">child of children</span><span class="s3">) </span><span class="s1">snapshot </span><span class="s3">= </span><span class="s1">child</span><span class="s3">;</span>
								<span class="s1">maps </span><span class="s3">= </span><span class="s1">getMaps</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">);</span>
								<span class="s1">state </span><span class="s3">= </span><span class="s7">1</span><span class="s3">;</span>
								<span class="s4">break</span><span class="s3">;</span>
							<span class="s3">}</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">queue </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s1">queue </span><span class="s3">= [];</span>
							<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">child of children</span><span class="s3">) {</span>
								<span class="s1">queue</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">child</span><span class="s3">);</span>
							<span class="s3">}</span>
						<span class="s3">}</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">queue </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">&amp;&amp; </span><span class="s1">queue</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) {</span>
							<span class="s1">snapshot </span><span class="s3">= </span><span class="s1">queue</span><span class="s3">.</span><span class="s1">pop</span><span class="s3">();</span>
							<span class="s1">maps </span><span class="s3">= </span><span class="s1">getMaps</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">);</span>
							<span class="s1">state </span><span class="s3">= </span><span class="s7">1</span><span class="s3">;</span>
							<span class="s4">break</span><span class="s3">;</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">state </span><span class="s3">= </span><span class="s7">4</span><span class="s3">;</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s0">/* falls through */</span>
					<span class="s4">case </span><span class="s7">4</span><span class="s3">:</span>
						<span class="s4">return </span><span class="s1">DONE_ITERATOR_RESULT</span><span class="s3">;</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
		<span class="s3">});</span>
	<span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">class </span><span class="s1">Snapshot </span><span class="s3">{</span>
	<span class="s1">constructor</span><span class="s3">() {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Iterable&lt;string&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedFileIterable </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Iterable&lt;string&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedContextIterable </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Iterable&lt;string&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedMissingIterable </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{number | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">startTime </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, FileSystemInfoEntry | null&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fileTimestamps </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, string | null&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fileHashes </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, TimestampAndHash | string | null&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fileTshs </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, ResolvedContextFileSystemInfoEntry | null&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTimestamps </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, string | null&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextHashes </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, ResolvedContextTimestampAndHash | null&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTshs </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, boolean&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">missingExistence </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, string&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedItemInfo </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedFiles </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedContexts </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedMissing </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;Snapshot&gt; | undefined} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">children </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">hasStartTime</span><span class="s3">() {</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">&amp; </span><span class="s7">1</span><span class="s3">) !== </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setStartTime</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">| </span><span class="s7">1</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">startTime </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setMergedStartTime</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">snapshot</span><span class="s3">) {</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">hasStartTime</span><span class="s3">()) {</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">setStartTime</span><span class="s3">(</span><span class="s1">Math</span><span class="s3">.</span><span class="s1">min</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">startTime</span><span class="s3">));</span>
			<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">setStartTime</span><span class="s3">(</span><span class="s1">value</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">hasStartTime</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">setStartTime</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">startTime</span><span class="s3">);</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s1">hasFileTimestamps</span><span class="s3">() {</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">&amp; </span><span class="s7">2</span><span class="s3">) !== </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setFileTimestamps</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">| </span><span class="s7">2</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fileTimestamps </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">hasFileHashes</span><span class="s3">() {</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">&amp; </span><span class="s7">4</span><span class="s3">) !== </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setFileHashes</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">| </span><span class="s7">4</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fileHashes </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">hasFileTshs</span><span class="s3">() {</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">&amp; </span><span class="s7">8</span><span class="s3">) !== </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setFileTshs</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">| </span><span class="s7">8</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fileTshs </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">hasContextTimestamps</span><span class="s3">() {</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">&amp; </span><span class="s7">0x10</span><span class="s3">) !== </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setContextTimestamps</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">| </span><span class="s7">0x10</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTimestamps </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">hasContextHashes</span><span class="s3">() {</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">&amp; </span><span class="s7">0x20</span><span class="s3">) !== </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setContextHashes</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">| </span><span class="s7">0x20</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextHashes </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">hasContextTshs</span><span class="s3">() {</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">&amp; </span><span class="s7">0x40</span><span class="s3">) !== </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setContextTshs</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">| </span><span class="s7">0x40</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTshs </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">hasMissingExistence</span><span class="s3">() {</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">&amp; </span><span class="s7">0x80</span><span class="s3">) !== </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setMissingExistence</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">| </span><span class="s7">0x80</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">missingExistence </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">hasManagedItemInfo</span><span class="s3">() {</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">&amp; </span><span class="s7">0x100</span><span class="s3">) !== </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setManagedItemInfo</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">| </span><span class="s7">0x100</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedItemInfo </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">hasManagedFiles</span><span class="s3">() {</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">&amp; </span><span class="s7">0x200</span><span class="s3">) !== </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setManagedFiles</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">| </span><span class="s7">0x200</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedFiles </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">hasManagedContexts</span><span class="s3">() {</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">&amp; </span><span class="s7">0x400</span><span class="s3">) !== </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setManagedContexts</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">| </span><span class="s7">0x400</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedContexts </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">hasManagedMissing</span><span class="s3">() {</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">&amp; </span><span class="s7">0x800</span><span class="s3">) !== </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setManagedMissing</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">| </span><span class="s7">0x800</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedMissing </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">hasChildren</span><span class="s3">() {</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">&amp; </span><span class="s7">0x1000</span><span class="s3">) !== </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">setChildren</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">| </span><span class="s7">0x1000</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">children </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">addChild</span><span class="s3">(</span><span class="s1">child</span><span class="s3">) {</span>
		<span class="s4">if </span><span class="s3">(!</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasChildren</span><span class="s3">()) {</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">setChildren</span><span class="s3">(</span><span class="s4">new </span><span class="s1">Set</span><span class="s3">());</span>
		<span class="s3">}</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">children</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">child</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ObjectSerializerContext} context context</span>
	 <span class="s5">*/</span>
	<span class="s1">serialize</span><span class="s3">({ </span><span class="s1">write </span><span class="s3">}) {</span>
		<span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_flags</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasStartTime</span><span class="s3">()) </span><span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">startTime</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasFileTimestamps</span><span class="s3">()) </span><span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fileTimestamps</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasFileHashes</span><span class="s3">()) </span><span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fileHashes</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasFileTshs</span><span class="s3">()) </span><span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fileTshs</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasContextTimestamps</span><span class="s3">()) </span><span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">contextTimestamps</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasContextHashes</span><span class="s3">()) </span><span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">contextHashes</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasContextTshs</span><span class="s3">()) </span><span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">contextTshs</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasMissingExistence</span><span class="s3">()) </span><span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">missingExistence</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasManagedItemInfo</span><span class="s3">()) </span><span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">managedItemInfo</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasManagedFiles</span><span class="s3">()) </span><span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">managedFiles</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasManagedContexts</span><span class="s3">()) </span><span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">managedContexts</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasManagedMissing</span><span class="s3">()) </span><span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">managedMissing</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasChildren</span><span class="s3">()) </span><span class="s1">write</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">children</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ObjectDeserializerContext} context context</span>
	 <span class="s5">*/</span>
	<span class="s1">deserialize</span><span class="s3">({ </span><span class="s1">read </span><span class="s3">}) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_flags </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasStartTime</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">startTime </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasFileTimestamps</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">fileTimestamps </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasFileHashes</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">fileHashes </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasFileTshs</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">fileTshs </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasContextTimestamps</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">contextTimestamps </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasContextHashes</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">contextHashes </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasContextTshs</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">contextTshs </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasMissingExistence</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">missingExistence </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasManagedItemInfo</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">managedItemInfo </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasManagedFiles</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">managedFiles </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasManagedContexts</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">managedContexts </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasManagedMissing</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">managedMissing </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">hasChildren</span><span class="s3">()) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">children </span><span class="s3">= </span><span class="s1">read</span><span class="s3">();</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function(Snapshot): (ReadonlyMap&lt;string, any&gt; | ReadonlySet&lt;string&gt;)[]} getMaps first</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{Iterable&lt;string&gt;} iterable</span>
	 <span class="s5">*/</span>
	<span class="s1">_createIterable</span><span class="s3">(</span><span class="s1">getMaps</span><span class="s3">) {</span>
		<span class="s4">return new </span><span class="s1">SnapshotIterable</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s1">getMaps</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{Iterable&lt;string&gt;} iterable</span>
	 <span class="s5">*/</span>
	<span class="s1">getFileIterable</span><span class="s3">() {</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedFileIterable </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) {</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedFileIterable </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_createIterable</span><span class="s3">(</span><span class="s1">s </span><span class="s3">=&gt; [</span>
				<span class="s1">s</span><span class="s3">.</span><span class="s1">fileTimestamps</span><span class="s3">,</span>
				<span class="s1">s</span><span class="s3">.</span><span class="s1">fileHashes</span><span class="s3">,</span>
				<span class="s1">s</span><span class="s3">.</span><span class="s1">fileTshs</span><span class="s3">,</span>
				<span class="s1">s</span><span class="s3">.</span><span class="s1">managedFiles</span>
			<span class="s3">]);</span>
		<span class="s3">}</span>
		<span class="s4">return this</span><span class="s3">.</span><span class="s1">_cachedFileIterable</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{Iterable&lt;string&gt;} iterable</span>
	 <span class="s5">*/</span>
	<span class="s1">getContextIterable</span><span class="s3">() {</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedContextIterable </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) {</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedContextIterable </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_createIterable</span><span class="s3">(</span><span class="s1">s </span><span class="s3">=&gt; [</span>
				<span class="s1">s</span><span class="s3">.</span><span class="s1">contextTimestamps</span><span class="s3">,</span>
				<span class="s1">s</span><span class="s3">.</span><span class="s1">contextHashes</span><span class="s3">,</span>
				<span class="s1">s</span><span class="s3">.</span><span class="s1">contextTshs</span><span class="s3">,</span>
				<span class="s1">s</span><span class="s3">.</span><span class="s1">managedContexts</span>
			<span class="s3">]);</span>
		<span class="s3">}</span>
		<span class="s4">return this</span><span class="s3">.</span><span class="s1">_cachedContextIterable</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{Iterable&lt;string&gt;} iterable</span>
	 <span class="s5">*/</span>
	<span class="s1">getMissingIterable</span><span class="s3">() {</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedMissingIterable </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) {</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedMissingIterable </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_createIterable</span><span class="s3">(</span><span class="s1">s </span><span class="s3">=&gt; [</span>
				<span class="s1">s</span><span class="s3">.</span><span class="s1">missingExistence</span><span class="s3">,</span>
				<span class="s1">s</span><span class="s3">.</span><span class="s1">managedMissing</span>
			<span class="s3">]);</span>
		<span class="s3">}</span>
		<span class="s4">return this</span><span class="s3">.</span><span class="s1">_cachedMissingIterable</span><span class="s3">;</span>
	<span class="s3">}</span>
<span class="s3">}</span>

<span class="s1">makeSerializable</span><span class="s3">(</span><span class="s1">Snapshot</span><span class="s3">, </span><span class="s2">&quot;webpack/lib/FileSystemInfo&quot;</span><span class="s3">, </span><span class="s2">&quot;Snapshot&quot;</span><span class="s3">);</span>

<span class="s4">const </span><span class="s1">MIN_COMMON_SNAPSHOT_SIZE </span><span class="s3">= </span><span class="s7">3</span><span class="s3">;</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@template </span><span class="s5">T</span>
 <span class="s5">*/</span>
<span class="s4">class </span><span class="s1">SnapshotOptimization </span><span class="s3">{</span>
	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function(Snapshot): boolean} has has value</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function(Snapshot): Map&lt;string, T&gt; | Set&lt;string&gt;} get get value</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function(Snapshot, Map&lt;string, T&gt; | Set&lt;string&gt;): void} set set value</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{boolean=} useStartTime use the start time of snapshots</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{boolean=} isSet value is an Set instead of a Map</span>
	 <span class="s5">*/</span>
	<span class="s1">constructor</span><span class="s3">(</span><span class="s1">has</span><span class="s3">, </span><span class="s1">get</span><span class="s3">, </span><span class="s1">set</span><span class="s3">, </span><span class="s1">useStartTime </span><span class="s3">= </span><span class="s4">true</span><span class="s3">, </span><span class="s1">isSet </span><span class="s3">= </span><span class="s4">false</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_has </span><span class="s3">= </span><span class="s1">has</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_get </span><span class="s3">= </span><span class="s1">get</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_set </span><span class="s3">= </span><span class="s1">set</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_useStartTime </span><span class="s3">= </span><span class="s1">useStartTime</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_isSet </span><span class="s3">= </span><span class="s1">isSet</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, SnapshotOptimizationEntry&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_map </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statItemsShared </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statItemsUnshared </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statSharedSnapshots </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statReusedSharedSnapshots </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">getStatisticMessage</span><span class="s3">() {</span>
		<span class="s4">const </span><span class="s1">total </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statItemsShared </span><span class="s3">+ </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statItemsUnshared</span><span class="s3">;</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">total </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) </span><span class="s4">return </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s4">return </span><span class="s2">`</span><span class="s1">$</span><span class="s3">{</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_statItemsShared </span><span class="s3">&amp;&amp; </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">round</span><span class="s3">((</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statItemsShared </span><span class="s3">* </span><span class="s7">100</span><span class="s3">) / </span><span class="s1">total</span><span class="s3">)</span>
		<span class="s3">}</span><span class="s2">% (</span><span class="s1">$</span><span class="s3">{</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statItemsShared</span><span class="s3">}</span><span class="s2">/</span><span class="s1">$</span><span class="s3">{</span><span class="s1">total</span><span class="s3">}</span><span class="s2">) entries shared via </span><span class="s1">$</span><span class="s3">{</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_statSharedSnapshots</span>
		<span class="s3">} </span><span class="s2">shared snapshots (</span><span class="s1">$</span><span class="s3">{</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_statReusedSharedSnapshots </span><span class="s3">+ </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statSharedSnapshots</span>
		<span class="s3">} </span><span class="s2">times referenced)`</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">clear</span><span class="s3">() {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_map</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statItemsShared </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statItemsUnshared </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statSharedSnapshots </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statReusedSharedSnapshots </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Snapshot} newSnapshot snapshot</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Set&lt;string&gt;} capturedFiles files to snapshot/share</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">optimize</span><span class="s3">(</span><span class="s1">newSnapshot</span><span class="s3">, </span><span class="s1">capturedFiles</span><span class="s3">) {</span>
		<span class="s5">/**</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{SnapshotOptimizationEntry} entry optimization entry</span>
		 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
		 <span class="s5">*/</span>
		<span class="s4">const </span><span class="s1">increaseSharedAndStoreOptimizationEntry </span><span class="s3">= </span><span class="s1">entry </span><span class="s3">=&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">children </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s1">entry</span><span class="s3">.</span><span class="s1">children</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s1">increaseSharedAndStoreOptimizationEntry</span><span class="s3">);</span>
			<span class="s3">}</span>
			<span class="s1">entry</span><span class="s3">.</span><span class="s1">shared</span><span class="s3">++;</span>
			<span class="s1">storeOptimizationEntry</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">);</span>
		<span class="s3">};</span>
		<span class="s5">/**</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{SnapshotOptimizationEntry} entry optimization entry</span>
		 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
		 <span class="s5">*/</span>
		<span class="s4">const </span><span class="s1">storeOptimizationEntry </span><span class="s3">= </span><span class="s1">entry </span><span class="s3">=&gt; {</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of entry</span><span class="s3">.</span><span class="s1">snapshotContent</span><span class="s3">) {</span>
				<span class="s4">const </span><span class="s1">old </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_map</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">old</span><span class="s3">.</span><span class="s1">shared </span><span class="s3">&lt; </span><span class="s1">entry</span><span class="s3">.</span><span class="s1">shared</span><span class="s3">) {</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_map</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s1">capturedFiles</span><span class="s3">.</span><span class="s1">delete</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">};</span>

		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{SnapshotOptimizationEntry | undefined} */</span>
		<span class="s4">let </span><span class="s1">newOptimizationEntry </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>

		<span class="s4">const </span><span class="s1">capturedFilesSize </span><span class="s3">= </span><span class="s1">capturedFiles</span><span class="s3">.</span><span class="s1">size</span><span class="s3">;</span>

		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;SnapshotOptimizationEntry&gt; | undefined} */</span>
		<span class="s4">const </span><span class="s1">optimizationEntries </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>

		<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of capturedFiles</span><span class="s3">) {</span>
			<span class="s4">const </span><span class="s1">optimizationEntry </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_map</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">optimizationEntry </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">newOptimizationEntry </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) {</span>
					<span class="s1">newOptimizationEntry </span><span class="s3">= {</span>
						<span class="s1">snapshot</span><span class="s3">: </span><span class="s1">newSnapshot</span><span class="s3">,</span>
						<span class="s1">shared</span><span class="s3">: </span><span class="s7">0</span><span class="s3">,</span>
						<span class="s1">snapshotContent</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
						<span class="s1">children</span><span class="s3">: </span><span class="s1">undefined</span>
					<span class="s3">};</span>
				<span class="s3">}</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_map</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">newOptimizationEntry</span><span class="s3">);</span>
				<span class="s4">continue</span><span class="s3">;</span>
			<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
				<span class="s1">optimizationEntries</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">optimizationEntry</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">}</span>

		<span class="s1">optimizationEntries</span><span class="s3">: </span><span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">optimizationEntry of optimizationEntries</span><span class="s3">) {</span>
			<span class="s4">const </span><span class="s1">snapshot </span><span class="s3">= </span><span class="s1">optimizationEntry</span><span class="s3">.</span><span class="s1">snapshot</span><span class="s3">;</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">optimizationEntry</span><span class="s3">.</span><span class="s1">shared </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) {</span>
				<span class="s0">// It's a shared snapshot</span>
				<span class="s0">// We can't change it, so we can only use it when all files match</span>
				<span class="s0">// and startTime is compatible</span>
				<span class="s4">if </span><span class="s3">(</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_useStartTime </span><span class="s3">&amp;&amp;</span>
					<span class="s1">newSnapshot</span><span class="s3">.</span><span class="s1">startTime </span><span class="s3">&amp;&amp;</span>
					<span class="s3">(!</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">startTime </span><span class="s3">|| </span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">startTime </span><span class="s3">&gt; </span><span class="s1">newSnapshot</span><span class="s3">.</span><span class="s1">startTime</span><span class="s3">)</span>
				<span class="s3">) {</span>
					<span class="s4">continue</span><span class="s3">;</span>
				<span class="s3">}</span>
				<span class="s4">const </span><span class="s1">nonSharedFiles </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
				<span class="s4">const </span><span class="s1">snapshotContent </span><span class="s3">= </span><span class="s1">optimizationEntry</span><span class="s3">.</span><span class="s1">snapshotContent</span><span class="s3">;</span>
				<span class="s4">const </span><span class="s1">snapshotEntries </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_get</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">);</span>
				<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of snapshotContent</span><span class="s3">) {</span>
					<span class="s4">if </span><span class="s3">(!</span><span class="s1">capturedFiles</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) {</span>
						<span class="s4">if </span><span class="s3">(!</span><span class="s1">snapshotEntries</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) {</span>
							<span class="s0">// File is not shared and can't be removed from the snapshot</span>
							<span class="s0">// because it's in a child of the snapshot</span>
							<span class="s4">continue </span><span class="s1">optimizationEntries</span><span class="s3">;</span>
						<span class="s3">}</span>
						<span class="s1">nonSharedFiles</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">continue</span><span class="s3">;</span>
					<span class="s3">}</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">nonSharedFiles</span><span class="s3">.</span><span class="s1">size </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s0">// The complete snapshot is shared</span>
					<span class="s0">// add it as child</span>
					<span class="s1">newSnapshot</span><span class="s3">.</span><span class="s1">addChild</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">);</span>
					<span class="s1">increaseSharedAndStoreOptimizationEntry</span><span class="s3">(</span><span class="s1">optimizationEntry</span><span class="s3">);</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_statReusedSharedSnapshots</span><span class="s3">++;</span>
				<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
					<span class="s0">// Only a part of the snapshot is shared</span>
					<span class="s4">const </span><span class="s1">sharedCount </span><span class="s3">= </span><span class="s1">snapshotContent</span><span class="s3">.</span><span class="s1">size </span><span class="s3">- </span><span class="s1">nonSharedFiles</span><span class="s3">.</span><span class="s1">size</span><span class="s3">;</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">sharedCount </span><span class="s3">&lt; </span><span class="s1">MIN_COMMON_SNAPSHOT_SIZE</span><span class="s3">) {</span>
						<span class="s0">// Common part it too small</span>
						<span class="s4">continue </span><span class="s1">optimizationEntries</span><span class="s3">;</span>
					<span class="s3">}</span>
					<span class="s0">// Extract common timestamps from both snapshots</span>
					<span class="s4">let </span><span class="s1">commonMap</span><span class="s3">;</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_isSet</span><span class="s3">) {</span>
						<span class="s1">commonMap </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
						<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */ </span><span class="s3">(</span><span class="s1">snapshotEntries</span><span class="s3">)) {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">nonSharedFiles</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) </span><span class="s4">continue</span><span class="s3">;</span>
							<span class="s1">commonMap</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
							<span class="s1">snapshotEntries</span><span class="s3">.</span><span class="s1">delete</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s3">}</span>
					<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
						<span class="s1">commonMap </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
						<span class="s4">const </span><span class="s1">map </span><span class="s3">= </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, T&gt;} */ </span><span class="s3">(</span><span class="s1">snapshotEntries</span><span class="s3">);</span>
						<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s3">[</span><span class="s1">path</span><span class="s3">, </span><span class="s1">value</span><span class="s3">] </span><span class="s1">of map</span><span class="s3">) {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">nonSharedFiles</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) </span><span class="s4">continue</span><span class="s3">;</span>
							<span class="s1">commonMap</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">value</span><span class="s3">);</span>
							<span class="s1">snapshotEntries</span><span class="s3">.</span><span class="s1">delete</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s0">// Create and attach snapshot</span>
					<span class="s4">const </span><span class="s1">commonSnapshot </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Snapshot</span><span class="s3">();</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_useStartTime</span><span class="s3">) {</span>
						<span class="s1">commonSnapshot</span><span class="s3">.</span><span class="s1">setMergedStartTime</span><span class="s3">(</span><span class="s1">newSnapshot</span><span class="s3">.</span><span class="s1">startTime</span><span class="s3">, </span><span class="s1">snapshot</span><span class="s3">);</span>
					<span class="s3">}</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_set</span><span class="s3">(</span><span class="s1">commonSnapshot</span><span class="s3">, </span><span class="s1">commonMap</span><span class="s3">);</span>
					<span class="s1">newSnapshot</span><span class="s3">.</span><span class="s1">addChild</span><span class="s3">(</span><span class="s1">commonSnapshot</span><span class="s3">);</span>
					<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">addChild</span><span class="s3">(</span><span class="s1">commonSnapshot</span><span class="s3">);</span>
					<span class="s0">// Create optimization entry</span>
					<span class="s4">const </span><span class="s1">newEntry </span><span class="s3">= {</span>
						<span class="s1">snapshot</span><span class="s3">: </span><span class="s1">commonSnapshot</span><span class="s3">,</span>
						<span class="s1">shared</span><span class="s3">: </span><span class="s1">optimizationEntry</span><span class="s3">.</span><span class="s1">shared </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">,</span>
						<span class="s1">snapshotContent</span><span class="s3">: </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">(</span><span class="s1">commonMap</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">()),</span>
						<span class="s1">children</span><span class="s3">: </span><span class="s1">undefined</span>
					<span class="s3">};</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">optimizationEntry</span><span class="s3">.</span><span class="s1">children </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">)</span>
						<span class="s1">optimizationEntry</span><span class="s3">.</span><span class="s1">children </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
					<span class="s1">optimizationEntry</span><span class="s3">.</span><span class="s1">children</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">newEntry</span><span class="s3">);</span>
					<span class="s1">storeOptimizationEntry</span><span class="s3">(</span><span class="s1">newEntry</span><span class="s3">);</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_statSharedSnapshots</span><span class="s3">++;</span>
				<span class="s3">}</span>
			<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
				<span class="s0">// It's a unshared snapshot</span>
				<span class="s0">// We can extract a common shared snapshot</span>
				<span class="s0">// with all common files</span>
				<span class="s4">const </span><span class="s1">snapshotEntries </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_get</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshotEntries </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) {</span>
					<span class="s0">// Incomplete snapshot, that can't be used</span>
					<span class="s4">continue </span><span class="s1">optimizationEntries</span><span class="s3">;</span>
				<span class="s3">}</span>
				<span class="s4">let </span><span class="s1">commonMap</span><span class="s3">;</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_isSet</span><span class="s3">) {</span>
					<span class="s1">commonMap </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
					<span class="s4">const </span><span class="s1">set </span><span class="s3">= </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */ </span><span class="s3">(</span><span class="s1">snapshotEntries</span><span class="s3">);</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">capturedFiles</span><span class="s3">.</span><span class="s1">size </span><span class="s3">&lt; </span><span class="s1">set</span><span class="s3">.</span><span class="s1">size</span><span class="s3">) {</span>
						<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of capturedFiles</span><span class="s3">) {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">set</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) </span><span class="s1">commonMap</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s3">}</span>
					<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
						<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of set</span><span class="s3">) {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">capturedFiles</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) </span><span class="s1">commonMap</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
				<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
					<span class="s1">commonMap </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
					<span class="s4">const </span><span class="s1">map </span><span class="s3">= </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, T&gt;} */ </span><span class="s3">(</span><span class="s1">snapshotEntries</span><span class="s3">);</span>
					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of capturedFiles</span><span class="s3">) {</span>
						<span class="s4">const </span><span class="s1">ts </span><span class="s3">= </span><span class="s1">map</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">ts </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">continue</span><span class="s3">;</span>
						<span class="s1">commonMap</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">);</span>
					<span class="s3">}</span>
				<span class="s3">}</span>

				<span class="s4">if </span><span class="s3">(</span><span class="s1">commonMap</span><span class="s3">.</span><span class="s1">size </span><span class="s3">&lt; </span><span class="s1">MIN_COMMON_SNAPSHOT_SIZE</span><span class="s3">) {</span>
					<span class="s0">// Common part it too small</span>
					<span class="s4">continue </span><span class="s1">optimizationEntries</span><span class="s3">;</span>
				<span class="s3">}</span>
				<span class="s0">// Create and attach snapshot</span>
				<span class="s4">const </span><span class="s1">commonSnapshot </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Snapshot</span><span class="s3">();</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_useStartTime</span><span class="s3">) {</span>
					<span class="s1">commonSnapshot</span><span class="s3">.</span><span class="s1">setMergedStartTime</span><span class="s3">(</span><span class="s1">newSnapshot</span><span class="s3">.</span><span class="s1">startTime</span><span class="s3">, </span><span class="s1">snapshot</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_set</span><span class="s3">(</span><span class="s1">commonSnapshot</span><span class="s3">, </span><span class="s1">commonMap</span><span class="s3">);</span>
				<span class="s1">newSnapshot</span><span class="s3">.</span><span class="s1">addChild</span><span class="s3">(</span><span class="s1">commonSnapshot</span><span class="s3">);</span>
				<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">addChild</span><span class="s3">(</span><span class="s1">commonSnapshot</span><span class="s3">);</span>
				<span class="s0">// Remove files from snapshot</span>
				<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of commonMap</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">()) </span><span class="s1">snapshotEntries</span><span class="s3">.</span><span class="s1">delete</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
				<span class="s4">const </span><span class="s1">sharedCount </span><span class="s3">= </span><span class="s1">commonMap</span><span class="s3">.</span><span class="s1">size</span><span class="s3">;</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_statItemsUnshared </span><span class="s3">-= </span><span class="s1">sharedCount</span><span class="s3">;</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_statItemsShared </span><span class="s3">+= </span><span class="s1">sharedCount</span><span class="s3">;</span>
				<span class="s0">// Create optimization entry</span>
				<span class="s1">storeOptimizationEntry</span><span class="s3">({</span>
					<span class="s1">snapshot</span><span class="s3">: </span><span class="s1">commonSnapshot</span><span class="s3">,</span>
					<span class="s1">shared</span><span class="s3">: </span><span class="s7">2</span><span class="s3">,</span>
					<span class="s1">snapshotContent</span><span class="s3">: </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">(</span><span class="s1">commonMap</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">()),</span>
					<span class="s1">children</span><span class="s3">: </span><span class="s1">undefined</span>
				<span class="s3">});</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_statSharedSnapshots</span><span class="s3">++;</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
		<span class="s4">const </span><span class="s1">unshared </span><span class="s3">= </span><span class="s1">capturedFiles</span><span class="s3">.</span><span class="s1">size</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statItemsUnshared </span><span class="s3">+= </span><span class="s1">unshared</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statItemsShared </span><span class="s3">+= </span><span class="s1">capturedFilesSize </span><span class="s3">- </span><span class="s1">unshared</span><span class="s3">;</span>
	<span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">const </span><span class="s1">parseString </span><span class="s3">= </span><span class="s1">str </span><span class="s3">=&gt; {</span>
	<span class="s4">if </span><span class="s3">(</span><span class="s1">str</span><span class="s3">[</span><span class="s7">0</span><span class="s3">] === </span><span class="s2">&quot;'&quot;</span><span class="s3">) </span><span class="s1">str </span><span class="s3">= </span><span class="s2">`&quot;</span><span class="s1">$</span><span class="s3">{</span><span class="s1">str</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s7">1</span><span class="s3">, -</span><span class="s7">1</span><span class="s3">).</span><span class="s1">replace</span><span class="s3">(</span><span class="s8">/&quot;/g</span><span class="s3">, </span><span class="s2">'</span><span class="s4">\\</span><span class="s2">&quot;'</span><span class="s3">)}</span><span class="s2">&quot;`</span><span class="s3">;</span>
	<span class="s4">return </span><span class="s1">JSON</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s1">str</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s0">/* istanbul ignore next */</span>
<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{number} mtime mtime</span>
 <span class="s5">*/</span>
<span class="s4">const </span><span class="s1">applyMtime </span><span class="s3">= </span><span class="s1">mtime </span><span class="s3">=&gt; {</span>
	<span class="s4">if </span><span class="s3">(</span><span class="s1">FS_ACCURACY </span><span class="s3">&gt; </span><span class="s7">1 </span><span class="s3">&amp;&amp; </span><span class="s1">mtime </span><span class="s3">% </span><span class="s7">2 </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) </span><span class="s1">FS_ACCURACY </span><span class="s3">= </span><span class="s7">1</span><span class="s3">;</span>
	<span class="s4">else if </span><span class="s3">(</span><span class="s1">FS_ACCURACY </span><span class="s3">&gt; </span><span class="s7">10 </span><span class="s3">&amp;&amp; </span><span class="s1">mtime </span><span class="s3">% </span><span class="s7">20 </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) </span><span class="s1">FS_ACCURACY </span><span class="s3">= </span><span class="s7">10</span><span class="s3">;</span>
	<span class="s4">else if </span><span class="s3">(</span><span class="s1">FS_ACCURACY </span><span class="s3">&gt; </span><span class="s7">100 </span><span class="s3">&amp;&amp; </span><span class="s1">mtime </span><span class="s3">% </span><span class="s7">200 </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) </span><span class="s1">FS_ACCURACY </span><span class="s3">= </span><span class="s7">100</span><span class="s3">;</span>
	<span class="s4">else if </span><span class="s3">(</span><span class="s1">FS_ACCURACY </span><span class="s3">&gt; </span><span class="s7">1000 </span><span class="s3">&amp;&amp; </span><span class="s1">mtime </span><span class="s3">% </span><span class="s7">2000 </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) </span><span class="s1">FS_ACCURACY </span><span class="s3">= </span><span class="s7">1000</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@template </span><span class="s5">T</span>
 <span class="s5">* </span><span class="s6">@template </span><span class="s5">K</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Map&lt;T, K&gt;} a source map</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Map&lt;T, K&gt;} b joining map</span>
 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{Map&lt;T, K&gt;} joined map</span>
 <span class="s5">*/</span>
<span class="s4">const </span><span class="s1">mergeMaps </span><span class="s3">= (</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">) =&gt; {</span>
	<span class="s4">if </span><span class="s3">(!</span><span class="s1">b </span><span class="s3">|| </span><span class="s1">b</span><span class="s3">.</span><span class="s1">size </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) </span><span class="s4">return </span><span class="s1">a</span><span class="s3">;</span>
	<span class="s4">if </span><span class="s3">(!</span><span class="s1">a </span><span class="s3">|| </span><span class="s1">a</span><span class="s3">.</span><span class="s1">size </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) </span><span class="s4">return </span><span class="s1">b</span><span class="s3">;</span>
	<span class="s4">const </span><span class="s1">map </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">(</span><span class="s1">a</span><span class="s3">);</span>
	<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s3">[</span><span class="s1">key</span><span class="s3">, </span><span class="s1">value</span><span class="s3">] </span><span class="s1">of b</span><span class="s3">) {</span>
		<span class="s1">map</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">key</span><span class="s3">, </span><span class="s1">value</span><span class="s3">);</span>
	<span class="s3">}</span>
	<span class="s4">return </span><span class="s1">map</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@template </span><span class="s5">T</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Set&lt;T&gt;} a source map</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Set&lt;T&gt;} b joining map</span>
 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{Set&lt;T&gt;} joined map</span>
 <span class="s5">*/</span>
<span class="s4">const </span><span class="s1">mergeSets </span><span class="s3">= (</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">) =&gt; {</span>
	<span class="s4">if </span><span class="s3">(!</span><span class="s1">b </span><span class="s3">|| </span><span class="s1">b</span><span class="s3">.</span><span class="s1">size </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) </span><span class="s4">return </span><span class="s1">a</span><span class="s3">;</span>
	<span class="s4">if </span><span class="s3">(!</span><span class="s1">a </span><span class="s3">|| </span><span class="s1">a</span><span class="s3">.</span><span class="s1">size </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) </span><span class="s4">return </span><span class="s1">b</span><span class="s3">;</span>
	<span class="s4">const </span><span class="s1">map </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">(</span><span class="s1">a</span><span class="s3">);</span>
	<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">item of b</span><span class="s3">) {</span>
		<span class="s1">map</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">item</span><span class="s3">);</span>
	<span class="s3">}</span>
	<span class="s4">return </span><span class="s1">map</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s5">/**</span>
 <span class="s5">* Finding file or directory to manage</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} managedPath path that is managing by {</span><span class="s6">@link </span><span class="s5">FileSystemInfo}</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path path to file or directory</span>
 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{string|null} managed item</span>
 <span class="s5">* </span><span class="s6">@example</span>
 <span class="s5">* getManagedItem(</span>
 <span class="s5">*   '/Users/user/my-project/node_modules/',</span>
 <span class="s5">*   '/Users/user/my-project/node_modules/package/index.js'</span>
 <span class="s5">* ) === '/Users/user/my-project/node_modules/package'</span>
 <span class="s5">* getManagedItem(</span>
 <span class="s5">*   '/Users/user/my-project/node_modules/',</span>
 <span class="s5">*   '/Users/user/my-project/node_modules/package1/node_modules/package2'</span>
 <span class="s5">* ) === '/Users/user/my-project/node_modules/package1/node_modules/package2'</span>
 <span class="s5">* getManagedItem(</span>
 <span class="s5">*   '/Users/user/my-project/node_modules/',</span>
 <span class="s5">*   '/Users/user/my-project/node_modules/.bin/script.js'</span>
 <span class="s5">* ) === null // hidden files are disallowed as managed items</span>
 <span class="s5">* getManagedItem(</span>
 <span class="s5">*   '/Users/user/my-project/node_modules/',</span>
 <span class="s5">*   '/Users/user/my-project/node_modules/package'</span>
 <span class="s5">* ) === '/Users/user/my-project/node_modules/package'</span>
 <span class="s5">*/</span>
<span class="s4">const </span><span class="s1">getManagedItem </span><span class="s3">= (</span><span class="s1">managedPath</span><span class="s3">, </span><span class="s1">path</span><span class="s3">) =&gt; {</span>
	<span class="s4">let </span><span class="s1">i </span><span class="s3">= </span><span class="s1">managedPath</span><span class="s3">.</span><span class="s1">length</span><span class="s3">;</span>
	<span class="s4">let </span><span class="s1">slashes </span><span class="s3">= </span><span class="s7">1</span><span class="s3">;</span>
	<span class="s4">let </span><span class="s1">startingPosition </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
	<span class="s1">loop</span><span class="s3">: </span><span class="s4">while </span><span class="s3">(</span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">path</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
		<span class="s4">switch </span><span class="s3">(</span><span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i</span><span class="s3">)) {</span>
			<span class="s4">case </span><span class="s7">47</span><span class="s3">: </span><span class="s0">// slash</span>
			<span class="s4">case </span><span class="s7">92</span><span class="s3">: </span><span class="s0">// backslash</span>
				<span class="s4">if </span><span class="s3">(--</span><span class="s1">slashes </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) </span><span class="s4">break </span><span class="s1">loop</span><span class="s3">;</span>
				<span class="s1">startingPosition </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
				<span class="s4">break</span><span class="s3">;</span>
			<span class="s4">case </span><span class="s7">46</span><span class="s3">: </span><span class="s0">// .</span>
				<span class="s0">// hidden files are disallowed as managed items</span>
				<span class="s0">// it's probably .yarn-integrity or .cache</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">startingPosition</span><span class="s3">) </span><span class="s4">return null</span><span class="s3">;</span>
				<span class="s4">break</span><span class="s3">;</span>
			<span class="s4">case </span><span class="s7">64</span><span class="s3">: </span><span class="s0">// @</span>
				<span class="s4">if </span><span class="s3">(!</span><span class="s1">startingPosition</span><span class="s3">) </span><span class="s4">return null</span><span class="s3">;</span>
				<span class="s1">slashes</span><span class="s3">++;</span>
				<span class="s4">break</span><span class="s3">;</span>
			<span class="s4">default</span><span class="s3">:</span>
				<span class="s1">startingPosition </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
				<span class="s4">break</span><span class="s3">;</span>
		<span class="s3">}</span>
		<span class="s1">i</span><span class="s3">++;</span>
	<span class="s3">}</span>
	<span class="s4">if </span><span class="s3">(</span><span class="s1">i </span><span class="s3">=== </span><span class="s1">path</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) </span><span class="s1">slashes</span><span class="s3">--;</span>
	<span class="s0">// return null when path is incomplete</span>
	<span class="s4">if </span><span class="s3">(</span><span class="s1">slashes </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) </span><span class="s4">return null</span><span class="s3">;</span>
	<span class="s0">// if (path.slice(i + 1, i + 13) === &quot;node_modules&quot;)</span>
	<span class="s4">if </span><span class="s3">(</span>
		<span class="s1">path</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt;= </span><span class="s1">i </span><span class="s3">+ </span><span class="s7">13 </span><span class="s3">&amp;&amp;</span>
		<span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">) === </span><span class="s7">110 </span><span class="s3">&amp;&amp;</span>
		<span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s7">2</span><span class="s3">) === </span><span class="s7">111 </span><span class="s3">&amp;&amp;</span>
		<span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s7">3</span><span class="s3">) === </span><span class="s7">100 </span><span class="s3">&amp;&amp;</span>
		<span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s7">4</span><span class="s3">) === </span><span class="s7">101 </span><span class="s3">&amp;&amp;</span>
		<span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s7">5</span><span class="s3">) === </span><span class="s7">95 </span><span class="s3">&amp;&amp;</span>
		<span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s7">6</span><span class="s3">) === </span><span class="s7">109 </span><span class="s3">&amp;&amp;</span>
		<span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s7">7</span><span class="s3">) === </span><span class="s7">111 </span><span class="s3">&amp;&amp;</span>
		<span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s7">8</span><span class="s3">) === </span><span class="s7">100 </span><span class="s3">&amp;&amp;</span>
		<span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s7">9</span><span class="s3">) === </span><span class="s7">117 </span><span class="s3">&amp;&amp;</span>
		<span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s7">10</span><span class="s3">) === </span><span class="s7">108 </span><span class="s3">&amp;&amp;</span>
		<span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s7">11</span><span class="s3">) === </span><span class="s7">101 </span><span class="s3">&amp;&amp;</span>
		<span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s7">12</span><span class="s3">) === </span><span class="s7">115</span>
	<span class="s3">) {</span>
		<span class="s0">// if this is the end of the path</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">path</span><span class="s3">.</span><span class="s1">length </span><span class="s3">=== </span><span class="s1">i </span><span class="s3">+ </span><span class="s7">13</span><span class="s3">) {</span>
			<span class="s0">// return the node_modules directory</span>
			<span class="s0">// it's special</span>
			<span class="s4">return </span><span class="s1">path</span><span class="s3">;</span>
		<span class="s3">}</span>
		<span class="s4">const </span><span class="s1">c </span><span class="s3">= </span><span class="s1">path</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s7">13</span><span class="s3">);</span>
		<span class="s0">// if next symbol is slash or backslash</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">c </span><span class="s3">=== </span><span class="s7">47 </span><span class="s3">|| </span><span class="s1">c </span><span class="s3">=== </span><span class="s7">92</span><span class="s3">) {</span>
			<span class="s0">// Managed subpath</span>
			<span class="s4">return </span><span class="s1">getManagedItem</span><span class="s3">(</span><span class="s1">path</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s7">0</span><span class="s3">, </span><span class="s1">i </span><span class="s3">+ </span><span class="s7">14</span><span class="s3">), </span><span class="s1">path</span><span class="s3">);</span>
		<span class="s3">}</span>
	<span class="s3">}</span>
	<span class="s4">return </span><span class="s1">path</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s7">0</span><span class="s3">, </span><span class="s1">i</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@template </span><span class="s5">{ContextFileSystemInfoEntry | ContextTimestampAndHash} T</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{T | null} entry entry</span>
 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{T[&quot;resolved&quot;] | null | undefined} the resolved entry</span>
 <span class="s5">*/</span>
<span class="s4">const </span><span class="s1">getResolvedTimestamp </span><span class="s3">= </span><span class="s1">entry </span><span class="s3">=&gt; {</span>
	<span class="s4">if </span><span class="s3">(</span><span class="s1">entry </span><span class="s3">=== </span><span class="s4">null</span><span class="s3">) </span><span class="s4">return null</span><span class="s3">;</span>
	<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">resolved </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">return </span><span class="s1">entry</span><span class="s3">.</span><span class="s1">resolved</span><span class="s3">;</span>
	<span class="s4">return </span><span class="s1">entry</span><span class="s3">.</span><span class="s1">symlinks </span><span class="s3">=== </span><span class="s1">undefined </span><span class="s3">? </span><span class="s1">entry </span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ContextHash | null} entry entry</span>
 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{string | null | undefined} the resolved entry</span>
 <span class="s5">*/</span>
<span class="s4">const </span><span class="s1">getResolvedHash </span><span class="s3">= </span><span class="s1">entry </span><span class="s3">=&gt; {</span>
	<span class="s4">if </span><span class="s3">(</span><span class="s1">entry </span><span class="s3">=== </span><span class="s4">null</span><span class="s3">) </span><span class="s4">return null</span><span class="s3">;</span>
	<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">resolved </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">return </span><span class="s1">entry</span><span class="s3">.</span><span class="s1">resolved</span><span class="s3">;</span>
	<span class="s4">return </span><span class="s1">entry</span><span class="s3">.</span><span class="s1">symlinks </span><span class="s3">=== </span><span class="s1">undefined </span><span class="s3">? </span><span class="s1">entry</span><span class="s3">.</span><span class="s1">hash </span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@template </span><span class="s5">T</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Set&lt;T&gt;} source source</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Set&lt;T&gt;} target target</span>
 <span class="s5">*/</span>
<span class="s4">const </span><span class="s1">addAll </span><span class="s3">= (</span><span class="s1">source</span><span class="s3">, </span><span class="s1">target</span><span class="s3">) =&gt; {</span>
	<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">key of source</span><span class="s3">) </span><span class="s1">target</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">key</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s5">/**</span>
 <span class="s5">* Used to access information about the filesystem in a cached way</span>
 <span class="s5">*/</span>
<span class="s4">class </span><span class="s1">FileSystemInfo </span><span class="s3">{</span>
	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{InputFileSystem} fs file system</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Object} options options</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Iterable&lt;string | RegExp&gt;=} options.managedPaths paths that are only managed by a package manager</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Iterable&lt;string | RegExp&gt;=} options.immutablePaths paths that are immutable</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Logger=} options.logger logger used to log invalid snapshots</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string | Hash=} options.hashFunction the hash function to use</span>
	 <span class="s5">*/</span>
	<span class="s1">constructor</span><span class="s3">(</span>
		<span class="s1">fs</span><span class="s3">,</span>
		<span class="s3">{</span>
			<span class="s1">managedPaths </span><span class="s3">= [],</span>
			<span class="s1">immutablePaths </span><span class="s3">= [],</span>
			<span class="s1">logger</span><span class="s3">,</span>
			<span class="s1">hashFunction </span><span class="s3">= </span><span class="s2">&quot;md4&quot;</span>
		<span class="s3">} = {}</span>
	<span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fs </span><span class="s3">= </span><span class="s1">fs</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">logger </span><span class="s3">= </span><span class="s1">logger</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_remainingLogs </span><span class="s3">= </span><span class="s1">logger </span><span class="s3">? </span><span class="s7">40 </span><span class="s3">: </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_loggedPaths </span><span class="s3">= </span><span class="s1">logger </span><span class="s3">? </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">() : </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_hashFunction </span><span class="s3">= </span><span class="s1">hashFunction</span><span class="s3">;</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{WeakMap&lt;Snapshot, boolean | (function(WebpackError=, boolean=): void)[]&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_snapshotCache </span><span class="s3">= </span><span class="s4">new </span><span class="s1">WeakMap</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestampsOptimization </span><span class="s3">= </span><span class="s4">new </span><span class="s1">SnapshotOptimization</span><span class="s3">(</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">hasFileTimestamps</span><span class="s3">(),</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">fileTimestamps</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">v</span><span class="s3">) =&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">setFileTimestamps</span><span class="s3">(</span><span class="s1">v</span><span class="s3">)</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashesOptimization </span><span class="s3">= </span><span class="s4">new </span><span class="s1">SnapshotOptimization</span><span class="s3">(</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">hasFileHashes</span><span class="s3">(),</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">fileHashes</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">v</span><span class="s3">) =&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">setFileHashes</span><span class="s3">(</span><span class="s1">v</span><span class="s3">),</span>
			<span class="s4">false</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTshsOptimization </span><span class="s3">= </span><span class="s4">new </span><span class="s1">SnapshotOptimization</span><span class="s3">(</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">hasFileTshs</span><span class="s3">(),</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">fileTshs</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">v</span><span class="s3">) =&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">setFileTshs</span><span class="s3">(</span><span class="s1">v</span><span class="s3">)</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestampsOptimization </span><span class="s3">= </span><span class="s4">new </span><span class="s1">SnapshotOptimization</span><span class="s3">(</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">hasContextTimestamps</span><span class="s3">(),</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">contextTimestamps</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">v</span><span class="s3">) =&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">setContextTimestamps</span><span class="s3">(</span><span class="s1">v</span><span class="s3">)</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextHashesOptimization </span><span class="s3">= </span><span class="s4">new </span><span class="s1">SnapshotOptimization</span><span class="s3">(</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">hasContextHashes</span><span class="s3">(),</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">contextHashes</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">v</span><span class="s3">) =&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">setContextHashes</span><span class="s3">(</span><span class="s1">v</span><span class="s3">),</span>
			<span class="s4">false</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTshsOptimization </span><span class="s3">= </span><span class="s4">new </span><span class="s1">SnapshotOptimization</span><span class="s3">(</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">hasContextTshs</span><span class="s3">(),</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">contextTshs</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">v</span><span class="s3">) =&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">setContextTshs</span><span class="s3">(</span><span class="s1">v</span><span class="s3">)</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_missingExistenceOptimization </span><span class="s3">= </span><span class="s4">new </span><span class="s1">SnapshotOptimization</span><span class="s3">(</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">hasMissingExistence</span><span class="s3">(),</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">missingExistence</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">v</span><span class="s3">) =&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">setMissingExistence</span><span class="s3">(</span><span class="s1">v</span><span class="s3">),</span>
			<span class="s4">false</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItemInfoOptimization </span><span class="s3">= </span><span class="s4">new </span><span class="s1">SnapshotOptimization</span><span class="s3">(</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">hasManagedItemInfo</span><span class="s3">(),</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">managedItemInfo</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">v</span><span class="s3">) =&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">setManagedItemInfo</span><span class="s3">(</span><span class="s1">v</span><span class="s3">),</span>
			<span class="s4">false</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedFilesOptimization </span><span class="s3">= </span><span class="s4">new </span><span class="s1">SnapshotOptimization</span><span class="s3">(</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">hasManagedFiles</span><span class="s3">(),</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">managedFiles</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">v</span><span class="s3">) =&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">setManagedFiles</span><span class="s3">(</span><span class="s1">v</span><span class="s3">),</span>
			<span class="s4">false</span><span class="s3">,</span>
			<span class="s4">true</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedContextsOptimization </span><span class="s3">= </span><span class="s4">new </span><span class="s1">SnapshotOptimization</span><span class="s3">(</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">hasManagedContexts</span><span class="s3">(),</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">managedContexts</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">v</span><span class="s3">) =&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">setManagedContexts</span><span class="s3">(</span><span class="s1">v</span><span class="s3">),</span>
			<span class="s4">false</span><span class="s3">,</span>
			<span class="s4">true</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedMissingOptimization </span><span class="s3">= </span><span class="s4">new </span><span class="s1">SnapshotOptimization</span><span class="s3">(</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">hasManagedMissing</span><span class="s3">(),</span>
			<span class="s1">s </span><span class="s3">=&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">managedMissing</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">v</span><span class="s3">) =&gt; </span><span class="s1">s</span><span class="s3">.</span><span class="s1">setManagedMissing</span><span class="s3">(</span><span class="s1">v</span><span class="s3">),</span>
			<span class="s4">false</span><span class="s3">,</span>
			<span class="s4">true</span>
		<span class="s3">);</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{StackedCacheMap&lt;string, FileSystemInfoEntry | &quot;ignore&quot; | null&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps </span><span class="s3">= </span><span class="s4">new </span><span class="s1">StackedCacheMap</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, string&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashes </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, TimestampAndHash | string&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTshs </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{StackedCacheMap&lt;string, ContextFileSystemInfoEntry | &quot;ignore&quot; | null&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestamps </span><span class="s3">= </span><span class="s4">new </span><span class="s1">StackedCacheMap</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, ContextHash&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextHashes </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, ContextTimestampAndHash&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTshs </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, string&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItems </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{AsyncQueue&lt;string, string, FileSystemInfoEntry | null&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fileTimestampQueue </span><span class="s3">= </span><span class="s4">new </span><span class="s1">AsyncQueue</span><span class="s3">({</span>
			<span class="s1">name</span><span class="s3">: </span><span class="s2">&quot;file timestamp&quot;</span><span class="s3">,</span>
			<span class="s1">parallelism</span><span class="s3">: </span><span class="s7">30</span><span class="s3">,</span>
			<span class="s1">processor</span><span class="s3">: </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_readFileTimestamp</span><span class="s3">.</span><span class="s1">bind</span><span class="s3">(</span><span class="s4">this</span><span class="s3">)</span>
		<span class="s3">});</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{AsyncQueue&lt;string, string, string | null&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fileHashQueue </span><span class="s3">= </span><span class="s4">new </span><span class="s1">AsyncQueue</span><span class="s3">({</span>
			<span class="s1">name</span><span class="s3">: </span><span class="s2">&quot;file hash&quot;</span><span class="s3">,</span>
			<span class="s1">parallelism</span><span class="s3">: </span><span class="s7">10</span><span class="s3">,</span>
			<span class="s1">processor</span><span class="s3">: </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_readFileHash</span><span class="s3">.</span><span class="s1">bind</span><span class="s3">(</span><span class="s4">this</span><span class="s3">)</span>
		<span class="s3">});</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{AsyncQueue&lt;string, string, ContextFileSystemInfoEntry | null&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTimestampQueue </span><span class="s3">= </span><span class="s4">new </span><span class="s1">AsyncQueue</span><span class="s3">({</span>
			<span class="s1">name</span><span class="s3">: </span><span class="s2">&quot;context timestamp&quot;</span><span class="s3">,</span>
			<span class="s1">parallelism</span><span class="s3">: </span><span class="s7">2</span><span class="s3">,</span>
			<span class="s1">processor</span><span class="s3">: </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_readContextTimestamp</span><span class="s3">.</span><span class="s1">bind</span><span class="s3">(</span><span class="s4">this</span><span class="s3">)</span>
		<span class="s3">});</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{AsyncQueue&lt;string, string, ContextHash | null&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextHashQueue </span><span class="s3">= </span><span class="s4">new </span><span class="s1">AsyncQueue</span><span class="s3">({</span>
			<span class="s1">name</span><span class="s3">: </span><span class="s2">&quot;context hash&quot;</span><span class="s3">,</span>
			<span class="s1">parallelism</span><span class="s3">: </span><span class="s7">2</span><span class="s3">,</span>
			<span class="s1">processor</span><span class="s3">: </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_readContextHash</span><span class="s3">.</span><span class="s1">bind</span><span class="s3">(</span><span class="s4">this</span><span class="s3">)</span>
		<span class="s3">});</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{AsyncQueue&lt;string, string, ContextTimestampAndHash | null&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTshQueue </span><span class="s3">= </span><span class="s4">new </span><span class="s1">AsyncQueue</span><span class="s3">({</span>
			<span class="s1">name</span><span class="s3">: </span><span class="s2">&quot;context hash and timestamp&quot;</span><span class="s3">,</span>
			<span class="s1">parallelism</span><span class="s3">: </span><span class="s7">2</span><span class="s3">,</span>
			<span class="s1">processor</span><span class="s3">: </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_readContextTimestampAndHash</span><span class="s3">.</span><span class="s1">bind</span><span class="s3">(</span><span class="s4">this</span><span class="s3">)</span>
		<span class="s3">});</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{AsyncQueue&lt;string, string, string | null&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedItemQueue </span><span class="s3">= </span><span class="s4">new </span><span class="s1">AsyncQueue</span><span class="s3">({</span>
			<span class="s1">name</span><span class="s3">: </span><span class="s2">&quot;managed item info&quot;</span><span class="s3">,</span>
			<span class="s1">parallelism</span><span class="s3">: </span><span class="s7">10</span><span class="s3">,</span>
			<span class="s1">processor</span><span class="s3">: </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_getManagedItemInfo</span><span class="s3">.</span><span class="s1">bind</span><span class="s3">(</span><span class="s4">this</span><span class="s3">)</span>
		<span class="s3">});</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{AsyncQueue&lt;string, string, Set&lt;string&gt;&gt;} */</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedItemDirectoryQueue </span><span class="s3">= </span><span class="s4">new </span><span class="s1">AsyncQueue</span><span class="s3">({</span>
			<span class="s1">name</span><span class="s3">: </span><span class="s2">&quot;managed item directory info&quot;</span><span class="s3">,</span>
			<span class="s1">parallelism</span><span class="s3">: </span><span class="s7">10</span><span class="s3">,</span>
			<span class="s1">processor</span><span class="s3">: </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_getManagedItemDirectoryInfo</span><span class="s3">.</span><span class="s1">bind</span><span class="s3">(</span><span class="s4">this</span><span class="s3">)</span>
		<span class="s3">});</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedPaths </span><span class="s3">= </span><span class="s1">Array</span><span class="s3">.</span><span class="s1">from</span><span class="s3">(</span><span class="s1">managedPaths</span><span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedPathsWithSlash </span><span class="s3">= </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string[]} */ </span><span class="s3">(</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">managedPaths</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">p </span><span class="s3">=&gt; </span><span class="s4">typeof </span><span class="s1">p </span><span class="s3">=== </span><span class="s2">&quot;string&quot;</span><span class="s3">)</span>
		<span class="s3">).</span><span class="s1">map</span><span class="s3">(</span><span class="s1">p </span><span class="s3">=&gt; </span><span class="s1">join</span><span class="s3">(</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">p</span><span class="s3">, </span><span class="s2">&quot;_&quot;</span><span class="s3">).</span><span class="s1">slice</span><span class="s3">(</span><span class="s7">0</span><span class="s3">, -</span><span class="s7">1</span><span class="s3">));</span>

		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedPathsRegExps </span><span class="s3">= </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{RegExp[]} */ </span><span class="s3">(</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">managedPaths</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">p </span><span class="s3">=&gt; </span><span class="s4">typeof </span><span class="s1">p </span><span class="s3">!== </span><span class="s2">&quot;string&quot;</span><span class="s3">)</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">immutablePaths </span><span class="s3">= </span><span class="s1">Array</span><span class="s3">.</span><span class="s1">from</span><span class="s3">(</span><span class="s1">immutablePaths</span><span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">immutablePathsWithSlash </span><span class="s3">= </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string[]} */ </span><span class="s3">(</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">immutablePaths</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">p </span><span class="s3">=&gt; </span><span class="s4">typeof </span><span class="s1">p </span><span class="s3">=== </span><span class="s2">&quot;string&quot;</span><span class="s3">)</span>
		<span class="s3">).</span><span class="s1">map</span><span class="s3">(</span><span class="s1">p </span><span class="s3">=&gt; </span><span class="s1">join</span><span class="s3">(</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">p</span><span class="s3">, </span><span class="s2">&quot;_&quot;</span><span class="s3">).</span><span class="s1">slice</span><span class="s3">(</span><span class="s7">0</span><span class="s3">, -</span><span class="s7">1</span><span class="s3">));</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">immutablePathsRegExps </span><span class="s3">= </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{RegExp[]} */ </span><span class="s3">(</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">immutablePaths</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">p </span><span class="s3">=&gt; </span><span class="s4">typeof </span><span class="s1">p </span><span class="s3">!== </span><span class="s2">&quot;string&quot;</span><span class="s3">)</span>
		<span class="s3">);</span>

		<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedFileTimestamps </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedContextTimestamps </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>

		<span class="s4">this</span><span class="s3">.</span><span class="s1">_warnAboutExperimentalEsmTracking </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>

		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statCreatedSnapshots </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedSnapshotsCached </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedSnapshotsNotCached </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedChildrenCached </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedChildrenNotCached </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedEntries </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s1">logStatistics</span><span class="s3">() {</span>
		<span class="s4">const </span><span class="s1">logWhenMessage </span><span class="s3">= (</span><span class="s1">header</span><span class="s3">, </span><span class="s1">message</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">message</span><span class="s3">) {</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">log</span><span class="s3">(</span><span class="s2">`</span><span class="s1">$</span><span class="s3">{</span><span class="s1">header</span><span class="s3">}</span><span class="s2">: </span><span class="s1">$</span><span class="s3">{</span><span class="s1">message</span><span class="s3">}</span><span class="s2">`</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">};</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">log</span><span class="s3">(</span><span class="s2">`</span><span class="s1">$</span><span class="s3">{</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statCreatedSnapshots</span><span class="s3">} </span><span class="s2">new snapshots created`</span><span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">log</span><span class="s3">(</span>
			<span class="s2">`</span><span class="s1">$</span><span class="s3">{</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedSnapshotsNotCached </span><span class="s3">&amp;&amp;</span>
				<span class="s1">Math</span><span class="s3">.</span><span class="s1">round</span><span class="s3">(</span>
					<span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedSnapshotsNotCached </span><span class="s3">* </span><span class="s7">100</span><span class="s3">) /</span>
						<span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedSnapshotsCached </span><span class="s3">+</span>
							<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedSnapshotsNotCached</span><span class="s3">)</span>
				<span class="s3">)</span>
			<span class="s3">}</span><span class="s2">% root snapshot uncached (</span><span class="s1">$</span><span class="s3">{</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedSnapshotsNotCached</span><span class="s3">} </span><span class="s2">/ </span><span class="s1">$</span><span class="s3">{</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedSnapshotsCached </span><span class="s3">+ </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedSnapshotsNotCached</span>
			<span class="s3">}</span><span class="s2">)`</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">log</span><span class="s3">(</span>
			<span class="s2">`</span><span class="s1">$</span><span class="s3">{</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedChildrenNotCached </span><span class="s3">&amp;&amp;</span>
				<span class="s1">Math</span><span class="s3">.</span><span class="s1">round</span><span class="s3">(</span>
					<span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedChildrenNotCached </span><span class="s3">* </span><span class="s7">100</span><span class="s3">) /</span>
						<span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedChildrenCached </span><span class="s3">+ </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedChildrenNotCached</span><span class="s3">)</span>
				<span class="s3">)</span>
			<span class="s3">}</span><span class="s2">% children snapshot uncached (</span><span class="s1">$</span><span class="s3">{</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedChildrenNotCached</span><span class="s3">} </span><span class="s2">/ </span><span class="s1">$</span><span class="s3">{</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedChildrenCached </span><span class="s3">+ </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedChildrenNotCached</span>
			<span class="s3">}</span><span class="s2">)`</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">log</span><span class="s3">(</span><span class="s2">`</span><span class="s1">$</span><span class="s3">{</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedEntries</span><span class="s3">} </span><span class="s2">entries tested`</span><span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">log</span><span class="s3">(</span>
			<span class="s2">`File info in cache: </span><span class="s1">$</span><span class="s3">{</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">size</span><span class="s3">} </span><span class="s2">timestamps </span><span class="s1">$</span><span class="s3">{</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashes</span><span class="s3">.</span><span class="s1">size</span><span class="s3">} </span><span class="s2">hashes </span><span class="s1">$</span><span class="s3">{</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTshs</span><span class="s3">.</span><span class="s1">size</span><span class="s3">} </span><span class="s2">timestamp hash combinations`</span>
		<span class="s3">);</span>
		<span class="s1">logWhenMessage</span><span class="s3">(</span>
			<span class="s2">`File timestamp snapshot optimization`</span><span class="s3">,</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestampsOptimization</span><span class="s3">.</span><span class="s1">getStatisticMessage</span><span class="s3">()</span>
		<span class="s3">);</span>
		<span class="s1">logWhenMessage</span><span class="s3">(</span>
			<span class="s2">`File hash snapshot optimization`</span><span class="s3">,</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashesOptimization</span><span class="s3">.</span><span class="s1">getStatisticMessage</span><span class="s3">()</span>
		<span class="s3">);</span>
		<span class="s1">logWhenMessage</span><span class="s3">(</span>
			<span class="s2">`File timestamp hash combination snapshot optimization`</span><span class="s3">,</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTshsOptimization</span><span class="s3">.</span><span class="s1">getStatisticMessage</span><span class="s3">()</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">log</span><span class="s3">(</span>
			<span class="s2">`Directory info in cache: </span><span class="s1">$</span><span class="s3">{</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestamps</span><span class="s3">.</span><span class="s1">size</span><span class="s3">} </span><span class="s2">timestamps </span><span class="s1">$</span><span class="s3">{</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextHashes</span><span class="s3">.</span><span class="s1">size</span><span class="s3">} </span><span class="s2">hashes </span><span class="s1">$</span><span class="s3">{</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTshs</span><span class="s3">.</span><span class="s1">size</span><span class="s3">} </span><span class="s2">timestamp hash combinations`</span>
		<span class="s3">);</span>
		<span class="s1">logWhenMessage</span><span class="s3">(</span>
			<span class="s2">`Directory timestamp snapshot optimization`</span><span class="s3">,</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestampsOptimization</span><span class="s3">.</span><span class="s1">getStatisticMessage</span><span class="s3">()</span>
		<span class="s3">);</span>
		<span class="s1">logWhenMessage</span><span class="s3">(</span>
			<span class="s2">`Directory hash snapshot optimization`</span><span class="s3">,</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextHashesOptimization</span><span class="s3">.</span><span class="s1">getStatisticMessage</span><span class="s3">()</span>
		<span class="s3">);</span>
		<span class="s1">logWhenMessage</span><span class="s3">(</span>
			<span class="s2">`Directory timestamp hash combination snapshot optimization`</span><span class="s3">,</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTshsOptimization</span><span class="s3">.</span><span class="s1">getStatisticMessage</span><span class="s3">()</span>
		<span class="s3">);</span>
		<span class="s1">logWhenMessage</span><span class="s3">(</span>
			<span class="s2">`Missing items snapshot optimization`</span><span class="s3">,</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_missingExistenceOptimization</span><span class="s3">.</span><span class="s1">getStatisticMessage</span><span class="s3">()</span>
		<span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">log</span><span class="s3">(</span>
			<span class="s2">`Managed items info in cache: </span><span class="s1">$</span><span class="s3">{</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItems</span><span class="s3">.</span><span class="s1">size</span><span class="s3">} </span><span class="s2">items`</span>
		<span class="s3">);</span>
		<span class="s1">logWhenMessage</span><span class="s3">(</span>
			<span class="s2">`Managed items snapshot optimization`</span><span class="s3">,</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItemInfoOptimization</span><span class="s3">.</span><span class="s1">getStatisticMessage</span><span class="s3">()</span>
		<span class="s3">);</span>
		<span class="s1">logWhenMessage</span><span class="s3">(</span>
			<span class="s2">`Managed files snapshot optimization`</span><span class="s3">,</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedFilesOptimization</span><span class="s3">.</span><span class="s1">getStatisticMessage</span><span class="s3">()</span>
		<span class="s3">);</span>
		<span class="s1">logWhenMessage</span><span class="s3">(</span>
			<span class="s2">`Managed contexts snapshot optimization`</span><span class="s3">,</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedContextsOptimization</span><span class="s3">.</span><span class="s1">getStatisticMessage</span><span class="s3">()</span>
		<span class="s3">);</span>
		<span class="s1">logWhenMessage</span><span class="s3">(</span>
			<span class="s2">`Managed missing snapshot optimization`</span><span class="s3">,</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedMissingOptimization</span><span class="s3">.</span><span class="s1">getStatisticMessage</span><span class="s3">()</span>
		<span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path path</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} reason reason</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{any[]} args arguments</span>
	 <span class="s5">*/</span>
	<span class="s1">_log</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">, </span><span class="s1">...args</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">key </span><span class="s3">= </span><span class="s1">path </span><span class="s3">+ </span><span class="s1">reason</span><span class="s3">;</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_loggedPaths</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)) </span><span class="s4">return</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_loggedPaths</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">key</span><span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span><span class="s2">`</span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">} </span><span class="s2">invalidated because </span><span class="s1">$</span><span class="s3">{</span><span class="s1">reason</span><span class="s3">}</span><span class="s2">`</span><span class="s3">, </span><span class="s1">...args</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(--</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_remainingLogs </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) {</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span>
				<span class="s2">&quot;Logging limit has been reached and no further logging will be emitted by FileSystemInfo&quot;</span>
			<span class="s3">);</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s1">clear</span><span class="s3">() {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_remainingLogs </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">logger </span><span class="s3">? </span><span class="s7">40 </span><span class="s3">: </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_loggedPaths </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_loggedPaths</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>

		<span class="s4">this</span><span class="s3">.</span><span class="s1">_snapshotCache </span><span class="s3">= </span><span class="s4">new </span><span class="s1">WeakMap</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestampsOptimization</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashesOptimization</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTshsOptimization</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestampsOptimization</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextHashesOptimization</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTshsOptimization</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_missingExistenceOptimization</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItemInfoOptimization</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedFilesOptimization</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedContextsOptimization</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedMissingOptimization</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashes</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTshs</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestamps</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextHashes</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTshs</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItems</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItems</span><span class="s3">.</span><span class="s1">clear</span><span class="s3">();</span>

		<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedFileTimestamps </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedContextTimestamps </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>

		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statCreatedSnapshots </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedSnapshotsCached </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedSnapshotsNotCached </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedChildrenCached </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedChildrenNotCached </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedEntries </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ReadonlyMap&lt;string, FileSystemInfoEntry | &quot;ignore&quot; | null&gt;} map timestamps</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{boolean=} immutable if 'map' is immutable and FileSystemInfo can keep referencing it</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">addFileTimestamps</span><span class="s3">(</span><span class="s1">map</span><span class="s3">, </span><span class="s1">immutable</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">addAll</span><span class="s3">(</span><span class="s1">map</span><span class="s3">, </span><span class="s1">immutable</span><span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedFileTimestamps </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ReadonlyMap&lt;string, FileSystemInfoEntry | &quot;ignore&quot; | null&gt;} map timestamps</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{boolean=} immutable if 'map' is immutable and FileSystemInfo can keep referencing it</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">addContextTimestamps</span><span class="s3">(</span><span class="s1">map</span><span class="s3">, </span><span class="s1">immutable</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestamps</span><span class="s3">.</span><span class="s1">addAll</span><span class="s3">(</span><span class="s1">map</span><span class="s3">, </span><span class="s1">immutable</span><span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedContextTimestamps </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path file path</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((WebpackError | null)=, (FileSystemInfoEntry | &quot;ignore&quot; | null)=): void} callback callback function</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">getFileTimestamp</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">cache</span><span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fileTimestampQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path context path</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((WebpackError | null)=, (ResolvedContextFileSystemInfoEntry | &quot;ignore&quot; | null)=): void} callback callback function</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">getContextTimestamp</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">=== </span><span class="s2">&quot;ignore&quot;</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s2">&quot;ignore&quot;</span><span class="s3">);</span>
			<span class="s4">const </span><span class="s1">resolved </span><span class="s3">= </span><span class="s1">getResolvedTimestamp</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">);</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">resolved </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">resolved</span><span class="s3">);</span>
			<span class="s4">return this</span><span class="s3">.</span><span class="s1">_resolveContextTimestamp</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTimestampQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
			<span class="s4">const </span><span class="s1">resolved </span><span class="s3">= </span><span class="s1">getResolvedTimestamp</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">);</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">resolved </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">resolved</span><span class="s3">);</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_resolveContextTimestamp</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
		<span class="s3">});</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path context path</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((WebpackError | null)=, (ContextFileSystemInfoEntry | &quot;ignore&quot; | null)=): void} callback callback function</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">_getUnresolvedContextTimestamp</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">cache</span><span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTimestampQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path file path</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((WebpackError | null)=, (string | null)=): void} callback callback function</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">getFileHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashes</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">cache</span><span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fileHashQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path context path</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((WebpackError | null)=, string=): void} callback callback function</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">getContextHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextHashes</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
			<span class="s4">const </span><span class="s1">resolved </span><span class="s3">= </span><span class="s1">getResolvedHash</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">);</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">resolved </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">resolved</span><span class="s3">);</span>
			<span class="s4">return this</span><span class="s3">.</span><span class="s1">_resolveContextHash</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextHashQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
			<span class="s4">const </span><span class="s1">resolved </span><span class="s3">= </span><span class="s1">getResolvedHash</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">);</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">resolved </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">resolved</span><span class="s3">);</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_resolveContextHash</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
		<span class="s3">});</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path context path</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((WebpackError | null)=, (ContextHash | null)=): void} callback callback function</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">_getUnresolvedContextHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextHashes</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">cache</span><span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextHashQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path context path</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((WebpackError | null)=, ResolvedContextTimestampAndHash=): void} callback callback function</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">getContextTsh</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTshs</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
			<span class="s4">const </span><span class="s1">resolved </span><span class="s3">= </span><span class="s1">getResolvedTimestamp</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">);</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">resolved </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">resolved</span><span class="s3">);</span>
			<span class="s4">return this</span><span class="s3">.</span><span class="s1">_resolveContextTsh</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTshQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
			<span class="s4">const </span><span class="s1">resolved </span><span class="s3">= </span><span class="s1">getResolvedTimestamp</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">);</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">resolved </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">resolved</span><span class="s3">);</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_resolveContextTsh</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
		<span class="s3">});</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path context path</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((WebpackError | null)=, (ContextTimestampAndHash | null)=): void} callback callback function</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">_getUnresolvedContextTsh</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTshs</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">cache</span><span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTshQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s1">_createBuildDependenciesResolvers</span><span class="s3">() {</span>
		<span class="s4">const </span><span class="s1">resolveContext </span><span class="s3">= </span><span class="s1">createResolver</span><span class="s3">({</span>
			<span class="s1">resolveToContext</span><span class="s3">: </span><span class="s4">true</span><span class="s3">,</span>
			<span class="s1">exportsFields</span><span class="s3">: [],</span>
			<span class="s1">fileSystem</span><span class="s3">: </span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span>
		<span class="s3">});</span>
		<span class="s4">const </span><span class="s1">resolveCjs </span><span class="s3">= </span><span class="s1">createResolver</span><span class="s3">({</span>
			<span class="s1">extensions</span><span class="s3">: [</span><span class="s2">&quot;.js&quot;</span><span class="s3">, </span><span class="s2">&quot;.json&quot;</span><span class="s3">, </span><span class="s2">&quot;.node&quot;</span><span class="s3">],</span>
			<span class="s1">conditionNames</span><span class="s3">: [</span><span class="s2">&quot;require&quot;</span><span class="s3">, </span><span class="s2">&quot;node&quot;</span><span class="s3">],</span>
			<span class="s1">exportsFields</span><span class="s3">: [</span><span class="s2">&quot;exports&quot;</span><span class="s3">],</span>
			<span class="s1">fileSystem</span><span class="s3">: </span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span>
		<span class="s3">});</span>
		<span class="s4">const </span><span class="s1">resolveCjsAsChild </span><span class="s3">= </span><span class="s1">createResolver</span><span class="s3">({</span>
			<span class="s1">extensions</span><span class="s3">: [</span><span class="s2">&quot;.js&quot;</span><span class="s3">, </span><span class="s2">&quot;.json&quot;</span><span class="s3">, </span><span class="s2">&quot;.node&quot;</span><span class="s3">],</span>
			<span class="s1">conditionNames</span><span class="s3">: [</span><span class="s2">&quot;require&quot;</span><span class="s3">, </span><span class="s2">&quot;node&quot;</span><span class="s3">],</span>
			<span class="s1">exportsFields</span><span class="s3">: [],</span>
			<span class="s1">fileSystem</span><span class="s3">: </span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span>
		<span class="s3">});</span>
		<span class="s4">const </span><span class="s1">resolveEsm </span><span class="s3">= </span><span class="s1">createResolver</span><span class="s3">({</span>
			<span class="s1">extensions</span><span class="s3">: [</span><span class="s2">&quot;.js&quot;</span><span class="s3">, </span><span class="s2">&quot;.json&quot;</span><span class="s3">, </span><span class="s2">&quot;.node&quot;</span><span class="s3">],</span>
			<span class="s1">fullySpecified</span><span class="s3">: </span><span class="s4">true</span><span class="s3">,</span>
			<span class="s1">conditionNames</span><span class="s3">: [</span><span class="s2">&quot;import&quot;</span><span class="s3">, </span><span class="s2">&quot;node&quot;</span><span class="s3">],</span>
			<span class="s1">exportsFields</span><span class="s3">: [</span><span class="s2">&quot;exports&quot;</span><span class="s3">],</span>
			<span class="s1">fileSystem</span><span class="s3">: </span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span>
		<span class="s3">});</span>
		<span class="s4">return </span><span class="s3">{ </span><span class="s1">resolveContext</span><span class="s3">, </span><span class="s1">resolveEsm</span><span class="s3">, </span><span class="s1">resolveCjs</span><span class="s3">, </span><span class="s1">resolveCjsAsChild </span><span class="s3">};</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} context context directory</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Iterable&lt;string&gt;} deps dependencies</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((Error | null)=, ResolveBuildDependenciesResult=): void} callback callback function</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">resolveBuildDependencies</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">deps</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s3">{ </span><span class="s1">resolveContext</span><span class="s3">, </span><span class="s1">resolveEsm</span><span class="s3">, </span><span class="s1">resolveCjs</span><span class="s3">, </span><span class="s1">resolveCjsAsChild </span><span class="s3">} =</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_createBuildDependenciesResolvers</span><span class="s3">();</span>

		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */</span>
		<span class="s4">const </span><span class="s1">files </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */</span>
		<span class="s4">const </span><span class="s1">fileSymlinks </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */</span>
		<span class="s4">const </span><span class="s1">directories </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */</span>
		<span class="s4">const </span><span class="s1">directorySymlinks </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */</span>
		<span class="s4">const </span><span class="s1">missing </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */</span>
		<span class="s4">const </span><span class="s1">resolveFiles </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */</span>
		<span class="s4">const </span><span class="s1">resolveDirectories </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */</span>
		<span class="s4">const </span><span class="s1">resolveMissing </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, string | false | undefined&gt;} */</span>
		<span class="s4">const </span><span class="s1">resolveResults </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s4">const </span><span class="s1">invalidResolveResults </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
		<span class="s4">const </span><span class="s1">resolverContext </span><span class="s3">= {</span>
			<span class="s1">fileDependencies</span><span class="s3">: </span><span class="s1">resolveFiles</span><span class="s3">,</span>
			<span class="s1">contextDependencies</span><span class="s3">: </span><span class="s1">resolveDirectories</span><span class="s3">,</span>
			<span class="s1">missingDependencies</span><span class="s3">: </span><span class="s1">resolveMissing</span>
		<span class="s3">};</span>
		<span class="s5">/**</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} expected expected result</span>
		 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{string} expected result</span>
		 <span class="s5">*/</span>
		<span class="s4">const </span><span class="s1">expectedToString </span><span class="s3">= </span><span class="s1">expected </span><span class="s3">=&gt; {</span>
			<span class="s4">return </span><span class="s1">expected </span><span class="s3">? </span><span class="s2">` (expected </span><span class="s1">$</span><span class="s3">{</span><span class="s1">expected</span><span class="s3">}</span><span class="s2">)` </span><span class="s3">: </span><span class="s2">&quot;&quot;</span><span class="s3">;</span>
		<span class="s3">};</span>
		<span class="s4">const </span><span class="s1">jobToString </span><span class="s3">= </span><span class="s1">job </span><span class="s3">=&gt; {</span>
			<span class="s4">switch </span><span class="s3">(</span><span class="s1">job</span><span class="s3">.</span><span class="s1">type</span><span class="s3">) {</span>
				<span class="s4">case </span><span class="s1">RBDT_RESOLVE_CJS</span><span class="s3">:</span>
					<span class="s4">return </span><span class="s2">`resolve commonjs </span><span class="s1">$</span><span class="s3">{</span><span class="s1">job</span><span class="s3">.</span><span class="s1">path</span><span class="s3">}</span><span class="s1">$</span><span class="s3">{</span><span class="s1">expectedToString</span><span class="s3">(</span>
						<span class="s1">job</span><span class="s3">.</span><span class="s1">expected</span>
					<span class="s3">)}</span><span class="s2">`</span><span class="s3">;</span>
				<span class="s4">case </span><span class="s1">RBDT_RESOLVE_ESM</span><span class="s3">:</span>
					<span class="s4">return </span><span class="s2">`resolve esm </span><span class="s1">$</span><span class="s3">{</span><span class="s1">job</span><span class="s3">.</span><span class="s1">path</span><span class="s3">}</span><span class="s1">$</span><span class="s3">{</span><span class="s1">expectedToString</span><span class="s3">(</span><span class="s1">job</span><span class="s3">.</span><span class="s1">expected</span><span class="s3">)}</span><span class="s2">`</span><span class="s3">;</span>
				<span class="s4">case </span><span class="s1">RBDT_RESOLVE_DIRECTORY</span><span class="s3">:</span>
					<span class="s4">return </span><span class="s2">`resolve directory </span><span class="s1">$</span><span class="s3">{</span><span class="s1">job</span><span class="s3">.</span><span class="s1">path</span><span class="s3">}</span><span class="s2">`</span><span class="s3">;</span>
				<span class="s4">case </span><span class="s1">RBDT_RESOLVE_CJS_FILE</span><span class="s3">:</span>
					<span class="s4">return </span><span class="s2">`resolve commonjs file </span><span class="s1">$</span><span class="s3">{</span><span class="s1">job</span><span class="s3">.</span><span class="s1">path</span><span class="s3">}</span><span class="s1">$</span><span class="s3">{</span><span class="s1">expectedToString</span><span class="s3">(</span>
						<span class="s1">job</span><span class="s3">.</span><span class="s1">expected</span>
					<span class="s3">)}</span><span class="s2">`</span><span class="s3">;</span>
				<span class="s4">case </span><span class="s1">RBDT_RESOLVE_ESM_FILE</span><span class="s3">:</span>
					<span class="s4">return </span><span class="s2">`resolve esm file </span><span class="s1">$</span><span class="s3">{</span><span class="s1">job</span><span class="s3">.</span><span class="s1">path</span><span class="s3">}</span><span class="s1">$</span><span class="s3">{</span><span class="s1">expectedToString</span><span class="s3">(</span>
						<span class="s1">job</span><span class="s3">.</span><span class="s1">expected</span>
					<span class="s3">)}</span><span class="s2">`</span><span class="s3">;</span>
				<span class="s4">case </span><span class="s1">RBDT_DIRECTORY</span><span class="s3">:</span>
					<span class="s4">return </span><span class="s2">`directory </span><span class="s1">$</span><span class="s3">{</span><span class="s1">job</span><span class="s3">.</span><span class="s1">path</span><span class="s3">}</span><span class="s2">`</span><span class="s3">;</span>
				<span class="s4">case </span><span class="s1">RBDT_FILE</span><span class="s3">:</span>
					<span class="s4">return </span><span class="s2">`file </span><span class="s1">$</span><span class="s3">{</span><span class="s1">job</span><span class="s3">.</span><span class="s1">path</span><span class="s3">}</span><span class="s2">`</span><span class="s3">;</span>
				<span class="s4">case </span><span class="s1">RBDT_DIRECTORY_DEPENDENCIES</span><span class="s3">:</span>
					<span class="s4">return </span><span class="s2">`directory dependencies </span><span class="s1">$</span><span class="s3">{</span><span class="s1">job</span><span class="s3">.</span><span class="s1">path</span><span class="s3">}</span><span class="s2">`</span><span class="s3">;</span>
				<span class="s4">case </span><span class="s1">RBDT_FILE_DEPENDENCIES</span><span class="s3">:</span>
					<span class="s4">return </span><span class="s2">`file dependencies </span><span class="s1">$</span><span class="s3">{</span><span class="s1">job</span><span class="s3">.</span><span class="s1">path</span><span class="s3">}</span><span class="s2">`</span><span class="s3">;</span>
			<span class="s3">}</span>
			<span class="s4">return </span><span class="s2">`unknown </span><span class="s1">$</span><span class="s3">{</span><span class="s1">job</span><span class="s3">.</span><span class="s1">type</span><span class="s3">} </span><span class="s1">$</span><span class="s3">{</span><span class="s1">job</span><span class="s3">.</span><span class="s1">path</span><span class="s3">}</span><span class="s2">`</span><span class="s3">;</span>
		<span class="s3">};</span>
		<span class="s4">const </span><span class="s1">pathToString </span><span class="s3">= </span><span class="s1">job </span><span class="s3">=&gt; {</span>
			<span class="s4">let </span><span class="s1">result </span><span class="s3">= </span><span class="s2">` at </span><span class="s1">$</span><span class="s3">{</span><span class="s1">jobToString</span><span class="s3">(</span><span class="s1">job</span><span class="s3">)}</span><span class="s2">`</span><span class="s3">;</span>
			<span class="s1">job </span><span class="s3">= </span><span class="s1">job</span><span class="s3">.</span><span class="s1">issuer</span><span class="s3">;</span>
			<span class="s4">while </span><span class="s3">(</span><span class="s1">job </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s1">result </span><span class="s3">+= </span><span class="s2">`</span><span class="s4">\n </span><span class="s2">at </span><span class="s1">$</span><span class="s3">{</span><span class="s1">jobToString</span><span class="s3">(</span><span class="s1">job</span><span class="s3">)}</span><span class="s2">`</span><span class="s3">;</span>
				<span class="s1">job </span><span class="s3">= </span><span class="s1">job</span><span class="s3">.</span><span class="s1">issuer</span><span class="s3">;</span>
			<span class="s3">}</span>
			<span class="s4">return </span><span class="s1">result</span><span class="s3">;</span>
		<span class="s3">};</span>
		<span class="s1">processAsyncTree</span><span class="s3">(</span>
			<span class="s1">Array</span><span class="s3">.</span><span class="s1">from</span><span class="s3">(</span><span class="s1">deps</span><span class="s3">, </span><span class="s1">dep </span><span class="s3">=&gt; ({</span>
				<span class="s1">type</span><span class="s3">: </span><span class="s1">RBDT_RESOLVE_CJS</span><span class="s3">,</span>
				<span class="s1">context</span><span class="s3">,</span>
				<span class="s1">path</span><span class="s3">: </span><span class="s1">dep</span><span class="s3">,</span>
				<span class="s1">expected</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
				<span class="s1">issuer</span><span class="s3">: </span><span class="s1">undefined</span>
			<span class="s3">})),</span>
			<span class="s7">20</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">job</span><span class="s3">, </span><span class="s1">push</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
				<span class="s4">const </span><span class="s3">{ </span><span class="s1">type</span><span class="s3">, </span><span class="s1">context</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, </span><span class="s1">expected </span><span class="s3">} = </span><span class="s1">job</span><span class="s3">;</span>
				<span class="s4">const </span><span class="s1">resolveDirectory </span><span class="s3">= </span><span class="s1">path </span><span class="s3">=&gt; {</span>
					<span class="s4">const </span><span class="s1">key </span><span class="s3">= </span><span class="s2">`d</span><span class="s4">\n</span><span class="s1">$</span><span class="s3">{</span><span class="s1">context</span><span class="s3">}</span><span class="s4">\n</span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">}</span><span class="s2">`</span><span class="s3">;</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">resolveResults</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)) {</span>
						<span class="s4">return </span><span class="s1">callback</span><span class="s3">();</span>
					<span class="s3">}</span>
					<span class="s1">resolveResults</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">key</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">);</span>
					<span class="s1">resolveContext</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, </span><span class="s1">resolverContext</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">_</span><span class="s3">, </span><span class="s1">result</span><span class="s3">) =&gt; {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">expected </span><span class="s3">=== </span><span class="s4">false</span><span class="s3">) {</span>
								<span class="s1">resolveResults</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">key</span><span class="s3">, </span><span class="s4">false</span><span class="s3">);</span>
								<span class="s4">return </span><span class="s1">callback</span><span class="s3">();</span>
							<span class="s3">}</span>
							<span class="s1">invalidResolveResults</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">key</span><span class="s3">);</span>
							<span class="s1">err</span><span class="s3">.</span><span class="s1">message </span><span class="s3">+= </span><span class="s2">`</span><span class="s4">\n</span><span class="s2">while resolving '</span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">}</span><span class="s2">' in </span><span class="s1">$</span><span class="s3">{</span><span class="s1">context</span><span class="s3">} </span><span class="s2">to a directory`</span><span class="s3">;</span>
							<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
						<span class="s3">}</span>
						<span class="s4">const </span><span class="s1">resultPath </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">path</span><span class="s3">;</span>
						<span class="s1">resolveResults</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">key</span><span class="s3">, </span><span class="s1">resultPath</span><span class="s3">);</span>
						<span class="s1">push</span><span class="s3">({</span>
							<span class="s1">type</span><span class="s3">: </span><span class="s1">RBDT_DIRECTORY</span><span class="s3">,</span>
							<span class="s1">context</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
							<span class="s1">path</span><span class="s3">: </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string} */ </span><span class="s3">(</span><span class="s1">resultPath</span><span class="s3">),</span>
							<span class="s1">expected</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
							<span class="s1">issuer</span><span class="s3">: </span><span class="s1">job</span>
						<span class="s3">});</span>
						<span class="s1">callback</span><span class="s3">();</span>
					<span class="s3">});</span>
				<span class="s3">};</span>
				<span class="s4">const </span><span class="s1">resolveFile </span><span class="s3">= (</span><span class="s1">path</span><span class="s3">, </span><span class="s1">symbol</span><span class="s3">, </span><span class="s1">resolve</span><span class="s3">) =&gt; {</span>
					<span class="s4">const </span><span class="s1">key </span><span class="s3">= </span><span class="s2">`</span><span class="s1">$</span><span class="s3">{</span><span class="s1">symbol</span><span class="s3">}</span><span class="s4">\n</span><span class="s1">$</span><span class="s3">{</span><span class="s1">context</span><span class="s3">}</span><span class="s4">\n</span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">}</span><span class="s2">`</span><span class="s3">;</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">resolveResults</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)) {</span>
						<span class="s4">return </span><span class="s1">callback</span><span class="s3">();</span>
					<span class="s3">}</span>
					<span class="s1">resolveResults</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">key</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">);</span>
					<span class="s1">resolve</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, </span><span class="s1">resolverContext</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">_</span><span class="s3">, </span><span class="s1">result</span><span class="s3">) =&gt; {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">expected </span><span class="s3">=== </span><span class="s2">&quot;string&quot;</span><span class="s3">) {</span>
							<span class="s4">if </span><span class="s3">(!</span><span class="s1">err </span><span class="s3">&amp;&amp; </span><span class="s1">result </span><span class="s3">&amp;&amp; </span><span class="s1">result</span><span class="s3">.</span><span class="s1">path </span><span class="s3">=== </span><span class="s1">expected</span><span class="s3">) {</span>
								<span class="s1">resolveResults</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">key</span><span class="s3">, </span><span class="s1">result</span><span class="s3">.</span><span class="s1">path</span><span class="s3">);</span>
							<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
								<span class="s1">invalidResolveResults</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">key</span><span class="s3">);</span>
								<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span>
									<span class="s2">`Resolving '</span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">}</span><span class="s2">' in </span><span class="s1">$</span><span class="s3">{</span><span class="s1">context</span><span class="s3">} </span><span class="s2">for build dependencies doesn't lead to expected result '</span><span class="s1">$</span><span class="s3">{</span><span class="s1">expected</span><span class="s3">}</span><span class="s2">', but to '</span><span class="s1">$</span><span class="s3">{</span>
										<span class="s1">err </span><span class="s3">|| (</span><span class="s1">result </span><span class="s3">&amp;&amp; </span><span class="s1">result</span><span class="s3">.</span><span class="s1">path</span><span class="s3">)</span>
									<span class="s3">}</span><span class="s2">' instead. Resolving dependencies are ignored for this path.</span><span class="s4">\n</span><span class="s1">$</span><span class="s3">{</span><span class="s1">pathToString</span><span class="s3">(</span>
										<span class="s1">job</span>
									<span class="s3">)}</span><span class="s2">`</span>
								<span class="s3">);</span>
							<span class="s3">}</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">expected </span><span class="s3">=== </span><span class="s4">false</span><span class="s3">) {</span>
									<span class="s1">resolveResults</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">key</span><span class="s3">, </span><span class="s4">false</span><span class="s3">);</span>
									<span class="s4">return </span><span class="s1">callback</span><span class="s3">();</span>
								<span class="s3">}</span>
								<span class="s1">invalidResolveResults</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">key</span><span class="s3">);</span>
								<span class="s1">err</span><span class="s3">.</span><span class="s1">message </span><span class="s3">+= </span><span class="s2">`</span><span class="s4">\n</span><span class="s2">while resolving '</span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">}</span><span class="s2">' in </span><span class="s1">$</span><span class="s3">{</span><span class="s1">context</span><span class="s3">} </span><span class="s2">as file</span><span class="s4">\n</span><span class="s1">$</span><span class="s3">{</span><span class="s1">pathToString</span><span class="s3">(</span>
									<span class="s1">job</span>
								<span class="s3">)}</span><span class="s2">`</span><span class="s3">;</span>
								<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
							<span class="s3">}</span>
							<span class="s4">const </span><span class="s1">resultPath </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">path</span><span class="s3">;</span>
							<span class="s1">resolveResults</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">key</span><span class="s3">, </span><span class="s1">resultPath</span><span class="s3">);</span>
							<span class="s1">push</span><span class="s3">({</span>
								<span class="s1">type</span><span class="s3">: </span><span class="s1">RBDT_FILE</span><span class="s3">,</span>
								<span class="s1">context</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
								<span class="s1">path</span><span class="s3">: </span><span class="s1">resultPath</span><span class="s3">,</span>
								<span class="s1">expected</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
								<span class="s1">issuer</span><span class="s3">: </span><span class="s1">job</span>
							<span class="s3">});</span>
						<span class="s3">}</span>
						<span class="s1">callback</span><span class="s3">();</span>
					<span class="s3">});</span>
				<span class="s3">};</span>
				<span class="s4">switch </span><span class="s3">(</span><span class="s1">type</span><span class="s3">) {</span>
					<span class="s4">case </span><span class="s1">RBDT_RESOLVE_CJS</span><span class="s3">: {</span>
						<span class="s4">const </span><span class="s1">isDirectory </span><span class="s3">= </span><span class="s8">/[\\/]$/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">isDirectory</span><span class="s3">) {</span>
							<span class="s1">resolveDirectory</span><span class="s3">(</span><span class="s1">path</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s7">0</span><span class="s3">, </span><span class="s1">path</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s7">1</span><span class="s3">));</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">resolveFile</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;f&quot;</span><span class="s3">, </span><span class="s1">resolveCjs</span><span class="s3">);</span>
						<span class="s3">}</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s3">}</span>
					<span class="s4">case </span><span class="s1">RBDT_RESOLVE_ESM</span><span class="s3">: {</span>
						<span class="s4">const </span><span class="s1">isDirectory </span><span class="s3">= </span><span class="s8">/[\\/]$/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">isDirectory</span><span class="s3">) {</span>
							<span class="s1">resolveDirectory</span><span class="s3">(</span><span class="s1">path</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s7">0</span><span class="s3">, </span><span class="s1">path</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s7">1</span><span class="s3">));</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">resolveFile</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s3">}</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s3">}</span>
					<span class="s4">case </span><span class="s1">RBDT_RESOLVE_DIRECTORY</span><span class="s3">: {</span>
						<span class="s1">resolveDirectory</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s3">}</span>
					<span class="s4">case </span><span class="s1">RBDT_RESOLVE_CJS_FILE</span><span class="s3">: {</span>
						<span class="s1">resolveFile</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;f&quot;</span><span class="s3">, </span><span class="s1">resolveCjs</span><span class="s3">);</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s3">}</span>
					<span class="s4">case </span><span class="s1">RBDT_RESOLVE_CJS_FILE_AS_CHILD</span><span class="s3">: {</span>
						<span class="s1">resolveFile</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;c&quot;</span><span class="s3">, </span><span class="s1">resolveCjsAsChild</span><span class="s3">);</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s3">}</span>
					<span class="s4">case </span><span class="s1">RBDT_RESOLVE_ESM_FILE</span><span class="s3">: {</span>
						<span class="s1">resolveFile</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;e&quot;</span><span class="s3">, </span><span class="s1">resolveEsm</span><span class="s3">);</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s3">}</span>
					<span class="s4">case </span><span class="s1">RBDT_FILE</span><span class="s3">: {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">files</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) {</span>
							<span class="s1">callback</span><span class="s3">();</span>
							<span class="s4">break</span><span class="s3">;</span>
						<span class="s3">}</span>
						<span class="s1">files</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">.</span><span class="s1">realpath</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">_realPath</span><span class="s3">) =&gt; {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
							<span class="s4">const </span><span class="s1">realPath </span><span class="s3">= </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string} */ </span><span class="s3">(</span><span class="s1">_realPath</span><span class="s3">);</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">realPath </span><span class="s3">!== </span><span class="s1">path</span><span class="s3">) {</span>
								<span class="s1">fileSymlinks</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
								<span class="s1">resolveFiles</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">files</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">realPath</span><span class="s3">)) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">();</span>
								<span class="s1">files</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">realPath</span><span class="s3">);</span>
							<span class="s3">}</span>
							<span class="s1">push</span><span class="s3">({</span>
								<span class="s1">type</span><span class="s3">: </span><span class="s1">RBDT_FILE_DEPENDENCIES</span><span class="s3">,</span>
								<span class="s1">context</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
								<span class="s1">path</span><span class="s3">: </span><span class="s1">realPath</span><span class="s3">,</span>
								<span class="s1">expected</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
								<span class="s1">issuer</span><span class="s3">: </span><span class="s1">job</span>
							<span class="s3">});</span>
							<span class="s1">callback</span><span class="s3">();</span>
						<span class="s3">});</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s3">}</span>
					<span class="s4">case </span><span class="s1">RBDT_DIRECTORY</span><span class="s3">: {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">directories</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) {</span>
							<span class="s1">callback</span><span class="s3">();</span>
							<span class="s4">break</span><span class="s3">;</span>
						<span class="s3">}</span>
						<span class="s1">directories</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">.</span><span class="s1">realpath</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">_realPath</span><span class="s3">) =&gt; {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
							<span class="s4">const </span><span class="s1">realPath </span><span class="s3">= </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string} */ </span><span class="s3">(</span><span class="s1">_realPath</span><span class="s3">);</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">realPath </span><span class="s3">!== </span><span class="s1">path</span><span class="s3">) {</span>
								<span class="s1">directorySymlinks</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
								<span class="s1">resolveFiles</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">directories</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">realPath</span><span class="s3">)) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">();</span>
								<span class="s1">directories</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">realPath</span><span class="s3">);</span>
							<span class="s3">}</span>
							<span class="s1">push</span><span class="s3">({</span>
								<span class="s1">type</span><span class="s3">: </span><span class="s1">RBDT_DIRECTORY_DEPENDENCIES</span><span class="s3">,</span>
								<span class="s1">context</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
								<span class="s1">path</span><span class="s3">: </span><span class="s1">realPath</span><span class="s3">,</span>
								<span class="s1">expected</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
								<span class="s1">issuer</span><span class="s3">: </span><span class="s1">job</span>
							<span class="s3">});</span>
							<span class="s1">callback</span><span class="s3">();</span>
						<span class="s3">});</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s3">}</span>
					<span class="s4">case </span><span class="s1">RBDT_FILE_DEPENDENCIES</span><span class="s3">: {</span>
						<span class="s0">// Check for known files without dependencies</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s8">/\.json5?$|\.yarn-integrity$|yarn\.lock$|\.ya?ml/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) {</span>
							<span class="s1">process</span><span class="s3">.</span><span class="s1">nextTick</span><span class="s3">(</span><span class="s1">callback</span><span class="s3">);</span>
							<span class="s4">break</span><span class="s3">;</span>
						<span class="s3">}</span>
						<span class="s0">// Check commonjs cache for the module</span>
						<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{NodeModule | undefined} */</span>
						<span class="s4">const </span><span class="s1">module </span><span class="s3">= </span><span class="s1">require</span><span class="s3">.</span><span class="s1">cache</span><span class="s3">[</span><span class="s1">path</span><span class="s3">];</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">module </span><span class="s3">&amp;&amp; </span><span class="s1">Array</span><span class="s3">.</span><span class="s1">isArray</span><span class="s3">(</span><span class="s1">module</span><span class="s3">.</span><span class="s1">children</span><span class="s3">)) {</span>
							<span class="s1">children</span><span class="s3">: </span><span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">child of module</span><span class="s3">.</span><span class="s1">children</span><span class="s3">) {</span>
								<span class="s4">let </span><span class="s1">childPath </span><span class="s3">= </span><span class="s1">child</span><span class="s3">.</span><span class="s1">filename</span><span class="s3">;</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">childPath</span><span class="s3">) {</span>
									<span class="s1">push</span><span class="s3">({</span>
										<span class="s1">type</span><span class="s3">: </span><span class="s1">RBDT_FILE</span><span class="s3">,</span>
										<span class="s1">context</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
										<span class="s1">path</span><span class="s3">: </span><span class="s1">childPath</span><span class="s3">,</span>
										<span class="s1">expected</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
										<span class="s1">issuer</span><span class="s3">: </span><span class="s1">job</span>
									<span class="s3">});</span>
									<span class="s4">const </span><span class="s1">context </span><span class="s3">= </span><span class="s1">dirname</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">path</span><span class="s3">);</span>
									<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">modulePath of module</span><span class="s3">.</span><span class="s1">paths</span><span class="s3">) {</span>
										<span class="s4">if </span><span class="s3">(</span><span class="s1">childPath</span><span class="s3">.</span><span class="s1">startsWith</span><span class="s3">(</span><span class="s1">modulePath</span><span class="s3">)) {</span>
											<span class="s4">let </span><span class="s1">subPath </span><span class="s3">= </span><span class="s1">childPath</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s1">modulePath</span><span class="s3">.</span><span class="s1">length </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">);</span>
											<span class="s4">const </span><span class="s1">packageMatch </span><span class="s3">= </span><span class="s8">/^(@[^\\/]+[\\/])[^\\/]+/</span><span class="s3">.</span><span class="s1">exec</span><span class="s3">(</span>
												<span class="s1">subPath</span>
											<span class="s3">);</span>
											<span class="s4">if </span><span class="s3">(</span><span class="s1">packageMatch</span><span class="s3">) {</span>
												<span class="s1">push</span><span class="s3">({</span>
													<span class="s1">type</span><span class="s3">: </span><span class="s1">RBDT_FILE</span><span class="s3">,</span>
													<span class="s1">context</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
													<span class="s1">path</span><span class="s3">:</span>
														<span class="s1">modulePath </span><span class="s3">+</span>
														<span class="s1">childPath</span><span class="s3">[</span><span class="s1">modulePath</span><span class="s3">.</span><span class="s1">length</span><span class="s3">] +</span>
														<span class="s1">packageMatch</span><span class="s3">[</span><span class="s7">0</span><span class="s3">] +</span>
														<span class="s1">childPath</span><span class="s3">[</span><span class="s1">modulePath</span><span class="s3">.</span><span class="s1">length</span><span class="s3">] +</span>
														<span class="s2">&quot;package.json&quot;</span><span class="s3">,</span>
													<span class="s1">expected</span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
													<span class="s1">issuer</span><span class="s3">: </span><span class="s1">job</span>
												<span class="s3">});</span>
											<span class="s3">}</span>
											<span class="s4">let </span><span class="s1">request </span><span class="s3">= </span><span class="s1">subPath</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s8">/\\/g</span><span class="s3">, </span><span class="s2">&quot;/&quot;</span><span class="s3">);</span>
											<span class="s4">if </span><span class="s3">(</span><span class="s1">request</span><span class="s3">.</span><span class="s1">endsWith</span><span class="s3">(</span><span class="s2">&quot;.js&quot;</span><span class="s3">))</span>
												<span class="s1">request </span><span class="s3">= </span><span class="s1">request</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s7">0</span><span class="s3">, -</span><span class="s7">3</span><span class="s3">);</span>
											<span class="s1">push</span><span class="s3">({</span>
												<span class="s1">type</span><span class="s3">: </span><span class="s1">RBDT_RESOLVE_CJS_FILE_AS_CHILD</span><span class="s3">,</span>
												<span class="s1">context</span><span class="s3">,</span>
												<span class="s1">path</span><span class="s3">: </span><span class="s1">request</span><span class="s3">,</span>
												<span class="s1">expected</span><span class="s3">: </span><span class="s1">child</span><span class="s3">.</span><span class="s1">filename</span><span class="s3">,</span>
												<span class="s1">issuer</span><span class="s3">: </span><span class="s1">job</span>
											<span class="s3">});</span>
											<span class="s4">continue </span><span class="s1">children</span><span class="s3">;</span>
										<span class="s3">}</span>
									<span class="s3">}</span>
									<span class="s4">let </span><span class="s1">request </span><span class="s3">= </span><span class="s1">relative</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">context</span><span class="s3">, </span><span class="s1">childPath</span><span class="s3">);</span>
									<span class="s4">if </span><span class="s3">(</span><span class="s1">request</span><span class="s3">.</span><span class="s1">endsWith</span><span class="s3">(</span><span class="s2">&quot;.js&quot;</span><span class="s3">)) </span><span class="s1">request </span><span class="s3">= </span><span class="s1">request</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s7">0</span><span class="s3">, -</span><span class="s7">3</span><span class="s3">);</span>
									<span class="s1">request </span><span class="s3">= </span><span class="s1">request</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s8">/\\/g</span><span class="s3">, </span><span class="s2">&quot;/&quot;</span><span class="s3">);</span>
									<span class="s4">if </span><span class="s3">(!</span><span class="s1">request</span><span class="s3">.</span><span class="s1">startsWith</span><span class="s3">(</span><span class="s2">&quot;../&quot;</span><span class="s3">) &amp;&amp; !</span><span class="s1">isAbsolute</span><span class="s3">(</span><span class="s1">request</span><span class="s3">)) {</span>
										<span class="s1">request </span><span class="s3">= </span><span class="s2">`./</span><span class="s1">$</span><span class="s3">{</span><span class="s1">request</span><span class="s3">}</span><span class="s2">`</span><span class="s3">;</span>
									<span class="s3">}</span>
									<span class="s1">push</span><span class="s3">({</span>
										<span class="s1">type</span><span class="s3">: </span><span class="s1">RBDT_RESOLVE_CJS_FILE</span><span class="s3">,</span>
										<span class="s1">context</span><span class="s3">,</span>
										<span class="s1">path</span><span class="s3">: </span><span class="s1">request</span><span class="s3">,</span>
										<span class="s1">expected</span><span class="s3">: </span><span class="s1">child</span><span class="s3">.</span><span class="s1">filename</span><span class="s3">,</span>
										<span class="s1">issuer</span><span class="s3">: </span><span class="s1">job</span>
									<span class="s3">});</span>
								<span class="s3">}</span>
							<span class="s3">}</span>
						<span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">supportsEsm </span><span class="s3">&amp;&amp; </span><span class="s8">/\.m?js$/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) {</span>
							<span class="s4">if </span><span class="s3">(!</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_warnAboutExperimentalEsmTracking</span><span class="s3">) {</span>
								<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">log</span><span class="s3">(</span>
									<span class="s2">&quot;Node.js doesn't offer a (nice) way to introspect the ESM dependency graph yet.</span><span class="s4">\n</span><span class="s2">&quot; </span><span class="s3">+</span>
										<span class="s2">&quot;Until a full solution is available webpack uses an experimental ESM tracking based on parsing.</span><span class="s4">\n</span><span class="s2">&quot; </span><span class="s3">+</span>
										<span class="s2">&quot;As best effort webpack parses the ESM files to guess dependencies. But this can lead to expensive and incorrect tracking.&quot;</span>
								<span class="s3">);</span>
								<span class="s4">this</span><span class="s3">.</span><span class="s1">_warnAboutExperimentalEsmTracking </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
							<span class="s3">}</span>
							<span class="s4">const </span><span class="s1">lexer </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s2">&quot;es-module-lexer&quot;</span><span class="s3">);</span>
							<span class="s1">lexer</span><span class="s3">.</span><span class="s1">init</span><span class="s3">.</span><span class="s1">then</span><span class="s3">(() =&gt; {</span>
								<span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">.</span><span class="s1">readFile</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">content</span><span class="s3">) =&gt; {</span>
									<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
									<span class="s4">try </span><span class="s3">{</span>
										<span class="s4">const </span><span class="s1">context </span><span class="s3">= </span><span class="s1">dirname</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">path</span><span class="s3">);</span>
										<span class="s4">const </span><span class="s1">source </span><span class="s3">= </span><span class="s1">content</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">();</span>
										<span class="s4">const </span><span class="s3">[</span><span class="s1">imports</span><span class="s3">] = </span><span class="s1">lexer</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s1">source</span><span class="s3">);</span>
										<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">imp of imports</span><span class="s3">) {</span>
											<span class="s4">try </span><span class="s3">{</span>
												<span class="s4">let </span><span class="s1">dependency</span><span class="s3">;</span>
												<span class="s4">if </span><span class="s3">(</span><span class="s1">imp</span><span class="s3">.</span><span class="s1">d </span><span class="s3">=== -</span><span class="s7">1</span><span class="s3">) {</span>
													<span class="s0">// import ... from &quot;...&quot;</span>
													<span class="s1">dependency </span><span class="s3">= </span><span class="s1">parseString</span><span class="s3">(</span>
														<span class="s1">source</span><span class="s3">.</span><span class="s1">substring</span><span class="s3">(</span><span class="s1">imp</span><span class="s3">.</span><span class="s1">s </span><span class="s3">- </span><span class="s7">1</span><span class="s3">, </span><span class="s1">imp</span><span class="s3">.</span><span class="s1">e </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">)</span>
													<span class="s3">);</span>
												<span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">imp</span><span class="s3">.</span><span class="s1">d </span><span class="s3">&gt; -</span><span class="s7">1</span><span class="s3">) {</span>
													<span class="s0">// import()</span>
													<span class="s4">let </span><span class="s1">expr </span><span class="s3">= </span><span class="s1">source</span><span class="s3">.</span><span class="s1">substring</span><span class="s3">(</span><span class="s1">imp</span><span class="s3">.</span><span class="s1">s</span><span class="s3">, </span><span class="s1">imp</span><span class="s3">.</span><span class="s1">e</span><span class="s3">).</span><span class="s1">trim</span><span class="s3">();</span>
													<span class="s1">dependency </span><span class="s3">= </span><span class="s1">parseString</span><span class="s3">(</span><span class="s1">expr</span><span class="s3">);</span>
												<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
													<span class="s0">// e.g. import.meta</span>
													<span class="s4">continue</span><span class="s3">;</span>
												<span class="s3">}</span>

												<span class="s0">// we should not track Node.js build dependencies</span>
												<span class="s4">if </span><span class="s3">(</span><span class="s1">dependency</span><span class="s3">.</span><span class="s1">startsWith</span><span class="s3">(</span><span class="s2">&quot;node:&quot;</span><span class="s3">)) </span><span class="s4">continue</span><span class="s3">;</span>
												<span class="s4">if </span><span class="s3">(</span><span class="s1">builtinModules</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">dependency</span><span class="s3">)) </span><span class="s4">continue</span><span class="s3">;</span>

												<span class="s1">push</span><span class="s3">({</span>
													<span class="s1">type</span><span class="s3">: </span><span class="s1">RBDT_RESOLVE_ESM_FILE</span><span class="s3">,</span>
													<span class="s1">context</span><span class="s3">,</span>
													<span class="s1">path</span><span class="s3">: </span><span class="s1">dependency</span><span class="s3">,</span>
													<span class="s1">expected</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
													<span class="s1">issuer</span><span class="s3">: </span><span class="s1">job</span>
												<span class="s3">});</span>
											<span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
												<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span>
													<span class="s2">`Parsing of </span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">} </span><span class="s2">for build dependencies failed at 'import(</span><span class="s1">$</span><span class="s3">{</span><span class="s1">source</span><span class="s3">.</span><span class="s1">substring</span><span class="s3">(</span>
														<span class="s1">imp</span><span class="s3">.</span><span class="s1">s</span><span class="s3">,</span>
														<span class="s1">imp</span><span class="s3">.</span><span class="s1">e</span>
													<span class="s3">)}</span><span class="s2">)'.</span><span class="s4">\n</span><span class="s2">` </span><span class="s3">+</span>
														<span class="s2">&quot;Build dependencies behind this expression are ignored and might cause incorrect cache invalidation.&quot;</span>
												<span class="s3">);</span>
												<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span><span class="s1">pathToString</span><span class="s3">(</span><span class="s1">job</span><span class="s3">));</span>
												<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span><span class="s1">e</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">);</span>
											<span class="s3">}</span>
										<span class="s3">}</span>
									<span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
										<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span>
											<span class="s2">`Parsing of </span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">} </span><span class="s2">for build dependencies failed and all dependencies of this file are ignored, which might cause incorrect cache invalidation..`</span>
										<span class="s3">);</span>
										<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span><span class="s1">pathToString</span><span class="s3">(</span><span class="s1">job</span><span class="s3">));</span>
										<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span><span class="s1">e</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">);</span>
									<span class="s3">}</span>
									<span class="s1">process</span><span class="s3">.</span><span class="s1">nextTick</span><span class="s3">(</span><span class="s1">callback</span><span class="s3">);</span>
								<span class="s3">});</span>
							<span class="s3">}, </span><span class="s1">callback</span><span class="s3">);</span>
							<span class="s4">break</span><span class="s3">;</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">log</span><span class="s3">(</span>
								<span class="s2">`Assuming </span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">} </span><span class="s2">has no dependencies as we were unable to assign it to any module system.`</span>
							<span class="s3">);</span>
							<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span><span class="s1">pathToString</span><span class="s3">(</span><span class="s1">job</span><span class="s3">));</span>
						<span class="s3">}</span>
						<span class="s1">process</span><span class="s3">.</span><span class="s1">nextTick</span><span class="s3">(</span><span class="s1">callback</span><span class="s3">);</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s3">}</span>
					<span class="s4">case </span><span class="s1">RBDT_DIRECTORY_DEPENDENCIES</span><span class="s3">: {</span>
						<span class="s4">const </span><span class="s1">match </span><span class="s3">=</span>
							<span class="s8">/(^.+[\\/]node_modules[\\/](?:@[^\\/]+[\\/])?[^\\/]+)/</span><span class="s3">.</span><span class="s1">exec</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">const </span><span class="s1">packagePath </span><span class="s3">= </span><span class="s1">match </span><span class="s3">? </span><span class="s1">match</span><span class="s3">[</span><span class="s7">1</span><span class="s3">] : </span><span class="s1">path</span><span class="s3">;</span>
						<span class="s4">const </span><span class="s1">packageJson </span><span class="s3">= </span><span class="s1">join</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">packagePath</span><span class="s3">, </span><span class="s2">&quot;package.json&quot;</span><span class="s3">);</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">.</span><span class="s1">readFile</span><span class="s3">(</span><span class="s1">packageJson</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">content</span><span class="s3">) =&gt; {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">=== </span><span class="s2">&quot;ENOENT&quot;</span><span class="s3">) {</span>
									<span class="s1">resolveMissing</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">packageJson</span><span class="s3">);</span>
									<span class="s4">const </span><span class="s1">parent </span><span class="s3">= </span><span class="s1">dirname</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">packagePath</span><span class="s3">);</span>
									<span class="s4">if </span><span class="s3">(</span><span class="s1">parent </span><span class="s3">!== </span><span class="s1">packagePath</span><span class="s3">) {</span>
										<span class="s1">push</span><span class="s3">({</span>
											<span class="s1">type</span><span class="s3">: </span><span class="s1">RBDT_DIRECTORY_DEPENDENCIES</span><span class="s3">,</span>
											<span class="s1">context</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
											<span class="s1">path</span><span class="s3">: </span><span class="s1">parent</span><span class="s3">,</span>
											<span class="s1">expected</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
											<span class="s1">issuer</span><span class="s3">: </span><span class="s1">job</span>
										<span class="s3">});</span>
									<span class="s3">}</span>
									<span class="s1">callback</span><span class="s3">();</span>
									<span class="s4">return</span><span class="s3">;</span>
								<span class="s3">}</span>
								<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
							<span class="s3">}</span>
							<span class="s1">resolveFiles</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">packageJson</span><span class="s3">);</span>
							<span class="s4">let </span><span class="s1">packageData</span><span class="s3">;</span>
							<span class="s4">try </span><span class="s3">{</span>
								<span class="s1">packageData </span><span class="s3">= </span><span class="s1">JSON</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s1">content</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">(</span><span class="s2">&quot;utf-8&quot;</span><span class="s3">));</span>
							<span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
								<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">e</span><span class="s3">);</span>
							<span class="s3">}</span>
							<span class="s4">const </span><span class="s1">depsObject </span><span class="s3">= </span><span class="s1">packageData</span><span class="s3">.</span><span class="s1">dependencies</span><span class="s3">;</span>
							<span class="s4">const </span><span class="s1">optionalDepsObject </span><span class="s3">= </span><span class="s1">packageData</span><span class="s3">.</span><span class="s1">optionalDependencies</span><span class="s3">;</span>
							<span class="s4">const </span><span class="s1">allDeps </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
							<span class="s4">const </span><span class="s1">optionalDeps </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">depsObject </span><span class="s3">=== </span><span class="s2">&quot;object&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">depsObject</span><span class="s3">) {</span>
								<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">dep of Object</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">(</span><span class="s1">depsObject</span><span class="s3">)) {</span>
									<span class="s1">allDeps</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">dep</span><span class="s3">);</span>
								<span class="s3">}</span>
							<span class="s3">}</span>
							<span class="s4">if </span><span class="s3">(</span>
								<span class="s4">typeof </span><span class="s1">optionalDepsObject </span><span class="s3">=== </span><span class="s2">&quot;object&quot; </span><span class="s3">&amp;&amp;</span>
								<span class="s1">optionalDepsObject</span>
							<span class="s3">) {</span>
								<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">dep of Object</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">(</span><span class="s1">optionalDepsObject</span><span class="s3">)) {</span>
									<span class="s1">allDeps</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">dep</span><span class="s3">);</span>
									<span class="s1">optionalDeps</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">dep</span><span class="s3">);</span>
								<span class="s3">}</span>
							<span class="s3">}</span>
							<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">dep of allDeps</span><span class="s3">) {</span>
								<span class="s1">push</span><span class="s3">({</span>
									<span class="s1">type</span><span class="s3">: </span><span class="s1">RBDT_RESOLVE_DIRECTORY</span><span class="s3">,</span>
									<span class="s1">context</span><span class="s3">: </span><span class="s1">packagePath</span><span class="s3">,</span>
									<span class="s1">path</span><span class="s3">: </span><span class="s1">dep</span><span class="s3">,</span>
									<span class="s1">expected</span><span class="s3">: !</span><span class="s1">optionalDeps</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">dep</span><span class="s3">),</span>
									<span class="s1">issuer</span><span class="s3">: </span><span class="s1">job</span>
								<span class="s3">});</span>
							<span class="s3">}</span>
							<span class="s1">callback</span><span class="s3">();</span>
						<span class="s3">});</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s3">}</span>
				<span class="s3">}</span>
			<span class="s3">},</span>
			<span class="s1">err </span><span class="s3">=&gt; {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
				<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">l of fileSymlinks</span><span class="s3">) </span><span class="s1">files</span><span class="s3">.</span><span class="s1">delete</span><span class="s3">(</span><span class="s1">l</span><span class="s3">);</span>
				<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">l of directorySymlinks</span><span class="s3">) </span><span class="s1">directories</span><span class="s3">.</span><span class="s1">delete</span><span class="s3">(</span><span class="s1">l</span><span class="s3">);</span>
				<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">k of invalidResolveResults</span><span class="s3">) </span><span class="s1">resolveResults</span><span class="s3">.</span><span class="s1">delete</span><span class="s3">(</span><span class="s1">k</span><span class="s3">);</span>
				<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, {</span>
					<span class="s1">files</span><span class="s3">,</span>
					<span class="s1">directories</span><span class="s3">,</span>
					<span class="s1">missing</span><span class="s3">,</span>
					<span class="s1">resolveResults</span><span class="s3">,</span>
					<span class="s1">resolveDependencies</span><span class="s3">: {</span>
						<span class="s1">files</span><span class="s3">: </span><span class="s1">resolveFiles</span><span class="s3">,</span>
						<span class="s1">directories</span><span class="s3">: </span><span class="s1">resolveDirectories</span><span class="s3">,</span>
						<span class="s1">missing</span><span class="s3">: </span><span class="s1">resolveMissing</span>
					<span class="s3">}</span>
				<span class="s3">});</span>
			<span class="s3">}</span>
		<span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Map&lt;string, string | false&gt;} resolveResults results from resolving</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((Error | null)=, boolean=): void} callback callback with true when resolveResults resolve the same way</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">checkResolveResultsValid</span><span class="s3">(</span><span class="s1">resolveResults</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s3">{ </span><span class="s1">resolveCjs</span><span class="s3">, </span><span class="s1">resolveCjsAsChild</span><span class="s3">, </span><span class="s1">resolveEsm</span><span class="s3">, </span><span class="s1">resolveContext </span><span class="s3">} =</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_createBuildDependenciesResolvers</span><span class="s3">();</span>
		<span class="s1">asyncLib</span><span class="s3">.</span><span class="s1">eachLimit</span><span class="s3">(</span>
			<span class="s1">resolveResults</span><span class="s3">,</span>
			<span class="s7">20</span><span class="s3">,</span>
			<span class="s3">([</span><span class="s1">key</span><span class="s3">, </span><span class="s1">expectedResult</span><span class="s3">], </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
				<span class="s4">const </span><span class="s3">[</span><span class="s1">type</span><span class="s3">, </span><span class="s1">context</span><span class="s3">, </span><span class="s1">path</span><span class="s3">] = </span><span class="s1">key</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">);</span>
				<span class="s4">switch </span><span class="s3">(</span><span class="s1">type</span><span class="s3">) {</span>
					<span class="s4">case </span><span class="s2">&quot;d&quot;</span><span class="s3">:</span>
						<span class="s1">resolveContext</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, {}, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">_</span><span class="s3">, </span><span class="s1">result</span><span class="s3">) =&gt; {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">expectedResult </span><span class="s3">=== </span><span class="s4">false</span><span class="s3">)</span>
								<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err </span><span class="s3">? </span><span class="s1">undefined </span><span class="s3">: </span><span class="s1">INVALID</span><span class="s3">);</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
							<span class="s4">const </span><span class="s1">resultPath </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">path</span><span class="s3">;</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">resultPath </span><span class="s3">!== </span><span class="s1">expectedResult</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">INVALID</span><span class="s3">);</span>
							<span class="s1">callback</span><span class="s3">();</span>
						<span class="s3">});</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s4">case </span><span class="s2">&quot;f&quot;</span><span class="s3">:</span>
						<span class="s1">resolveCjs</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, {}, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">_</span><span class="s3">, </span><span class="s1">result</span><span class="s3">) =&gt; {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">expectedResult </span><span class="s3">=== </span><span class="s4">false</span><span class="s3">)</span>
								<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err </span><span class="s3">? </span><span class="s1">undefined </span><span class="s3">: </span><span class="s1">INVALID</span><span class="s3">);</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
							<span class="s4">const </span><span class="s1">resultPath </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">path</span><span class="s3">;</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">resultPath </span><span class="s3">!== </span><span class="s1">expectedResult</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">INVALID</span><span class="s3">);</span>
							<span class="s1">callback</span><span class="s3">();</span>
						<span class="s3">});</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s4">case </span><span class="s2">&quot;c&quot;</span><span class="s3">:</span>
						<span class="s1">resolveCjsAsChild</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, {}, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">_</span><span class="s3">, </span><span class="s1">result</span><span class="s3">) =&gt; {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">expectedResult </span><span class="s3">=== </span><span class="s4">false</span><span class="s3">)</span>
								<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err </span><span class="s3">? </span><span class="s1">undefined </span><span class="s3">: </span><span class="s1">INVALID</span><span class="s3">);</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
							<span class="s4">const </span><span class="s1">resultPath </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">path</span><span class="s3">;</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">resultPath </span><span class="s3">!== </span><span class="s1">expectedResult</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">INVALID</span><span class="s3">);</span>
							<span class="s1">callback</span><span class="s3">();</span>
						<span class="s3">});</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s4">case </span><span class="s2">&quot;e&quot;</span><span class="s3">:</span>
						<span class="s1">resolveEsm</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, {}, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">_</span><span class="s3">, </span><span class="s1">result</span><span class="s3">) =&gt; {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">expectedResult </span><span class="s3">=== </span><span class="s4">false</span><span class="s3">)</span>
								<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err </span><span class="s3">? </span><span class="s1">undefined </span><span class="s3">: </span><span class="s1">INVALID</span><span class="s3">);</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
							<span class="s4">const </span><span class="s1">resultPath </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">path</span><span class="s3">;</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">resultPath </span><span class="s3">!== </span><span class="s1">expectedResult</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">INVALID</span><span class="s3">);</span>
							<span class="s1">callback</span><span class="s3">();</span>
						<span class="s3">});</span>
						<span class="s4">break</span><span class="s3">;</span>
					<span class="s4">default</span><span class="s3">:</span>
						<span class="s1">callback</span><span class="s3">(</span><span class="s4">new </span><span class="s1">Error</span><span class="s3">(</span><span class="s2">&quot;Unexpected type in resolve result key&quot;</span><span class="s3">));</span>
						<span class="s4">break</span><span class="s3">;</span>
				<span class="s3">}</span>
			<span class="s3">},</span>
			<span class="s5">/**</span>
			 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Error | typeof INVALID=} err error or invalid flag</span>
			 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
			 <span class="s5">*/</span>
			<span class="s1">err </span><span class="s3">=&gt; {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err </span><span class="s3">=== </span><span class="s1">INVALID</span><span class="s3">) {</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s4">false</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">*</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{number | null | undefined} startTime when processing the files has started</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Iterable&lt;string&gt;} files all files</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Iterable&lt;string&gt;} directories all directories</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Iterable&lt;string&gt;} missing all missing files or directories</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{SnapshotOptions | null | undefined} options options object (for future extensions)</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((WebpackError | null)=, (Snapshot | null)=): void} callback callback function</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">createSnapshot</span><span class="s3">(</span><span class="s1">startTime</span><span class="s3">, </span><span class="s1">files</span><span class="s3">, </span><span class="s1">directories</span><span class="s3">, </span><span class="s1">missing</span><span class="s3">, </span><span class="s1">options</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, FileSystemInfoEntry | null&gt;} */</span>
		<span class="s4">const </span><span class="s1">fileTimestamps </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, string | null&gt;} */</span>
		<span class="s4">const </span><span class="s1">fileHashes </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, TimestampAndHash | string | null&gt;} */</span>
		<span class="s4">const </span><span class="s1">fileTshs </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, FileSystemInfoEntry | null&gt;} */</span>
		<span class="s4">const </span><span class="s1">contextTimestamps </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, string | null&gt;} */</span>
		<span class="s4">const </span><span class="s1">contextHashes </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, ResolvedContextTimestampAndHash | null&gt;} */</span>
		<span class="s4">const </span><span class="s1">contextTshs </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, boolean&gt;} */</span>
		<span class="s4">const </span><span class="s1">missingExistence </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Map&lt;string, string&gt;} */</span>
		<span class="s4">const </span><span class="s1">managedItemInfo </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */</span>
		<span class="s4">const </span><span class="s1">managedFiles </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */</span>
		<span class="s4">const </span><span class="s1">managedContexts </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */</span>
		<span class="s4">const </span><span class="s1">managedMissing </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;Snapshot&gt;} */</span>
		<span class="s4">const </span><span class="s1">children </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>

		<span class="s4">const </span><span class="s1">snapshot </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Snapshot</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">startTime</span><span class="s3">) </span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setStartTime</span><span class="s3">(</span><span class="s1">startTime</span><span class="s3">);</span>

		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Set&lt;string&gt;} */</span>
		<span class="s4">const </span><span class="s1">managedItems </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>

		<span class="s5">/** 1 = timestamp, 2 = hash, 3 = timestamp + hash */</span>
		<span class="s4">const </span><span class="s1">mode </span><span class="s3">= </span><span class="s1">options </span><span class="s3">&amp;&amp; </span><span class="s1">options</span><span class="s3">.</span><span class="s1">hash </span><span class="s3">? (</span><span class="s1">options</span><span class="s3">.</span><span class="s1">timestamp </span><span class="s3">? </span><span class="s7">3 </span><span class="s3">: </span><span class="s7">2</span><span class="s3">) : </span><span class="s7">1</span><span class="s3">;</span>

		<span class="s4">let </span><span class="s1">jobs </span><span class="s3">= </span><span class="s7">1</span><span class="s3">;</span>
		<span class="s4">const </span><span class="s1">jobDone </span><span class="s3">= () =&gt; {</span>
			<span class="s4">if </span><span class="s3">(--</span><span class="s1">jobs </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">fileTimestamps</span><span class="s3">.</span><span class="s1">size </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setFileTimestamps</span><span class="s3">(</span><span class="s1">fileTimestamps</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">fileHashes</span><span class="s3">.</span><span class="s1">size </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setFileHashes</span><span class="s3">(</span><span class="s1">fileHashes</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">fileTshs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setFileTshs</span><span class="s3">(</span><span class="s1">fileTshs</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">contextTimestamps</span><span class="s3">.</span><span class="s1">size </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setContextTimestamps</span><span class="s3">(</span><span class="s1">contextTimestamps</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">contextHashes</span><span class="s3">.</span><span class="s1">size </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setContextHashes</span><span class="s3">(</span><span class="s1">contextHashes</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">contextTshs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setContextTshs</span><span class="s3">(</span><span class="s1">contextTshs</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">missingExistence</span><span class="s3">.</span><span class="s1">size </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setMissingExistence</span><span class="s3">(</span><span class="s1">missingExistence</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">managedItemInfo</span><span class="s3">.</span><span class="s1">size </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setManagedItemInfo</span><span class="s3">(</span><span class="s1">managedItemInfo</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedFilesOptimization</span><span class="s3">.</span><span class="s1">optimize</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">managedFiles</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">managedFiles</span><span class="s3">.</span><span class="s1">size </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setManagedFiles</span><span class="s3">(</span><span class="s1">managedFiles</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedContextsOptimization</span><span class="s3">.</span><span class="s1">optimize</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">managedContexts</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">managedContexts</span><span class="s3">.</span><span class="s1">size </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setManagedContexts</span><span class="s3">(</span><span class="s1">managedContexts</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedMissingOptimization</span><span class="s3">.</span><span class="s1">optimize</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">managedMissing</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">managedMissing</span><span class="s3">.</span><span class="s1">size </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setManagedMissing</span><span class="s3">(</span><span class="s1">managedMissing</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">children</span><span class="s3">.</span><span class="s1">size </span><span class="s3">!== </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setChildren</span><span class="s3">(</span><span class="s1">children</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_snapshotCache</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_statCreatedSnapshots</span><span class="s3">++;</span>

				<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">snapshot</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">};</span>
		<span class="s4">const </span><span class="s1">jobError </span><span class="s3">= () =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">jobs </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) {</span>
				<span class="s0">// large negative number instead of NaN or something else to keep jobs to stay a SMI (v8)</span>
				<span class="s1">jobs </span><span class="s3">= -</span><span class="s7">100000000</span><span class="s3">;</span>
				<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s4">null</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">};</span>
		<span class="s4">const </span><span class="s1">checkManaged </span><span class="s3">= (</span><span class="s1">path</span><span class="s3">, </span><span class="s1">managedSet</span><span class="s3">) =&gt; {</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">immutablePath of </span><span class="s4">this</span><span class="s3">.</span><span class="s1">immutablePathsRegExps</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">immutablePath</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) {</span>
					<span class="s1">managedSet</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
					<span class="s4">return true</span><span class="s3">;</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">immutablePath of </span><span class="s4">this</span><span class="s3">.</span><span class="s1">immutablePathsWithSlash</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">path</span><span class="s3">.</span><span class="s1">startsWith</span><span class="s3">(</span><span class="s1">immutablePath</span><span class="s3">)) {</span>
					<span class="s1">managedSet</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
					<span class="s4">return true</span><span class="s3">;</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">managedPath of </span><span class="s4">this</span><span class="s3">.</span><span class="s1">managedPathsRegExps</span><span class="s3">) {</span>
				<span class="s4">const </span><span class="s1">match </span><span class="s3">= </span><span class="s1">managedPath</span><span class="s3">.</span><span class="s1">exec</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">match</span><span class="s3">) {</span>
					<span class="s4">const </span><span class="s1">managedItem </span><span class="s3">= </span><span class="s1">getManagedItem</span><span class="s3">(</span><span class="s1">match</span><span class="s3">[</span><span class="s7">1</span><span class="s3">], </span><span class="s1">path</span><span class="s3">);</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">managedItem</span><span class="s3">) {</span>
						<span class="s1">managedItems</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">managedItem</span><span class="s3">);</span>
						<span class="s1">managedSet</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">return true</span><span class="s3">;</span>
					<span class="s3">}</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">managedPath of </span><span class="s4">this</span><span class="s3">.</span><span class="s1">managedPathsWithSlash</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">path</span><span class="s3">.</span><span class="s1">startsWith</span><span class="s3">(</span><span class="s1">managedPath</span><span class="s3">)) {</span>
					<span class="s4">const </span><span class="s1">managedItem </span><span class="s3">= </span><span class="s1">getManagedItem</span><span class="s3">(</span><span class="s1">managedPath</span><span class="s3">, </span><span class="s1">path</span><span class="s3">);</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">managedItem</span><span class="s3">) {</span>
						<span class="s1">managedItems</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">managedItem</span><span class="s3">);</span>
						<span class="s1">managedSet</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">return true</span><span class="s3">;</span>
					<span class="s3">}</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
			<span class="s4">return false</span><span class="s3">;</span>
		<span class="s3">};</span>
		<span class="s4">const </span><span class="s1">captureNonManaged </span><span class="s3">= (</span><span class="s1">items</span><span class="s3">, </span><span class="s1">managedSet</span><span class="s3">) =&gt; {</span>
			<span class="s4">const </span><span class="s1">capturedItems </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of items</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkManaged</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">managedSet</span><span class="s3">)) </span><span class="s1">capturedItems</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
			<span class="s3">}</span>
			<span class="s4">return </span><span class="s1">capturedItems</span><span class="s3">;</span>
		<span class="s3">};</span>
		<span class="s5">/**</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Set&lt;string&gt;} capturedFiles captured files</span>
		 <span class="s5">*/</span>
		<span class="s4">const </span><span class="s1">processCapturedFiles </span><span class="s3">= </span><span class="s1">capturedFiles </span><span class="s3">=&gt; {</span>
			<span class="s4">switch </span><span class="s3">(</span><span class="s1">mode</span><span class="s3">) {</span>
				<span class="s4">case </span><span class="s7">3</span><span class="s3">:</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTshsOptimization</span><span class="s3">.</span><span class="s1">optimize</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">capturedFiles</span><span class="s3">);</span>
					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of capturedFiles</span><span class="s3">) {</span>
						<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTshs</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
							<span class="s1">fileTshs</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">cache</span><span class="s3">);</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">jobs</span><span class="s3">++;</span>
							<span class="s4">this</span><span class="s3">.</span><span class="s1">_getFileTimestampAndHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
									<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">) {</span>
										<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span>
											<span class="s2">`Error snapshotting file timestamp hash combination of </span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">}</span><span class="s2">: </span><span class="s1">$</span><span class="s3">{</span><span class="s1">err</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">}</span><span class="s2">`</span>
										<span class="s3">);</span>
									<span class="s3">}</span>
									<span class="s1">jobError</span><span class="s3">();</span>
								<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
									<span class="s1">fileTshs</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">);</span>
									<span class="s1">jobDone</span><span class="s3">();</span>
								<span class="s3">}</span>
							<span class="s3">});</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s4">break</span><span class="s3">;</span>
				<span class="s4">case </span><span class="s7">2</span><span class="s3">:</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashesOptimization</span><span class="s3">.</span><span class="s1">optimize</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">capturedFiles</span><span class="s3">);</span>
					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of capturedFiles</span><span class="s3">) {</span>
						<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashes</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
							<span class="s1">fileHashes</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">cache</span><span class="s3">);</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">jobs</span><span class="s3">++;</span>
							<span class="s4">this</span><span class="s3">.</span><span class="s1">fileHashQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
									<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">) {</span>
										<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span>
											<span class="s2">`Error snapshotting file hash of </span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">}</span><span class="s2">: </span><span class="s1">$</span><span class="s3">{</span><span class="s1">err</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">}</span><span class="s2">`</span>
										<span class="s3">);</span>
									<span class="s3">}</span>
									<span class="s1">jobError</span><span class="s3">();</span>
								<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
									<span class="s1">fileHashes</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">);</span>
									<span class="s1">jobDone</span><span class="s3">();</span>
								<span class="s3">}</span>
							<span class="s3">});</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s4">break</span><span class="s3">;</span>
				<span class="s4">case </span><span class="s7">1</span><span class="s3">:</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestampsOptimization</span><span class="s3">.</span><span class="s1">optimize</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">capturedFiles</span><span class="s3">);</span>
					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of capturedFiles</span><span class="s3">) {</span>
						<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s2">&quot;ignore&quot;</span><span class="s3">) {</span>
								<span class="s1">fileTimestamps</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">cache</span><span class="s3">);</span>
							<span class="s3">}</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">jobs</span><span class="s3">++;</span>
							<span class="s4">this</span><span class="s3">.</span><span class="s1">fileTimestampQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
									<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">) {</span>
										<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span>
											<span class="s2">`Error snapshotting file timestamp of </span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">}</span><span class="s2">: </span><span class="s1">$</span><span class="s3">{</span><span class="s1">err</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">}</span><span class="s2">`</span>
										<span class="s3">);</span>
									<span class="s3">}</span>
									<span class="s1">jobError</span><span class="s3">();</span>
								<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
									<span class="s1">fileTimestamps</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">);</span>
									<span class="s1">jobDone</span><span class="s3">();</span>
								<span class="s3">}</span>
							<span class="s3">});</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s4">break</span><span class="s3">;</span>
			<span class="s3">}</span>
		<span class="s3">};</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">files</span><span class="s3">) {</span>
			<span class="s1">processCapturedFiles</span><span class="s3">(</span><span class="s1">captureNonManaged</span><span class="s3">(</span><span class="s1">files</span><span class="s3">, </span><span class="s1">managedFiles</span><span class="s3">));</span>
		<span class="s3">}</span>
		<span class="s4">const </span><span class="s1">processCapturedDirectories </span><span class="s3">= </span><span class="s1">capturedDirectories </span><span class="s3">=&gt; {</span>
			<span class="s4">switch </span><span class="s3">(</span><span class="s1">mode</span><span class="s3">) {</span>
				<span class="s4">case </span><span class="s7">3</span><span class="s3">:</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTshsOptimization</span><span class="s3">.</span><span class="s1">optimize</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">capturedDirectories</span><span class="s3">);</span>
					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of capturedDirectories</span><span class="s3">) {</span>
						<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTshs</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{ResolvedContextTimestampAndHash} */</span>
						<span class="s4">let </span><span class="s1">resolved</span><span class="s3">;</span>
						<span class="s4">if </span><span class="s3">(</span>
							<span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
							<span class="s3">(</span><span class="s1">resolved </span><span class="s3">= </span><span class="s1">getResolvedTimestamp</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">)) !== </span><span class="s1">undefined</span>
						<span class="s3">) {</span>
							<span class="s1">contextTshs</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">resolved</span><span class="s3">);</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">jobs</span><span class="s3">++;</span>
							<span class="s5">/**</span>
							 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Error=} err error</span>
							 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ResolvedContextTimestampAndHash=} entry entry</span>
							 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
							 <span class="s5">*/</span>
							<span class="s4">const </span><span class="s1">callback </span><span class="s3">= (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
									<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">) {</span>
										<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span>
											<span class="s2">`Error snapshotting context timestamp hash combination of </span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">}</span><span class="s2">: </span><span class="s1">$</span><span class="s3">{</span><span class="s1">err</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">}</span><span class="s2">`</span>
										<span class="s3">);</span>
									<span class="s3">}</span>
									<span class="s1">jobError</span><span class="s3">();</span>
								<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
									<span class="s1">contextTshs</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">);</span>
									<span class="s1">jobDone</span><span class="s3">();</span>
								<span class="s3">}</span>
							<span class="s3">};</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
								<span class="s4">this</span><span class="s3">.</span><span class="s1">_resolveContextTsh</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
							<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
								<span class="s4">this</span><span class="s3">.</span><span class="s1">getContextTsh</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
							<span class="s3">}</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s4">break</span><span class="s3">;</span>
				<span class="s4">case </span><span class="s7">2</span><span class="s3">:</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextHashesOptimization</span><span class="s3">.</span><span class="s1">optimize</span><span class="s3">(</span>
						<span class="s1">snapshot</span><span class="s3">,</span>
						<span class="s1">capturedDirectories</span>
					<span class="s3">);</span>
					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of capturedDirectories</span><span class="s3">) {</span>
						<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextHashes</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">let </span><span class="s1">resolved</span><span class="s3">;</span>
						<span class="s4">if </span><span class="s3">(</span>
							<span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
							<span class="s3">(</span><span class="s1">resolved </span><span class="s3">= </span><span class="s1">getResolvedHash</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">)) !== </span><span class="s1">undefined</span>
						<span class="s3">) {</span>
							<span class="s1">contextHashes</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">resolved</span><span class="s3">);</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">jobs</span><span class="s3">++;</span>
							<span class="s4">const </span><span class="s1">callback </span><span class="s3">= (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
									<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">) {</span>
										<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span>
											<span class="s2">`Error snapshotting context hash of </span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">}</span><span class="s2">: </span><span class="s1">$</span><span class="s3">{</span><span class="s1">err</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">}</span><span class="s2">`</span>
										<span class="s3">);</span>
									<span class="s3">}</span>
									<span class="s1">jobError</span><span class="s3">();</span>
								<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
									<span class="s1">contextHashes</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">);</span>
									<span class="s1">jobDone</span><span class="s3">();</span>
								<span class="s3">}</span>
							<span class="s3">};</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
								<span class="s4">this</span><span class="s3">.</span><span class="s1">_resolveContextHash</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
							<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
								<span class="s4">this</span><span class="s3">.</span><span class="s1">getContextHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
							<span class="s3">}</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s4">break</span><span class="s3">;</span>
				<span class="s4">case </span><span class="s7">1</span><span class="s3">:</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestampsOptimization</span><span class="s3">.</span><span class="s1">optimize</span><span class="s3">(</span>
						<span class="s1">snapshot</span><span class="s3">,</span>
						<span class="s1">capturedDirectories</span>
					<span class="s3">);</span>
					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of capturedDirectories</span><span class="s3">) {</span>
						<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">=== </span><span class="s2">&quot;ignore&quot;</span><span class="s3">) </span><span class="s4">continue</span><span class="s3">;</span>
						<span class="s4">let </span><span class="s1">resolved</span><span class="s3">;</span>
						<span class="s4">if </span><span class="s3">(</span>
							<span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
							<span class="s3">(</span><span class="s1">resolved </span><span class="s3">= </span><span class="s1">getResolvedTimestamp</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">)) !== </span><span class="s1">undefined</span>
						<span class="s3">) {</span>
							<span class="s1">contextTimestamps</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">resolved</span><span class="s3">);</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">jobs</span><span class="s3">++;</span>
							<span class="s5">/**</span>
							 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Error=} err error</span>
							 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ResolvedContextFileSystemInfoEntry=} entry entry</span>
							 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
							 <span class="s5">*/</span>
							<span class="s4">const </span><span class="s1">callback </span><span class="s3">= (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
									<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">) {</span>
										<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span>
											<span class="s2">`Error snapshotting context timestamp of </span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">}</span><span class="s2">: </span><span class="s1">$</span><span class="s3">{</span><span class="s1">err</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">}</span><span class="s2">`</span>
										<span class="s3">);</span>
									<span class="s3">}</span>
									<span class="s1">jobError</span><span class="s3">();</span>
								<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
									<span class="s1">contextTimestamps</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">);</span>
									<span class="s1">jobDone</span><span class="s3">();</span>
								<span class="s3">}</span>
							<span class="s3">};</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
								<span class="s4">this</span><span class="s3">.</span><span class="s1">_resolveContextTimestamp</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
							<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
								<span class="s4">this</span><span class="s3">.</span><span class="s1">getContextTimestamp</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
							<span class="s3">}</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s4">break</span><span class="s3">;</span>
			<span class="s3">}</span>
		<span class="s3">};</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">directories</span><span class="s3">) {</span>
			<span class="s1">processCapturedDirectories</span><span class="s3">(</span>
				<span class="s1">captureNonManaged</span><span class="s3">(</span><span class="s1">directories</span><span class="s3">, </span><span class="s1">managedContexts</span><span class="s3">)</span>
			<span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">const </span><span class="s1">processCapturedMissing </span><span class="s3">= </span><span class="s1">capturedMissing </span><span class="s3">=&gt; {</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_missingExistenceOptimization</span><span class="s3">.</span><span class="s1">optimize</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">capturedMissing</span><span class="s3">);</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of capturedMissing</span><span class="s3">) {</span>
				<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s2">&quot;ignore&quot;</span><span class="s3">) {</span>
						<span class="s1">missingExistence</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">Boolean</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">));</span>
					<span class="s3">}</span>
				<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
					<span class="s1">jobs</span><span class="s3">++;</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">fileTimestampQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">) {</span>
								<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span>
									<span class="s2">`Error snapshotting missing timestamp of </span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">}</span><span class="s2">: </span><span class="s1">$</span><span class="s3">{</span><span class="s1">err</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">}</span><span class="s2">`</span>
								<span class="s3">);</span>
							<span class="s3">}</span>
							<span class="s1">jobError</span><span class="s3">();</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">missingExistence</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">Boolean</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">));</span>
							<span class="s1">jobDone</span><span class="s3">();</span>
						<span class="s3">}</span>
					<span class="s3">});</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
		<span class="s3">};</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">missing</span><span class="s3">) {</span>
			<span class="s1">processCapturedMissing</span><span class="s3">(</span><span class="s1">captureNonManaged</span><span class="s3">(</span><span class="s1">missing</span><span class="s3">, </span><span class="s1">managedMissing</span><span class="s3">));</span>
		<span class="s3">}</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItemInfoOptimization</span><span class="s3">.</span><span class="s1">optimize</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">managedItems</span><span class="s3">);</span>
		<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">path of managedItems</span><span class="s3">) {</span>
			<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItems</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(!</span><span class="s1">cache</span><span class="s3">.</span><span class="s1">startsWith</span><span class="s3">(</span><span class="s2">&quot;*&quot;</span><span class="s3">)) {</span>
					<span class="s1">managedFiles</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">join</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;package.json&quot;</span><span class="s3">));</span>
				<span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">=== </span><span class="s2">&quot;*nested&quot;</span><span class="s3">) {</span>
					<span class="s1">managedMissing</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">join</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;package.json&quot;</span><span class="s3">));</span>
				<span class="s3">}</span>
				<span class="s1">managedItemInfo</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">cache</span><span class="s3">);</span>
			<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
				<span class="s1">jobs</span><span class="s3">++;</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">managedItemQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">) {</span>
							<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span>
								<span class="s2">`Error snapshotting managed item </span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">}</span><span class="s2">: </span><span class="s1">$</span><span class="s3">{</span><span class="s1">err</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">}</span><span class="s2">`</span>
							<span class="s3">);</span>
						<span class="s3">}</span>
						<span class="s1">jobError</span><span class="s3">();</span>
					<span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">) {</span>
						<span class="s4">if </span><span class="s3">(!</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">startsWith</span><span class="s3">(</span><span class="s2">&quot;*&quot;</span><span class="s3">)) {</span>
							<span class="s1">managedFiles</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">join</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;package.json&quot;</span><span class="s3">));</span>
						<span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">=== </span><span class="s2">&quot;*nested&quot;</span><span class="s3">) {</span>
							<span class="s1">managedMissing</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">join</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;package.json&quot;</span><span class="s3">));</span>
						<span class="s3">}</span>
						<span class="s1">managedItemInfo</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">);</span>
						<span class="s1">jobDone</span><span class="s3">();</span>
					<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
						<span class="s0">// Fallback to normal snapshotting</span>
						<span class="s4">const </span><span class="s1">process </span><span class="s3">= (</span><span class="s1">set</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">) =&gt; {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">set</span><span class="s3">.</span><span class="s1">size </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
							<span class="s4">const </span><span class="s1">captured </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
							<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">file of set</span><span class="s3">) {</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">file</span><span class="s3">.</span><span class="s1">startsWith</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) </span><span class="s1">captured</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">file</span><span class="s3">);</span>
							<span class="s3">}</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">captured</span><span class="s3">.</span><span class="s1">size </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) </span><span class="s1">fn</span><span class="s3">(</span><span class="s1">captured</span><span class="s3">);</span>
						<span class="s3">};</span>
						<span class="s1">process</span><span class="s3">(</span><span class="s1">managedFiles</span><span class="s3">, </span><span class="s1">processCapturedFiles</span><span class="s3">);</span>
						<span class="s1">process</span><span class="s3">(</span><span class="s1">managedContexts</span><span class="s3">, </span><span class="s1">processCapturedDirectories</span><span class="s3">);</span>
						<span class="s1">process</span><span class="s3">(</span><span class="s1">managedMissing</span><span class="s3">, </span><span class="s1">processCapturedMissing</span><span class="s3">);</span>
						<span class="s1">jobDone</span><span class="s3">();</span>
					<span class="s3">}</span>
				<span class="s3">});</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
		<span class="s1">jobDone</span><span class="s3">();</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Snapshot} snapshot1 a snapshot</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Snapshot} snapshot2 a snapshot</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{Snapshot} merged snapshot</span>
	 <span class="s5">*/</span>
	<span class="s1">mergeSnapshots</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">snapshot </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Snapshot</span><span class="s3">();</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasStartTime</span><span class="s3">() &amp;&amp; </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasStartTime</span><span class="s3">())</span>
			<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setStartTime</span><span class="s3">(</span><span class="s1">Math</span><span class="s3">.</span><span class="s1">min</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">startTime</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">startTime</span><span class="s3">));</span>
		<span class="s4">else if </span><span class="s3">(</span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasStartTime</span><span class="s3">()) </span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">startTime </span><span class="s3">= </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">startTime</span><span class="s3">;</span>
		<span class="s4">else if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasStartTime</span><span class="s3">()) </span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">startTime </span><span class="s3">= </span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">startTime</span><span class="s3">;</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasFileTimestamps</span><span class="s3">() || </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasFileTimestamps</span><span class="s3">()) {</span>
			<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setFileTimestamps</span><span class="s3">(</span>
				<span class="s1">mergeMaps</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">fileTimestamps</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">fileTimestamps</span><span class="s3">)</span>
			<span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasFileHashes</span><span class="s3">() || </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasFileHashes</span><span class="s3">()) {</span>
			<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setFileHashes</span><span class="s3">(</span>
				<span class="s1">mergeMaps</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">fileHashes</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">fileHashes</span><span class="s3">)</span>
			<span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasFileTshs</span><span class="s3">() || </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasFileTshs</span><span class="s3">()) {</span>
			<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setFileTshs</span><span class="s3">(</span><span class="s1">mergeMaps</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">fileTshs</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">fileTshs</span><span class="s3">));</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasContextTimestamps</span><span class="s3">() || </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasContextTimestamps</span><span class="s3">()) {</span>
			<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setContextTimestamps</span><span class="s3">(</span>
				<span class="s1">mergeMaps</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">contextTimestamps</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">contextTimestamps</span><span class="s3">)</span>
			<span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasContextHashes</span><span class="s3">() || </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasContextHashes</span><span class="s3">()) {</span>
			<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setContextHashes</span><span class="s3">(</span>
				<span class="s1">mergeMaps</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">contextHashes</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">contextHashes</span><span class="s3">)</span>
			<span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasContextTshs</span><span class="s3">() || </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasContextTshs</span><span class="s3">()) {</span>
			<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setContextTshs</span><span class="s3">(</span>
				<span class="s1">mergeMaps</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">contextTshs</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">contextTshs</span><span class="s3">)</span>
			<span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasMissingExistence</span><span class="s3">() || </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasMissingExistence</span><span class="s3">()) {</span>
			<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setMissingExistence</span><span class="s3">(</span>
				<span class="s1">mergeMaps</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">missingExistence</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">missingExistence</span><span class="s3">)</span>
			<span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasManagedItemInfo</span><span class="s3">() || </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasManagedItemInfo</span><span class="s3">()) {</span>
			<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setManagedItemInfo</span><span class="s3">(</span>
				<span class="s1">mergeMaps</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">managedItemInfo</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">managedItemInfo</span><span class="s3">)</span>
			<span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasManagedFiles</span><span class="s3">() || </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasManagedFiles</span><span class="s3">()) {</span>
			<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setManagedFiles</span><span class="s3">(</span>
				<span class="s1">mergeSets</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">managedFiles</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">managedFiles</span><span class="s3">)</span>
			<span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasManagedContexts</span><span class="s3">() || </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasManagedContexts</span><span class="s3">()) {</span>
			<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setManagedContexts</span><span class="s3">(</span>
				<span class="s1">mergeSets</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">managedContexts</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">managedContexts</span><span class="s3">)</span>
			<span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasManagedMissing</span><span class="s3">() || </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasManagedMissing</span><span class="s3">()) {</span>
			<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setManagedMissing</span><span class="s3">(</span>
				<span class="s1">mergeSets</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">managedMissing</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">managedMissing</span><span class="s3">)</span>
			<span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">hasChildren</span><span class="s3">() || </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">hasChildren</span><span class="s3">()) {</span>
			<span class="s1">snapshot</span><span class="s3">.</span><span class="s1">setChildren</span><span class="s3">(</span><span class="s1">mergeSets</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">.</span><span class="s1">children</span><span class="s3">, </span><span class="s1">snapshot2</span><span class="s3">.</span><span class="s1">children</span><span class="s3">));</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_snapshotCache</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">snapshot1</span><span class="s3">) === </span><span class="s4">true </span><span class="s3">&amp;&amp;</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_snapshotCache</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">snapshot2</span><span class="s3">) === </span><span class="s4">true</span>
		<span class="s3">) {</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_snapshotCache</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">return </span><span class="s1">snapshot</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Snapshot} snapshot the snapshot made</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((WebpackError | null)=, boolean=): void} callback callback function</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">checkSnapshotValid</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">cachedResult </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_snapshotCache</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">cachedResult </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedSnapshotsCached</span><span class="s3">++;</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">cachedResult </span><span class="s3">=== </span><span class="s2">&quot;boolean&quot;</span><span class="s3">) {</span>
				<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">cachedResult</span><span class="s3">);</span>
			<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
				<span class="s1">cachedResult</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">callback</span><span class="s3">);</span>
			<span class="s3">}</span>
			<span class="s4">return</span><span class="s3">;</span>
		<span class="s3">}</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedSnapshotsNotCached</span><span class="s3">++;</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_checkSnapshotValidNoCache</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Snapshot} snapshot the snapshot made</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((WebpackError | null)=, boolean=): void} callback callback function</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">_checkSnapshotValidNoCache</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{number | undefined} */</span>
		<span class="s4">let </span><span class="s1">startTime </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">hasStartTime</span><span class="s3">()) {</span>
			<span class="s1">startTime </span><span class="s3">= </span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">startTime</span><span class="s3">;</span>
		<span class="s3">}</span>
		<span class="s4">let </span><span class="s1">jobs </span><span class="s3">= </span><span class="s7">1</span><span class="s3">;</span>
		<span class="s4">const </span><span class="s1">jobDone </span><span class="s3">= () =&gt; {</span>
			<span class="s4">if </span><span class="s3">(--</span><span class="s1">jobs </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) {</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_snapshotCache</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
				<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">};</span>
		<span class="s4">const </span><span class="s1">invalid </span><span class="s3">= () =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">jobs </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) {</span>
				<span class="s0">// large negative number instead of NaN or something else to keep jobs to stay a SMI (v8)</span>
				<span class="s1">jobs </span><span class="s3">= -</span><span class="s7">100000000</span><span class="s3">;</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_snapshotCache</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s4">false</span><span class="s3">);</span>
				<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s4">false</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">};</span>
		<span class="s4">const </span><span class="s1">invalidWithError </span><span class="s3">= (</span><span class="s1">path</span><span class="s3">, </span><span class="s1">err</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_remainingLogs </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) {</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_log</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s2">`error occurred: %s`</span><span class="s3">, </span><span class="s1">err</span><span class="s3">);</span>
			<span class="s3">}</span>
			<span class="s1">invalid</span><span class="s3">();</span>
		<span class="s3">};</span>
		<span class="s5">/**</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path file path</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} current current hash</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} snap snapshot hash</span>
		 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{boolean} true, if ok</span>
		 <span class="s5">*/</span>
		<span class="s4">const </span><span class="s1">checkHash </span><span class="s3">= (</span><span class="s1">path</span><span class="s3">, </span><span class="s1">current</span><span class="s3">, </span><span class="s1">snap</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">current </span><span class="s3">!== </span><span class="s1">snap</span><span class="s3">) {</span>
				<span class="s0">// If hash differ it's invalid</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_remainingLogs </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_log</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s2">`hashes differ (%s != %s)`</span><span class="s3">, </span><span class="s1">current</span><span class="s3">, </span><span class="s1">snap</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">return false</span><span class="s3">;</span>
			<span class="s3">}</span>
			<span class="s4">return true</span><span class="s3">;</span>
		<span class="s3">};</span>
		<span class="s5">/**</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path file path</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{boolean} current current entry</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{boolean} snap entry from snapshot</span>
		 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{boolean} true, if ok</span>
		 <span class="s5">*/</span>
		<span class="s4">const </span><span class="s1">checkExistence </span><span class="s3">= (</span><span class="s1">path</span><span class="s3">, </span><span class="s1">current</span><span class="s3">, </span><span class="s1">snap</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(!</span><span class="s1">current </span><span class="s3">!== !</span><span class="s1">snap</span><span class="s3">) {</span>
				<span class="s0">// If existence of item differs</span>
				<span class="s0">// it's invalid</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_remainingLogs </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) {</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_log</span><span class="s3">(</span>
						<span class="s1">path</span><span class="s3">,</span>
						<span class="s1">current </span><span class="s3">? </span><span class="s2">&quot;it didn't exist before&quot; </span><span class="s3">: </span><span class="s2">&quot;it does no longer exist&quot;</span>
					<span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">return false</span><span class="s3">;</span>
			<span class="s3">}</span>
			<span class="s4">return true</span><span class="s3">;</span>
		<span class="s3">};</span>
		<span class="s5">/**</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path file path</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{FileSystemInfoEntry} current current entry</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{FileSystemInfoEntry} snap entry from snapshot</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{boolean} log log reason</span>
		 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{boolean} true, if ok</span>
		 <span class="s5">*/</span>
		<span class="s4">const </span><span class="s1">checkFile </span><span class="s3">= (</span><span class="s1">path</span><span class="s3">, </span><span class="s1">current</span><span class="s3">, </span><span class="s1">snap</span><span class="s3">, </span><span class="s1">log </span><span class="s3">= </span><span class="s4">true</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">current </span><span class="s3">=== </span><span class="s1">snap</span><span class="s3">) </span><span class="s4">return true</span><span class="s3">;</span>
			<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkExistence</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">Boolean</span><span class="s3">(</span><span class="s1">current</span><span class="s3">), </span><span class="s1">Boolean</span><span class="s3">(</span><span class="s1">snap</span><span class="s3">))) </span><span class="s4">return false</span><span class="s3">;</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">current</span><span class="s3">) {</span>
				<span class="s0">// For existing items only</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">startTime </span><span class="s3">=== </span><span class="s2">&quot;number&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">current</span><span class="s3">.</span><span class="s1">safeTime </span><span class="s3">&gt; </span><span class="s1">startTime</span><span class="s3">) {</span>
					<span class="s0">// If a change happened after starting reading the item</span>
					<span class="s0">// this may no longer be valid</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">log </span><span class="s3">&amp;&amp; </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_remainingLogs </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) {</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">_log</span><span class="s3">(</span>
							<span class="s1">path</span><span class="s3">,</span>
							<span class="s2">`it may have changed (%d) after the start time of the snapshot (%d)`</span><span class="s3">,</span>
							<span class="s1">current</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">,</span>
							<span class="s1">startTime</span>
						<span class="s3">);</span>
					<span class="s3">}</span>
					<span class="s4">return false</span><span class="s3">;</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span>
					<span class="s1">snap</span><span class="s3">.</span><span class="s1">timestamp </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
					<span class="s1">current</span><span class="s3">.</span><span class="s1">timestamp </span><span class="s3">!== </span><span class="s1">snap</span><span class="s3">.</span><span class="s1">timestamp</span>
				<span class="s3">) {</span>
					<span class="s0">// If we have a timestamp (it was a file or symlink) and it differs from current timestamp</span>
					<span class="s0">// it's invalid</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">log </span><span class="s3">&amp;&amp; </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_remainingLogs </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) {</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">_log</span><span class="s3">(</span>
							<span class="s1">path</span><span class="s3">,</span>
							<span class="s2">`timestamps differ (%d != %d)`</span><span class="s3">,</span>
							<span class="s1">current</span><span class="s3">.</span><span class="s1">timestamp</span><span class="s3">,</span>
							<span class="s1">snap</span><span class="s3">.</span><span class="s1">timestamp</span>
						<span class="s3">);</span>
					<span class="s3">}</span>
					<span class="s4">return false</span><span class="s3">;</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
			<span class="s4">return true</span><span class="s3">;</span>
		<span class="s3">};</span>
		<span class="s5">/**</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path file path</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ResolvedContextFileSystemInfoEntry} current current entry</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ResolvedContextFileSystemInfoEntry} snap entry from snapshot</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{boolean} log log reason</span>
		 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{boolean} true, if ok</span>
		 <span class="s5">*/</span>
		<span class="s4">const </span><span class="s1">checkContext </span><span class="s3">= (</span><span class="s1">path</span><span class="s3">, </span><span class="s1">current</span><span class="s3">, </span><span class="s1">snap</span><span class="s3">, </span><span class="s1">log </span><span class="s3">= </span><span class="s4">true</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">current </span><span class="s3">=== </span><span class="s1">snap</span><span class="s3">) </span><span class="s4">return true</span><span class="s3">;</span>
			<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkExistence</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">Boolean</span><span class="s3">(</span><span class="s1">current</span><span class="s3">), </span><span class="s1">Boolean</span><span class="s3">(</span><span class="s1">snap</span><span class="s3">))) </span><span class="s4">return false</span><span class="s3">;</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">current</span><span class="s3">) {</span>
				<span class="s0">// For existing items only</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">startTime </span><span class="s3">=== </span><span class="s2">&quot;number&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">current</span><span class="s3">.</span><span class="s1">safeTime </span><span class="s3">&gt; </span><span class="s1">startTime</span><span class="s3">) {</span>
					<span class="s0">// If a change happened after starting reading the item</span>
					<span class="s0">// this may no longer be valid</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">log </span><span class="s3">&amp;&amp; </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_remainingLogs </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) {</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">_log</span><span class="s3">(</span>
							<span class="s1">path</span><span class="s3">,</span>
							<span class="s2">`it may have changed (%d) after the start time of the snapshot (%d)`</span><span class="s3">,</span>
							<span class="s1">current</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">,</span>
							<span class="s1">startTime</span>
						<span class="s3">);</span>
					<span class="s3">}</span>
					<span class="s4">return false</span><span class="s3">;</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span>
					<span class="s1">snap</span><span class="s3">.</span><span class="s1">timestampHash </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
					<span class="s1">current</span><span class="s3">.</span><span class="s1">timestampHash </span><span class="s3">!== </span><span class="s1">snap</span><span class="s3">.</span><span class="s1">timestampHash</span>
				<span class="s3">) {</span>
					<span class="s0">// If we have a timestampHash (it was a directory) and it differs from current timestampHash</span>
					<span class="s0">// it's invalid</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">log </span><span class="s3">&amp;&amp; </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_remainingLogs </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) {</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">_log</span><span class="s3">(</span>
							<span class="s1">path</span><span class="s3">,</span>
							<span class="s2">`timestamps hashes differ (%s != %s)`</span><span class="s3">,</span>
							<span class="s1">current</span><span class="s3">.</span><span class="s1">timestampHash</span><span class="s3">,</span>
							<span class="s1">snap</span><span class="s3">.</span><span class="s1">timestampHash</span>
						<span class="s3">);</span>
					<span class="s3">}</span>
					<span class="s4">return false</span><span class="s3">;</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
			<span class="s4">return true</span><span class="s3">;</span>
		<span class="s3">};</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">hasChildren</span><span class="s3">()) {</span>
			<span class="s4">const </span><span class="s1">childCallback </span><span class="s3">= (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">result</span><span class="s3">) =&gt; {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err </span><span class="s3">|| !</span><span class="s1">result</span><span class="s3">) </span><span class="s4">return </span><span class="s1">invalid</span><span class="s3">();</span>
				<span class="s4">else </span><span class="s1">jobDone</span><span class="s3">();</span>
			<span class="s3">};</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">child of snapshot</span><span class="s3">.</span><span class="s1">children</span><span class="s3">) {</span>
				<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_snapshotCache</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">child</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedChildrenCached</span><span class="s3">++;</span>
					<span class="s0">/* istanbul ignore else */</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">cache </span><span class="s3">=== </span><span class="s2">&quot;boolean&quot;</span><span class="s3">) {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">=== </span><span class="s4">false</span><span class="s3">) {</span>
							<span class="s1">invalid</span><span class="s3">();</span>
							<span class="s4">return</span><span class="s3">;</span>
						<span class="s3">}</span>
					<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
						<span class="s1">jobs</span><span class="s3">++;</span>
						<span class="s1">cache</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">childCallback</span><span class="s3">);</span>
					<span class="s3">}</span>
				<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedChildrenNotCached</span><span class="s3">++;</span>
					<span class="s1">jobs</span><span class="s3">++;</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_checkSnapshotValidNoCache</span><span class="s3">(</span><span class="s1">child</span><span class="s3">, </span><span class="s1">childCallback</span><span class="s3">);</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">hasFileTimestamps</span><span class="s3">()) {</span>
			<span class="s4">const </span><span class="s3">{ </span><span class="s1">fileTimestamps </span><span class="s3">} = </span><span class="s1">snapshot</span><span class="s3">;</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedEntries </span><span class="s3">+= </span><span class="s1">fileTimestamps</span><span class="s3">.</span><span class="s1">size</span><span class="s3">;</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s3">[</span><span class="s1">path</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">] </span><span class="s1">of fileTimestamps</span><span class="s3">) {</span>
				<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s2">&quot;ignore&quot; </span><span class="s3">&amp;&amp; !</span><span class="s1">checkFile</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">cache</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">)) {</span>
						<span class="s1">invalid</span><span class="s3">();</span>
						<span class="s4">return</span><span class="s3">;</span>
					<span class="s3">}</span>
				<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
					<span class="s1">jobs</span><span class="s3">++;</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">fileTimestampQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">invalidWithError</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">err</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkFile</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">)) {</span>
							<span class="s1">invalid</span><span class="s3">();</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">jobDone</span><span class="s3">();</span>
						<span class="s3">}</span>
					<span class="s3">});</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
		<span class="s5">/**</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} path file path</span>
		 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} hash hash</span>
		 <span class="s5">*/</span>
		<span class="s4">const </span><span class="s1">processFileHashSnapshot </span><span class="s3">= (</span><span class="s1">path</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">) =&gt; {</span>
			<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashes</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s2">&quot;ignore&quot; </span><span class="s3">&amp;&amp; !</span><span class="s1">checkHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">cache</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">)) {</span>
					<span class="s1">invalid</span><span class="s3">();</span>
					<span class="s4">return</span><span class="s3">;</span>
				<span class="s3">}</span>
			<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
				<span class="s1">jobs</span><span class="s3">++;</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">fileHashQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">invalidWithError</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">err</span><span class="s3">);</span>
					<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">)) {</span>
						<span class="s1">invalid</span><span class="s3">();</span>
					<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
						<span class="s1">jobDone</span><span class="s3">();</span>
					<span class="s3">}</span>
				<span class="s3">});</span>
			<span class="s3">}</span>
		<span class="s3">};</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">hasFileHashes</span><span class="s3">()) {</span>
			<span class="s4">const </span><span class="s3">{ </span><span class="s1">fileHashes </span><span class="s3">} = </span><span class="s1">snapshot</span><span class="s3">;</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedEntries </span><span class="s3">+= </span><span class="s1">fileHashes</span><span class="s3">.</span><span class="s1">size</span><span class="s3">;</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s3">[</span><span class="s1">path</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">] </span><span class="s1">of fileHashes</span><span class="s3">) {</span>
				<span class="s1">processFileHashSnapshot</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">hasFileTshs</span><span class="s3">()) {</span>
			<span class="s4">const </span><span class="s3">{ </span><span class="s1">fileTshs </span><span class="s3">} = </span><span class="s1">snapshot</span><span class="s3">;</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedEntries </span><span class="s3">+= </span><span class="s1">fileTshs</span><span class="s3">.</span><span class="s1">size</span><span class="s3">;</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s3">[</span><span class="s1">path</span><span class="s3">, </span><span class="s1">tsh</span><span class="s3">] </span><span class="s1">of fileTshs</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">tsh </span><span class="s3">=== </span><span class="s2">&quot;string&quot;</span><span class="s3">) {</span>
					<span class="s1">processFileHashSnapshot</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">tsh</span><span class="s3">);</span>
				<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
					<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">=== </span><span class="s2">&quot;ignore&quot; </span><span class="s3">|| !</span><span class="s1">checkFile</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">cache</span><span class="s3">, </span><span class="s1">tsh</span><span class="s3">, </span><span class="s4">false</span><span class="s3">)) {</span>
							<span class="s1">processFileHashSnapshot</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">tsh </span><span class="s3">&amp;&amp; </span><span class="s1">tsh</span><span class="s3">.</span><span class="s1">hash</span><span class="s3">);</span>
						<span class="s3">}</span>
					<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
						<span class="s1">jobs</span><span class="s3">++;</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">fileTimestampQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">invalidWithError</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">err</span><span class="s3">);</span>
							<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkFile</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">, </span><span class="s1">tsh</span><span class="s3">, </span><span class="s4">false</span><span class="s3">)) {</span>
								<span class="s1">processFileHashSnapshot</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">tsh </span><span class="s3">&amp;&amp; </span><span class="s1">tsh</span><span class="s3">.</span><span class="s1">hash</span><span class="s3">);</span>
							<span class="s3">}</span>
							<span class="s1">jobDone</span><span class="s3">();</span>
						<span class="s3">});</span>
					<span class="s3">}</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">hasContextTimestamps</span><span class="s3">()) {</span>
			<span class="s4">const </span><span class="s3">{ </span><span class="s1">contextTimestamps </span><span class="s3">} = </span><span class="s1">snapshot</span><span class="s3">;</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedEntries </span><span class="s3">+= </span><span class="s1">contextTimestamps</span><span class="s3">.</span><span class="s1">size</span><span class="s3">;</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s3">[</span><span class="s1">path</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">] </span><span class="s1">of contextTimestamps</span><span class="s3">) {</span>
				<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">=== </span><span class="s2">&quot;ignore&quot;</span><span class="s3">) </span><span class="s4">continue</span><span class="s3">;</span>
				<span class="s4">let </span><span class="s1">resolved</span><span class="s3">;</span>
				<span class="s4">if </span><span class="s3">(</span>
					<span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
					<span class="s3">(</span><span class="s1">resolved </span><span class="s3">= </span><span class="s1">getResolvedTimestamp</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">)) !== </span><span class="s1">undefined</span>
				<span class="s3">) {</span>
					<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkContext</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">resolved</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">)) {</span>
						<span class="s1">invalid</span><span class="s3">();</span>
						<span class="s4">return</span><span class="s3">;</span>
					<span class="s3">}</span>
				<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
					<span class="s1">jobs</span><span class="s3">++;</span>
					<span class="s5">/**</span>
					 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Error=} err error</span>
					 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ResolvedContextFileSystemInfoEntry=} entry entry</span>
					 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
					 <span class="s5">*/</span>
					<span class="s4">const </span><span class="s1">callback </span><span class="s3">= (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">invalidWithError</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">err</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkContext</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">)) {</span>
							<span class="s1">invalid</span><span class="s3">();</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">jobDone</span><span class="s3">();</span>
						<span class="s3">}</span>
					<span class="s3">};</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">_resolveContextTimestamp</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
					<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">getContextTimestamp</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
					<span class="s3">}</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
		<span class="s4">const </span><span class="s1">processContextHashSnapshot </span><span class="s3">= (</span><span class="s1">path</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">) =&gt; {</span>
			<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextHashes</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
			<span class="s4">let </span><span class="s1">resolved</span><span class="s3">;</span>
			<span class="s4">if </span><span class="s3">(</span>
				<span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
				<span class="s3">(</span><span class="s1">resolved </span><span class="s3">= </span><span class="s1">getResolvedHash</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">)) !== </span><span class="s1">undefined</span>
			<span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">resolved</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">)) {</span>
					<span class="s1">invalid</span><span class="s3">();</span>
					<span class="s4">return</span><span class="s3">;</span>
				<span class="s3">}</span>
			<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
				<span class="s1">jobs</span><span class="s3">++;</span>
				<span class="s4">const </span><span class="s1">callback </span><span class="s3">= (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">invalidWithError</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">err</span><span class="s3">);</span>
					<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">)) {</span>
						<span class="s1">invalid</span><span class="s3">();</span>
					<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
						<span class="s1">jobDone</span><span class="s3">();</span>
					<span class="s3">}</span>
				<span class="s3">};</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_resolveContextHash</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
				<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">getContextHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
		<span class="s3">};</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">hasContextHashes</span><span class="s3">()) {</span>
			<span class="s4">const </span><span class="s3">{ </span><span class="s1">contextHashes </span><span class="s3">} = </span><span class="s1">snapshot</span><span class="s3">;</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedEntries </span><span class="s3">+= </span><span class="s1">contextHashes</span><span class="s3">.</span><span class="s1">size</span><span class="s3">;</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s3">[</span><span class="s1">path</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">] </span><span class="s1">of contextHashes</span><span class="s3">) {</span>
				<span class="s1">processContextHashSnapshot</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">hasContextTshs</span><span class="s3">()) {</span>
			<span class="s4">const </span><span class="s3">{ </span><span class="s1">contextTshs </span><span class="s3">} = </span><span class="s1">snapshot</span><span class="s3">;</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedEntries </span><span class="s3">+= </span><span class="s1">contextTshs</span><span class="s3">.</span><span class="s1">size</span><span class="s3">;</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s3">[</span><span class="s1">path</span><span class="s3">, </span><span class="s1">tsh</span><span class="s3">] </span><span class="s1">of contextTshs</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">tsh </span><span class="s3">=== </span><span class="s2">&quot;string&quot;</span><span class="s3">) {</span>
					<span class="s1">processContextHashSnapshot</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">tsh</span><span class="s3">);</span>
				<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
					<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">=== </span><span class="s2">&quot;ignore&quot;</span><span class="s3">) </span><span class="s4">continue</span><span class="s3">;</span>
					<span class="s4">let </span><span class="s1">resolved</span><span class="s3">;</span>
					<span class="s4">if </span><span class="s3">(</span>
						<span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
						<span class="s3">(</span><span class="s1">resolved </span><span class="s3">= </span><span class="s1">getResolvedTimestamp</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">)) !== </span><span class="s1">undefined</span>
					<span class="s3">) {</span>
						<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkContext</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">resolved</span><span class="s3">, </span><span class="s1">tsh</span><span class="s3">, </span><span class="s4">false</span><span class="s3">)) {</span>
							<span class="s1">processContextHashSnapshot</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">tsh </span><span class="s3">&amp;&amp; </span><span class="s1">tsh</span><span class="s3">.</span><span class="s1">hash</span><span class="s3">);</span>
						<span class="s3">}</span>
					<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
						<span class="s1">jobs</span><span class="s3">++;</span>
						<span class="s5">/**</span>
						 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Error=} err error</span>
						 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ResolvedContextFileSystemInfoEntry=} entry entry</span>
						 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
						 <span class="s5">*/</span>
						<span class="s4">const </span><span class="s1">callback </span><span class="s3">= (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">invalidWithError</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">err</span><span class="s3">);</span>
							<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkContext</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">, </span><span class="s1">tsh</span><span class="s3">, </span><span class="s4">false</span><span class="s3">)) {</span>
								<span class="s1">processContextHashSnapshot</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">tsh </span><span class="s3">&amp;&amp; </span><span class="s1">tsh</span><span class="s3">.</span><span class="s1">hash</span><span class="s3">);</span>
							<span class="s3">}</span>
							<span class="s1">jobDone</span><span class="s3">();</span>
						<span class="s3">};</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
							<span class="s4">this</span><span class="s3">.</span><span class="s1">_resolveContextTimestamp</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s4">this</span><span class="s3">.</span><span class="s1">getContextTimestamp</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">hasMissingExistence</span><span class="s3">()) {</span>
			<span class="s4">const </span><span class="s3">{ </span><span class="s1">missingExistence </span><span class="s3">} = </span><span class="s1">snapshot</span><span class="s3">;</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedEntries </span><span class="s3">+= </span><span class="s1">missingExistence</span><span class="s3">.</span><span class="s1">size</span><span class="s3">;</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s3">[</span><span class="s1">path</span><span class="s3">, </span><span class="s1">existence</span><span class="s3">] </span><span class="s1">of missingExistence</span><span class="s3">) {</span>
				<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
					<span class="s4">if </span><span class="s3">(</span>
						<span class="s1">cache </span><span class="s3">!== </span><span class="s2">&quot;ignore&quot; </span><span class="s3">&amp;&amp;</span>
						<span class="s3">!</span><span class="s1">checkExistence</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">Boolean</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">), </span><span class="s1">Boolean</span><span class="s3">(</span><span class="s1">existence</span><span class="s3">))</span>
					<span class="s3">) {</span>
						<span class="s1">invalid</span><span class="s3">();</span>
						<span class="s4">return</span><span class="s3">;</span>
					<span class="s3">}</span>
				<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
					<span class="s1">jobs</span><span class="s3">++;</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">fileTimestampQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">invalidWithError</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">err</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkExistence</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">Boolean</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">), </span><span class="s1">Boolean</span><span class="s3">(</span><span class="s1">existence</span><span class="s3">))) {</span>
							<span class="s1">invalid</span><span class="s3">();</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">jobDone</span><span class="s3">();</span>
						<span class="s3">}</span>
					<span class="s3">});</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">.</span><span class="s1">hasManagedItemInfo</span><span class="s3">()) {</span>
			<span class="s4">const </span><span class="s3">{ </span><span class="s1">managedItemInfo </span><span class="s3">} = </span><span class="s1">snapshot</span><span class="s3">;</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_statTestedEntries </span><span class="s3">+= </span><span class="s1">managedItemInfo</span><span class="s3">.</span><span class="s1">size</span><span class="s3">;</span>
			<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s3">[</span><span class="s1">path</span><span class="s3">, </span><span class="s1">info</span><span class="s3">] </span><span class="s1">of managedItemInfo</span><span class="s3">) {</span>
				<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItems</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
					<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">cache</span><span class="s3">, </span><span class="s1">info</span><span class="s3">)) {</span>
						<span class="s1">invalid</span><span class="s3">();</span>
						<span class="s4">return</span><span class="s3">;</span>
					<span class="s3">}</span>
				<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
					<span class="s1">jobs</span><span class="s3">++;</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">managedItemQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">invalidWithError</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">err</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(!</span><span class="s1">checkHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">, </span><span class="s1">info</span><span class="s3">)) {</span>
							<span class="s1">invalid</span><span class="s3">();</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">jobDone</span><span class="s3">();</span>
						<span class="s3">}</span>
					<span class="s3">});</span>
				<span class="s3">}</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
		<span class="s1">jobDone</span><span class="s3">();</span>

		<span class="s0">// if there was an async action</span>
		<span class="s0">// try to join multiple concurrent request for this snapshot</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">jobs </span><span class="s3">&gt; </span><span class="s7">0</span><span class="s3">) {</span>
			<span class="s4">const </span><span class="s1">callbacks </span><span class="s3">= [</span><span class="s1">callback</span><span class="s3">];</span>
			<span class="s1">callback </span><span class="s3">= (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">result</span><span class="s3">) =&gt; {</span>
				<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">callback of callbacks</span><span class="s3">) </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
			<span class="s3">};</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_snapshotCache</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">snapshot</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s1">_readFileTimestamp</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">.</span><span class="s1">stat</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">stat</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">=== </span><span class="s2">&quot;ENOENT&quot;</span><span class="s3">) {</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s4">null</span><span class="s3">);</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedFileTimestamps </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s4">null</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
			<span class="s3">}</span>

			<span class="s4">let </span><span class="s1">ts</span><span class="s3">;</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">stat</span><span class="s3">.</span><span class="s1">isDirectory</span><span class="s3">()) {</span>
				<span class="s1">ts </span><span class="s3">= {</span>
					<span class="s1">safeTime</span><span class="s3">: </span><span class="s7">0</span><span class="s3">,</span>
					<span class="s1">timestamp</span><span class="s3">: </span><span class="s1">undefined</span>
				<span class="s3">};</span>
			<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
				<span class="s4">const </span><span class="s1">mtime </span><span class="s3">= +</span><span class="s1">stat</span><span class="s3">.</span><span class="s1">mtime</span><span class="s3">;</span>

				<span class="s4">if </span><span class="s3">(</span><span class="s1">mtime</span><span class="s3">) </span><span class="s1">applyMtime</span><span class="s3">(</span><span class="s1">mtime</span><span class="s3">);</span>

				<span class="s1">ts </span><span class="s3">= {</span>
					<span class="s1">safeTime</span><span class="s3">: </span><span class="s1">mtime </span><span class="s3">? </span><span class="s1">mtime </span><span class="s3">+ </span><span class="s1">FS_ACCURACY </span><span class="s3">: </span><span class="s1">Infinity</span><span class="s3">,</span>
					<span class="s1">timestamp</span><span class="s3">: </span><span class="s1">mtime</span>
				<span class="s3">};</span>
			<span class="s3">}</span>

			<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">);</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedFileTimestamps </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>

			<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">);</span>
		<span class="s3">});</span>
	<span class="s3">}</span>

	<span class="s1">_readFileHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">.</span><span class="s1">readFile</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">content</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">=== </span><span class="s2">&quot;EISDIR&quot;</span><span class="s3">) {</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashes</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;directory&quot;</span><span class="s3">);</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s2">&quot;directory&quot;</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">=== </span><span class="s2">&quot;ENOENT&quot;</span><span class="s3">) {</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashes</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s4">null</span><span class="s3">);</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s4">null</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">=== </span><span class="s2">&quot;ERR_FS_FILE_TOO_LARGE&quot;</span><span class="s3">) {</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span><span class="s2">`Ignoring </span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">} </span><span class="s2">for hashing as it's very large`</span><span class="s3">);</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashes</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;too large&quot;</span><span class="s3">);</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s2">&quot;too large&quot;</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
			<span class="s3">}</span>

			<span class="s4">const </span><span class="s1">hash </span><span class="s3">= </span><span class="s1">createHash</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_hashFunction</span><span class="s3">);</span>

			<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string | Buffer} */ </span><span class="s3">(</span><span class="s1">content</span><span class="s3">));</span>

			<span class="s4">const </span><span class="s1">digest </span><span class="s3">= </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string} */ </span><span class="s3">(</span><span class="s1">hash</span><span class="s3">.</span><span class="s1">digest</span><span class="s3">(</span><span class="s2">&quot;hex&quot;</span><span class="s3">));</span>

			<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashes</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">digest</span><span class="s3">);</span>

			<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">digest</span><span class="s3">);</span>
		<span class="s3">});</span>
	<span class="s3">}</span>

	<span class="s1">_getFileTimestampAndHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">continueWithHash </span><span class="s3">= </span><span class="s1">hash </span><span class="s3">=&gt; {</span>
			<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s2">&quot;ignore&quot;</span><span class="s3">) {</span>
					<span class="s4">const </span><span class="s1">result </span><span class="s3">= {</span>
						<span class="s1">...cache</span><span class="s3">,</span>
						<span class="s1">hash</span>
					<span class="s3">};</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTshs</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
				<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTshs</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">);</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">);</span>
				<span class="s3">}</span>
			<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">fileTimestampQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
						<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
					<span class="s3">}</span>
					<span class="s4">const </span><span class="s1">result </span><span class="s3">= {</span>
						<span class="s1">...entry</span><span class="s3">,</span>
						<span class="s1">hash</span>
					<span class="s3">};</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTshs</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
				<span class="s3">});</span>
			<span class="s3">}</span>
		<span class="s3">};</span>

		<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileHashes</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
			<span class="s1">continueWithHash</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">);</span>
		<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">fileHashQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s1">continueWithHash</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">);</span>
			<span class="s3">});</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@template </span><span class="s5">T</span>
	 <span class="s5">* </span><span class="s6">@template </span><span class="s5">ItemType</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Object} options options</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} options.path path</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function(string): ItemType} options.fromImmutablePath called when context item is an immutable path</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function(string): ItemType} options.fromManagedItem called when context item is a managed path</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function(string, string, function(Error=, ItemType=): void): void} options.fromSymlink called when context item is a symlink</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function(string, IStats, function(Error=, ItemType=): void): void} options.fromFile called when context item is a file</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function(string, IStats, function(Error=, ItemType=): void): void} options.fromDirectory called when context item is a directory</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function(string[], ItemType[]): T} options.reduce called from all context items</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((Error | null)=, (T | null)=): void} callback callback</span>
	 <span class="s5">*/</span>
	<span class="s1">_readContext</span><span class="s3">(</span>
		<span class="s3">{</span>
			<span class="s1">path</span><span class="s3">,</span>
			<span class="s1">fromImmutablePath</span><span class="s3">,</span>
			<span class="s1">fromManagedItem</span><span class="s3">,</span>
			<span class="s1">fromSymlink</span><span class="s3">,</span>
			<span class="s1">fromFile</span><span class="s3">,</span>
			<span class="s1">fromDirectory</span><span class="s3">,</span>
			<span class="s1">reduce</span>
		<span class="s3">},</span>
		<span class="s1">callback</span>
	<span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">.</span><span class="s1">readdir</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">_files</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">=== </span><span class="s2">&quot;ENOENT&quot;</span><span class="s3">) {</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s4">null</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
			<span class="s3">}</span>
			<span class="s4">const </span><span class="s1">files </span><span class="s3">= </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string[]} */ </span><span class="s3">(</span><span class="s1">_files</span><span class="s3">)</span>
				<span class="s3">.</span><span class="s1">map</span><span class="s3">(</span><span class="s1">file </span><span class="s3">=&gt; </span><span class="s1">file</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s2">&quot;NFC&quot;</span><span class="s3">))</span>
				<span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">file </span><span class="s3">=&gt; !</span><span class="s8">/^\./</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">file</span><span class="s3">))</span>
				<span class="s3">.</span><span class="s1">sort</span><span class="s3">();</span>
			<span class="s1">asyncLib</span><span class="s3">.</span><span class="s1">map</span><span class="s3">(</span>
				<span class="s1">files</span><span class="s3">,</span>
				<span class="s3">(</span><span class="s1">file</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
					<span class="s4">const </span><span class="s1">child </span><span class="s3">= </span><span class="s1">join</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, </span><span class="s1">file</span><span class="s3">);</span>
					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">immutablePath of </span><span class="s4">this</span><span class="s3">.</span><span class="s1">immutablePathsRegExps</span><span class="s3">) {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">immutablePath</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) {</span>
							<span class="s0">// ignore any immutable path for timestamping</span>
							<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">fromImmutablePath</span><span class="s3">(</span><span class="s1">path</span><span class="s3">));</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">immutablePath of </span><span class="s4">this</span><span class="s3">.</span><span class="s1">immutablePathsWithSlash</span><span class="s3">) {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">path</span><span class="s3">.</span><span class="s1">startsWith</span><span class="s3">(</span><span class="s1">immutablePath</span><span class="s3">)) {</span>
							<span class="s0">// ignore any immutable path for timestamping</span>
							<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">fromImmutablePath</span><span class="s3">(</span><span class="s1">path</span><span class="s3">));</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">managedPath of </span><span class="s4">this</span><span class="s3">.</span><span class="s1">managedPathsRegExps</span><span class="s3">) {</span>
						<span class="s4">const </span><span class="s1">match </span><span class="s3">= </span><span class="s1">managedPath</span><span class="s3">.</span><span class="s1">exec</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">match</span><span class="s3">) {</span>
							<span class="s4">const </span><span class="s1">managedItem </span><span class="s3">= </span><span class="s1">getManagedItem</span><span class="s3">(</span><span class="s1">match</span><span class="s3">[</span><span class="s7">1</span><span class="s3">], </span><span class="s1">path</span><span class="s3">);</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">managedItem</span><span class="s3">) {</span>
								<span class="s0">// construct timestampHash from managed info</span>
								<span class="s4">return this</span><span class="s3">.</span><span class="s1">managedItemQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">managedItem</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">info</span><span class="s3">) =&gt; {</span>
									<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
									<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">fromManagedItem</span><span class="s3">(</span><span class="s1">info</span><span class="s3">));</span>
								<span class="s3">});</span>
							<span class="s3">}</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">managedPath of </span><span class="s4">this</span><span class="s3">.</span><span class="s1">managedPathsWithSlash</span><span class="s3">) {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">path</span><span class="s3">.</span><span class="s1">startsWith</span><span class="s3">(</span><span class="s1">managedPath</span><span class="s3">)) {</span>
							<span class="s4">const </span><span class="s1">managedItem </span><span class="s3">= </span><span class="s1">getManagedItem</span><span class="s3">(</span><span class="s1">managedPath</span><span class="s3">, </span><span class="s1">child</span><span class="s3">);</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">managedItem</span><span class="s3">) {</span>
								<span class="s0">// construct timestampHash from managed info</span>
								<span class="s4">return this</span><span class="s3">.</span><span class="s1">managedItemQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">managedItem</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">info</span><span class="s3">) =&gt; {</span>
									<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
									<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">fromManagedItem</span><span class="s3">(</span><span class="s1">info</span><span class="s3">));</span>
								<span class="s3">});</span>
							<span class="s3">}</span>
						<span class="s3">}</span>
					<span class="s3">}</span>

					<span class="s1">lstatReadlinkAbsolute</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">child</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">stat</span><span class="s3">) =&gt; {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>

						<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">stat </span><span class="s3">=== </span><span class="s2">&quot;string&quot;</span><span class="s3">) {</span>
							<span class="s4">return </span><span class="s1">fromSymlink</span><span class="s3">(</span><span class="s1">child</span><span class="s3">, </span><span class="s1">stat</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
						<span class="s3">}</span>

						<span class="s4">if </span><span class="s3">(</span><span class="s1">stat</span><span class="s3">.</span><span class="s1">isFile</span><span class="s3">()) {</span>
							<span class="s4">return </span><span class="s1">fromFile</span><span class="s3">(</span><span class="s1">child</span><span class="s3">, </span><span class="s1">stat</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
						<span class="s3">}</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">stat</span><span class="s3">.</span><span class="s1">isDirectory</span><span class="s3">()) {</span>
							<span class="s4">return </span><span class="s1">fromDirectory</span><span class="s3">(</span><span class="s1">child</span><span class="s3">, </span><span class="s1">stat</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
						<span class="s3">}</span>
						<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s4">null</span><span class="s3">);</span>
					<span class="s3">});</span>
				<span class="s3">},</span>
				<span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">results</span><span class="s3">) =&gt; {</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
					<span class="s4">const </span><span class="s1">result </span><span class="s3">= </span><span class="s1">reduce</span><span class="s3">(</span><span class="s1">files</span><span class="s3">, </span><span class="s1">results</span><span class="s3">);</span>
					<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
				<span class="s3">}</span>
			<span class="s3">);</span>
		<span class="s3">});</span>
	<span class="s3">}</span>

	<span class="s1">_readContextTimestamp</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_readContext</span><span class="s3">(</span>
			<span class="s3">{</span>
				<span class="s1">path</span><span class="s3">,</span>
				<span class="s1">fromImmutablePath</span><span class="s3">: () =&gt; </span><span class="s4">null</span><span class="s3">,</span>
				<span class="s1">fromManagedItem</span><span class="s3">: </span><span class="s1">info </span><span class="s3">=&gt; ({</span>
					<span class="s1">safeTime</span><span class="s3">: </span><span class="s7">0</span><span class="s3">,</span>
					<span class="s1">timestampHash</span><span class="s3">: </span><span class="s1">info</span>
				<span class="s3">}),</span>
				<span class="s1">fromSymlink</span><span class="s3">: (</span><span class="s1">file</span><span class="s3">, </span><span class="s1">target</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
					<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, {</span>
						<span class="s1">timestampHash</span><span class="s3">: </span><span class="s1">target</span><span class="s3">,</span>
						<span class="s1">symlinks</span><span class="s3">: </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">([</span><span class="s1">target</span><span class="s3">])</span>
					<span class="s3">});</span>
				<span class="s3">},</span>
				<span class="s1">fromFile</span><span class="s3">: (</span><span class="s1">file</span><span class="s3">, </span><span class="s1">stat</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
					<span class="s0">// Prefer the cached value over our new stat to report consistent results</span>
					<span class="s4">const </span><span class="s1">cache </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">file</span><span class="s3">);</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">cache </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">)</span>
						<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">cache </span><span class="s3">=== </span><span class="s2">&quot;ignore&quot; </span><span class="s3">? </span><span class="s4">null </span><span class="s3">: </span><span class="s1">cache</span><span class="s3">);</span>

					<span class="s4">const </span><span class="s1">mtime </span><span class="s3">= +</span><span class="s1">stat</span><span class="s3">.</span><span class="s1">mtime</span><span class="s3">;</span>

					<span class="s4">if </span><span class="s3">(</span><span class="s1">mtime</span><span class="s3">) </span><span class="s1">applyMtime</span><span class="s3">(</span><span class="s1">mtime</span><span class="s3">);</span>

					<span class="s4">const </span><span class="s1">ts </span><span class="s3">= {</span>
						<span class="s1">safeTime</span><span class="s3">: </span><span class="s1">mtime </span><span class="s3">? </span><span class="s1">mtime </span><span class="s3">+ </span><span class="s1">FS_ACCURACY </span><span class="s3">: </span><span class="s1">Infinity</span><span class="s3">,</span>
						<span class="s1">timestamp</span><span class="s3">: </span><span class="s1">mtime</span>
					<span class="s3">};</span>

					<span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">file</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">);</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedFileTimestamps </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
					<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">);</span>
				<span class="s3">},</span>
				<span class="s1">fromDirectory</span><span class="s3">: (</span><span class="s1">directory</span><span class="s3">, </span><span class="s1">stat</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTimestampQueue</span><span class="s3">.</span><span class="s1">increaseParallelism</span><span class="s3">();</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_getUnresolvedContextTimestamp</span><span class="s3">(</span><span class="s1">directory</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">tsEntry</span><span class="s3">) =&gt; {</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTimestampQueue</span><span class="s3">.</span><span class="s1">decreaseParallelism</span><span class="s3">();</span>
						<span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">tsEntry</span><span class="s3">);</span>
					<span class="s3">});</span>
				<span class="s3">},</span>
				<span class="s1">reduce</span><span class="s3">: (</span><span class="s1">files</span><span class="s3">, </span><span class="s1">tsEntries</span><span class="s3">) =&gt; {</span>
					<span class="s4">let </span><span class="s1">symlinks </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>

					<span class="s4">const </span><span class="s1">hash </span><span class="s3">= </span><span class="s1">createHash</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_hashFunction</span><span class="s3">);</span>

					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">file of files</span><span class="s3">) </span><span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">file</span><span class="s3">);</span>
					<span class="s4">let </span><span class="s1">safeTime </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">entry of tsEntries</span><span class="s3">) {</span>
						<span class="s4">if </span><span class="s3">(!</span><span class="s1">entry</span><span class="s3">) {</span>
							<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s2">&quot;n&quot;</span><span class="s3">);</span>
							<span class="s4">continue</span><span class="s3">;</span>
						<span class="s3">}</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestamp</span><span class="s3">) {</span>
							<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s2">&quot;f&quot;</span><span class="s3">);</span>
							<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s2">`</span><span class="s1">$</span><span class="s3">{</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestamp</span><span class="s3">}</span><span class="s2">`</span><span class="s3">);</span>
						<span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestampHash</span><span class="s3">) {</span>
							<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s2">&quot;d&quot;</span><span class="s3">);</span>
							<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s2">`</span><span class="s1">$</span><span class="s3">{</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestampHash</span><span class="s3">}</span><span class="s2">`</span><span class="s3">);</span>
						<span class="s3">}</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">symlinks </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">symlinks </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s1">symlinks </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
							<span class="s1">addAll</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">symlinks</span><span class="s3">, </span><span class="s1">symlinks</span><span class="s3">);</span>
						<span class="s3">}</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">) {</span>
							<span class="s1">safeTime </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">max</span><span class="s3">(</span><span class="s1">safeTime</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">);</span>
						<span class="s3">}</span>
					<span class="s3">}</span>

					<span class="s4">const </span><span class="s1">digest </span><span class="s3">= </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string} */ </span><span class="s3">(</span><span class="s1">hash</span><span class="s3">.</span><span class="s1">digest</span><span class="s3">(</span><span class="s2">&quot;hex&quot;</span><span class="s3">));</span>

					<span class="s4">const </span><span class="s1">result </span><span class="s3">= {</span>
						<span class="s1">safeTime</span><span class="s3">,</span>
						<span class="s1">timestampHash</span><span class="s3">: </span><span class="s1">digest</span>
					<span class="s3">};</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">symlinks</span><span class="s3">) </span><span class="s1">result</span><span class="s3">.</span><span class="s1">symlinks </span><span class="s3">= </span><span class="s1">symlinks</span><span class="s3">;</span>
					<span class="s4">return </span><span class="s1">result</span><span class="s3">;</span>
				<span class="s3">}</span>
			<span class="s3">},</span>
			<span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">result</span><span class="s3">) =&gt; {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestamps</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedContextTimestamps </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>

				<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ContextFileSystemInfoEntry} entry entry</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((Error | null)=, ResolvedContextFileSystemInfoEntry=): void} callback callback</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">_resolveContextTimestamp</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string[]} */</span>
		<span class="s4">const </span><span class="s1">hashes </span><span class="s3">= [];</span>
		<span class="s4">let </span><span class="s1">safeTime </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s1">processAsyncTree</span><span class="s3">(</span>
			<span class="s1">entry</span><span class="s3">.</span><span class="s1">symlinks</span><span class="s3">,</span>
			<span class="s7">10</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">target</span><span class="s3">, </span><span class="s1">push</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_getUnresolvedContextTimestamp</span><span class="s3">(</span><span class="s1">target</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">entry </span><span class="s3">&amp;&amp; </span><span class="s1">entry </span><span class="s3">!== </span><span class="s2">&quot;ignore&quot;</span><span class="s3">) {</span>
						<span class="s1">hashes</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestampHash</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">) {</span>
							<span class="s1">safeTime </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">max</span><span class="s3">(</span><span class="s1">safeTime</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">);</span>
						<span class="s3">}</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">symlinks </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
							<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">target of entry</span><span class="s3">.</span><span class="s1">symlinks</span><span class="s3">) </span><span class="s1">push</span><span class="s3">(</span><span class="s1">target</span><span class="s3">);</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s1">callback</span><span class="s3">();</span>
				<span class="s3">});</span>
			<span class="s3">},</span>
			<span class="s1">err </span><span class="s3">=&gt; {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
				<span class="s4">const </span><span class="s1">hash </span><span class="s3">= </span><span class="s1">createHash</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_hashFunction</span><span class="s3">);</span>
				<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestampHash</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">) {</span>
					<span class="s1">safeTime </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">max</span><span class="s3">(</span><span class="s1">safeTime</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s1">hashes</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">();</span>
				<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">h of hashes</span><span class="s3">) {</span>
					<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">h</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s1">callback</span><span class="s3">(</span>
					<span class="s4">null</span><span class="s3">,</span>
					<span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">resolved </span><span class="s3">= {</span>
						<span class="s1">safeTime</span><span class="s3">,</span>
						<span class="s1">timestampHash</span><span class="s3">: </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string} */ </span><span class="s3">(</span><span class="s1">hash</span><span class="s3">.</span><span class="s1">digest</span><span class="s3">(</span><span class="s2">&quot;hex&quot;</span><span class="s3">))</span>
					<span class="s3">})</span>
				<span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s1">_readContextHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">_readContext</span><span class="s3">(</span>
			<span class="s3">{</span>
				<span class="s1">path</span><span class="s3">,</span>
				<span class="s1">fromImmutablePath</span><span class="s3">: () =&gt; </span><span class="s2">&quot;&quot;</span><span class="s3">,</span>
				<span class="s1">fromManagedItem</span><span class="s3">: </span><span class="s1">info </span><span class="s3">=&gt; </span><span class="s1">info </span><span class="s3">|| </span><span class="s2">&quot;&quot;</span><span class="s3">,</span>
				<span class="s1">fromSymlink</span><span class="s3">: (</span><span class="s1">file</span><span class="s3">, </span><span class="s1">target</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
					<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, {</span>
						<span class="s1">hash</span><span class="s3">: </span><span class="s1">target</span><span class="s3">,</span>
						<span class="s1">symlinks</span><span class="s3">: </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">([</span><span class="s1">target</span><span class="s3">])</span>
					<span class="s3">});</span>
				<span class="s3">},</span>
				<span class="s1">fromFile</span><span class="s3">: (</span><span class="s1">file</span><span class="s3">, </span><span class="s1">stat</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt;</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">getFileHash</span><span class="s3">(</span><span class="s1">file</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">) =&gt; {</span>
						<span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">hash </span><span class="s3">|| </span><span class="s2">&quot;&quot;</span><span class="s3">);</span>
					<span class="s3">}),</span>
				<span class="s1">fromDirectory</span><span class="s3">: (</span><span class="s1">directory</span><span class="s3">, </span><span class="s1">stat</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">contextHashQueue</span><span class="s3">.</span><span class="s1">increaseParallelism</span><span class="s3">();</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">_getUnresolvedContextHash</span><span class="s3">(</span><span class="s1">directory</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">) =&gt; {</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">contextHashQueue</span><span class="s3">.</span><span class="s1">decreaseParallelism</span><span class="s3">();</span>
						<span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">hash </span><span class="s3">|| </span><span class="s2">&quot;&quot;</span><span class="s3">);</span>
					<span class="s3">});</span>
				<span class="s3">},</span>
				<span class="s5">/**</span>
				 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string[]} files files</span>
				 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{(string | ContextHash)[]} fileHashes hashes</span>
				 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{ContextHash} reduced hash</span>
				 <span class="s5">*/</span>
				<span class="s1">reduce</span><span class="s3">: (</span><span class="s1">files</span><span class="s3">, </span><span class="s1">fileHashes</span><span class="s3">) =&gt; {</span>
					<span class="s4">let </span><span class="s1">symlinks </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
					<span class="s4">const </span><span class="s1">hash </span><span class="s3">= </span><span class="s1">createHash</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_hashFunction</span><span class="s3">);</span>

					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">file of files</span><span class="s3">) </span><span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">file</span><span class="s3">);</span>
					<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">entry of fileHashes</span><span class="s3">) {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">entry </span><span class="s3">=== </span><span class="s2">&quot;string&quot;</span><span class="s3">) {</span>
							<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">);</span>
						<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
							<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">hash</span><span class="s3">);</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">symlinks</span><span class="s3">) {</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">symlinks </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s1">symlinks </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
								<span class="s1">addAll</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">symlinks</span><span class="s3">, </span><span class="s1">symlinks</span><span class="s3">);</span>
							<span class="s3">}</span>
						<span class="s3">}</span>
					<span class="s3">}</span>

					<span class="s4">const </span><span class="s1">result </span><span class="s3">= {</span>
						<span class="s1">hash</span><span class="s3">: </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string} */ </span><span class="s3">(</span><span class="s1">hash</span><span class="s3">.</span><span class="s1">digest</span><span class="s3">(</span><span class="s2">&quot;hex&quot;</span><span class="s3">))</span>
					<span class="s3">};</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">symlinks</span><span class="s3">) </span><span class="s1">result</span><span class="s3">.</span><span class="s1">symlinks </span><span class="s3">= </span><span class="s1">symlinks</span><span class="s3">;</span>
					<span class="s4">return </span><span class="s1">result</span><span class="s3">;</span>
				<span class="s3">}</span>
			<span class="s3">},</span>
			<span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">result</span><span class="s3">) =&gt; {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextHashes</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
				<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ContextHash} entry context hash</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((Error | null)=, string=): void} callback callback</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">_resolveContextHash</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string[]} */</span>
		<span class="s4">const </span><span class="s1">hashes </span><span class="s3">= [];</span>
		<span class="s1">processAsyncTree</span><span class="s3">(</span>
			<span class="s1">entry</span><span class="s3">.</span><span class="s1">symlinks</span><span class="s3">,</span>
			<span class="s7">10</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">target</span><span class="s3">, </span><span class="s1">push</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_getUnresolvedContextHash</span><span class="s3">(</span><span class="s1">target</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">) =&gt; {</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">hash</span><span class="s3">) {</span>
						<span class="s1">hashes</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">hash</span><span class="s3">.</span><span class="s1">hash</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">hash</span><span class="s3">.</span><span class="s1">symlinks </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
							<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">target of hash</span><span class="s3">.</span><span class="s1">symlinks</span><span class="s3">) </span><span class="s1">push</span><span class="s3">(</span><span class="s1">target</span><span class="s3">);</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s1">callback</span><span class="s3">();</span>
				<span class="s3">});</span>
			<span class="s3">},</span>
			<span class="s1">err </span><span class="s3">=&gt; {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
				<span class="s4">const </span><span class="s1">hash </span><span class="s3">= </span><span class="s1">createHash</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_hashFunction</span><span class="s3">);</span>
				<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">hash</span><span class="s3">);</span>
				<span class="s1">hashes</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">();</span>
				<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">h of hashes</span><span class="s3">) {</span>
					<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">h</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s1">callback</span><span class="s3">(</span>
					<span class="s4">null</span><span class="s3">,</span>
					<span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">resolved </span><span class="s3">= </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string} */ </span><span class="s3">(</span><span class="s1">hash</span><span class="s3">.</span><span class="s1">digest</span><span class="s3">(</span><span class="s2">&quot;hex&quot;</span><span class="s3">)))</span>
				<span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s1">_readContextTimestampAndHash</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">finalize </span><span class="s3">= (</span><span class="s1">timestamp</span><span class="s3">, </span><span class="s1">hash</span><span class="s3">) =&gt; {</span>
			<span class="s4">const </span><span class="s1">result </span><span class="s3">=</span>
				<span class="s1">timestamp </span><span class="s3">=== </span><span class="s2">&quot;ignore&quot;</span>
					<span class="s3">? </span><span class="s1">hash</span>
					<span class="s3">: {</span>
							<span class="s1">...timestamp</span><span class="s3">,</span>
							<span class="s1">...hash</span>
					  <span class="s3">};</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTshs</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
			<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
		<span class="s3">};</span>
		<span class="s4">const </span><span class="s1">cachedHash </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextHashes</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
		<span class="s4">const </span><span class="s1">cachedTimestamp </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestamps</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">path</span><span class="s3">);</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s1">cachedHash </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">cachedTimestamp </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s1">finalize</span><span class="s3">(</span><span class="s1">cachedTimestamp</span><span class="s3">, </span><span class="s1">cachedHash</span><span class="s3">);</span>
			<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTimestampQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
					<span class="s1">finalize</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">, </span><span class="s1">cachedHash</span><span class="s3">);</span>
				<span class="s3">});</span>
			<span class="s3">}</span>
		<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">cachedTimestamp </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">contextHashQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
					<span class="s1">finalize</span><span class="s3">(</span><span class="s1">cachedTimestamp</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">);</span>
				<span class="s3">});</span>
			<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_readContext</span><span class="s3">(</span>
					<span class="s3">{</span>
						<span class="s1">path</span><span class="s3">,</span>
						<span class="s1">fromImmutablePath</span><span class="s3">: () =&gt; </span><span class="s4">null</span><span class="s3">,</span>
						<span class="s1">fromManagedItem</span><span class="s3">: </span><span class="s1">info </span><span class="s3">=&gt; ({</span>
							<span class="s1">safeTime</span><span class="s3">: </span><span class="s7">0</span><span class="s3">,</span>
							<span class="s1">timestampHash</span><span class="s3">: </span><span class="s1">info</span><span class="s3">,</span>
							<span class="s1">hash</span><span class="s3">: </span><span class="s1">info </span><span class="s3">|| </span><span class="s2">&quot;&quot;</span>
						<span class="s3">}),</span>
						<span class="s1">fromSymlink</span><span class="s3">: (</span><span class="s1">fle</span><span class="s3">, </span><span class="s1">target</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
							<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, {</span>
								<span class="s1">timestampHash</span><span class="s3">: </span><span class="s1">target</span><span class="s3">,</span>
								<span class="s1">hash</span><span class="s3">: </span><span class="s1">target</span><span class="s3">,</span>
								<span class="s1">symlinks</span><span class="s3">: </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">([</span><span class="s1">target</span><span class="s3">])</span>
							<span class="s3">});</span>
						<span class="s3">},</span>
						<span class="s1">fromFile</span><span class="s3">: (</span><span class="s1">file</span><span class="s3">, </span><span class="s1">stat</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
							<span class="s4">this</span><span class="s3">.</span><span class="s1">_getFileTimestampAndHash</span><span class="s3">(</span><span class="s1">file</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">);</span>
						<span class="s3">},</span>
						<span class="s1">fromDirectory</span><span class="s3">: (</span><span class="s1">directory</span><span class="s3">, </span><span class="s1">stat</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
							<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTshQueue</span><span class="s3">.</span><span class="s1">increaseParallelism</span><span class="s3">();</span>
							<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTshQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">directory</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">result</span><span class="s3">) =&gt; {</span>
								<span class="s4">this</span><span class="s3">.</span><span class="s1">contextTshQueue</span><span class="s3">.</span><span class="s1">decreaseParallelism</span><span class="s3">();</span>
								<span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
							<span class="s3">});</span>
						<span class="s3">},</span>
						<span class="s5">/**</span>
						 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string[]} files files</span>
						 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{(Partial&lt;TimestampAndHash&gt; &amp; Partial&lt;ContextTimestampAndHash&gt; | string | null)[]} results results</span>
						 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{ContextTimestampAndHash} tsh</span>
						 <span class="s5">*/</span>
						<span class="s1">reduce</span><span class="s3">: (</span><span class="s1">files</span><span class="s3">, </span><span class="s1">results</span><span class="s3">) =&gt; {</span>
							<span class="s4">let </span><span class="s1">symlinks </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>

							<span class="s4">const </span><span class="s1">tsHash </span><span class="s3">= </span><span class="s1">createHash</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_hashFunction</span><span class="s3">);</span>
							<span class="s4">const </span><span class="s1">hash </span><span class="s3">= </span><span class="s1">createHash</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_hashFunction</span><span class="s3">);</span>

							<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">file of files</span><span class="s3">) {</span>
								<span class="s1">tsHash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">file</span><span class="s3">);</span>
								<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">file</span><span class="s3">);</span>
							<span class="s3">}</span>
							<span class="s4">let </span><span class="s1">safeTime </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
							<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">entry of results</span><span class="s3">) {</span>
								<span class="s4">if </span><span class="s3">(!</span><span class="s1">entry</span><span class="s3">) {</span>
									<span class="s1">tsHash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s2">&quot;n&quot;</span><span class="s3">);</span>
									<span class="s4">continue</span><span class="s3">;</span>
								<span class="s3">}</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">entry </span><span class="s3">=== </span><span class="s2">&quot;string&quot;</span><span class="s3">) {</span>
									<span class="s1">tsHash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s2">&quot;n&quot;</span><span class="s3">);</span>
									<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">);</span>
									<span class="s4">continue</span><span class="s3">;</span>
								<span class="s3">}</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestamp</span><span class="s3">) {</span>
									<span class="s1">tsHash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s2">&quot;f&quot;</span><span class="s3">);</span>
									<span class="s1">tsHash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s2">`</span><span class="s1">$</span><span class="s3">{</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestamp</span><span class="s3">}</span><span class="s2">`</span><span class="s3">);</span>
								<span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestampHash</span><span class="s3">) {</span>
									<span class="s1">tsHash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s2">&quot;d&quot;</span><span class="s3">);</span>
									<span class="s1">tsHash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s2">`</span><span class="s1">$</span><span class="s3">{</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestampHash</span><span class="s3">}</span><span class="s2">`</span><span class="s3">);</span>
								<span class="s3">}</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">symlinks </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
									<span class="s4">if </span><span class="s3">(</span><span class="s1">symlinks </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s1">symlinks </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>
									<span class="s1">addAll</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">symlinks</span><span class="s3">, </span><span class="s1">symlinks</span><span class="s3">);</span>
								<span class="s3">}</span>
								<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">) {</span>
									<span class="s1">safeTime </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">max</span><span class="s3">(</span><span class="s1">safeTime</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">);</span>
								<span class="s3">}</span>
								<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">hash</span><span class="s3">);</span>
							<span class="s3">}</span>

							<span class="s4">const </span><span class="s1">result </span><span class="s3">= {</span>
								<span class="s1">safeTime</span><span class="s3">,</span>
								<span class="s1">timestampHash</span><span class="s3">: </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string} */ </span><span class="s3">(</span><span class="s1">tsHash</span><span class="s3">.</span><span class="s1">digest</span><span class="s3">(</span><span class="s2">&quot;hex&quot;</span><span class="s3">)),</span>
								<span class="s1">hash</span><span class="s3">: </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string} */ </span><span class="s3">(</span><span class="s1">hash</span><span class="s3">.</span><span class="s1">digest</span><span class="s3">(</span><span class="s2">&quot;hex&quot;</span><span class="s3">))</span>
							<span class="s3">};</span>
							<span class="s4">if </span><span class="s3">(</span><span class="s1">symlinks</span><span class="s3">) </span><span class="s1">result</span><span class="s3">.</span><span class="s1">symlinks </span><span class="s3">= </span><span class="s1">symlinks</span><span class="s3">;</span>
							<span class="s4">return </span><span class="s1">result</span><span class="s3">;</span>
						<span class="s3">}</span>
					<span class="s3">},</span>
					<span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">result</span><span class="s3">) =&gt; {</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTshs</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
						<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">result</span><span class="s3">);</span>
					<span class="s3">}</span>
				<span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s5">/**</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{ContextTimestampAndHash} entry entry</span>
	 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{function((Error | null)=, ResolvedContextTimestampAndHash=): void} callback callback</span>
	 <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{void}</span>
	 <span class="s5">*/</span>
	<span class="s1">_resolveContextTsh</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string[]} */</span>
		<span class="s4">const </span><span class="s1">hashes </span><span class="s3">= [];</span>
		<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string[]} */</span>
		<span class="s4">const </span><span class="s1">tsHashes </span><span class="s3">= [];</span>
		<span class="s4">let </span><span class="s1">safeTime </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
		<span class="s1">processAsyncTree</span><span class="s3">(</span>
			<span class="s1">entry</span><span class="s3">.</span><span class="s1">symlinks</span><span class="s3">,</span>
			<span class="s7">10</span><span class="s3">,</span>
			<span class="s3">(</span><span class="s1">target</span><span class="s3">, </span><span class="s1">push</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) =&gt; {</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_getUnresolvedContextTsh</span><span class="s3">(</span><span class="s1">target</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">) =&gt; {</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">) {</span>
						<span class="s1">hashes</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">hash</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestampHash</span><span class="s3">) </span><span class="s1">tsHashes</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestampHash</span><span class="s3">);</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">) {</span>
							<span class="s1">safeTime </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">max</span><span class="s3">(</span><span class="s1">safeTime</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">);</span>
						<span class="s3">}</span>
						<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">symlinks </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
							<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">target of entry</span><span class="s3">.</span><span class="s1">symlinks</span><span class="s3">) </span><span class="s1">push</span><span class="s3">(</span><span class="s1">target</span><span class="s3">);</span>
						<span class="s3">}</span>
					<span class="s3">}</span>
					<span class="s1">callback</span><span class="s3">();</span>
				<span class="s3">});</span>
			<span class="s3">},</span>
			<span class="s1">err </span><span class="s3">=&gt; {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) </span><span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
				<span class="s4">const </span><span class="s1">hash </span><span class="s3">= </span><span class="s1">createHash</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_hashFunction</span><span class="s3">);</span>
				<span class="s4">const </span><span class="s1">tsHash </span><span class="s3">= </span><span class="s1">createHash</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_hashFunction</span><span class="s3">);</span>
				<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">hash</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestampHash</span><span class="s3">) </span><span class="s1">tsHash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">timestampHash</span><span class="s3">);</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">) {</span>
					<span class="s1">safeTime </span><span class="s3">= </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">max</span><span class="s3">(</span><span class="s1">safeTime</span><span class="s3">, </span><span class="s1">entry</span><span class="s3">.</span><span class="s1">safeTime</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s1">hashes</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">();</span>
				<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">h of hashes</span><span class="s3">) {</span>
					<span class="s1">hash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">h</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s1">tsHashes</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">();</span>
				<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s1">h of tsHashes</span><span class="s3">) {</span>
					<span class="s1">tsHash</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">h</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s1">callback</span><span class="s3">(</span>
					<span class="s4">null</span><span class="s3">,</span>
					<span class="s3">(</span><span class="s1">entry</span><span class="s3">.</span><span class="s1">resolved </span><span class="s3">= {</span>
						<span class="s1">safeTime</span><span class="s3">,</span>
						<span class="s1">timestampHash</span><span class="s3">: </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string} */ </span><span class="s3">(</span><span class="s1">tsHash</span><span class="s3">.</span><span class="s1">digest</span><span class="s3">(</span><span class="s2">&quot;hex&quot;</span><span class="s3">)),</span>
						<span class="s1">hash</span><span class="s3">: </span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string} */ </span><span class="s3">(</span><span class="s1">hash</span><span class="s3">.</span><span class="s1">digest</span><span class="s3">(</span><span class="s2">&quot;hex&quot;</span><span class="s3">))</span>
					<span class="s3">})</span>
				<span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s1">_getManagedItemDirectoryInfo</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">.</span><span class="s1">readdir</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">elements</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">=== </span><span class="s2">&quot;ENOENT&quot; </span><span class="s3">|| </span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">=== </span><span class="s2">&quot;ENOTDIR&quot;</span><span class="s3">) {</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">EMPTY_SET</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
			<span class="s3">}</span>
			<span class="s4">const </span><span class="s1">set </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">(</span>
				<span class="s5">/** </span><span class="s6">@type </span><span class="s5">{string[]} */ </span><span class="s3">(</span><span class="s1">elements</span><span class="s3">).</span><span class="s1">map</span><span class="s3">(</span><span class="s1">element </span><span class="s3">=&gt;</span>
					<span class="s1">join</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, </span><span class="s1">element</span><span class="s3">)</span>
				<span class="s3">)</span>
			<span class="s3">);</span>
			<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">set</span><span class="s3">);</span>
		<span class="s3">});</span>
	<span class="s3">}</span>

	<span class="s1">_getManagedItemInfo</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">callback</span><span class="s3">) {</span>
		<span class="s4">const </span><span class="s1">dir </span><span class="s3">= </span><span class="s1">dirname</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">path</span><span class="s3">);</span>
		<span class="s4">this</span><span class="s3">.</span><span class="s1">managedItemDirectoryQueue</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">dir</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">elements</span><span class="s3">) =&gt; {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
				<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
			<span class="s3">}</span>
			<span class="s4">if </span><span class="s3">(!</span><span class="s1">elements</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)) {</span>
				<span class="s0">// file or directory doesn't exist</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItems</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;*missing&quot;</span><span class="s3">);</span>
				<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s2">&quot;*missing&quot;</span><span class="s3">);</span>
			<span class="s3">}</span>
			<span class="s0">// something exists</span>
			<span class="s0">// it may be a file or directory</span>
			<span class="s4">if </span><span class="s3">(</span>
				<span class="s1">path</span><span class="s3">.</span><span class="s1">endsWith</span><span class="s3">(</span><span class="s2">&quot;node_modules&quot;</span><span class="s3">) &amp;&amp;</span>
				<span class="s3">(</span><span class="s1">path</span><span class="s3">.</span><span class="s1">endsWith</span><span class="s3">(</span><span class="s2">&quot;/node_modules&quot;</span><span class="s3">) || </span><span class="s1">path</span><span class="s3">.</span><span class="s1">endsWith</span><span class="s3">(</span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">node_modules&quot;</span><span class="s3">))</span>
			<span class="s3">) {</span>
				<span class="s0">// we are only interested in existence of this special directory</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItems</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;*node_modules&quot;</span><span class="s3">);</span>
				<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s2">&quot;*node_modules&quot;</span><span class="s3">);</span>
			<span class="s3">}</span>

			<span class="s0">// we assume it's a directory, as files shouldn't occur in managed paths</span>
			<span class="s4">const </span><span class="s1">packageJsonPath </span><span class="s3">= </span><span class="s1">join</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;package.json&quot;</span><span class="s3">);</span>
			<span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">.</span><span class="s1">readFile</span><span class="s3">(</span><span class="s1">packageJsonPath</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">content</span><span class="s3">) =&gt; {</span>
				<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
					<span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">=== </span><span class="s2">&quot;ENOENT&quot; </span><span class="s3">|| </span><span class="s1">err</span><span class="s3">.</span><span class="s1">code </span><span class="s3">=== </span><span class="s2">&quot;ENOTDIR&quot;</span><span class="s3">) {</span>
						<span class="s0">// no package.json or path is not a directory</span>
						<span class="s4">this</span><span class="s3">.</span><span class="s1">fs</span><span class="s3">.</span><span class="s1">readdir</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">err</span><span class="s3">, </span><span class="s1">elements</span><span class="s3">) =&gt; {</span>
							<span class="s4">if </span><span class="s3">(</span>
								<span class="s3">!</span><span class="s1">err </span><span class="s3">&amp;&amp;</span>
								<span class="s1">elements</span><span class="s3">.</span><span class="s1">length </span><span class="s3">=== </span><span class="s7">1 </span><span class="s3">&amp;&amp;</span>
								<span class="s1">elements</span><span class="s3">[</span><span class="s7">0</span><span class="s3">] === </span><span class="s2">&quot;node_modules&quot;</span>
							<span class="s3">) {</span>
								<span class="s0">// This is only a grouping folder e. g. used by yarn</span>
								<span class="s0">// we are only interested in existence of this special directory</span>
								<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItems</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s2">&quot;*nested&quot;</span><span class="s3">);</span>
								<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s2">&quot;*nested&quot;</span><span class="s3">);</span>
							<span class="s3">}</span>
							<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span>
								<span class="s2">`Managed item </span><span class="s1">$</span><span class="s3">{</span><span class="s1">path</span><span class="s3">} </span><span class="s2">isn't a directory or doesn't contain a package.json (see snapshot.managedPaths option)`</span>
							<span class="s3">);</span>
							<span class="s4">return </span><span class="s1">callback</span><span class="s3">();</span>
						<span class="s3">});</span>
						<span class="s4">return</span><span class="s3">;</span>
					<span class="s3">}</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">let </span><span class="s1">data</span><span class="s3">;</span>
				<span class="s4">try </span><span class="s3">{</span>
					<span class="s1">data </span><span class="s3">= </span><span class="s1">JSON</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s5">/** </span><span class="s6">@type </span><span class="s5">{Buffer} */ </span><span class="s3">(</span><span class="s1">content</span><span class="s3">).</span><span class="s1">toString</span><span class="s3">(</span><span class="s2">&quot;utf-8&quot;</span><span class="s3">));</span>
				<span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">(</span><span class="s1">e</span><span class="s3">);</span>
				<span class="s3">}</span>
				<span class="s4">if </span><span class="s3">(!</span><span class="s1">data</span><span class="s3">.</span><span class="s1">name</span><span class="s3">) {</span>
					<span class="s4">this</span><span class="s3">.</span><span class="s1">logger</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span>
						<span class="s2">`</span><span class="s1">$</span><span class="s3">{</span><span class="s1">packageJsonPath</span><span class="s3">} </span><span class="s2">doesn't contain a &quot;name&quot; property (see snapshot.managedPaths option)`</span>
					<span class="s3">);</span>
					<span class="s4">return </span><span class="s1">callback</span><span class="s3">();</span>
				<span class="s3">}</span>
				<span class="s4">const </span><span class="s1">info </span><span class="s3">= </span><span class="s2">`</span><span class="s1">$</span><span class="s3">{</span><span class="s1">data</span><span class="s3">.</span><span class="s1">name </span><span class="s3">|| </span><span class="s2">&quot;&quot;</span><span class="s3">}</span><span class="s2">@</span><span class="s1">$</span><span class="s3">{</span><span class="s1">data</span><span class="s3">.</span><span class="s1">version </span><span class="s3">|| </span><span class="s2">&quot;&quot;</span><span class="s3">}</span><span class="s2">`</span><span class="s3">;</span>
				<span class="s4">this</span><span class="s3">.</span><span class="s1">_managedItems</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">info</span><span class="s3">);</span>
				<span class="s1">callback</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">info</span><span class="s3">);</span>
			<span class="s3">});</span>
		<span class="s3">});</span>
	<span class="s3">}</span>

	<span class="s1">getDeprecatedFileTimestamps</span><span class="s3">() {</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedFileTimestamps </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">)</span>
			<span class="s4">return this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedFileTimestamps</span><span class="s3">;</span>
		<span class="s4">const </span><span class="s1">map </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s3">[</span><span class="s1">path</span><span class="s3">, </span><span class="s1">info</span><span class="s3">] </span><span class="s1">of </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fileTimestamps</span><span class="s3">) {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">info</span><span class="s3">) </span><span class="s1">map</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s4">typeof </span><span class="s1">info </span><span class="s3">=== </span><span class="s2">&quot;object&quot; </span><span class="s3">? </span><span class="s1">info</span><span class="s3">.</span><span class="s1">safeTime </span><span class="s3">: </span><span class="s4">null</span><span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedFileTimestamps </span><span class="s3">= </span><span class="s1">map</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s1">getDeprecatedContextTimestamps</span><span class="s3">() {</span>
		<span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedContextTimestamps </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">)</span>
			<span class="s4">return this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedContextTimestamps</span><span class="s3">;</span>
		<span class="s4">const </span><span class="s1">map </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Map</span><span class="s3">();</span>
		<span class="s4">for </span><span class="s3">(</span><span class="s4">const </span><span class="s3">[</span><span class="s1">path</span><span class="s3">, </span><span class="s1">info</span><span class="s3">] </span><span class="s1">of </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_contextTimestamps</span><span class="s3">) {</span>
			<span class="s4">if </span><span class="s3">(</span><span class="s1">info</span><span class="s3">) </span><span class="s1">map</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s4">typeof </span><span class="s1">info </span><span class="s3">=== </span><span class="s2">&quot;object&quot; </span><span class="s3">? </span><span class="s1">info</span><span class="s3">.</span><span class="s1">safeTime </span><span class="s3">: </span><span class="s4">null</span><span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_cachedDeprecatedContextTimestamps </span><span class="s3">= </span><span class="s1">map</span><span class="s3">);</span>
	<span class="s3">}</span>
<span class="s3">}</span>

<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s1">FileSystemInfo</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">Snapshot </span><span class="s3">= </span><span class="s1">Snapshot</span><span class="s3">;</span>
</pre>
</body>
</html>