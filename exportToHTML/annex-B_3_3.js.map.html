<html>
<head>
<title>annex-B_3_3.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
.s1 { color: #6aab73;}
.s2 { color: #2aacb8;}
.s3 { color: #cf8e6d;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
annex-B_3_3.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;_core&quot;</span><span class="s0">,</span><span class="s1">&quot;require&quot;</span><span class="s0">,</span><span class="s1">&quot;annexB33FunctionsVisitor&quot;</span><span class="s0">,</span><span class="s1">&quot;VariableDeclaration&quot;</span><span class="s0">,</span><span class="s1">&quot;path&quot;</span><span class="s0">,</span><span class="s1">&quot;isStrict&quot;</span><span class="s0">,</span><span class="s1">&quot;node&quot;</span><span class="s0">,</span><span class="s1">&quot;kind&quot;</span><span class="s0">,</span><span class="s1">&quot;varScope&quot;</span><span class="s0">,</span><span class="s1">&quot;scope&quot;</span><span class="s0">,</span><span class="s1">&quot;getFunctionParent&quot;</span><span class="s0">,</span><span class="s1">&quot;getProgramParent&quot;</span><span class="s0">,</span><span class="s1">&quot;traverse&quot;</span><span class="s0">,</span><span class="s1">&quot;functionsToVarVisitor&quot;</span><span class="s0">,</span><span class="s1">&quot;names&quot;</span><span class="s0">,</span><span class="s1">&quot;Object&quot;</span><span class="s0">,</span><span class="s1">&quot;keys&quot;</span><span class="s0">,</span><span class="s1">&quot;getBindingIdentifiers&quot;</span><span class="s0">,</span><span class="s1">&quot;BlockStatement&quot;</span><span class="s0">,</span><span class="s1">&quot;t&quot;</span><span class="s0">,</span><span class="s1">&quot;isFunction&quot;</span><span class="s0">,</span><span class="s1">&quot;parent&quot;</span><span class="s0">,</span><span class="s1">&quot;body&quot;</span><span class="s0">,</span><span class="s1">&quot;transformStatementList&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;SwitchCase&quot;</span><span class="s0">,</span><span class="s1">&quot;exports&quot;</span><span class="s0">,</span><span class="s1">&quot;paths&quot;</span><span class="s0">,</span><span class="s1">&quot;outer&quot;</span><span class="s0">,</span><span class="s1">&quot;isFunctionDeclaration&quot;</span><span class="s0">,</span><span class="s1">&quot;async&quot;</span><span class="s0">,</span><span class="s1">&quot;generator&quot;</span><span class="s0">,</span><span class="s1">&quot;parentPath&quot;</span><span class="s0">,</span><span class="s1">&quot;isVarScope&quot;</span><span class="s0">,</span><span class="s1">&quot;name&quot;</span><span class="s0">,</span><span class="s1">&quot;id&quot;</span><span class="s0">,</span><span class="s1">&quot;currScope&quot;</span><span class="s0">,</span><span class="s1">&quot;hasOwnBinding&quot;</span><span class="s0">,</span><span class="s1">&quot;maybeTransformBlockScopedFunction&quot;</span><span class="s0">,</span><span class="s1">&quot;removeOwnBinding&quot;</span><span class="s0">,</span><span class="s1">&quot;varNode&quot;</span><span class="s0">,</span><span class="s1">&quot;variableDeclaration&quot;</span><span class="s0">,</span><span class="s1">&quot;variableDeclarator&quot;</span><span class="s0">,</span><span class="s1">&quot;toExpression&quot;</span><span class="s0">,</span><span class="s1">&quot;_blockHoist&quot;</span><span class="s0">,</span><span class="s1">&quot;varPath&quot;</span><span class="s0">,</span><span class="s1">&quot;replaceWith&quot;</span><span class="s0">,</span><span class="s1">&quot;registerDeclaration&quot;</span><span class="s0">,</span><span class="s1">&quot;Scope&quot;</span><span class="s0">,</span><span class="s1">&quot;binding&quot;</span><span class="s0">,</span><span class="s1">&quot;getOwnBinding&quot;</span><span class="s0">,</span><span class="s1">&quot;Expression|Declaration&quot;</span><span class="s0">,</span><span class="s1">&quot;skip&quot;</span><span class="s0">,</span><span class="s1">&quot;isFunctionParent&quot;</span><span class="s0">,</span><span class="s1">&quot;isProgram&quot;</span><span class="s0">,</span><span class="s1">&quot;find&quot;</span><span class="s0">,</span><span class="s1">&quot;_node$directives&quot;</span><span class="s0">,</span><span class="s1">&quot;sourceType&quot;</span><span class="s0">,</span><span class="s1">&quot;isClass&quot;</span><span class="s0">,</span><span class="s1">&quot;isBlockStatement&quot;</span><span class="s0">,</span><span class="s1">&quot;directives&quot;</span><span class="s0">,</span><span class="s1">&quot;some&quot;</span><span class="s0">,</span><span class="s1">&quot;directive&quot;</span><span class="s0">,</span><span class="s1">&quot;value&quot;</span><span class="s0">],</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../src/annex-B_3_3.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import { types as t } from </span><span class="s3">\&quot;</span><span class="s1">@babel/core</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n</span><span class="s1">import type { NodePath, Visitor, Scope } from </span><span class="s3">\&quot;</span><span class="s1">@babel/traverse</span><span class="s3">\&quot;</span><span class="s1">;</span><span class="s3">\n\n</span><span class="s1">// Whenever a function declaration in a nested block scope</span><span class="s3">\n</span><span class="s1">// doesn't conflict with a block-scoped binding from an outer</span><span class="s3">\n</span><span class="s1">// scope, we transform it to a variable declaration.</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">// This implements the Annex B.3.3 behavior.</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">// TODO(Babel 8): Figure out how this should interact with</span><span class="s3">\n</span><span class="s1">// the transform-block-scoped functions plugin (it feels</span><span class="s3">\n</span><span class="s1">// wrong to handle this transform here), and what we want</span><span class="s3">\n</span><span class="s1">// to do with Annex B behavior in general.</span><span class="s3">\n\n</span><span class="s1">// To avoid confusing block-scoped variables transformed to</span><span class="s3">\n</span><span class="s1">// var with original vars, this transformation happens in two</span><span class="s3">\n</span><span class="s1">// different places:</span><span class="s3">\n</span><span class="s1">//   1. For functions that </span><span class="s3">\&quot;</span><span class="s1">conflict</span><span class="s3">\&quot; </span><span class="s1">with var-variables, in</span><span class="s3">\n</span><span class="s1">//      the VariableDeclaration visitor.</span><span class="s3">\n</span><span class="s1">//   2. For functions that don't conflict with any variable,</span><span class="s3">\n</span><span class="s1">//      in the FunctionDeclaration visitor.</span><span class="s3">\n\n</span><span class="s1">export const annexB33FunctionsVisitor: Visitor = {</span><span class="s3">\n  </span><span class="s1">VariableDeclaration(path) {</span><span class="s3">\n    </span><span class="s1">if (isStrict(path)) return;</span><span class="s3">\n    </span><span class="s1">if (path.node.kind !== </span><span class="s3">\&quot;</span><span class="s1">var</span><span class="s3">\&quot;</span><span class="s1">) return;</span><span class="s3">\n\n    </span><span class="s1">const varScope =</span><span class="s3">\n      </span><span class="s1">path.scope.getFunctionParent() || path.scope.getProgramParent();</span><span class="s3">\n    </span><span class="s1">// eslint-disable-next-line @typescript-eslint/no-use-before-define</span><span class="s3">\n    </span><span class="s1">varScope.path.traverse(functionsToVarVisitor, {</span><span class="s3">\n      </span><span class="s1">names: Object.keys(path.getBindingIdentifiers()),</span><span class="s3">\n    </span><span class="s1">});</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n\n  </span><span class="s1">// NOTE: These two visitors target the same nodes as the</span><span class="s3">\n  </span><span class="s1">// block-scoped-functions plugin</span><span class="s3">\n\n  </span><span class="s1">BlockStatement(path) {</span><span class="s3">\n    </span><span class="s1">if (isStrict(path)) return;</span><span class="s3">\n    </span><span class="s1">if (t.isFunction(path.parent, { body: path.node })) return;</span><span class="s3">\n    </span><span class="s1">transformStatementList(path.get(</span><span class="s3">\&quot;</span><span class="s1">body</span><span class="s3">\&quot;</span><span class="s1">));</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n\n  </span><span class="s1">SwitchCase(path) {</span><span class="s3">\n    </span><span class="s1">if (isStrict(path)) return;</span><span class="s3">\n    </span><span class="s1">transformStatementList(path.get(</span><span class="s3">\&quot;</span><span class="s1">consequent</span><span class="s3">\&quot;</span><span class="s1">));</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">function transformStatementList(paths: NodePath&lt;t.Statement&gt;[]) {</span><span class="s3">\n  </span><span class="s1">outer: for (const path of paths) {</span><span class="s3">\n    </span><span class="s1">if (!path.isFunctionDeclaration()) continue;</span><span class="s3">\n    </span><span class="s1">// Annex B.3.3 only applies to plain functions.</span><span class="s3">\n    </span><span class="s1">if (path.node.async || path.node.generator) return;</span><span class="s3">\n\n    </span><span class="s1">const { scope } = path.parentPath;</span><span class="s3">\n    </span><span class="s1">if (isVarScope(scope)) return;</span><span class="s3">\n\n    </span><span class="s1">const { name } = path.node.id;</span><span class="s3">\n    </span><span class="s1">let currScope = scope;</span><span class="s3">\n    </span><span class="s1">do {</span><span class="s3">\n      </span><span class="s1">if (currScope.parent.hasOwnBinding(name)) continue outer;</span><span class="s3">\n      </span><span class="s1">currScope = currScope.parent;</span><span class="s3">\n    </span><span class="s1">} while (!isVarScope(currScope));</span><span class="s3">\n\n    </span><span class="s1">maybeTransformBlockScopedFunction(path);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function maybeTransformBlockScopedFunction(</span><span class="s3">\n  </span><span class="s1">path: NodePath&lt;t.FunctionDeclaration&gt;,</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">const {</span><span class="s3">\n    </span><span class="s1">node,</span><span class="s3">\n    </span><span class="s1">parentPath: { scope },</span><span class="s3">\n  </span><span class="s1">} = path;</span><span class="s3">\n\n  </span><span class="s1">const { id } = node;</span><span class="s3">\n  </span><span class="s1">scope.removeOwnBinding(id.name);</span><span class="s3">\n  </span><span class="s1">node.id = null;</span><span class="s3">\n\n  </span><span class="s1">const varNode = t.variableDeclaration(</span><span class="s3">\&quot;</span><span class="s1">var</span><span class="s3">\&quot;</span><span class="s1">, [</span><span class="s3">\n    </span><span class="s1">t.variableDeclarator(id, t.toExpression(node)),</span><span class="s3">\n  </span><span class="s1">]);</span><span class="s3">\n  </span><span class="s1">// @ts-expect-error undocumented property</span><span class="s3">\n  </span><span class="s1">varNode._blockHoist = 2;</span><span class="s3">\n\n  </span><span class="s1">const [varPath] = path.replaceWith(varNode);</span><span class="s3">\n  </span><span class="s1">scope.registerDeclaration(varPath);</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">const functionsToVarVisitor: Visitor&lt;{ names: string[] }&gt; = {</span><span class="s3">\n  </span><span class="s1">Scope(path, { names }) {</span><span class="s3">\n    </span><span class="s1">for (const name of names) {</span><span class="s3">\n      </span><span class="s1">const binding = path.scope.getOwnBinding(name);</span><span class="s3">\n      </span><span class="s1">if (binding &amp;&amp; binding.kind === </span><span class="s3">\&quot;</span><span class="s1">hoisted</span><span class="s3">\&quot;</span><span class="s1">) {</span><span class="s3">\n        </span><span class="s1">maybeTransformBlockScopedFunction(</span><span class="s3">\n          </span><span class="s1">binding.path as NodePath&lt;t.FunctionDeclaration&gt;,</span><span class="s3">\n        </span><span class="s1">);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n  \&quot;</span><span class="s1">Expression|Declaration</span><span class="s3">\&quot;</span><span class="s1">(path) {</span><span class="s3">\n    </span><span class="s1">path.skip();</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">export function isVarScope(scope: Scope) {</span><span class="s3">\n  </span><span class="s1">return scope.path.isFunctionParent() || scope.path.isProgram();</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function isStrict(path: NodePath) {</span><span class="s3">\n  </span><span class="s1">return !!path.find(({ node }) =&gt; {</span><span class="s3">\n    </span><span class="s1">if (t.isProgram(node)) {</span><span class="s3">\n      </span><span class="s1">if (node.sourceType === </span><span class="s3">\&quot;</span><span class="s1">module</span><span class="s3">\&quot;</span><span class="s1">) return true;</span><span class="s3">\n    </span><span class="s1">} else if (t.isClass(node)) {</span><span class="s3">\n      </span><span class="s1">return true;</span><span class="s3">\n    </span><span class="s1">} else if (!t.isBlockStatement(node)) {</span><span class="s3">\n      </span><span class="s1">return false;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return node.directives?.some(</span><span class="s3">\n      </span><span class="s1">directive =&gt; directive.value.value === </span><span class="s3">\&quot;</span><span class="s1">use strict</span><span class="s3">\&quot;</span><span class="s1">,</span><span class="s3">\n    </span><span class="s1">);</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">}</span></pre>
</body>
</html>