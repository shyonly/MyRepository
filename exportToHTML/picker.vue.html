<html>
<head>
<title>picker.vue</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #d5b778;}
.s1 { color: #bcbec4;}
.s2 { color: #bababa;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #2aacb8;}
.s6 { color: #42c3d4;}
.s7 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
picker.vue</font>
</center></td></tr></table>
<pre><span class="s0">&lt;template&gt;</span>
  <span class="s0">&lt;el-input</span>
    <span class="s2">class</span><span class="s3">=&quot;el-date-editor&quot;</span>
    <span class="s2">:class</span><span class="s3">=&quot;'el-date-editor--' </span><span class="s1">+ type</span><span class="s3">&quot;</span>
    <span class="s2">:readonly</span><span class="s3">=&quot;</span><span class="s1">!editable || readonly || type === </span><span class="s3">'dates' </span><span class="s1">|| type === </span><span class="s3">'week' </span><span class="s1">|| type === </span><span class="s3">'years' </span><span class="s1">|| type === </span><span class="s3">'months'&quot;</span>
    <span class="s2">:disabled</span><span class="s3">=&quot;</span><span class="s1">pickerDisabled</span><span class="s3">&quot;</span>
    <span class="s2">:size</span><span class="s3">=&quot;</span><span class="s1">pickerSize</span><span class="s3">&quot;</span>
    <span class="s2">:name</span><span class="s3">=&quot;</span><span class="s1">name</span><span class="s3">&quot;</span>
    <span class="s2">v-bind</span><span class="s3">=&quot;</span><span class="s1">firstInputId</span><span class="s3">&quot;</span>
    <span class="s2">v-if</span><span class="s3">=&quot;</span><span class="s1">!ranged</span><span class="s3">&quot;</span>
    <span class="s2">v-clickoutside</span><span class="s3">=&quot;</span><span class="s1">handleClose</span><span class="s3">&quot;</span>
    <span class="s2">:placeholder</span><span class="s3">=&quot;</span><span class="s1">placeholder</span><span class="s3">&quot;</span>
    <span class="s2">@focus</span><span class="s3">=&quot;</span><span class="s1">handleFocus</span><span class="s3">&quot;</span>
    <span class="s2">@keydown.native</span><span class="s3">=&quot;</span><span class="s1">handleKeydown</span><span class="s3">&quot;</span>
    <span class="s2">:value</span><span class="s3">=&quot;</span><span class="s1">displayValue</span><span class="s3">&quot;</span>
    <span class="s2">@input</span><span class="s3">=&quot;</span><span class="s1">value =&gt; userInput = value</span><span class="s3">&quot;</span>
    <span class="s2">@change</span><span class="s3">=&quot;</span><span class="s1">handleChange</span><span class="s3">&quot;</span>
    <span class="s2">@mouseenter.native</span><span class="s3">=&quot;</span><span class="s1">handleMouseEnter</span><span class="s3">&quot;</span>
    <span class="s2">@mouseleave.native</span><span class="s3">=&quot;</span><span class="s1">showClose = </span><span class="s4">false</span><span class="s3">&quot;</span>
    <span class="s2">:validateEvent</span><span class="s3">=&quot;</span><span class="s4">false</span><span class="s3">&quot;</span>
    <span class="s2">ref</span><span class="s3">=&quot;reference&quot;</span><span class="s0">&gt;</span>
    <span class="s0">&lt;i </span><span class="s2">slot</span><span class="s3">=&quot;prefix&quot;</span>
      <span class="s2">class</span><span class="s3">=&quot;el-input__icon&quot;</span>
      <span class="s2">:class</span><span class="s3">=&quot;</span><span class="s1">triggerClass</span><span class="s3">&quot;</span>
      <span class="s2">@click</span><span class="s3">=&quot;</span><span class="s1">handleFocus</span><span class="s3">&quot;</span><span class="s0">&gt;</span>
    <span class="s0">&lt;/i&gt;</span>
    <span class="s0">&lt;i </span><span class="s2">slot</span><span class="s3">=&quot;suffix&quot;</span>
      <span class="s2">class</span><span class="s3">=&quot;el-input__icon&quot;</span>
      <span class="s2">@click</span><span class="s3">=&quot;</span><span class="s1">handleClickIcon</span><span class="s3">&quot;</span>
      <span class="s2">:class</span><span class="s3">=&quot;</span><span class="s1">[showClose ? </span><span class="s3">'' </span><span class="s1">+ clearIcon : </span><span class="s3">''</span><span class="s1">]</span><span class="s3">&quot;</span>
      <span class="s2">v-if</span><span class="s3">=&quot;</span><span class="s1">haveTrigger</span><span class="s3">&quot;</span><span class="s0">&gt;</span>
    <span class="s0">&lt;/i&gt;</span>
  <span class="s0">&lt;/el-input&gt;</span>
  <span class="s0">&lt;div</span>
    <span class="s2">class</span><span class="s3">=&quot;el-date-editor el-range-editor el-input__inner&quot;</span>
    <span class="s2">:class</span><span class="s3">=&quot;</span><span class="s1">[</span>
      <span class="s3">'el-date-editor--' </span><span class="s1">+ type,</span>
      <span class="s1">pickerSize ? </span><span class="s3">`el-range-editor--</span><span class="s1">${ pickerSize }</span><span class="s3">` </span><span class="s1">: </span><span class="s3">''</span><span class="s1">,</span>
      <span class="s1">pickerDisabled ? </span><span class="s3">'is-disabled' </span><span class="s1">: </span><span class="s3">''</span><span class="s1">,</span>
      <span class="s1">pickerVisible ? </span><span class="s3">'is-active' </span><span class="s1">: </span><span class="s3">''</span>
    <span class="s1">]</span><span class="s3">&quot;</span>
    <span class="s2">@click</span><span class="s3">=&quot;</span><span class="s1">handleRangeClick</span><span class="s3">&quot;</span>
    <span class="s2">@mouseenter</span><span class="s3">=&quot;</span><span class="s1">handleMouseEnter</span><span class="s3">&quot;</span>
    <span class="s2">@mouseleave</span><span class="s3">=&quot;</span><span class="s1">showClose = </span><span class="s4">false</span><span class="s3">&quot;</span>
    <span class="s2">@keydown</span><span class="s3">=&quot;</span><span class="s1">handleKeydown</span><span class="s3">&quot;</span>
    <span class="s2">ref</span><span class="s3">=&quot;reference&quot;</span>
    <span class="s2">v-clickoutside</span><span class="s3">=&quot;</span><span class="s1">handleClose</span><span class="s3">&quot;</span>
    <span class="s2">v-else</span><span class="s0">&gt;</span>
    <span class="s0">&lt;i </span><span class="s2">:class</span><span class="s3">=&quot;</span><span class="s1">[</span><span class="s3">'el-input__icon'</span><span class="s1">, </span><span class="s3">'el-range__icon'</span><span class="s1">, triggerClass]</span><span class="s3">&quot;</span><span class="s0">&gt;&lt;/i&gt;</span>
    <span class="s0">&lt;input</span>
      <span class="s2">autocomplete</span><span class="s3">=&quot;off&quot;</span>
      <span class="s2">:placeholder</span><span class="s3">=&quot;</span><span class="s1">startPlaceholder</span><span class="s3">&quot;</span>
      <span class="s2">:value</span><span class="s3">=&quot;</span><span class="s1">displayValue &amp;&amp; displayValue[</span><span class="s5">0</span><span class="s1">]</span><span class="s3">&quot;</span>
      <span class="s2">:disabled</span><span class="s3">=&quot;</span><span class="s1">pickerDisabled</span><span class="s3">&quot;</span>
      <span class="s2">v-bind</span><span class="s3">=&quot;</span><span class="s1">firstInputId</span><span class="s3">&quot;</span>
      <span class="s2">:readonly</span><span class="s3">=&quot;</span><span class="s1">!editable || readonly</span><span class="s3">&quot;</span>
      <span class="s2">:name</span><span class="s3">=&quot;</span><span class="s1">name &amp;&amp; name[</span><span class="s5">0</span><span class="s1">]</span><span class="s3">&quot;</span>
      <span class="s2">@input</span><span class="s3">=&quot;</span><span class="s1">handleStartInput</span><span class="s3">&quot;</span>
      <span class="s2">@change</span><span class="s3">=&quot;</span><span class="s1">handleStartChange</span><span class="s3">&quot;</span>
      <span class="s2">@focus</span><span class="s3">=&quot;</span><span class="s1">handleFocus</span><span class="s3">&quot;</span>
      <span class="s2">class</span><span class="s3">=&quot;el-range-input&quot;</span><span class="s0">&gt;</span>
    <span class="s0">&lt;slot </span><span class="s2">name</span><span class="s3">=&quot;range-separator&quot;</span><span class="s0">&gt;</span>
      <span class="s0">&lt;span </span><span class="s2">class</span><span class="s3">=&quot;el-range-separator&quot;</span><span class="s0">&gt;</span><span class="s1">{{ rangeSeparator }}</span><span class="s0">&lt;/span&gt;</span>
    <span class="s0">&lt;/slot&gt;</span>
    <span class="s0">&lt;input</span>
      <span class="s2">autocomplete</span><span class="s3">=&quot;off&quot;</span>
      <span class="s2">:placeholder</span><span class="s3">=&quot;</span><span class="s1">endPlaceholder</span><span class="s3">&quot;</span>
      <span class="s2">:value</span><span class="s3">=&quot;</span><span class="s1">displayValue &amp;&amp; displayValue[</span><span class="s5">1</span><span class="s1">]</span><span class="s3">&quot;</span>
      <span class="s2">:disabled</span><span class="s3">=&quot;</span><span class="s1">pickerDisabled</span><span class="s3">&quot;</span>
      <span class="s2">v-bind</span><span class="s3">=&quot;</span><span class="s1">secondInputId</span><span class="s3">&quot;</span>
      <span class="s2">:readonly</span><span class="s3">=&quot;</span><span class="s1">!editable || readonly</span><span class="s3">&quot;</span>
      <span class="s2">:name</span><span class="s3">=&quot;</span><span class="s1">name &amp;&amp; name[</span><span class="s5">1</span><span class="s1">]</span><span class="s3">&quot;</span>
      <span class="s2">@input</span><span class="s3">=&quot;</span><span class="s1">handleEndInput</span><span class="s3">&quot;</span>
      <span class="s2">@change</span><span class="s3">=&quot;</span><span class="s1">handleEndChange</span><span class="s3">&quot;</span>
      <span class="s2">@focus</span><span class="s3">=&quot;</span><span class="s1">handleFocus</span><span class="s3">&quot;</span>
      <span class="s2">class</span><span class="s3">=&quot;el-range-input&quot;</span><span class="s0">&gt;</span>
    <span class="s0">&lt;i</span>
      <span class="s2">@click</span><span class="s3">=&quot;</span><span class="s1">handleClickIcon</span><span class="s3">&quot;</span>
      <span class="s2">v-if</span><span class="s3">=&quot;</span><span class="s1">haveTrigger</span><span class="s3">&quot;</span>
      <span class="s2">:class</span><span class="s3">=&quot;</span><span class="s1">[showClose ? </span><span class="s3">'' </span><span class="s1">+ clearIcon : </span><span class="s3">''</span><span class="s1">]</span><span class="s3">&quot;</span>
      <span class="s2">class</span><span class="s3">=&quot;el-input__icon el-range__close-icon&quot;</span><span class="s0">&gt;</span>
    <span class="s0">&lt;/i&gt;</span>
  <span class="s0">&lt;/div&gt;</span>
<span class="s0">&lt;/template&gt;</span>

<span class="s0">&lt;script&gt;</span>
<span class="s4">import </span><span class="s1">Vue from </span><span class="s3">'vue'</span><span class="s1">;</span>
<span class="s4">import </span><span class="s1">Clickoutside from </span><span class="s3">'element-ui/src/utils/clickoutside'</span><span class="s1">;</span>
<span class="s4">import </span><span class="s1">{ formatDate, parseDate, isDateObject, getWeekNumber } from </span><span class="s3">'element-ui/src/utils/date-util'</span><span class="s1">;</span>
<span class="s4">import </span><span class="s1">Popper from </span><span class="s3">'element-ui/src/utils/vue-popper'</span><span class="s1">;</span>
<span class="s4">import </span><span class="s1">Emitter from </span><span class="s3">'element-ui/src/mixins/emitter'</span><span class="s1">;</span>
<span class="s4">import </span><span class="s1">ElInput from </span><span class="s3">'element-ui/packages/input'</span><span class="s1">;</span>
<span class="s4">import </span><span class="s1">merge from </span><span class="s3">'element-ui/src/utils/merge'</span><span class="s1">;</span>

<span class="s4">const </span><span class="s1">NewPopper = {</span>
  <span class="s1">props: {</span>
    <span class="s1">appendToBody: Popper.props.appendToBody,</span>
    <span class="s1">offset: Popper.props.offset,</span>
    <span class="s1">boundariesPadding: Popper.props.boundariesPadding,</span>
    <span class="s1">arrowOffset: Popper.props.arrowOffset,</span>
    <span class="s1">transformOrigin: Popper.props.transformOrigin</span>
  <span class="s1">},</span>
  <span class="s1">methods: Popper.methods,</span>
  <span class="s1">data() {</span>
    <span class="s4">return </span><span class="s1">merge({ visibleArrow: </span><span class="s4">true </span><span class="s1">}, Popper.data);</span>
  <span class="s1">},</span>
  <span class="s1">beforeDestroy: Popper.beforeDestroy</span>
<span class="s1">};</span>

<span class="s4">const </span><span class="s1">DEFAULT_FORMATS = {</span>
  <span class="s1">date: </span><span class="s3">'yyyy-MM-dd'</span><span class="s1">,</span>
  <span class="s1">month: </span><span class="s3">'yyyy-MM'</span><span class="s1">,</span>
  <span class="s1">months: </span><span class="s3">'yyyy-MM'</span><span class="s1">,</span>
  <span class="s1">datetime: </span><span class="s3">'yyyy-MM-dd HH:mm:ss'</span><span class="s1">,</span>
  <span class="s1">time: </span><span class="s3">'HH:mm:ss'</span><span class="s1">,</span>
  <span class="s1">week: </span><span class="s3">'yyyywWW'</span><span class="s1">,</span>
  <span class="s1">timerange: </span><span class="s3">'HH:mm:ss'</span><span class="s1">,</span>
  <span class="s1">daterange: </span><span class="s3">'yyyy-MM-dd'</span><span class="s1">,</span>
  <span class="s1">monthrange: </span><span class="s3">'yyyy-MM'</span><span class="s1">,</span>
  <span class="s1">datetimerange: </span><span class="s3">'yyyy-MM-dd HH:mm:ss'</span><span class="s1">,</span>
  <span class="s1">year: </span><span class="s3">'yyyy'</span><span class="s1">,</span>
  <span class="s1">years: </span><span class="s3">'yyyy'</span>
<span class="s1">};</span>
<span class="s4">const </span><span class="s1">HAVE_TRIGGER_TYPES = [</span>
  <span class="s3">'date'</span><span class="s1">,</span>
  <span class="s3">'datetime'</span><span class="s1">,</span>
  <span class="s3">'time'</span><span class="s1">,</span>
  <span class="s3">'time-select'</span><span class="s1">,</span>
  <span class="s3">'week'</span><span class="s1">,</span>
  <span class="s3">'month'</span><span class="s1">,</span>
  <span class="s3">'year'</span><span class="s1">,</span>
  <span class="s3">'daterange'</span><span class="s1">,</span>
  <span class="s3">'monthrange'</span><span class="s1">,</span>
  <span class="s3">'timerange'</span><span class="s1">,</span>
  <span class="s3">'datetimerange'</span><span class="s1">,</span>
  <span class="s3">'dates'</span><span class="s1">,</span>
  <span class="s3">'months'</span><span class="s1">,</span>
  <span class="s3">'years'</span>
<span class="s1">];</span>
<span class="s4">const </span><span class="s1">DATE_FORMATTER = </span><span class="s4">function</span><span class="s1">(value, format) {</span>
  <span class="s4">if </span><span class="s1">(format === </span><span class="s3">'timestamp'</span><span class="s1">) </span><span class="s4">return </span><span class="s1">value.getTime();</span>
  <span class="s4">return </span><span class="s1">formatDate(value, format);</span>
<span class="s1">};</span>
<span class="s4">const </span><span class="s1">DATE_PARSER = </span><span class="s4">function</span><span class="s1">(text, format) {</span>
  <span class="s4">if </span><span class="s1">(format === </span><span class="s3">'timestamp'</span><span class="s1">) </span><span class="s4">return new </span><span class="s1">Date(Number(text));</span>
  <span class="s4">return </span><span class="s1">parseDate(text, format);</span>
<span class="s1">};</span>
<span class="s4">const </span><span class="s1">RANGE_FORMATTER = </span><span class="s4">function</span><span class="s1">(value, format) {</span>
  <span class="s4">if </span><span class="s1">(Array.isArray(value) &amp;&amp; value.length === </span><span class="s5">2</span><span class="s1">) {</span>
    <span class="s4">const </span><span class="s1">start = value[</span><span class="s5">0</span><span class="s1">];</span>
    <span class="s4">const </span><span class="s1">end = value[</span><span class="s5">1</span><span class="s1">];</span>

    <span class="s4">if </span><span class="s1">(start &amp;&amp; end) {</span>
      <span class="s4">return </span><span class="s1">[DATE_FORMATTER(start, format), DATE_FORMATTER(end, format)];</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
  <span class="s4">return </span><span class="s3">''</span><span class="s1">;</span>
<span class="s1">};</span>
<span class="s4">const </span><span class="s1">RANGE_PARSER = </span><span class="s4">function</span><span class="s1">(array, format, separator) {</span>
  <span class="s4">if </span><span class="s1">(!Array.isArray(array)) {</span>
    <span class="s1">array = array.split(separator);</span>
  <span class="s1">}</span>
  <span class="s4">if </span><span class="s1">(array.length === </span><span class="s5">2</span><span class="s1">) {</span>
    <span class="s4">const </span><span class="s1">range1 = array[</span><span class="s5">0</span><span class="s1">];</span>
    <span class="s4">const </span><span class="s1">range2 = array[</span><span class="s5">1</span><span class="s1">];</span>

    <span class="s4">return </span><span class="s1">[DATE_PARSER(range1, format), DATE_PARSER(range2, format)];</span>
  <span class="s1">}</span>
  <span class="s4">return </span><span class="s1">[];</span>
<span class="s1">};</span>
<span class="s4">const </span><span class="s1">TYPE_VALUE_RESOLVER_MAP = {</span>
  <span class="s4">default</span><span class="s1">: {</span>
    <span class="s1">formatter(value) {</span>
      <span class="s4">if </span><span class="s1">(!value) </span><span class="s4">return </span><span class="s3">''</span><span class="s1">;</span>
      <span class="s4">return </span><span class="s3">'' </span><span class="s1">+ value;</span>
    <span class="s1">},</span>
    <span class="s1">parser(text) {</span>
      <span class="s4">if </span><span class="s1">(text === undefined || text === </span><span class="s3">''</span><span class="s1">) </span><span class="s4">return null</span><span class="s1">;</span>
      <span class="s4">return </span><span class="s1">text;</span>
    <span class="s1">}</span>
  <span class="s1">},</span>
  <span class="s1">week: {</span>
    <span class="s1">formatter(value, format) {</span>
      <span class="s4">let </span><span class="s1">week = getWeekNumber(value);</span>
      <span class="s4">let </span><span class="s1">month = value.getMonth();</span>
      <span class="s4">const </span><span class="s1">trueDate = </span><span class="s4">new </span><span class="s1">Date(value);</span>
      <span class="s4">if </span><span class="s1">(week === </span><span class="s5">1 </span><span class="s1">&amp;&amp; month === </span><span class="s5">11</span><span class="s1">) {</span>
        <span class="s1">trueDate.setHours(</span><span class="s5">0</span><span class="s1">, </span><span class="s5">0</span><span class="s1">, </span><span class="s5">0</span><span class="s1">, </span><span class="s5">0</span><span class="s1">);</span>
        <span class="s1">trueDate.setDate(trueDate.getDate() + </span><span class="s5">3 </span><span class="s1">- (trueDate.getDay() + </span><span class="s5">6</span><span class="s1">) % </span><span class="s5">7</span><span class="s1">);</span>
      <span class="s1">}</span>
      <span class="s4">let </span><span class="s1">date = formatDate(trueDate, format);</span>

      <span class="s1">date = </span><span class="s6">/WW/</span><span class="s1">.test(date)</span>
        <span class="s1">? date.replace(</span><span class="s6">/WW/</span><span class="s1">, week &lt; </span><span class="s5">10 </span><span class="s1">? </span><span class="s3">'0' </span><span class="s1">+ week : week)</span>
        <span class="s1">: date.replace(</span><span class="s6">/W/</span><span class="s1">, week);</span>
      <span class="s4">return </span><span class="s1">date;</span>
    <span class="s1">},</span>
    <span class="s1">parser(text, format) {</span>
      <span class="s7">// parse as if a normal date</span>
      <span class="s4">return </span><span class="s1">TYPE_VALUE_RESOLVER_MAP.date.parser(text, format);</span>
    <span class="s1">}</span>
  <span class="s1">},</span>
  <span class="s1">date: {</span>
    <span class="s1">formatter: DATE_FORMATTER,</span>
    <span class="s1">parser: DATE_PARSER</span>
  <span class="s1">},</span>
  <span class="s1">datetime: {</span>
    <span class="s1">formatter: DATE_FORMATTER,</span>
    <span class="s1">parser: DATE_PARSER</span>
  <span class="s1">},</span>
  <span class="s1">daterange: {</span>
    <span class="s1">formatter: RANGE_FORMATTER,</span>
    <span class="s1">parser: RANGE_PARSER</span>
  <span class="s1">},</span>
  <span class="s1">monthrange: {</span>
    <span class="s1">formatter: RANGE_FORMATTER,</span>
    <span class="s1">parser: RANGE_PARSER</span>
  <span class="s1">},</span>
  <span class="s1">datetimerange: {</span>
    <span class="s1">formatter: RANGE_FORMATTER,</span>
    <span class="s1">parser: RANGE_PARSER</span>
  <span class="s1">},</span>
  <span class="s1">timerange: {</span>
    <span class="s1">formatter: RANGE_FORMATTER,</span>
    <span class="s1">parser: RANGE_PARSER</span>
  <span class="s1">},</span>
  <span class="s1">time: {</span>
    <span class="s1">formatter: DATE_FORMATTER,</span>
    <span class="s1">parser: DATE_PARSER</span>
  <span class="s1">},</span>
  <span class="s1">month: {</span>
    <span class="s1">formatter: DATE_FORMATTER,</span>
    <span class="s1">parser: DATE_PARSER</span>
  <span class="s1">},</span>
  <span class="s1">year: {</span>
    <span class="s1">formatter: DATE_FORMATTER,</span>
    <span class="s1">parser: DATE_PARSER</span>
  <span class="s1">},</span>
  <span class="s1">number: {</span>
    <span class="s1">formatter(value) {</span>
      <span class="s4">if </span><span class="s1">(!value) </span><span class="s4">return </span><span class="s3">''</span><span class="s1">;</span>
      <span class="s4">return </span><span class="s3">'' </span><span class="s1">+ value;</span>
    <span class="s1">},</span>
    <span class="s1">parser(text) {</span>
      <span class="s4">let </span><span class="s1">result = Number(text);</span>

      <span class="s4">if </span><span class="s1">(!isNaN(text)) {</span>
        <span class="s4">return </span><span class="s1">result;</span>
      <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
        <span class="s4">return null</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">},</span>
  <span class="s1">dates: {</span>
    <span class="s1">formatter(value, format) {</span>
      <span class="s4">return </span><span class="s1">value.map(date =&gt; DATE_FORMATTER(date, format));</span>
    <span class="s1">},</span>
    <span class="s1">parser(value, format) {</span>
      <span class="s4">return </span><span class="s1">(</span><span class="s4">typeof </span><span class="s1">value === </span><span class="s3">'string' </span><span class="s1">? value.split(</span><span class="s3">', '</span><span class="s1">) : value)</span>
        <span class="s1">.map(date =&gt; date </span><span class="s4">instanceof </span><span class="s1">Date ? date : DATE_PARSER(date, format));</span>
    <span class="s1">}</span>
  <span class="s1">},</span>
  <span class="s1">months: {</span>
    <span class="s1">formatter(value, format) {</span>
      <span class="s4">return </span><span class="s1">value.map(date =&gt; DATE_FORMATTER(date, format));</span>
    <span class="s1">},</span>
    <span class="s1">parser(value, format) {</span>
      <span class="s4">return </span><span class="s1">(</span><span class="s4">typeof </span><span class="s1">value === </span><span class="s3">'string' </span><span class="s1">? value.split(</span><span class="s3">', '</span><span class="s1">) : value)</span>
        <span class="s1">.map(date =&gt; date </span><span class="s4">instanceof </span><span class="s1">Date ? date : DATE_PARSER(date, format));</span>
    <span class="s1">}</span>
  <span class="s1">},</span>
  <span class="s1">years: {</span>
    <span class="s1">formatter(value, format) {</span>
      <span class="s4">return </span><span class="s1">value.map(date =&gt; DATE_FORMATTER(date, format));</span>
    <span class="s1">},</span>
    <span class="s1">parser(value, format) {</span>
      <span class="s4">return </span><span class="s1">(</span><span class="s4">typeof </span><span class="s1">value === </span><span class="s3">'string' </span><span class="s1">? value.split(</span><span class="s3">', '</span><span class="s1">) : value)</span>
        <span class="s1">.map(date =&gt; date </span><span class="s4">instanceof </span><span class="s1">Date ? date : DATE_PARSER(date, format));</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
<span class="s1">};</span>
<span class="s4">const </span><span class="s1">PLACEMENT_MAP = {</span>
  <span class="s1">left: </span><span class="s3">'bottom-start'</span><span class="s1">,</span>
  <span class="s1">center: </span><span class="s3">'bottom'</span><span class="s1">,</span>
  <span class="s1">right: </span><span class="s3">'bottom-end'</span>
<span class="s1">};</span>

<span class="s4">const </span><span class="s1">parseAsFormatAndType = (value, customFormat, type, rangeSeparator = </span><span class="s3">'-'</span><span class="s1">) =&gt; {</span>
  <span class="s4">if </span><span class="s1">(!value) </span><span class="s4">return null</span><span class="s1">;</span>
  <span class="s4">const </span><span class="s1">parser = (</span>
    <span class="s1">TYPE_VALUE_RESOLVER_MAP[type] ||</span>
    <span class="s1">TYPE_VALUE_RESOLVER_MAP[</span><span class="s3">'default'</span><span class="s1">]</span>
  <span class="s1">).parser;</span>
  <span class="s4">const </span><span class="s1">format = customFormat || DEFAULT_FORMATS[type];</span>
  <span class="s4">return </span><span class="s1">parser(value, format, rangeSeparator);</span>
<span class="s1">};</span>

<span class="s4">const </span><span class="s1">formatAsFormatAndType = (value, customFormat, type) =&gt; {</span>
  <span class="s4">if </span><span class="s1">(!value) </span><span class="s4">return null</span><span class="s1">;</span>
  <span class="s4">const </span><span class="s1">formatter = (</span>
    <span class="s1">TYPE_VALUE_RESOLVER_MAP[type] ||</span>
    <span class="s1">TYPE_VALUE_RESOLVER_MAP[</span><span class="s3">'default'</span><span class="s1">]</span>
  <span class="s1">).formatter;</span>
  <span class="s4">const </span><span class="s1">format = customFormat || DEFAULT_FORMATS[type];</span>
  <span class="s4">return </span><span class="s1">formatter(value, format);</span>
<span class="s1">};</span>

<span class="s7">/* 
 * Considers: 
 *   1. Date object 
 *   2. date string 
 *   3. array of 1 or 2 
 */</span>
<span class="s4">const </span><span class="s1">valueEquals = </span><span class="s4">function</span><span class="s1">(a, b) {</span>
  <span class="s7">// considers Date object and string</span>
  <span class="s4">const </span><span class="s1">dateEquals = </span><span class="s4">function</span><span class="s1">(a, b) {</span>
    <span class="s4">const </span><span class="s1">aIsDate = a </span><span class="s4">instanceof </span><span class="s1">Date;</span>
    <span class="s4">const </span><span class="s1">bIsDate = b </span><span class="s4">instanceof </span><span class="s1">Date;</span>
    <span class="s4">if </span><span class="s1">(aIsDate &amp;&amp; bIsDate) {</span>
      <span class="s4">return </span><span class="s1">a.getTime() === b.getTime();</span>
    <span class="s1">}</span>
    <span class="s4">if </span><span class="s1">(!aIsDate &amp;&amp; !bIsDate) {</span>
      <span class="s4">return </span><span class="s1">a === b;</span>
    <span class="s1">}</span>
    <span class="s4">return false</span><span class="s1">;</span>
  <span class="s1">};</span>

  <span class="s4">const </span><span class="s1">aIsArray = a </span><span class="s4">instanceof </span><span class="s1">Array;</span>
  <span class="s4">const </span><span class="s1">bIsArray = b </span><span class="s4">instanceof </span><span class="s1">Array;</span>
  <span class="s4">if </span><span class="s1">(aIsArray &amp;&amp; bIsArray) {</span>
    <span class="s4">if </span><span class="s1">(a.length !== b.length) {</span>
      <span class="s4">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s4">return </span><span class="s1">a.every((item, index) =&gt; dateEquals(item, b[index]));</span>
  <span class="s1">}</span>
  <span class="s4">if </span><span class="s1">(!aIsArray &amp;&amp; !bIsArray) {</span>
    <span class="s4">return </span><span class="s1">dateEquals(a, b);</span>
  <span class="s1">}</span>
  <span class="s4">return false</span><span class="s1">;</span>
<span class="s1">};</span>

<span class="s4">const </span><span class="s1">isString = </span><span class="s4">function</span><span class="s1">(val) {</span>
  <span class="s4">return typeof </span><span class="s1">val === </span><span class="s3">'string' </span><span class="s1">|| val </span><span class="s4">instanceof </span><span class="s1">String;</span>
<span class="s1">};</span>

<span class="s4">const </span><span class="s1">validator = </span><span class="s4">function</span><span class="s1">(val) {</span>
  <span class="s7">// either: String, Array of String, null / undefined</span>
  <span class="s4">return </span><span class="s1">(</span>
    <span class="s1">val === </span><span class="s4">null </span><span class="s1">||</span>
    <span class="s1">val === undefined ||</span>
    <span class="s1">isString(val) ||</span>
    <span class="s1">(Array.isArray(val) &amp;&amp; val.length === </span><span class="s5">2 </span><span class="s1">&amp;&amp; val.every(isString))</span>
  <span class="s1">);</span>
<span class="s1">};</span>

<span class="s4">export default </span><span class="s1">{</span>
  <span class="s1">mixins: [Emitter, NewPopper],</span>

  <span class="s1">inject: {</span>
    <span class="s1">elForm: {</span>
      <span class="s4">default</span><span class="s1">: </span><span class="s3">''</span>
    <span class="s1">},</span>
    <span class="s1">elFormItem: {</span>
      <span class="s4">default</span><span class="s1">: </span><span class="s3">''</span>
    <span class="s1">}</span>
  <span class="s1">},</span>

  <span class="s1">props: {</span>
    <span class="s1">size: String,</span>
    <span class="s1">format: String,</span>
    <span class="s1">valueFormat: String,</span>
    <span class="s1">readonly: Boolean,</span>
    <span class="s1">placeholder: String,</span>
    <span class="s1">startPlaceholder: String,</span>
    <span class="s1">endPlaceholder: String,</span>
    <span class="s1">prefixIcon: String,</span>
    <span class="s1">clearIcon: {</span>
      <span class="s1">type: String,</span>
      <span class="s4">default</span><span class="s1">: </span><span class="s3">'el-icon-circle-close'</span>
    <span class="s1">},</span>
    <span class="s1">name: {</span>
      <span class="s4">default</span><span class="s1">: </span><span class="s3">''</span><span class="s1">,</span>
      <span class="s1">validator</span>
    <span class="s1">},</span>
    <span class="s1">disabled: Boolean,</span>
    <span class="s1">clearable: {</span>
      <span class="s1">type: Boolean,</span>
      <span class="s4">default</span><span class="s1">: </span><span class="s4">true</span>
    <span class="s1">},</span>
    <span class="s1">id: {</span>
      <span class="s4">default</span><span class="s1">: </span><span class="s3">''</span><span class="s1">,</span>
      <span class="s1">validator</span>
    <span class="s1">},</span>
    <span class="s1">popperClass: String,</span>
    <span class="s1">editable: {</span>
      <span class="s1">type: Boolean,</span>
      <span class="s4">default</span><span class="s1">: </span><span class="s4">true</span>
    <span class="s1">},</span>
    <span class="s1">align: {</span>
      <span class="s1">type: String,</span>
      <span class="s4">default</span><span class="s1">: </span><span class="s3">'left'</span>
    <span class="s1">},</span>
    <span class="s1">value: {},</span>
    <span class="s1">defaultValue: {},</span>
    <span class="s1">defaultTime: {},</span>
    <span class="s1">rangeSeparator: {</span>
      <span class="s4">default</span><span class="s1">: </span><span class="s3">'-'</span>
    <span class="s1">},</span>
    <span class="s1">pickerOptions: {},</span>
    <span class="s1">unlinkPanels: Boolean,</span>
    <span class="s1">validateEvent: {</span>
      <span class="s1">type: Boolean,</span>
      <span class="s4">default</span><span class="s1">: </span><span class="s4">true</span>
    <span class="s1">}</span>
  <span class="s1">},</span>

  <span class="s1">components: { ElInput },</span>

  <span class="s1">directives: { Clickoutside },</span>

  <span class="s1">data() {</span>
    <span class="s4">return </span><span class="s1">{</span>
      <span class="s1">pickerVisible: </span><span class="s4">false</span><span class="s1">,</span>
      <span class="s1">showClose: </span><span class="s4">false</span><span class="s1">,</span>
      <span class="s1">userInput: </span><span class="s4">null</span><span class="s1">,</span>
      <span class="s1">valueOnOpen: </span><span class="s4">null</span><span class="s1">, </span><span class="s7">// value when picker opens, used to determine whether to emit change</span>
      <span class="s1">unwatchPickerOptions: </span><span class="s4">null</span>
    <span class="s1">};</span>
  <span class="s1">},</span>

  <span class="s1">watch: {</span>
    <span class="s1">pickerVisible(val) {</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.readonly || </span><span class="s4">this</span><span class="s1">.pickerDisabled) </span><span class="s4">return</span><span class="s1">;</span>
      <span class="s4">if </span><span class="s1">(val) {</span>
        <span class="s4">this</span><span class="s1">.showPicker();</span>
        <span class="s4">this</span><span class="s1">.valueOnOpen = Array.isArray(</span><span class="s4">this</span><span class="s1">.value) ? [...</span><span class="s4">this</span><span class="s1">.value] : </span><span class="s4">this</span><span class="s1">.value;</span>
      <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
        <span class="s4">this</span><span class="s1">.hidePicker();</span>
        <span class="s4">this</span><span class="s1">.emitChange(</span><span class="s4">this</span><span class="s1">.value);</span>
        <span class="s4">this</span><span class="s1">.userInput = </span><span class="s4">null</span><span class="s1">;</span>
        <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.validateEvent) {</span>
          <span class="s4">this</span><span class="s1">.dispatch(</span><span class="s3">'ElFormItem'</span><span class="s1">, </span><span class="s3">'el.form.blur'</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s4">this</span><span class="s1">.$emit(</span><span class="s3">'blur'</span><span class="s1">, </span><span class="s4">this</span><span class="s1">);</span>
        <span class="s4">this</span><span class="s1">.blur();</span>
      <span class="s1">}</span>
    <span class="s1">},</span>
    <span class="s1">parsedValue: {</span>
      <span class="s1">immediate: </span><span class="s4">true</span><span class="s1">,</span>
      <span class="s1">handler(val) {</span>
        <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.picker) {</span>
          <span class="s4">this</span><span class="s1">.picker.value = val;</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">},</span>
    <span class="s1">defaultValue(val) {</span>
      <span class="s7">// NOTE: should eventually move to jsx style picker + panel ?</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.picker) {</span>
        <span class="s4">this</span><span class="s1">.picker.defaultValue = val;</span>
      <span class="s1">}</span>
    <span class="s1">},</span>
    <span class="s1">value(val, oldVal) {</span>
      <span class="s4">if </span><span class="s1">(!valueEquals(val, oldVal) &amp;&amp; !</span><span class="s4">this</span><span class="s1">.pickerVisible &amp;&amp; </span><span class="s4">this</span><span class="s1">.validateEvent) {</span>
        <span class="s4">this</span><span class="s1">.dispatch(</span><span class="s3">'ElFormItem'</span><span class="s1">, </span><span class="s3">'el.form.change'</span><span class="s1">, val);</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">},</span>

  <span class="s1">computed: {</span>
    <span class="s1">ranged() {</span>
      <span class="s4">return this</span><span class="s1">.type.indexOf(</span><span class="s3">'range'</span><span class="s1">) &gt; -</span><span class="s5">1</span><span class="s1">;</span>
    <span class="s1">},</span>

    <span class="s1">reference() {</span>
      <span class="s4">const </span><span class="s1">reference = </span><span class="s4">this</span><span class="s1">.$refs.reference;</span>
      <span class="s4">return </span><span class="s1">reference.$el || reference;</span>
    <span class="s1">},</span>

    <span class="s1">refInput() {</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.reference) {</span>
        <span class="s4">return </span><span class="s1">[].slice.call(</span><span class="s4">this</span><span class="s1">.reference.querySelectorAll(</span><span class="s3">'input'</span><span class="s1">));</span>
      <span class="s1">}</span>
      <span class="s4">return </span><span class="s1">[];</span>
    <span class="s1">},</span>

    <span class="s1">valueIsEmpty() {</span>
      <span class="s4">const </span><span class="s1">val = </span><span class="s4">this</span><span class="s1">.value;</span>
      <span class="s4">if </span><span class="s1">(Array.isArray(val)) {</span>
        <span class="s4">for </span><span class="s1">(</span><span class="s4">let </span><span class="s1">i = </span><span class="s5">0</span><span class="s1">, len = val.length; i &lt; len; i++) {</span>
          <span class="s4">if </span><span class="s1">(val[i]) {</span>
            <span class="s4">return false</span><span class="s1">;</span>
          <span class="s1">}</span>
        <span class="s1">}</span>
      <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
        <span class="s4">if </span><span class="s1">(val) {</span>
          <span class="s4">return false</span><span class="s1">;</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
      <span class="s4">return true</span><span class="s1">;</span>
    <span class="s1">},</span>

    <span class="s1">triggerClass() {</span>
      <span class="s4">return this</span><span class="s1">.prefixIcon || (</span><span class="s4">this</span><span class="s1">.type.indexOf(</span><span class="s3">'time'</span><span class="s1">) !== -</span><span class="s5">1 </span><span class="s1">? </span><span class="s3">'el-icon-time' </span><span class="s1">: </span><span class="s3">'el-icon-date'</span><span class="s1">);</span>
    <span class="s1">},</span>

    <span class="s1">selectionMode() {</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'week'</span><span class="s1">) {</span>
        <span class="s4">return </span><span class="s3">'week'</span><span class="s1">;</span>
      <span class="s1">} </span><span class="s4">else if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'month'</span><span class="s1">) {</span>
        <span class="s4">return </span><span class="s3">'month'</span><span class="s1">;</span>
      <span class="s1">} </span><span class="s4">else if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'year'</span><span class="s1">) {</span>
        <span class="s4">return </span><span class="s3">'year'</span><span class="s1">;</span>
      <span class="s1">} </span><span class="s4">else if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'dates'</span><span class="s1">) {</span>
        <span class="s4">return </span><span class="s3">'dates'</span><span class="s1">;</span>
      <span class="s1">} </span><span class="s4">else if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'months'</span><span class="s1">) {</span>
        <span class="s4">return </span><span class="s3">'months'</span><span class="s1">;</span>
      <span class="s1">} </span><span class="s4">else if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'years'</span><span class="s1">) {</span>
        <span class="s4">return </span><span class="s3">'years'</span><span class="s1">;</span>
      <span class="s1">}</span>

      <span class="s4">return </span><span class="s3">'day'</span><span class="s1">;</span>
    <span class="s1">},</span>

    <span class="s1">haveTrigger() {</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">typeof this</span><span class="s1">.showTrigger !== </span><span class="s3">'undefined'</span><span class="s1">) {</span>
        <span class="s4">return this</span><span class="s1">.showTrigger;</span>
      <span class="s1">}</span>
      <span class="s4">return </span><span class="s1">HAVE_TRIGGER_TYPES.indexOf(</span><span class="s4">this</span><span class="s1">.type) !== -</span><span class="s5">1</span><span class="s1">;</span>
    <span class="s1">},</span>

    <span class="s1">displayValue() {</span>
      <span class="s4">const </span><span class="s1">formattedValue = formatAsFormatAndType(</span><span class="s4">this</span><span class="s1">.parsedValue, </span><span class="s4">this</span><span class="s1">.format, </span><span class="s4">this</span><span class="s1">.type, </span><span class="s4">this</span><span class="s1">.rangeSeparator);</span>
      <span class="s4">if </span><span class="s1">(Array.isArray(</span><span class="s4">this</span><span class="s1">.userInput)) {</span>
        <span class="s4">return </span><span class="s1">[</span>
          <span class="s4">this</span><span class="s1">.userInput[</span><span class="s5">0</span><span class="s1">] || (formattedValue &amp;&amp; formattedValue[</span><span class="s5">0</span><span class="s1">]) || </span><span class="s3">''</span><span class="s1">,</span>
          <span class="s4">this</span><span class="s1">.userInput[</span><span class="s5">1</span><span class="s1">] || (formattedValue &amp;&amp; formattedValue[</span><span class="s5">1</span><span class="s1">]) || </span><span class="s3">''</span>
        <span class="s1">];</span>
      <span class="s1">} </span><span class="s4">else if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.userInput !== </span><span class="s4">null</span><span class="s1">) {</span>
        <span class="s4">return this</span><span class="s1">.userInput;</span>
      <span class="s1">} </span><span class="s4">else if </span><span class="s1">(formattedValue) {</span>
        <span class="s4">return </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'dates' </span><span class="s1">|| </span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'years' </span><span class="s1">|| </span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'months'</span><span class="s1">)</span>
          <span class="s1">? formattedValue.join(</span><span class="s3">', '</span><span class="s1">)</span>
          <span class="s1">: formattedValue;</span>
      <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
        <span class="s4">return </span><span class="s3">''</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">parsedValue() {</span>
      <span class="s4">if </span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.value) </span><span class="s4">return this</span><span class="s1">.value; </span><span class="s7">// component value is not set</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'time-select'</span><span class="s1">) </span><span class="s4">return this</span><span class="s1">.value; </span><span class="s7">// time-select does not require parsing, this might change in next major version</span>

      <span class="s4">const </span><span class="s1">valueIsDateObject = isDateObject(</span><span class="s4">this</span><span class="s1">.value) || (Array.isArray(</span><span class="s4">this</span><span class="s1">.value) &amp;&amp; </span><span class="s4">this</span><span class="s1">.value.every(isDateObject));</span>
      <span class="s4">if </span><span class="s1">(valueIsDateObject) {</span>
        <span class="s4">return this</span><span class="s1">.value;</span>
      <span class="s1">}</span>

      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.valueFormat) {</span>
        <span class="s4">return </span><span class="s1">parseAsFormatAndType(</span><span class="s4">this</span><span class="s1">.value, </span><span class="s4">this</span><span class="s1">.valueFormat, </span><span class="s4">this</span><span class="s1">.type, </span><span class="s4">this</span><span class="s1">.rangeSeparator) || </span><span class="s4">this</span><span class="s1">.value;</span>
      <span class="s1">}</span>

      <span class="s7">// NOTE: deal with common but incorrect usage, should remove in next major version</span>
      <span class="s7">// user might provide string / timestamp without value-format, coerce them into date (or array of date)</span>
      <span class="s4">return </span><span class="s1">Array.isArray(</span><span class="s4">this</span><span class="s1">.value) ? </span><span class="s4">this</span><span class="s1">.value.map(val =&gt; </span><span class="s4">new </span><span class="s1">Date(val)) : </span><span class="s4">new </span><span class="s1">Date(</span><span class="s4">this</span><span class="s1">.value);</span>
    <span class="s1">},</span>

    <span class="s1">_elFormItemSize() {</span>
      <span class="s4">return </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.elFormItem || {}).elFormItemSize;</span>
    <span class="s1">},</span>

    <span class="s1">pickerSize() {</span>
      <span class="s4">return this</span><span class="s1">.size || </span><span class="s4">this</span><span class="s1">._elFormItemSize || (</span><span class="s4">this</span><span class="s1">.$ELEMENT || {}).size;</span>
    <span class="s1">},</span>

    <span class="s1">pickerDisabled() {</span>
      <span class="s4">return this</span><span class="s1">.disabled || (</span><span class="s4">this</span><span class="s1">.elForm || {}).disabled;</span>
    <span class="s1">},</span>

    <span class="s1">firstInputId() {</span>
      <span class="s4">const </span><span class="s1">obj = {};</span>
      <span class="s4">let </span><span class="s1">id;</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.ranged) {</span>
        <span class="s1">id = </span><span class="s4">this</span><span class="s1">.id &amp;&amp; </span><span class="s4">this</span><span class="s1">.id[</span><span class="s5">0</span><span class="s1">];</span>
      <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
        <span class="s1">id = </span><span class="s4">this</span><span class="s1">.id;</span>
      <span class="s1">}</span>
      <span class="s4">if </span><span class="s1">(id) obj.id = id;</span>
      <span class="s4">return </span><span class="s1">obj;</span>
    <span class="s1">},</span>

    <span class="s1">secondInputId() {</span>
      <span class="s4">const </span><span class="s1">obj = {};</span>
      <span class="s4">let </span><span class="s1">id;</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.ranged) {</span>
        <span class="s1">id = </span><span class="s4">this</span><span class="s1">.id &amp;&amp; </span><span class="s4">this</span><span class="s1">.id[</span><span class="s5">1</span><span class="s1">];</span>
      <span class="s1">}</span>
      <span class="s4">if </span><span class="s1">(id) obj.id = id;</span>
      <span class="s4">return </span><span class="s1">obj;</span>
    <span class="s1">}</span>
  <span class="s1">},</span>

  <span class="s1">created() {</span>
    <span class="s7">// vue-popper</span>
    <span class="s4">this</span><span class="s1">.popperOptions = {</span>
      <span class="s1">boundariesPadding: </span><span class="s5">0</span><span class="s1">,</span>
      <span class="s1">gpuAcceleration: </span><span class="s4">false</span>
    <span class="s1">};</span>
    <span class="s4">this</span><span class="s1">.placement = PLACEMENT_MAP[</span><span class="s4">this</span><span class="s1">.align] || PLACEMENT_MAP.left;</span>

    <span class="s4">this</span><span class="s1">.$on(</span><span class="s3">'fieldReset'</span><span class="s1">, </span><span class="s4">this</span><span class="s1">.handleFieldReset);</span>
  <span class="s1">},</span>

  <span class="s1">methods: {</span>
    <span class="s1">focus() {</span>
      <span class="s4">if </span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.ranged) {</span>
        <span class="s4">this</span><span class="s1">.$refs.reference.focus();</span>
      <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
        <span class="s4">this</span><span class="s1">.handleFocus();</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">blur() {</span>
      <span class="s4">this</span><span class="s1">.refInput.forEach(input =&gt; input.blur());</span>
    <span class="s1">},</span>

    <span class="s7">// {parse, formatTo} Value deals maps component value with internal Date</span>
    <span class="s1">parseValue(value) {</span>
      <span class="s4">const </span><span class="s1">isParsed = isDateObject(value) || (Array.isArray(value) &amp;&amp; value.every(isDateObject));</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.valueFormat &amp;&amp; !isParsed) {</span>
        <span class="s4">return </span><span class="s1">parseAsFormatAndType(value, </span><span class="s4">this</span><span class="s1">.valueFormat, </span><span class="s4">this</span><span class="s1">.type, </span><span class="s4">this</span><span class="s1">.rangeSeparator) || value;</span>
      <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
        <span class="s4">return </span><span class="s1">value;</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">formatToValue(date) {</span>
      <span class="s4">const </span><span class="s1">isFormattable = isDateObject(date) || (Array.isArray(date) &amp;&amp; date.every(isDateObject));</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.valueFormat &amp;&amp; isFormattable) {</span>
        <span class="s4">return </span><span class="s1">formatAsFormatAndType(date, </span><span class="s4">this</span><span class="s1">.valueFormat, </span><span class="s4">this</span><span class="s1">.type, </span><span class="s4">this</span><span class="s1">.rangeSeparator);</span>
      <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
        <span class="s4">return </span><span class="s1">date;</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s7">// {parse, formatTo} String deals with user input</span>
    <span class="s1">parseString(value) {</span>
      <span class="s4">const </span><span class="s1">type = Array.isArray(value) ? </span><span class="s4">this</span><span class="s1">.type : </span><span class="s4">this</span><span class="s1">.type.replace(</span><span class="s3">'range'</span><span class="s1">, </span><span class="s3">''</span><span class="s1">);</span>
      <span class="s4">return </span><span class="s1">parseAsFormatAndType(value, </span><span class="s4">this</span><span class="s1">.format, type);</span>
    <span class="s1">},</span>

    <span class="s1">formatToString(value) {</span>
      <span class="s4">const </span><span class="s1">type = Array.isArray(value) ? </span><span class="s4">this</span><span class="s1">.type : </span><span class="s4">this</span><span class="s1">.type.replace(</span><span class="s3">'range'</span><span class="s1">, </span><span class="s3">''</span><span class="s1">);</span>
      <span class="s4">return </span><span class="s1">formatAsFormatAndType(value, </span><span class="s4">this</span><span class="s1">.format, type);</span>
    <span class="s1">},</span>

    <span class="s1">handleMouseEnter() {</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.readonly || </span><span class="s4">this</span><span class="s1">.pickerDisabled) </span><span class="s4">return</span><span class="s1">;</span>
      <span class="s4">if </span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.valueIsEmpty &amp;&amp; </span><span class="s4">this</span><span class="s1">.clearable) {</span>
        <span class="s4">this</span><span class="s1">.showClose = </span><span class="s4">true</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">handleChange() {</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.userInput) {</span>
        <span class="s4">const </span><span class="s1">value = </span><span class="s4">this</span><span class="s1">.parseString(</span><span class="s4">this</span><span class="s1">.displayValue);</span>
        <span class="s4">if </span><span class="s1">(value) {</span>
          <span class="s4">this</span><span class="s1">.picker.value = value;</span>
          <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.isValidValue(value)) {</span>
            <span class="s4">this</span><span class="s1">.emitInput(value);</span>
            <span class="s4">this</span><span class="s1">.userInput = </span><span class="s4">null</span><span class="s1">;</span>
          <span class="s1">}</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.userInput === </span><span class="s3">''</span><span class="s1">) {</span>
        <span class="s4">this</span><span class="s1">.emitInput(</span><span class="s4">null</span><span class="s1">);</span>
        <span class="s4">this</span><span class="s1">.emitChange(</span><span class="s4">null</span><span class="s1">);</span>
        <span class="s4">this</span><span class="s1">.userInput = </span><span class="s4">null</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">handleStartInput(event) {</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.userInput) {</span>
        <span class="s4">this</span><span class="s1">.userInput = [event.target.value, </span><span class="s4">this</span><span class="s1">.userInput[</span><span class="s5">1</span><span class="s1">]];</span>
      <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
        <span class="s4">this</span><span class="s1">.userInput = [event.target.value, </span><span class="s4">null</span><span class="s1">];</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">handleEndInput(event) {</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.userInput) {</span>
        <span class="s4">this</span><span class="s1">.userInput = [</span><span class="s4">this</span><span class="s1">.userInput[</span><span class="s5">0</span><span class="s1">], event.target.value];</span>
      <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
        <span class="s4">this</span><span class="s1">.userInput = [</span><span class="s4">null</span><span class="s1">, event.target.value];</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">handleStartChange(event) {</span>
      <span class="s4">const </span><span class="s1">value = </span><span class="s4">this</span><span class="s1">.parseString(</span><span class="s4">this</span><span class="s1">.userInput &amp;&amp; </span><span class="s4">this</span><span class="s1">.userInput[</span><span class="s5">0</span><span class="s1">]);</span>
      <span class="s4">if </span><span class="s1">(value) {</span>
        <span class="s4">this</span><span class="s1">.userInput = [</span><span class="s4">this</span><span class="s1">.formatToString(value), </span><span class="s4">this</span><span class="s1">.displayValue[</span><span class="s5">1</span><span class="s1">]];</span>
        <span class="s4">const </span><span class="s1">newValue = [value, </span><span class="s4">this</span><span class="s1">.picker.value &amp;&amp; </span><span class="s4">this</span><span class="s1">.picker.value[</span><span class="s5">1</span><span class="s1">]];</span>
        <span class="s4">this</span><span class="s1">.picker.value = newValue;</span>
        <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.isValidValue(newValue)) {</span>
          <span class="s4">this</span><span class="s1">.emitInput(newValue);</span>
          <span class="s4">this</span><span class="s1">.userInput = </span><span class="s4">null</span><span class="s1">;</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">handleEndChange(event) {</span>
      <span class="s4">const </span><span class="s1">value = </span><span class="s4">this</span><span class="s1">.parseString(</span><span class="s4">this</span><span class="s1">.userInput &amp;&amp; </span><span class="s4">this</span><span class="s1">.userInput[</span><span class="s5">1</span><span class="s1">]);</span>
      <span class="s4">if </span><span class="s1">(value) {</span>
        <span class="s4">this</span><span class="s1">.userInput = [</span><span class="s4">this</span><span class="s1">.displayValue[</span><span class="s5">0</span><span class="s1">], </span><span class="s4">this</span><span class="s1">.formatToString(value)];</span>
        <span class="s4">const </span><span class="s1">newValue = [</span><span class="s4">this</span><span class="s1">.picker.value &amp;&amp; </span><span class="s4">this</span><span class="s1">.picker.value[</span><span class="s5">0</span><span class="s1">], value];</span>
        <span class="s4">this</span><span class="s1">.picker.value = newValue;</span>
        <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.isValidValue(newValue)) {</span>
          <span class="s4">this</span><span class="s1">.emitInput(newValue);</span>
          <span class="s4">this</span><span class="s1">.userInput = </span><span class="s4">null</span><span class="s1">;</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">handleClickIcon(event) {</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.readonly || </span><span class="s4">this</span><span class="s1">.pickerDisabled) </span><span class="s4">return</span><span class="s1">;</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.showClose) {</span>
        <span class="s4">this</span><span class="s1">.valueOnOpen = </span><span class="s4">this</span><span class="s1">.value;</span>
        <span class="s1">event.stopPropagation();</span>
        <span class="s4">this</span><span class="s1">.emitInput(</span><span class="s4">null</span><span class="s1">);</span>
        <span class="s4">this</span><span class="s1">.emitChange(</span><span class="s4">null</span><span class="s1">);</span>
        <span class="s4">this</span><span class="s1">.showClose = </span><span class="s4">false</span><span class="s1">;</span>
        <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.picker &amp;&amp; </span><span class="s4">typeof this</span><span class="s1">.picker.handleClear === </span><span class="s3">'function'</span><span class="s1">) {</span>
          <span class="s4">this</span><span class="s1">.picker.handleClear();</span>
        <span class="s1">}</span>
      <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
        <span class="s4">this</span><span class="s1">.pickerVisible = !</span><span class="s4">this</span><span class="s1">.pickerVisible;</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">handleClose() {</span>
      <span class="s4">if </span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.pickerVisible) </span><span class="s4">return</span><span class="s1">;</span>
      <span class="s4">this</span><span class="s1">.pickerVisible = </span><span class="s4">false</span><span class="s1">;</span>

      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'dates' </span><span class="s1">|| </span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'years' </span><span class="s1">|| </span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'months'</span><span class="s1">) {</span>
        <span class="s7">// restore to former value</span>
        <span class="s4">const </span><span class="s1">oldValue = parseAsFormatAndType(</span><span class="s4">this</span><span class="s1">.valueOnOpen, </span><span class="s4">this</span><span class="s1">.valueFormat, </span><span class="s4">this</span><span class="s1">.type, </span><span class="s4">this</span><span class="s1">.rangeSeparator) || </span><span class="s4">this</span><span class="s1">.valueOnOpen;</span>
        <span class="s4">this</span><span class="s1">.emitInput(oldValue);</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">handleFieldReset(initialValue) {</span>
      <span class="s4">this</span><span class="s1">.userInput = initialValue === </span><span class="s3">'' </span><span class="s1">? </span><span class="s4">null </span><span class="s1">: initialValue;</span>
    <span class="s1">},</span>

    <span class="s1">handleFocus() {</span>
      <span class="s4">const </span><span class="s1">type = </span><span class="s4">this</span><span class="s1">.type;</span>

      <span class="s4">if </span><span class="s1">(HAVE_TRIGGER_TYPES.indexOf(type) !== -</span><span class="s5">1 </span><span class="s1">&amp;&amp; !</span><span class="s4">this</span><span class="s1">.pickerVisible) {</span>
        <span class="s4">this</span><span class="s1">.pickerVisible = </span><span class="s4">true</span><span class="s1">;</span>
      <span class="s1">}</span>
      <span class="s4">this</span><span class="s1">.$emit(</span><span class="s3">'focus'</span><span class="s1">, </span><span class="s4">this</span><span class="s1">);</span>
    <span class="s1">},</span>

    <span class="s1">handleKeydown(event) {</span>
      <span class="s4">const </span><span class="s1">keyCode = event.keyCode;</span>

      <span class="s7">// ESC</span>
      <span class="s4">if </span><span class="s1">(keyCode === </span><span class="s5">27</span><span class="s1">) {</span>
        <span class="s4">this</span><span class="s1">.pickerVisible = </span><span class="s4">false</span><span class="s1">;</span>
        <span class="s1">event.stopPropagation();</span>
        <span class="s4">return</span><span class="s1">;</span>
      <span class="s1">}</span>

      <span class="s7">// Tab</span>
      <span class="s4">if </span><span class="s1">(keyCode === </span><span class="s5">9</span><span class="s1">) {</span>
        <span class="s4">if </span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.ranged) {</span>
          <span class="s4">this</span><span class="s1">.handleChange();</span>
          <span class="s4">this</span><span class="s1">.pickerVisible = </span><span class="s4">this</span><span class="s1">.picker.visible = </span><span class="s4">false</span><span class="s1">;</span>
          <span class="s4">this</span><span class="s1">.blur();</span>
          <span class="s1">event.stopPropagation();</span>
        <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
          <span class="s7">// user may change focus between two input</span>
          <span class="s1">setTimeout(() =&gt; {</span>
            <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.refInput.indexOf(document.activeElement) === -</span><span class="s5">1</span><span class="s1">) {</span>
              <span class="s4">this</span><span class="s1">.pickerVisible = </span><span class="s4">false</span><span class="s1">;</span>
              <span class="s4">this</span><span class="s1">.blur();</span>
              <span class="s1">event.stopPropagation();</span>
            <span class="s1">}</span>
          <span class="s1">}, </span><span class="s5">0</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s4">return</span><span class="s1">;</span>
      <span class="s1">}</span>

      <span class="s7">// Enter</span>
      <span class="s4">if </span><span class="s1">(keyCode === </span><span class="s5">13</span><span class="s1">) {</span>
        <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.userInput === </span><span class="s3">'' </span><span class="s1">|| </span><span class="s4">this</span><span class="s1">.isValidValue(</span><span class="s4">this</span><span class="s1">.parseString(</span><span class="s4">this</span><span class="s1">.displayValue))) {</span>
          <span class="s4">this</span><span class="s1">.handleChange();</span>
          <span class="s4">this</span><span class="s1">.pickerVisible = </span><span class="s4">this</span><span class="s1">.picker.visible = </span><span class="s4">false</span><span class="s1">;</span>
          <span class="s4">this</span><span class="s1">.blur();</span>
        <span class="s1">}</span>
        <span class="s1">event.stopPropagation();</span>
        <span class="s4">return</span><span class="s1">;</span>
      <span class="s1">}</span>

      <span class="s7">// if user is typing, do not let picker handle key input</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.userInput) {</span>
        <span class="s1">event.stopPropagation();</span>
        <span class="s4">return</span><span class="s1">;</span>
      <span class="s1">}</span>

      <span class="s7">// delegate other keys to panel</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.picker &amp;&amp; </span><span class="s4">this</span><span class="s1">.picker.handleKeydown) {</span>
        <span class="s4">this</span><span class="s1">.picker.handleKeydown(event);</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">handleRangeClick() {</span>
      <span class="s4">const </span><span class="s1">type = </span><span class="s4">this</span><span class="s1">.type;</span>

      <span class="s4">if </span><span class="s1">(HAVE_TRIGGER_TYPES.indexOf(type) !== -</span><span class="s5">1 </span><span class="s1">&amp;&amp; !</span><span class="s4">this</span><span class="s1">.pickerVisible) {</span>
        <span class="s4">this</span><span class="s1">.pickerVisible = </span><span class="s4">true</span><span class="s1">;</span>
      <span class="s1">}</span>
      <span class="s4">this</span><span class="s1">.$emit(</span><span class="s3">'focus'</span><span class="s1">, </span><span class="s4">this</span><span class="s1">);</span>
    <span class="s1">},</span>

    <span class="s1">hidePicker() {</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.picker) {</span>
        <span class="s4">this</span><span class="s1">.picker.resetView &amp;&amp; </span><span class="s4">this</span><span class="s1">.picker.resetView();</span>
        <span class="s4">this</span><span class="s1">.pickerVisible = </span><span class="s4">this</span><span class="s1">.picker.visible = </span><span class="s4">false</span><span class="s1">;</span>
        <span class="s4">this</span><span class="s1">.destroyPopper();</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">showPicker() {</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.$isServer) </span><span class="s4">return</span><span class="s1">;</span>
      <span class="s4">if </span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.picker) {</span>
        <span class="s4">this</span><span class="s1">.mountPicker();</span>
      <span class="s1">}</span>
      <span class="s4">this</span><span class="s1">.pickerVisible = </span><span class="s4">this</span><span class="s1">.picker.visible = </span><span class="s4">true</span><span class="s1">;</span>

      <span class="s4">this</span><span class="s1">.updatePopper();</span>

      <span class="s4">this</span><span class="s1">.picker.value = </span><span class="s4">this</span><span class="s1">.parsedValue;</span>
      <span class="s4">this</span><span class="s1">.picker.resetView &amp;&amp; </span><span class="s4">this</span><span class="s1">.picker.resetView();</span>

      <span class="s4">this</span><span class="s1">.$nextTick(() =&gt; {</span>
        <span class="s4">this</span><span class="s1">.picker.adjustSpinners &amp;&amp; </span><span class="s4">this</span><span class="s1">.picker.adjustSpinners();</span>
      <span class="s1">});</span>
    <span class="s1">},</span>

    <span class="s1">mountPicker() {</span>
      <span class="s4">this</span><span class="s1">.picker = </span><span class="s4">new </span><span class="s1">Vue(</span><span class="s4">this</span><span class="s1">.panel).$mount();</span>
      <span class="s4">this</span><span class="s1">.picker.defaultValue = </span><span class="s4">this</span><span class="s1">.defaultValue;</span>
      <span class="s4">this</span><span class="s1">.picker.defaultTime = </span><span class="s4">this</span><span class="s1">.defaultTime;</span>
      <span class="s4">this</span><span class="s1">.picker.popperClass = </span><span class="s4">this</span><span class="s1">.popperClass;</span>
      <span class="s4">this</span><span class="s1">.popperElm = </span><span class="s4">this</span><span class="s1">.picker.$el;</span>
      <span class="s4">this</span><span class="s1">.picker.width = </span><span class="s4">this</span><span class="s1">.reference.getBoundingClientRect().width;</span>
      <span class="s4">this</span><span class="s1">.picker.showTime = </span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'datetime' </span><span class="s1">|| </span><span class="s4">this</span><span class="s1">.type === </span><span class="s3">'datetimerange'</span><span class="s1">;</span>
      <span class="s4">this</span><span class="s1">.picker.selectionMode = </span><span class="s4">this</span><span class="s1">.selectionMode;</span>
      <span class="s4">this</span><span class="s1">.picker.unlinkPanels = </span><span class="s4">this</span><span class="s1">.unlinkPanels;</span>
      <span class="s4">this</span><span class="s1">.picker.arrowControl = </span><span class="s4">this</span><span class="s1">.arrowControl || </span><span class="s4">this</span><span class="s1">.timeArrowControl || </span><span class="s4">false</span><span class="s1">;</span>
      <span class="s4">this</span><span class="s1">.$watch(</span><span class="s3">'format'</span><span class="s1">, (format) =&gt; {</span>
        <span class="s4">this</span><span class="s1">.picker.format = format;</span>
      <span class="s1">});</span>

      <span class="s4">const </span><span class="s1">updateOptions = () =&gt; {</span>
        <span class="s4">const </span><span class="s1">options = </span><span class="s4">this</span><span class="s1">.pickerOptions;</span>

        <span class="s4">if </span><span class="s1">(options &amp;&amp; options.selectableRange) {</span>
          <span class="s4">let </span><span class="s1">ranges = options.selectableRange;</span>
          <span class="s4">const </span><span class="s1">parser = TYPE_VALUE_RESOLVER_MAP.datetimerange.parser;</span>
          <span class="s4">const </span><span class="s1">format = DEFAULT_FORMATS.timerange;</span>

          <span class="s1">ranges = Array.isArray(ranges) ? ranges : [ranges];</span>
          <span class="s4">this</span><span class="s1">.picker.selectableRange = ranges.map(range =&gt; parser(range, format, </span><span class="s4">this</span><span class="s1">.rangeSeparator));</span>
        <span class="s1">}</span>

        <span class="s4">for </span><span class="s1">(</span><span class="s4">const </span><span class="s1">option </span><span class="s4">in </span><span class="s1">options) {</span>
          <span class="s4">if </span><span class="s1">(options.hasOwnProperty(option) &amp;&amp;</span>
              <span class="s7">// 忽略 time-picker 的该配置项</span>
              <span class="s1">option !== </span><span class="s3">'selectableRange'</span><span class="s1">) {</span>
            <span class="s4">this</span><span class="s1">.picker[option] = options[option];</span>
          <span class="s1">}</span>
        <span class="s1">}</span>

        <span class="s7">// main format must prevail over undocumented pickerOptions.format</span>
        <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.format) {</span>
          <span class="s4">this</span><span class="s1">.picker.format = </span><span class="s4">this</span><span class="s1">.format;</span>
        <span class="s1">}</span>
      <span class="s1">};</span>
      <span class="s1">updateOptions();</span>
      <span class="s4">this</span><span class="s1">.unwatchPickerOptions = </span><span class="s4">this</span><span class="s1">.$watch(</span><span class="s3">'pickerOptions'</span><span class="s1">, () =&gt; updateOptions(), { deep: </span><span class="s4">true </span><span class="s1">});</span>
      <span class="s4">this</span><span class="s1">.$el.appendChild(</span><span class="s4">this</span><span class="s1">.picker.$el);</span>
      <span class="s4">this</span><span class="s1">.picker.resetView &amp;&amp; </span><span class="s4">this</span><span class="s1">.picker.resetView();</span>

      <span class="s4">this</span><span class="s1">.picker.$on(</span><span class="s3">'dodestroy'</span><span class="s1">, </span><span class="s4">this</span><span class="s1">.doDestroy);</span>
      <span class="s4">this</span><span class="s1">.picker.$on(</span><span class="s3">'pick'</span><span class="s1">, (date = </span><span class="s3">''</span><span class="s1">, visible = </span><span class="s4">false</span><span class="s1">) =&gt; {</span>
        <span class="s4">this</span><span class="s1">.userInput = </span><span class="s4">null</span><span class="s1">;</span>
        <span class="s4">this</span><span class="s1">.pickerVisible = </span><span class="s4">this</span><span class="s1">.picker.visible = visible;</span>
        <span class="s4">this</span><span class="s1">.emitInput(date);</span>
        <span class="s4">this</span><span class="s1">.picker.resetView &amp;&amp; </span><span class="s4">this</span><span class="s1">.picker.resetView();</span>
      <span class="s1">});</span>

      <span class="s4">this</span><span class="s1">.picker.$on(</span><span class="s3">'select-range'</span><span class="s1">, (start, end, pos) =&gt; {</span>
        <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.refInput.length === </span><span class="s5">0</span><span class="s1">) </span><span class="s4">return</span><span class="s1">;</span>
        <span class="s4">if </span><span class="s1">(!pos || pos === </span><span class="s3">'min'</span><span class="s1">) {</span>
          <span class="s4">this</span><span class="s1">.refInput[</span><span class="s5">0</span><span class="s1">].setSelectionRange(start, end);</span>
          <span class="s4">this</span><span class="s1">.refInput[</span><span class="s5">0</span><span class="s1">].focus();</span>
        <span class="s1">} </span><span class="s4">else if </span><span class="s1">(pos === </span><span class="s3">'max'</span><span class="s1">) {</span>
          <span class="s4">this</span><span class="s1">.refInput[</span><span class="s5">1</span><span class="s1">].setSelectionRange(start, end);</span>
          <span class="s4">this</span><span class="s1">.refInput[</span><span class="s5">1</span><span class="s1">].focus();</span>
        <span class="s1">}</span>
      <span class="s1">});</span>
    <span class="s1">},</span>

    <span class="s1">unmountPicker() {</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.picker) {</span>
        <span class="s4">this</span><span class="s1">.picker.$destroy();</span>
        <span class="s4">this</span><span class="s1">.picker.$off();</span>
        <span class="s4">if </span><span class="s1">(</span><span class="s4">typeof this</span><span class="s1">.unwatchPickerOptions === </span><span class="s3">'function'</span><span class="s1">) {</span>
          <span class="s4">this</span><span class="s1">.unwatchPickerOptions();</span>
        <span class="s1">}</span>
        <span class="s4">this</span><span class="s1">.picker.$el.parentNode.removeChild(</span><span class="s4">this</span><span class="s1">.picker.$el);</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">emitChange(val) {</span>
      <span class="s7">// determine user real change only</span>
      <span class="s4">if </span><span class="s1">(!valueEquals(val, </span><span class="s4">this</span><span class="s1">.valueOnOpen)) {</span>
        <span class="s4">this</span><span class="s1">.$emit(</span><span class="s3">'change'</span><span class="s1">, val);</span>
        <span class="s4">this</span><span class="s1">.valueOnOpen = val;</span>
        <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.validateEvent) {</span>
          <span class="s4">this</span><span class="s1">.dispatch(</span><span class="s3">'ElFormItem'</span><span class="s1">, </span><span class="s3">'el.form.change'</span><span class="s1">, val);</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">emitInput(val) {</span>
      <span class="s4">const </span><span class="s1">formatted = </span><span class="s4">this</span><span class="s1">.formatToValue(val);</span>
      <span class="s4">if </span><span class="s1">(!valueEquals(</span><span class="s4">this</span><span class="s1">.value, formatted)) {</span>
        <span class="s4">this</span><span class="s1">.$emit(</span><span class="s3">'input'</span><span class="s1">, formatted);</span>
      <span class="s1">}</span>
    <span class="s1">},</span>

    <span class="s1">isValidValue(value) {</span>
      <span class="s4">if </span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.picker) {</span>
        <span class="s4">this</span><span class="s1">.mountPicker();</span>
      <span class="s1">}</span>
      <span class="s4">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.picker.isValidValue) {</span>
        <span class="s4">return </span><span class="s1">value &amp;&amp; </span><span class="s4">this</span><span class="s1">.picker.isValidValue(value);</span>
      <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
        <span class="s4">return true</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
<span class="s1">};</span>
<span class="s0">&lt;/script&gt;</span>
</pre>
</body>
</html>