<html>
<head>
<title>vue-router.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #6aab73;}
.s5 { color: #42c3d4;}
.s6 { color: #2aacb8;}
.s7 { color: #5f826b; font-style: italic;}
.s8 { color: #67a37c; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
vue-router.js</font>
</center></td></tr></table>
<pre><span class="s0">/*! 
  * vue-router v3.6.5 
  * (c) 2022 Evan You 
  * @license MIT 
  */</span>
<span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">global</span><span class="s2">, </span><span class="s1">factory</span><span class="s2">) {</span>
  <span class="s3">typeof </span><span class="s1">exports </span><span class="s2">=== </span><span class="s4">'object' </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">module </span><span class="s2">!== </span><span class="s4">'undefined' </span><span class="s2">? </span><span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s1">factory</span><span class="s2">() :</span>
  <span class="s3">typeof </span><span class="s1">define </span><span class="s2">=== </span><span class="s4">'function' </span><span class="s2">&amp;&amp; </span><span class="s1">define</span><span class="s2">.</span><span class="s1">amd </span><span class="s2">? </span><span class="s1">define</span><span class="s2">(</span><span class="s1">factory</span><span class="s2">) :</span>
  <span class="s2">(</span><span class="s1">global </span><span class="s2">= </span><span class="s3">typeof </span><span class="s1">globalThis </span><span class="s2">!== </span><span class="s4">'undefined' </span><span class="s2">? </span><span class="s1">globalThis </span><span class="s2">: </span><span class="s1">global </span><span class="s2">|| </span><span class="s1">self</span><span class="s2">, </span><span class="s1">global</span><span class="s2">.</span><span class="s1">VueRouter </span><span class="s2">= </span><span class="s1">factory</span><span class="s2">());</span>
<span class="s2">})(</span><span class="s3">this</span><span class="s2">, (</span><span class="s3">function </span><span class="s2">() { </span><span class="s4">'use strict'</span><span class="s2">;</span>

  <span class="s0">/*  */</span>

  <span class="s3">function </span><span class="s1">assert </span><span class="s2">(</span><span class="s1">condition</span><span class="s2">, </span><span class="s1">message</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">condition</span><span class="s2">) {</span>
      <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">((</span><span class="s4">&quot;[vue-router] &quot; </span><span class="s2">+ </span><span class="s1">message</span><span class="s2">))</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">warn </span><span class="s2">(</span><span class="s1">condition</span><span class="s2">, </span><span class="s1">message</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">condition</span><span class="s2">) {</span>
      <span class="s3">typeof </span><span class="s1">console </span><span class="s2">!== </span><span class="s4">'undefined' </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">((</span><span class="s4">&quot;[vue-router] &quot; </span><span class="s2">+ </span><span class="s1">message</span><span class="s2">));</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">extend </span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">) {</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">key </span><span class="s3">in </span><span class="s1">b</span><span class="s2">) {</span>
      <span class="s1">a</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">b</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">a</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s3">var </span><span class="s1">encodeReserveRE </span><span class="s2">= </span><span class="s5">/[!'()*]/g</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">encodeReserveReplacer </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">c</span><span class="s2">) { </span><span class="s3">return </span><span class="s4">'%' </span><span class="s2">+ </span><span class="s1">c</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s6">0</span><span class="s2">).</span><span class="s1">toString</span><span class="s2">(</span><span class="s6">16</span><span class="s2">); };</span>
  <span class="s3">var </span><span class="s1">commaRE </span><span class="s2">= </span><span class="s5">/%2C/g</span><span class="s2">;</span>

  <span class="s0">// fixed encodeURIComponent which is more conformant to RFC3986:</span>
  <span class="s0">// - escapes [!'()*]</span>
  <span class="s0">// - preserve commas</span>
  <span class="s3">var </span><span class="s1">encode </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">str</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">encodeURIComponent</span><span class="s2">(</span><span class="s1">str</span><span class="s2">)</span>
      <span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">encodeReserveRE</span><span class="s2">, </span><span class="s1">encodeReserveReplacer</span><span class="s2">)</span>
      <span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">commaRE</span><span class="s2">, </span><span class="s4">','</span><span class="s2">); };</span>

  <span class="s3">function </span><span class="s1">decode </span><span class="s2">(</span><span class="s1">str</span><span class="s2">) {</span>
    <span class="s3">try </span><span class="s2">{</span>
      <span class="s3">return </span><span class="s1">decodeURIComponent</span><span class="s2">(</span><span class="s1">str</span><span class="s2">)</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">err</span><span class="s2">) {</span>
      <span class="s2">{</span>
        <span class="s1">warn</span><span class="s2">(</span><span class="s3">false</span><span class="s2">, (</span><span class="s4">&quot;Error decoding </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ </span><span class="s1">str </span><span class="s2">+ </span><span class="s4">&quot;</span><span class="s3">\&quot;</span><span class="s4">. Leaving it intact.&quot;</span><span class="s2">));</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">str</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">resolveQuery </span><span class="s2">(</span>
    <span class="s1">query</span><span class="s2">,</span>
    <span class="s1">extraQuery</span><span class="s2">,</span>
    <span class="s1">_parseQuery</span>
  <span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">( </span><span class="s1">extraQuery </span><span class="s2">=== </span><span class="s3">void </span><span class="s6">0 </span><span class="s2">) </span><span class="s1">extraQuery </span><span class="s2">= {};</span>

    <span class="s3">var </span><span class="s1">parse </span><span class="s2">= </span><span class="s1">_parseQuery </span><span class="s2">|| </span><span class="s1">parseQuery</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">parsedQuery</span><span class="s2">;</span>
    <span class="s3">try </span><span class="s2">{</span>
      <span class="s1">parsedQuery </span><span class="s2">= </span><span class="s1">parse</span><span class="s2">(</span><span class="s1">query </span><span class="s2">|| </span><span class="s4">''</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
      <span class="s1">warn</span><span class="s2">(</span><span class="s3">false</span><span class="s2">, </span><span class="s1">e</span><span class="s2">.</span><span class="s1">message</span><span class="s2">);</span>
      <span class="s1">parsedQuery </span><span class="s2">= {};</span>
    <span class="s2">}</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">key </span><span class="s3">in </span><span class="s1">extraQuery</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">value </span><span class="s2">= </span><span class="s1">extraQuery</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
      <span class="s1">parsedQuery</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s2">? </span><span class="s1">value</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">castQueryParamValue</span><span class="s2">)</span>
        <span class="s2">: </span><span class="s1">castQueryParamValue</span><span class="s2">(</span><span class="s1">value</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">parsedQuery</span>
  <span class="s2">}</span>

  <span class="s3">var </span><span class="s1">castQueryParamValue </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">value</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">(</span><span class="s1">value </span><span class="s2">== </span><span class="s3">null </span><span class="s2">|| </span><span class="s3">typeof </span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'object' </span><span class="s2">? </span><span class="s1">value </span><span class="s2">: </span><span class="s1">String</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)); };</span>

  <span class="s3">function </span><span class="s1">parseQuery </span><span class="s2">(</span><span class="s1">query</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">res </span><span class="s2">= {};</span>

    <span class="s1">query </span><span class="s2">= </span><span class="s1">query</span><span class="s2">.</span><span class="s1">trim</span><span class="s2">().</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/^(\?|#|&amp;)/</span><span class="s2">, </span><span class="s4">''</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(!</span><span class="s1">query</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">res</span>
    <span class="s2">}</span>

    <span class="s1">query</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'&amp;'</span><span class="s2">).</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">param</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">parts </span><span class="s2">= </span><span class="s1">param</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/\+/g</span><span class="s2">, </span><span class="s4">' '</span><span class="s2">).</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'='</span><span class="s2">);</span>
      <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">decode</span><span class="s2">(</span><span class="s1">parts</span><span class="s2">.</span><span class="s1">shift</span><span class="s2">());</span>
      <span class="s3">var </span><span class="s1">val </span><span class="s2">= </span><span class="s1">parts</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s6">0 </span><span class="s2">? </span><span class="s1">decode</span><span class="s2">(</span><span class="s1">parts</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'='</span><span class="s2">)) : </span><span class="s3">null</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">res</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] === </span><span class="s1">undefined</span><span class="s2">) {</span>
        <span class="s1">res</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">val</span><span class="s2">;</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">res</span><span class="s2">[</span><span class="s1">key</span><span class="s2">])) {</span>
        <span class="s1">res</span><span class="s2">[</span><span class="s1">key</span><span class="s2">].</span><span class="s1">push</span><span class="s2">(</span><span class="s1">val</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">res</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = [</span><span class="s1">res</span><span class="s2">[</span><span class="s1">key</span><span class="s2">], </span><span class="s1">val</span><span class="s2">];</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s3">return </span><span class="s1">res</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">stringifyQuery </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">res </span><span class="s2">= </span><span class="s1">obj</span>
      <span class="s2">? </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)</span>
        <span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
          <span class="s3">var </span><span class="s1">val </span><span class="s2">= </span><span class="s1">obj</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>

          <span class="s3">if </span><span class="s2">(</span><span class="s1">val </span><span class="s2">=== </span><span class="s1">undefined</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s4">''</span>
          <span class="s2">}</span>

          <span class="s3">if </span><span class="s2">(</span><span class="s1">val </span><span class="s2">=== </span><span class="s3">null</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">encode</span><span class="s2">(</span><span class="s1">key</span><span class="s2">)</span>
          <span class="s2">}</span>

          <span class="s3">if </span><span class="s2">(</span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)) {</span>
            <span class="s3">var </span><span class="s1">result </span><span class="s2">= [];</span>
            <span class="s1">val</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">val2</span><span class="s2">) {</span>
              <span class="s3">if </span><span class="s2">(</span><span class="s1">val2 </span><span class="s2">=== </span><span class="s1">undefined</span><span class="s2">) {</span>
                <span class="s3">return</span>
              <span class="s2">}</span>
              <span class="s3">if </span><span class="s2">(</span><span class="s1">val2 </span><span class="s2">=== </span><span class="s3">null</span><span class="s2">) {</span>
                <span class="s1">result</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">encode</span><span class="s2">(</span><span class="s1">key</span><span class="s2">));</span>
              <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">result</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">encode</span><span class="s2">(</span><span class="s1">key</span><span class="s2">) + </span><span class="s4">'=' </span><span class="s2">+ </span><span class="s1">encode</span><span class="s2">(</span><span class="s1">val2</span><span class="s2">));</span>
              <span class="s2">}</span>
            <span class="s2">});</span>
            <span class="s3">return </span><span class="s1">result</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'&amp;'</span><span class="s2">)</span>
          <span class="s2">}</span>

          <span class="s3">return </span><span class="s1">encode</span><span class="s2">(</span><span class="s1">key</span><span class="s2">) + </span><span class="s4">'=' </span><span class="s2">+ </span><span class="s1">encode</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)</span>
        <span class="s2">})</span>
        <span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">x</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">x</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s6">0</span><span class="s2">; })</span>
        <span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'&amp;'</span><span class="s2">)</span>
      <span class="s2">: </span><span class="s3">null</span><span class="s2">;</span>
    <span class="s3">return </span><span class="s1">res </span><span class="s2">? (</span><span class="s4">&quot;?&quot; </span><span class="s2">+ </span><span class="s1">res</span><span class="s2">) : </span><span class="s4">''</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s3">var </span><span class="s1">trailingSlashRE </span><span class="s2">= </span><span class="s5">/\/?$/</span><span class="s2">;</span>

  <span class="s3">function </span><span class="s1">createRoute </span><span class="s2">(</span>
    <span class="s1">record</span><span class="s2">,</span>
    <span class="s1">location</span><span class="s2">,</span>
    <span class="s1">redirectedFrom</span><span class="s2">,</span>
    <span class="s1">router</span>
  <span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">stringifyQuery </span><span class="s2">= </span><span class="s1">router </span><span class="s2">&amp;&amp; </span><span class="s1">router</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">stringifyQuery</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">query </span><span class="s2">= </span><span class="s1">location</span><span class="s2">.</span><span class="s1">query </span><span class="s2">|| {};</span>
    <span class="s3">try </span><span class="s2">{</span>
      <span class="s1">query </span><span class="s2">= </span><span class="s1">clone</span><span class="s2">(</span><span class="s1">query</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {}</span>

    <span class="s3">var </span><span class="s1">route </span><span class="s2">= {</span>
      <span class="s1">name</span><span class="s2">: </span><span class="s1">location</span><span class="s2">.</span><span class="s1">name </span><span class="s2">|| (</span><span class="s1">record </span><span class="s2">&amp;&amp; </span><span class="s1">record</span><span class="s2">.</span><span class="s1">name</span><span class="s2">),</span>
      <span class="s1">meta</span><span class="s2">: (</span><span class="s1">record </span><span class="s2">&amp;&amp; </span><span class="s1">record</span><span class="s2">.</span><span class="s1">meta</span><span class="s2">) || {},</span>
      <span class="s1">path</span><span class="s2">: </span><span class="s1">location</span><span class="s2">.</span><span class="s1">path </span><span class="s2">|| </span><span class="s4">'/'</span><span class="s2">,</span>
      <span class="s1">hash</span><span class="s2">: </span><span class="s1">location</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">|| </span><span class="s4">''</span><span class="s2">,</span>
      <span class="s1">query</span><span class="s2">: </span><span class="s1">query</span><span class="s2">,</span>
      <span class="s1">params</span><span class="s2">: </span><span class="s1">location</span><span class="s2">.</span><span class="s1">params </span><span class="s2">|| {},</span>
      <span class="s1">fullPath</span><span class="s2">: </span><span class="s1">getFullPath</span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">stringifyQuery</span><span class="s2">),</span>
      <span class="s1">matched</span><span class="s2">: </span><span class="s1">record </span><span class="s2">? </span><span class="s1">formatMatch</span><span class="s2">(</span><span class="s1">record</span><span class="s2">) : []</span>
    <span class="s2">};</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">redirectedFrom</span><span class="s2">) {</span>
      <span class="s1">route</span><span class="s2">.</span><span class="s1">redirectedFrom </span><span class="s2">= </span><span class="s1">getFullPath</span><span class="s2">(</span><span class="s1">redirectedFrom</span><span class="s2">, </span><span class="s1">stringifyQuery</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">freeze</span><span class="s2">(</span><span class="s1">route</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">clone </span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">value</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">clone</span><span class="s2">)</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">value </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'object'</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">res </span><span class="s2">= {};</span>
      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">key </span><span class="s3">in </span><span class="s1">value</span><span class="s2">) {</span>
        <span class="s1">res</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">clone</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]);</span>
      <span class="s2">}</span>
      <span class="s3">return </span><span class="s1">res</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">return </span><span class="s1">value</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s0">// the starting route that represents the initial state</span>
  <span class="s3">var </span><span class="s1">START </span><span class="s2">= </span><span class="s1">createRoute</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, {</span>
    <span class="s1">path</span><span class="s2">: </span><span class="s4">'/'</span>
  <span class="s2">});</span>

  <span class="s3">function </span><span class="s1">formatMatch </span><span class="s2">(</span><span class="s1">record</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">res </span><span class="s2">= [];</span>
    <span class="s3">while </span><span class="s2">(</span><span class="s1">record</span><span class="s2">) {</span>
      <span class="s1">res</span><span class="s2">.</span><span class="s1">unshift</span><span class="s2">(</span><span class="s1">record</span><span class="s2">);</span>
      <span class="s1">record </span><span class="s2">= </span><span class="s1">record</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">res</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">getFullPath </span><span class="s2">(</span>
    <span class="s1">ref</span><span class="s2">,</span>
    <span class="s1">_stringifyQuery</span>
  <span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">path</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">query </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">query</span><span class="s2">; </span><span class="s3">if </span><span class="s2">( </span><span class="s1">query </span><span class="s2">=== </span><span class="s3">void </span><span class="s6">0 </span><span class="s2">) </span><span class="s1">query </span><span class="s2">= {};</span>
    <span class="s3">var </span><span class="s1">hash </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">hash</span><span class="s2">; </span><span class="s3">if </span><span class="s2">( </span><span class="s1">hash </span><span class="s2">=== </span><span class="s3">void </span><span class="s6">0 </span><span class="s2">) </span><span class="s1">hash </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">stringify </span><span class="s2">= </span><span class="s1">_stringifyQuery </span><span class="s2">|| </span><span class="s1">stringifyQuery</span><span class="s2">;</span>
    <span class="s3">return </span><span class="s2">(</span><span class="s1">path </span><span class="s2">|| </span><span class="s4">'/'</span><span class="s2">) + </span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">query</span><span class="s2">) + </span><span class="s1">hash</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">isSameRoute </span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">onlyPath</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">b </span><span class="s2">=== </span><span class="s1">START</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">a </span><span class="s2">=== </span><span class="s1">b</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(!</span><span class="s1">b</span><span class="s2">) {</span>
      <span class="s3">return false</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">path </span><span class="s2">&amp;&amp; </span><span class="s1">b</span><span class="s2">.</span><span class="s1">path</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">a</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">trailingSlashRE</span><span class="s2">, </span><span class="s4">''</span><span class="s2">) === </span><span class="s1">b</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">trailingSlashRE</span><span class="s2">, </span><span class="s4">''</span><span class="s2">) &amp;&amp; (</span><span class="s1">onlyPath </span><span class="s2">||</span>
        <span class="s1">a</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">=== </span><span class="s1">b</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">&amp;&amp;</span>
        <span class="s1">isObjectEqual</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">query</span><span class="s2">, </span><span class="s1">b</span><span class="s2">.</span><span class="s1">query</span><span class="s2">))</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">name </span><span class="s2">&amp;&amp; </span><span class="s1">b</span><span class="s2">.</span><span class="s1">name</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s2">(</span>
        <span class="s1">a</span><span class="s2">.</span><span class="s1">name </span><span class="s2">=== </span><span class="s1">b</span><span class="s2">.</span><span class="s1">name </span><span class="s2">&amp;&amp;</span>
        <span class="s2">(</span><span class="s1">onlyPath </span><span class="s2">|| (</span>
          <span class="s1">a</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">=== </span><span class="s1">b</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">&amp;&amp;</span>
        <span class="s1">isObjectEqual</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">query</span><span class="s2">, </span><span class="s1">b</span><span class="s2">.</span><span class="s1">query</span><span class="s2">) &amp;&amp;</span>
        <span class="s1">isObjectEqual</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, </span><span class="s1">b</span><span class="s2">.</span><span class="s1">params</span><span class="s2">))</span>
        <span class="s2">)</span>
      <span class="s2">)</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">return false</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">isObjectEqual </span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">( </span><span class="s1">a </span><span class="s2">=== </span><span class="s3">void </span><span class="s6">0 </span><span class="s2">) </span><span class="s1">a </span><span class="s2">= {};</span>
    <span class="s3">if </span><span class="s2">( </span><span class="s1">b </span><span class="s2">=== </span><span class="s3">void </span><span class="s6">0 </span><span class="s2">) </span><span class="s1">b </span><span class="s2">= {};</span>

    <span class="s0">// handle null value #1566</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">a </span><span class="s2">|| !</span><span class="s1">b</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">a </span><span class="s2">=== </span><span class="s1">b </span><span class="s2">}</span>
    <span class="s3">var </span><span class="s1">aKeys </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">a</span><span class="s2">).</span><span class="s1">sort</span><span class="s2">();</span>
    <span class="s3">var </span><span class="s1">bKeys </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">b</span><span class="s2">).</span><span class="s1">sort</span><span class="s2">();</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">aKeys</span><span class="s2">.</span><span class="s1">length </span><span class="s2">!== </span><span class="s1">bKeys</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
      <span class="s3">return false</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">aKeys</span><span class="s2">.</span><span class="s1">every</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">i</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">aVal </span><span class="s2">= </span><span class="s1">a</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
      <span class="s3">var </span><span class="s1">bKey </span><span class="s2">= </span><span class="s1">bKeys</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">bKey </span><span class="s2">!== </span><span class="s1">key</span><span class="s2">) { </span><span class="s3">return false </span><span class="s2">}</span>
      <span class="s3">var </span><span class="s1">bVal </span><span class="s2">= </span><span class="s1">b</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
      <span class="s0">// query values can be null and undefined</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">aVal </span><span class="s2">== </span><span class="s3">null </span><span class="s2">|| </span><span class="s1">bVal </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">aVal </span><span class="s2">=== </span><span class="s1">bVal </span><span class="s2">}</span>
      <span class="s0">// check nested equality</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">aVal </span><span class="s2">=== </span><span class="s4">'object' </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">bVal </span><span class="s2">=== </span><span class="s4">'object'</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">isObjectEqual</span><span class="s2">(</span><span class="s1">aVal</span><span class="s2">, </span><span class="s1">bVal</span><span class="s2">)</span>
      <span class="s2">}</span>
      <span class="s3">return </span><span class="s1">String</span><span class="s2">(</span><span class="s1">aVal</span><span class="s2">) === </span><span class="s1">String</span><span class="s2">(</span><span class="s1">bVal</span><span class="s2">)</span>
    <span class="s2">})</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">isIncludedRoute </span><span class="s2">(</span><span class="s1">current</span><span class="s2">, </span><span class="s1">target</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s2">(</span>
      <span class="s1">current</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">trailingSlashRE</span><span class="s2">, </span><span class="s4">'/'</span><span class="s2">).</span><span class="s1">indexOf</span><span class="s2">(</span>
        <span class="s1">target</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">trailingSlashRE</span><span class="s2">, </span><span class="s4">'/'</span><span class="s2">)</span>
      <span class="s2">) === </span><span class="s6">0 </span><span class="s2">&amp;&amp;</span>
      <span class="s2">(!</span><span class="s1">target</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">|| </span><span class="s1">current</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">=== </span><span class="s1">target</span><span class="s2">.</span><span class="s1">hash</span><span class="s2">) &amp;&amp;</span>
      <span class="s1">queryIncludes</span><span class="s2">(</span><span class="s1">current</span><span class="s2">.</span><span class="s1">query</span><span class="s2">, </span><span class="s1">target</span><span class="s2">.</span><span class="s1">query</span><span class="s2">)</span>
    <span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">queryIncludes </span><span class="s2">(</span><span class="s1">current</span><span class="s2">, </span><span class="s1">target</span><span class="s2">) {</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">key </span><span class="s3">in </span><span class="s1">target</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(!(</span><span class="s1">key </span><span class="s3">in </span><span class="s1">current</span><span class="s2">)) {</span>
        <span class="s3">return false</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s3">return true</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">handleRouteEntered </span><span class="s2">(</span><span class="s1">route</span><span class="s2">) {</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">route</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">record </span><span class="s2">= </span><span class="s1">route</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">name </span><span class="s3">in </span><span class="s1">record</span><span class="s2">.</span><span class="s1">instances</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">instance </span><span class="s2">= </span><span class="s1">record</span><span class="s2">.</span><span class="s1">instances</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
        <span class="s3">var </span><span class="s1">cbs </span><span class="s2">= </span><span class="s1">record</span><span class="s2">.</span><span class="s1">enteredCbs</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">instance </span><span class="s2">|| !</span><span class="s1">cbs</span><span class="s2">) { </span><span class="s3">continue </span><span class="s2">}</span>
        <span class="s3">delete </span><span class="s1">record</span><span class="s2">.</span><span class="s1">enteredCbs</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
        <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i$1 </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i$1 </span><span class="s2">&lt; </span><span class="s1">cbs</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i$1</span><span class="s2">++) {</span>
          <span class="s3">if </span><span class="s2">(!</span><span class="s1">instance</span><span class="s2">.</span><span class="s1">_isBeingDestroyed</span><span class="s2">) { </span><span class="s1">cbs</span><span class="s2">[</span><span class="s1">i$1</span><span class="s2">](</span><span class="s1">instance</span><span class="s2">); }</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">var </span><span class="s1">View </span><span class="s2">= {</span>
    <span class="s1">name</span><span class="s2">: </span><span class="s4">'RouterView'</span><span class="s2">,</span>
    <span class="s1">functional</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
    <span class="s1">props</span><span class="s2">: {</span>
      <span class="s1">name</span><span class="s2">: {</span>
        <span class="s1">type</span><span class="s2">: </span><span class="s1">String</span><span class="s2">,</span>
        <span class="s3">default</span><span class="s2">: </span><span class="s4">'default'</span>
      <span class="s2">}</span>
    <span class="s2">},</span>
    <span class="s1">render</span><span class="s2">: </span><span class="s3">function </span><span class="s1">render </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">props </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">props</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">children </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">children</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">parent </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">data </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">data</span><span class="s2">;</span>

      <span class="s0">// used by devtools to display a router-view badge</span>
      <span class="s1">data</span><span class="s2">.</span><span class="s1">routerView </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

      <span class="s0">// directly use parent context's createElement() function</span>
      <span class="s0">// so that components rendered by router-view can resolve named slots</span>
      <span class="s3">var </span><span class="s1">h </span><span class="s2">= </span><span class="s1">parent</span><span class="s2">.</span><span class="s1">$createElement</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">name </span><span class="s2">= </span><span class="s1">props</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">route </span><span class="s2">= </span><span class="s1">parent</span><span class="s2">.</span><span class="s1">$route</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">cache </span><span class="s2">= </span><span class="s1">parent</span><span class="s2">.</span><span class="s1">_routerViewCache </span><span class="s2">|| (</span><span class="s1">parent</span><span class="s2">.</span><span class="s1">_routerViewCache </span><span class="s2">= {});</span>

      <span class="s0">// determine current view depth, also check to see if the tree</span>
      <span class="s0">// has been toggled inactive but kept-alive.</span>
      <span class="s3">var </span><span class="s1">depth </span><span class="s2">= </span><span class="s6">0</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">inactive </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
      <span class="s3">while </span><span class="s2">(</span><span class="s1">parent </span><span class="s2">&amp;&amp; </span><span class="s1">parent</span><span class="s2">.</span><span class="s1">_routerRoot </span><span class="s2">!== </span><span class="s1">parent</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">vnodeData </span><span class="s2">= </span><span class="s1">parent</span><span class="s2">.</span><span class="s1">$vnode </span><span class="s2">? </span><span class="s1">parent</span><span class="s2">.</span><span class="s1">$vnode</span><span class="s2">.</span><span class="s1">data </span><span class="s2">: {};</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">vnodeData</span><span class="s2">.</span><span class="s1">routerView</span><span class="s2">) {</span>
          <span class="s1">depth</span><span class="s2">++;</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">vnodeData</span><span class="s2">.</span><span class="s1">keepAlive </span><span class="s2">&amp;&amp; </span><span class="s1">parent</span><span class="s2">.</span><span class="s1">_directInactive </span><span class="s2">&amp;&amp; </span><span class="s1">parent</span><span class="s2">.</span><span class="s1">_inactive</span><span class="s2">) {</span>
          <span class="s1">inactive </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s1">parent </span><span class="s2">= </span><span class="s1">parent</span><span class="s2">.</span><span class="s1">$parent</span><span class="s2">;</span>
      <span class="s2">}</span>
      <span class="s1">data</span><span class="s2">.</span><span class="s1">routerViewDepth </span><span class="s2">= </span><span class="s1">depth</span><span class="s2">;</span>

      <span class="s0">// render previous view if the tree is inactive and kept-alive</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">inactive</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">cachedData </span><span class="s2">= </span><span class="s1">cache</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
        <span class="s3">var </span><span class="s1">cachedComponent </span><span class="s2">= </span><span class="s1">cachedData </span><span class="s2">&amp;&amp; </span><span class="s1">cachedData</span><span class="s2">.</span><span class="s1">component</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">cachedComponent</span><span class="s2">) {</span>
          <span class="s0">// #2301</span>
          <span class="s0">// pass props</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">cachedData</span><span class="s2">.</span><span class="s1">configProps</span><span class="s2">) {</span>
            <span class="s1">fillPropsinData</span><span class="s2">(</span><span class="s1">cachedComponent</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">cachedData</span><span class="s2">.</span><span class="s1">route</span><span class="s2">, </span><span class="s1">cachedData</span><span class="s2">.</span><span class="s1">configProps</span><span class="s2">);</span>
          <span class="s2">}</span>
          <span class="s3">return </span><span class="s1">h</span><span class="s2">(</span><span class="s1">cachedComponent</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">children</span><span class="s2">)</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
          <span class="s0">// render previous empty view</span>
          <span class="s3">return </span><span class="s1">h</span><span class="s2">()</span>
        <span class="s2">}</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">matched </span><span class="s2">= </span><span class="s1">route</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">[</span><span class="s1">depth</span><span class="s2">];</span>
      <span class="s3">var </span><span class="s1">component </span><span class="s2">= </span><span class="s1">matched </span><span class="s2">&amp;&amp; </span><span class="s1">matched</span><span class="s2">.</span><span class="s1">components</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>

      <span class="s0">// render empty node if no matched route or no config component</span>
      <span class="s3">if </span><span class="s2">(!</span><span class="s1">matched </span><span class="s2">|| !</span><span class="s1">component</span><span class="s2">) {</span>
        <span class="s1">cache</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s3">null</span><span class="s2">;</span>
        <span class="s3">return </span><span class="s1">h</span><span class="s2">()</span>
      <span class="s2">}</span>

      <span class="s0">// cache component</span>
      <span class="s1">cache</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = { </span><span class="s1">component</span><span class="s2">: </span><span class="s1">component </span><span class="s2">};</span>

      <span class="s0">// attach instance registration hook</span>
      <span class="s0">// this will be called in the instance's injected lifecycle hooks</span>
      <span class="s1">data</span><span class="s2">.</span><span class="s1">registerRouteInstance </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">vm</span><span class="s2">, </span><span class="s1">val</span><span class="s2">) {</span>
        <span class="s0">// val could be undefined for unregistration</span>
        <span class="s3">var </span><span class="s1">current </span><span class="s2">= </span><span class="s1">matched</span><span class="s2">.</span><span class="s1">instances</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
        <span class="s3">if </span><span class="s2">(</span>
          <span class="s2">(</span><span class="s1">val </span><span class="s2">&amp;&amp; </span><span class="s1">current </span><span class="s2">!== </span><span class="s1">vm</span><span class="s2">) ||</span>
          <span class="s2">(!</span><span class="s1">val </span><span class="s2">&amp;&amp; </span><span class="s1">current </span><span class="s2">=== </span><span class="s1">vm</span><span class="s2">)</span>
        <span class="s2">) {</span>
          <span class="s1">matched</span><span class="s2">.</span><span class="s1">instances</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">val</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>

      <span class="s0">// also register instance in prepatch hook</span>
      <span class="s0">// in case the same component instance is reused across different routes</span>
      <span class="s2">;(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">hook </span><span class="s2">|| (</span><span class="s1">data</span><span class="s2">.</span><span class="s1">hook </span><span class="s2">= {})).</span><span class="s1">prepatch </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">vnode</span><span class="s2">) {</span>
        <span class="s1">matched</span><span class="s2">.</span><span class="s1">instances</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">vnode</span><span class="s2">.</span><span class="s1">componentInstance</span><span class="s2">;</span>
      <span class="s2">};</span>

      <span class="s0">// register instance in init hook</span>
      <span class="s0">// in case kept-alive component be actived when routes changed</span>
      <span class="s1">data</span><span class="s2">.</span><span class="s1">hook</span><span class="s2">.</span><span class="s1">init </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">vnode</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">vnode</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">keepAlive </span><span class="s2">&amp;&amp;</span>
          <span class="s1">vnode</span><span class="s2">.</span><span class="s1">componentInstance </span><span class="s2">&amp;&amp;</span>
          <span class="s1">vnode</span><span class="s2">.</span><span class="s1">componentInstance </span><span class="s2">!== </span><span class="s1">matched</span><span class="s2">.</span><span class="s1">instances</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]</span>
        <span class="s2">) {</span>
          <span class="s1">matched</span><span class="s2">.</span><span class="s1">instances</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">vnode</span><span class="s2">.</span><span class="s1">componentInstance</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s0">// if the route transition has already been confirmed then we weren't</span>
        <span class="s0">// able to call the cbs during confirmation as the component was not</span>
        <span class="s0">// registered yet, so we call it here.</span>
        <span class="s1">handleRouteEntered</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
      <span class="s2">};</span>

      <span class="s3">var </span><span class="s1">configProps </span><span class="s2">= </span><span class="s1">matched</span><span class="s2">.</span><span class="s1">props </span><span class="s2">&amp;&amp; </span><span class="s1">matched</span><span class="s2">.</span><span class="s1">props</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
      <span class="s0">// save route and configProps in cache</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">configProps</span><span class="s2">) {</span>
        <span class="s1">extend</span><span class="s2">(</span><span class="s1">cache</span><span class="s2">[</span><span class="s1">name</span><span class="s2">], {</span>
          <span class="s1">route</span><span class="s2">: </span><span class="s1">route</span><span class="s2">,</span>
          <span class="s1">configProps</span><span class="s2">: </span><span class="s1">configProps</span>
        <span class="s2">});</span>
        <span class="s1">fillPropsinData</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">route</span><span class="s2">, </span><span class="s1">configProps</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">return </span><span class="s1">h</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">children</span><span class="s2">)</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s3">function </span><span class="s1">fillPropsinData </span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">route</span><span class="s2">, </span><span class="s1">configProps</span><span class="s2">) {</span>
    <span class="s0">// resolve props</span>
    <span class="s3">var </span><span class="s1">propsToPass </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">props </span><span class="s2">= </span><span class="s1">resolveProps</span><span class="s2">(</span><span class="s1">route</span><span class="s2">, </span><span class="s1">configProps</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">propsToPass</span><span class="s2">) {</span>
      <span class="s0">// clone to prevent mutation</span>
      <span class="s1">propsToPass </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">props </span><span class="s2">= </span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">propsToPass</span><span class="s2">);</span>
      <span class="s0">// pass non-declared props as attrs</span>
      <span class="s3">var </span><span class="s1">attrs </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">attrs </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">attrs </span><span class="s2">|| {};</span>
      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">key </span><span class="s3">in </span><span class="s1">propsToPass</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">component</span><span class="s2">.</span><span class="s1">props </span><span class="s2">|| !(</span><span class="s1">key </span><span class="s3">in </span><span class="s1">component</span><span class="s2">.</span><span class="s1">props</span><span class="s2">)) {</span>
          <span class="s1">attrs</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">propsToPass</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
          <span class="s3">delete </span><span class="s1">propsToPass</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">resolveProps </span><span class="s2">(</span><span class="s1">route</span><span class="s2">, </span><span class="s1">config</span><span class="s2">) {</span>
    <span class="s3">switch </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">config</span><span class="s2">) {</span>
      <span class="s3">case </span><span class="s4">'undefined'</span><span class="s2">:</span>
        <span class="s3">return</span>
      <span class="s3">case </span><span class="s4">'object'</span><span class="s2">:</span>
        <span class="s3">return </span><span class="s1">config</span>
      <span class="s3">case </span><span class="s4">'function'</span><span class="s2">:</span>
        <span class="s3">return </span><span class="s1">config</span><span class="s2">(</span><span class="s1">route</span><span class="s2">)</span>
      <span class="s3">case </span><span class="s4">'boolean'</span><span class="s2">:</span>
        <span class="s3">return </span><span class="s1">config </span><span class="s2">? </span><span class="s1">route</span><span class="s2">.</span><span class="s1">params </span><span class="s2">: </span><span class="s1">undefined</span>
      <span class="s3">default</span><span class="s2">:</span>
        <span class="s2">{</span>
          <span class="s1">warn</span><span class="s2">(</span>
            <span class="s3">false</span><span class="s2">,</span>
            <span class="s4">&quot;props in </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ (</span><span class="s1">route</span><span class="s2">.</span><span class="s1">path</span><span class="s2">) + </span><span class="s4">&quot;</span><span class="s3">\&quot; </span><span class="s4">is a &quot; </span><span class="s2">+ (</span><span class="s3">typeof </span><span class="s1">config</span><span class="s2">) + </span><span class="s4">&quot;, &quot; </span><span class="s2">+</span>
            <span class="s4">&quot;expecting an object, function or boolean.&quot;</span>
          <span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s3">function </span><span class="s1">resolvePath </span><span class="s2">(</span>
    <span class="s1">relative</span><span class="s2">,</span>
    <span class="s1">base</span><span class="s2">,</span>
    <span class="s1">append</span>
  <span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">firstChar </span><span class="s2">= </span><span class="s1">relative</span><span class="s2">.</span><span class="s1">charAt</span><span class="s2">(</span><span class="s6">0</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">firstChar </span><span class="s2">=== </span><span class="s4">'/'</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">relative</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">firstChar </span><span class="s2">=== </span><span class="s4">'?' </span><span class="s2">|| </span><span class="s1">firstChar </span><span class="s2">=== </span><span class="s4">'#'</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">base </span><span class="s2">+ </span><span class="s1">relative</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">stack </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">);</span>

    <span class="s0">// remove trailing segment if:</span>
    <span class="s0">// - not appending</span>
    <span class="s0">// - appending to trailing slash (last segment is empty)</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">append </span><span class="s2">|| !</span><span class="s1">stack</span><span class="s2">[</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s6">1</span><span class="s2">]) {</span>
      <span class="s1">stack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s0">// resolve relative path</span>
    <span class="s3">var </span><span class="s1">segments </span><span class="s2">= </span><span class="s1">relative</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/^\//</span><span class="s2">, </span><span class="s4">''</span><span class="s2">).</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">);</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">segments</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">segment </span><span class="s2">= </span><span class="s1">segments</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">segment </span><span class="s2">=== </span><span class="s4">'..'</span><span class="s2">) {</span>
        <span class="s1">stack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">segment </span><span class="s2">!== </span><span class="s4">'.'</span><span class="s2">) {</span>
        <span class="s1">stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">segment</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">// ensure leading slash</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">stack</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] !== </span><span class="s4">''</span><span class="s2">) {</span>
      <span class="s1">stack</span><span class="s2">.</span><span class="s1">unshift</span><span class="s2">(</span><span class="s4">''</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">stack</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">parsePath </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">hash </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">query </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">hashIndex </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'#'</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">hashIndex </span><span class="s2">&gt;= </span><span class="s6">0</span><span class="s2">) {</span>
      <span class="s1">hash </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">hashIndex</span><span class="s2">);</span>
      <span class="s1">path </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s1">hashIndex</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">queryIndex </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'?'</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">queryIndex </span><span class="s2">&gt;= </span><span class="s6">0</span><span class="s2">) {</span>
      <span class="s1">query </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">queryIndex </span><span class="s2">+ </span><span class="s6">1</span><span class="s2">);</span>
      <span class="s1">path </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s1">queryIndex</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s2">{</span>
      <span class="s1">path</span><span class="s2">: </span><span class="s1">path</span><span class="s2">,</span>
      <span class="s1">query</span><span class="s2">: </span><span class="s1">query</span><span class="s2">,</span>
      <span class="s1">hash</span><span class="s2">: </span><span class="s1">hash</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">cleanPath </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">path</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/\/(?:\s*\/)+/g</span><span class="s2">, </span><span class="s4">'/'</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">var </span><span class="s1">isarray </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray </span><span class="s2">|| </span><span class="s3">function </span><span class="s2">(</span><span class="s1">arr</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">) == </span><span class="s4">'[object Array]'</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s7">/**</span>
   <span class="s7">* Expose `pathToRegexp`.</span>
   <span class="s7">*/</span>
  <span class="s3">var </span><span class="s1">pathToRegexp_1 </span><span class="s2">= </span><span class="s1">pathToRegexp</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">parse_1 </span><span class="s2">= </span><span class="s1">parse</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">compile_1 </span><span class="s2">= </span><span class="s1">compile</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">tokensToFunction_1 </span><span class="s2">= </span><span class="s1">tokensToFunction</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">tokensToRegExp_1 </span><span class="s2">= </span><span class="s1">tokensToRegExp</span><span class="s2">;</span>

  <span class="s7">/**</span>
   <span class="s7">* The main path matching regexp utility.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@type </span><span class="s7">{RegExp}</span>
   <span class="s7">*/</span>
  <span class="s3">var </span><span class="s1">PATH_REGEXP </span><span class="s2">= </span><span class="s3">new </span><span class="s1">RegExp</span><span class="s2">([</span>
    <span class="s0">// Match escaped characters that would otherwise appear in future matches.</span>
    <span class="s0">// This allows the user to escape special characters that won't transform.</span>
    <span class="s4">'(</span><span class="s3">\\\\</span><span class="s4">.)'</span><span class="s2">,</span>
    <span class="s0">// Match Express-style parameters and un-named parameters with a prefix</span>
    <span class="s0">// and optional suffixes. Matches appear as:</span>
    <span class="s0">//</span>
    <span class="s0">// &quot;/:test(\\d+)?&quot; =&gt; [&quot;/&quot;, &quot;test&quot;, &quot;\d+&quot;, undefined, &quot;?&quot;, undefined]</span>
    <span class="s0">// &quot;/route(\\d+)&quot;  =&gt; [undefined, undefined, undefined, &quot;\d+&quot;, undefined, undefined]</span>
    <span class="s0">// &quot;/*&quot;            =&gt; [&quot;/&quot;, undefined, undefined, undefined, undefined, &quot;*&quot;]</span>
    <span class="s4">'([</span><span class="s3">\\</span><span class="s4">/.])?(?:(?:</span><span class="s3">\\</span><span class="s4">:(</span><span class="s3">\\</span><span class="s4">w+)(?:</span><span class="s3">\\</span><span class="s4">(((?:</span><span class="s3">\\\\</span><span class="s4">.|[^</span><span class="s3">\\\\</span><span class="s4">()])+)</span><span class="s3">\\</span><span class="s4">))?|</span><span class="s3">\\</span><span class="s4">(((?:</span><span class="s3">\\\\</span><span class="s4">.|[^</span><span class="s3">\\\\</span><span class="s4">()])+)</span><span class="s3">\\</span><span class="s4">))([+*?])?|(</span><span class="s3">\\</span><span class="s4">*))'</span>
  <span class="s2">].</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'|'</span><span class="s2">), </span><span class="s4">'g'</span><span class="s2">);</span>

  <span class="s7">/**</span>
   <span class="s7">* Parse a string for the raw tokens.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{string}  str</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{Object=} options</span>
   <span class="s7">* </span><span class="s8">@return </span><span class="s7">{!Array}</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">parse </span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">tokens </span><span class="s2">= [];</span>
    <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s6">0</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">index </span><span class="s2">= </span><span class="s6">0</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">defaultDelimiter </span><span class="s2">= </span><span class="s1">options </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">delimiter </span><span class="s2">|| </span><span class="s4">'/'</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">res</span><span class="s2">;</span>

    <span class="s3">while </span><span class="s2">((</span><span class="s1">res </span><span class="s2">= </span><span class="s1">PATH_REGEXP</span><span class="s2">.</span><span class="s1">exec</span><span class="s2">(</span><span class="s1">str</span><span class="s2">)) != </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">m </span><span class="s2">= </span><span class="s1">res</span><span class="s2">[</span><span class="s6">0</span><span class="s2">];</span>
      <span class="s3">var </span><span class="s1">escaped </span><span class="s2">= </span><span class="s1">res</span><span class="s2">[</span><span class="s6">1</span><span class="s2">];</span>
      <span class="s3">var </span><span class="s1">offset </span><span class="s2">= </span><span class="s1">res</span><span class="s2">.</span><span class="s1">index</span><span class="s2">;</span>
      <span class="s1">path </span><span class="s2">+= </span><span class="s1">str</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">);</span>
      <span class="s1">index </span><span class="s2">= </span><span class="s1">offset </span><span class="s2">+ </span><span class="s1">m</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>

      <span class="s0">// Ignore already escaped sequences.</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">escaped</span><span class="s2">) {</span>
        <span class="s1">path </span><span class="s2">+= </span><span class="s1">escaped</span><span class="s2">[</span><span class="s6">1</span><span class="s2">];</span>
        <span class="s3">continue</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">next </span><span class="s2">= </span><span class="s1">str</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
      <span class="s3">var </span><span class="s1">prefix </span><span class="s2">= </span><span class="s1">res</span><span class="s2">[</span><span class="s6">2</span><span class="s2">];</span>
      <span class="s3">var </span><span class="s1">name </span><span class="s2">= </span><span class="s1">res</span><span class="s2">[</span><span class="s6">3</span><span class="s2">];</span>
      <span class="s3">var </span><span class="s1">capture </span><span class="s2">= </span><span class="s1">res</span><span class="s2">[</span><span class="s6">4</span><span class="s2">];</span>
      <span class="s3">var </span><span class="s1">group </span><span class="s2">= </span><span class="s1">res</span><span class="s2">[</span><span class="s6">5</span><span class="s2">];</span>
      <span class="s3">var </span><span class="s1">modifier </span><span class="s2">= </span><span class="s1">res</span><span class="s2">[</span><span class="s6">6</span><span class="s2">];</span>
      <span class="s3">var </span><span class="s1">asterisk </span><span class="s2">= </span><span class="s1">res</span><span class="s2">[</span><span class="s6">7</span><span class="s2">];</span>

      <span class="s0">// Push the current path onto the tokens.</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
        <span class="s1">tokens</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">path</span><span class="s2">);</span>
        <span class="s1">path </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">partial </span><span class="s2">= </span><span class="s1">prefix </span><span class="s2">!= </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">next </span><span class="s2">!= </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">next </span><span class="s2">!== </span><span class="s1">prefix</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">repeat </span><span class="s2">= </span><span class="s1">modifier </span><span class="s2">=== </span><span class="s4">'+' </span><span class="s2">|| </span><span class="s1">modifier </span><span class="s2">=== </span><span class="s4">'*'</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">optional </span><span class="s2">= </span><span class="s1">modifier </span><span class="s2">=== </span><span class="s4">'?' </span><span class="s2">|| </span><span class="s1">modifier </span><span class="s2">=== </span><span class="s4">'*'</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">delimiter </span><span class="s2">= </span><span class="s1">res</span><span class="s2">[</span><span class="s6">2</span><span class="s2">] || </span><span class="s1">defaultDelimiter</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">pattern </span><span class="s2">= </span><span class="s1">capture </span><span class="s2">|| </span><span class="s1">group</span><span class="s2">;</span>

      <span class="s1">tokens</span><span class="s2">.</span><span class="s1">push</span><span class="s2">({</span>
        <span class="s1">name</span><span class="s2">: </span><span class="s1">name </span><span class="s2">|| </span><span class="s1">key</span><span class="s2">++,</span>
        <span class="s1">prefix</span><span class="s2">: </span><span class="s1">prefix </span><span class="s2">|| </span><span class="s4">''</span><span class="s2">,</span>
        <span class="s1">delimiter</span><span class="s2">: </span><span class="s1">delimiter</span><span class="s2">,</span>
        <span class="s1">optional</span><span class="s2">: </span><span class="s1">optional</span><span class="s2">,</span>
        <span class="s1">repeat</span><span class="s2">: </span><span class="s1">repeat</span><span class="s2">,</span>
        <span class="s1">partial</span><span class="s2">: </span><span class="s1">partial</span><span class="s2">,</span>
        <span class="s1">asterisk</span><span class="s2">: !!</span><span class="s1">asterisk</span><span class="s2">,</span>
        <span class="s1">pattern</span><span class="s2">: </span><span class="s1">pattern </span><span class="s2">? </span><span class="s1">escapeGroup</span><span class="s2">(</span><span class="s1">pattern</span><span class="s2">) : (</span><span class="s1">asterisk </span><span class="s2">? </span><span class="s4">'.*' </span><span class="s2">: </span><span class="s4">'[^' </span><span class="s2">+ </span><span class="s1">escapeString</span><span class="s2">(</span><span class="s1">delimiter</span><span class="s2">) + </span><span class="s4">']+?'</span><span class="s2">)</span>
      <span class="s2">});</span>
    <span class="s2">}</span>

    <span class="s0">// Match any characters still remaining.</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">str</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
      <span class="s1">path </span><span class="s2">+= </span><span class="s1">str</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s1">index</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// If the path exists, push it onto the end.</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
      <span class="s1">tokens</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">path</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">tokens</span>
  <span class="s2">}</span>

  <span class="s7">/**</span>
   <span class="s7">* Compile a string to a template function for the path.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{string}             str</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{Object=}            options</span>
   <span class="s7">* </span><span class="s8">@return </span><span class="s7">{!function(Object=, Object=)}</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">compile </span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">tokensToFunction</span><span class="s2">(</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">options</span><span class="s2">), </span><span class="s1">options</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s7">/**</span>
   <span class="s7">* Prettier encoding of URI path segments.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{string}</span>
   <span class="s7">* </span><span class="s8">@return </span><span class="s7">{string}</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">encodeURIComponentPretty </span><span class="s2">(</span><span class="s1">str</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">encodeURI</span><span class="s2">(</span><span class="s1">str</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/[\/?#]/g</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">c</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s4">'%' </span><span class="s2">+ </span><span class="s1">c</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s6">0</span><span class="s2">).</span><span class="s1">toString</span><span class="s2">(</span><span class="s6">16</span><span class="s2">).</span><span class="s1">toUpperCase</span><span class="s2">()</span>
    <span class="s2">})</span>
  <span class="s2">}</span>

  <span class="s7">/**</span>
   <span class="s7">* Encode the asterisk parameter. Similar to `pretty`, but allows slashes.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{string}</span>
   <span class="s7">* </span><span class="s8">@return </span><span class="s7">{string}</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">encodeAsterisk </span><span class="s2">(</span><span class="s1">str</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">encodeURI</span><span class="s2">(</span><span class="s1">str</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/[?#]/g</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">c</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s4">'%' </span><span class="s2">+ </span><span class="s1">c</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s6">0</span><span class="s2">).</span><span class="s1">toString</span><span class="s2">(</span><span class="s6">16</span><span class="s2">).</span><span class="s1">toUpperCase</span><span class="s2">()</span>
    <span class="s2">})</span>
  <span class="s2">}</span>

  <span class="s7">/**</span>
   <span class="s7">* Expose a method for transforming tokens into the path function.</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">tokensToFunction </span><span class="s2">(</span><span class="s1">tokens</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s0">// Compile all the tokens into regexps.</span>
    <span class="s3">var </span><span class="s1">matches </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Array</span><span class="s2">(</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length</span><span class="s2">);</span>

    <span class="s0">// Compile all the patterns before compilation.</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] === </span><span class="s4">'object'</span><span class="s2">) {</span>
        <span class="s1">matches</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s3">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s4">'^(?:' </span><span class="s2">+ </span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">i</span><span class="s2">].</span><span class="s1">pattern </span><span class="s2">+ </span><span class="s4">')$'</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">(</span><span class="s1">options</span><span class="s2">));</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">return function </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">opts</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">data </span><span class="s2">= </span><span class="s1">obj </span><span class="s2">|| {};</span>
      <span class="s3">var </span><span class="s1">options </span><span class="s2">= </span><span class="s1">opts </span><span class="s2">|| {};</span>
      <span class="s3">var </span><span class="s1">encode </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">pretty </span><span class="s2">? </span><span class="s1">encodeURIComponentPretty </span><span class="s2">: </span><span class="s1">encodeURIComponent</span><span class="s2">;</span>

      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
        <span class="s3">var </span><span class="s1">token </span><span class="s2">= </span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">token </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">) {</span>
          <span class="s1">path </span><span class="s2">+= </span><span class="s1">token</span><span class="s2">;</span>

          <span class="s3">continue</span>
        <span class="s2">}</span>

        <span class="s3">var </span><span class="s1">value </span><span class="s2">= </span><span class="s1">data</span><span class="s2">[</span><span class="s1">token</span><span class="s2">.</span><span class="s1">name</span><span class="s2">];</span>
        <span class="s3">var </span><span class="s1">segment</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">value </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">optional</span><span class="s2">) {</span>
            <span class="s0">// Prepend partial segment prefixes.</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">partial</span><span class="s2">) {</span>
              <span class="s1">path </span><span class="s2">+= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">prefix</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s3">continue</span>
          <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">throw new </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s4">'Expected &quot;' </span><span class="s2">+ </span><span class="s1">token</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s4">'&quot; to be defined'</span><span class="s2">)</span>
          <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">isarray</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
          <span class="s3">if </span><span class="s2">(!</span><span class="s1">token</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">) {</span>
            <span class="s3">throw new </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s4">'Expected &quot;' </span><span class="s2">+ </span><span class="s1">token</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s4">'&quot; to not repeat, but received `' </span><span class="s2">+ </span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) + </span><span class="s4">'`'</span><span class="s2">)</span>
          <span class="s2">}</span>

          <span class="s3">if </span><span class="s2">(</span><span class="s1">value</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s6">0</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">optional</span><span class="s2">) {</span>
              <span class="s3">continue</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
              <span class="s3">throw new </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s4">'Expected &quot;' </span><span class="s2">+ </span><span class="s1">token</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s4">'&quot; to not be empty'</span><span class="s2">)</span>
            <span class="s2">}</span>
          <span class="s2">}</span>

          <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">j </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">j </span><span class="s2">&lt; </span><span class="s1">value</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">j</span><span class="s2">++) {</span>
            <span class="s1">segment </span><span class="s2">= </span><span class="s1">encode</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s1">j</span><span class="s2">]);</span>

            <span class="s3">if </span><span class="s2">(!</span><span class="s1">matches</span><span class="s2">[</span><span class="s1">i</span><span class="s2">].</span><span class="s1">test</span><span class="s2">(</span><span class="s1">segment</span><span class="s2">)) {</span>
              <span class="s3">throw new </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s4">'Expected all &quot;' </span><span class="s2">+ </span><span class="s1">token</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s4">'&quot; to match &quot;' </span><span class="s2">+ </span><span class="s1">token</span><span class="s2">.</span><span class="s1">pattern </span><span class="s2">+ </span><span class="s4">'&quot;, but received `' </span><span class="s2">+ </span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">segment</span><span class="s2">) + </span><span class="s4">'`'</span><span class="s2">)</span>
            <span class="s2">}</span>

            <span class="s1">path </span><span class="s2">+= (</span><span class="s1">j </span><span class="s2">=== </span><span class="s6">0 </span><span class="s2">? </span><span class="s1">token</span><span class="s2">.</span><span class="s1">prefix </span><span class="s2">: </span><span class="s1">token</span><span class="s2">.</span><span class="s1">delimiter</span><span class="s2">) + </span><span class="s1">segment</span><span class="s2">;</span>
          <span class="s2">}</span>

          <span class="s3">continue</span>
        <span class="s2">}</span>

        <span class="s1">segment </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">asterisk </span><span class="s2">? </span><span class="s1">encodeAsterisk</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) : </span><span class="s1">encode</span><span class="s2">(</span><span class="s1">value</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">matches</span><span class="s2">[</span><span class="s1">i</span><span class="s2">].</span><span class="s1">test</span><span class="s2">(</span><span class="s1">segment</span><span class="s2">)) {</span>
          <span class="s3">throw new </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s4">'Expected &quot;' </span><span class="s2">+ </span><span class="s1">token</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s4">'&quot; to match &quot;' </span><span class="s2">+ </span><span class="s1">token</span><span class="s2">.</span><span class="s1">pattern </span><span class="s2">+ </span><span class="s4">'&quot;, but received &quot;' </span><span class="s2">+ </span><span class="s1">segment </span><span class="s2">+ </span><span class="s4">'&quot;'</span><span class="s2">)</span>
        <span class="s2">}</span>

        <span class="s1">path </span><span class="s2">+= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">prefix </span><span class="s2">+ </span><span class="s1">segment</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">return </span><span class="s1">path</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s7">/**</span>
   <span class="s7">* Escape a regular expression string.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{string} str</span>
   <span class="s7">* </span><span class="s8">@return </span><span class="s7">{string}</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">escapeString </span><span class="s2">(</span><span class="s1">str</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">str</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/([.+*?=^!:${}()[\]|\/\\])/g</span><span class="s2">, </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">$1'</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s7">/**</span>
   <span class="s7">* Escape the capturing group by escaping special characters and meaning.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{string} group</span>
   <span class="s7">* </span><span class="s8">@return </span><span class="s7">{string}</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">escapeGroup </span><span class="s2">(</span><span class="s1">group</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">group</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/([=!:$\/()])/g</span><span class="s2">, </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">$1'</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s7">/**</span>
   <span class="s7">* Attach the keys as a property of the regexp.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{!RegExp} re</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{Array}   keys</span>
   <span class="s7">* </span><span class="s8">@return </span><span class="s7">{!RegExp}</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">attachKeys </span><span class="s2">(</span><span class="s1">re</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">) {</span>
    <span class="s1">re</span><span class="s2">.</span><span class="s1">keys </span><span class="s2">= </span><span class="s1">keys</span><span class="s2">;</span>
    <span class="s3">return </span><span class="s1">re</span>
  <span class="s2">}</span>

  <span class="s7">/**</span>
   <span class="s7">* Get the flags for a regexp from the options.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{Object} options</span>
   <span class="s7">* </span><span class="s8">@return </span><span class="s7">{string}</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">flags </span><span class="s2">(</span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">options </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">sensitive </span><span class="s2">? </span><span class="s4">'' </span><span class="s2">: </span><span class="s4">'i'</span>
  <span class="s2">}</span>

  <span class="s7">/**</span>
   <span class="s7">* Pull out keys from a regexp.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{!RegExp} path</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{!Array}  keys</span>
   <span class="s7">* </span><span class="s8">@return </span><span class="s7">{!RegExp}</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">regexpToRegexp </span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">) {</span>
    <span class="s0">// Use a negative lookahead to match only capturing groups.</span>
    <span class="s3">var </span><span class="s1">groups </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">source</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s5">/\((?!\?)/g</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">groups</span><span class="s2">) {</span>
      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">groups</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
        <span class="s1">keys</span><span class="s2">.</span><span class="s1">push</span><span class="s2">({</span>
          <span class="s1">name</span><span class="s2">: </span><span class="s1">i</span><span class="s2">,</span>
          <span class="s1">prefix</span><span class="s2">: </span><span class="s3">null</span><span class="s2">,</span>
          <span class="s1">delimiter</span><span class="s2">: </span><span class="s3">null</span><span class="s2">,</span>
          <span class="s1">optional</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
          <span class="s1">repeat</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
          <span class="s1">partial</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
          <span class="s1">asterisk</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
          <span class="s1">pattern</span><span class="s2">: </span><span class="s3">null</span>
        <span class="s2">});</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">attachKeys</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s7">/**</span>
   <span class="s7">* Transform an array into a regexp.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{!Array}  path</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{Array}   keys</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{!Object} options</span>
   <span class="s7">* </span><span class="s8">@return </span><span class="s7">{!RegExp}</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">arrayToRegexp </span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">parts </span><span class="s2">= [];</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">path</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
      <span class="s1">parts</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">pathToRegexp</span><span class="s2">(</span><span class="s1">path</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">keys</span><span class="s2">, </span><span class="s1">options</span><span class="s2">).</span><span class="s1">source</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">regexp </span><span class="s2">= </span><span class="s3">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s4">'(?:' </span><span class="s2">+ </span><span class="s1">parts</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'|'</span><span class="s2">) + </span><span class="s4">')'</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">(</span><span class="s1">options</span><span class="s2">));</span>

    <span class="s3">return </span><span class="s1">attachKeys</span><span class="s2">(</span><span class="s1">regexp</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s7">/**</span>
   <span class="s7">* Create a path regexp from string input.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{string}  path</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{!Array}  keys</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{!Object} options</span>
   <span class="s7">* </span><span class="s8">@return </span><span class="s7">{!RegExp}</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">stringToRegexp </span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">tokensToRegExp</span><span class="s2">(</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">options</span><span class="s2">), </span><span class="s1">keys</span><span class="s2">, </span><span class="s1">options</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s7">/**</span>
   <span class="s7">* Expose a function for taking tokens and returning a RegExp.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{!Array}          tokens</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{(Array|Object)=} keys</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{Object=}         options</span>
   <span class="s7">* </span><span class="s8">@return </span><span class="s7">{!RegExp}</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">tokensToRegExp </span><span class="s2">(</span><span class="s1">tokens</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">isarray</span><span class="s2">(</span><span class="s1">keys</span><span class="s2">)) {</span>
      <span class="s1">options </span><span class="s2">= </span><span class="s7">/** </span><span class="s8">@type </span><span class="s7">{!Object} */ </span><span class="s2">(</span><span class="s1">keys </span><span class="s2">|| </span><span class="s1">options</span><span class="s2">);</span>
      <span class="s1">keys </span><span class="s2">= [];</span>
    <span class="s2">}</span>

    <span class="s1">options </span><span class="s2">= </span><span class="s1">options </span><span class="s2">|| {};</span>

    <span class="s3">var </span><span class="s1">strict </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">strict</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">end </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">end </span><span class="s2">!== </span><span class="s3">false</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">route </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>

    <span class="s0">// Iterate over the tokens and create our regexp string.</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">token </span><span class="s2">= </span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">token </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">) {</span>
        <span class="s1">route </span><span class="s2">+= </span><span class="s1">escapeString</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s3">var </span><span class="s1">prefix </span><span class="s2">= </span><span class="s1">escapeString</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">prefix</span><span class="s2">);</span>
        <span class="s3">var </span><span class="s1">capture </span><span class="s2">= </span><span class="s4">'(?:' </span><span class="s2">+ </span><span class="s1">token</span><span class="s2">.</span><span class="s1">pattern </span><span class="s2">+ </span><span class="s4">')'</span><span class="s2">;</span>

        <span class="s1">keys</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">) {</span>
          <span class="s1">capture </span><span class="s2">+= </span><span class="s4">'(?:' </span><span class="s2">+ </span><span class="s1">prefix </span><span class="s2">+ </span><span class="s1">capture </span><span class="s2">+ </span><span class="s4">')*'</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">optional</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(!</span><span class="s1">token</span><span class="s2">.</span><span class="s1">partial</span><span class="s2">) {</span>
            <span class="s1">capture </span><span class="s2">= </span><span class="s4">'(?:' </span><span class="s2">+ </span><span class="s1">prefix </span><span class="s2">+ </span><span class="s4">'(' </span><span class="s2">+ </span><span class="s1">capture </span><span class="s2">+ </span><span class="s4">'))?'</span><span class="s2">;</span>
          <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">capture </span><span class="s2">= </span><span class="s1">prefix </span><span class="s2">+ </span><span class="s4">'(' </span><span class="s2">+ </span><span class="s1">capture </span><span class="s2">+ </span><span class="s4">')?'</span><span class="s2">;</span>
          <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
          <span class="s1">capture </span><span class="s2">= </span><span class="s1">prefix </span><span class="s2">+ </span><span class="s4">'(' </span><span class="s2">+ </span><span class="s1">capture </span><span class="s2">+ </span><span class="s4">')'</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">route </span><span class="s2">+= </span><span class="s1">capture</span><span class="s2">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">delimiter </span><span class="s2">= </span><span class="s1">escapeString</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">delimiter </span><span class="s2">|| </span><span class="s4">'/'</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">endsWithDelimiter </span><span class="s2">= </span><span class="s1">route</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(-</span><span class="s1">delimiter</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) === </span><span class="s1">delimiter</span><span class="s2">;</span>

    <span class="s0">// In non-strict mode we allow a slash at the end of match. If the path to</span>
    <span class="s0">// match already ends with a slash, we remove it for consistency. The slash</span>
    <span class="s0">// is valid at the end of a path match, not in the middle. This is important</span>
    <span class="s0">// in non-ending mode, where &quot;/test/&quot; shouldn't match &quot;/test//route&quot;.</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">strict</span><span class="s2">) {</span>
      <span class="s1">route </span><span class="s2">= (</span><span class="s1">endsWithDelimiter </span><span class="s2">? </span><span class="s1">route</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, -</span><span class="s1">delimiter</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) : </span><span class="s1">route</span><span class="s2">) + </span><span class="s4">'(?:' </span><span class="s2">+ </span><span class="s1">delimiter </span><span class="s2">+ </span><span class="s4">'(?=$))?'</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">end</span><span class="s2">) {</span>
      <span class="s1">route </span><span class="s2">+= </span><span class="s4">'$'</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s0">// In non-ending mode, we need the capturing groups to match as much as</span>
      <span class="s0">// possible by using a positive lookahead to the end or next path segment.</span>
      <span class="s1">route </span><span class="s2">+= </span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">endsWithDelimiter </span><span class="s2">? </span><span class="s4">'' </span><span class="s2">: </span><span class="s4">'(?=' </span><span class="s2">+ </span><span class="s1">delimiter </span><span class="s2">+ </span><span class="s4">'|$)'</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">attachKeys</span><span class="s2">(</span><span class="s3">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s4">'^' </span><span class="s2">+ </span><span class="s1">route</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">(</span><span class="s1">options</span><span class="s2">)), </span><span class="s1">keys</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s7">/**</span>
   <span class="s7">* Normalize the given path string, returning a regular expression.</span>
   <span class="s7">*</span>
   <span class="s7">* An empty array can be passed in for the keys, which will hold the</span>
   <span class="s7">* placeholder key descriptions. For example, using `/user/:id`, `keys` will</span>
   <span class="s7">* contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.</span>
   <span class="s7">*</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{(string|RegExp|Array)} path</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{(Array|Object)=}       keys</span>
   <span class="s7">* </span><span class="s8">@param  </span><span class="s7">{Object=}               options</span>
   <span class="s7">* </span><span class="s8">@return </span><span class="s7">{!RegExp}</span>
   <span class="s7">*/</span>
  <span class="s3">function </span><span class="s1">pathToRegexp </span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">isarray</span><span class="s2">(</span><span class="s1">keys</span><span class="s2">)) {</span>
      <span class="s1">options </span><span class="s2">= </span><span class="s7">/** </span><span class="s8">@type </span><span class="s7">{!Object} */ </span><span class="s2">(</span><span class="s1">keys </span><span class="s2">|| </span><span class="s1">options</span><span class="s2">);</span>
      <span class="s1">keys </span><span class="s2">= [];</span>
    <span class="s2">}</span>

    <span class="s1">options </span><span class="s2">= </span><span class="s1">options </span><span class="s2">|| {};</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">path </span><span class="s3">instanceof </span><span class="s1">RegExp</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">regexpToRegexp</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s7">/** </span><span class="s8">@type </span><span class="s7">{!Array} */ </span><span class="s2">(</span><span class="s1">keys</span><span class="s2">))</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">isarray</span><span class="s2">(</span><span class="s1">path</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">arrayToRegexp</span><span class="s2">(</span><span class="s7">/** </span><span class="s8">@type </span><span class="s7">{!Array} */ </span><span class="s2">(</span><span class="s1">path</span><span class="s2">), </span><span class="s7">/** </span><span class="s8">@type </span><span class="s7">{!Array} */ </span><span class="s2">(</span><span class="s1">keys</span><span class="s2">), </span><span class="s1">options</span><span class="s2">)</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">stringToRegexp</span><span class="s2">(</span><span class="s7">/** </span><span class="s8">@type </span><span class="s7">{string} */ </span><span class="s2">(</span><span class="s1">path</span><span class="s2">), </span><span class="s7">/** </span><span class="s8">@type </span><span class="s7">{!Array} */ </span><span class="s2">(</span><span class="s1">keys</span><span class="s2">), </span><span class="s1">options</span><span class="s2">)</span>
  <span class="s2">}</span>
  <span class="s1">pathToRegexp_1</span><span class="s2">.</span><span class="s1">parse </span><span class="s2">= </span><span class="s1">parse_1</span><span class="s2">;</span>
  <span class="s1">pathToRegexp_1</span><span class="s2">.</span><span class="s1">compile </span><span class="s2">= </span><span class="s1">compile_1</span><span class="s2">;</span>
  <span class="s1">pathToRegexp_1</span><span class="s2">.</span><span class="s1">tokensToFunction </span><span class="s2">= </span><span class="s1">tokensToFunction_1</span><span class="s2">;</span>
  <span class="s1">pathToRegexp_1</span><span class="s2">.</span><span class="s1">tokensToRegExp </span><span class="s2">= </span><span class="s1">tokensToRegExp_1</span><span class="s2">;</span>

  <span class="s0">/*  */</span>

  <span class="s0">// $flow-disable-line</span>
  <span class="s3">var </span><span class="s1">regexpCompileCache </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>

  <span class="s3">function </span><span class="s1">fillParams </span><span class="s2">(</span>
    <span class="s1">path</span><span class="s2">,</span>
    <span class="s1">params</span><span class="s2">,</span>
    <span class="s1">routeMsg</span>
  <span class="s2">) {</span>
    <span class="s1">params </span><span class="s2">= </span><span class="s1">params </span><span class="s2">|| {};</span>
    <span class="s3">try </span><span class="s2">{</span>
      <span class="s3">var </span><span class="s1">filler </span><span class="s2">=</span>
        <span class="s1">regexpCompileCache</span><span class="s2">[</span><span class="s1">path</span><span class="s2">] ||</span>
        <span class="s2">(</span><span class="s1">regexpCompileCache</span><span class="s2">[</span><span class="s1">path</span><span class="s2">] = </span><span class="s1">pathToRegexp_1</span><span class="s2">.</span><span class="s1">compile</span><span class="s2">(</span><span class="s1">path</span><span class="s2">));</span>

      <span class="s0">// Fix #2505 resolving asterisk routes { name: 'not-found', params: { pathMatch: '/not-found' }}</span>
      <span class="s0">// and fix #3106 so that you can work with location descriptor object having params.pathMatch equal to empty string</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">params</span><span class="s2">.</span><span class="s1">pathMatch </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">) { </span><span class="s1">params</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] = </span><span class="s1">params</span><span class="s2">.</span><span class="s1">pathMatch</span><span class="s2">; }</span>

      <span class="s3">return </span><span class="s1">filler</span><span class="s2">(</span><span class="s1">params</span><span class="s2">, { </span><span class="s1">pretty</span><span class="s2">: </span><span class="s3">true </span><span class="s2">})</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
      <span class="s2">{</span>
        <span class="s0">// Fix #3072 no warn if `pathMatch` is string</span>
        <span class="s1">warn</span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">params</span><span class="s2">.</span><span class="s1">pathMatch </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">, (</span><span class="s4">&quot;missing param for &quot; </span><span class="s2">+ </span><span class="s1">routeMsg </span><span class="s2">+ </span><span class="s4">&quot;: &quot; </span><span class="s2">+ (</span><span class="s1">e</span><span class="s2">.</span><span class="s1">message</span><span class="s2">)));</span>
      <span class="s2">}</span>
      <span class="s3">return </span><span class="s4">''</span>
    <span class="s2">} </span><span class="s3">finally </span><span class="s2">{</span>
      <span class="s0">// delete the 0 if it was added</span>
      <span class="s3">delete </span><span class="s1">params</span><span class="s2">[</span><span class="s6">0</span><span class="s2">];</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s3">function </span><span class="s1">normalizeLocation </span><span class="s2">(</span>
    <span class="s1">raw</span><span class="s2">,</span>
    <span class="s1">current</span><span class="s2">,</span>
    <span class="s1">append</span><span class="s2">,</span>
    <span class="s1">router</span>
  <span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">next </span><span class="s2">= </span><span class="s3">typeof </span><span class="s1">raw </span><span class="s2">=== </span><span class="s4">'string' </span><span class="s2">? { </span><span class="s1">path</span><span class="s2">: </span><span class="s1">raw </span><span class="s2">} : </span><span class="s1">raw</span><span class="s2">;</span>
    <span class="s0">// named target</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">next</span><span class="s2">.</span><span class="s1">_normalized</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">next</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">next</span><span class="s2">.</span><span class="s1">name</span><span class="s2">) {</span>
      <span class="s1">next </span><span class="s2">= </span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">raw</span><span class="s2">);</span>
      <span class="s3">var </span><span class="s1">params </span><span class="s2">= </span><span class="s1">next</span><span class="s2">.</span><span class="s1">params</span><span class="s2">;</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">params </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">params </span><span class="s2">=== </span><span class="s4">'object'</span><span class="s2">) {</span>
        <span class="s1">next</span><span class="s2">.</span><span class="s1">params </span><span class="s2">= </span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">params</span><span class="s2">);</span>
      <span class="s2">}</span>
      <span class="s3">return </span><span class="s1">next</span>
    <span class="s2">}</span>

    <span class="s0">// relative params</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">next</span><span class="s2">.</span><span class="s1">path </span><span class="s2">&amp;&amp; </span><span class="s1">next</span><span class="s2">.</span><span class="s1">params </span><span class="s2">&amp;&amp; </span><span class="s1">current</span><span class="s2">) {</span>
      <span class="s1">next </span><span class="s2">= </span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">next</span><span class="s2">);</span>
      <span class="s1">next</span><span class="s2">.</span><span class="s1">_normalized </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">params$1 </span><span class="s2">= </span><span class="s1">extend</span><span class="s2">(</span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">current</span><span class="s2">.</span><span class="s1">params</span><span class="s2">), </span><span class="s1">next</span><span class="s2">.</span><span class="s1">params</span><span class="s2">);</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">current</span><span class="s2">.</span><span class="s1">name</span><span class="s2">) {</span>
        <span class="s1">next</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">current</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
        <span class="s1">next</span><span class="s2">.</span><span class="s1">params </span><span class="s2">= </span><span class="s1">params$1</span><span class="s2">;</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">current</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">rawPath </span><span class="s2">= </span><span class="s1">current</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">[</span><span class="s1">current</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s6">1</span><span class="s2">].</span><span class="s1">path</span><span class="s2">;</span>
        <span class="s1">next</span><span class="s2">.</span><span class="s1">path </span><span class="s2">= </span><span class="s1">fillParams</span><span class="s2">(</span><span class="s1">rawPath</span><span class="s2">, </span><span class="s1">params$1</span><span class="s2">, (</span><span class="s4">&quot;path &quot; </span><span class="s2">+ (</span><span class="s1">current</span><span class="s2">.</span><span class="s1">path</span><span class="s2">)));</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">warn</span><span class="s2">(</span><span class="s3">false</span><span class="s2">, </span><span class="s4">&quot;relative params navigation requires a current route.&quot;</span><span class="s2">);</span>
      <span class="s2">}</span>
      <span class="s3">return </span><span class="s1">next</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">parsedPath </span><span class="s2">= </span><span class="s1">parsePath</span><span class="s2">(</span><span class="s1">next</span><span class="s2">.</span><span class="s1">path </span><span class="s2">|| </span><span class="s4">''</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">basePath </span><span class="s2">= (</span><span class="s1">current </span><span class="s2">&amp;&amp; </span><span class="s1">current</span><span class="s2">.</span><span class="s1">path</span><span class="s2">) || </span><span class="s4">'/'</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s1">parsedPath</span><span class="s2">.</span><span class="s1">path</span>
      <span class="s2">? </span><span class="s1">resolvePath</span><span class="s2">(</span><span class="s1">parsedPath</span><span class="s2">.</span><span class="s1">path</span><span class="s2">, </span><span class="s1">basePath</span><span class="s2">, </span><span class="s1">append </span><span class="s2">|| </span><span class="s1">next</span><span class="s2">.</span><span class="s1">append</span><span class="s2">)</span>
      <span class="s2">: </span><span class="s1">basePath</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">query </span><span class="s2">= </span><span class="s1">resolveQuery</span><span class="s2">(</span>
      <span class="s1">parsedPath</span><span class="s2">.</span><span class="s1">query</span><span class="s2">,</span>
      <span class="s1">next</span><span class="s2">.</span><span class="s1">query</span><span class="s2">,</span>
      <span class="s1">router </span><span class="s2">&amp;&amp; </span><span class="s1">router</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">parseQuery</span>
    <span class="s2">);</span>

    <span class="s3">var </span><span class="s1">hash </span><span class="s2">= </span><span class="s1">next</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">|| </span><span class="s1">parsedPath</span><span class="s2">.</span><span class="s1">hash</span><span class="s2">;</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">hash </span><span class="s2">&amp;&amp; </span><span class="s1">hash</span><span class="s2">.</span><span class="s1">charAt</span><span class="s2">(</span><span class="s6">0</span><span class="s2">) !== </span><span class="s4">'#'</span><span class="s2">) {</span>
      <span class="s1">hash </span><span class="s2">= </span><span class="s4">&quot;#&quot; </span><span class="s2">+ </span><span class="s1">hash</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s2">{</span>
      <span class="s1">_normalized</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
      <span class="s1">path</span><span class="s2">: </span><span class="s1">path</span><span class="s2">,</span>
      <span class="s1">query</span><span class="s2">: </span><span class="s1">query</span><span class="s2">,</span>
      <span class="s1">hash</span><span class="s2">: </span><span class="s1">hash</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s0">// work around weird flow bug</span>
  <span class="s3">var </span><span class="s1">toTypes </span><span class="s2">= [</span><span class="s1">String</span><span class="s2">, </span><span class="s1">Object</span><span class="s2">];</span>
  <span class="s3">var </span><span class="s1">eventTypes </span><span class="s2">= [</span><span class="s1">String</span><span class="s2">, </span><span class="s1">Array</span><span class="s2">];</span>

  <span class="s3">var </span><span class="s1">noop </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {};</span>

  <span class="s3">var </span><span class="s1">warnedCustomSlot</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">warnedTagProp</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">warnedEventProp</span><span class="s2">;</span>

  <span class="s3">var </span><span class="s1">Link </span><span class="s2">= {</span>
    <span class="s1">name</span><span class="s2">: </span><span class="s4">'RouterLink'</span><span class="s2">,</span>
    <span class="s1">props</span><span class="s2">: {</span>
      <span class="s1">to</span><span class="s2">: {</span>
        <span class="s1">type</span><span class="s2">: </span><span class="s1">toTypes</span><span class="s2">,</span>
        <span class="s1">required</span><span class="s2">: </span><span class="s3">true</span>
      <span class="s2">},</span>
      <span class="s1">tag</span><span class="s2">: {</span>
        <span class="s1">type</span><span class="s2">: </span><span class="s1">String</span><span class="s2">,</span>
        <span class="s3">default</span><span class="s2">: </span><span class="s4">'a'</span>
      <span class="s2">},</span>
      <span class="s1">custom</span><span class="s2">: </span><span class="s1">Boolean</span><span class="s2">,</span>
      <span class="s1">exact</span><span class="s2">: </span><span class="s1">Boolean</span><span class="s2">,</span>
      <span class="s1">exactPath</span><span class="s2">: </span><span class="s1">Boolean</span><span class="s2">,</span>
      <span class="s1">append</span><span class="s2">: </span><span class="s1">Boolean</span><span class="s2">,</span>
      <span class="s1">replace</span><span class="s2">: </span><span class="s1">Boolean</span><span class="s2">,</span>
      <span class="s1">activeClass</span><span class="s2">: </span><span class="s1">String</span><span class="s2">,</span>
      <span class="s1">exactActiveClass</span><span class="s2">: </span><span class="s1">String</span><span class="s2">,</span>
      <span class="s1">ariaCurrentValue</span><span class="s2">: {</span>
        <span class="s1">type</span><span class="s2">: </span><span class="s1">String</span><span class="s2">,</span>
        <span class="s3">default</span><span class="s2">: </span><span class="s4">'page'</span>
      <span class="s2">},</span>
      <span class="s1">event</span><span class="s2">: {</span>
        <span class="s1">type</span><span class="s2">: </span><span class="s1">eventTypes</span><span class="s2">,</span>
        <span class="s3">default</span><span class="s2">: </span><span class="s4">'click'</span>
      <span class="s2">}</span>
    <span class="s2">},</span>
    <span class="s1">render</span><span class="s2">: </span><span class="s3">function </span><span class="s1">render </span><span class="s2">(</span><span class="s1">h</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">router </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$router</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">current </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$route</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">ref </span><span class="s2">= </span><span class="s1">router</span><span class="s2">.</span><span class="s1">resolve</span><span class="s2">(</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">to</span><span class="s2">,</span>
        <span class="s1">current</span><span class="s2">,</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">append</span>
      <span class="s2">);</span>
      <span class="s3">var </span><span class="s1">location </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">location</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">route </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">route</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">href </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">href</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">classes </span><span class="s2">= {};</span>
      <span class="s3">var </span><span class="s1">globalActiveClass </span><span class="s2">= </span><span class="s1">router</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">linkActiveClass</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">globalExactActiveClass </span><span class="s2">= </span><span class="s1">router</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">linkExactActiveClass</span><span class="s2">;</span>
      <span class="s0">// Support global empty active class</span>
      <span class="s3">var </span><span class="s1">activeClassFallback </span><span class="s2">=</span>
        <span class="s1">globalActiveClass </span><span class="s2">== </span><span class="s3">null </span><span class="s2">? </span><span class="s4">'router-link-active' </span><span class="s2">: </span><span class="s1">globalActiveClass</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">exactActiveClassFallback </span><span class="s2">=</span>
        <span class="s1">globalExactActiveClass </span><span class="s2">== </span><span class="s3">null</span>
          <span class="s2">? </span><span class="s4">'router-link-exact-active'</span>
          <span class="s2">: </span><span class="s1">globalExactActiveClass</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">activeClass </span><span class="s2">=</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">activeClass </span><span class="s2">== </span><span class="s3">null </span><span class="s2">? </span><span class="s1">activeClassFallback </span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">activeClass</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">exactActiveClass </span><span class="s2">=</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">exactActiveClass </span><span class="s2">== </span><span class="s3">null</span>
          <span class="s2">? </span><span class="s1">exactActiveClassFallback</span>
          <span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">exactActiveClass</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">compareTarget </span><span class="s2">= </span><span class="s1">route</span><span class="s2">.</span><span class="s1">redirectedFrom</span>
        <span class="s2">? </span><span class="s1">createRoute</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">normalizeLocation</span><span class="s2">(</span><span class="s1">route</span><span class="s2">.</span><span class="s1">redirectedFrom</span><span class="s2">), </span><span class="s3">null</span><span class="s2">, </span><span class="s1">router</span><span class="s2">)</span>
        <span class="s2">: </span><span class="s1">route</span><span class="s2">;</span>

      <span class="s1">classes</span><span class="s2">[</span><span class="s1">exactActiveClass</span><span class="s2">] = </span><span class="s1">isSameRoute</span><span class="s2">(</span><span class="s1">current</span><span class="s2">, </span><span class="s1">compareTarget</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">exactPath</span><span class="s2">);</span>
      <span class="s1">classes</span><span class="s2">[</span><span class="s1">activeClass</span><span class="s2">] = </span><span class="s3">this</span><span class="s2">.</span><span class="s1">exact </span><span class="s2">|| </span><span class="s3">this</span><span class="s2">.</span><span class="s1">exactPath</span>
        <span class="s2">? </span><span class="s1">classes</span><span class="s2">[</span><span class="s1">exactActiveClass</span><span class="s2">]</span>
        <span class="s2">: </span><span class="s1">isIncludedRoute</span><span class="s2">(</span><span class="s1">current</span><span class="s2">, </span><span class="s1">compareTarget</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">ariaCurrentValue </span><span class="s2">= </span><span class="s1">classes</span><span class="s2">[</span><span class="s1">exactActiveClass</span><span class="s2">] ? </span><span class="s3">this</span><span class="s2">.</span><span class="s1">ariaCurrentValue </span><span class="s2">: </span><span class="s3">null</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">handler </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">guardEvent</span><span class="s2">(</span><span class="s1">e</span><span class="s2">)) {</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">) {</span>
            <span class="s1">router</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">noop</span><span class="s2">);</span>
          <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">router</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">noop</span><span class="s2">);</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
      <span class="s2">};</span>

      <span class="s3">var </span><span class="s1">on </span><span class="s2">= { </span><span class="s1">click</span><span class="s2">: </span><span class="s1">guardEvent </span><span class="s2">};</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">event</span><span class="s2">)) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">event</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
          <span class="s1">on</span><span class="s2">[</span><span class="s1">e</span><span class="s2">] = </span><span class="s1">handler</span><span class="s2">;</span>
        <span class="s2">});</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">on</span><span class="s2">[</span><span class="s3">this</span><span class="s2">.</span><span class="s1">event</span><span class="s2">] = </span><span class="s1">handler</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">data </span><span class="s2">= { </span><span class="s3">class</span><span class="s2">: </span><span class="s1">classes </span><span class="s2">};</span>

      <span class="s3">var </span><span class="s1">scopedSlot </span><span class="s2">=</span>
        <span class="s2">!</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$scopedSlots</span><span class="s2">.</span><span class="s1">$hasNormal </span><span class="s2">&amp;&amp;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">$scopedSlots</span><span class="s2">.</span><span class="s1">default </span><span class="s2">&amp;&amp;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">$scopedSlots</span><span class="s2">.</span><span class="s1">default</span><span class="s2">({</span>
          <span class="s1">href</span><span class="s2">: </span><span class="s1">href</span><span class="s2">,</span>
          <span class="s1">route</span><span class="s2">: </span><span class="s1">route</span><span class="s2">,</span>
          <span class="s1">navigate</span><span class="s2">: </span><span class="s1">handler</span><span class="s2">,</span>
          <span class="s1">isActive</span><span class="s2">: </span><span class="s1">classes</span><span class="s2">[</span><span class="s1">activeClass</span><span class="s2">],</span>
          <span class="s1">isExactActive</span><span class="s2">: </span><span class="s1">classes</span><span class="s2">[</span><span class="s1">exactActiveClass</span><span class="s2">]</span>
        <span class="s2">});</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">scopedSlot</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s3">this</span><span class="s2">.</span><span class="s1">custom</span><span class="s2">) {</span>
          <span class="s2">!</span><span class="s1">warnedCustomSlot </span><span class="s2">&amp;&amp; </span><span class="s1">warn</span><span class="s2">(</span><span class="s3">false</span><span class="s2">, </span><span class="s4">'In Vue Router 4, the v-slot API will by default wrap its content with an &lt;a&gt; element. Use the custom prop to remove this warning:</span><span class="s3">\n</span><span class="s4">&lt;router-link v-slot=&quot;{ navigate, href }&quot; custom&gt;&lt;/router-link&gt;</span><span class="s3">\n</span><span class="s4">'</span><span class="s2">);</span>
          <span class="s1">warnedCustomSlot </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">scopedSlot</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s6">1</span><span class="s2">) {</span>
          <span class="s3">return </span><span class="s1">scopedSlot</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">scopedSlot</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s6">1 </span><span class="s2">|| !</span><span class="s1">scopedSlot</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
          <span class="s2">{</span>
            <span class="s1">warn</span><span class="s2">(</span>
              <span class="s3">false</span><span class="s2">,</span>
              <span class="s2">(</span><span class="s4">&quot;&lt;router-link&gt; with to=</span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ (</span><span class="s3">this</span><span class="s2">.</span><span class="s1">to</span><span class="s2">) + </span><span class="s4">&quot;</span><span class="s3">\&quot; </span><span class="s4">is trying to use a scoped slot but it didn't provide exactly one child. Wrapping the content with a span element.&quot;</span><span class="s2">)</span>
            <span class="s2">);</span>
          <span class="s2">}</span>
          <span class="s3">return </span><span class="s1">scopedSlot</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s6">0 </span><span class="s2">? </span><span class="s1">h</span><span class="s2">() : </span><span class="s1">h</span><span class="s2">(</span><span class="s4">'span'</span><span class="s2">, {}, </span><span class="s1">scopedSlot</span><span class="s2">)</span>
        <span class="s2">}</span>
      <span class="s2">}</span>

      <span class="s2">{</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s4">'tag' </span><span class="s3">in this</span><span class="s2">.</span><span class="s1">$options</span><span class="s2">.</span><span class="s1">propsData </span><span class="s2">&amp;&amp; !</span><span class="s1">warnedTagProp</span><span class="s2">) {</span>
          <span class="s1">warn</span><span class="s2">(</span>
            <span class="s3">false</span><span class="s2">,</span>
            <span class="s4">&quot;&lt;router-link&gt;'s tag prop is deprecated and has been removed in Vue Router 4. Use the v-slot API to remove this warning: https://next.router.vuejs.org/guide/migration/#removal-of-event-and-tag-props-in-router-link.&quot;</span>
          <span class="s2">);</span>
          <span class="s1">warnedTagProp </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s4">'event' </span><span class="s3">in this</span><span class="s2">.</span><span class="s1">$options</span><span class="s2">.</span><span class="s1">propsData </span><span class="s2">&amp;&amp; !</span><span class="s1">warnedEventProp</span><span class="s2">) {</span>
          <span class="s1">warn</span><span class="s2">(</span>
            <span class="s3">false</span><span class="s2">,</span>
            <span class="s4">&quot;&lt;router-link&gt;'s event prop is deprecated and has been removed in Vue Router 4. Use the v-slot API to remove this warning: https://next.router.vuejs.org/guide/migration/#removal-of-event-and-tag-props-in-router-link.&quot;</span>
          <span class="s2">);</span>
          <span class="s1">warnedEventProp </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">tag </span><span class="s2">=== </span><span class="s4">'a'</span><span class="s2">) {</span>
        <span class="s1">data</span><span class="s2">.</span><span class="s1">on </span><span class="s2">= </span><span class="s1">on</span><span class="s2">;</span>
        <span class="s1">data</span><span class="s2">.</span><span class="s1">attrs </span><span class="s2">= { </span><span class="s1">href</span><span class="s2">: </span><span class="s1">href</span><span class="s2">, </span><span class="s4">'aria-current'</span><span class="s2">: </span><span class="s1">ariaCurrentValue </span><span class="s2">};</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s0">// find the first &lt;a&gt; child and apply listener and href</span>
        <span class="s3">var </span><span class="s1">a </span><span class="s2">= </span><span class="s1">findAnchor</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$slots</span><span class="s2">.</span><span class="s1">default</span><span class="s2">);</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">a</span><span class="s2">) {</span>
          <span class="s0">// in case the &lt;a&gt; is a static node</span>
          <span class="s1">a</span><span class="s2">.</span><span class="s1">isStatic </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
          <span class="s3">var </span><span class="s1">aData </span><span class="s2">= (</span><span class="s1">a</span><span class="s2">.</span><span class="s1">data </span><span class="s2">= </span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">a</span><span class="s2">.</span><span class="s1">data</span><span class="s2">));</span>
          <span class="s1">aData</span><span class="s2">.</span><span class="s1">on </span><span class="s2">= </span><span class="s1">aData</span><span class="s2">.</span><span class="s1">on </span><span class="s2">|| {};</span>
          <span class="s0">// transform existing events in both objects into arrays so we can push later</span>
          <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">event </span><span class="s3">in </span><span class="s1">aData</span><span class="s2">.</span><span class="s1">on</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">handler$1 </span><span class="s2">= </span><span class="s1">aData</span><span class="s2">.</span><span class="s1">on</span><span class="s2">[</span><span class="s1">event</span><span class="s2">];</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">event </span><span class="s3">in </span><span class="s1">on</span><span class="s2">) {</span>
              <span class="s1">aData</span><span class="s2">.</span><span class="s1">on</span><span class="s2">[</span><span class="s1">event</span><span class="s2">] = </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">handler$1</span><span class="s2">) ? </span><span class="s1">handler$1 </span><span class="s2">: [</span><span class="s1">handler$1</span><span class="s2">];</span>
            <span class="s2">}</span>
          <span class="s2">}</span>
          <span class="s0">// append new listeners for router-link</span>
          <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">event$1 </span><span class="s3">in </span><span class="s1">on</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">event$1 </span><span class="s3">in </span><span class="s1">aData</span><span class="s2">.</span><span class="s1">on</span><span class="s2">) {</span>
              <span class="s0">// on[event] is always a function</span>
              <span class="s1">aData</span><span class="s2">.</span><span class="s1">on</span><span class="s2">[</span><span class="s1">event$1</span><span class="s2">].</span><span class="s1">push</span><span class="s2">(</span><span class="s1">on</span><span class="s2">[</span><span class="s1">event$1</span><span class="s2">]);</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
              <span class="s1">aData</span><span class="s2">.</span><span class="s1">on</span><span class="s2">[</span><span class="s1">event$1</span><span class="s2">] = </span><span class="s1">handler</span><span class="s2">;</span>
            <span class="s2">}</span>
          <span class="s2">}</span>

          <span class="s3">var </span><span class="s1">aAttrs </span><span class="s2">= (</span><span class="s1">a</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">attrs </span><span class="s2">= </span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">a</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">attrs</span><span class="s2">));</span>
          <span class="s1">aAttrs</span><span class="s2">.</span><span class="s1">href </span><span class="s2">= </span><span class="s1">href</span><span class="s2">;</span>
          <span class="s1">aAttrs</span><span class="s2">[</span><span class="s4">'aria-current'</span><span class="s2">] = </span><span class="s1">ariaCurrentValue</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
          <span class="s0">// doesn't have &lt;a&gt; child, apply listener to self</span>
          <span class="s1">data</span><span class="s2">.</span><span class="s1">on </span><span class="s2">= </span><span class="s1">on</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>

      <span class="s3">return </span><span class="s1">h</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$slots</span><span class="s2">.</span><span class="s1">default</span><span class="s2">)</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s3">function </span><span class="s1">guardEvent </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
    <span class="s0">// don't redirect with control keys</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">metaKey </span><span class="s2">|| </span><span class="s1">e</span><span class="s2">.</span><span class="s1">altKey </span><span class="s2">|| </span><span class="s1">e</span><span class="s2">.</span><span class="s1">ctrlKey </span><span class="s2">|| </span><span class="s1">e</span><span class="s2">.</span><span class="s1">shiftKey</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">}</span>
    <span class="s0">// don't redirect when preventDefault called</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">defaultPrevented</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">}</span>
    <span class="s0">// don't redirect on right click</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">button </span><span class="s2">!== </span><span class="s1">undefined </span><span class="s2">&amp;&amp; </span><span class="s1">e</span><span class="s2">.</span><span class="s1">button </span><span class="s2">!== </span><span class="s6">0</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">}</span>
    <span class="s0">// don't redirect if `target=&quot;_blank&quot;`</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">currentTarget </span><span class="s2">&amp;&amp; </span><span class="s1">e</span><span class="s2">.</span><span class="s1">currentTarget</span><span class="s2">.</span><span class="s1">getAttribute</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">target </span><span class="s2">= </span><span class="s1">e</span><span class="s2">.</span><span class="s1">currentTarget</span><span class="s2">.</span><span class="s1">getAttribute</span><span class="s2">(</span><span class="s4">'target'</span><span class="s2">);</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s5">/\b_blank\b/i</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">target</span><span class="s2">)) { </span><span class="s3">return </span><span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">// this may be a Weex event which doesn't have this method</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">preventDefault</span><span class="s2">) {</span>
      <span class="s1">e</span><span class="s2">.</span><span class="s1">preventDefault</span><span class="s2">();</span>
    <span class="s2">}</span>
    <span class="s3">return true</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">findAnchor </span><span class="s2">(</span><span class="s1">children</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">children</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">child</span><span class="s2">;</span>
      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">children</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
        <span class="s1">child </span><span class="s2">= </span><span class="s1">children</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">child</span><span class="s2">.</span><span class="s1">tag </span><span class="s2">=== </span><span class="s4">'a'</span><span class="s2">) {</span>
          <span class="s3">return </span><span class="s1">child</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">child</span><span class="s2">.</span><span class="s1">children </span><span class="s2">&amp;&amp; (</span><span class="s1">child </span><span class="s2">= </span><span class="s1">findAnchor</span><span class="s2">(</span><span class="s1">child</span><span class="s2">.</span><span class="s1">children</span><span class="s2">))) {</span>
          <span class="s3">return </span><span class="s1">child</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">var </span><span class="s1">_Vue</span><span class="s2">;</span>

  <span class="s3">function </span><span class="s1">install </span><span class="s2">(</span><span class="s1">Vue</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">install</span><span class="s2">.</span><span class="s1">installed </span><span class="s2">&amp;&amp; </span><span class="s1">_Vue </span><span class="s2">=== </span><span class="s1">Vue</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">}</span>
    <span class="s1">install</span><span class="s2">.</span><span class="s1">installed </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

    <span class="s1">_Vue </span><span class="s2">= </span><span class="s1">Vue</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">isDef </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">v</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">v </span><span class="s2">!== </span><span class="s1">undefined</span><span class="s2">; };</span>

    <span class="s3">var </span><span class="s1">registerInstance </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">vm</span><span class="s2">, </span><span class="s1">callVal</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">vm</span><span class="s2">.</span><span class="s1">$options</span><span class="s2">.</span><span class="s1">_parentVnode</span><span class="s2">;</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">isDef</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) &amp;&amp; </span><span class="s1">isDef</span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s1">i</span><span class="s2">.</span><span class="s1">data</span><span class="s2">) &amp;&amp; </span><span class="s1">isDef</span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s1">i</span><span class="s2">.</span><span class="s1">registerRouteInstance</span><span class="s2">)) {</span>
        <span class="s1">i</span><span class="s2">(</span><span class="s1">vm</span><span class="s2">, </span><span class="s1">callVal</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">};</span>

    <span class="s1">Vue</span><span class="s2">.</span><span class="s1">mixin</span><span class="s2">({</span>
      <span class="s1">beforeCreate</span><span class="s2">: </span><span class="s3">function </span><span class="s1">beforeCreate </span><span class="s2">() {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">isDef</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$options</span><span class="s2">.</span><span class="s1">router</span><span class="s2">)) {</span>
          <span class="s3">this</span><span class="s2">.</span><span class="s1">_routerRoot </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>
          <span class="s3">this</span><span class="s2">.</span><span class="s1">_router </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$options</span><span class="s2">.</span><span class="s1">router</span><span class="s2">;</span>
          <span class="s3">this</span><span class="s2">.</span><span class="s1">_router</span><span class="s2">.</span><span class="s1">init</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
          <span class="s1">Vue</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">defineReactive</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'_route'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_router</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">current</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
          <span class="s3">this</span><span class="s2">.</span><span class="s1">_routerRoot </span><span class="s2">= (</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$parent </span><span class="s2">&amp;&amp; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$parent</span><span class="s2">.</span><span class="s1">_routerRoot</span><span class="s2">) || </span><span class="s3">this</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s1">registerInstance</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s3">this</span><span class="s2">);</span>
      <span class="s2">},</span>
      <span class="s1">destroyed</span><span class="s2">: </span><span class="s3">function </span><span class="s1">destroyed </span><span class="s2">() {</span>
        <span class="s1">registerInstance</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">Object</span><span class="s2">.</span><span class="s1">defineProperty</span><span class="s2">(</span><span class="s1">Vue</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">, </span><span class="s4">'$router'</span><span class="s2">, {</span>
      <span class="s1">get</span><span class="s2">: </span><span class="s3">function </span><span class="s1">get </span><span class="s2">() { </span><span class="s3">return this</span><span class="s2">.</span><span class="s1">_routerRoot</span><span class="s2">.</span><span class="s1">_router </span><span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">Object</span><span class="s2">.</span><span class="s1">defineProperty</span><span class="s2">(</span><span class="s1">Vue</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">, </span><span class="s4">'$route'</span><span class="s2">, {</span>
      <span class="s1">get</span><span class="s2">: </span><span class="s3">function </span><span class="s1">get </span><span class="s2">() { </span><span class="s3">return this</span><span class="s2">.</span><span class="s1">_routerRoot</span><span class="s2">.</span><span class="s1">_route </span><span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">Vue</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s4">'RouterView'</span><span class="s2">, </span><span class="s1">View</span><span class="s2">);</span>
    <span class="s1">Vue</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s4">'RouterLink'</span><span class="s2">, </span><span class="s1">Link</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">strats </span><span class="s2">= </span><span class="s1">Vue</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">optionMergeStrategies</span><span class="s2">;</span>
    <span class="s0">// use the same hook merging strategy for route hooks</span>
    <span class="s1">strats</span><span class="s2">.</span><span class="s1">beforeRouteEnter </span><span class="s2">= </span><span class="s1">strats</span><span class="s2">.</span><span class="s1">beforeRouteLeave </span><span class="s2">= </span><span class="s1">strats</span><span class="s2">.</span><span class="s1">beforeRouteUpdate </span><span class="s2">= </span><span class="s1">strats</span><span class="s2">.</span><span class="s1">created</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s3">var </span><span class="s1">inBrowser </span><span class="s2">= </span><span class="s3">typeof </span><span class="s1">window </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">;</span>

  <span class="s0">/*  */</span>

  <span class="s3">function </span><span class="s1">createRouteMap </span><span class="s2">(</span>
    <span class="s1">routes</span><span class="s2">,</span>
    <span class="s1">oldPathList</span><span class="s2">,</span>
    <span class="s1">oldPathMap</span><span class="s2">,</span>
    <span class="s1">oldNameMap</span><span class="s2">,</span>
    <span class="s1">parentRoute</span>
  <span class="s2">) {</span>
    <span class="s0">// the path list is used to control path matching priority</span>
    <span class="s3">var </span><span class="s1">pathList </span><span class="s2">= </span><span class="s1">oldPathList </span><span class="s2">|| [];</span>
    <span class="s0">// $flow-disable-line</span>
    <span class="s3">var </span><span class="s1">pathMap </span><span class="s2">= </span><span class="s1">oldPathMap </span><span class="s2">|| </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
    <span class="s0">// $flow-disable-line</span>
    <span class="s3">var </span><span class="s1">nameMap </span><span class="s2">= </span><span class="s1">oldNameMap </span><span class="s2">|| </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>

    <span class="s1">routes</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">route</span><span class="s2">) {</span>
      <span class="s1">addRouteRecord</span><span class="s2">(</span><span class="s1">pathList</span><span class="s2">, </span><span class="s1">pathMap</span><span class="s2">, </span><span class="s1">nameMap</span><span class="s2">, </span><span class="s1">route</span><span class="s2">, </span><span class="s1">parentRoute</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s0">// ensure wildcard routes are always at the end</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">, </span><span class="s1">l </span><span class="s2">= </span><span class="s1">pathList</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">l</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">pathList</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] === </span><span class="s4">'*'</span><span class="s2">) {</span>
        <span class="s1">pathList</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">pathList</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s6">1</span><span class="s2">)[</span><span class="s6">0</span><span class="s2">]);</span>
        <span class="s1">l</span><span class="s2">--;</span>
        <span class="s1">i</span><span class="s2">--;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s2">{</span>
      <span class="s0">// warn if routes do not include leading slashes</span>
      <span class="s3">var </span><span class="s1">found </span><span class="s2">= </span><span class="s1">pathList</span>
      <span class="s0">// check for missing leading slash</span>
        <span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">path </span><span class="s2">&amp;&amp; </span><span class="s1">path</span><span class="s2">.</span><span class="s1">charAt</span><span class="s2">(</span><span class="s6">0</span><span class="s2">) !== </span><span class="s4">'*' </span><span class="s2">&amp;&amp; </span><span class="s1">path</span><span class="s2">.</span><span class="s1">charAt</span><span class="s2">(</span><span class="s6">0</span><span class="s2">) !== </span><span class="s4">'/'</span><span class="s2">; });</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">found</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s6">0</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">pathNames </span><span class="s2">= </span><span class="s1">found</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">(</span><span class="s4">&quot;- &quot; </span><span class="s2">+ </span><span class="s1">path</span><span class="s2">); }).</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'</span><span class="s3">\n</span><span class="s4">'</span><span class="s2">);</span>
        <span class="s1">warn</span><span class="s2">(</span><span class="s3">false</span><span class="s2">, (</span><span class="s4">&quot;Non-nested routes must include a leading slash character. Fix the following routes: </span><span class="s3">\n</span><span class="s4">&quot; </span><span class="s2">+ </span><span class="s1">pathNames</span><span class="s2">));</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s2">{</span>
      <span class="s1">pathList</span><span class="s2">: </span><span class="s1">pathList</span><span class="s2">,</span>
      <span class="s1">pathMap</span><span class="s2">: </span><span class="s1">pathMap</span><span class="s2">,</span>
      <span class="s1">nameMap</span><span class="s2">: </span><span class="s1">nameMap</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">addRouteRecord </span><span class="s2">(</span>
    <span class="s1">pathList</span><span class="s2">,</span>
    <span class="s1">pathMap</span><span class="s2">,</span>
    <span class="s1">nameMap</span><span class="s2">,</span>
    <span class="s1">route</span><span class="s2">,</span>
    <span class="s1">parent</span><span class="s2">,</span>
    <span class="s1">matchAs</span>
  <span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s1">route</span><span class="s2">.</span><span class="s1">path</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">name </span><span class="s2">= </span><span class="s1">route</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
    <span class="s2">{</span>
      <span class="s1">assert</span><span class="s2">(</span><span class="s1">path </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">, </span><span class="s4">&quot;</span><span class="s3">\&quot;</span><span class="s4">path</span><span class="s3">\&quot; </span><span class="s4">is required in a route configuration.&quot;</span><span class="s2">);</span>
      <span class="s1">assert</span><span class="s2">(</span>
        <span class="s3">typeof </span><span class="s1">route</span><span class="s2">.</span><span class="s1">component </span><span class="s2">!== </span><span class="s4">'string'</span><span class="s2">,</span>
        <span class="s4">&quot;route config </span><span class="s3">\&quot;</span><span class="s4">component</span><span class="s3">\&quot; </span><span class="s4">for path: &quot; </span><span class="s2">+ (</span><span class="s1">String</span><span class="s2">(</span>
          <span class="s1">path </span><span class="s2">|| </span><span class="s1">name</span>
        <span class="s2">)) + </span><span class="s4">&quot; cannot be a &quot; </span><span class="s2">+ </span><span class="s4">&quot;string id. Use an actual component instead.&quot;</span>
      <span class="s2">);</span>

      <span class="s1">warn</span><span class="s2">(</span>
        <span class="s0">// eslint-disable-next-line no-control-regex</span>
        <span class="s2">!</span><span class="s5">/[^\u0000-\u007F]+/</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">path</span><span class="s2">),</span>
        <span class="s4">&quot;Route with path </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ </span><span class="s1">path </span><span class="s2">+ </span><span class="s4">&quot;</span><span class="s3">\&quot; </span><span class="s4">contains unencoded characters, make sure &quot; </span><span class="s2">+</span>
          <span class="s4">&quot;your path is correctly encoded before passing it to the router. Use &quot; </span><span class="s2">+</span>
          <span class="s4">&quot;encodeURI to encode static segments of your path.&quot;</span>
      <span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">pathToRegexpOptions </span><span class="s2">=</span>
      <span class="s1">route</span><span class="s2">.</span><span class="s1">pathToRegexpOptions </span><span class="s2">|| {};</span>
    <span class="s3">var </span><span class="s1">normalizedPath </span><span class="s2">= </span><span class="s1">normalizePath</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">pathToRegexpOptions</span><span class="s2">.</span><span class="s1">strict</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">route</span><span class="s2">.</span><span class="s1">caseSensitive </span><span class="s2">=== </span><span class="s4">'boolean'</span><span class="s2">) {</span>
      <span class="s1">pathToRegexpOptions</span><span class="s2">.</span><span class="s1">sensitive </span><span class="s2">= </span><span class="s1">route</span><span class="s2">.</span><span class="s1">caseSensitive</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">record </span><span class="s2">= {</span>
      <span class="s1">path</span><span class="s2">: </span><span class="s1">normalizedPath</span><span class="s2">,</span>
      <span class="s1">regex</span><span class="s2">: </span><span class="s1">compileRouteRegex</span><span class="s2">(</span><span class="s1">normalizedPath</span><span class="s2">, </span><span class="s1">pathToRegexpOptions</span><span class="s2">),</span>
      <span class="s1">components</span><span class="s2">: </span><span class="s1">route</span><span class="s2">.</span><span class="s1">components </span><span class="s2">|| { </span><span class="s3">default</span><span class="s2">: </span><span class="s1">route</span><span class="s2">.</span><span class="s1">component </span><span class="s2">},</span>
      <span class="s1">alias</span><span class="s2">: </span><span class="s1">route</span><span class="s2">.</span><span class="s1">alias</span>
        <span class="s2">? </span><span class="s3">typeof </span><span class="s1">route</span><span class="s2">.</span><span class="s1">alias </span><span class="s2">=== </span><span class="s4">'string'</span>
          <span class="s2">? [</span><span class="s1">route</span><span class="s2">.</span><span class="s1">alias</span><span class="s2">]</span>
          <span class="s2">: </span><span class="s1">route</span><span class="s2">.</span><span class="s1">alias</span>
        <span class="s2">: [],</span>
      <span class="s1">instances</span><span class="s2">: {},</span>
      <span class="s1">enteredCbs</span><span class="s2">: {},</span>
      <span class="s1">name</span><span class="s2">: </span><span class="s1">name</span><span class="s2">,</span>
      <span class="s1">parent</span><span class="s2">: </span><span class="s1">parent</span><span class="s2">,</span>
      <span class="s1">matchAs</span><span class="s2">: </span><span class="s1">matchAs</span><span class="s2">,</span>
      <span class="s1">redirect</span><span class="s2">: </span><span class="s1">route</span><span class="s2">.</span><span class="s1">redirect</span><span class="s2">,</span>
      <span class="s1">beforeEnter</span><span class="s2">: </span><span class="s1">route</span><span class="s2">.</span><span class="s1">beforeEnter</span><span class="s2">,</span>
      <span class="s1">meta</span><span class="s2">: </span><span class="s1">route</span><span class="s2">.</span><span class="s1">meta </span><span class="s2">|| {},</span>
      <span class="s1">props</span><span class="s2">:</span>
        <span class="s1">route</span><span class="s2">.</span><span class="s1">props </span><span class="s2">== </span><span class="s3">null</span>
          <span class="s2">? {}</span>
          <span class="s2">: </span><span class="s1">route</span><span class="s2">.</span><span class="s1">components</span>
            <span class="s2">? </span><span class="s1">route</span><span class="s2">.</span><span class="s1">props</span>
            <span class="s2">: { </span><span class="s3">default</span><span class="s2">: </span><span class="s1">route</span><span class="s2">.</span><span class="s1">props </span><span class="s2">}</span>
    <span class="s2">};</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">route</span><span class="s2">.</span><span class="s1">children</span><span class="s2">) {</span>
      <span class="s0">// Warn if route is named, does not redirect and has a default child route.</span>
      <span class="s0">// If users navigate to this route by name, the default child will</span>
      <span class="s0">// not be rendered (GH Issue #629)</span>
      <span class="s2">{</span>
        <span class="s3">if </span><span class="s2">(</span>
          <span class="s1">route</span><span class="s2">.</span><span class="s1">name </span><span class="s2">&amp;&amp;</span>
          <span class="s2">!</span><span class="s1">route</span><span class="s2">.</span><span class="s1">redirect </span><span class="s2">&amp;&amp;</span>
          <span class="s1">route</span><span class="s2">.</span><span class="s1">children</span><span class="s2">.</span><span class="s1">some</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">child</span><span class="s2">) { </span><span class="s3">return </span><span class="s5">/^\/?$/</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">child</span><span class="s2">.</span><span class="s1">path</span><span class="s2">); })</span>
        <span class="s2">) {</span>
          <span class="s1">warn</span><span class="s2">(</span>
            <span class="s3">false</span><span class="s2">,</span>
            <span class="s4">&quot;Named Route '&quot; </span><span class="s2">+ (</span><span class="s1">route</span><span class="s2">.</span><span class="s1">name</span><span class="s2">) + </span><span class="s4">&quot;' has a default child route. &quot; </span><span class="s2">+</span>
              <span class="s4">&quot;When navigating to this named route (:to=</span><span class="s3">\&quot;</span><span class="s4">{name: '&quot; </span><span class="s2">+ (</span><span class="s1">route</span><span class="s2">.</span><span class="s1">name</span><span class="s2">) + </span><span class="s4">&quot;'}</span><span class="s3">\&quot;</span><span class="s4">), &quot; </span><span class="s2">+</span>
              <span class="s4">&quot;the default child route will not be rendered. Remove the name from &quot; </span><span class="s2">+</span>
              <span class="s4">&quot;this route and use the name of the default child route for named &quot; </span><span class="s2">+</span>
              <span class="s4">&quot;links instead.&quot;</span>
          <span class="s2">);</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
      <span class="s1">route</span><span class="s2">.</span><span class="s1">children</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">child</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">childMatchAs </span><span class="s2">= </span><span class="s1">matchAs</span>
          <span class="s2">? </span><span class="s1">cleanPath</span><span class="s2">((</span><span class="s1">matchAs </span><span class="s2">+ </span><span class="s4">&quot;/&quot; </span><span class="s2">+ (</span><span class="s1">child</span><span class="s2">.</span><span class="s1">path</span><span class="s2">)))</span>
          <span class="s2">: </span><span class="s1">undefined</span><span class="s2">;</span>
        <span class="s1">addRouteRecord</span><span class="s2">(</span><span class="s1">pathList</span><span class="s2">, </span><span class="s1">pathMap</span><span class="s2">, </span><span class="s1">nameMap</span><span class="s2">, </span><span class="s1">child</span><span class="s2">, </span><span class="s1">record</span><span class="s2">, </span><span class="s1">childMatchAs</span><span class="s2">);</span>
      <span class="s2">});</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(!</span><span class="s1">pathMap</span><span class="s2">[</span><span class="s1">record</span><span class="s2">.</span><span class="s1">path</span><span class="s2">]) {</span>
      <span class="s1">pathList</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">record</span><span class="s2">.</span><span class="s1">path</span><span class="s2">);</span>
      <span class="s1">pathMap</span><span class="s2">[</span><span class="s1">record</span><span class="s2">.</span><span class="s1">path</span><span class="s2">] = </span><span class="s1">record</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">route</span><span class="s2">.</span><span class="s1">alias </span><span class="s2">!== </span><span class="s1">undefined</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">aliases </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">route</span><span class="s2">.</span><span class="s1">alias</span><span class="s2">) ? </span><span class="s1">route</span><span class="s2">.</span><span class="s1">alias </span><span class="s2">: [</span><span class="s1">route</span><span class="s2">.</span><span class="s1">alias</span><span class="s2">];</span>
      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">aliases</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; ++</span><span class="s1">i</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">alias </span><span class="s2">= </span><span class="s1">aliases</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">alias </span><span class="s2">=== </span><span class="s1">path</span><span class="s2">) {</span>
          <span class="s1">warn</span><span class="s2">(</span>
            <span class="s3">false</span><span class="s2">,</span>
            <span class="s2">(</span><span class="s4">&quot;Found an alias with the same value as the path: </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ </span><span class="s1">path </span><span class="s2">+ </span><span class="s4">&quot;</span><span class="s3">\&quot;</span><span class="s4">. You have to remove that alias. It will be ignored in development.&quot;</span><span class="s2">)</span>
          <span class="s2">);</span>
          <span class="s0">// skip in dev to make it work</span>
          <span class="s3">continue</span>
        <span class="s2">}</span>

        <span class="s3">var </span><span class="s1">aliasRoute </span><span class="s2">= {</span>
          <span class="s1">path</span><span class="s2">: </span><span class="s1">alias</span><span class="s2">,</span>
          <span class="s1">children</span><span class="s2">: </span><span class="s1">route</span><span class="s2">.</span><span class="s1">children</span>
        <span class="s2">};</span>
        <span class="s1">addRouteRecord</span><span class="s2">(</span>
          <span class="s1">pathList</span><span class="s2">,</span>
          <span class="s1">pathMap</span><span class="s2">,</span>
          <span class="s1">nameMap</span><span class="s2">,</span>
          <span class="s1">aliasRoute</span><span class="s2">,</span>
          <span class="s1">parent</span><span class="s2">,</span>
          <span class="s1">record</span><span class="s2">.</span><span class="s1">path </span><span class="s2">|| </span><span class="s4">'/' </span><span class="s0">// matchAs</span>
        <span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(!</span><span class="s1">nameMap</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]) {</span>
        <span class="s1">nameMap</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">record</span><span class="s2">;</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(!</span><span class="s1">matchAs</span><span class="s2">) {</span>
        <span class="s1">warn</span><span class="s2">(</span>
          <span class="s3">false</span><span class="s2">,</span>
          <span class="s4">&quot;Duplicate named routes definition: &quot; </span><span class="s2">+</span>
            <span class="s4">&quot;{ name: </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ </span><span class="s1">name </span><span class="s2">+ </span><span class="s4">&quot;</span><span class="s3">\&quot;</span><span class="s4">, path: </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ (</span><span class="s1">record</span><span class="s2">.</span><span class="s1">path</span><span class="s2">) + </span><span class="s4">&quot;</span><span class="s3">\&quot; </span><span class="s4">}&quot;</span>
        <span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">compileRouteRegex </span><span class="s2">(</span>
    <span class="s1">path</span><span class="s2">,</span>
    <span class="s1">pathToRegexpOptions</span>
  <span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">regex </span><span class="s2">= </span><span class="s1">pathToRegexp_1</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, [], </span><span class="s1">pathToRegexpOptions</span><span class="s2">);</span>
    <span class="s2">{</span>
      <span class="s3">var </span><span class="s1">keys </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
      <span class="s1">regex</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
        <span class="s1">warn</span><span class="s2">(</span>
          <span class="s2">!</span><span class="s1">keys</span><span class="s2">[</span><span class="s1">key</span><span class="s2">.</span><span class="s1">name</span><span class="s2">],</span>
          <span class="s2">(</span><span class="s4">&quot;Duplicate param keys in route with path: </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ </span><span class="s1">path </span><span class="s2">+ </span><span class="s4">&quot;</span><span class="s3">\&quot;</span><span class="s4">&quot;</span><span class="s2">)</span>
        <span class="s2">);</span>
        <span class="s1">keys</span><span class="s2">[</span><span class="s1">key</span><span class="s2">.</span><span class="s1">name</span><span class="s2">] = </span><span class="s3">true</span><span class="s2">;</span>
      <span class="s2">});</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">regex</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">normalizePath </span><span class="s2">(</span>
    <span class="s1">path</span><span class="s2">,</span>
    <span class="s1">parent</span><span class="s2">,</span>
    <span class="s1">strict</span>
  <span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">strict</span><span class="s2">) { </span><span class="s1">path </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/\/$/</span><span class="s2">, </span><span class="s4">''</span><span class="s2">); }</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">path</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] === </span><span class="s4">'/'</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">path </span><span class="s2">}</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">parent </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">path </span><span class="s2">}</span>
    <span class="s3">return </span><span class="s1">cleanPath</span><span class="s2">(((</span><span class="s1">parent</span><span class="s2">.</span><span class="s1">path</span><span class="s2">) + </span><span class="s4">&quot;/&quot; </span><span class="s2">+ </span><span class="s1">path</span><span class="s2">))</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>



  <span class="s3">function </span><span class="s1">createMatcher </span><span class="s2">(</span>
    <span class="s1">routes</span><span class="s2">,</span>
    <span class="s1">router</span>
  <span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">ref </span><span class="s2">= </span><span class="s1">createRouteMap</span><span class="s2">(</span><span class="s1">routes</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">pathList </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">pathList</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">pathMap </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">pathMap</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">nameMap </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">nameMap</span><span class="s2">;</span>

    <span class="s3">function </span><span class="s1">addRoutes </span><span class="s2">(</span><span class="s1">routes</span><span class="s2">) {</span>
      <span class="s1">createRouteMap</span><span class="s2">(</span><span class="s1">routes</span><span class="s2">, </span><span class="s1">pathList</span><span class="s2">, </span><span class="s1">pathMap</span><span class="s2">, </span><span class="s1">nameMap</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">addRoute </span><span class="s2">(</span><span class="s1">parentOrRoute</span><span class="s2">, </span><span class="s1">route</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">parent </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">parentOrRoute </span><span class="s2">!== </span><span class="s4">'object'</span><span class="s2">) ? </span><span class="s1">nameMap</span><span class="s2">[</span><span class="s1">parentOrRoute</span><span class="s2">] : </span><span class="s1">undefined</span><span class="s2">;</span>
      <span class="s0">// $flow-disable-line</span>
      <span class="s1">createRouteMap</span><span class="s2">([</span><span class="s1">route </span><span class="s2">|| </span><span class="s1">parentOrRoute</span><span class="s2">], </span><span class="s1">pathList</span><span class="s2">, </span><span class="s1">pathMap</span><span class="s2">, </span><span class="s1">nameMap</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">);</span>

      <span class="s0">// add aliases of parent</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">parent </span><span class="s2">&amp;&amp; </span><span class="s1">parent</span><span class="s2">.</span><span class="s1">alias</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
        <span class="s1">createRouteMap</span><span class="s2">(</span>
          <span class="s0">// $flow-disable-line route is defined if parent is</span>
          <span class="s1">parent</span><span class="s2">.</span><span class="s1">alias</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">alias</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">({ </span><span class="s1">path</span><span class="s2">: </span><span class="s1">alias</span><span class="s2">, </span><span class="s1">children</span><span class="s2">: [</span><span class="s1">route</span><span class="s2">] }); }),</span>
          <span class="s1">pathList</span><span class="s2">,</span>
          <span class="s1">pathMap</span><span class="s2">,</span>
          <span class="s1">nameMap</span><span class="s2">,</span>
          <span class="s1">parent</span>
        <span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">getRoutes </span><span class="s2">() {</span>
      <span class="s3">return </span><span class="s1">pathList</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">pathMap</span><span class="s2">[</span><span class="s1">path</span><span class="s2">]; })</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">match </span><span class="s2">(</span>
      <span class="s1">raw</span><span class="s2">,</span>
      <span class="s1">currentRoute</span><span class="s2">,</span>
      <span class="s1">redirectedFrom</span>
    <span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">location </span><span class="s2">= </span><span class="s1">normalizeLocation</span><span class="s2">(</span><span class="s1">raw</span><span class="s2">, </span><span class="s1">currentRoute</span><span class="s2">, </span><span class="s3">false</span><span class="s2">, </span><span class="s1">router</span><span class="s2">);</span>
      <span class="s3">var </span><span class="s1">name </span><span class="s2">= </span><span class="s1">location</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">record </span><span class="s2">= </span><span class="s1">nameMap</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
        <span class="s2">{</span>
          <span class="s1">warn</span><span class="s2">(</span><span class="s1">record</span><span class="s2">, (</span><span class="s4">&quot;Route with name '&quot; </span><span class="s2">+ </span><span class="s1">name </span><span class="s2">+ </span><span class="s4">&quot;' does not exist&quot;</span><span class="s2">));</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">record</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">_createRoute</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">location</span><span class="s2">) }</span>
        <span class="s3">var </span><span class="s1">paramNames </span><span class="s2">= </span><span class="s1">record</span><span class="s2">.</span><span class="s1">regex</span><span class="s2">.</span><span class="s1">keys</span>
          <span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">!</span><span class="s1">key</span><span class="s2">.</span><span class="s1">optional</span><span class="s2">; })</span>
          <span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">key</span><span class="s2">.</span><span class="s1">name</span><span class="s2">; });</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">location</span><span class="s2">.</span><span class="s1">params </span><span class="s2">!== </span><span class="s4">'object'</span><span class="s2">) {</span>
          <span class="s1">location</span><span class="s2">.</span><span class="s1">params </span><span class="s2">= {};</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">currentRoute </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">currentRoute</span><span class="s2">.</span><span class="s1">params </span><span class="s2">=== </span><span class="s4">'object'</span><span class="s2">) {</span>
          <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">key </span><span class="s3">in </span><span class="s1">currentRoute</span><span class="s2">.</span><span class="s1">params</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(!(</span><span class="s1">key </span><span class="s3">in </span><span class="s1">location</span><span class="s2">.</span><span class="s1">params</span><span class="s2">) &amp;&amp; </span><span class="s1">paramNames</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">key</span><span class="s2">) &gt; -</span><span class="s6">1</span><span class="s2">) {</span>
              <span class="s1">location</span><span class="s2">.</span><span class="s1">params</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">currentRoute</span><span class="s2">.</span><span class="s1">params</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
            <span class="s2">}</span>
          <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">location</span><span class="s2">.</span><span class="s1">path </span><span class="s2">= </span><span class="s1">fillParams</span><span class="s2">(</span><span class="s1">record</span><span class="s2">.</span><span class="s1">path</span><span class="s2">, </span><span class="s1">location</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, (</span><span class="s4">&quot;named route </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ </span><span class="s1">name </span><span class="s2">+ </span><span class="s4">&quot;</span><span class="s3">\&quot;</span><span class="s4">&quot;</span><span class="s2">));</span>
        <span class="s3">return </span><span class="s1">_createRoute</span><span class="s2">(</span><span class="s1">record</span><span class="s2">, </span><span class="s1">location</span><span class="s2">, </span><span class="s1">redirectedFrom</span><span class="s2">)</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">location</span><span class="s2">.</span><span class="s1">path</span><span class="s2">) {</span>
        <span class="s1">location</span><span class="s2">.</span><span class="s1">params </span><span class="s2">= {};</span>
        <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">pathList</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
          <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s1">pathList</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
          <span class="s3">var </span><span class="s1">record$1 </span><span class="s2">= </span><span class="s1">pathMap</span><span class="s2">[</span><span class="s1">path</span><span class="s2">];</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">matchRoute</span><span class="s2">(</span><span class="s1">record$1</span><span class="s2">.</span><span class="s1">regex</span><span class="s2">, </span><span class="s1">location</span><span class="s2">.</span><span class="s1">path</span><span class="s2">, </span><span class="s1">location</span><span class="s2">.</span><span class="s1">params</span><span class="s2">)) {</span>
            <span class="s3">return </span><span class="s1">_createRoute</span><span class="s2">(</span><span class="s1">record$1</span><span class="s2">, </span><span class="s1">location</span><span class="s2">, </span><span class="s1">redirectedFrom</span><span class="s2">)</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
      <span class="s0">// no match</span>
      <span class="s3">return </span><span class="s1">_createRoute</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">location</span><span class="s2">)</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">redirect </span><span class="s2">(</span>
      <span class="s1">record</span><span class="s2">,</span>
      <span class="s1">location</span>
    <span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">originalRedirect </span><span class="s2">= </span><span class="s1">record</span><span class="s2">.</span><span class="s1">redirect</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">redirect </span><span class="s2">= </span><span class="s3">typeof </span><span class="s1">originalRedirect </span><span class="s2">=== </span><span class="s4">'function'</span>
        <span class="s2">? </span><span class="s1">originalRedirect</span><span class="s2">(</span><span class="s1">createRoute</span><span class="s2">(</span><span class="s1">record</span><span class="s2">, </span><span class="s1">location</span><span class="s2">, </span><span class="s3">null</span><span class="s2">, </span><span class="s1">router</span><span class="s2">))</span>
        <span class="s2">: </span><span class="s1">originalRedirect</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">redirect </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">) {</span>
        <span class="s1">redirect </span><span class="s2">= { </span><span class="s1">path</span><span class="s2">: </span><span class="s1">redirect </span><span class="s2">};</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(!</span><span class="s1">redirect </span><span class="s2">|| </span><span class="s3">typeof </span><span class="s1">redirect </span><span class="s2">!== </span><span class="s4">'object'</span><span class="s2">) {</span>
        <span class="s2">{</span>
          <span class="s1">warn</span><span class="s2">(</span>
            <span class="s3">false</span><span class="s2">, (</span><span class="s4">&quot;invalid redirect option: &quot; </span><span class="s2">+ (</span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">redirect</span><span class="s2">)))</span>
          <span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">_createRoute</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">location</span><span class="s2">)</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">re </span><span class="s2">= </span><span class="s1">redirect</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">name </span><span class="s2">= </span><span class="s1">re</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s1">re</span><span class="s2">.</span><span class="s1">path</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">query </span><span class="s2">= </span><span class="s1">location</span><span class="s2">.</span><span class="s1">query</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">hash </span><span class="s2">= </span><span class="s1">location</span><span class="s2">.</span><span class="s1">hash</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">params </span><span class="s2">= </span><span class="s1">location</span><span class="s2">.</span><span class="s1">params</span><span class="s2">;</span>
      <span class="s1">query </span><span class="s2">= </span><span class="s1">re</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">(</span><span class="s4">'query'</span><span class="s2">) ? </span><span class="s1">re</span><span class="s2">.</span><span class="s1">query </span><span class="s2">: </span><span class="s1">query</span><span class="s2">;</span>
      <span class="s1">hash </span><span class="s2">= </span><span class="s1">re</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">(</span><span class="s4">'hash'</span><span class="s2">) ? </span><span class="s1">re</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">: </span><span class="s1">hash</span><span class="s2">;</span>
      <span class="s1">params </span><span class="s2">= </span><span class="s1">re</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">(</span><span class="s4">'params'</span><span class="s2">) ? </span><span class="s1">re</span><span class="s2">.</span><span class="s1">params </span><span class="s2">: </span><span class="s1">params</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
        <span class="s0">// resolved named direct</span>
        <span class="s3">var </span><span class="s1">targetRecord </span><span class="s2">= </span><span class="s1">nameMap</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
        <span class="s2">{</span>
          <span class="s1">assert</span><span class="s2">(</span><span class="s1">targetRecord</span><span class="s2">, (</span><span class="s4">&quot;redirect failed: named route </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ </span><span class="s1">name </span><span class="s2">+ </span><span class="s4">&quot;</span><span class="s3">\&quot; </span><span class="s4">not found.&quot;</span><span class="s2">));</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">match</span><span class="s2">({</span>
          <span class="s1">_normalized</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
          <span class="s1">name</span><span class="s2">: </span><span class="s1">name</span><span class="s2">,</span>
          <span class="s1">query</span><span class="s2">: </span><span class="s1">query</span><span class="s2">,</span>
          <span class="s1">hash</span><span class="s2">: </span><span class="s1">hash</span><span class="s2">,</span>
          <span class="s1">params</span><span class="s2">: </span><span class="s1">params</span>
        <span class="s2">}, </span><span class="s1">undefined</span><span class="s2">, </span><span class="s1">location</span><span class="s2">)</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
        <span class="s0">// 1. resolve relative redirect</span>
        <span class="s3">var </span><span class="s1">rawPath </span><span class="s2">= </span><span class="s1">resolveRecordPath</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">record</span><span class="s2">);</span>
        <span class="s0">// 2. resolve params</span>
        <span class="s3">var </span><span class="s1">resolvedPath </span><span class="s2">= </span><span class="s1">fillParams</span><span class="s2">(</span><span class="s1">rawPath</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, (</span><span class="s4">&quot;redirect route with path </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ </span><span class="s1">rawPath </span><span class="s2">+ </span><span class="s4">&quot;</span><span class="s3">\&quot;</span><span class="s4">&quot;</span><span class="s2">));</span>
        <span class="s0">// 3. rematch with existing query and hash</span>
        <span class="s3">return </span><span class="s1">match</span><span class="s2">({</span>
          <span class="s1">_normalized</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
          <span class="s1">path</span><span class="s2">: </span><span class="s1">resolvedPath</span><span class="s2">,</span>
          <span class="s1">query</span><span class="s2">: </span><span class="s1">query</span><span class="s2">,</span>
          <span class="s1">hash</span><span class="s2">: </span><span class="s1">hash</span>
        <span class="s2">}, </span><span class="s1">undefined</span><span class="s2">, </span><span class="s1">location</span><span class="s2">)</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s2">{</span>
          <span class="s1">warn</span><span class="s2">(</span><span class="s3">false</span><span class="s2">, (</span><span class="s4">&quot;invalid redirect option: &quot; </span><span class="s2">+ (</span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">redirect</span><span class="s2">))));</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">_createRoute</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">location</span><span class="s2">)</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">alias </span><span class="s2">(</span>
      <span class="s1">record</span><span class="s2">,</span>
      <span class="s1">location</span><span class="s2">,</span>
      <span class="s1">matchAs</span>
    <span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">aliasedPath </span><span class="s2">= </span><span class="s1">fillParams</span><span class="s2">(</span><span class="s1">matchAs</span><span class="s2">, </span><span class="s1">location</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, (</span><span class="s4">&quot;aliased route with path </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ </span><span class="s1">matchAs </span><span class="s2">+ </span><span class="s4">&quot;</span><span class="s3">\&quot;</span><span class="s4">&quot;</span><span class="s2">));</span>
      <span class="s3">var </span><span class="s1">aliasedMatch </span><span class="s2">= </span><span class="s1">match</span><span class="s2">({</span>
        <span class="s1">_normalized</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
        <span class="s1">path</span><span class="s2">: </span><span class="s1">aliasedPath</span>
      <span class="s2">});</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">aliasedMatch</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">matched </span><span class="s2">= </span><span class="s1">aliasedMatch</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">;</span>
        <span class="s3">var </span><span class="s1">aliasedRecord </span><span class="s2">= </span><span class="s1">matched</span><span class="s2">[</span><span class="s1">matched</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s6">1</span><span class="s2">];</span>
        <span class="s1">location</span><span class="s2">.</span><span class="s1">params </span><span class="s2">= </span><span class="s1">aliasedMatch</span><span class="s2">.</span><span class="s1">params</span><span class="s2">;</span>
        <span class="s3">return </span><span class="s1">_createRoute</span><span class="s2">(</span><span class="s1">aliasedRecord</span><span class="s2">, </span><span class="s1">location</span><span class="s2">)</span>
      <span class="s2">}</span>
      <span class="s3">return </span><span class="s1">_createRoute</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">location</span><span class="s2">)</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">_createRoute </span><span class="s2">(</span>
      <span class="s1">record</span><span class="s2">,</span>
      <span class="s1">location</span><span class="s2">,</span>
      <span class="s1">redirectedFrom</span>
    <span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">record </span><span class="s2">&amp;&amp; </span><span class="s1">record</span><span class="s2">.</span><span class="s1">redirect</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">redirect</span><span class="s2">(</span><span class="s1">record</span><span class="s2">, </span><span class="s1">redirectedFrom </span><span class="s2">|| </span><span class="s1">location</span><span class="s2">)</span>
      <span class="s2">}</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">record </span><span class="s2">&amp;&amp; </span><span class="s1">record</span><span class="s2">.</span><span class="s1">matchAs</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">alias</span><span class="s2">(</span><span class="s1">record</span><span class="s2">, </span><span class="s1">location</span><span class="s2">, </span><span class="s1">record</span><span class="s2">.</span><span class="s1">matchAs</span><span class="s2">)</span>
      <span class="s2">}</span>
      <span class="s3">return </span><span class="s1">createRoute</span><span class="s2">(</span><span class="s1">record</span><span class="s2">, </span><span class="s1">location</span><span class="s2">, </span><span class="s1">redirectedFrom</span><span class="s2">, </span><span class="s1">router</span><span class="s2">)</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s2">{</span>
      <span class="s1">match</span><span class="s2">: </span><span class="s1">match</span><span class="s2">,</span>
      <span class="s1">addRoute</span><span class="s2">: </span><span class="s1">addRoute</span><span class="s2">,</span>
      <span class="s1">getRoutes</span><span class="s2">: </span><span class="s1">getRoutes</span><span class="s2">,</span>
      <span class="s1">addRoutes</span><span class="s2">: </span><span class="s1">addRoutes</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">matchRoute </span><span class="s2">(</span>
    <span class="s1">regex</span><span class="s2">,</span>
    <span class="s1">path</span><span class="s2">,</span>
    <span class="s1">params</span>
  <span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">m </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s1">regex</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(!</span><span class="s1">m</span><span class="s2">) {</span>
      <span class="s3">return false</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(!</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s3">return true</span>
    <span class="s2">}</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s6">1</span><span class="s2">, </span><span class="s1">len </span><span class="s2">= </span><span class="s1">m</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; ++</span><span class="s1">i</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">regex</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">[</span><span class="s1">i </span><span class="s2">- </span><span class="s6">1</span><span class="s2">];</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
        <span class="s0">// Fix #1994: using * with props: true generates a param named 0</span>
        <span class="s1">params</span><span class="s2">[</span><span class="s1">key</span><span class="s2">.</span><span class="s1">name </span><span class="s2">|| </span><span class="s4">'pathMatch'</span><span class="s2">] = </span><span class="s3">typeof </span><span class="s1">m</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] === </span><span class="s4">'string' </span><span class="s2">? </span><span class="s1">decode</span><span class="s2">(</span><span class="s1">m</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]) : </span><span class="s1">m</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">return true</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">resolveRecordPath </span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">record</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">resolvePath</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">record</span><span class="s2">.</span><span class="s1">parent </span><span class="s2">? </span><span class="s1">record</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">.</span><span class="s1">path </span><span class="s2">: </span><span class="s4">'/'</span><span class="s2">, </span><span class="s3">true</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s0">// use User Timing api (if present) for more accurate key precision</span>
  <span class="s3">var </span><span class="s1">Time </span><span class="s2">=</span>
    <span class="s1">inBrowser </span><span class="s2">&amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">performance </span><span class="s2">&amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">performance</span><span class="s2">.</span><span class="s1">now</span>
      <span class="s2">? </span><span class="s1">window</span><span class="s2">.</span><span class="s1">performance</span>
      <span class="s2">: </span><span class="s1">Date</span><span class="s2">;</span>

  <span class="s3">function </span><span class="s1">genStateKey </span><span class="s2">() {</span>
    <span class="s3">return </span><span class="s1">Time</span><span class="s2">.</span><span class="s1">now</span><span class="s2">().</span><span class="s1">toFixed</span><span class="s2">(</span><span class="s6">3</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">var </span><span class="s1">_key </span><span class="s2">= </span><span class="s1">genStateKey</span><span class="s2">();</span>

  <span class="s3">function </span><span class="s1">getStateKey </span><span class="s2">() {</span>
    <span class="s3">return </span><span class="s1">_key</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">setStateKey </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s2">(</span><span class="s1">_key </span><span class="s2">= </span><span class="s1">key</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s3">var </span><span class="s1">positionStore </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>

  <span class="s3">function </span><span class="s1">setupScroll </span><span class="s2">() {</span>
    <span class="s0">// Prevent browser scroll behavior on History popstate</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s4">'scrollRestoration' </span><span class="s3">in </span><span class="s1">window</span><span class="s2">.</span><span class="s1">history</span><span class="s2">) {</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">scrollRestoration </span><span class="s2">= </span><span class="s4">'manual'</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s0">// Fix for #1585 for Firefox</span>
    <span class="s0">// Fix for #2195 Add optional third attribute to workaround a bug in safari https://bugs.webkit.org/show_bug.cgi?id=182678</span>
    <span class="s0">// Fix for #2774 Support for apps loaded from Windows file shares not mapped to network drives: replaced location.origin with</span>
    <span class="s0">// window.location.protocol + '//' + window.location.host</span>
    <span class="s0">// location.host contains the port and location.hostname doesn't</span>
    <span class="s3">var </span><span class="s1">protocolAndPath </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">protocol </span><span class="s2">+ </span><span class="s4">'//' </span><span class="s2">+ </span><span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">host</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">absolutePath </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">href</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">protocolAndPath</span><span class="s2">, </span><span class="s4">''</span><span class="s2">);</span>
    <span class="s0">// preserve existing history state as it could be overriden by the user</span>
    <span class="s3">var </span><span class="s1">stateCopy </span><span class="s2">= </span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">window</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">state</span><span class="s2">);</span>
    <span class="s1">stateCopy</span><span class="s2">.</span><span class="s1">key </span><span class="s2">= </span><span class="s1">getStateKey</span><span class="s2">();</span>
    <span class="s1">window</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">replaceState</span><span class="s2">(</span><span class="s1">stateCopy</span><span class="s2">, </span><span class="s4">''</span><span class="s2">, </span><span class="s1">absolutePath</span><span class="s2">);</span>
    <span class="s1">window</span><span class="s2">.</span><span class="s1">addEventListener</span><span class="s2">(</span><span class="s4">'popstate'</span><span class="s2">, </span><span class="s1">handlePopState</span><span class="s2">);</span>
    <span class="s3">return function </span><span class="s2">() {</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">removeEventListener</span><span class="s2">(</span><span class="s4">'popstate'</span><span class="s2">, </span><span class="s1">handlePopState</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">handleScroll </span><span class="s2">(</span>
    <span class="s1">router</span><span class="s2">,</span>
    <span class="s1">to</span><span class="s2">,</span>
    <span class="s1">from</span><span class="s2">,</span>
    <span class="s1">isPop</span>
  <span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">router</span><span class="s2">.</span><span class="s1">app</span><span class="s2">) {</span>
      <span class="s3">return</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">behavior </span><span class="s2">= </span><span class="s1">router</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">scrollBehavior</span><span class="s2">;</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">behavior</span><span class="s2">) {</span>
      <span class="s3">return</span>
    <span class="s2">}</span>

    <span class="s2">{</span>
      <span class="s1">assert</span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">behavior </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">, </span><span class="s4">&quot;scrollBehavior must be a function&quot;</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// wait until re-render finishes before scrolling</span>
    <span class="s1">router</span><span class="s2">.</span><span class="s1">app</span><span class="s2">.</span><span class="s1">$nextTick</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">position </span><span class="s2">= </span><span class="s1">getScrollPosition</span><span class="s2">();</span>
      <span class="s3">var </span><span class="s1">shouldScroll </span><span class="s2">= </span><span class="s1">behavior</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span>
        <span class="s1">router</span><span class="s2">,</span>
        <span class="s1">to</span><span class="s2">,</span>
        <span class="s1">from</span><span class="s2">,</span>
        <span class="s1">isPop </span><span class="s2">? </span><span class="s1">position </span><span class="s2">: </span><span class="s3">null</span>
      <span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(!</span><span class="s1">shouldScroll</span><span class="s2">) {</span>
        <span class="s3">return</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">shouldScroll</span><span class="s2">.</span><span class="s1">then </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
        <span class="s1">shouldScroll</span>
          <span class="s2">.</span><span class="s1">then</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">shouldScroll</span><span class="s2">) {</span>
            <span class="s1">scrollToPosition</span><span class="s2">((</span><span class="s1">shouldScroll</span><span class="s2">), </span><span class="s1">position</span><span class="s2">);</span>
          <span class="s2">})</span>
          <span class="s2">.</span><span class="s1">catch</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">err</span><span class="s2">) {</span>
            <span class="s2">{</span>
              <span class="s1">assert</span><span class="s2">(</span><span class="s3">false</span><span class="s2">, </span><span class="s1">err</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">());</span>
            <span class="s2">}</span>
          <span class="s2">});</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">scrollToPosition</span><span class="s2">(</span><span class="s1">shouldScroll</span><span class="s2">, </span><span class="s1">position</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">});</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">saveScrollPosition </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">getStateKey</span><span class="s2">();</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
      <span class="s1">positionStore</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = {</span>
        <span class="s1">x</span><span class="s2">: </span><span class="s1">window</span><span class="s2">.</span><span class="s1">pageXOffset</span><span class="s2">,</span>
        <span class="s1">y</span><span class="s2">: </span><span class="s1">window</span><span class="s2">.</span><span class="s1">pageYOffset</span>
      <span class="s2">};</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">handlePopState </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
    <span class="s1">saveScrollPosition</span><span class="s2">();</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">state </span><span class="s2">&amp;&amp; </span><span class="s1">e</span><span class="s2">.</span><span class="s1">state</span><span class="s2">.</span><span class="s1">key</span><span class="s2">) {</span>
      <span class="s1">setStateKey</span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">state</span><span class="s2">.</span><span class="s1">key</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">getScrollPosition </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">getStateKey</span><span class="s2">();</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">positionStore</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">getElementPosition </span><span class="s2">(</span><span class="s1">el</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">docEl </span><span class="s2">= </span><span class="s1">document</span><span class="s2">.</span><span class="s1">documentElement</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">docRect </span><span class="s2">= </span><span class="s1">docEl</span><span class="s2">.</span><span class="s1">getBoundingClientRect</span><span class="s2">();</span>
    <span class="s3">var </span><span class="s1">elRect </span><span class="s2">= </span><span class="s1">el</span><span class="s2">.</span><span class="s1">getBoundingClientRect</span><span class="s2">();</span>
    <span class="s3">return </span><span class="s2">{</span>
      <span class="s1">x</span><span class="s2">: </span><span class="s1">elRect</span><span class="s2">.</span><span class="s1">left </span><span class="s2">- </span><span class="s1">docRect</span><span class="s2">.</span><span class="s1">left </span><span class="s2">- </span><span class="s1">offset</span><span class="s2">.</span><span class="s1">x</span><span class="s2">,</span>
      <span class="s1">y</span><span class="s2">: </span><span class="s1">elRect</span><span class="s2">.</span><span class="s1">top </span><span class="s2">- </span><span class="s1">docRect</span><span class="s2">.</span><span class="s1">top </span><span class="s2">- </span><span class="s1">offset</span><span class="s2">.</span><span class="s1">y</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">isValidPosition </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">isNumber</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">x</span><span class="s2">) || </span><span class="s1">isNumber</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">y</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">normalizePosition </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s2">{</span>
      <span class="s1">x</span><span class="s2">: </span><span class="s1">isNumber</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">x</span><span class="s2">) ? </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">x </span><span class="s2">: </span><span class="s1">window</span><span class="s2">.</span><span class="s1">pageXOffset</span><span class="s2">,</span>
      <span class="s1">y</span><span class="s2">: </span><span class="s1">isNumber</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">y</span><span class="s2">) ? </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">y </span><span class="s2">: </span><span class="s1">window</span><span class="s2">.</span><span class="s1">pageYOffset</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">normalizeOffset </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s2">{</span>
      <span class="s1">x</span><span class="s2">: </span><span class="s1">isNumber</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">x</span><span class="s2">) ? </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">x </span><span class="s2">: </span><span class="s6">0</span><span class="s2">,</span>
      <span class="s1">y</span><span class="s2">: </span><span class="s1">isNumber</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">y</span><span class="s2">) ? </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">y </span><span class="s2">: </span><span class="s6">0</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">isNumber </span><span class="s2">(</span><span class="s1">v</span><span class="s2">) {</span>
    <span class="s3">return typeof </span><span class="s1">v </span><span class="s2">=== </span><span class="s4">'number'</span>
  <span class="s2">}</span>

  <span class="s3">var </span><span class="s1">hashStartsWithNumberRE </span><span class="s2">= </span><span class="s5">/^#\d/</span><span class="s2">;</span>

  <span class="s3">function </span><span class="s1">scrollToPosition </span><span class="s2">(</span><span class="s1">shouldScroll</span><span class="s2">, </span><span class="s1">position</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">isObject </span><span class="s2">= </span><span class="s3">typeof </span><span class="s1">shouldScroll </span><span class="s2">=== </span><span class="s4">'object'</span><span class="s2">;</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">isObject </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">shouldScroll</span><span class="s2">.</span><span class="s1">selector </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">) {</span>
      <span class="s0">// getElementById would still fail if the selector contains a more complicated query like #main[data-attr]</span>
      <span class="s0">// but at the same time, it doesn't make much sense to select an element with an id and an extra selector</span>
      <span class="s3">var </span><span class="s1">el </span><span class="s2">= </span><span class="s1">hashStartsWithNumberRE</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">shouldScroll</span><span class="s2">.</span><span class="s1">selector</span><span class="s2">) </span><span class="s0">// $flow-disable-line</span>
        <span class="s2">? </span><span class="s1">document</span><span class="s2">.</span><span class="s1">getElementById</span><span class="s2">(</span><span class="s1">shouldScroll</span><span class="s2">.</span><span class="s1">selector</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s6">1</span><span class="s2">)) </span><span class="s0">// $flow-disable-line</span>
        <span class="s2">: </span><span class="s1">document</span><span class="s2">.</span><span class="s1">querySelector</span><span class="s2">(</span><span class="s1">shouldScroll</span><span class="s2">.</span><span class="s1">selector</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">el</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">offset </span><span class="s2">=</span>
          <span class="s1">shouldScroll</span><span class="s2">.</span><span class="s1">offset </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">shouldScroll</span><span class="s2">.</span><span class="s1">offset </span><span class="s2">=== </span><span class="s4">'object'</span>
            <span class="s2">? </span><span class="s1">shouldScroll</span><span class="s2">.</span><span class="s1">offset</span>
            <span class="s2">: {};</span>
        <span class="s1">offset </span><span class="s2">= </span><span class="s1">normalizeOffset</span><span class="s2">(</span><span class="s1">offset</span><span class="s2">);</span>
        <span class="s1">position </span><span class="s2">= </span><span class="s1">getElementPosition</span><span class="s2">(</span><span class="s1">el</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isValidPosition</span><span class="s2">(</span><span class="s1">shouldScroll</span><span class="s2">)) {</span>
        <span class="s1">position </span><span class="s2">= </span><span class="s1">normalizePosition</span><span class="s2">(</span><span class="s1">shouldScroll</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isObject </span><span class="s2">&amp;&amp; </span><span class="s1">isValidPosition</span><span class="s2">(</span><span class="s1">shouldScroll</span><span class="s2">)) {</span>
      <span class="s1">position </span><span class="s2">= </span><span class="s1">normalizePosition</span><span class="s2">(</span><span class="s1">shouldScroll</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">position</span><span class="s2">) {</span>
      <span class="s0">// $flow-disable-line</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s4">'scrollBehavior' </span><span class="s3">in </span><span class="s1">document</span><span class="s2">.</span><span class="s1">documentElement</span><span class="s2">.</span><span class="s1">style</span><span class="s2">) {</span>
        <span class="s1">window</span><span class="s2">.</span><span class="s1">scrollTo</span><span class="s2">({</span>
          <span class="s1">left</span><span class="s2">: </span><span class="s1">position</span><span class="s2">.</span><span class="s1">x</span><span class="s2">,</span>
          <span class="s1">top</span><span class="s2">: </span><span class="s1">position</span><span class="s2">.</span><span class="s1">y</span><span class="s2">,</span>
          <span class="s0">// $flow-disable-line</span>
          <span class="s1">behavior</span><span class="s2">: </span><span class="s1">shouldScroll</span><span class="s2">.</span><span class="s1">behavior</span>
        <span class="s2">});</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">window</span><span class="s2">.</span><span class="s1">scrollTo</span><span class="s2">(</span><span class="s1">position</span><span class="s2">.</span><span class="s1">x</span><span class="s2">, </span><span class="s1">position</span><span class="s2">.</span><span class="s1">y</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s3">var </span><span class="s1">supportsPushState </span><span class="s2">=</span>
    <span class="s1">inBrowser </span><span class="s2">&amp;&amp;</span>
    <span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">ua </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">navigator</span><span class="s2">.</span><span class="s1">userAgent</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span>
        <span class="s2">(</span><span class="s1">ua</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'Android 2.'</span><span class="s2">) !== -</span><span class="s6">1 </span><span class="s2">|| </span><span class="s1">ua</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'Android 4.0'</span><span class="s2">) !== -</span><span class="s6">1</span><span class="s2">) &amp;&amp;</span>
        <span class="s1">ua</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'Mobile Safari'</span><span class="s2">) !== -</span><span class="s6">1 </span><span class="s2">&amp;&amp;</span>
        <span class="s1">ua</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'Chrome'</span><span class="s2">) === -</span><span class="s6">1 </span><span class="s2">&amp;&amp;</span>
        <span class="s1">ua</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'Windows Phone'</span><span class="s2">) === -</span><span class="s6">1</span>
      <span class="s2">) {</span>
        <span class="s3">return false</span>
      <span class="s2">}</span>

      <span class="s3">return </span><span class="s1">window</span><span class="s2">.</span><span class="s1">history </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">window</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">pushState </span><span class="s2">=== </span><span class="s4">'function'</span>
    <span class="s2">})();</span>

  <span class="s3">function </span><span class="s1">pushState </span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">replace</span><span class="s2">) {</span>
    <span class="s1">saveScrollPosition</span><span class="s2">();</span>
    <span class="s0">// try...catch the pushState call to get around Safari</span>
    <span class="s0">// DOM Exception 18 where it limits to 100 pushState calls</span>
    <span class="s3">var </span><span class="s1">history </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">history</span><span class="s2">;</span>
    <span class="s3">try </span><span class="s2">{</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">replace</span><span class="s2">) {</span>
        <span class="s0">// preserve existing history state as it could be overriden by the user</span>
        <span class="s3">var </span><span class="s1">stateCopy </span><span class="s2">= </span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">history</span><span class="s2">.</span><span class="s1">state</span><span class="s2">);</span>
        <span class="s1">stateCopy</span><span class="s2">.</span><span class="s1">key </span><span class="s2">= </span><span class="s1">getStateKey</span><span class="s2">();</span>
        <span class="s1">history</span><span class="s2">.</span><span class="s1">replaceState</span><span class="s2">(</span><span class="s1">stateCopy</span><span class="s2">, </span><span class="s4">''</span><span class="s2">, </span><span class="s1">url</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">history</span><span class="s2">.</span><span class="s1">pushState</span><span class="s2">({ </span><span class="s1">key</span><span class="s2">: </span><span class="s1">setStateKey</span><span class="s2">(</span><span class="s1">genStateKey</span><span class="s2">()) }, </span><span class="s4">''</span><span class="s2">, </span><span class="s1">url</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">[</span><span class="s1">replace </span><span class="s2">? </span><span class="s4">'replace' </span><span class="s2">: </span><span class="s4">'assign'</span><span class="s2">](</span><span class="s1">url</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">replaceState </span><span class="s2">(</span><span class="s1">url</span><span class="s2">) {</span>
    <span class="s1">pushState</span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s3">true</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s0">// When changing thing, also edit router.d.ts</span>
  <span class="s3">var </span><span class="s1">NavigationFailureType </span><span class="s2">= {</span>
    <span class="s1">redirected</span><span class="s2">: </span><span class="s6">2</span><span class="s2">,</span>
    <span class="s1">aborted</span><span class="s2">: </span><span class="s6">4</span><span class="s2">,</span>
    <span class="s1">cancelled</span><span class="s2">: </span><span class="s6">8</span><span class="s2">,</span>
    <span class="s1">duplicated</span><span class="s2">: </span><span class="s6">16</span>
  <span class="s2">};</span>

  <span class="s3">function </span><span class="s1">createNavigationRedirectedError </span><span class="s2">(</span><span class="s1">from</span><span class="s2">, </span><span class="s1">to</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">createRouterError</span><span class="s2">(</span>
      <span class="s1">from</span><span class="s2">,</span>
      <span class="s1">to</span><span class="s2">,</span>
      <span class="s1">NavigationFailureType</span><span class="s2">.</span><span class="s1">redirected</span><span class="s2">,</span>
      <span class="s2">(</span><span class="s4">&quot;Redirected when going from </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ (</span><span class="s1">from</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">) + </span><span class="s4">&quot;</span><span class="s3">\&quot; </span><span class="s4">to </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ (</span><span class="s1">stringifyRoute</span><span class="s2">(</span>
        <span class="s1">to</span>
      <span class="s2">)) + </span><span class="s4">&quot;</span><span class="s3">\&quot; </span><span class="s4">via a navigation guard.&quot;</span><span class="s2">)</span>
    <span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">createNavigationDuplicatedError </span><span class="s2">(</span><span class="s1">from</span><span class="s2">, </span><span class="s1">to</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">error </span><span class="s2">= </span><span class="s1">createRouterError</span><span class="s2">(</span>
      <span class="s1">from</span><span class="s2">,</span>
      <span class="s1">to</span><span class="s2">,</span>
      <span class="s1">NavigationFailureType</span><span class="s2">.</span><span class="s1">duplicated</span><span class="s2">,</span>
      <span class="s2">(</span><span class="s4">&quot;Avoided redundant navigation to current location: </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ (</span><span class="s1">from</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">) + </span><span class="s4">&quot;</span><span class="s3">\&quot;</span><span class="s4">.&quot;</span><span class="s2">)</span>
    <span class="s2">);</span>
    <span class="s0">// backwards compatible with the first introduction of Errors</span>
    <span class="s1">error</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s4">'NavigationDuplicated'</span><span class="s2">;</span>
    <span class="s3">return </span><span class="s1">error</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">createNavigationCancelledError </span><span class="s2">(</span><span class="s1">from</span><span class="s2">, </span><span class="s1">to</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">createRouterError</span><span class="s2">(</span>
      <span class="s1">from</span><span class="s2">,</span>
      <span class="s1">to</span><span class="s2">,</span>
      <span class="s1">NavigationFailureType</span><span class="s2">.</span><span class="s1">cancelled</span><span class="s2">,</span>
      <span class="s2">(</span><span class="s4">&quot;Navigation cancelled from </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ (</span><span class="s1">from</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">) + </span><span class="s4">&quot;</span><span class="s3">\&quot; </span><span class="s4">to </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ (</span><span class="s1">to</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">) + </span><span class="s4">&quot;</span><span class="s3">\&quot; </span><span class="s4">with a new navigation.&quot;</span><span class="s2">)</span>
    <span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">createNavigationAbortedError </span><span class="s2">(</span><span class="s1">from</span><span class="s2">, </span><span class="s1">to</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">createRouterError</span><span class="s2">(</span>
      <span class="s1">from</span><span class="s2">,</span>
      <span class="s1">to</span><span class="s2">,</span>
      <span class="s1">NavigationFailureType</span><span class="s2">.</span><span class="s1">aborted</span><span class="s2">,</span>
      <span class="s2">(</span><span class="s4">&quot;Navigation aborted from </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ (</span><span class="s1">from</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">) + </span><span class="s4">&quot;</span><span class="s3">\&quot; </span><span class="s4">to </span><span class="s3">\&quot;</span><span class="s4">&quot; </span><span class="s2">+ (</span><span class="s1">to</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">) + </span><span class="s4">&quot;</span><span class="s3">\&quot; </span><span class="s4">via a navigation guard.&quot;</span><span class="s2">)</span>
    <span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">createRouterError </span><span class="s2">(</span><span class="s1">from</span><span class="s2">, </span><span class="s1">to</span><span class="s2">, </span><span class="s1">type</span><span class="s2">, </span><span class="s1">message</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">error </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Error</span><span class="s2">(</span><span class="s1">message</span><span class="s2">);</span>
    <span class="s1">error</span><span class="s2">.</span><span class="s1">_isRouter </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
    <span class="s1">error</span><span class="s2">.</span><span class="s1">from </span><span class="s2">= </span><span class="s1">from</span><span class="s2">;</span>
    <span class="s1">error</span><span class="s2">.</span><span class="s1">to </span><span class="s2">= </span><span class="s1">to</span><span class="s2">;</span>
    <span class="s1">error</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s1">type</span><span class="s2">;</span>

    <span class="s3">return </span><span class="s1">error</span>
  <span class="s2">}</span>

  <span class="s3">var </span><span class="s1">propertiesToLog </span><span class="s2">= [</span><span class="s4">'params'</span><span class="s2">, </span><span class="s4">'query'</span><span class="s2">, </span><span class="s4">'hash'</span><span class="s2">];</span>

  <span class="s3">function </span><span class="s1">stringifyRoute </span><span class="s2">(</span><span class="s1">to</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">to </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">to </span><span class="s2">}</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s4">'path' </span><span class="s3">in </span><span class="s1">to</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">to</span><span class="s2">.</span><span class="s1">path </span><span class="s2">}</span>
    <span class="s3">var </span><span class="s1">location </span><span class="s2">= {};</span>
    <span class="s1">propertiesToLog</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">key </span><span class="s3">in </span><span class="s1">to</span><span class="s2">) { </span><span class="s1">location</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">to</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]; }</span>
    <span class="s2">});</span>
    <span class="s3">return </span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s3">null</span><span class="s2">, </span><span class="s6">2</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">isError </span><span class="s2">(</span><span class="s1">err</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">err</span><span class="s2">).</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'Error'</span><span class="s2">) &gt; -</span><span class="s6">1</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">isNavigationFailure </span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">errorType</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s2">(</span>
      <span class="s1">isError</span><span class="s2">(</span><span class="s1">err</span><span class="s2">) &amp;&amp;</span>
      <span class="s1">err</span><span class="s2">.</span><span class="s1">_isRouter </span><span class="s2">&amp;&amp;</span>
      <span class="s2">(</span><span class="s1">errorType </span><span class="s2">== </span><span class="s3">null </span><span class="s2">|| </span><span class="s1">err</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">errorType</span><span class="s2">)</span>
    <span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s3">function </span><span class="s1">runQueue </span><span class="s2">(</span><span class="s1">queue</span><span class="s2">, </span><span class="s1">fn</span><span class="s2">, </span><span class="s1">cb</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">step </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">index</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&gt;= </span><span class="s1">queue</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
        <span class="s1">cb</span><span class="s2">();</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">queue</span><span class="s2">[</span><span class="s1">index</span><span class="s2">]) {</span>
          <span class="s1">fn</span><span class="s2">(</span><span class="s1">queue</span><span class="s2">[</span><span class="s1">index</span><span class="s2">], </span><span class="s3">function </span><span class="s2">() {</span>
            <span class="s1">step</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s6">1</span><span class="s2">);</span>
          <span class="s2">});</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
          <span class="s1">step</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s6">1</span><span class="s2">);</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">};</span>
    <span class="s1">step</span><span class="s2">(</span><span class="s6">0</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s3">function </span><span class="s1">resolveAsyncComponents </span><span class="s2">(</span><span class="s1">matched</span><span class="s2">) {</span>
    <span class="s3">return function </span><span class="s2">(</span><span class="s1">to</span><span class="s2">, </span><span class="s1">from</span><span class="s2">, </span><span class="s1">next</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">hasAsync </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">pending </span><span class="s2">= </span><span class="s6">0</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">error </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>

      <span class="s1">flatMapComponents</span><span class="s2">(</span><span class="s1">matched</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">def</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">match</span><span class="s2">, </span><span class="s1">key</span><span class="s2">) {</span>
        <span class="s0">// if it's a function and doesn't have cid attached,</span>
        <span class="s0">// assume it's an async component resolve function.</span>
        <span class="s0">// we are not using Vue's default async resolving mechanism because</span>
        <span class="s0">// we want to halt the navigation until the incoming component has been</span>
        <span class="s0">// resolved.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">def </span><span class="s2">=== </span><span class="s4">'function' </span><span class="s2">&amp;&amp; </span><span class="s1">def</span><span class="s2">.</span><span class="s1">cid </span><span class="s2">=== </span><span class="s1">undefined</span><span class="s2">) {</span>
          <span class="s1">hasAsync </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
          <span class="s1">pending</span><span class="s2">++;</span>

          <span class="s3">var </span><span class="s1">resolve </span><span class="s2">= </span><span class="s1">once</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">resolvedDef</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isESModule</span><span class="s2">(</span><span class="s1">resolvedDef</span><span class="s2">)) {</span>
              <span class="s1">resolvedDef </span><span class="s2">= </span><span class="s1">resolvedDef</span><span class="s2">.</span><span class="s1">default</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s0">// save resolved on async factory in case it's used elsewhere</span>
            <span class="s1">def</span><span class="s2">.</span><span class="s1">resolved </span><span class="s2">= </span><span class="s3">typeof </span><span class="s1">resolvedDef </span><span class="s2">=== </span><span class="s4">'function'</span>
              <span class="s2">? </span><span class="s1">resolvedDef</span>
              <span class="s2">: </span><span class="s1">_Vue</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">resolvedDef</span><span class="s2">);</span>
            <span class="s1">match</span><span class="s2">.</span><span class="s1">components</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">resolvedDef</span><span class="s2">;</span>
            <span class="s1">pending</span><span class="s2">--;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">pending </span><span class="s2">&lt;= </span><span class="s6">0</span><span class="s2">) {</span>
              <span class="s1">next</span><span class="s2">();</span>
            <span class="s2">}</span>
          <span class="s2">});</span>

          <span class="s3">var </span><span class="s1">reject </span><span class="s2">= </span><span class="s1">once</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">reason</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Failed to resolve async component &quot; </span><span class="s2">+ </span><span class="s1">key </span><span class="s2">+ </span><span class="s4">&quot;: &quot; </span><span class="s2">+ </span><span class="s1">reason</span><span class="s2">;</span>
            <span class="s1">warn</span><span class="s2">(</span><span class="s3">false</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">error</span><span class="s2">) {</span>
              <span class="s1">error </span><span class="s2">= </span><span class="s1">isError</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">)</span>
                <span class="s2">? </span><span class="s1">reason</span>
                <span class="s2">: </span><span class="s3">new </span><span class="s1">Error</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">);</span>
              <span class="s1">next</span><span class="s2">(</span><span class="s1">error</span><span class="s2">);</span>
            <span class="s2">}</span>
          <span class="s2">});</span>

          <span class="s3">var </span><span class="s1">res</span><span class="s2">;</span>
          <span class="s3">try </span><span class="s2">{</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">def</span><span class="s2">(</span><span class="s1">resolve</span><span class="s2">, </span><span class="s1">reject</span><span class="s2">);</span>
          <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
            <span class="s1">reject</span><span class="s2">(</span><span class="s1">e</span><span class="s2">);</span>
          <span class="s2">}</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">res</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">res</span><span class="s2">.</span><span class="s1">then </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
              <span class="s1">res</span><span class="s2">.</span><span class="s1">then</span><span class="s2">(</span><span class="s1">resolve</span><span class="s2">, </span><span class="s1">reject</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
              <span class="s0">// new syntax in Vue 2.3</span>
              <span class="s3">var </span><span class="s1">comp </span><span class="s2">= </span><span class="s1">res</span><span class="s2">.</span><span class="s1">component</span><span class="s2">;</span>
              <span class="s3">if </span><span class="s2">(</span><span class="s1">comp </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">comp</span><span class="s2">.</span><span class="s1">then </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
                <span class="s1">comp</span><span class="s2">.</span><span class="s1">then</span><span class="s2">(</span><span class="s1">resolve</span><span class="s2">, </span><span class="s1">reject</span><span class="s2">);</span>
              <span class="s2">}</span>
            <span class="s2">}</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
      <span class="s2">});</span>

      <span class="s3">if </span><span class="s2">(!</span><span class="s1">hasAsync</span><span class="s2">) { </span><span class="s1">next</span><span class="s2">(); }</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">flatMapComponents </span><span class="s2">(</span>
    <span class="s1">matched</span><span class="s2">,</span>
    <span class="s1">fn</span>
  <span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">flatten</span><span class="s2">(</span><span class="s1">matched</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">m</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">m</span><span class="s2">.</span><span class="s1">components</span><span class="s2">).</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">fn</span><span class="s2">(</span>
        <span class="s1">m</span><span class="s2">.</span><span class="s1">components</span><span class="s2">[</span><span class="s1">key</span><span class="s2">],</span>
        <span class="s1">m</span><span class="s2">.</span><span class="s1">instances</span><span class="s2">[</span><span class="s1">key</span><span class="s2">],</span>
        <span class="s1">m</span><span class="s2">, </span><span class="s1">key</span>
      <span class="s2">); })</span>
    <span class="s2">}))</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">flatten </span><span class="s2">(</span><span class="s1">arr</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">([], </span><span class="s1">arr</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">var </span><span class="s1">hasSymbol </span><span class="s2">=</span>
    <span class="s3">typeof </span><span class="s1">Symbol </span><span class="s2">=== </span><span class="s4">'function' </span><span class="s2">&amp;&amp;</span>
    <span class="s3">typeof </span><span class="s1">Symbol</span><span class="s2">.</span><span class="s1">toStringTag </span><span class="s2">=== </span><span class="s4">'symbol'</span><span class="s2">;</span>

  <span class="s3">function </span><span class="s1">isESModule </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">__esModule </span><span class="s2">|| (</span><span class="s1">hasSymbol </span><span class="s2">&amp;&amp; </span><span class="s1">obj</span><span class="s2">[</span><span class="s1">Symbol</span><span class="s2">.</span><span class="s1">toStringTag</span><span class="s2">] === </span><span class="s4">'Module'</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s0">// in Webpack 2, require.ensure now also returns a Promise</span>
  <span class="s0">// so the resolve/reject functions may get called an extra time</span>
  <span class="s0">// if the user uses an arrow function shorthand that happens to</span>
  <span class="s0">// return that Promise.</span>
  <span class="s3">function </span><span class="s1">once </span><span class="s2">(</span><span class="s1">fn</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">called </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
    <span class="s3">return function </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">args </span><span class="s2">= [], </span><span class="s1">len </span><span class="s2">= </span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
      <span class="s3">while </span><span class="s2">( </span><span class="s1">len</span><span class="s2">-- ) </span><span class="s1">args</span><span class="s2">[ </span><span class="s1">len </span><span class="s2">] = </span><span class="s1">arguments</span><span class="s2">[ </span><span class="s1">len </span><span class="s2">];</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">called</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">}</span>
      <span class="s1">called </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
      <span class="s3">return </span><span class="s1">fn</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">args</span><span class="s2">)</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s3">var </span><span class="s1">History </span><span class="s2">= </span><span class="s3">function </span><span class="s1">History </span><span class="s2">(</span><span class="s1">router</span><span class="s2">, </span><span class="s1">base</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">router </span><span class="s2">= </span><span class="s1">router</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">base </span><span class="s2">= </span><span class="s1">normalizeBase</span><span class="s2">(</span><span class="s1">base</span><span class="s2">);</span>
    <span class="s0">// start with a route object that stands for &quot;nowhere&quot;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">current </span><span class="s2">= </span><span class="s1">START</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">pending </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">ready </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">readyCbs </span><span class="s2">= [];</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">readyErrorCbs </span><span class="s2">= [];</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">errorCbs </span><span class="s2">= [];</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">listeners </span><span class="s2">= [];</span>
  <span class="s2">};</span>

  <span class="s1">History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">listen </span><span class="s2">= </span><span class="s3">function </span><span class="s1">listen </span><span class="s2">(</span><span class="s1">cb</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">cb </span><span class="s2">= </span><span class="s1">cb</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">onReady </span><span class="s2">= </span><span class="s3">function </span><span class="s1">onReady </span><span class="s2">(</span><span class="s1">cb</span><span class="s2">, </span><span class="s1">errorCb</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">ready</span><span class="s2">) {</span>
      <span class="s1">cb</span><span class="s2">();</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">readyCbs</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">);</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">errorCb</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">readyErrorCbs</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">errorCb</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">onError </span><span class="s2">= </span><span class="s3">function </span><span class="s1">onError </span><span class="s2">(</span><span class="s1">errorCb</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">errorCbs</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">errorCb</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">transitionTo </span><span class="s2">= </span><span class="s3">function </span><span class="s1">transitionTo </span><span class="s2">(</span>
    <span class="s1">location</span><span class="s2">,</span>
    <span class="s1">onComplete</span><span class="s2">,</span>
    <span class="s1">onAbort</span>
  <span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">route</span><span class="s2">;</span>
    <span class="s0">// catch redirect option https://github.com/vuejs/vue-router/issues/3201</span>
    <span class="s3">try </span><span class="s2">{</span>
      <span class="s1">route </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">router</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">current</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">errorCbs</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">cb</span><span class="s2">) {</span>
        <span class="s1">cb</span><span class="s2">(</span><span class="s1">e</span><span class="s2">);</span>
      <span class="s2">});</span>
      <span class="s0">// Exception should still be thrown</span>
      <span class="s3">throw </span><span class="s1">e</span>
    <span class="s2">}</span>
    <span class="s3">var </span><span class="s1">prev </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">current</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">confirmTransition</span><span class="s2">(</span>
      <span class="s1">route</span><span class="s2">,</span>
      <span class="s3">function </span><span class="s2">() {</span>
        <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">updateRoute</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
        <span class="s1">onComplete </span><span class="s2">&amp;&amp; </span><span class="s1">onComplete</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
        <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">ensureURL</span><span class="s2">();</span>
        <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">router</span><span class="s2">.</span><span class="s1">afterHooks</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">hook</span><span class="s2">) {</span>
          <span class="s1">hook </span><span class="s2">&amp;&amp; </span><span class="s1">hook</span><span class="s2">(</span><span class="s1">route</span><span class="s2">, </span><span class="s1">prev</span><span class="s2">);</span>
        <span class="s2">});</span>

        <span class="s0">// fire ready cbs once</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">ready</span><span class="s2">) {</span>
          <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">ready </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
          <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">readyCbs</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">cb</span><span class="s2">) {</span>
            <span class="s1">cb</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
          <span class="s2">});</span>
        <span class="s2">}</span>
      <span class="s2">},</span>
      <span class="s3">function </span><span class="s2">(</span><span class="s1">err</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">onAbort</span><span class="s2">) {</span>
          <span class="s1">onAbort</span><span class="s2">(</span><span class="s1">err</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">err </span><span class="s2">&amp;&amp; !</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">ready</span><span class="s2">) {</span>
          <span class="s0">// Initial redirection should not mark the history as ready yet</span>
          <span class="s0">// because it's triggered by the redirection instead</span>
          <span class="s0">// https://github.com/vuejs/vue-router/issues/3225</span>
          <span class="s0">// https://github.com/vuejs/vue-router/issues/3331</span>
          <span class="s3">if </span><span class="s2">(!</span><span class="s1">isNavigationFailure</span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">NavigationFailureType</span><span class="s2">.</span><span class="s1">redirected</span><span class="s2">) || </span><span class="s1">prev </span><span class="s2">!== </span><span class="s1">START</span><span class="s2">) {</span>
            <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">ready </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
            <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">readyErrorCbs</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">cb</span><span class="s2">) {</span>
              <span class="s1">cb</span><span class="s2">(</span><span class="s1">err</span><span class="s2">);</span>
            <span class="s2">});</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">confirmTransition </span><span class="s2">= </span><span class="s3">function </span><span class="s1">confirmTransition </span><span class="s2">(</span><span class="s1">route</span><span class="s2">, </span><span class="s1">onComplete</span><span class="s2">, </span><span class="s1">onAbort</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">current </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">current</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">pending </span><span class="s2">= </span><span class="s1">route</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">abort </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">err</span><span class="s2">) {</span>
      <span class="s0">// changed after adding errors with</span>
      <span class="s0">// https://github.com/vuejs/vue-router/pull/3047 before that change,</span>
      <span class="s0">// redirect and aborted navigation would produce an err == null</span>
      <span class="s3">if </span><span class="s2">(!</span><span class="s1">isNavigationFailure</span><span class="s2">(</span><span class="s1">err</span><span class="s2">) &amp;&amp; </span><span class="s1">isError</span><span class="s2">(</span><span class="s1">err</span><span class="s2">)) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">errorCbs</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
          <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">errorCbs</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">cb</span><span class="s2">) {</span>
            <span class="s1">cb</span><span class="s2">(</span><span class="s1">err</span><span class="s2">);</span>
          <span class="s2">});</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
          <span class="s2">{</span>
            <span class="s1">warn</span><span class="s2">(</span><span class="s3">false</span><span class="s2">, </span><span class="s4">'uncaught error during route navigation:'</span><span class="s2">);</span>
          <span class="s2">}</span>
          <span class="s1">console</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span><span class="s1">err</span><span class="s2">);</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
      <span class="s1">onAbort </span><span class="s2">&amp;&amp; </span><span class="s1">onAbort</span><span class="s2">(</span><span class="s1">err</span><span class="s2">);</span>
    <span class="s2">};</span>
    <span class="s3">var </span><span class="s1">lastRouteIndex </span><span class="s2">= </span><span class="s1">route</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s6">1</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">lastCurrentIndex </span><span class="s2">= </span><span class="s1">current</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s6">1</span><span class="s2">;</span>
    <span class="s3">if </span><span class="s2">(</span>
      <span class="s1">isSameRoute</span><span class="s2">(</span><span class="s1">route</span><span class="s2">, </span><span class="s1">current</span><span class="s2">) &amp;&amp;</span>
      <span class="s0">// in the case the route map has been dynamically appended to</span>
      <span class="s1">lastRouteIndex </span><span class="s2">=== </span><span class="s1">lastCurrentIndex </span><span class="s2">&amp;&amp;</span>
      <span class="s1">route</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">[</span><span class="s1">lastRouteIndex</span><span class="s2">] === </span><span class="s1">current</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">[</span><span class="s1">lastCurrentIndex</span><span class="s2">]</span>
    <span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">ensureURL</span><span class="s2">();</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">route</span><span class="s2">.</span><span class="s1">hash</span><span class="s2">) {</span>
        <span class="s1">handleScroll</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">router</span><span class="s2">, </span><span class="s1">current</span><span class="s2">, </span><span class="s1">route</span><span class="s2">, </span><span class="s3">false</span><span class="s2">);</span>
      <span class="s2">}</span>
      <span class="s3">return </span><span class="s1">abort</span><span class="s2">(</span><span class="s1">createNavigationDuplicatedError</span><span class="s2">(</span><span class="s1">current</span><span class="s2">, </span><span class="s1">route</span><span class="s2">))</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">ref </span><span class="s2">= </span><span class="s1">resolveQueue</span><span class="s2">(</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">current</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">,</span>
      <span class="s1">route</span><span class="s2">.</span><span class="s1">matched</span>
    <span class="s2">);</span>
      <span class="s3">var </span><span class="s1">updated </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">updated</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">deactivated </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">deactivated</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">activated </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">activated</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">queue </span><span class="s2">= [].</span><span class="s1">concat</span><span class="s2">(</span>
      <span class="s0">// in-component leave guards</span>
      <span class="s1">extractLeaveGuards</span><span class="s2">(</span><span class="s1">deactivated</span><span class="s2">),</span>
      <span class="s0">// global before hooks</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">router</span><span class="s2">.</span><span class="s1">beforeHooks</span><span class="s2">,</span>
      <span class="s0">// in-component update hooks</span>
      <span class="s1">extractUpdateHooks</span><span class="s2">(</span><span class="s1">updated</span><span class="s2">),</span>
      <span class="s0">// in-config enter guards</span>
      <span class="s1">activated</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">m</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">m</span><span class="s2">.</span><span class="s1">beforeEnter</span><span class="s2">; }),</span>
      <span class="s0">// async components</span>
      <span class="s1">resolveAsyncComponents</span><span class="s2">(</span><span class="s1">activated</span><span class="s2">)</span>
    <span class="s2">);</span>

    <span class="s3">var </span><span class="s1">iterator </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">hook</span><span class="s2">, </span><span class="s1">next</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">pending </span><span class="s2">!== </span><span class="s1">route</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">abort</span><span class="s2">(</span><span class="s1">createNavigationCancelledError</span><span class="s2">(</span><span class="s1">current</span><span class="s2">, </span><span class="s1">route</span><span class="s2">))</span>
      <span class="s2">}</span>
      <span class="s3">try </span><span class="s2">{</span>
        <span class="s1">hook</span><span class="s2">(</span><span class="s1">route</span><span class="s2">, </span><span class="s1">current</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">to</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">to </span><span class="s2">=== </span><span class="s3">false</span><span class="s2">) {</span>
            <span class="s0">// next(false) -&gt; abort navigation, ensure current URL</span>
            <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">ensureURL</span><span class="s2">(</span><span class="s3">true</span><span class="s2">);</span>
            <span class="s1">abort</span><span class="s2">(</span><span class="s1">createNavigationAbortedError</span><span class="s2">(</span><span class="s1">current</span><span class="s2">, </span><span class="s1">route</span><span class="s2">));</span>
          <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isError</span><span class="s2">(</span><span class="s1">to</span><span class="s2">)) {</span>
            <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">ensureURL</span><span class="s2">(</span><span class="s3">true</span><span class="s2">);</span>
            <span class="s1">abort</span><span class="s2">(</span><span class="s1">to</span><span class="s2">);</span>
          <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span>
            <span class="s3">typeof </span><span class="s1">to </span><span class="s2">=== </span><span class="s4">'string' </span><span class="s2">||</span>
            <span class="s2">(</span><span class="s3">typeof </span><span class="s1">to </span><span class="s2">=== </span><span class="s4">'object' </span><span class="s2">&amp;&amp;</span>
              <span class="s2">(</span><span class="s3">typeof </span><span class="s1">to</span><span class="s2">.</span><span class="s1">path </span><span class="s2">=== </span><span class="s4">'string' </span><span class="s2">|| </span><span class="s3">typeof </span><span class="s1">to</span><span class="s2">.</span><span class="s1">name </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">))</span>
          <span class="s2">) {</span>
            <span class="s0">// next('/') or next({ path: '/' }) -&gt; redirect</span>
            <span class="s1">abort</span><span class="s2">(</span><span class="s1">createNavigationRedirectedError</span><span class="s2">(</span><span class="s1">current</span><span class="s2">, </span><span class="s1">route</span><span class="s2">));</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">to </span><span class="s2">=== </span><span class="s4">'object' </span><span class="s2">&amp;&amp; </span><span class="s1">to</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">) {</span>
              <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">to</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
              <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">to</span><span class="s2">);</span>
            <span class="s2">}</span>
          <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s0">// confirm transition and pass on the value</span>
            <span class="s1">next</span><span class="s2">(</span><span class="s1">to</span><span class="s2">);</span>
          <span class="s2">}</span>
        <span class="s2">});</span>
      <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
        <span class="s1">abort</span><span class="s2">(</span><span class="s1">e</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">};</span>

    <span class="s1">runQueue</span><span class="s2">(</span><span class="s1">queue</span><span class="s2">, </span><span class="s1">iterator</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s0">// wait until async components are resolved before</span>
      <span class="s0">// extracting in-component enter guards</span>
      <span class="s3">var </span><span class="s1">enterGuards </span><span class="s2">= </span><span class="s1">extractEnterGuards</span><span class="s2">(</span><span class="s1">activated</span><span class="s2">);</span>
      <span class="s3">var </span><span class="s1">queue </span><span class="s2">= </span><span class="s1">enterGuards</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">router</span><span class="s2">.</span><span class="s1">resolveHooks</span><span class="s2">);</span>
      <span class="s1">runQueue</span><span class="s2">(</span><span class="s1">queue</span><span class="s2">, </span><span class="s1">iterator</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">pending </span><span class="s2">!== </span><span class="s1">route</span><span class="s2">) {</span>
          <span class="s3">return </span><span class="s1">abort</span><span class="s2">(</span><span class="s1">createNavigationCancelledError</span><span class="s2">(</span><span class="s1">current</span><span class="s2">, </span><span class="s1">route</span><span class="s2">))</span>
        <span class="s2">}</span>
        <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">pending </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
        <span class="s1">onComplete</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">router</span><span class="s2">.</span><span class="s1">app</span><span class="s2">) {</span>
          <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">router</span><span class="s2">.</span><span class="s1">app</span><span class="s2">.</span><span class="s1">$nextTick</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
            <span class="s1">handleRouteEntered</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
          <span class="s2">});</span>
        <span class="s2">}</span>
      <span class="s2">});</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">updateRoute </span><span class="s2">= </span><span class="s3">function </span><span class="s1">updateRoute </span><span class="s2">(</span><span class="s1">route</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">current </span><span class="s2">= </span><span class="s1">route</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">cb </span><span class="s2">&amp;&amp; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">cb</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">setupListeners </span><span class="s2">= </span><span class="s3">function </span><span class="s1">setupListeners </span><span class="s2">() {</span>
    <span class="s0">// Default implementation is empty</span>
  <span class="s2">};</span>

  <span class="s1">History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">teardown </span><span class="s2">= </span><span class="s3">function </span><span class="s1">teardown </span><span class="s2">() {</span>
    <span class="s0">// clean up event listeners</span>
    <span class="s0">// https://github.com/vuejs/vue-router/issues/2341</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">cleanupListener</span><span class="s2">) {</span>
      <span class="s1">cleanupListener</span><span class="s2">();</span>
    <span class="s2">});</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">listeners </span><span class="s2">= [];</span>

    <span class="s0">// reset current history route</span>
    <span class="s0">// https://github.com/vuejs/vue-router/issues/3294</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">current </span><span class="s2">= </span><span class="s1">START</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">pending </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s3">function </span><span class="s1">normalizeBase </span><span class="s2">(</span><span class="s1">base</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">base</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">inBrowser</span><span class="s2">) {</span>
        <span class="s0">// respect &lt;base&gt; tag</span>
        <span class="s3">var </span><span class="s1">baseEl </span><span class="s2">= </span><span class="s1">document</span><span class="s2">.</span><span class="s1">querySelector</span><span class="s2">(</span><span class="s4">'base'</span><span class="s2">);</span>
        <span class="s1">base </span><span class="s2">= (</span><span class="s1">baseEl </span><span class="s2">&amp;&amp; </span><span class="s1">baseEl</span><span class="s2">.</span><span class="s1">getAttribute</span><span class="s2">(</span><span class="s4">'href'</span><span class="s2">)) || </span><span class="s4">'/'</span><span class="s2">;</span>
        <span class="s0">// strip full URL origin</span>
        <span class="s1">base </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/^https?:\/\/[^\/]+/</span><span class="s2">, </span><span class="s4">''</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">base </span><span class="s2">= </span><span class="s4">'/'</span><span class="s2">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s0">// make sure there's the starting slash</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">base</span><span class="s2">.</span><span class="s1">charAt</span><span class="s2">(</span><span class="s6">0</span><span class="s2">) !== </span><span class="s4">'/'</span><span class="s2">) {</span>
      <span class="s1">base </span><span class="s2">= </span><span class="s4">'/' </span><span class="s2">+ </span><span class="s1">base</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s0">// remove trailing slash</span>
    <span class="s3">return </span><span class="s1">base</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/\/$/</span><span class="s2">, </span><span class="s4">''</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">resolveQueue </span><span class="s2">(</span>
    <span class="s1">current</span><span class="s2">,</span>
    <span class="s1">next</span>
  <span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">i</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">max </span><span class="s2">= </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">current</span><span class="s2">.</span><span class="s1">length</span><span class="s2">, </span><span class="s1">next</span><span class="s2">.</span><span class="s1">length</span><span class="s2">);</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">max</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">current</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] !== </span><span class="s1">next</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]) {</span>
        <span class="s3">break</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s2">{</span>
      <span class="s1">updated</span><span class="s2">: </span><span class="s1">next</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s1">i</span><span class="s2">),</span>
      <span class="s1">activated</span><span class="s2">: </span><span class="s1">next</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">i</span><span class="s2">),</span>
      <span class="s1">deactivated</span><span class="s2">: </span><span class="s1">current</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">extractGuards </span><span class="s2">(</span>
    <span class="s1">records</span><span class="s2">,</span>
    <span class="s1">name</span><span class="s2">,</span>
    <span class="s1">bind</span><span class="s2">,</span>
    <span class="s1">reverse</span>
  <span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">guards </span><span class="s2">= </span><span class="s1">flatMapComponents</span><span class="s2">(</span><span class="s1">records</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">def</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">match</span><span class="s2">, </span><span class="s1">key</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">guard </span><span class="s2">= </span><span class="s1">extractGuard</span><span class="s2">(</span><span class="s1">def</span><span class="s2">, </span><span class="s1">name</span><span class="s2">);</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">guard</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">guard</span><span class="s2">)</span>
          <span class="s2">? </span><span class="s1">guard</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">guard</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">bind</span><span class="s2">(</span><span class="s1">guard</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">match</span><span class="s2">, </span><span class="s1">key</span><span class="s2">); })</span>
          <span class="s2">: </span><span class="s1">bind</span><span class="s2">(</span><span class="s1">guard</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">match</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)</span>
      <span class="s2">}</span>
    <span class="s2">});</span>
    <span class="s3">return </span><span class="s1">flatten</span><span class="s2">(</span><span class="s1">reverse </span><span class="s2">? </span><span class="s1">guards</span><span class="s2">.</span><span class="s1">reverse</span><span class="s2">() : </span><span class="s1">guards</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">extractGuard </span><span class="s2">(</span>
    <span class="s1">def</span><span class="s2">,</span>
    <span class="s1">key</span>
  <span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">def </span><span class="s2">!== </span><span class="s4">'function'</span><span class="s2">) {</span>
      <span class="s0">// extend now so that global mixins are applied.</span>
      <span class="s1">def </span><span class="s2">= </span><span class="s1">_Vue</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">def</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">def</span><span class="s2">.</span><span class="s1">options</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">extractLeaveGuards </span><span class="s2">(</span><span class="s1">deactivated</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">extractGuards</span><span class="s2">(</span><span class="s1">deactivated</span><span class="s2">, </span><span class="s4">'beforeRouteLeave'</span><span class="s2">, </span><span class="s1">bindGuard</span><span class="s2">, </span><span class="s3">true</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">extractUpdateHooks </span><span class="s2">(</span><span class="s1">updated</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">extractGuards</span><span class="s2">(</span><span class="s1">updated</span><span class="s2">, </span><span class="s4">'beforeRouteUpdate'</span><span class="s2">, </span><span class="s1">bindGuard</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">bindGuard </span><span class="s2">(</span><span class="s1">guard</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">instance</span><span class="s2">) {</span>
      <span class="s3">return function </span><span class="s1">boundRouteGuard </span><span class="s2">() {</span>
        <span class="s3">return </span><span class="s1">guard</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">instance</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">)</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">extractEnterGuards </span><span class="s2">(</span>
    <span class="s1">activated</span>
  <span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">extractGuards</span><span class="s2">(</span>
      <span class="s1">activated</span><span class="s2">,</span>
      <span class="s4">'beforeRouteEnter'</span><span class="s2">,</span>
      <span class="s3">function </span><span class="s2">(</span><span class="s1">guard</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">match</span><span class="s2">, </span><span class="s1">key</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">bindEnterGuard</span><span class="s2">(</span><span class="s1">guard</span><span class="s2">, </span><span class="s1">match</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)</span>
      <span class="s2">}</span>
    <span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">bindEnterGuard </span><span class="s2">(</span>
    <span class="s1">guard</span><span class="s2">,</span>
    <span class="s1">match</span><span class="s2">,</span>
    <span class="s1">key</span>
  <span class="s2">) {</span>
    <span class="s3">return function </span><span class="s1">routeEnterGuard </span><span class="s2">(</span><span class="s1">to</span><span class="s2">, </span><span class="s1">from</span><span class="s2">, </span><span class="s1">next</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">guard</span><span class="s2">(</span><span class="s1">to</span><span class="s2">, </span><span class="s1">from</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">cb</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">cb </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">.</span><span class="s1">enteredCbs</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]) {</span>
            <span class="s1">match</span><span class="s2">.</span><span class="s1">enteredCbs</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = [];</span>
          <span class="s2">}</span>
          <span class="s1">match</span><span class="s2">.</span><span class="s1">enteredCbs</span><span class="s2">[</span><span class="s1">key</span><span class="s2">].</span><span class="s1">push</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s1">next</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">);</span>
      <span class="s2">})</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s3">var </span><span class="s1">HTML5History </span><span class="s2">= </span><span class="s0">/*@__PURE__*/</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">History</span><span class="s2">) {</span>
    <span class="s3">function </span><span class="s1">HTML5History </span><span class="s2">(</span><span class="s1">router</span><span class="s2">, </span><span class="s1">base</span><span class="s2">) {</span>
      <span class="s1">History</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">router</span><span class="s2">, </span><span class="s1">base</span><span class="s2">);</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">_startLocation </span><span class="s2">= </span><span class="s1">getLocation</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">base</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">( </span><span class="s1">History </span><span class="s2">) </span><span class="s1">HTML5History</span><span class="s2">.</span><span class="s1">__proto__ </span><span class="s2">= </span><span class="s1">History</span><span class="s2">;</span>
    <span class="s1">HTML5History</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create</span><span class="s2">( </span><span class="s1">History </span><span class="s2">&amp;&amp; </span><span class="s1">History</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">);</span>
    <span class="s1">HTML5History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">constructor </span><span class="s2">= </span><span class="s1">HTML5History</span><span class="s2">;</span>

    <span class="s1">HTML5History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">setupListeners </span><span class="s2">= </span><span class="s3">function </span><span class="s1">setupListeners </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s6">0</span><span class="s2">) {</span>
        <span class="s3">return</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">router </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">router</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">expectScroll </span><span class="s2">= </span><span class="s1">router</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">scrollBehavior</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">supportsScroll </span><span class="s2">= </span><span class="s1">supportsPushState </span><span class="s2">&amp;&amp; </span><span class="s1">expectScroll</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">supportsScroll</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">setupScroll</span><span class="s2">());</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">handleRoutingEvent </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">current </span><span class="s2">= </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">current</span><span class="s2">;</span>

        <span class="s0">// Avoiding first `popstate` event dispatched in some browsers but first</span>
        <span class="s0">// history route not updated since async guard at the same time.</span>
        <span class="s3">var </span><span class="s1">location </span><span class="s2">= </span><span class="s1">getLocation</span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">base</span><span class="s2">);</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">current </span><span class="s2">=== </span><span class="s1">START </span><span class="s2">&amp;&amp; </span><span class="s1">location </span><span class="s2">=== </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">_startLocation</span><span class="s2">) {</span>
          <span class="s3">return</span>
        <span class="s2">}</span>

        <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">transitionTo</span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">route</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">supportsScroll</span><span class="s2">) {</span>
            <span class="s1">handleScroll</span><span class="s2">(</span><span class="s1">router</span><span class="s2">, </span><span class="s1">route</span><span class="s2">, </span><span class="s1">current</span><span class="s2">, </span><span class="s3">true</span><span class="s2">);</span>
          <span class="s2">}</span>
        <span class="s2">});</span>
      <span class="s2">};</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">addEventListener</span><span class="s2">(</span><span class="s4">'popstate'</span><span class="s2">, </span><span class="s1">handleRoutingEvent</span><span class="s2">);</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s1">window</span><span class="s2">.</span><span class="s1">removeEventListener</span><span class="s2">(</span><span class="s4">'popstate'</span><span class="s2">, </span><span class="s1">handleRoutingEvent</span><span class="s2">);</span>
      <span class="s2">});</span>
    <span class="s2">};</span>

    <span class="s1">HTML5History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">go </span><span class="s2">= </span><span class="s3">function </span><span class="s1">go </span><span class="s2">(</span><span class="s1">n</span><span class="s2">) {</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">go</span><span class="s2">(</span><span class="s1">n</span><span class="s2">);</span>
    <span class="s2">};</span>

    <span class="s1">HTML5History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">push </span><span class="s2">= </span><span class="s3">function </span><span class="s1">push </span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">onComplete</span><span class="s2">, </span><span class="s1">onAbort</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">ref </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">fromRoute </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">current</span><span class="s2">;</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">transitionTo</span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">route</span><span class="s2">) {</span>
        <span class="s1">pushState</span><span class="s2">(</span><span class="s1">cleanPath</span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">base </span><span class="s2">+ </span><span class="s1">route</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">));</span>
        <span class="s1">handleScroll</span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">router</span><span class="s2">, </span><span class="s1">route</span><span class="s2">, </span><span class="s1">fromRoute</span><span class="s2">, </span><span class="s3">false</span><span class="s2">);</span>
        <span class="s1">onComplete </span><span class="s2">&amp;&amp; </span><span class="s1">onComplete</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
      <span class="s2">}, </span><span class="s1">onAbort</span><span class="s2">);</span>
    <span class="s2">};</span>

    <span class="s1">HTML5History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">replace </span><span class="s2">= </span><span class="s3">function </span><span class="s1">replace </span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">onComplete</span><span class="s2">, </span><span class="s1">onAbort</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">ref </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">fromRoute </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">current</span><span class="s2">;</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">transitionTo</span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">route</span><span class="s2">) {</span>
        <span class="s1">replaceState</span><span class="s2">(</span><span class="s1">cleanPath</span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">base </span><span class="s2">+ </span><span class="s1">route</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">));</span>
        <span class="s1">handleScroll</span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">router</span><span class="s2">, </span><span class="s1">route</span><span class="s2">, </span><span class="s1">fromRoute</span><span class="s2">, </span><span class="s3">false</span><span class="s2">);</span>
        <span class="s1">onComplete </span><span class="s2">&amp;&amp; </span><span class="s1">onComplete</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
      <span class="s2">}, </span><span class="s1">onAbort</span><span class="s2">);</span>
    <span class="s2">};</span>

    <span class="s1">HTML5History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">ensureURL </span><span class="s2">= </span><span class="s3">function </span><span class="s1">ensureURL </span><span class="s2">(</span><span class="s1">push</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">getLocation</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">base</span><span class="s2">) !== </span><span class="s3">this</span><span class="s2">.</span><span class="s1">current</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">current </span><span class="s2">= </span><span class="s1">cleanPath</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">base </span><span class="s2">+ </span><span class="s3">this</span><span class="s2">.</span><span class="s1">current</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">);</span>
        <span class="s1">push </span><span class="s2">? </span><span class="s1">pushState</span><span class="s2">(</span><span class="s1">current</span><span class="s2">) : </span><span class="s1">replaceState</span><span class="s2">(</span><span class="s1">current</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">};</span>

    <span class="s1">HTML5History</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">getCurrentLocation </span><span class="s2">= </span><span class="s3">function </span><span class="s1">getCurrentLocation </span><span class="s2">() {</span>
      <span class="s3">return </span><span class="s1">getLocation</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">base</span><span class="s2">)</span>
    <span class="s2">};</span>

    <span class="s3">return </span><span class="s1">HTML5History</span><span class="s2">;</span>
  <span class="s2">}(</span><span class="s1">History</span><span class="s2">));</span>

  <span class="s3">function </span><span class="s1">getLocation </span><span class="s2">(</span><span class="s1">base</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">pathname</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">pathLowerCase </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">toLowerCase</span><span class="s2">();</span>
    <span class="s3">var </span><span class="s1">baseLowerCase </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">toLowerCase</span><span class="s2">();</span>
    <span class="s0">// base=&quot;/a&quot; shouldn't turn path=&quot;/app&quot; into &quot;/a/pp&quot;</span>
    <span class="s0">// https://github.com/vuejs/vue-router/issues/3555</span>
    <span class="s0">// so we ensure the trailing slash in the base</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">base </span><span class="s2">&amp;&amp; ((</span><span class="s1">pathLowerCase </span><span class="s2">=== </span><span class="s1">baseLowerCase</span><span class="s2">) ||</span>
      <span class="s2">(</span><span class="s1">pathLowerCase</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">cleanPath</span><span class="s2">(</span><span class="s1">baseLowerCase </span><span class="s2">+ </span><span class="s4">'/'</span><span class="s2">)) === </span><span class="s6">0</span><span class="s2">))) {</span>
      <span class="s1">path </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">base</span><span class="s2">.</span><span class="s1">length</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s2">(</span><span class="s1">path </span><span class="s2">|| </span><span class="s4">'/'</span><span class="s2">) + </span><span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">search </span><span class="s2">+ </span><span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">hash</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s3">var </span><span class="s1">HashHistory </span><span class="s2">= </span><span class="s0">/*@__PURE__*/</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">History</span><span class="s2">) {</span>
    <span class="s3">function </span><span class="s1">HashHistory </span><span class="s2">(</span><span class="s1">router</span><span class="s2">, </span><span class="s1">base</span><span class="s2">, </span><span class="s1">fallback</span><span class="s2">) {</span>
      <span class="s1">History</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">router</span><span class="s2">, </span><span class="s1">base</span><span class="s2">);</span>
      <span class="s0">// check history fallback deeplinking</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">fallback </span><span class="s2">&amp;&amp; </span><span class="s1">checkFallback</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">base</span><span class="s2">)) {</span>
        <span class="s3">return</span>
      <span class="s2">}</span>
      <span class="s1">ensureSlash</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">( </span><span class="s1">History </span><span class="s2">) </span><span class="s1">HashHistory</span><span class="s2">.</span><span class="s1">__proto__ </span><span class="s2">= </span><span class="s1">History</span><span class="s2">;</span>
    <span class="s1">HashHistory</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create</span><span class="s2">( </span><span class="s1">History </span><span class="s2">&amp;&amp; </span><span class="s1">History</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">);</span>
    <span class="s1">HashHistory</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">constructor </span><span class="s2">= </span><span class="s1">HashHistory</span><span class="s2">;</span>

    <span class="s0">// this is delayed until the app mounts</span>
    <span class="s0">// to avoid the hashchange listener being fired too early</span>
    <span class="s1">HashHistory</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">setupListeners </span><span class="s2">= </span><span class="s3">function </span><span class="s1">setupListeners </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s6">0</span><span class="s2">) {</span>
        <span class="s3">return</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">router </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">router</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">expectScroll </span><span class="s2">= </span><span class="s1">router</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">scrollBehavior</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">supportsScroll </span><span class="s2">= </span><span class="s1">supportsPushState </span><span class="s2">&amp;&amp; </span><span class="s1">expectScroll</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">supportsScroll</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">setupScroll</span><span class="s2">());</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">handleRoutingEvent </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">current </span><span class="s2">= </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">current</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">ensureSlash</span><span class="s2">()) {</span>
          <span class="s3">return</span>
        <span class="s2">}</span>
        <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">transitionTo</span><span class="s2">(</span><span class="s1">getHash</span><span class="s2">(), </span><span class="s3">function </span><span class="s2">(</span><span class="s1">route</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">supportsScroll</span><span class="s2">) {</span>
            <span class="s1">handleScroll</span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">router</span><span class="s2">, </span><span class="s1">route</span><span class="s2">, </span><span class="s1">current</span><span class="s2">, </span><span class="s3">true</span><span class="s2">);</span>
          <span class="s2">}</span>
          <span class="s3">if </span><span class="s2">(!</span><span class="s1">supportsPushState</span><span class="s2">) {</span>
            <span class="s1">replaceHash</span><span class="s2">(</span><span class="s1">route</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">);</span>
          <span class="s2">}</span>
        <span class="s2">});</span>
      <span class="s2">};</span>
      <span class="s3">var </span><span class="s1">eventType </span><span class="s2">= </span><span class="s1">supportsPushState </span><span class="s2">? </span><span class="s4">'popstate' </span><span class="s2">: </span><span class="s4">'hashchange'</span><span class="s2">;</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">addEventListener</span><span class="s2">(</span>
        <span class="s1">eventType</span><span class="s2">,</span>
        <span class="s1">handleRoutingEvent</span>
      <span class="s2">);</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s1">window</span><span class="s2">.</span><span class="s1">removeEventListener</span><span class="s2">(</span><span class="s1">eventType</span><span class="s2">, </span><span class="s1">handleRoutingEvent</span><span class="s2">);</span>
      <span class="s2">});</span>
    <span class="s2">};</span>

    <span class="s1">HashHistory</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">push </span><span class="s2">= </span><span class="s3">function </span><span class="s1">push </span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">onComplete</span><span class="s2">, </span><span class="s1">onAbort</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">ref </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">fromRoute </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">current</span><span class="s2">;</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">transitionTo</span><span class="s2">(</span>
        <span class="s1">location</span><span class="s2">,</span>
        <span class="s3">function </span><span class="s2">(</span><span class="s1">route</span><span class="s2">) {</span>
          <span class="s1">pushHash</span><span class="s2">(</span><span class="s1">route</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">);</span>
          <span class="s1">handleScroll</span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">router</span><span class="s2">, </span><span class="s1">route</span><span class="s2">, </span><span class="s1">fromRoute</span><span class="s2">, </span><span class="s3">false</span><span class="s2">);</span>
          <span class="s1">onComplete </span><span class="s2">&amp;&amp; </span><span class="s1">onComplete</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
        <span class="s2">},</span>
        <span class="s1">onAbort</span>
      <span class="s2">);</span>
    <span class="s2">};</span>

    <span class="s1">HashHistory</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">replace </span><span class="s2">= </span><span class="s3">function </span><span class="s1">replace </span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">onComplete</span><span class="s2">, </span><span class="s1">onAbort</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">ref </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">fromRoute </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">current</span><span class="s2">;</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">transitionTo</span><span class="s2">(</span>
        <span class="s1">location</span><span class="s2">,</span>
        <span class="s3">function </span><span class="s2">(</span><span class="s1">route</span><span class="s2">) {</span>
          <span class="s1">replaceHash</span><span class="s2">(</span><span class="s1">route</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">);</span>
          <span class="s1">handleScroll</span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">router</span><span class="s2">, </span><span class="s1">route</span><span class="s2">, </span><span class="s1">fromRoute</span><span class="s2">, </span><span class="s3">false</span><span class="s2">);</span>
          <span class="s1">onComplete </span><span class="s2">&amp;&amp; </span><span class="s1">onComplete</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
        <span class="s2">},</span>
        <span class="s1">onAbort</span>
      <span class="s2">);</span>
    <span class="s2">};</span>

    <span class="s1">HashHistory</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">go </span><span class="s2">= </span><span class="s3">function </span><span class="s1">go </span><span class="s2">(</span><span class="s1">n</span><span class="s2">) {</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">go</span><span class="s2">(</span><span class="s1">n</span><span class="s2">);</span>
    <span class="s2">};</span>

    <span class="s1">HashHistory</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">ensureURL </span><span class="s2">= </span><span class="s3">function </span><span class="s1">ensureURL </span><span class="s2">(</span><span class="s1">push</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">current </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">current</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">;</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">getHash</span><span class="s2">() !== </span><span class="s1">current</span><span class="s2">) {</span>
        <span class="s1">push </span><span class="s2">? </span><span class="s1">pushHash</span><span class="s2">(</span><span class="s1">current</span><span class="s2">) : </span><span class="s1">replaceHash</span><span class="s2">(</span><span class="s1">current</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">};</span>

    <span class="s1">HashHistory</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">getCurrentLocation </span><span class="s2">= </span><span class="s3">function </span><span class="s1">getCurrentLocation </span><span class="s2">() {</span>
      <span class="s3">return </span><span class="s1">getHash</span><span class="s2">()</span>
    <span class="s2">};</span>

    <span class="s3">return </span><span class="s1">HashHistory</span><span class="s2">;</span>
  <span class="s2">}(</span><span class="s1">History</span><span class="s2">));</span>

  <span class="s3">function </span><span class="s1">checkFallback </span><span class="s2">(</span><span class="s1">base</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">location </span><span class="s2">= </span><span class="s1">getLocation</span><span class="s2">(</span><span class="s1">base</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s5">/^\/#/</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">location</span><span class="s2">)) {</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">cleanPath</span><span class="s2">(</span><span class="s1">base </span><span class="s2">+ </span><span class="s4">'/#' </span><span class="s2">+ </span><span class="s1">location</span><span class="s2">));</span>
      <span class="s3">return true</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">ensureSlash </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s1">getHash</span><span class="s2">();</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">charAt</span><span class="s2">(</span><span class="s6">0</span><span class="s2">) === </span><span class="s4">'/'</span><span class="s2">) {</span>
      <span class="s3">return true</span>
    <span class="s2">}</span>
    <span class="s1">replaceHash</span><span class="s2">(</span><span class="s4">'/' </span><span class="s2">+ </span><span class="s1">path</span><span class="s2">);</span>
    <span class="s3">return false</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">getHash </span><span class="s2">() {</span>
    <span class="s0">// We can't use window.location.hash here because it's not</span>
    <span class="s0">// consistent across browsers - Firefox will pre-decode it!</span>
    <span class="s3">var </span><span class="s1">href </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">href</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">index </span><span class="s2">= </span><span class="s1">href</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'#'</span><span class="s2">);</span>
    <span class="s0">// empty path</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s6">0</span><span class="s2">) { </span><span class="s3">return </span><span class="s4">'' </span><span class="s2">}</span>

    <span class="s1">href </span><span class="s2">= </span><span class="s1">href</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s6">1</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">href</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">getUrl </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">href </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">href</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">href</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'#'</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">base </span><span class="s2">= </span><span class="s1">i </span><span class="s2">&gt;= </span><span class="s6">0 </span><span class="s2">? </span><span class="s1">href</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s1">i</span><span class="s2">) : </span><span class="s1">href</span><span class="s2">;</span>
    <span class="s3">return </span><span class="s2">(</span><span class="s1">base </span><span class="s2">+ </span><span class="s4">&quot;#&quot; </span><span class="s2">+ </span><span class="s1">path</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">pushHash </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">supportsPushState</span><span class="s2">) {</span>
      <span class="s1">pushState</span><span class="s2">(</span><span class="s1">getUrl</span><span class="s2">(</span><span class="s1">path</span><span class="s2">));</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">= </span><span class="s1">path</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">replaceHash </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">supportsPushState</span><span class="s2">) {</span>
      <span class="s1">replaceState</span><span class="s2">(</span><span class="s1">getUrl</span><span class="s2">(</span><span class="s1">path</span><span class="s2">));</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">getUrl</span><span class="s2">(</span><span class="s1">path</span><span class="s2">));</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s0">/*  */</span>

  <span class="s3">var </span><span class="s1">AbstractHistory </span><span class="s2">= </span><span class="s0">/*@__PURE__*/</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">History</span><span class="s2">) {</span>
    <span class="s3">function </span><span class="s1">AbstractHistory </span><span class="s2">(</span><span class="s1">router</span><span class="s2">, </span><span class="s1">base</span><span class="s2">) {</span>
      <span class="s1">History</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">router</span><span class="s2">, </span><span class="s1">base</span><span class="s2">);</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">stack </span><span class="s2">= [];</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= -</span><span class="s6">1</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">( </span><span class="s1">History </span><span class="s2">) </span><span class="s1">AbstractHistory</span><span class="s2">.</span><span class="s1">__proto__ </span><span class="s2">= </span><span class="s1">History</span><span class="s2">;</span>
    <span class="s1">AbstractHistory</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create</span><span class="s2">( </span><span class="s1">History </span><span class="s2">&amp;&amp; </span><span class="s1">History</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">);</span>
    <span class="s1">AbstractHistory</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">constructor </span><span class="s2">= </span><span class="s1">AbstractHistory</span><span class="s2">;</span>

    <span class="s1">AbstractHistory</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">push </span><span class="s2">= </span><span class="s3">function </span><span class="s1">push </span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">onComplete</span><span class="s2">, </span><span class="s1">onAbort</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">transitionTo</span><span class="s2">(</span>
        <span class="s1">location</span><span class="s2">,</span>
        <span class="s3">function </span><span class="s2">(</span><span class="s1">route</span><span class="s2">) {</span>
          <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">stack </span><span class="s2">= </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">index </span><span class="s2">+ </span><span class="s6">1</span><span class="s2">).</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
          <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">index</span><span class="s2">++;</span>
          <span class="s1">onComplete </span><span class="s2">&amp;&amp; </span><span class="s1">onComplete</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
        <span class="s2">},</span>
        <span class="s1">onAbort</span>
      <span class="s2">);</span>
    <span class="s2">};</span>

    <span class="s1">AbstractHistory</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">replace </span><span class="s2">= </span><span class="s3">function </span><span class="s1">replace </span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">onComplete</span><span class="s2">, </span><span class="s1">onAbort</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">transitionTo</span><span class="s2">(</span>
        <span class="s1">location</span><span class="s2">,</span>
        <span class="s3">function </span><span class="s2">(</span><span class="s1">route</span><span class="s2">) {</span>
          <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">stack </span><span class="s2">= </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">index</span><span class="s2">).</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
          <span class="s1">onComplete </span><span class="s2">&amp;&amp; </span><span class="s1">onComplete</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
        <span class="s2">},</span>
        <span class="s1">onAbort</span>
      <span class="s2">);</span>
    <span class="s2">};</span>

    <span class="s1">AbstractHistory</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">go </span><span class="s2">= </span><span class="s3">function </span><span class="s1">go </span><span class="s2">(</span><span class="s1">n</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">targetIndex </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">index </span><span class="s2">+ </span><span class="s1">n</span><span class="s2">;</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">targetIndex </span><span class="s2">&lt; </span><span class="s6">0 </span><span class="s2">|| </span><span class="s1">targetIndex </span><span class="s2">&gt;= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
        <span class="s3">return</span>
      <span class="s2">}</span>
      <span class="s3">var </span><span class="s1">route </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">[</span><span class="s1">targetIndex</span><span class="s2">];</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">confirmTransition</span><span class="s2">(</span>
        <span class="s1">route</span><span class="s2">,</span>
        <span class="s3">function </span><span class="s2">() {</span>
          <span class="s3">var </span><span class="s1">prev </span><span class="s2">= </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">current</span><span class="s2">;</span>
          <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">targetIndex</span><span class="s2">;</span>
          <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">updateRoute</span><span class="s2">(</span><span class="s1">route</span><span class="s2">);</span>
          <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">router</span><span class="s2">.</span><span class="s1">afterHooks</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">hook</span><span class="s2">) {</span>
            <span class="s1">hook </span><span class="s2">&amp;&amp; </span><span class="s1">hook</span><span class="s2">(</span><span class="s1">route</span><span class="s2">, </span><span class="s1">prev</span><span class="s2">);</span>
          <span class="s2">});</span>
        <span class="s2">},</span>
        <span class="s3">function </span><span class="s2">(</span><span class="s1">err</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">isNavigationFailure</span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">NavigationFailureType</span><span class="s2">.</span><span class="s1">duplicated</span><span class="s2">)) {</span>
            <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">targetIndex</span><span class="s2">;</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
      <span class="s2">);</span>
    <span class="s2">};</span>

    <span class="s1">AbstractHistory</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">getCurrentLocation </span><span class="s2">= </span><span class="s3">function </span><span class="s1">getCurrentLocation </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">current </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">[</span><span class="s3">this</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s6">1</span><span class="s2">];</span>
      <span class="s3">return </span><span class="s1">current </span><span class="s2">? </span><span class="s1">current</span><span class="s2">.</span><span class="s1">fullPath </span><span class="s2">: </span><span class="s4">'/'</span>
    <span class="s2">};</span>

    <span class="s1">AbstractHistory</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">ensureURL </span><span class="s2">= </span><span class="s3">function </span><span class="s1">ensureURL </span><span class="s2">() {</span>
      <span class="s0">// noop</span>
    <span class="s2">};</span>

    <span class="s3">return </span><span class="s1">AbstractHistory</span><span class="s2">;</span>
  <span class="s2">}(</span><span class="s1">History</span><span class="s2">));</span>

  <span class="s0">/*  */</span>



  <span class="s3">var </span><span class="s1">VueRouter </span><span class="s2">= </span><span class="s3">function </span><span class="s1">VueRouter </span><span class="s2">(</span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">( </span><span class="s1">options </span><span class="s2">=== </span><span class="s3">void </span><span class="s6">0 </span><span class="s2">) </span><span class="s1">options </span><span class="s2">= {};</span>

    <span class="s2">{</span>
      <span class="s1">warn</span><span class="s2">(</span><span class="s3">this instanceof </span><span class="s1">VueRouter</span><span class="s2">, </span><span class="s4">&quot;Router must be called with the new operator.&quot;</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">app </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">apps </span><span class="s2">= [];</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">options </span><span class="s2">= </span><span class="s1">options</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">beforeHooks </span><span class="s2">= [];</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">resolveHooks </span><span class="s2">= [];</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">afterHooks </span><span class="s2">= [];</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">matcher </span><span class="s2">= </span><span class="s1">createMatcher</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">routes </span><span class="s2">|| [], </span><span class="s3">this</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">mode </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">mode </span><span class="s2">|| </span><span class="s4">'hash'</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">fallback </span><span class="s2">=</span>
      <span class="s1">mode </span><span class="s2">=== </span><span class="s4">'history' </span><span class="s2">&amp;&amp; !</span><span class="s1">supportsPushState </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">fallback </span><span class="s2">!== </span><span class="s3">false</span><span class="s2">;</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">fallback</span><span class="s2">) {</span>
      <span class="s1">mode </span><span class="s2">= </span><span class="s4">'hash'</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">inBrowser</span><span class="s2">) {</span>
      <span class="s1">mode </span><span class="s2">= </span><span class="s4">'abstract'</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">mode </span><span class="s2">= </span><span class="s1">mode</span><span class="s2">;</span>

    <span class="s3">switch </span><span class="s2">(</span><span class="s1">mode</span><span class="s2">) {</span>
      <span class="s3">case </span><span class="s4">'history'</span><span class="s2">:</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">history </span><span class="s2">= </span><span class="s3">new </span><span class="s1">HTML5History</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">options</span><span class="s2">.</span><span class="s1">base</span><span class="s2">);</span>
        <span class="s3">break</span>
      <span class="s3">case </span><span class="s4">'hash'</span><span class="s2">:</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">history </span><span class="s2">= </span><span class="s3">new </span><span class="s1">HashHistory</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">options</span><span class="s2">.</span><span class="s1">base</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">fallback</span><span class="s2">);</span>
        <span class="s3">break</span>
      <span class="s3">case </span><span class="s4">'abstract'</span><span class="s2">:</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">history </span><span class="s2">= </span><span class="s3">new </span><span class="s1">AbstractHistory</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">options</span><span class="s2">.</span><span class="s1">base</span><span class="s2">);</span>
        <span class="s3">break</span>
      <span class="s3">default</span><span class="s2">:</span>
        <span class="s2">{</span>
          <span class="s1">assert</span><span class="s2">(</span><span class="s3">false</span><span class="s2">, (</span><span class="s4">&quot;invalid mode: &quot; </span><span class="s2">+ </span><span class="s1">mode</span><span class="s2">));</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s3">var </span><span class="s1">prototypeAccessors </span><span class="s2">= { </span><span class="s1">currentRoute</span><span class="s2">: { </span><span class="s1">configurable</span><span class="s2">: </span><span class="s3">true </span><span class="s2">} };</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">match </span><span class="s2">= </span><span class="s3">function </span><span class="s1">match </span><span class="s2">(</span><span class="s1">raw</span><span class="s2">, </span><span class="s1">current</span><span class="s2">, </span><span class="s1">redirectedFrom</span><span class="s2">) {</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">matcher</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s1">raw</span><span class="s2">, </span><span class="s1">current</span><span class="s2">, </span><span class="s1">redirectedFrom</span><span class="s2">)</span>
  <span class="s2">};</span>

  <span class="s1">prototypeAccessors</span><span class="s2">.</span><span class="s1">currentRoute</span><span class="s2">.</span><span class="s1">get </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">history </span><span class="s2">&amp;&amp; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">current</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">init </span><span class="s2">= </span><span class="s3">function </span><span class="s1">init </span><span class="s2">(</span><span class="s1">app </span><span class="s0">/* Vue component instance */</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s1">assert</span><span class="s2">(</span>
        <span class="s1">install</span><span class="s2">.</span><span class="s1">installed</span><span class="s2">,</span>
        <span class="s4">&quot;not installed. Make sure to call `Vue.use(VueRouter)` &quot; </span><span class="s2">+</span>
          <span class="s4">&quot;before creating root instance.&quot;</span>
      <span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">apps</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">app</span><span class="s2">);</span>

    <span class="s0">// set up app destroyed handler</span>
    <span class="s0">// https://github.com/vuejs/vue-router/issues/2639</span>
    <span class="s1">app</span><span class="s2">.</span><span class="s1">$once</span><span class="s2">(</span><span class="s4">'hook:destroyed'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s0">// clean out app from this.apps array once destroyed</span>
      <span class="s3">var </span><span class="s1">index </span><span class="s2">= </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">apps</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">app</span><span class="s2">);</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&gt; -</span><span class="s6">1</span><span class="s2">) { </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">apps</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s6">1</span><span class="s2">); }</span>
      <span class="s0">// ensure we still have a main app or null if no apps</span>
      <span class="s0">// we do not release the router so it can be reused</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">app </span><span class="s2">=== </span><span class="s1">app</span><span class="s2">) { </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">app </span><span class="s2">= </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">apps</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] || </span><span class="s3">null</span><span class="s2">; }</span>

      <span class="s3">if </span><span class="s2">(!</span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">app</span><span class="s2">) { </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">teardown</span><span class="s2">(); }</span>
    <span class="s2">});</span>

    <span class="s0">// main app previously initialized</span>
    <span class="s0">// return as we don't need to set up new history listener</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">app</span><span class="s2">) {</span>
      <span class="s3">return</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">app </span><span class="s2">= </span><span class="s1">app</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">history </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">history </span><span class="s3">instanceof </span><span class="s1">HTML5History </span><span class="s2">|| </span><span class="s1">history </span><span class="s3">instanceof </span><span class="s1">HashHistory</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">handleInitialScroll </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">routeOrError</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">from </span><span class="s2">= </span><span class="s1">history</span><span class="s2">.</span><span class="s1">current</span><span class="s2">;</span>
        <span class="s3">var </span><span class="s1">expectScroll </span><span class="s2">= </span><span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">scrollBehavior</span><span class="s2">;</span>
        <span class="s3">var </span><span class="s1">supportsScroll </span><span class="s2">= </span><span class="s1">supportsPushState </span><span class="s2">&amp;&amp; </span><span class="s1">expectScroll</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">supportsScroll </span><span class="s2">&amp;&amp; </span><span class="s4">'fullPath' </span><span class="s3">in </span><span class="s1">routeOrError</span><span class="s2">) {</span>
          <span class="s1">handleScroll</span><span class="s2">(</span><span class="s1">this$1$1</span><span class="s2">, </span><span class="s1">routeOrError</span><span class="s2">, </span><span class="s1">from</span><span class="s2">, </span><span class="s3">false</span><span class="s2">);</span>
        <span class="s2">}</span>
      <span class="s2">};</span>
      <span class="s3">var </span><span class="s1">setupListeners </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">routeOrError</span><span class="s2">) {</span>
        <span class="s1">history</span><span class="s2">.</span><span class="s1">setupListeners</span><span class="s2">();</span>
        <span class="s1">handleInitialScroll</span><span class="s2">(</span><span class="s1">routeOrError</span><span class="s2">);</span>
      <span class="s2">};</span>
      <span class="s1">history</span><span class="s2">.</span><span class="s1">transitionTo</span><span class="s2">(</span>
        <span class="s1">history</span><span class="s2">.</span><span class="s1">getCurrentLocation</span><span class="s2">(),</span>
        <span class="s1">setupListeners</span><span class="s2">,</span>
        <span class="s1">setupListeners</span>
      <span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">history</span><span class="s2">.</span><span class="s1">listen</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">route</span><span class="s2">) {</span>
      <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">apps</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">app</span><span class="s2">) {</span>
        <span class="s1">app</span><span class="s2">.</span><span class="s1">_route </span><span class="s2">= </span><span class="s1">route</span><span class="s2">;</span>
      <span class="s2">});</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">beforeEach </span><span class="s2">= </span><span class="s3">function </span><span class="s1">beforeEach </span><span class="s2">(</span><span class="s1">fn</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">registerHook</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">beforeHooks</span><span class="s2">, </span><span class="s1">fn</span><span class="s2">)</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">beforeResolve </span><span class="s2">= </span><span class="s3">function </span><span class="s1">beforeResolve </span><span class="s2">(</span><span class="s1">fn</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">registerHook</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">resolveHooks</span><span class="s2">, </span><span class="s1">fn</span><span class="s2">)</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">afterEach </span><span class="s2">= </span><span class="s3">function </span><span class="s1">afterEach </span><span class="s2">(</span><span class="s1">fn</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">registerHook</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">afterHooks</span><span class="s2">, </span><span class="s1">fn</span><span class="s2">)</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">onReady </span><span class="s2">= </span><span class="s3">function </span><span class="s1">onReady </span><span class="s2">(</span><span class="s1">cb</span><span class="s2">, </span><span class="s1">errorCb</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">onReady</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">, </span><span class="s1">errorCb</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">onError </span><span class="s2">= </span><span class="s3">function </span><span class="s1">onError </span><span class="s2">(</span><span class="s1">errorCb</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">onError</span><span class="s2">(</span><span class="s1">errorCb</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">push </span><span class="s2">= </span><span class="s3">function </span><span class="s1">push </span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">onComplete</span><span class="s2">, </span><span class="s1">onAbort</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s0">// $flow-disable-line</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">onComplete </span><span class="s2">&amp;&amp; !</span><span class="s1">onAbort </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">Promise </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
      <span class="s3">return new </span><span class="s1">Promise</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">resolve</span><span class="s2">, </span><span class="s1">reject</span><span class="s2">) {</span>
        <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">resolve</span><span class="s2">, </span><span class="s1">reject</span><span class="s2">);</span>
      <span class="s2">})</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">onComplete</span><span class="s2">, </span><span class="s1">onAbort</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">replace </span><span class="s2">= </span><span class="s3">function </span><span class="s1">replace </span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">onComplete</span><span class="s2">, </span><span class="s1">onAbort</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">this$1$1 </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s0">// $flow-disable-line</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">onComplete </span><span class="s2">&amp;&amp; !</span><span class="s1">onAbort </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">Promise </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
      <span class="s3">return new </span><span class="s1">Promise</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">resolve</span><span class="s2">, </span><span class="s1">reject</span><span class="s2">) {</span>
        <span class="s1">this$1$1</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">resolve</span><span class="s2">, </span><span class="s1">reject</span><span class="s2">);</span>
      <span class="s2">})</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">onComplete</span><span class="s2">, </span><span class="s1">onAbort</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">go </span><span class="s2">= </span><span class="s3">function </span><span class="s1">go </span><span class="s2">(</span><span class="s1">n</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">go</span><span class="s2">(</span><span class="s1">n</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">back </span><span class="s2">= </span><span class="s3">function </span><span class="s1">back </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">go</span><span class="s2">(-</span><span class="s6">1</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">forward </span><span class="s2">= </span><span class="s3">function </span><span class="s1">forward </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">go</span><span class="s2">(</span><span class="s6">1</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">getMatchedComponents </span><span class="s2">= </span><span class="s3">function </span><span class="s1">getMatchedComponents </span><span class="s2">(</span><span class="s1">to</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">route </span><span class="s2">= </span><span class="s1">to</span>
      <span class="s2">? </span><span class="s1">to</span><span class="s2">.</span><span class="s1">matched</span>
        <span class="s2">? </span><span class="s1">to</span>
        <span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">resolve</span><span class="s2">(</span><span class="s1">to</span><span class="s2">).</span><span class="s1">route</span>
      <span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">currentRoute</span><span class="s2">;</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">route</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s2">[]</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s2">[].</span><span class="s1">concat</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span>
      <span class="s2">[],</span>
      <span class="s1">route</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">m</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">m</span><span class="s2">.</span><span class="s1">components</span><span class="s2">).</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
          <span class="s3">return </span><span class="s1">m</span><span class="s2">.</span><span class="s1">components</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
        <span class="s2">})</span>
      <span class="s2">})</span>
    <span class="s2">)</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">resolve </span><span class="s2">= </span><span class="s3">function </span><span class="s1">resolve </span><span class="s2">(</span>
    <span class="s1">to</span><span class="s2">,</span>
    <span class="s1">current</span><span class="s2">,</span>
    <span class="s1">append</span>
  <span class="s2">) {</span>
    <span class="s1">current </span><span class="s2">= </span><span class="s1">current </span><span class="s2">|| </span><span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">current</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">location </span><span class="s2">= </span><span class="s1">normalizeLocation</span><span class="s2">(</span><span class="s1">to</span><span class="s2">, </span><span class="s1">current</span><span class="s2">, </span><span class="s1">append</span><span class="s2">, </span><span class="s3">this</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">route </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s1">location</span><span class="s2">, </span><span class="s1">current</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">fullPath </span><span class="s2">= </span><span class="s1">route</span><span class="s2">.</span><span class="s1">redirectedFrom </span><span class="s2">|| </span><span class="s1">route</span><span class="s2">.</span><span class="s1">fullPath</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">base </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">base</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">href </span><span class="s2">= </span><span class="s1">createHref</span><span class="s2">(</span><span class="s1">base</span><span class="s2">, </span><span class="s1">fullPath</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">mode</span><span class="s2">);</span>
    <span class="s3">return </span><span class="s2">{</span>
      <span class="s1">location</span><span class="s2">: </span><span class="s1">location</span><span class="s2">,</span>
      <span class="s1">route</span><span class="s2">: </span><span class="s1">route</span><span class="s2">,</span>
      <span class="s1">href</span><span class="s2">: </span><span class="s1">href</span><span class="s2">,</span>
      <span class="s0">// for backwards compat</span>
      <span class="s1">normalizedTo</span><span class="s2">: </span><span class="s1">location</span><span class="s2">,</span>
      <span class="s1">resolved</span><span class="s2">: </span><span class="s1">route</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">getRoutes </span><span class="s2">= </span><span class="s3">function </span><span class="s1">getRoutes </span><span class="s2">() {</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">matcher</span><span class="s2">.</span><span class="s1">getRoutes</span><span class="s2">()</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">addRoute </span><span class="s2">= </span><span class="s3">function </span><span class="s1">addRoute </span><span class="s2">(</span><span class="s1">parentOrRoute</span><span class="s2">, </span><span class="s1">route</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">matcher</span><span class="s2">.</span><span class="s1">addRoute</span><span class="s2">(</span><span class="s1">parentOrRoute</span><span class="s2">, </span><span class="s1">route</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">current </span><span class="s2">!== </span><span class="s1">START</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">transitionTo</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">getCurrentLocation</span><span class="s2">());</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">addRoutes </span><span class="s2">= </span><span class="s3">function </span><span class="s1">addRoutes </span><span class="s2">(</span><span class="s1">routes</span><span class="s2">) {</span>
    <span class="s2">{</span>
      <span class="s1">warn</span><span class="s2">(</span><span class="s3">false</span><span class="s2">, </span><span class="s4">'router.addRoutes() is deprecated and has been removed in Vue Router 4. Use router.addRoute() instead.'</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">matcher</span><span class="s2">.</span><span class="s1">addRoutes</span><span class="s2">(</span><span class="s1">routes</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">current </span><span class="s2">!== </span><span class="s1">START</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">transitionTo</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">history</span><span class="s2">.</span><span class="s1">getCurrentLocation</span><span class="s2">());</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">Object</span><span class="s2">.</span><span class="s1">defineProperties</span><span class="s2">( </span><span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">, </span><span class="s1">prototypeAccessors </span><span class="s2">);</span>

  <span class="s3">var </span><span class="s1">VueRouter$1 </span><span class="s2">= </span><span class="s1">VueRouter</span><span class="s2">;</span>

  <span class="s3">function </span><span class="s1">registerHook </span><span class="s2">(</span><span class="s1">list</span><span class="s2">, </span><span class="s1">fn</span><span class="s2">) {</span>
    <span class="s1">list</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">);</span>
    <span class="s3">return function </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">list</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">);</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">i </span><span class="s2">&gt; -</span><span class="s6">1</span><span class="s2">) { </span><span class="s1">list</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s6">1</span><span class="s2">); }</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">createHref </span><span class="s2">(</span><span class="s1">base</span><span class="s2">, </span><span class="s1">fullPath</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s1">mode </span><span class="s2">=== </span><span class="s4">'hash' </span><span class="s2">? </span><span class="s4">'#' </span><span class="s2">+ </span><span class="s1">fullPath </span><span class="s2">: </span><span class="s1">fullPath</span><span class="s2">;</span>
    <span class="s3">return </span><span class="s1">base </span><span class="s2">? </span><span class="s1">cleanPath</span><span class="s2">(</span><span class="s1">base </span><span class="s2">+ </span><span class="s4">'/' </span><span class="s2">+ </span><span class="s1">path</span><span class="s2">) : </span><span class="s1">path</span>
  <span class="s2">}</span>

  <span class="s0">// We cannot remove this as it would be a breaking change</span>
  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">install </span><span class="s2">= </span><span class="s1">install</span><span class="s2">;</span>
  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">version </span><span class="s2">= </span><span class="s4">'3.6.5'</span><span class="s2">;</span>
  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">isNavigationFailure </span><span class="s2">= </span><span class="s1">isNavigationFailure</span><span class="s2">;</span>
  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">NavigationFailureType </span><span class="s2">= </span><span class="s1">NavigationFailureType</span><span class="s2">;</span>
  <span class="s1">VueRouter</span><span class="s2">.</span><span class="s1">START_LOCATION </span><span class="s2">= </span><span class="s1">START</span><span class="s2">;</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">inBrowser </span><span class="s2">&amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">Vue</span><span class="s2">) {</span>
    <span class="s1">window</span><span class="s2">.</span><span class="s1">Vue</span><span class="s2">.</span><span class="s1">use</span><span class="s2">(</span><span class="s1">VueRouter</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">return </span><span class="s1">VueRouter$1</span><span class="s2">;</span>

<span class="s2">}));</span>
</pre>
</body>
</html>