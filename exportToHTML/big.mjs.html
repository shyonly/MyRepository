<html>
<head>
<title>big.mjs</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #5f826b; font-style: italic;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #2aacb8;}
.s6 { color: #6aab73;}
.s7 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
big.mjs</font>
</center></td></tr></table>
<pre><span class="s0">/* 
 *  big.js v5.2.2 
 *  A small, fast, easy-to-use library for arbitrary-precision decimal arithmetic. 
 *  Copyright (c) 2018 Michael Mclaughlin &lt;M8ch88l@gmail.com&gt; 
 *  https://github.com/MikeMcl/big.js/LICENCE 
 */</span>


<span class="s2">/************************************** EDITABLE DEFAULTS *****************************************/</span>


  <span class="s0">// The default values below must be integers within the stated ranges.</span>

  <span class="s0">/* 
   * The maximum number of decimal places (DP) of the results of operations involving division: 
   * div and sqrt, and pow with negative exponents. 
   */</span>
<span class="s3">var </span><span class="s1">DP </span><span class="s4">= </span><span class="s5">20</span><span class="s4">,          </span><span class="s0">// 0 to MAX_DP</span>

  <span class="s0">/* 
   * The rounding mode (RM) used when rounding to the above decimal places. 
   * 
   *  0  Towards zero (i.e. truncate, no rounding).       (ROUND_DOWN) 
   *  1  To nearest neighbour. If equidistant, round up.  (ROUND_HALF_UP) 
   *  2  To nearest neighbour. If equidistant, to even.   (ROUND_HALF_EVEN) 
   *  3  Away from zero.                                  (ROUND_UP) 
   */</span>
  <span class="s1">RM </span><span class="s4">= </span><span class="s5">1</span><span class="s4">,             </span><span class="s0">// 0, 1, 2 or 3</span>

  <span class="s0">// The maximum value of DP and Big.DP.</span>
  <span class="s1">MAX_DP </span><span class="s4">= </span><span class="s5">1E6</span><span class="s4">,       </span><span class="s0">// 0 to 1000000</span>

  <span class="s0">// The maximum magnitude of the exponent argument to the pow method.</span>
  <span class="s1">MAX_POWER </span><span class="s4">= </span><span class="s5">1E6</span><span class="s4">,    </span><span class="s0">// 1 to 1000000</span>

  <span class="s0">/* 
   * The negative exponent (NE) at and beneath which toString returns exponential notation. 
   * (JavaScript numbers: -7) 
   * -1000000 is the minimum recommended exponent value of a Big. 
   */</span>
  <span class="s1">NE </span><span class="s4">= -</span><span class="s5">7</span><span class="s4">,            </span><span class="s0">// 0 to -1000000</span>

  <span class="s0">/* 
   * The positive exponent (PE) at and above which toString returns exponential notation. 
   * (JavaScript numbers: 21) 
   * 1000000 is the maximum recommended exponent value of a Big. 
   * (This limit is not enforced or checked.) 
   */</span>
  <span class="s1">PE </span><span class="s4">= </span><span class="s5">21</span><span class="s4">,            </span><span class="s0">// 0 to 1000000</span>


<span class="s0">/**************************************************************************************************/</span>


  <span class="s0">// Error messages.</span>
  <span class="s1">NAME </span><span class="s4">= </span><span class="s6">'[big.js] '</span><span class="s4">,</span>
  <span class="s1">INVALID </span><span class="s4">= </span><span class="s1">NAME </span><span class="s4">+ </span><span class="s6">'Invalid '</span><span class="s4">,</span>
  <span class="s1">INVALID_DP </span><span class="s4">= </span><span class="s1">INVALID </span><span class="s4">+ </span><span class="s6">'decimal places'</span><span class="s4">,</span>
  <span class="s1">INVALID_RM </span><span class="s4">= </span><span class="s1">INVALID </span><span class="s4">+ </span><span class="s6">'rounding mode'</span><span class="s4">,</span>
  <span class="s1">DIV_BY_ZERO </span><span class="s4">= </span><span class="s1">NAME </span><span class="s4">+ </span><span class="s6">'Division by zero'</span><span class="s4">,</span>

  <span class="s0">// The shared prototype object.</span>
  <span class="s1">P </span><span class="s4">= {},</span>
  <span class="s1">UNDEFINED </span><span class="s4">= </span><span class="s3">void </span><span class="s5">0</span><span class="s4">,</span>
  <span class="s1">NUMERIC </span><span class="s4">= </span><span class="s7">/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i</span><span class="s4">;</span>


<span class="s0">/* 
 * Create and return a Big constructor. 
 * 
 */</span>
<span class="s3">function </span><span class="s1">_Big_</span><span class="s4">() {</span>

  <span class="s0">/* 
   * The Big constructor and exported function. 
   * Create and return a new instance of a Big number object. 
   * 
   * n {number|string|Big} A numeric value. 
   */</span>
  <span class="s3">function </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">n</span><span class="s4">) {</span>
    <span class="s3">var </span><span class="s1">x </span><span class="s4">= </span><span class="s3">this</span><span class="s4">;</span>

    <span class="s0">// Enable constructor usage without new.</span>
    <span class="s3">if </span><span class="s4">(!(</span><span class="s1">x </span><span class="s3">instanceof </span><span class="s1">Big</span><span class="s4">)) </span><span class="s3">return </span><span class="s1">n </span><span class="s4">=== </span><span class="s1">UNDEFINED </span><span class="s4">? </span><span class="s1">_Big_</span><span class="s4">() : </span><span class="s3">new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">n</span><span class="s4">);</span>

    <span class="s0">// Duplicate.</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s1">n </span><span class="s3">instanceof </span><span class="s1">Big</span><span class="s4">) {</span>
      <span class="s1">x</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= </span><span class="s1">n</span><span class="s4">.</span><span class="s1">s</span><span class="s4">;</span>
      <span class="s1">x</span><span class="s4">.</span><span class="s1">e </span><span class="s4">= </span><span class="s1">n</span><span class="s4">.</span><span class="s1">e</span><span class="s4">;</span>
      <span class="s1">x</span><span class="s4">.</span><span class="s1">c </span><span class="s4">= </span><span class="s1">n</span><span class="s4">.</span><span class="s1">c</span><span class="s4">.</span><span class="s1">slice</span><span class="s4">();</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s1">parse</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, </span><span class="s1">n</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s0">/* 
     * Retain a reference to this Big constructor, and shadow Big.prototype.constructor which 
     * points to Object. 
     */</span>
    <span class="s1">x</span><span class="s4">.</span><span class="s1">constructor </span><span class="s4">= </span><span class="s1">Big</span><span class="s4">;</span>
  <span class="s4">}</span>

  <span class="s1">Big</span><span class="s4">.</span><span class="s1">prototype </span><span class="s4">= </span><span class="s1">P</span><span class="s4">;</span>
  <span class="s1">Big</span><span class="s4">.</span><span class="s1">DP </span><span class="s4">= </span><span class="s1">DP</span><span class="s4">;</span>
  <span class="s1">Big</span><span class="s4">.</span><span class="s1">RM </span><span class="s4">= </span><span class="s1">RM</span><span class="s4">;</span>
  <span class="s1">Big</span><span class="s4">.</span><span class="s1">NE </span><span class="s4">= </span><span class="s1">NE</span><span class="s4">;</span>
  <span class="s1">Big</span><span class="s4">.</span><span class="s1">PE </span><span class="s4">= </span><span class="s1">PE</span><span class="s4">;</span>
  <span class="s1">Big</span><span class="s4">.</span><span class="s1">version </span><span class="s4">= </span><span class="s6">'5.2.2'</span><span class="s4">;</span>

  <span class="s3">return </span><span class="s1">Big</span><span class="s4">;</span>
<span class="s4">}</span>


<span class="s0">/* 
 * Parse the number or string value passed to a Big constructor. 
 * 
 * x {Big} A Big number instance. 
 * n {number|string} A numeric value. 
 */</span>
<span class="s3">function </span><span class="s1">parse</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, </span><span class="s1">n</span><span class="s4">) {</span>
  <span class="s3">var </span><span class="s1">e</span><span class="s4">, </span><span class="s1">i</span><span class="s4">, </span><span class="s1">nl</span><span class="s4">;</span>

  <span class="s0">// Minus zero?</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">n </span><span class="s4">=== </span><span class="s5">0 </span><span class="s4">&amp;&amp; </span><span class="s5">1 </span><span class="s4">/ </span><span class="s1">n </span><span class="s4">&lt; </span><span class="s5">0</span><span class="s4">) </span><span class="s1">n </span><span class="s4">= </span><span class="s6">'-0'</span><span class="s4">;</span>
  <span class="s3">else if </span><span class="s4">(!</span><span class="s1">NUMERIC</span><span class="s4">.</span><span class="s1">test</span><span class="s4">(</span><span class="s1">n </span><span class="s4">+= </span><span class="s6">''</span><span class="s4">)) </span><span class="s3">throw </span><span class="s1">Error</span><span class="s4">(</span><span class="s1">INVALID </span><span class="s4">+ </span><span class="s6">'number'</span><span class="s4">);</span>

  <span class="s0">// Determine sign.</span>
  <span class="s1">x</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= </span><span class="s1">n</span><span class="s4">.</span><span class="s1">charAt</span><span class="s4">(</span><span class="s5">0</span><span class="s4">) == </span><span class="s6">'-' </span><span class="s4">? (</span><span class="s1">n </span><span class="s4">= </span><span class="s1">n</span><span class="s4">.</span><span class="s1">slice</span><span class="s4">(</span><span class="s5">1</span><span class="s4">), -</span><span class="s5">1</span><span class="s4">) : </span><span class="s5">1</span><span class="s4">;</span>

  <span class="s0">// Decimal point?</span>
  <span class="s3">if </span><span class="s4">((</span><span class="s1">e </span><span class="s4">= </span><span class="s1">n</span><span class="s4">.</span><span class="s1">indexOf</span><span class="s4">(</span><span class="s6">'.'</span><span class="s4">)) &gt; -</span><span class="s5">1</span><span class="s4">) </span><span class="s1">n </span><span class="s4">= </span><span class="s1">n</span><span class="s4">.</span><span class="s1">replace</span><span class="s4">(</span><span class="s6">'.'</span><span class="s4">, </span><span class="s6">''</span><span class="s4">);</span>

  <span class="s0">// Exponential form?</span>
  <span class="s3">if </span><span class="s4">((</span><span class="s1">i </span><span class="s4">= </span><span class="s1">n</span><span class="s4">.</span><span class="s1">search</span><span class="s4">(</span><span class="s7">/e/i</span><span class="s4">)) &gt; </span><span class="s5">0</span><span class="s4">) {</span>

    <span class="s0">// Determine exponent.</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s1">e </span><span class="s4">&lt; </span><span class="s5">0</span><span class="s4">) </span><span class="s1">e </span><span class="s4">= </span><span class="s1">i</span><span class="s4">;</span>
    <span class="s1">e </span><span class="s4">+= +</span><span class="s1">n</span><span class="s4">.</span><span class="s1">slice</span><span class="s4">(</span><span class="s1">i </span><span class="s4">+ </span><span class="s5">1</span><span class="s4">);</span>
    <span class="s1">n </span><span class="s4">= </span><span class="s1">n</span><span class="s4">.</span><span class="s1">substring</span><span class="s4">(</span><span class="s5">0</span><span class="s4">, </span><span class="s1">i</span><span class="s4">);</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s1">e </span><span class="s4">&lt; </span><span class="s5">0</span><span class="s4">) {</span>

    <span class="s0">// Integer.</span>
    <span class="s1">e </span><span class="s4">= </span><span class="s1">n</span><span class="s4">.</span><span class="s1">length</span><span class="s4">;</span>
  <span class="s4">}</span>

  <span class="s1">nl </span><span class="s4">= </span><span class="s1">n</span><span class="s4">.</span><span class="s1">length</span><span class="s4">;</span>

  <span class="s0">// Determine leading zeros.</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s1">i </span><span class="s4">= </span><span class="s5">0</span><span class="s4">; </span><span class="s1">i </span><span class="s4">&lt; </span><span class="s1">nl </span><span class="s4">&amp;&amp; </span><span class="s1">n</span><span class="s4">.</span><span class="s1">charAt</span><span class="s4">(</span><span class="s1">i</span><span class="s4">) == </span><span class="s6">'0'</span><span class="s4">;) ++</span><span class="s1">i</span><span class="s4">;</span>

  <span class="s3">if </span><span class="s4">(</span><span class="s1">i </span><span class="s4">== </span><span class="s1">nl</span><span class="s4">) {</span>

    <span class="s0">// Zero.</span>
    <span class="s1">x</span><span class="s4">.</span><span class="s1">c </span><span class="s4">= [</span><span class="s1">x</span><span class="s4">.</span><span class="s1">e </span><span class="s4">= </span><span class="s5">0</span><span class="s4">];</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>

    <span class="s0">// Determine trailing zeros.</span>
    <span class="s3">for </span><span class="s4">(; </span><span class="s1">nl </span><span class="s4">&gt; </span><span class="s5">0 </span><span class="s4">&amp;&amp; </span><span class="s1">n</span><span class="s4">.</span><span class="s1">charAt</span><span class="s4">(--</span><span class="s1">nl</span><span class="s4">) == </span><span class="s6">'0'</span><span class="s4">;);</span>
    <span class="s1">x</span><span class="s4">.</span><span class="s1">e </span><span class="s4">= </span><span class="s1">e </span><span class="s4">- </span><span class="s1">i </span><span class="s4">- </span><span class="s5">1</span><span class="s4">;</span>
    <span class="s1">x</span><span class="s4">.</span><span class="s1">c </span><span class="s4">= [];</span>

    <span class="s0">// Convert string to array of digits without leading/trailing zeros.</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s1">e </span><span class="s4">= </span><span class="s5">0</span><span class="s4">; </span><span class="s1">i </span><span class="s4">&lt;= </span><span class="s1">nl</span><span class="s4">;) </span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">[</span><span class="s1">e</span><span class="s4">++] = +</span><span class="s1">n</span><span class="s4">.</span><span class="s1">charAt</span><span class="s4">(</span><span class="s1">i</span><span class="s4">++);</span>
  <span class="s4">}</span>

  <span class="s3">return </span><span class="s1">x</span><span class="s4">;</span>
<span class="s4">}</span>


<span class="s0">/* 
 * Round Big x to a maximum of dp decimal places using rounding mode rm. 
 * Called by stringify, P.div, P.round and P.sqrt. 
 * 
 * x {Big} The Big to round. 
 * dp {number} Integer, 0 to MAX_DP inclusive. 
 * rm {number} 0, 1, 2 or 3 (DOWN, HALF_UP, HALF_EVEN, UP) 
 * [more] {boolean} Whether the result of division was truncated. 
 */</span>
<span class="s3">function </span><span class="s1">round</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, </span><span class="s1">dp</span><span class="s4">, </span><span class="s1">rm</span><span class="s4">, </span><span class="s1">more</span><span class="s4">) {</span>
  <span class="s3">var </span><span class="s1">xc </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">,</span>
    <span class="s1">i </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">e </span><span class="s4">+ </span><span class="s1">dp </span><span class="s4">+ </span><span class="s5">1</span><span class="s4">;</span>

  <span class="s3">if </span><span class="s4">(</span><span class="s1">i </span><span class="s4">&lt; </span><span class="s1">xc</span><span class="s4">.</span><span class="s1">length</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s1">rm </span><span class="s4">=== </span><span class="s5">1</span><span class="s4">) {</span>

      <span class="s0">// xc[i] is the digit after the digit that may be rounded up.</span>
      <span class="s1">more </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">] &gt;= </span><span class="s5">5</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s1">rm </span><span class="s4">=== </span><span class="s5">2</span><span class="s4">) {</span>
      <span class="s1">more </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">] &gt; </span><span class="s5">5 </span><span class="s4">|| </span><span class="s1">xc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">] == </span><span class="s5">5 </span><span class="s4">&amp;&amp;</span>
        <span class="s4">(</span><span class="s1">more </span><span class="s4">|| </span><span class="s1">i </span><span class="s4">&lt; </span><span class="s5">0 </span><span class="s4">|| </span><span class="s1">xc</span><span class="s4">[</span><span class="s1">i </span><span class="s4">+ </span><span class="s5">1</span><span class="s4">] !== </span><span class="s1">UNDEFINED </span><span class="s4">|| </span><span class="s1">xc</span><span class="s4">[</span><span class="s1">i </span><span class="s4">- </span><span class="s5">1</span><span class="s4">] &amp; </span><span class="s5">1</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s1">rm </span><span class="s4">=== </span><span class="s5">3</span><span class="s4">) {</span>
      <span class="s1">more </span><span class="s4">= </span><span class="s1">more </span><span class="s4">|| !!</span><span class="s1">xc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">];</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s1">more </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s1">rm </span><span class="s4">!== </span><span class="s5">0</span><span class="s4">) </span><span class="s3">throw </span><span class="s1">Error</span><span class="s4">(</span><span class="s1">INVALID_RM</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s3">if </span><span class="s4">(</span><span class="s1">i </span><span class="s4">&lt; </span><span class="s5">1</span><span class="s4">) {</span>
      <span class="s1">xc</span><span class="s4">.</span><span class="s1">length </span><span class="s4">= </span><span class="s5">1</span><span class="s4">;</span>

      <span class="s3">if </span><span class="s4">(</span><span class="s1">more</span><span class="s4">) {</span>

        <span class="s0">// 1, 0.1, 0.01, 0.001, 0.0001 etc.</span>
        <span class="s1">x</span><span class="s4">.</span><span class="s1">e </span><span class="s4">= -</span><span class="s1">dp</span><span class="s4">;</span>
        <span class="s1">xc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] = </span><span class="s5">1</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>

        <span class="s0">// Zero.</span>
        <span class="s1">xc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] = </span><span class="s1">x</span><span class="s4">.</span><span class="s1">e </span><span class="s4">= </span><span class="s5">0</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>

      <span class="s0">// Remove any digits after the required decimal places.</span>
      <span class="s1">xc</span><span class="s4">.</span><span class="s1">length </span><span class="s4">= </span><span class="s1">i</span><span class="s4">--;</span>

      <span class="s0">// Round up?</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s1">more</span><span class="s4">) {</span>

        <span class="s0">// Rounding up may mean the previous digit has to be rounded up.</span>
        <span class="s3">for </span><span class="s4">(; ++</span><span class="s1">xc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">] &gt; </span><span class="s5">9</span><span class="s4">;) {</span>
          <span class="s1">xc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">] = </span><span class="s5">0</span><span class="s4">;</span>
          <span class="s3">if </span><span class="s4">(!</span><span class="s1">i</span><span class="s4">--) {</span>
            <span class="s4">++</span><span class="s1">x</span><span class="s4">.</span><span class="s1">e</span><span class="s4">;</span>
            <span class="s1">xc</span><span class="s4">.</span><span class="s1">unshift</span><span class="s4">(</span><span class="s5">1</span><span class="s4">);</span>
          <span class="s4">}</span>
        <span class="s4">}</span>
      <span class="s4">}</span>

      <span class="s0">// Remove trailing zeros.</span>
      <span class="s3">for </span><span class="s4">(</span><span class="s1">i </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">.</span><span class="s1">length</span><span class="s4">; !</span><span class="s1">xc</span><span class="s4">[--</span><span class="s1">i</span><span class="s4">];) </span><span class="s1">xc</span><span class="s4">.</span><span class="s1">pop</span><span class="s4">();</span>
    <span class="s4">}</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s1">rm </span><span class="s4">&lt; </span><span class="s5">0 </span><span class="s4">|| </span><span class="s1">rm </span><span class="s4">&gt; </span><span class="s5">3 </span><span class="s4">|| </span><span class="s1">rm </span><span class="s4">!== ~~</span><span class="s1">rm</span><span class="s4">) {</span>
    <span class="s3">throw </span><span class="s1">Error</span><span class="s4">(</span><span class="s1">INVALID_RM</span><span class="s4">);</span>
  <span class="s4">}</span>

  <span class="s3">return </span><span class="s1">x</span><span class="s4">;</span>
<span class="s4">}</span>


<span class="s0">/* 
 * Return a string representing the value of Big x in normal or exponential notation. 
 * Handles P.toExponential, P.toFixed, P.toJSON, P.toPrecision, P.toString and P.valueOf. 
 * 
 * x {Big} 
 * id? {number} Caller id. 
 *         1 toExponential 
 *         2 toFixed 
 *         3 toPrecision 
 *         4 valueOf 
 * n? {number|undefined} Caller's argument. 
 * k? {number|undefined} 
 */</span>
<span class="s3">function </span><span class="s1">stringify</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, </span><span class="s1">id</span><span class="s4">, </span><span class="s1">n</span><span class="s4">, </span><span class="s1">k</span><span class="s4">) {</span>
  <span class="s3">var </span><span class="s1">e</span><span class="s4">, </span><span class="s1">s</span><span class="s4">,</span>
    <span class="s1">Big </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">constructor</span><span class="s4">,</span>
    <span class="s1">z </span><span class="s4">= !</span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">[</span><span class="s5">0</span><span class="s4">];</span>

  <span class="s3">if </span><span class="s4">(</span><span class="s1">n </span><span class="s4">!== </span><span class="s1">UNDEFINED</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s1">n </span><span class="s4">!== ~~</span><span class="s1">n </span><span class="s4">|| </span><span class="s1">n </span><span class="s4">&lt; (</span><span class="s1">id </span><span class="s4">== </span><span class="s5">3</span><span class="s4">) || </span><span class="s1">n </span><span class="s4">&gt; </span><span class="s1">MAX_DP</span><span class="s4">) {</span>
      <span class="s3">throw </span><span class="s1">Error</span><span class="s4">(</span><span class="s1">id </span><span class="s4">== </span><span class="s5">3 </span><span class="s4">? </span><span class="s1">INVALID </span><span class="s4">+ </span><span class="s6">'precision' </span><span class="s4">: </span><span class="s1">INVALID_DP</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s1">x </span><span class="s4">= </span><span class="s3">new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">x</span><span class="s4">);</span>

    <span class="s0">// The index of the digit that may be rounded up.</span>
    <span class="s1">n </span><span class="s4">= </span><span class="s1">k </span><span class="s4">- </span><span class="s1">x</span><span class="s4">.</span><span class="s1">e</span><span class="s4">;</span>

    <span class="s0">// Round?</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">.</span><span class="s1">length </span><span class="s4">&gt; ++</span><span class="s1">k</span><span class="s4">) </span><span class="s1">round</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, </span><span class="s1">n</span><span class="s4">, </span><span class="s1">Big</span><span class="s4">.</span><span class="s1">RM</span><span class="s4">);</span>

    <span class="s0">// toFixed: recalculate k as x.e may have changed if value rounded up.</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s1">id </span><span class="s4">== </span><span class="s5">2</span><span class="s4">) </span><span class="s1">k </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">e </span><span class="s4">+ </span><span class="s1">n </span><span class="s4">+ </span><span class="s5">1</span><span class="s4">;</span>

    <span class="s0">// Append zeros?</span>
    <span class="s3">for </span><span class="s4">(; </span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">.</span><span class="s1">length </span><span class="s4">&lt; </span><span class="s1">k</span><span class="s4">;) </span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">.</span><span class="s1">push</span><span class="s4">(</span><span class="s5">0</span><span class="s4">);</span>
  <span class="s4">}</span>

  <span class="s1">e </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">e</span><span class="s4">;</span>
  <span class="s1">s </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s6">''</span><span class="s4">);</span>
  <span class="s1">n </span><span class="s4">= </span><span class="s1">s</span><span class="s4">.</span><span class="s1">length</span><span class="s4">;</span>

  <span class="s0">// Exponential notation?</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">id </span><span class="s4">!= </span><span class="s5">2 </span><span class="s4">&amp;&amp; (</span><span class="s1">id </span><span class="s4">== </span><span class="s5">1 </span><span class="s4">|| </span><span class="s1">id </span><span class="s4">== </span><span class="s5">3 </span><span class="s4">&amp;&amp; </span><span class="s1">k </span><span class="s4">&lt;= </span><span class="s1">e </span><span class="s4">|| </span><span class="s1">e </span><span class="s4">&lt;= </span><span class="s1">Big</span><span class="s4">.</span><span class="s1">NE </span><span class="s4">|| </span><span class="s1">e </span><span class="s4">&gt;= </span><span class="s1">Big</span><span class="s4">.</span><span class="s1">PE</span><span class="s4">)) {</span>
    <span class="s1">s </span><span class="s4">= </span><span class="s1">s</span><span class="s4">.</span><span class="s1">charAt</span><span class="s4">(</span><span class="s5">0</span><span class="s4">) + (</span><span class="s1">n </span><span class="s4">&gt; </span><span class="s5">1 </span><span class="s4">? </span><span class="s6">'.' </span><span class="s4">+ </span><span class="s1">s</span><span class="s4">.</span><span class="s1">slice</span><span class="s4">(</span><span class="s5">1</span><span class="s4">) : </span><span class="s6">''</span><span class="s4">) + (</span><span class="s1">e </span><span class="s4">&lt; </span><span class="s5">0 </span><span class="s4">? </span><span class="s6">'e' </span><span class="s4">: </span><span class="s6">'e+'</span><span class="s4">) + </span><span class="s1">e</span><span class="s4">;</span>

  <span class="s0">// Normal notation.</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s1">e </span><span class="s4">&lt; </span><span class="s5">0</span><span class="s4">) {</span>
    <span class="s3">for </span><span class="s4">(; ++</span><span class="s1">e</span><span class="s4">;) </span><span class="s1">s </span><span class="s4">= </span><span class="s6">'0' </span><span class="s4">+ </span><span class="s1">s</span><span class="s4">;</span>
    <span class="s1">s </span><span class="s4">= </span><span class="s6">'0.' </span><span class="s4">+ </span><span class="s1">s</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s1">e </span><span class="s4">&gt; </span><span class="s5">0</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(++</span><span class="s1">e </span><span class="s4">&gt; </span><span class="s1">n</span><span class="s4">) </span><span class="s3">for </span><span class="s4">(</span><span class="s1">e </span><span class="s4">-= </span><span class="s1">n</span><span class="s4">; </span><span class="s1">e</span><span class="s4">--;) </span><span class="s1">s </span><span class="s4">+= </span><span class="s6">'0'</span><span class="s4">;</span>
    <span class="s3">else if </span><span class="s4">(</span><span class="s1">e </span><span class="s4">&lt; </span><span class="s1">n</span><span class="s4">) </span><span class="s1">s </span><span class="s4">= </span><span class="s1">s</span><span class="s4">.</span><span class="s1">slice</span><span class="s4">(</span><span class="s5">0</span><span class="s4">, </span><span class="s1">e</span><span class="s4">) + </span><span class="s6">'.' </span><span class="s4">+ </span><span class="s1">s</span><span class="s4">.</span><span class="s1">slice</span><span class="s4">(</span><span class="s1">e</span><span class="s4">);</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s1">n </span><span class="s4">&gt; </span><span class="s5">1</span><span class="s4">) {</span>
    <span class="s1">s </span><span class="s4">= </span><span class="s1">s</span><span class="s4">.</span><span class="s1">charAt</span><span class="s4">(</span><span class="s5">0</span><span class="s4">) + </span><span class="s6">'.' </span><span class="s4">+ </span><span class="s1">s</span><span class="s4">.</span><span class="s1">slice</span><span class="s4">(</span><span class="s5">1</span><span class="s4">);</span>
  <span class="s4">}</span>

  <span class="s3">return </span><span class="s1">x</span><span class="s4">.</span><span class="s1">s </span><span class="s4">&lt; </span><span class="s5">0 </span><span class="s4">&amp;&amp; (!</span><span class="s1">z </span><span class="s4">|| </span><span class="s1">id </span><span class="s4">== </span><span class="s5">4</span><span class="s4">) ? </span><span class="s6">'-' </span><span class="s4">+ </span><span class="s1">s </span><span class="s4">: </span><span class="s1">s</span><span class="s4">;</span>
<span class="s4">}</span>


<span class="s0">// Prototype/instance methods</span>


<span class="s0">/* 
 * Return a new Big whose value is the absolute value of this Big. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">abs </span><span class="s4">= </span><span class="s3">function </span><span class="s4">() {</span>
  <span class="s3">var </span><span class="s1">x </span><span class="s4">= </span><span class="s3">new this</span><span class="s4">.</span><span class="s1">constructor</span><span class="s4">(</span><span class="s3">this</span><span class="s4">);</span>
  <span class="s1">x</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= </span><span class="s5">1</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s1">x</span><span class="s4">;</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return 1 if the value of this Big is greater than the value of Big y, 
 *       -1 if the value of this Big is less than the value of Big y, or 
 *        0 if they have the same value. 
*/</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">cmp </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">y</span><span class="s4">) {</span>
  <span class="s3">var </span><span class="s1">isneg</span><span class="s4">,</span>
    <span class="s1">x </span><span class="s4">= </span><span class="s3">this</span><span class="s4">,</span>
    <span class="s1">xc </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">,</span>
    <span class="s1">yc </span><span class="s4">= (</span><span class="s1">y </span><span class="s4">= </span><span class="s3">new </span><span class="s1">x</span><span class="s4">.</span><span class="s1">constructor</span><span class="s4">(</span><span class="s1">y</span><span class="s4">)).</span><span class="s1">c</span><span class="s4">,</span>
    <span class="s1">i </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">s</span><span class="s4">,</span>
    <span class="s1">j </span><span class="s4">= </span><span class="s1">y</span><span class="s4">.</span><span class="s1">s</span><span class="s4">,</span>
    <span class="s1">k </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">e</span><span class="s4">,</span>
    <span class="s1">l </span><span class="s4">= </span><span class="s1">y</span><span class="s4">.</span><span class="s1">e</span><span class="s4">;</span>

  <span class="s0">// Either zero?</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s1">xc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] || !</span><span class="s1">yc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]) </span><span class="s3">return </span><span class="s4">!</span><span class="s1">xc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] ? !</span><span class="s1">yc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] ? </span><span class="s5">0 </span><span class="s4">: -</span><span class="s1">j </span><span class="s4">: </span><span class="s1">i</span><span class="s4">;</span>

  <span class="s0">// Signs differ?</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">i </span><span class="s4">!= </span><span class="s1">j</span><span class="s4">) </span><span class="s3">return </span><span class="s1">i</span><span class="s4">;</span>

  <span class="s1">isneg </span><span class="s4">= </span><span class="s1">i </span><span class="s4">&lt; </span><span class="s5">0</span><span class="s4">;</span>

  <span class="s0">// Compare exponents.</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">k </span><span class="s4">!= </span><span class="s1">l</span><span class="s4">) </span><span class="s3">return </span><span class="s1">k </span><span class="s4">&gt; </span><span class="s1">l </span><span class="s4">^ </span><span class="s1">isneg </span><span class="s4">? </span><span class="s5">1 </span><span class="s4">: -</span><span class="s5">1</span><span class="s4">;</span>

  <span class="s1">j </span><span class="s4">= (</span><span class="s1">k </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">.</span><span class="s1">length</span><span class="s4">) &lt; (</span><span class="s1">l </span><span class="s4">= </span><span class="s1">yc</span><span class="s4">.</span><span class="s1">length</span><span class="s4">) ? </span><span class="s1">k </span><span class="s4">: </span><span class="s1">l</span><span class="s4">;</span>

  <span class="s0">// Compare digit by digit.</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s1">i </span><span class="s4">= -</span><span class="s5">1</span><span class="s4">; ++</span><span class="s1">i </span><span class="s4">&lt; </span><span class="s1">j</span><span class="s4">;) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s1">xc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">] != </span><span class="s1">yc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">]) </span><span class="s3">return </span><span class="s1">xc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">] &gt; </span><span class="s1">yc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">] ^ </span><span class="s1">isneg </span><span class="s4">? </span><span class="s5">1 </span><span class="s4">: -</span><span class="s5">1</span><span class="s4">;</span>
  <span class="s4">}</span>

  <span class="s0">// Compare lengths.</span>
  <span class="s3">return </span><span class="s1">k </span><span class="s4">== </span><span class="s1">l </span><span class="s4">? </span><span class="s5">0 </span><span class="s4">: </span><span class="s1">k </span><span class="s4">&gt; </span><span class="s1">l </span><span class="s4">^ </span><span class="s1">isneg </span><span class="s4">? </span><span class="s5">1 </span><span class="s4">: -</span><span class="s5">1</span><span class="s4">;</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return a new Big whose value is the value of this Big divided by the value of Big y, rounded, 
 * if necessary, to a maximum of Big.DP decimal places using rounding mode Big.RM. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">div </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">y</span><span class="s4">) {</span>
  <span class="s3">var </span><span class="s1">x </span><span class="s4">= </span><span class="s3">this</span><span class="s4">,</span>
    <span class="s1">Big </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">constructor</span><span class="s4">,</span>
    <span class="s1">a </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">,                  </span><span class="s0">// dividend</span>
    <span class="s1">b </span><span class="s4">= (</span><span class="s1">y </span><span class="s4">= </span><span class="s3">new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">y</span><span class="s4">)).</span><span class="s1">c</span><span class="s4">,   </span><span class="s0">// divisor</span>
    <span class="s1">k </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">s </span><span class="s4">== </span><span class="s1">y</span><span class="s4">.</span><span class="s1">s </span><span class="s4">? </span><span class="s5">1 </span><span class="s4">: -</span><span class="s5">1</span><span class="s4">,</span>
    <span class="s1">dp </span><span class="s4">= </span><span class="s1">Big</span><span class="s4">.</span><span class="s1">DP</span><span class="s4">;</span>

  <span class="s3">if </span><span class="s4">(</span><span class="s1">dp </span><span class="s4">!== ~~</span><span class="s1">dp </span><span class="s4">|| </span><span class="s1">dp </span><span class="s4">&lt; </span><span class="s5">0 </span><span class="s4">|| </span><span class="s1">dp </span><span class="s4">&gt; </span><span class="s1">MAX_DP</span><span class="s4">) </span><span class="s3">throw </span><span class="s1">Error</span><span class="s4">(</span><span class="s1">INVALID_DP</span><span class="s4">);</span>

  <span class="s0">// Divisor is zero?</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s1">b</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]) </span><span class="s3">throw </span><span class="s1">Error</span><span class="s4">(</span><span class="s1">DIV_BY_ZERO</span><span class="s4">);</span>

  <span class="s0">// Dividend is 0? Return +-0.</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s1">a</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]) </span><span class="s3">return new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">k </span><span class="s4">* </span><span class="s5">0</span><span class="s4">);</span>

  <span class="s3">var </span><span class="s1">bl</span><span class="s4">, </span><span class="s1">bt</span><span class="s4">, </span><span class="s1">n</span><span class="s4">, </span><span class="s1">cmp</span><span class="s4">, </span><span class="s1">ri</span><span class="s4">,</span>
    <span class="s1">bz </span><span class="s4">= </span><span class="s1">b</span><span class="s4">.</span><span class="s1">slice</span><span class="s4">(),</span>
    <span class="s1">ai </span><span class="s4">= </span><span class="s1">bl </span><span class="s4">= </span><span class="s1">b</span><span class="s4">.</span><span class="s1">length</span><span class="s4">,</span>
    <span class="s1">al </span><span class="s4">= </span><span class="s1">a</span><span class="s4">.</span><span class="s1">length</span><span class="s4">,</span>
    <span class="s1">r </span><span class="s4">= </span><span class="s1">a</span><span class="s4">.</span><span class="s1">slice</span><span class="s4">(</span><span class="s5">0</span><span class="s4">, </span><span class="s1">bl</span><span class="s4">),   </span><span class="s0">// remainder</span>
    <span class="s1">rl </span><span class="s4">= </span><span class="s1">r</span><span class="s4">.</span><span class="s1">length</span><span class="s4">,</span>
    <span class="s1">q </span><span class="s4">= </span><span class="s1">y</span><span class="s4">,                </span><span class="s0">// quotient</span>
    <span class="s1">qc </span><span class="s4">= </span><span class="s1">q</span><span class="s4">.</span><span class="s1">c </span><span class="s4">= [],</span>
    <span class="s1">qi </span><span class="s4">= </span><span class="s5">0</span><span class="s4">,</span>
    <span class="s1">d </span><span class="s4">= </span><span class="s1">dp </span><span class="s4">+ (</span><span class="s1">q</span><span class="s4">.</span><span class="s1">e </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">e </span><span class="s4">- </span><span class="s1">y</span><span class="s4">.</span><span class="s1">e</span><span class="s4">) + </span><span class="s5">1</span><span class="s4">;    </span><span class="s0">// number of digits of the result</span>

  <span class="s1">q</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= </span><span class="s1">k</span><span class="s4">;</span>
  <span class="s1">k </span><span class="s4">= </span><span class="s1">d </span><span class="s4">&lt; </span><span class="s5">0 </span><span class="s4">? </span><span class="s5">0 </span><span class="s4">: </span><span class="s1">d</span><span class="s4">;</span>

  <span class="s0">// Create version of divisor with leading zero.</span>
  <span class="s1">bz</span><span class="s4">.</span><span class="s1">unshift</span><span class="s4">(</span><span class="s5">0</span><span class="s4">);</span>

  <span class="s0">// Add zeros to make remainder as long as divisor.</span>
  <span class="s3">for </span><span class="s4">(; </span><span class="s1">rl</span><span class="s4">++ &lt; </span><span class="s1">bl</span><span class="s4">;) </span><span class="s1">r</span><span class="s4">.</span><span class="s1">push</span><span class="s4">(</span><span class="s5">0</span><span class="s4">);</span>

  <span class="s3">do </span><span class="s4">{</span>

    <span class="s0">// n is how many times the divisor goes into current remainder.</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s1">n </span><span class="s4">= </span><span class="s5">0</span><span class="s4">; </span><span class="s1">n </span><span class="s4">&lt; </span><span class="s5">10</span><span class="s4">; </span><span class="s1">n</span><span class="s4">++) {</span>

      <span class="s0">// Compare divisor and remainder.</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s1">bl </span><span class="s4">!= (</span><span class="s1">rl </span><span class="s4">= </span><span class="s1">r</span><span class="s4">.</span><span class="s1">length</span><span class="s4">)) {</span>
        <span class="s1">cmp </span><span class="s4">= </span><span class="s1">bl </span><span class="s4">&gt; </span><span class="s1">rl </span><span class="s4">? </span><span class="s5">1 </span><span class="s4">: -</span><span class="s5">1</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">for </span><span class="s4">(</span><span class="s1">ri </span><span class="s4">= -</span><span class="s5">1</span><span class="s4">, </span><span class="s1">cmp </span><span class="s4">= </span><span class="s5">0</span><span class="s4">; ++</span><span class="s1">ri </span><span class="s4">&lt; </span><span class="s1">bl</span><span class="s4">;) {</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s1">b</span><span class="s4">[</span><span class="s1">ri</span><span class="s4">] != </span><span class="s1">r</span><span class="s4">[</span><span class="s1">ri</span><span class="s4">]) {</span>
            <span class="s1">cmp </span><span class="s4">= </span><span class="s1">b</span><span class="s4">[</span><span class="s1">ri</span><span class="s4">] &gt; </span><span class="s1">r</span><span class="s4">[</span><span class="s1">ri</span><span class="s4">] ? </span><span class="s5">1 </span><span class="s4">: -</span><span class="s5">1</span><span class="s4">;</span>
            <span class="s3">break</span><span class="s4">;</span>
          <span class="s4">}</span>
        <span class="s4">}</span>
      <span class="s4">}</span>

      <span class="s0">// If divisor &lt; remainder, subtract divisor from remainder.</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s1">cmp </span><span class="s4">&lt; </span><span class="s5">0</span><span class="s4">) {</span>

        <span class="s0">// Remainder can't be more than 1 digit longer than divisor.</span>
        <span class="s0">// Equalise lengths using divisor with extra leading zero?</span>
        <span class="s3">for </span><span class="s4">(</span><span class="s1">bt </span><span class="s4">= </span><span class="s1">rl </span><span class="s4">== </span><span class="s1">bl </span><span class="s4">? </span><span class="s1">b </span><span class="s4">: </span><span class="s1">bz</span><span class="s4">; </span><span class="s1">rl</span><span class="s4">;) {</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s1">r</span><span class="s4">[--</span><span class="s1">rl</span><span class="s4">] &lt; </span><span class="s1">bt</span><span class="s4">[</span><span class="s1">rl</span><span class="s4">]) {</span>
            <span class="s1">ri </span><span class="s4">= </span><span class="s1">rl</span><span class="s4">;</span>
            <span class="s3">for </span><span class="s4">(; </span><span class="s1">ri </span><span class="s4">&amp;&amp; !</span><span class="s1">r</span><span class="s4">[--</span><span class="s1">ri</span><span class="s4">];) </span><span class="s1">r</span><span class="s4">[</span><span class="s1">ri</span><span class="s4">] = </span><span class="s5">9</span><span class="s4">;</span>
            <span class="s4">--</span><span class="s1">r</span><span class="s4">[</span><span class="s1">ri</span><span class="s4">];</span>
            <span class="s1">r</span><span class="s4">[</span><span class="s1">rl</span><span class="s4">] += </span><span class="s5">10</span><span class="s4">;</span>
          <span class="s4">}</span>
          <span class="s1">r</span><span class="s4">[</span><span class="s1">rl</span><span class="s4">] -= </span><span class="s1">bt</span><span class="s4">[</span><span class="s1">rl</span><span class="s4">];</span>
        <span class="s4">}</span>

        <span class="s3">for </span><span class="s4">(; !</span><span class="s1">r</span><span class="s4">[</span><span class="s5">0</span><span class="s4">];) </span><span class="s1">r</span><span class="s4">.</span><span class="s1">shift</span><span class="s4">();</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">break</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s0">// Add the digit n to the result array.</span>
    <span class="s1">qc</span><span class="s4">[</span><span class="s1">qi</span><span class="s4">++] = </span><span class="s1">cmp </span><span class="s4">? </span><span class="s1">n </span><span class="s4">: ++</span><span class="s1">n</span><span class="s4">;</span>

    <span class="s0">// Update the remainder.</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s1">r</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] &amp;&amp; </span><span class="s1">cmp</span><span class="s4">) </span><span class="s1">r</span><span class="s4">[</span><span class="s1">rl</span><span class="s4">] = </span><span class="s1">a</span><span class="s4">[</span><span class="s1">ai</span><span class="s4">] || </span><span class="s5">0</span><span class="s4">;</span>
    <span class="s3">else </span><span class="s1">r </span><span class="s4">= [</span><span class="s1">a</span><span class="s4">[</span><span class="s1">ai</span><span class="s4">]];</span>

  <span class="s4">} </span><span class="s3">while </span><span class="s4">((</span><span class="s1">ai</span><span class="s4">++ &lt; </span><span class="s1">al </span><span class="s4">|| </span><span class="s1">r</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] !== </span><span class="s1">UNDEFINED</span><span class="s4">) &amp;&amp; </span><span class="s1">k</span><span class="s4">--);</span>

  <span class="s0">// Leading zero? Do not remove if result is simply zero (qi == 1).</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s1">qc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] &amp;&amp; </span><span class="s1">qi </span><span class="s4">!= </span><span class="s5">1</span><span class="s4">) {</span>

    <span class="s0">// There can't be more than one zero.</span>
    <span class="s1">qc</span><span class="s4">.</span><span class="s1">shift</span><span class="s4">();</span>
    <span class="s1">q</span><span class="s4">.</span><span class="s1">e</span><span class="s4">--;</span>
  <span class="s4">}</span>

  <span class="s0">// Round?</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">qi </span><span class="s4">&gt; </span><span class="s1">d</span><span class="s4">) </span><span class="s1">round</span><span class="s4">(</span><span class="s1">q</span><span class="s4">, </span><span class="s1">dp</span><span class="s4">, </span><span class="s1">Big</span><span class="s4">.</span><span class="s1">RM</span><span class="s4">, </span><span class="s1">r</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] !== </span><span class="s1">UNDEFINED</span><span class="s4">);</span>

  <span class="s3">return </span><span class="s1">q</span><span class="s4">;</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return true if the value of this Big is equal to the value of Big y, otherwise return false. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">eq </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">y</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s4">!</span><span class="s3">this</span><span class="s4">.</span><span class="s1">cmp</span><span class="s4">(</span><span class="s1">y</span><span class="s4">);</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return true if the value of this Big is greater than the value of Big y, otherwise return 
 * false. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">gt </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">y</span><span class="s4">) {</span>
  <span class="s3">return this</span><span class="s4">.</span><span class="s1">cmp</span><span class="s4">(</span><span class="s1">y</span><span class="s4">) &gt; </span><span class="s5">0</span><span class="s4">;</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return true if the value of this Big is greater than or equal to the value of Big y, otherwise 
 * return false. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">gte </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">y</span><span class="s4">) {</span>
  <span class="s3">return this</span><span class="s4">.</span><span class="s1">cmp</span><span class="s4">(</span><span class="s1">y</span><span class="s4">) &gt; -</span><span class="s5">1</span><span class="s4">;</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return true if the value of this Big is less than the value of Big y, otherwise return false. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">lt </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">y</span><span class="s4">) {</span>
  <span class="s3">return this</span><span class="s4">.</span><span class="s1">cmp</span><span class="s4">(</span><span class="s1">y</span><span class="s4">) &lt; </span><span class="s5">0</span><span class="s4">;</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return true if the value of this Big is less than or equal to the value of Big y, otherwise 
 * return false. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">lte </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">y</span><span class="s4">) {</span>
  <span class="s3">return this</span><span class="s4">.</span><span class="s1">cmp</span><span class="s4">(</span><span class="s1">y</span><span class="s4">) &lt; </span><span class="s5">1</span><span class="s4">;</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return a new Big whose value is the value of this Big minus the value of Big y. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">minus </span><span class="s4">= </span><span class="s1">P</span><span class="s4">.</span><span class="s1">sub </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">y</span><span class="s4">) {</span>
  <span class="s3">var </span><span class="s1">i</span><span class="s4">, </span><span class="s1">j</span><span class="s4">, </span><span class="s1">t</span><span class="s4">, </span><span class="s1">xlty</span><span class="s4">,</span>
    <span class="s1">x </span><span class="s4">= </span><span class="s3">this</span><span class="s4">,</span>
    <span class="s1">Big </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">constructor</span><span class="s4">,</span>
    <span class="s1">a </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">s</span><span class="s4">,</span>
    <span class="s1">b </span><span class="s4">= (</span><span class="s1">y </span><span class="s4">= </span><span class="s3">new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">y</span><span class="s4">)).</span><span class="s1">s</span><span class="s4">;</span>

  <span class="s0">// Signs differ?</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">a </span><span class="s4">!= </span><span class="s1">b</span><span class="s4">) {</span>
    <span class="s1">y</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= -</span><span class="s1">b</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s1">x</span><span class="s4">.</span><span class="s1">plus</span><span class="s4">(</span><span class="s1">y</span><span class="s4">);</span>
  <span class="s4">}</span>

  <span class="s3">var </span><span class="s1">xc </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">.</span><span class="s1">slice</span><span class="s4">(),</span>
    <span class="s1">xe </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">e</span><span class="s4">,</span>
    <span class="s1">yc </span><span class="s4">= </span><span class="s1">y</span><span class="s4">.</span><span class="s1">c</span><span class="s4">,</span>
    <span class="s1">ye </span><span class="s4">= </span><span class="s1">y</span><span class="s4">.</span><span class="s1">e</span><span class="s4">;</span>

  <span class="s0">// Either zero?</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s1">xc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] || !</span><span class="s1">yc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]) {</span>

    <span class="s0">// y is non-zero? x is non-zero? Or both are zero.</span>
    <span class="s3">return </span><span class="s1">yc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] ? (</span><span class="s1">y</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= -</span><span class="s1">b</span><span class="s4">, </span><span class="s1">y</span><span class="s4">) : </span><span class="s3">new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">xc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] ? </span><span class="s1">x </span><span class="s4">: </span><span class="s5">0</span><span class="s4">);</span>
  <span class="s4">}</span>

  <span class="s0">// Determine which is the bigger number. Prepend zeros to equalise exponents.</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">a </span><span class="s4">= </span><span class="s1">xe </span><span class="s4">- </span><span class="s1">ye</span><span class="s4">) {</span>

    <span class="s3">if </span><span class="s4">(</span><span class="s1">xlty </span><span class="s4">= </span><span class="s1">a </span><span class="s4">&lt; </span><span class="s5">0</span><span class="s4">) {</span>
      <span class="s1">a </span><span class="s4">= -</span><span class="s1">a</span><span class="s4">;</span>
      <span class="s1">t </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s1">ye </span><span class="s4">= </span><span class="s1">xe</span><span class="s4">;</span>
      <span class="s1">t </span><span class="s4">= </span><span class="s1">yc</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s1">t</span><span class="s4">.</span><span class="s1">reverse</span><span class="s4">();</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s1">b </span><span class="s4">= </span><span class="s1">a</span><span class="s4">; </span><span class="s1">b</span><span class="s4">--;) </span><span class="s1">t</span><span class="s4">.</span><span class="s1">push</span><span class="s4">(</span><span class="s5">0</span><span class="s4">);</span>
    <span class="s1">t</span><span class="s4">.</span><span class="s1">reverse</span><span class="s4">();</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>

    <span class="s0">// Exponents equal. Check digit by digit.</span>
    <span class="s1">j </span><span class="s4">= ((</span><span class="s1">xlty </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">.</span><span class="s1">length </span><span class="s4">&lt; </span><span class="s1">yc</span><span class="s4">.</span><span class="s1">length</span><span class="s4">) ? </span><span class="s1">xc </span><span class="s4">: </span><span class="s1">yc</span><span class="s4">).</span><span class="s1">length</span><span class="s4">;</span>

    <span class="s3">for </span><span class="s4">(</span><span class="s1">a </span><span class="s4">= </span><span class="s1">b </span><span class="s4">= </span><span class="s5">0</span><span class="s4">; </span><span class="s1">b </span><span class="s4">&lt; </span><span class="s1">j</span><span class="s4">; </span><span class="s1">b</span><span class="s4">++) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s1">xc</span><span class="s4">[</span><span class="s1">b</span><span class="s4">] != </span><span class="s1">yc</span><span class="s4">[</span><span class="s1">b</span><span class="s4">]) {</span>
        <span class="s1">xlty </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">[</span><span class="s1">b</span><span class="s4">] &lt; </span><span class="s1">yc</span><span class="s4">[</span><span class="s1">b</span><span class="s4">];</span>
        <span class="s3">break</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">}</span>

  <span class="s0">// x &lt; y? Point xc to the array of the bigger number.</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">xlty</span><span class="s4">) {</span>
    <span class="s1">t </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">;</span>
    <span class="s1">xc </span><span class="s4">= </span><span class="s1">yc</span><span class="s4">;</span>
    <span class="s1">yc </span><span class="s4">= </span><span class="s1">t</span><span class="s4">;</span>
    <span class="s1">y</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= -</span><span class="s1">y</span><span class="s4">.</span><span class="s1">s</span><span class="s4">;</span>
  <span class="s4">}</span>

  <span class="s0">/* 
   * Append zeros to xc if shorter. No need to add zeros to yc if shorter as subtraction only 
   * needs to start at yc.length. 
   */</span>
  <span class="s3">if </span><span class="s4">((</span><span class="s1">b </span><span class="s4">= (</span><span class="s1">j </span><span class="s4">= </span><span class="s1">yc</span><span class="s4">.</span><span class="s1">length</span><span class="s4">) - (</span><span class="s1">i </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">.</span><span class="s1">length</span><span class="s4">)) &gt; </span><span class="s5">0</span><span class="s4">) </span><span class="s3">for </span><span class="s4">(; </span><span class="s1">b</span><span class="s4">--;) </span><span class="s1">xc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">++] = </span><span class="s5">0</span><span class="s4">;</span>

  <span class="s0">// Subtract yc from xc.</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s1">b </span><span class="s4">= </span><span class="s1">i</span><span class="s4">; </span><span class="s1">j </span><span class="s4">&gt; </span><span class="s1">a</span><span class="s4">;) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s1">xc</span><span class="s4">[--</span><span class="s1">j</span><span class="s4">] &lt; </span><span class="s1">yc</span><span class="s4">[</span><span class="s1">j</span><span class="s4">]) {</span>
      <span class="s3">for </span><span class="s4">(</span><span class="s1">i </span><span class="s4">= </span><span class="s1">j</span><span class="s4">; </span><span class="s1">i </span><span class="s4">&amp;&amp; !</span><span class="s1">xc</span><span class="s4">[--</span><span class="s1">i</span><span class="s4">];) </span><span class="s1">xc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">] = </span><span class="s5">9</span><span class="s4">;</span>
      <span class="s4">--</span><span class="s1">xc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">];</span>
      <span class="s1">xc</span><span class="s4">[</span><span class="s1">j</span><span class="s4">] += </span><span class="s5">10</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s1">xc</span><span class="s4">[</span><span class="s1">j</span><span class="s4">] -= </span><span class="s1">yc</span><span class="s4">[</span><span class="s1">j</span><span class="s4">];</span>
  <span class="s4">}</span>

  <span class="s0">// Remove trailing zeros.</span>
  <span class="s3">for </span><span class="s4">(; </span><span class="s1">xc</span><span class="s4">[--</span><span class="s1">b</span><span class="s4">] === </span><span class="s5">0</span><span class="s4">;) </span><span class="s1">xc</span><span class="s4">.</span><span class="s1">pop</span><span class="s4">();</span>

  <span class="s0">// Remove leading zeros and adjust exponent accordingly.</span>
  <span class="s3">for </span><span class="s4">(; </span><span class="s1">xc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] === </span><span class="s5">0</span><span class="s4">;) {</span>
    <span class="s1">xc</span><span class="s4">.</span><span class="s1">shift</span><span class="s4">();</span>
    <span class="s4">--</span><span class="s1">ye</span><span class="s4">;</span>
  <span class="s4">}</span>

  <span class="s3">if </span><span class="s4">(!</span><span class="s1">xc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]) {</span>

    <span class="s0">// n - n = +0</span>
    <span class="s1">y</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= </span><span class="s5">1</span><span class="s4">;</span>

    <span class="s0">// Result must be zero.</span>
    <span class="s1">xc </span><span class="s4">= [</span><span class="s1">ye </span><span class="s4">= </span><span class="s5">0</span><span class="s4">];</span>
  <span class="s4">}</span>

  <span class="s1">y</span><span class="s4">.</span><span class="s1">c </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">;</span>
  <span class="s1">y</span><span class="s4">.</span><span class="s1">e </span><span class="s4">= </span><span class="s1">ye</span><span class="s4">;</span>

  <span class="s3">return </span><span class="s1">y</span><span class="s4">;</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return a new Big whose value is the value of this Big modulo the value of Big y. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">mod </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">y</span><span class="s4">) {</span>
  <span class="s3">var </span><span class="s1">ygtx</span><span class="s4">,</span>
    <span class="s1">x </span><span class="s4">= </span><span class="s3">this</span><span class="s4">,</span>
    <span class="s1">Big </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">constructor</span><span class="s4">,</span>
    <span class="s1">a </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">s</span><span class="s4">,</span>
    <span class="s1">b </span><span class="s4">= (</span><span class="s1">y </span><span class="s4">= </span><span class="s3">new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">y</span><span class="s4">)).</span><span class="s1">s</span><span class="s4">;</span>

  <span class="s3">if </span><span class="s4">(!</span><span class="s1">y</span><span class="s4">.</span><span class="s1">c</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]) </span><span class="s3">throw </span><span class="s1">Error</span><span class="s4">(</span><span class="s1">DIV_BY_ZERO</span><span class="s4">);</span>

  <span class="s1">x</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= </span><span class="s1">y</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= </span><span class="s5">1</span><span class="s4">;</span>
  <span class="s1">ygtx </span><span class="s4">= </span><span class="s1">y</span><span class="s4">.</span><span class="s1">cmp</span><span class="s4">(</span><span class="s1">x</span><span class="s4">) == </span><span class="s5">1</span><span class="s4">;</span>
  <span class="s1">x</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= </span><span class="s1">a</span><span class="s4">;</span>
  <span class="s1">y</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= </span><span class="s1">b</span><span class="s4">;</span>

  <span class="s3">if </span><span class="s4">(</span><span class="s1">ygtx</span><span class="s4">) </span><span class="s3">return new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">x</span><span class="s4">);</span>

  <span class="s1">a </span><span class="s4">= </span><span class="s1">Big</span><span class="s4">.</span><span class="s1">DP</span><span class="s4">;</span>
  <span class="s1">b </span><span class="s4">= </span><span class="s1">Big</span><span class="s4">.</span><span class="s1">RM</span><span class="s4">;</span>
  <span class="s1">Big</span><span class="s4">.</span><span class="s1">DP </span><span class="s4">= </span><span class="s1">Big</span><span class="s4">.</span><span class="s1">RM </span><span class="s4">= </span><span class="s5">0</span><span class="s4">;</span>
  <span class="s1">x </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">div</span><span class="s4">(</span><span class="s1">y</span><span class="s4">);</span>
  <span class="s1">Big</span><span class="s4">.</span><span class="s1">DP </span><span class="s4">= </span><span class="s1">a</span><span class="s4">;</span>
  <span class="s1">Big</span><span class="s4">.</span><span class="s1">RM </span><span class="s4">= </span><span class="s1">b</span><span class="s4">;</span>

  <span class="s3">return this</span><span class="s4">.</span><span class="s1">minus</span><span class="s4">(</span><span class="s1">x</span><span class="s4">.</span><span class="s1">times</span><span class="s4">(</span><span class="s1">y</span><span class="s4">));</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return a new Big whose value is the value of this Big plus the value of Big y. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">plus </span><span class="s4">= </span><span class="s1">P</span><span class="s4">.</span><span class="s1">add </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">y</span><span class="s4">) {</span>
  <span class="s3">var </span><span class="s1">t</span><span class="s4">,</span>
    <span class="s1">x </span><span class="s4">= </span><span class="s3">this</span><span class="s4">,</span>
    <span class="s1">Big </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">constructor</span><span class="s4">,</span>
    <span class="s1">a </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">s</span><span class="s4">,</span>
    <span class="s1">b </span><span class="s4">= (</span><span class="s1">y </span><span class="s4">= </span><span class="s3">new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">y</span><span class="s4">)).</span><span class="s1">s</span><span class="s4">;</span>

  <span class="s0">// Signs differ?</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">a </span><span class="s4">!= </span><span class="s1">b</span><span class="s4">) {</span>
    <span class="s1">y</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= -</span><span class="s1">b</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s1">x</span><span class="s4">.</span><span class="s1">minus</span><span class="s4">(</span><span class="s1">y</span><span class="s4">);</span>
  <span class="s4">}</span>

  <span class="s3">var </span><span class="s1">xe </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">e</span><span class="s4">,</span>
    <span class="s1">xc </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">,</span>
    <span class="s1">ye </span><span class="s4">= </span><span class="s1">y</span><span class="s4">.</span><span class="s1">e</span><span class="s4">,</span>
    <span class="s1">yc </span><span class="s4">= </span><span class="s1">y</span><span class="s4">.</span><span class="s1">c</span><span class="s4">;</span>

  <span class="s0">// Either zero? y is non-zero? x is non-zero? Or both are zero.</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s1">xc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] || !</span><span class="s1">yc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]) </span><span class="s3">return </span><span class="s1">yc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] ? </span><span class="s1">y </span><span class="s4">: </span><span class="s3">new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">xc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] ? </span><span class="s1">x </span><span class="s4">: </span><span class="s1">a </span><span class="s4">* </span><span class="s5">0</span><span class="s4">);</span>

  <span class="s1">xc </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">.</span><span class="s1">slice</span><span class="s4">();</span>

  <span class="s0">// Prepend zeros to equalise exponents.</span>
  <span class="s0">// Note: reverse faster than unshifts.</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">a </span><span class="s4">= </span><span class="s1">xe </span><span class="s4">- </span><span class="s1">ye</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s1">a </span><span class="s4">&gt; </span><span class="s5">0</span><span class="s4">) {</span>
      <span class="s1">ye </span><span class="s4">= </span><span class="s1">xe</span><span class="s4">;</span>
      <span class="s1">t </span><span class="s4">= </span><span class="s1">yc</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s1">a </span><span class="s4">= -</span><span class="s1">a</span><span class="s4">;</span>
      <span class="s1">t </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s1">t</span><span class="s4">.</span><span class="s1">reverse</span><span class="s4">();</span>
    <span class="s3">for </span><span class="s4">(; </span><span class="s1">a</span><span class="s4">--;) </span><span class="s1">t</span><span class="s4">.</span><span class="s1">push</span><span class="s4">(</span><span class="s5">0</span><span class="s4">);</span>
    <span class="s1">t</span><span class="s4">.</span><span class="s1">reverse</span><span class="s4">();</span>
  <span class="s4">}</span>

  <span class="s0">// Point xc to the longer array.</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">xc</span><span class="s4">.</span><span class="s1">length </span><span class="s4">- </span><span class="s1">yc</span><span class="s4">.</span><span class="s1">length </span><span class="s4">&lt; </span><span class="s5">0</span><span class="s4">) {</span>
    <span class="s1">t </span><span class="s4">= </span><span class="s1">yc</span><span class="s4">;</span>
    <span class="s1">yc </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">;</span>
    <span class="s1">xc </span><span class="s4">= </span><span class="s1">t</span><span class="s4">;</span>
  <span class="s4">}</span>

  <span class="s1">a </span><span class="s4">= </span><span class="s1">yc</span><span class="s4">.</span><span class="s1">length</span><span class="s4">;</span>

  <span class="s0">// Only start adding at yc.length - 1 as the further digits of xc can be left as they are.</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s1">b </span><span class="s4">= </span><span class="s5">0</span><span class="s4">; </span><span class="s1">a</span><span class="s4">; </span><span class="s1">xc</span><span class="s4">[</span><span class="s1">a</span><span class="s4">] %= </span><span class="s5">10</span><span class="s4">) </span><span class="s1">b </span><span class="s4">= (</span><span class="s1">xc</span><span class="s4">[--</span><span class="s1">a</span><span class="s4">] = </span><span class="s1">xc</span><span class="s4">[</span><span class="s1">a</span><span class="s4">] + </span><span class="s1">yc</span><span class="s4">[</span><span class="s1">a</span><span class="s4">] + </span><span class="s1">b</span><span class="s4">) / </span><span class="s5">10 </span><span class="s4">| </span><span class="s5">0</span><span class="s4">;</span>

  <span class="s0">// No need to check for zero, as +x + +y != 0 &amp;&amp; -x + -y != 0</span>

  <span class="s3">if </span><span class="s4">(</span><span class="s1">b</span><span class="s4">) {</span>
    <span class="s1">xc</span><span class="s4">.</span><span class="s1">unshift</span><span class="s4">(</span><span class="s1">b</span><span class="s4">);</span>
    <span class="s4">++</span><span class="s1">ye</span><span class="s4">;</span>
  <span class="s4">}</span>

  <span class="s0">// Remove trailing zeros.</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s1">a </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">.</span><span class="s1">length</span><span class="s4">; </span><span class="s1">xc</span><span class="s4">[--</span><span class="s1">a</span><span class="s4">] === </span><span class="s5">0</span><span class="s4">;) </span><span class="s1">xc</span><span class="s4">.</span><span class="s1">pop</span><span class="s4">();</span>

  <span class="s1">y</span><span class="s4">.</span><span class="s1">c </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">;</span>
  <span class="s1">y</span><span class="s4">.</span><span class="s1">e </span><span class="s4">= </span><span class="s1">ye</span><span class="s4">;</span>

  <span class="s3">return </span><span class="s1">y</span><span class="s4">;</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return a Big whose value is the value of this Big raised to the power n. 
 * If n is negative, round to a maximum of Big.DP decimal places using rounding 
 * mode Big.RM. 
 * 
 * n {number} Integer, -MAX_POWER to MAX_POWER inclusive. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">pow </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">n</span><span class="s4">) {</span>
  <span class="s3">var </span><span class="s1">x </span><span class="s4">= </span><span class="s3">this</span><span class="s4">,</span>
    <span class="s1">one </span><span class="s4">= </span><span class="s3">new </span><span class="s1">x</span><span class="s4">.</span><span class="s1">constructor</span><span class="s4">(</span><span class="s5">1</span><span class="s4">),</span>
    <span class="s1">y </span><span class="s4">= </span><span class="s1">one</span><span class="s4">,</span>
    <span class="s1">isneg </span><span class="s4">= </span><span class="s1">n </span><span class="s4">&lt; </span><span class="s5">0</span><span class="s4">;</span>

  <span class="s3">if </span><span class="s4">(</span><span class="s1">n </span><span class="s4">!== ~~</span><span class="s1">n </span><span class="s4">|| </span><span class="s1">n </span><span class="s4">&lt; -</span><span class="s1">MAX_POWER </span><span class="s4">|| </span><span class="s1">n </span><span class="s4">&gt; </span><span class="s1">MAX_POWER</span><span class="s4">) </span><span class="s3">throw </span><span class="s1">Error</span><span class="s4">(</span><span class="s1">INVALID </span><span class="s4">+ </span><span class="s6">'exponent'</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">isneg</span><span class="s4">) </span><span class="s1">n </span><span class="s4">= -</span><span class="s1">n</span><span class="s4">;</span>

  <span class="s3">for </span><span class="s4">(;;) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s1">n </span><span class="s4">&amp; </span><span class="s5">1</span><span class="s4">) </span><span class="s1">y </span><span class="s4">= </span><span class="s1">y</span><span class="s4">.</span><span class="s1">times</span><span class="s4">(</span><span class="s1">x</span><span class="s4">);</span>
    <span class="s1">n </span><span class="s4">&gt;&gt;= </span><span class="s5">1</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s1">n</span><span class="s4">) </span><span class="s3">break</span><span class="s4">;</span>
    <span class="s1">x </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">times</span><span class="s4">(</span><span class="s1">x</span><span class="s4">);</span>
  <span class="s4">}</span>

  <span class="s3">return </span><span class="s1">isneg </span><span class="s4">? </span><span class="s1">one</span><span class="s4">.</span><span class="s1">div</span><span class="s4">(</span><span class="s1">y</span><span class="s4">) : </span><span class="s1">y</span><span class="s4">;</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return a new Big whose value is the value of this Big rounded using rounding mode rm 
 * to a maximum of dp decimal places, or, if dp is negative, to an integer which is a 
 * multiple of 10**-dp. 
 * If dp is not specified, round to 0 decimal places. 
 * If rm is not specified, use Big.RM. 
 * 
 * dp? {number} Integer, -MAX_DP to MAX_DP inclusive. 
 * rm? 0, 1, 2 or 3 (ROUND_DOWN, ROUND_HALF_UP, ROUND_HALF_EVEN, ROUND_UP) 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">round </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">dp</span><span class="s4">, </span><span class="s1">rm</span><span class="s4">) {</span>
  <span class="s3">var </span><span class="s1">Big </span><span class="s4">= </span><span class="s3">this</span><span class="s4">.</span><span class="s1">constructor</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">dp </span><span class="s4">=== </span><span class="s1">UNDEFINED</span><span class="s4">) </span><span class="s1">dp </span><span class="s4">= </span><span class="s5">0</span><span class="s4">;</span>
  <span class="s3">else if </span><span class="s4">(</span><span class="s1">dp </span><span class="s4">!== ~~</span><span class="s1">dp </span><span class="s4">|| </span><span class="s1">dp </span><span class="s4">&lt; -</span><span class="s1">MAX_DP </span><span class="s4">|| </span><span class="s1">dp </span><span class="s4">&gt; </span><span class="s1">MAX_DP</span><span class="s4">) </span><span class="s3">throw </span><span class="s1">Error</span><span class="s4">(</span><span class="s1">INVALID_DP</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s1">round</span><span class="s4">(</span><span class="s3">new </span><span class="s1">Big</span><span class="s4">(</span><span class="s3">this</span><span class="s4">), </span><span class="s1">dp</span><span class="s4">, </span><span class="s1">rm </span><span class="s4">=== </span><span class="s1">UNDEFINED </span><span class="s4">? </span><span class="s1">Big</span><span class="s4">.</span><span class="s1">RM </span><span class="s4">: </span><span class="s1">rm</span><span class="s4">);</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return a new Big whose value is the square root of the value of this Big, rounded, if 
 * necessary, to a maximum of Big.DP decimal places using rounding mode Big.RM. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">sqrt </span><span class="s4">= </span><span class="s3">function </span><span class="s4">() {</span>
  <span class="s3">var </span><span class="s1">r</span><span class="s4">, </span><span class="s1">c</span><span class="s4">, </span><span class="s1">t</span><span class="s4">,</span>
    <span class="s1">x </span><span class="s4">= </span><span class="s3">this</span><span class="s4">,</span>
    <span class="s1">Big </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">constructor</span><span class="s4">,</span>
    <span class="s1">s </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">s</span><span class="s4">,</span>
    <span class="s1">e </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">e</span><span class="s4">,</span>
    <span class="s1">half </span><span class="s4">= </span><span class="s3">new </span><span class="s1">Big</span><span class="s4">(</span><span class="s5">0.5</span><span class="s4">);</span>

  <span class="s0">// Zero?</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]) </span><span class="s3">return new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">x</span><span class="s4">);</span>

  <span class="s0">// Negative?</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">s </span><span class="s4">&lt; </span><span class="s5">0</span><span class="s4">) </span><span class="s3">throw </span><span class="s1">Error</span><span class="s4">(</span><span class="s1">NAME </span><span class="s4">+ </span><span class="s6">'No square root'</span><span class="s4">);</span>

  <span class="s0">// Estimate.</span>
  <span class="s1">s </span><span class="s4">= </span><span class="s1">Math</span><span class="s4">.</span><span class="s1">sqrt</span><span class="s4">(</span><span class="s1">x </span><span class="s4">+ </span><span class="s6">''</span><span class="s4">);</span>

  <span class="s0">// Math.sqrt underflow/overflow?</span>
  <span class="s0">// Re-estimate: pass x coefficient to Math.sqrt as integer, then adjust the result exponent.</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">s </span><span class="s4">=== </span><span class="s5">0 </span><span class="s4">|| </span><span class="s1">s </span><span class="s4">=== </span><span class="s5">1 </span><span class="s4">/ </span><span class="s5">0</span><span class="s4">) {</span>
    <span class="s1">c </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s6">''</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(!(</span><span class="s1">c</span><span class="s4">.</span><span class="s1">length </span><span class="s4">+ </span><span class="s1">e </span><span class="s4">&amp; </span><span class="s5">1</span><span class="s4">)) </span><span class="s1">c </span><span class="s4">+= </span><span class="s6">'0'</span><span class="s4">;</span>
    <span class="s1">s </span><span class="s4">= </span><span class="s1">Math</span><span class="s4">.</span><span class="s1">sqrt</span><span class="s4">(</span><span class="s1">c</span><span class="s4">);</span>
    <span class="s1">e </span><span class="s4">= ((</span><span class="s1">e </span><span class="s4">+ </span><span class="s5">1</span><span class="s4">) / </span><span class="s5">2 </span><span class="s4">| </span><span class="s5">0</span><span class="s4">) - (</span><span class="s1">e </span><span class="s4">&lt; </span><span class="s5">0 </span><span class="s4">|| </span><span class="s1">e </span><span class="s4">&amp; </span><span class="s5">1</span><span class="s4">);</span>
    <span class="s1">r </span><span class="s4">= </span><span class="s3">new </span><span class="s1">Big</span><span class="s4">((</span><span class="s1">s </span><span class="s4">== </span><span class="s5">1 </span><span class="s4">/ </span><span class="s5">0 </span><span class="s4">? </span><span class="s6">'1e' </span><span class="s4">: (</span><span class="s1">s </span><span class="s4">= </span><span class="s1">s</span><span class="s4">.</span><span class="s1">toExponential</span><span class="s4">()).</span><span class="s1">slice</span><span class="s4">(</span><span class="s5">0</span><span class="s4">, </span><span class="s1">s</span><span class="s4">.</span><span class="s1">indexOf</span><span class="s4">(</span><span class="s6">'e'</span><span class="s4">) + </span><span class="s5">1</span><span class="s4">)) + </span><span class="s1">e</span><span class="s4">);</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s1">r </span><span class="s4">= </span><span class="s3">new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">s</span><span class="s4">);</span>
  <span class="s4">}</span>

  <span class="s1">e </span><span class="s4">= </span><span class="s1">r</span><span class="s4">.</span><span class="s1">e </span><span class="s4">+ (</span><span class="s1">Big</span><span class="s4">.</span><span class="s1">DP </span><span class="s4">+= </span><span class="s5">4</span><span class="s4">);</span>

  <span class="s0">// Newton-Raphson iteration.</span>
  <span class="s3">do </span><span class="s4">{</span>
    <span class="s1">t </span><span class="s4">= </span><span class="s1">r</span><span class="s4">;</span>
    <span class="s1">r </span><span class="s4">= </span><span class="s1">half</span><span class="s4">.</span><span class="s1">times</span><span class="s4">(</span><span class="s1">t</span><span class="s4">.</span><span class="s1">plus</span><span class="s4">(</span><span class="s1">x</span><span class="s4">.</span><span class="s1">div</span><span class="s4">(</span><span class="s1">t</span><span class="s4">)));</span>
  <span class="s4">} </span><span class="s3">while </span><span class="s4">(</span><span class="s1">t</span><span class="s4">.</span><span class="s1">c</span><span class="s4">.</span><span class="s1">slice</span><span class="s4">(</span><span class="s5">0</span><span class="s4">, </span><span class="s1">e</span><span class="s4">).</span><span class="s1">join</span><span class="s4">(</span><span class="s6">''</span><span class="s4">) !== </span><span class="s1">r</span><span class="s4">.</span><span class="s1">c</span><span class="s4">.</span><span class="s1">slice</span><span class="s4">(</span><span class="s5">0</span><span class="s4">, </span><span class="s1">e</span><span class="s4">).</span><span class="s1">join</span><span class="s4">(</span><span class="s6">''</span><span class="s4">));</span>

  <span class="s3">return </span><span class="s1">round</span><span class="s4">(</span><span class="s1">r</span><span class="s4">, </span><span class="s1">Big</span><span class="s4">.</span><span class="s1">DP </span><span class="s4">-= </span><span class="s5">4</span><span class="s4">, </span><span class="s1">Big</span><span class="s4">.</span><span class="s1">RM</span><span class="s4">);</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return a new Big whose value is the value of this Big times the value of Big y. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">times </span><span class="s4">= </span><span class="s1">P</span><span class="s4">.</span><span class="s1">mul </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">y</span><span class="s4">) {</span>
  <span class="s3">var </span><span class="s1">c</span><span class="s4">,</span>
    <span class="s1">x </span><span class="s4">= </span><span class="s3">this</span><span class="s4">,</span>
    <span class="s1">Big </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">constructor</span><span class="s4">,</span>
    <span class="s1">xc </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">c</span><span class="s4">,</span>
    <span class="s1">yc </span><span class="s4">= (</span><span class="s1">y </span><span class="s4">= </span><span class="s3">new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">y</span><span class="s4">)).</span><span class="s1">c</span><span class="s4">,</span>
    <span class="s1">a </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">.</span><span class="s1">length</span><span class="s4">,</span>
    <span class="s1">b </span><span class="s4">= </span><span class="s1">yc</span><span class="s4">.</span><span class="s1">length</span><span class="s4">,</span>
    <span class="s1">i </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">e</span><span class="s4">,</span>
    <span class="s1">j </span><span class="s4">= </span><span class="s1">y</span><span class="s4">.</span><span class="s1">e</span><span class="s4">;</span>

  <span class="s0">// Determine sign of result.</span>
  <span class="s1">y</span><span class="s4">.</span><span class="s1">s </span><span class="s4">= </span><span class="s1">x</span><span class="s4">.</span><span class="s1">s </span><span class="s4">== </span><span class="s1">y</span><span class="s4">.</span><span class="s1">s </span><span class="s4">? </span><span class="s5">1 </span><span class="s4">: -</span><span class="s5">1</span><span class="s4">;</span>

  <span class="s0">// Return signed 0 if either 0.</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s1">xc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] || !</span><span class="s1">yc</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]) </span><span class="s3">return new </span><span class="s1">Big</span><span class="s4">(</span><span class="s1">y</span><span class="s4">.</span><span class="s1">s </span><span class="s4">* </span><span class="s5">0</span><span class="s4">);</span>

  <span class="s0">// Initialise exponent of result as x.e + y.e.</span>
  <span class="s1">y</span><span class="s4">.</span><span class="s1">e </span><span class="s4">= </span><span class="s1">i </span><span class="s4">+ </span><span class="s1">j</span><span class="s4">;</span>

  <span class="s0">// If array xc has fewer digits than yc, swap xc and yc, and lengths.</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">a </span><span class="s4">&lt; </span><span class="s1">b</span><span class="s4">) {</span>
    <span class="s1">c </span><span class="s4">= </span><span class="s1">xc</span><span class="s4">;</span>
    <span class="s1">xc </span><span class="s4">= </span><span class="s1">yc</span><span class="s4">;</span>
    <span class="s1">yc </span><span class="s4">= </span><span class="s1">c</span><span class="s4">;</span>
    <span class="s1">j </span><span class="s4">= </span><span class="s1">a</span><span class="s4">;</span>
    <span class="s1">a </span><span class="s4">= </span><span class="s1">b</span><span class="s4">;</span>
    <span class="s1">b </span><span class="s4">= </span><span class="s1">j</span><span class="s4">;</span>
  <span class="s4">}</span>

  <span class="s0">// Initialise coefficient array of result with zeros.</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s1">c </span><span class="s4">= </span><span class="s3">new </span><span class="s1">Array</span><span class="s4">(</span><span class="s1">j </span><span class="s4">= </span><span class="s1">a </span><span class="s4">+ </span><span class="s1">b</span><span class="s4">); </span><span class="s1">j</span><span class="s4">--;) </span><span class="s1">c</span><span class="s4">[</span><span class="s1">j</span><span class="s4">] = </span><span class="s5">0</span><span class="s4">;</span>

  <span class="s0">// Multiply.</span>

  <span class="s0">// i is initially xc.length.</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s1">i </span><span class="s4">= </span><span class="s1">b</span><span class="s4">; </span><span class="s1">i</span><span class="s4">--;) {</span>
    <span class="s1">b </span><span class="s4">= </span><span class="s5">0</span><span class="s4">;</span>

    <span class="s0">// a is yc.length.</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s1">j </span><span class="s4">= </span><span class="s1">a </span><span class="s4">+ </span><span class="s1">i</span><span class="s4">; </span><span class="s1">j </span><span class="s4">&gt; </span><span class="s1">i</span><span class="s4">;) {</span>

      <span class="s0">// Current sum of products at this digit position, plus carry.</span>
      <span class="s1">b </span><span class="s4">= </span><span class="s1">c</span><span class="s4">[</span><span class="s1">j</span><span class="s4">] + </span><span class="s1">yc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">] * </span><span class="s1">xc</span><span class="s4">[</span><span class="s1">j </span><span class="s4">- </span><span class="s1">i </span><span class="s4">- </span><span class="s5">1</span><span class="s4">] + </span><span class="s1">b</span><span class="s4">;</span>
      <span class="s1">c</span><span class="s4">[</span><span class="s1">j</span><span class="s4">--] = </span><span class="s1">b </span><span class="s4">% </span><span class="s5">10</span><span class="s4">;</span>

      <span class="s0">// carry</span>
      <span class="s1">b </span><span class="s4">= </span><span class="s1">b </span><span class="s4">/ </span><span class="s5">10 </span><span class="s4">| </span><span class="s5">0</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s1">c</span><span class="s4">[</span><span class="s1">j</span><span class="s4">] = (</span><span class="s1">c</span><span class="s4">[</span><span class="s1">j</span><span class="s4">] + </span><span class="s1">b</span><span class="s4">) % </span><span class="s5">10</span><span class="s4">;</span>
  <span class="s4">}</span>

  <span class="s0">// Increment result exponent if there is a final carry, otherwise remove leading zero.</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s1">b</span><span class="s4">) ++</span><span class="s1">y</span><span class="s4">.</span><span class="s1">e</span><span class="s4">;</span>
  <span class="s3">else </span><span class="s1">c</span><span class="s4">.</span><span class="s1">shift</span><span class="s4">();</span>

  <span class="s0">// Remove trailing zeros.</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s1">i </span><span class="s4">= </span><span class="s1">c</span><span class="s4">.</span><span class="s1">length</span><span class="s4">; !</span><span class="s1">c</span><span class="s4">[--</span><span class="s1">i</span><span class="s4">];) </span><span class="s1">c</span><span class="s4">.</span><span class="s1">pop</span><span class="s4">();</span>
  <span class="s1">y</span><span class="s4">.</span><span class="s1">c </span><span class="s4">= </span><span class="s1">c</span><span class="s4">;</span>

  <span class="s3">return </span><span class="s1">y</span><span class="s4">;</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return a string representing the value of this Big in exponential notation to dp fixed decimal 
 * places and rounded using Big.RM. 
 * 
 * dp? {number} Integer, 0 to MAX_DP inclusive. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">toExponential </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">dp</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s1">stringify</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s5">1</span><span class="s4">, </span><span class="s1">dp</span><span class="s4">, </span><span class="s1">dp</span><span class="s4">);</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return a string representing the value of this Big in normal notation to dp fixed decimal 
 * places and rounded using Big.RM. 
 * 
 * dp? {number} Integer, 0 to MAX_DP inclusive. 
 * 
 * (-0).toFixed(0) is '0', but (-0.1).toFixed(0) is '-0'. 
 * (-0).toFixed(1) is '0.0', but (-0.01).toFixed(1) is '-0.0'. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">toFixed </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">dp</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s1">stringify</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s5">2</span><span class="s4">, </span><span class="s1">dp</span><span class="s4">, </span><span class="s3">this</span><span class="s4">.</span><span class="s1">e </span><span class="s4">+ </span><span class="s1">dp</span><span class="s4">);</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return a string representing the value of this Big rounded to sd significant digits using 
 * Big.RM. Use exponential notation if sd is less than the number of digits necessary to represent 
 * the integer part of the value in normal notation. 
 * 
 * sd {number} Integer, 1 to MAX_DP inclusive. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">toPrecision </span><span class="s4">= </span><span class="s3">function </span><span class="s4">(</span><span class="s1">sd</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s1">stringify</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s5">3</span><span class="s4">, </span><span class="s1">sd</span><span class="s4">, </span><span class="s1">sd </span><span class="s4">- </span><span class="s5">1</span><span class="s4">);</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return a string representing the value of this Big. 
 * Return exponential notation if this Big has a positive exponent equal to or greater than 
 * Big.PE, or a negative exponent equal to or less than Big.NE. 
 * Omit the sign for negative zero. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">toString </span><span class="s4">= </span><span class="s3">function </span><span class="s4">() {</span>
  <span class="s3">return </span><span class="s1">stringify</span><span class="s4">(</span><span class="s3">this</span><span class="s4">);</span>
<span class="s4">};</span>


<span class="s0">/* 
 * Return a string representing the value of this Big. 
 * Return exponential notation if this Big has a positive exponent equal to or greater than 
 * Big.PE, or a negative exponent equal to or less than Big.NE. 
 * Include the sign for negative zero. 
 */</span>
<span class="s1">P</span><span class="s4">.</span><span class="s1">valueOf </span><span class="s4">= </span><span class="s1">P</span><span class="s4">.</span><span class="s1">toJSON </span><span class="s4">= </span><span class="s3">function </span><span class="s4">() {</span>
  <span class="s3">return </span><span class="s1">stringify</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s5">4</span><span class="s4">);</span>
<span class="s4">};</span>


<span class="s0">// Export</span>


<span class="s3">export var </span><span class="s1">Big </span><span class="s4">= </span><span class="s1">_Big_</span><span class="s4">();</span>

<span class="s3">export default </span><span class="s1">Big</span><span class="s4">;</span>
</pre>
</body>
</html>