<html>
<head>
<title>bluebird.core.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #5f826b; font-style: italic;}
.s3 { color: #bcbec4;}
.s4 { color: #cf8e6d;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
.s7 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
bluebird.core.js</font>
</center></td></tr></table>
<pre><span class="s0">/* @preserve 
 * The MIT License (MIT) 
 *  
 * Copyright (c) 2013-2018 Petka Antonov 
 *  
 * Permission is hereby granted, free of charge, to any person obtaining a copy 
 * of this software and associated documentation files (the &quot;Software&quot;), to deal 
 * in the Software without restriction, including without limitation the rights 
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell 
 * copies of the Software, and to permit persons to whom the Software is 
 * furnished to do so, subject to the following conditions: 
 *  
 * The above copyright notice and this permission notice shall be included in 
 * all copies or substantial portions of the Software. 
 *  
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE 
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN 
 * THE SOFTWARE. 
 *  
 */</span>
<span class="s2">/**</span>
 <span class="s2">* bluebird build version 3.7.2</span>
 <span class="s2">* Features enabled: core</span>
 <span class="s2">* Features disabled: race, call_get, generators, map, nodeify, promisify, props, reduce, settle, some, using, timers, filter, any, each</span>
<span class="s2">*/</span>
<span class="s3">!</span><span class="s4">function</span><span class="s3">(</span><span class="s1">e</span><span class="s3">){</span><span class="s4">if</span><span class="s3">(</span><span class="s5">&quot;object&quot;</span><span class="s3">==</span><span class="s4">typeof </span><span class="s1">exports</span><span class="s3">&amp;&amp;</span><span class="s5">&quot;undefined&quot;</span><span class="s3">!=</span><span class="s4">typeof </span><span class="s1">module</span><span class="s3">)</span><span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">=</span><span class="s1">e</span><span class="s3">();</span><span class="s4">else if</span><span class="s3">(</span><span class="s5">&quot;function&quot;</span><span class="s3">==</span><span class="s4">typeof </span><span class="s1">define</span><span class="s3">&amp;&amp;</span><span class="s1">define</span><span class="s3">.</span><span class="s1">amd</span><span class="s3">)</span><span class="s1">define</span><span class="s3">([],</span><span class="s1">e</span><span class="s3">);</span><span class="s4">else</span><span class="s3">{</span><span class="s4">var </span><span class="s1">f</span><span class="s3">;</span><span class="s5">&quot;undefined&quot;</span><span class="s3">!=</span><span class="s4">typeof </span><span class="s1">window</span><span class="s3">?</span><span class="s1">f</span><span class="s3">=</span><span class="s1">window</span><span class="s3">:</span><span class="s5">&quot;undefined&quot;</span><span class="s3">!=</span><span class="s4">typeof </span><span class="s1">global</span><span class="s3">?</span><span class="s1">f</span><span class="s3">=</span><span class="s1">global</span><span class="s3">:</span><span class="s5">&quot;undefined&quot;</span><span class="s3">!=</span><span class="s4">typeof </span><span class="s1">self</span><span class="s3">&amp;&amp;(</span><span class="s1">f</span><span class="s3">=</span><span class="s1">self</span><span class="s3">),</span><span class="s1">f</span><span class="s3">.</span><span class="s1">Promise</span><span class="s3">=</span><span class="s1">e</span><span class="s3">()}}(</span><span class="s4">function</span><span class="s3">(){</span><span class="s4">var </span><span class="s1">define</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">;</span><span class="s4">return </span><span class="s3">(</span><span class="s4">function </span><span class="s1">e</span><span class="s3">(</span><span class="s1">t</span><span class="s3">,</span><span class="s1">n</span><span class="s3">,</span><span class="s1">r</span><span class="s3">){</span><span class="s4">function </span><span class="s1">s</span><span class="s3">(</span><span class="s1">o</span><span class="s3">,</span><span class="s1">u</span><span class="s3">){</span><span class="s4">if</span><span class="s3">(!</span><span class="s1">n</span><span class="s3">[</span><span class="s1">o</span><span class="s3">]){</span><span class="s4">if</span><span class="s3">(!</span><span class="s1">t</span><span class="s3">[</span><span class="s1">o</span><span class="s3">]){</span><span class="s4">var </span><span class="s1">a</span><span class="s3">=</span><span class="s4">typeof </span><span class="s1">_dereq_</span><span class="s3">==</span><span class="s5">&quot;function&quot;</span><span class="s3">&amp;&amp;</span><span class="s1">_dereq_</span><span class="s3">;</span><span class="s4">if</span><span class="s3">(!</span><span class="s1">u</span><span class="s3">&amp;&amp;</span><span class="s1">a</span><span class="s3">)</span><span class="s4">return </span><span class="s1">a</span><span class="s3">(</span><span class="s1">o</span><span class="s3">,!</span><span class="s6">0</span><span class="s3">);</span><span class="s4">if</span><span class="s3">(</span><span class="s1">i</span><span class="s3">)</span><span class="s4">return </span><span class="s1">i</span><span class="s3">(</span><span class="s1">o</span><span class="s3">,!</span><span class="s6">0</span><span class="s3">);</span><span class="s4">var </span><span class="s1">f</span><span class="s3">=</span><span class="s4">new </span><span class="s1">Error</span><span class="s3">(</span><span class="s5">&quot;Cannot find module '&quot;</span><span class="s3">+</span><span class="s1">o</span><span class="s3">+</span><span class="s5">&quot;'&quot;</span><span class="s3">);</span><span class="s4">throw </span><span class="s1">f</span><span class="s3">.</span><span class="s1">code</span><span class="s3">=</span><span class="s5">&quot;MODULE_NOT_FOUND&quot;</span><span class="s3">,</span><span class="s1">f</span><span class="s3">}</span><span class="s4">var </span><span class="s1">l</span><span class="s3">=</span><span class="s1">n</span><span class="s3">[</span><span class="s1">o</span><span class="s3">]={</span><span class="s1">exports</span><span class="s3">:{}};</span><span class="s1">t</span><span class="s3">[</span><span class="s1">o</span><span class="s3">][</span><span class="s6">0</span><span class="s3">].</span><span class="s1">call</span><span class="s3">(</span><span class="s1">l</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">,</span><span class="s4">function</span><span class="s3">(</span><span class="s1">e</span><span class="s3">){</span><span class="s4">var </span><span class="s1">n</span><span class="s3">=</span><span class="s1">t</span><span class="s3">[</span><span class="s1">o</span><span class="s3">][</span><span class="s6">1</span><span class="s3">][</span><span class="s1">e</span><span class="s3">];</span><span class="s4">return </span><span class="s1">s</span><span class="s3">(</span><span class="s1">n</span><span class="s3">?</span><span class="s1">n</span><span class="s3">:</span><span class="s1">e</span><span class="s3">)},</span><span class="s1">l</span><span class="s3">,</span><span class="s1">l</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">,</span><span class="s1">e</span><span class="s3">,</span><span class="s1">t</span><span class="s3">,</span><span class="s1">n</span><span class="s3">,</span><span class="s1">r</span><span class="s3">)}</span><span class="s4">return </span><span class="s1">n</span><span class="s3">[</span><span class="s1">o</span><span class="s3">].</span><span class="s1">exports</span><span class="s3">}</span><span class="s4">var </span><span class="s1">i</span><span class="s3">=</span><span class="s4">typeof </span><span class="s1">_dereq_</span><span class="s3">==</span><span class="s5">&quot;function&quot;</span><span class="s3">&amp;&amp;</span><span class="s1">_dereq_</span><span class="s3">;</span><span class="s4">for</span><span class="s3">(</span><span class="s4">var </span><span class="s1">o</span><span class="s3">=</span><span class="s6">0</span><span class="s3">;</span><span class="s1">o</span><span class="s3">&lt;</span><span class="s1">r</span><span class="s3">.</span><span class="s1">length</span><span class="s3">;</span><span class="s1">o</span><span class="s3">++)</span><span class="s1">s</span><span class="s3">(</span><span class="s1">r</span><span class="s3">[</span><span class="s1">o</span><span class="s3">]);</span><span class="s4">return </span><span class="s1">s</span><span class="s3">})({</span><span class="s6">1</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">firstLineError</span><span class="s3">;</span>
<span class="s4">try </span><span class="s3">{</span><span class="s4">throw new </span><span class="s1">Error</span><span class="s3">(); } </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span><span class="s1">firstLineError </span><span class="s3">= </span><span class="s1">e</span><span class="s3">;}</span>
<span class="s4">var </span><span class="s1">schedule </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./schedule&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">Queue </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./queue&quot;</span><span class="s3">);</span>

<span class="s4">function </span><span class="s1">Async</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_customScheduler </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_isTickUsed </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_lateQueue </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Queue</span><span class="s3">(</span><span class="s6">16</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_normalQueue </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Queue</span><span class="s3">(</span><span class="s6">16</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_haveDrainedQueues </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">self </span><span class="s3">= </span><span class="s4">this</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">drainQueues </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_drainQueues</span><span class="s3">();</span>
    <span class="s3">};</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_schedule </span><span class="s3">= </span><span class="s1">schedule</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s1">Async</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">setScheduler </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">prev </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_schedule</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_schedule </span><span class="s3">= </span><span class="s1">fn</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_customScheduler </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
    <span class="s4">return </span><span class="s1">prev</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Async</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">hasCustomScheduler </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_customScheduler</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Async</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">haveItemsQueued </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_isTickUsed </span><span class="s3">|| </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_haveDrainedQueues</span><span class="s3">;</span>
<span class="s3">};</span>


<span class="s1">Async</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">fatalError </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">e</span><span class="s3">, </span><span class="s1">isNode</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">isNode</span><span class="s3">) {</span>
        <span class="s1">process</span><span class="s3">.</span><span class="s1">stderr</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s5">&quot;Fatal &quot; </span><span class="s3">+ (</span><span class="s1">e </span><span class="s4">instanceof </span><span class="s1">Error </span><span class="s3">? </span><span class="s1">e</span><span class="s3">.</span><span class="s1">stack </span><span class="s3">: </span><span class="s1">e</span><span class="s3">) +</span>
            <span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">);</span>
        <span class="s1">process</span><span class="s3">.</span><span class="s1">exit</span><span class="s3">(</span><span class="s6">2</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">throwLater</span><span class="s3">(</span><span class="s1">e</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Async</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">throwLater </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">, </span><span class="s1">arg</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">arguments</span><span class="s3">.</span><span class="s1">length </span><span class="s3">=== </span><span class="s6">1</span><span class="s3">) {</span>
        <span class="s1">arg </span><span class="s3">= </span><span class="s1">fn</span><span class="s3">;</span>
        <span class="s1">fn </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() { </span><span class="s4">throw </span><span class="s1">arg</span><span class="s3">; };</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">setTimeout </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s3">) {</span>
        <span class="s1">setTimeout</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">fn</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">);</span>
        <span class="s3">}, </span><span class="s6">0</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else try </span><span class="s3">{</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_schedule</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">fn</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">);</span>
        <span class="s3">});</span>
    <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s4">throw new </span><span class="s1">Error</span><span class="s3">(</span><span class="s5">&quot;No async scheduler available</span><span class="s4">\u000a\u000a    </span><span class="s5">See http://goo.gl/MqrFmX</span><span class="s4">\u000a</span><span class="s5">&quot;</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s4">function </span><span class="s1">AsyncInvokeLater</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">arg</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_lateQueue</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">arg</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_queueTick</span><span class="s3">();</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">AsyncInvoke</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">arg</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_normalQueue</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">arg</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_queueTick</span><span class="s3">();</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">AsyncSettlePromises</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_normalQueue</span><span class="s3">.</span><span class="s1">_pushOne</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_queueTick</span><span class="s3">();</span>
<span class="s3">}</span>

<span class="s1">Async</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">invokeLater </span><span class="s3">= </span><span class="s1">AsyncInvokeLater</span><span class="s3">;</span>
<span class="s1">Async</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">invoke </span><span class="s3">= </span><span class="s1">AsyncInvoke</span><span class="s3">;</span>
<span class="s1">Async</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">settlePromises </span><span class="s3">= </span><span class="s1">AsyncSettlePromises</span><span class="s3">;</span>


<span class="s4">function </span><span class="s1">_drainQueue</span><span class="s3">(</span><span class="s1">queue</span><span class="s3">) {</span>
    <span class="s4">while </span><span class="s3">(</span><span class="s1">queue</span><span class="s3">.</span><span class="s1">length</span><span class="s3">() &gt; </span><span class="s6">0</span><span class="s3">) {</span>
        <span class="s1">_drainQueueStep</span><span class="s3">(</span><span class="s1">queue</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">_drainQueueStep</span><span class="s3">(</span><span class="s1">queue</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">fn </span><span class="s3">= </span><span class="s1">queue</span><span class="s3">.</span><span class="s1">shift</span><span class="s3">();</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">fn </span><span class="s3">!== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s1">fn</span><span class="s3">.</span><span class="s1">_settlePromises</span><span class="s3">();</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">var </span><span class="s1">receiver </span><span class="s3">= </span><span class="s1">queue</span><span class="s3">.</span><span class="s1">shift</span><span class="s3">();</span>
        <span class="s4">var </span><span class="s1">arg </span><span class="s3">= </span><span class="s1">queue</span><span class="s3">.</span><span class="s1">shift</span><span class="s3">();</span>
        <span class="s1">fn</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">arg</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s1">Async</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_drainQueues </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s1">_drainQueue</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_normalQueue</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_reset</span><span class="s3">();</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_haveDrainedQueues </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
    <span class="s1">_drainQueue</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_lateQueue</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Async</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_queueTick </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_isTickUsed</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_isTickUsed </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_schedule</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">drainQueues</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Async</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_reset </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_isTickUsed </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s1">Async</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">firstLineError </span><span class="s3">= </span><span class="s1">firstLineError</span><span class="s3">;</span>

<span class="s3">},{</span><span class="s5">&quot;./queue&quot;</span><span class="s3">:</span><span class="s6">17</span><span class="s3">,</span><span class="s5">&quot;./schedule&quot;</span><span class="s3">:</span><span class="s6">18</span><span class="s3">}],</span><span class="s6">2</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">INTERNAL</span><span class="s3">, </span><span class="s1">tryConvertToPromise</span><span class="s3">, </span><span class="s1">debug</span><span class="s3">) {</span>
<span class="s4">var </span><span class="s1">calledBind </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">rejectThis </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">_</span><span class="s3">, </span><span class="s1">e</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">e</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">targetRejected </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">e</span><span class="s3">, </span><span class="s1">context</span><span class="s3">) {</span>
    <span class="s1">context</span><span class="s3">.</span><span class="s1">promiseRejectionQueued </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
    <span class="s1">context</span><span class="s3">.</span><span class="s1">bindingPromise</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span><span class="s1">rejectThis</span><span class="s3">, </span><span class="s1">rejectThis</span><span class="s3">, </span><span class="s4">null</span><span class="s3">, </span><span class="s4">this</span><span class="s3">, </span><span class="s1">e</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">bindingResolved </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">thisArg</span><span class="s3">, </span><span class="s1">context</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(((</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">50397184</span><span class="s3">) === </span><span class="s6">0</span><span class="s3">)) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_resolveCallback</span><span class="s3">(</span><span class="s1">context</span><span class="s3">.</span><span class="s1">target</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">bindingRejected </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">e</span><span class="s3">, </span><span class="s1">context</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s1">context</span><span class="s3">.</span><span class="s1">promiseRejectionQueued</span><span class="s3">) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">e</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">bind </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">thisArg</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s1">calledBind</span><span class="s3">) {</span>
        <span class="s1">calledBind </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_propagateFrom </span><span class="s3">= </span><span class="s1">debug</span><span class="s3">.</span><span class="s1">propagateFromFunction</span><span class="s3">();</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_boundValue </span><span class="s3">= </span><span class="s1">debug</span><span class="s3">.</span><span class="s1">boundValueFunction</span><span class="s3">();</span>
    <span class="s3">}</span>
    <span class="s4">var </span><span class="s1">maybePromise </span><span class="s3">= </span><span class="s1">tryConvertToPromise</span><span class="s3">(</span><span class="s1">thisArg</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">);</span>
    <span class="s1">ret</span><span class="s3">.</span><span class="s1">_propagateFrom</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s6">1</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">target </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">();</span>
    <span class="s1">ret</span><span class="s3">.</span><span class="s1">_setBoundTo</span><span class="s3">(</span><span class="s1">maybePromise</span><span class="s3">);</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">maybePromise </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">context </span><span class="s3">= {</span>
            <span class="s1">promiseRejectionQueued</span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
            <span class="s1">promise</span><span class="s3">: </span><span class="s1">ret</span><span class="s3">,</span>
            <span class="s1">target</span><span class="s3">: </span><span class="s1">target</span><span class="s3">,</span>
            <span class="s1">bindingPromise</span><span class="s3">: </span><span class="s1">maybePromise</span>
        <span class="s3">};</span>
        <span class="s1">target</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">, </span><span class="s1">targetRejected</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">ret</span><span class="s3">, </span><span class="s1">context</span><span class="s3">);</span>
        <span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span>
            <span class="s1">bindingResolved</span><span class="s3">, </span><span class="s1">bindingRejected</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">ret</span><span class="s3">, </span><span class="s1">context</span><span class="s3">);</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">_setOnCancel</span><span class="s3">(</span><span class="s1">maybePromise</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">_resolveCallback</span><span class="s3">(</span><span class="s1">target</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setBoundTo </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">obj </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">| </span><span class="s6">2097152</span><span class="s3">;</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_boundTo </span><span class="s3">= </span><span class="s1">obj</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; (~</span><span class="s6">2097152</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_isBound </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">2097152</span><span class="s3">) === </span><span class="s6">2097152</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">bind </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">thisArg</span><span class="s3">, </span><span class="s1">value</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">value</span><span class="s3">).</span><span class="s1">bind</span><span class="s3">(</span><span class="s1">thisArg</span><span class="s3">);</span>
<span class="s3">};</span>
<span class="s3">};</span>

<span class="s3">},{}],</span><span class="s6">3</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">old</span><span class="s3">;</span>
<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">Promise </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s3">) </span><span class="s1">old </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">;</span>
<span class="s4">function </span><span class="s1">noConflict</span><span class="s3">() {</span>
    <span class="s4">try </span><span class="s3">{ </span><span class="s4">if </span><span class="s3">(</span><span class="s1">Promise </span><span class="s3">=== </span><span class="s1">bluebird</span><span class="s3">) </span><span class="s1">Promise </span><span class="s3">= </span><span class="s1">old</span><span class="s3">; }</span>
    <span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {}</span>
    <span class="s4">return </span><span class="s1">bluebird</span><span class="s3">;</span>
<span class="s3">}</span>
<span class="s4">var </span><span class="s1">bluebird </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./promise&quot;</span><span class="s3">)();</span>
<span class="s1">bluebird</span><span class="s3">.</span><span class="s1">noConflict </span><span class="s3">= </span><span class="s1">noConflict</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s1">bluebird</span><span class="s3">;</span>

<span class="s3">},{</span><span class="s5">&quot;./promise&quot;</span><span class="s3">:</span><span class="s6">15</span><span class="s3">}],</span><span class="s6">4</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">PromiseArray</span><span class="s3">, </span><span class="s1">apiRejection</span><span class="s3">, </span><span class="s1">debug</span><span class="s3">) {</span>
<span class="s4">var </span><span class="s1">util </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./util&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">tryCatch </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">tryCatch</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">errorObj </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">errorObj</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">async </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">_async</span><span class="s3">;</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">[</span><span class="s5">&quot;break&quot;</span><span class="s3">] = </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">cancel </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s1">debug</span><span class="s3">.</span><span class="s1">cancellation</span><span class="s3">()) </span><span class="s4">return this</span><span class="s3">.</span><span class="s1">_warn</span><span class="s3">(</span><span class="s5">&quot;cancellation is disabled&quot;</span><span class="s3">);</span>

    <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s4">this</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">child </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">;</span>
    <span class="s4">while </span><span class="s3">(</span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_isCancellable</span><span class="s3">()) {</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_cancelBy</span><span class="s3">(</span><span class="s1">child</span><span class="s3">)) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">child</span><span class="s3">.</span><span class="s1">_isFollowing</span><span class="s3">()) {</span>
                <span class="s1">child</span><span class="s3">.</span><span class="s1">_followee</span><span class="s3">().</span><span class="s1">cancel</span><span class="s3">();</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">child</span><span class="s3">.</span><span class="s1">_cancelBranched</span><span class="s3">();</span>
            <span class="s3">}</span>
            <span class="s4">break</span><span class="s3">;</span>
        <span class="s3">}</span>

        <span class="s4">var </span><span class="s1">parent </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_cancellationParent</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">parent </span><span class="s3">== </span><span class="s4">null </span><span class="s3">|| !</span><span class="s1">parent</span><span class="s3">.</span><span class="s1">_isCancellable</span><span class="s3">()) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_isFollowing</span><span class="s3">()) {</span>
                <span class="s1">promise</span><span class="s3">.</span><span class="s1">_followee</span><span class="s3">().</span><span class="s1">cancel</span><span class="s3">();</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">promise</span><span class="s3">.</span><span class="s1">_cancelBranched</span><span class="s3">();</span>
            <span class="s3">}</span>
            <span class="s4">break</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_isFollowing</span><span class="s3">()) </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_followee</span><span class="s3">().</span><span class="s1">cancel</span><span class="s3">();</span>
            <span class="s1">promise</span><span class="s3">.</span><span class="s1">_setWillBeCancelled</span><span class="s3">();</span>
            <span class="s1">child </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">;</span>
            <span class="s1">promise </span><span class="s3">= </span><span class="s1">parent</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_branchHasCancelled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_branchesRemainingToCancel</span><span class="s3">--;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_enoughBranchesHaveCancelled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_branchesRemainingToCancel </span><span class="s3">=== </span><span class="s1">undefined </span><span class="s3">||</span>
           <span class="s4">this</span><span class="s3">.</span><span class="s1">_branchesRemainingToCancel </span><span class="s3">&lt;= </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_cancelBy </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">canceller</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">canceller </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_branchesRemainingToCancel </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_invokeOnCancel</span><span class="s3">();</span>
        <span class="s4">return true</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_branchHasCancelled</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_enoughBranchesHaveCancelled</span><span class="s3">()) {</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_invokeOnCancel</span><span class="s3">();</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">return false</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_cancelBranched </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_enoughBranchesHaveCancelled</span><span class="s3">()) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_cancel</span><span class="s3">();</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_cancel </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_isCancellable</span><span class="s3">()) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_setCancelled</span><span class="s3">();</span>
    <span class="s1">async</span><span class="s3">.</span><span class="s1">invoke</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_cancelPromises</span><span class="s3">, </span><span class="s4">this</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_cancelPromises </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_length</span><span class="s3">() &gt; </span><span class="s6">0</span><span class="s3">) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_settlePromises</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_unsetOnCancel </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_onCancelField </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_isCancellable </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">isPending</span><span class="s3">() &amp;&amp; !</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_isCancelled</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isCancellable </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">isPending</span><span class="s3">() &amp;&amp; !</span><span class="s4">this</span><span class="s3">.</span><span class="s1">isCancelled</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_doInvokeOnCancel </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">onCancelCallback</span><span class="s3">, </span><span class="s1">internalOnly</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">isArray</span><span class="s3">(</span><span class="s1">onCancelCallback</span><span class="s3">)) {</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">onCancelCallback</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_doInvokeOnCancel</span><span class="s3">(</span><span class="s1">onCancelCallback</span><span class="s3">[</span><span class="s1">i</span><span class="s3">], </span><span class="s1">internalOnly</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">onCancelCallback </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">onCancelCallback </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(!</span><span class="s1">internalOnly</span><span class="s3">) {</span>
                <span class="s4">var </span><span class="s1">e </span><span class="s3">= </span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">onCancelCallback</span><span class="s3">).</span><span class="s1">call</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_boundValue</span><span class="s3">());</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">e </span><span class="s3">=== </span><span class="s1">errorObj</span><span class="s3">) {</span>
                    <span class="s4">this</span><span class="s3">.</span><span class="s1">_attachExtraTrace</span><span class="s3">(</span><span class="s1">e</span><span class="s3">.</span><span class="s1">e</span><span class="s3">);</span>
                    <span class="s1">async</span><span class="s3">.</span><span class="s1">throwLater</span><span class="s3">(</span><span class="s1">e</span><span class="s3">.</span><span class="s1">e</span><span class="s3">);</span>
                <span class="s3">}</span>
            <span class="s3">}</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">onCancelCallback</span><span class="s3">.</span><span class="s1">_resultCancelled</span><span class="s3">(</span><span class="s4">this</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_invokeOnCancel </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">onCancelCallback </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_onCancel</span><span class="s3">();</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_unsetOnCancel</span><span class="s3">();</span>
    <span class="s1">async</span><span class="s3">.</span><span class="s1">invoke</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_doInvokeOnCancel</span><span class="s3">, </span><span class="s4">this</span><span class="s3">, </span><span class="s1">onCancelCallback</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_invokeInternalOnCancel </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_isCancellable</span><span class="s3">()) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_doInvokeOnCancel</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_onCancel</span><span class="s3">(), </span><span class="s4">true</span><span class="s3">);</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_unsetOnCancel</span><span class="s3">();</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_resultCancelled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">cancel</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s3">};</span>

<span class="s3">},{</span><span class="s5">&quot;./util&quot;</span><span class="s3">:</span><span class="s6">21</span><span class="s3">}],</span><span class="s6">5</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">NEXT_FILTER</span><span class="s3">) {</span>
<span class="s4">var </span><span class="s1">util </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./util&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">getKeys </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./es5&quot;</span><span class="s3">).</span><span class="s1">keys</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">tryCatch </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">tryCatch</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">errorObj </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">errorObj</span><span class="s3">;</span>

<span class="s4">function </span><span class="s1">catchFilter</span><span class="s3">(</span><span class="s1">instances</span><span class="s3">, </span><span class="s1">cb</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">) {</span>
    <span class="s4">return function</span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">boundTo </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_boundValue</span><span class="s3">();</span>
        <span class="s1">predicateLoop</span><span class="s3">: </span><span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">instances</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">item </span><span class="s3">= </span><span class="s1">instances</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>

            <span class="s4">if </span><span class="s3">(</span><span class="s1">item </span><span class="s3">=== </span><span class="s1">Error </span><span class="s3">||</span>
                <span class="s3">(</span><span class="s1">item </span><span class="s3">!= </span><span class="s4">null </span><span class="s3">&amp;&amp; </span><span class="s1">item</span><span class="s3">.</span><span class="s1">prototype </span><span class="s4">instanceof </span><span class="s1">Error</span><span class="s3">)) {</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">e </span><span class="s4">instanceof </span><span class="s1">item</span><span class="s3">) {</span>
                    <span class="s4">return </span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">cb</span><span class="s3">).</span><span class="s1">call</span><span class="s3">(</span><span class="s1">boundTo</span><span class="s3">, </span><span class="s1">e</span><span class="s3">);</span>
                <span class="s3">}</span>
            <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">item </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
                <span class="s4">var </span><span class="s1">matchesPredicate </span><span class="s3">= </span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">item</span><span class="s3">).</span><span class="s1">call</span><span class="s3">(</span><span class="s1">boundTo</span><span class="s3">, </span><span class="s1">e</span><span class="s3">);</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">matchesPredicate </span><span class="s3">=== </span><span class="s1">errorObj</span><span class="s3">) {</span>
                    <span class="s4">return </span><span class="s1">matchesPredicate</span><span class="s3">;</span>
                <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">matchesPredicate</span><span class="s3">) {</span>
                    <span class="s4">return </span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">cb</span><span class="s3">).</span><span class="s1">call</span><span class="s3">(</span><span class="s1">boundTo</span><span class="s3">, </span><span class="s1">e</span><span class="s3">);</span>
                <span class="s3">}</span>
            <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">isObject</span><span class="s3">(</span><span class="s1">e</span><span class="s3">)) {</span>
                <span class="s4">var </span><span class="s1">keys </span><span class="s3">= </span><span class="s1">getKeys</span><span class="s3">(</span><span class="s1">item</span><span class="s3">);</span>
                <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">j </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">j </span><span class="s3">&lt; </span><span class="s1">keys</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">j</span><span class="s3">) {</span>
                    <span class="s4">var </span><span class="s1">key </span><span class="s3">= </span><span class="s1">keys</span><span class="s3">[</span><span class="s1">j</span><span class="s3">];</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">item</span><span class="s3">[</span><span class="s1">key</span><span class="s3">] != </span><span class="s1">e</span><span class="s3">[</span><span class="s1">key</span><span class="s3">]) {</span>
                        <span class="s4">continue </span><span class="s1">predicateLoop</span><span class="s3">;</span>
                    <span class="s3">}</span>
                <span class="s3">}</span>
                <span class="s4">return </span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">cb</span><span class="s3">).</span><span class="s1">call</span><span class="s3">(</span><span class="s1">boundTo</span><span class="s3">, </span><span class="s1">e</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">return </span><span class="s1">NEXT_FILTER</span><span class="s3">;</span>
    <span class="s3">};</span>
<span class="s3">}</span>

<span class="s4">return </span><span class="s1">catchFilter</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s3">},{</span><span class="s5">&quot;./es5&quot;</span><span class="s3">:</span><span class="s6">10</span><span class="s3">,</span><span class="s5">&quot;./util&quot;</span><span class="s3">:</span><span class="s6">21</span><span class="s3">}],</span><span class="s6">6</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">) {</span>
<span class="s4">var </span><span class="s1">longStackTraces </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">contextStack </span><span class="s3">= [];</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_promiseCreated </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {};</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_pushContext </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {};</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_popContext </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span><span class="s4">return null</span><span class="s3">;};</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">_peekContext </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_peekContext </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {};</span>

<span class="s4">function </span><span class="s1">Context</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_trace </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Context</span><span class="s3">.</span><span class="s1">CapturedTrace</span><span class="s3">(</span><span class="s1">peekContext</span><span class="s3">());</span>
<span class="s3">}</span>
<span class="s1">Context</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_pushContext </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_trace </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_trace</span><span class="s3">.</span><span class="s1">_promiseCreated </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
        <span class="s1">contextStack</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_trace</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Context</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_popContext </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_trace </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">trace </span><span class="s3">= </span><span class="s1">contextStack</span><span class="s3">.</span><span class="s1">pop</span><span class="s3">();</span>
        <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s1">trace</span><span class="s3">.</span><span class="s1">_promiseCreated</span><span class="s3">;</span>
        <span class="s1">trace</span><span class="s3">.</span><span class="s1">_promiseCreated </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
        <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">return null</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">function </span><span class="s1">createContext</span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">longStackTraces</span><span class="s3">) </span><span class="s4">return new </span><span class="s1">Context</span><span class="s3">();</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">peekContext</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">lastIndex </span><span class="s3">= </span><span class="s1">contextStack</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s6">1</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">lastIndex </span><span class="s3">&gt;= </span><span class="s6">0</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">contextStack</span><span class="s3">[</span><span class="s1">lastIndex</span><span class="s3">];</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">undefined</span><span class="s3">;</span>
<span class="s3">}</span>
<span class="s1">Context</span><span class="s3">.</span><span class="s1">CapturedTrace </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
<span class="s1">Context</span><span class="s3">.</span><span class="s1">create </span><span class="s3">= </span><span class="s1">createContext</span><span class="s3">;</span>
<span class="s1">Context</span><span class="s3">.</span><span class="s1">deactivateLongStackTraces </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {};</span>
<span class="s1">Context</span><span class="s3">.</span><span class="s1">activateLongStackTraces </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">Promise_pushContext </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_pushContext</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">Promise_popContext </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_popContext</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">Promise_PeekContext </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">_peekContext</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">Promise_peekContext </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_peekContext</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">Promise_promiseCreated </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_promiseCreated</span><span class="s3">;</span>
    <span class="s1">Context</span><span class="s3">.</span><span class="s1">deactivateLongStackTraces </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_pushContext </span><span class="s3">= </span><span class="s1">Promise_pushContext</span><span class="s3">;</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_popContext </span><span class="s3">= </span><span class="s1">Promise_popContext</span><span class="s3">;</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">_peekContext </span><span class="s3">= </span><span class="s1">Promise_PeekContext</span><span class="s3">;</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_peekContext </span><span class="s3">= </span><span class="s1">Promise_peekContext</span><span class="s3">;</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_promiseCreated </span><span class="s3">= </span><span class="s1">Promise_promiseCreated</span><span class="s3">;</span>
        <span class="s1">longStackTraces </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s3">};</span>
    <span class="s1">longStackTraces </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
    <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_pushContext </span><span class="s3">= </span><span class="s1">Context</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_pushContext</span><span class="s3">;</span>
    <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_popContext </span><span class="s3">= </span><span class="s1">Context</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_popContext</span><span class="s3">;</span>
    <span class="s1">Promise</span><span class="s3">.</span><span class="s1">_peekContext </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_peekContext </span><span class="s3">= </span><span class="s1">peekContext</span><span class="s3">;</span>
    <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_promiseCreated </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s4">var </span><span class="s1">ctx </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_peekContext</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">ctx </span><span class="s3">&amp;&amp; </span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">_promiseCreated </span><span class="s3">== </span><span class="s4">null</span><span class="s3">) </span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">_promiseCreated </span><span class="s3">= </span><span class="s4">this</span><span class="s3">;</span>
    <span class="s3">};</span>
<span class="s3">};</span>
<span class="s4">return </span><span class="s1">Context</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s3">},{}],</span><span class="s6">7</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">Context</span><span class="s3">,</span>
    <span class="s1">enableAsyncHooks</span><span class="s3">, </span><span class="s1">disableAsyncHooks</span><span class="s3">) {</span>
<span class="s4">var </span><span class="s1">async </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">_async</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">Warning </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./errors&quot;</span><span class="s3">).</span><span class="s1">Warning</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">util </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./util&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">es5 </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./es5&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">canAttachTrace </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">canAttachTrace</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">unhandledRejectionHandled</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">possiblyUnhandledRejection</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">bluebirdFramePattern </span><span class="s3">=</span>
    <span class="s7">/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">nodeFramePattern </span><span class="s3">= </span><span class="s7">/\((?:timers\.js):\d+:\d+\)/</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">parseLinePattern </span><span class="s3">= </span><span class="s7">/[\/&lt;\(](.+?):(\d+):(\d+)\)?\s*$/</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">stackFramePattern </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">formatStack </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">indentStackFrames </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">printWarning</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">debugging </span><span class="s3">= !!(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">env</span><span class="s3">(</span><span class="s5">&quot;BLUEBIRD_DEBUG&quot;</span><span class="s3">) != </span><span class="s6">0 </span><span class="s3">&amp;&amp;</span>
                        <span class="s3">(</span><span class="s4">true </span><span class="s3">||</span>
                         <span class="s1">util</span><span class="s3">.</span><span class="s1">env</span><span class="s3">(</span><span class="s5">&quot;BLUEBIRD_DEBUG&quot;</span><span class="s3">) ||</span>
                         <span class="s1">util</span><span class="s3">.</span><span class="s1">env</span><span class="s3">(</span><span class="s5">&quot;NODE_ENV&quot;</span><span class="s3">) === </span><span class="s5">&quot;development&quot;</span><span class="s3">));</span>

<span class="s4">var </span><span class="s1">warnings </span><span class="s3">= !!(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">env</span><span class="s3">(</span><span class="s5">&quot;BLUEBIRD_WARNINGS&quot;</span><span class="s3">) != </span><span class="s6">0 </span><span class="s3">&amp;&amp;</span>
    <span class="s3">(</span><span class="s1">debugging </span><span class="s3">|| </span><span class="s1">util</span><span class="s3">.</span><span class="s1">env</span><span class="s3">(</span><span class="s5">&quot;BLUEBIRD_WARNINGS&quot;</span><span class="s3">)));</span>

<span class="s4">var </span><span class="s1">longStackTraces </span><span class="s3">= !!(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">env</span><span class="s3">(</span><span class="s5">&quot;BLUEBIRD_LONG_STACK_TRACES&quot;</span><span class="s3">) != </span><span class="s6">0 </span><span class="s3">&amp;&amp;</span>
    <span class="s3">(</span><span class="s1">debugging </span><span class="s3">|| </span><span class="s1">util</span><span class="s3">.</span><span class="s1">env</span><span class="s3">(</span><span class="s5">&quot;BLUEBIRD_LONG_STACK_TRACES&quot;</span><span class="s3">)));</span>

<span class="s4">var </span><span class="s1">wForgottenReturn </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">env</span><span class="s3">(</span><span class="s5">&quot;BLUEBIRD_W_FORGOTTEN_RETURN&quot;</span><span class="s3">) != </span><span class="s6">0 </span><span class="s3">&amp;&amp;</span>
    <span class="s3">(</span><span class="s1">warnings </span><span class="s3">|| !!</span><span class="s1">util</span><span class="s3">.</span><span class="s1">env</span><span class="s3">(</span><span class="s5">&quot;BLUEBIRD_W_FORGOTTEN_RETURN&quot;</span><span class="s3">));</span>

<span class="s4">var </span><span class="s1">deferUnhandledRejectionCheck</span><span class="s3">;</span>
<span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">promises </span><span class="s3">= [];</span>

    <span class="s4">function </span><span class="s1">unhandledRejectionCheck</span><span class="s3">() {</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">promises</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s1">promises</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">_notifyUnhandledRejection</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s1">unhandledRejectionClear</span><span class="s3">();</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">unhandledRejectionClear</span><span class="s3">() {</span>
        <span class="s1">promises</span><span class="s3">.</span><span class="s1">length </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s1">deferUnhandledRejectionCheck </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">) {</span>
        <span class="s1">promises</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">);</span>
        <span class="s1">setTimeout</span><span class="s3">(</span><span class="s1">unhandledRejectionCheck</span><span class="s3">, </span><span class="s6">1</span><span class="s3">);</span>
    <span class="s3">};</span>

    <span class="s1">es5</span><span class="s3">.</span><span class="s1">defineProperty</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s5">&quot;_unhandledRejectionCheck&quot;</span><span class="s3">, {</span>
        <span class="s1">value</span><span class="s3">: </span><span class="s1">unhandledRejectionCheck</span>
    <span class="s3">});</span>
    <span class="s1">es5</span><span class="s3">.</span><span class="s1">defineProperty</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s5">&quot;_unhandledRejectionClear&quot;</span><span class="s3">, {</span>
        <span class="s1">value</span><span class="s3">: </span><span class="s1">unhandledRejectionClear</span>
    <span class="s3">});</span>
<span class="s3">})();</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">suppressUnhandledRejections </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">target </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">();</span>
    <span class="s1">target</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= ((</span><span class="s1">target</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; (~</span><span class="s6">1048576</span><span class="s3">)) |</span>
                      <span class="s6">524288</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_ensurePossibleRejectionHandled </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">((</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">524288</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_setRejectionIsUnhandled</span><span class="s3">();</span>
    <span class="s1">deferUnhandledRejectionCheck</span><span class="s3">(</span><span class="s4">this</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_notifyUnhandledRejectionIsHandled </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s1">fireRejectionEvent</span><span class="s3">(</span><span class="s5">&quot;rejectionHandled&quot;</span><span class="s3">,</span>
                                  <span class="s1">unhandledRejectionHandled</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s4">this</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setReturnedNonUndefined </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">| </span><span class="s6">268435456</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_returnedNonUndefined </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">268435456</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_notifyUnhandledRejection </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_isRejectionUnhandled</span><span class="s3">()) {</span>
        <span class="s4">var </span><span class="s1">reason </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_settledValue</span><span class="s3">();</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_setUnhandledRejectionIsNotified</span><span class="s3">();</span>
        <span class="s1">fireRejectionEvent</span><span class="s3">(</span><span class="s5">&quot;unhandledRejection&quot;</span><span class="s3">,</span>
                                      <span class="s1">possiblyUnhandledRejection</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">, </span><span class="s4">this</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setUnhandledRejectionIsNotified </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">| </span><span class="s6">262144</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_unsetUnhandledRejectionIsNotified </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; (~</span><span class="s6">262144</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_isUnhandledRejectionNotified </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">262144</span><span class="s3">) &gt; </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setRejectionIsUnhandled </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">| </span><span class="s6">1048576</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_unsetRejectionIsUnhandled </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; (~</span><span class="s6">1048576</span><span class="s3">);</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_isUnhandledRejectionNotified</span><span class="s3">()) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_unsetUnhandledRejectionIsNotified</span><span class="s3">();</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_notifyUnhandledRejectionIsHandled</span><span class="s3">();</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_isRejectionUnhandled </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">1048576</span><span class="s3">) &gt; </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_warn </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">shouldUseOwnTrace</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s1">warn</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">shouldUseOwnTrace</span><span class="s3">, </span><span class="s1">promise </span><span class="s3">|| </span><span class="s4">this</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">onPossiblyUnhandledRejection </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">context </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">_getContext</span><span class="s3">();</span>
    <span class="s1">possiblyUnhandledRejection </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">contextBind</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">onUnhandledRejectionHandled </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">context </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">_getContext</span><span class="s3">();</span>
    <span class="s1">unhandledRejectionHandled </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">contextBind</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">disableLongStackTraces </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {};</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">longStackTraces </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">async</span><span class="s3">.</span><span class="s1">haveItemsQueued</span><span class="s3">() &amp;&amp; !</span><span class="s1">config</span><span class="s3">.</span><span class="s1">longStackTraces</span><span class="s3">) {</span>
        <span class="s4">throw new </span><span class="s1">Error</span><span class="s3">(</span><span class="s5">&quot;cannot enable long stack traces after promises have been created</span><span class="s4">\u000a\u000a    </span><span class="s5">See http://goo.gl/MqrFmX</span><span class="s4">\u000a</span><span class="s5">&quot;</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s1">config</span><span class="s3">.</span><span class="s1">longStackTraces </span><span class="s3">&amp;&amp; </span><span class="s1">longStackTracesIsSupported</span><span class="s3">()) {</span>
        <span class="s4">var </span><span class="s1">Promise_captureStackTrace </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_captureStackTrace</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">Promise_attachExtraTrace </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_attachExtraTrace</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">Promise_dereferenceTrace </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_dereferenceTrace</span><span class="s3">;</span>
        <span class="s1">config</span><span class="s3">.</span><span class="s1">longStackTraces </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
        <span class="s1">disableLongStackTraces </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">async</span><span class="s3">.</span><span class="s1">haveItemsQueued</span><span class="s3">() &amp;&amp; !</span><span class="s1">config</span><span class="s3">.</span><span class="s1">longStackTraces</span><span class="s3">) {</span>
                <span class="s4">throw new </span><span class="s1">Error</span><span class="s3">(</span><span class="s5">&quot;cannot enable long stack traces after promises have been created</span><span class="s4">\u000a\u000a    </span><span class="s5">See http://goo.gl/MqrFmX</span><span class="s4">\u000a</span><span class="s5">&quot;</span><span class="s3">);</span>
            <span class="s3">}</span>
            <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_captureStackTrace </span><span class="s3">= </span><span class="s1">Promise_captureStackTrace</span><span class="s3">;</span>
            <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_attachExtraTrace </span><span class="s3">= </span><span class="s1">Promise_attachExtraTrace</span><span class="s3">;</span>
            <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_dereferenceTrace </span><span class="s3">= </span><span class="s1">Promise_dereferenceTrace</span><span class="s3">;</span>
            <span class="s1">Context</span><span class="s3">.</span><span class="s1">deactivateLongStackTraces</span><span class="s3">();</span>
            <span class="s1">config</span><span class="s3">.</span><span class="s1">longStackTraces </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
        <span class="s3">};</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_captureStackTrace </span><span class="s3">= </span><span class="s1">longStackTracesCaptureStackTrace</span><span class="s3">;</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_attachExtraTrace </span><span class="s3">= </span><span class="s1">longStackTracesAttachExtraTrace</span><span class="s3">;</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_dereferenceTrace </span><span class="s3">= </span><span class="s1">longStackTracesDereferenceTrace</span><span class="s3">;</span>
        <span class="s1">Context</span><span class="s3">.</span><span class="s1">activateLongStackTraces</span><span class="s3">();</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">hasLongStackTraces </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s1">config</span><span class="s3">.</span><span class="s1">longStackTraces </span><span class="s3">&amp;&amp; </span><span class="s1">longStackTracesIsSupported</span><span class="s3">();</span>
<span class="s3">};</span>


<span class="s4">var </span><span class="s1">legacyHandlers </span><span class="s3">= {</span>
    <span class="s1">unhandledrejection</span><span class="s3">: {</span>
        <span class="s1">before</span><span class="s3">: </span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">.</span><span class="s1">onunhandledrejection</span><span class="s3">;</span>
            <span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">.</span><span class="s1">onunhandledrejection </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
            <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
        <span class="s3">},</span>
        <span class="s1">after</span><span class="s3">: </span><span class="s4">function</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
            <span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">.</span><span class="s1">onunhandledrejection </span><span class="s3">= </span><span class="s1">fn</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">},</span>
    <span class="s1">rejectionhandled</span><span class="s3">: {</span>
        <span class="s1">before</span><span class="s3">: </span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">.</span><span class="s1">onrejectionhandled</span><span class="s3">;</span>
            <span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">.</span><span class="s1">onrejectionhandled </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
            <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
        <span class="s3">},</span>
        <span class="s1">after</span><span class="s3">: </span><span class="s4">function</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
            <span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">.</span><span class="s1">onrejectionhandled </span><span class="s3">= </span><span class="s1">fn</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">fireDomEvent </span><span class="s3">= (</span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">dispatch </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">legacy</span><span class="s3">, </span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">legacy</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">fn</span><span class="s3">;</span>
            <span class="s4">try </span><span class="s3">{</span>
                <span class="s1">fn </span><span class="s3">= </span><span class="s1">legacy</span><span class="s3">.</span><span class="s1">before</span><span class="s3">();</span>
                <span class="s4">return </span><span class="s3">!</span><span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">.</span><span class="s1">dispatchEvent</span><span class="s3">(</span><span class="s1">e</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">finally </span><span class="s3">{</span>
                <span class="s1">legacy</span><span class="s3">.</span><span class="s1">after</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">return </span><span class="s3">!</span><span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">.</span><span class="s1">dispatchEvent</span><span class="s3">(</span><span class="s1">e</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">};</span>
    <span class="s4">try </span><span class="s3">{</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">CustomEvent </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">event </span><span class="s3">= </span><span class="s4">new </span><span class="s1">CustomEvent</span><span class="s3">(</span><span class="s5">&quot;CustomEvent&quot;</span><span class="s3">);</span>
            <span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">.</span><span class="s1">dispatchEvent</span><span class="s3">(</span><span class="s1">event</span><span class="s3">);</span>
            <span class="s4">return function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">event</span><span class="s3">) {</span>
                <span class="s1">name </span><span class="s3">= </span><span class="s1">name</span><span class="s3">.</span><span class="s1">toLowerCase</span><span class="s3">();</span>
                <span class="s4">var </span><span class="s1">eventData </span><span class="s3">= {</span>
                    <span class="s1">detail</span><span class="s3">: </span><span class="s1">event</span><span class="s3">,</span>
                    <span class="s1">cancelable</span><span class="s3">: </span><span class="s4">true</span>
                <span class="s3">};</span>
                <span class="s4">var </span><span class="s1">domEvent </span><span class="s3">= </span><span class="s4">new </span><span class="s1">CustomEvent</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">eventData</span><span class="s3">);</span>
                <span class="s1">es5</span><span class="s3">.</span><span class="s1">defineProperty</span><span class="s3">(</span>
                    <span class="s1">domEvent</span><span class="s3">, </span><span class="s5">&quot;promise&quot;</span><span class="s3">, {</span><span class="s1">value</span><span class="s3">: </span><span class="s1">event</span><span class="s3">.</span><span class="s1">promise</span><span class="s3">});</span>
                <span class="s1">es5</span><span class="s3">.</span><span class="s1">defineProperty</span><span class="s3">(</span>
                    <span class="s1">domEvent</span><span class="s3">, </span><span class="s5">&quot;reason&quot;</span><span class="s3">, {</span><span class="s1">value</span><span class="s3">: </span><span class="s1">event</span><span class="s3">.</span><span class="s1">reason</span><span class="s3">});</span>

                <span class="s4">return </span><span class="s1">dispatch</span><span class="s3">(</span><span class="s1">legacyHandlers</span><span class="s3">[</span><span class="s1">name</span><span class="s3">], </span><span class="s1">domEvent</span><span class="s3">);</span>
            <span class="s3">};</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">Event </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">event </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Event</span><span class="s3">(</span><span class="s5">&quot;CustomEvent&quot;</span><span class="s3">);</span>
            <span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">.</span><span class="s1">dispatchEvent</span><span class="s3">(</span><span class="s1">event</span><span class="s3">);</span>
            <span class="s4">return function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">event</span><span class="s3">) {</span>
                <span class="s1">name </span><span class="s3">= </span><span class="s1">name</span><span class="s3">.</span><span class="s1">toLowerCase</span><span class="s3">();</span>
                <span class="s4">var </span><span class="s1">domEvent </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Event</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, {</span>
                    <span class="s1">cancelable</span><span class="s3">: </span><span class="s4">true</span>
                <span class="s3">});</span>
                <span class="s1">domEvent</span><span class="s3">.</span><span class="s1">detail </span><span class="s3">= </span><span class="s1">event</span><span class="s3">;</span>
                <span class="s1">es5</span><span class="s3">.</span><span class="s1">defineProperty</span><span class="s3">(</span><span class="s1">domEvent</span><span class="s3">, </span><span class="s5">&quot;promise&quot;</span><span class="s3">, {</span><span class="s1">value</span><span class="s3">: </span><span class="s1">event</span><span class="s3">.</span><span class="s1">promise</span><span class="s3">});</span>
                <span class="s1">es5</span><span class="s3">.</span><span class="s1">defineProperty</span><span class="s3">(</span><span class="s1">domEvent</span><span class="s3">, </span><span class="s5">&quot;reason&quot;</span><span class="s3">, {</span><span class="s1">value</span><span class="s3">: </span><span class="s1">event</span><span class="s3">.</span><span class="s1">reason</span><span class="s3">});</span>
                <span class="s4">return </span><span class="s1">dispatch</span><span class="s3">(</span><span class="s1">legacyHandlers</span><span class="s3">[</span><span class="s1">name</span><span class="s3">], </span><span class="s1">domEvent</span><span class="s3">);</span>
            <span class="s3">};</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">var </span><span class="s1">event </span><span class="s3">= </span><span class="s1">document</span><span class="s3">.</span><span class="s1">createEvent</span><span class="s3">(</span><span class="s5">&quot;CustomEvent&quot;</span><span class="s3">);</span>
            <span class="s1">event</span><span class="s3">.</span><span class="s1">initCustomEvent</span><span class="s3">(</span><span class="s5">&quot;testingtheevent&quot;</span><span class="s3">, </span><span class="s4">false</span><span class="s3">, </span><span class="s4">true</span><span class="s3">, {});</span>
            <span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">.</span><span class="s1">dispatchEvent</span><span class="s3">(</span><span class="s1">event</span><span class="s3">);</span>
            <span class="s4">return function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">event</span><span class="s3">) {</span>
                <span class="s1">name </span><span class="s3">= </span><span class="s1">name</span><span class="s3">.</span><span class="s1">toLowerCase</span><span class="s3">();</span>
                <span class="s4">var </span><span class="s1">domEvent </span><span class="s3">= </span><span class="s1">document</span><span class="s3">.</span><span class="s1">createEvent</span><span class="s3">(</span><span class="s5">&quot;CustomEvent&quot;</span><span class="s3">);</span>
                <span class="s1">domEvent</span><span class="s3">.</span><span class="s1">initCustomEvent</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s4">false</span><span class="s3">, </span><span class="s4">true</span><span class="s3">,</span>
                    <span class="s1">event</span><span class="s3">);</span>
                <span class="s4">return </span><span class="s1">dispatch</span><span class="s3">(</span><span class="s1">legacyHandlers</span><span class="s3">[</span><span class="s1">name</span><span class="s3">], </span><span class="s1">domEvent</span><span class="s3">);</span>
            <span class="s3">};</span>
        <span class="s3">}</span>
    <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {}</span>
    <span class="s4">return function</span><span class="s3">() {</span>
        <span class="s4">return false</span><span class="s3">;</span>
    <span class="s3">};</span>
<span class="s3">})();</span>

<span class="s4">var </span><span class="s1">fireGlobalEvent </span><span class="s3">= (</span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">isNode</span><span class="s3">) {</span>
        <span class="s4">return function</span><span class="s3">() {</span>
            <span class="s4">return </span><span class="s1">process</span><span class="s3">.</span><span class="s1">emit</span><span class="s3">.</span><span class="s1">apply</span><span class="s3">(</span><span class="s1">process</span><span class="s3">, </span><span class="s1">arguments</span><span class="s3">);</span>
        <span class="s3">};</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">) {</span>
            <span class="s4">return function</span><span class="s3">() {</span>
                <span class="s4">return false</span><span class="s3">;</span>
            <span class="s3">};</span>
        <span class="s3">}</span>
        <span class="s4">return function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">methodName </span><span class="s3">= </span><span class="s5">&quot;on&quot; </span><span class="s3">+ </span><span class="s1">name</span><span class="s3">.</span><span class="s1">toLowerCase</span><span class="s3">();</span>
            <span class="s4">var </span><span class="s1">method </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">[</span><span class="s1">methodName</span><span class="s3">];</span>
            <span class="s4">if </span><span class="s3">(!</span><span class="s1">method</span><span class="s3">) </span><span class="s4">return false</span><span class="s3">;</span>
            <span class="s1">method</span><span class="s3">.</span><span class="s1">apply</span><span class="s3">(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">global</span><span class="s3">, [].</span><span class="s1">slice</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">arguments</span><span class="s3">, </span><span class="s6">1</span><span class="s3">));</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s3">};</span>
    <span class="s3">}</span>
<span class="s3">})();</span>

<span class="s4">function </span><span class="s1">generatePromiseLifecycleEventObject</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s3">{</span><span class="s1">promise</span><span class="s3">: </span><span class="s1">promise</span><span class="s3">};</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">eventToObjectGenerator </span><span class="s3">= {</span>
    <span class="s1">promiseCreated</span><span class="s3">: </span><span class="s1">generatePromiseLifecycleEventObject</span><span class="s3">,</span>
    <span class="s1">promiseFulfilled</span><span class="s3">: </span><span class="s1">generatePromiseLifecycleEventObject</span><span class="s3">,</span>
    <span class="s1">promiseRejected</span><span class="s3">: </span><span class="s1">generatePromiseLifecycleEventObject</span><span class="s3">,</span>
    <span class="s1">promiseResolved</span><span class="s3">: </span><span class="s1">generatePromiseLifecycleEventObject</span><span class="s3">,</span>
    <span class="s1">promiseCancelled</span><span class="s3">: </span><span class="s1">generatePromiseLifecycleEventObject</span><span class="s3">,</span>
    <span class="s1">promiseChained</span><span class="s3">: </span><span class="s4">function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">, </span><span class="s1">child</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s3">{</span><span class="s1">promise</span><span class="s3">: </span><span class="s1">promise</span><span class="s3">, </span><span class="s1">child</span><span class="s3">: </span><span class="s1">child</span><span class="s3">};</span>
    <span class="s3">},</span>
    <span class="s1">warning</span><span class="s3">: </span><span class="s4">function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">warning</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s3">{</span><span class="s1">warning</span><span class="s3">: </span><span class="s1">warning</span><span class="s3">};</span>
    <span class="s3">},</span>
    <span class="s1">unhandledRejection</span><span class="s3">: </span><span class="s4">function </span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s3">{</span><span class="s1">reason</span><span class="s3">: </span><span class="s1">reason</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">: </span><span class="s1">promise</span><span class="s3">};</span>
    <span class="s3">},</span>
    <span class="s1">rejectionHandled</span><span class="s3">: </span><span class="s1">generatePromiseLifecycleEventObject</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">activeFireEvent </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">name</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">globalEventFired </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">try </span><span class="s3">{</span>
        <span class="s1">globalEventFired </span><span class="s3">= </span><span class="s1">fireGlobalEvent</span><span class="s3">.</span><span class="s1">apply</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">arguments</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s1">async</span><span class="s3">.</span><span class="s1">throwLater</span><span class="s3">(</span><span class="s1">e</span><span class="s3">);</span>
        <span class="s1">globalEventFired </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">var </span><span class="s1">domEventFired </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">try </span><span class="s3">{</span>
        <span class="s1">domEventFired </span><span class="s3">= </span><span class="s1">fireDomEvent</span><span class="s3">(</span><span class="s1">name</span><span class="s3">,</span>
                    <span class="s1">eventToObjectGenerator</span><span class="s3">[</span><span class="s1">name</span><span class="s3">].</span><span class="s1">apply</span><span class="s3">(</span><span class="s4">null</span><span class="s3">, </span><span class="s1">arguments</span><span class="s3">));</span>
    <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s1">async</span><span class="s3">.</span><span class="s1">throwLater</span><span class="s3">(</span><span class="s1">e</span><span class="s3">);</span>
        <span class="s1">domEventFired </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">return </span><span class="s1">domEventFired </span><span class="s3">|| </span><span class="s1">globalEventFired</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">config </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">opts</span><span class="s3">) {</span>
    <span class="s1">opts </span><span class="s3">= </span><span class="s1">Object</span><span class="s3">(</span><span class="s1">opts</span><span class="s3">);</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s5">&quot;longStackTraces&quot; </span><span class="s4">in </span><span class="s1">opts</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">opts</span><span class="s3">.</span><span class="s1">longStackTraces</span><span class="s3">) {</span>
            <span class="s1">Promise</span><span class="s3">.</span><span class="s1">longStackTraces</span><span class="s3">();</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(!</span><span class="s1">opts</span><span class="s3">.</span><span class="s1">longStackTraces </span><span class="s3">&amp;&amp; </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">hasLongStackTraces</span><span class="s3">()) {</span>
            <span class="s1">disableLongStackTraces</span><span class="s3">();</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s5">&quot;warnings&quot; </span><span class="s4">in </span><span class="s1">opts</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">warningsOption </span><span class="s3">= </span><span class="s1">opts</span><span class="s3">.</span><span class="s1">warnings</span><span class="s3">;</span>
        <span class="s1">config</span><span class="s3">.</span><span class="s1">warnings </span><span class="s3">= !!</span><span class="s1">warningsOption</span><span class="s3">;</span>
        <span class="s1">wForgottenReturn </span><span class="s3">= </span><span class="s1">config</span><span class="s3">.</span><span class="s1">warnings</span><span class="s3">;</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">isObject</span><span class="s3">(</span><span class="s1">warningsOption</span><span class="s3">)) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s5">&quot;wForgottenReturn&quot; </span><span class="s4">in </span><span class="s1">warningsOption</span><span class="s3">) {</span>
                <span class="s1">wForgottenReturn </span><span class="s3">= !!</span><span class="s1">warningsOption</span><span class="s3">.</span><span class="s1">wForgottenReturn</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s5">&quot;cancellation&quot; </span><span class="s4">in </span><span class="s1">opts </span><span class="s3">&amp;&amp; </span><span class="s1">opts</span><span class="s3">.</span><span class="s1">cancellation </span><span class="s3">&amp;&amp; !</span><span class="s1">config</span><span class="s3">.</span><span class="s1">cancellation</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">async</span><span class="s3">.</span><span class="s1">haveItemsQueued</span><span class="s3">()) {</span>
            <span class="s4">throw new </span><span class="s1">Error</span><span class="s3">(</span>
                <span class="s5">&quot;cannot enable cancellation after promises are in use&quot;</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_clearCancellationData </span><span class="s3">=</span>
            <span class="s1">cancellationClearCancellationData</span><span class="s3">;</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_propagateFrom </span><span class="s3">= </span><span class="s1">cancellationPropagateFrom</span><span class="s3">;</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_onCancel </span><span class="s3">= </span><span class="s1">cancellationOnCancel</span><span class="s3">;</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setOnCancel </span><span class="s3">= </span><span class="s1">cancellationSetOnCancel</span><span class="s3">;</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_attachCancellationCallback </span><span class="s3">=</span>
            <span class="s1">cancellationAttachCancellationCallback</span><span class="s3">;</span>
        <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_execute </span><span class="s3">= </span><span class="s1">cancellationExecute</span><span class="s3">;</span>
        <span class="s1">propagateFromFunction </span><span class="s3">= </span><span class="s1">cancellationPropagateFrom</span><span class="s3">;</span>
        <span class="s1">config</span><span class="s3">.</span><span class="s1">cancellation </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s5">&quot;monitoring&quot; </span><span class="s4">in </span><span class="s1">opts</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">opts</span><span class="s3">.</span><span class="s1">monitoring </span><span class="s3">&amp;&amp; !</span><span class="s1">config</span><span class="s3">.</span><span class="s1">monitoring</span><span class="s3">) {</span>
            <span class="s1">config</span><span class="s3">.</span><span class="s1">monitoring </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
            <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_fireEvent </span><span class="s3">= </span><span class="s1">activeFireEvent</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(!</span><span class="s1">opts</span><span class="s3">.</span><span class="s1">monitoring </span><span class="s3">&amp;&amp; </span><span class="s1">config</span><span class="s3">.</span><span class="s1">monitoring</span><span class="s3">) {</span>
            <span class="s1">config</span><span class="s3">.</span><span class="s1">monitoring </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
            <span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_fireEvent </span><span class="s3">= </span><span class="s1">defaultFireEvent</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s5">&quot;asyncHooks&quot; </span><span class="s4">in </span><span class="s1">opts </span><span class="s3">&amp;&amp; </span><span class="s1">util</span><span class="s3">.</span><span class="s1">nodeSupportsAsyncResource</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">prev </span><span class="s3">= </span><span class="s1">config</span><span class="s3">.</span><span class="s1">asyncHooks</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">cur </span><span class="s3">= !!</span><span class="s1">opts</span><span class="s3">.</span><span class="s1">asyncHooks</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">prev </span><span class="s3">!== </span><span class="s1">cur</span><span class="s3">) {</span>
            <span class="s1">config</span><span class="s3">.</span><span class="s1">asyncHooks </span><span class="s3">= </span><span class="s1">cur</span><span class="s3">;</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">cur</span><span class="s3">) {</span>
                <span class="s1">enableAsyncHooks</span><span class="s3">();</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">disableAsyncHooks</span><span class="s3">();</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">Promise</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">function </span><span class="s1">defaultFireEvent</span><span class="s3">() { </span><span class="s4">return false</span><span class="s3">; }</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_fireEvent </span><span class="s3">= </span><span class="s1">defaultFireEvent</span><span class="s3">;</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_execute </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">executor</span><span class="s3">, </span><span class="s1">resolve</span><span class="s3">, </span><span class="s1">reject</span><span class="s3">) {</span>
    <span class="s4">try </span><span class="s3">{</span>
        <span class="s1">executor</span><span class="s3">(</span><span class="s1">resolve</span><span class="s3">, </span><span class="s1">reject</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">e</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">};</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_onCancel </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {};</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setOnCancel </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">handler</span><span class="s3">) { ; };</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_attachCancellationCallback </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">onCancel</span><span class="s3">) {</span>
    <span class="s3">;</span>
<span class="s3">};</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_captureStackTrace </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {};</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_attachExtraTrace </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {};</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_dereferenceTrace </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {};</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_clearCancellationData </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {};</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_propagateFrom </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">parent</span><span class="s3">, </span><span class="s1">flags</span><span class="s3">) {</span>
    <span class="s3">;</span>
    <span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">function </span><span class="s1">cancellationExecute</span><span class="s3">(</span><span class="s1">executor</span><span class="s3">, </span><span class="s1">resolve</span><span class="s3">, </span><span class="s1">reject</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s4">this</span><span class="s3">;</span>
    <span class="s4">try </span><span class="s3">{</span>
        <span class="s1">executor</span><span class="s3">(</span><span class="s1">resolve</span><span class="s3">, </span><span class="s1">reject</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">onCancel</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">onCancel </span><span class="s3">!== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
                <span class="s4">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s5">&quot;onCancel must be a function, got: &quot; </span><span class="s3">+</span>
                                    <span class="s1">util</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">(</span><span class="s1">onCancel</span><span class="s3">));</span>
            <span class="s3">}</span>
            <span class="s1">promise</span><span class="s3">.</span><span class="s1">_attachCancellationCallback</span><span class="s3">(</span><span class="s1">onCancel</span><span class="s3">);</span>
        <span class="s3">});</span>
    <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">e</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">cancellationAttachCancellationCallback</span><span class="s3">(</span><span class="s1">onCancel</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_isCancellable</span><span class="s3">()) </span><span class="s4">return this</span><span class="s3">;</span>

    <span class="s4">var </span><span class="s1">previousOnCancel </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_onCancel</span><span class="s3">();</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">previousOnCancel </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">isArray</span><span class="s3">(</span><span class="s1">previousOnCancel</span><span class="s3">)) {</span>
            <span class="s1">previousOnCancel</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">onCancel</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_setOnCancel</span><span class="s3">([</span><span class="s1">previousOnCancel</span><span class="s3">, </span><span class="s1">onCancel</span><span class="s3">]);</span>
        <span class="s3">}</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_setOnCancel</span><span class="s3">(</span><span class="s1">onCancel</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">cancellationOnCancel</span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_onCancelField</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">cancellationSetOnCancel</span><span class="s3">(</span><span class="s1">onCancel</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_onCancelField </span><span class="s3">= </span><span class="s1">onCancel</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">cancellationClearCancellationData</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_cancellationParent </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_onCancelField </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">cancellationPropagateFrom</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">, </span><span class="s1">flags</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">((</span><span class="s1">flags </span><span class="s3">&amp; </span><span class="s6">1</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_cancellationParent </span><span class="s3">= </span><span class="s1">parent</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">branchesRemainingToCancel </span><span class="s3">= </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">_branchesRemainingToCancel</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">branchesRemainingToCancel </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) {</span>
            <span class="s1">branchesRemainingToCancel </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s1">parent</span><span class="s3">.</span><span class="s1">_branchesRemainingToCancel </span><span class="s3">= </span><span class="s1">branchesRemainingToCancel </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">((</span><span class="s1">flags </span><span class="s3">&amp; </span><span class="s6">2</span><span class="s3">) !== </span><span class="s6">0 </span><span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">_isBound</span><span class="s3">()) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_setBoundTo</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">.</span><span class="s1">_boundTo</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">bindingPropagateFrom</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">, </span><span class="s1">flags</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">((</span><span class="s1">flags </span><span class="s3">&amp; </span><span class="s6">2</span><span class="s3">) !== </span><span class="s6">0 </span><span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">_isBound</span><span class="s3">()) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_setBoundTo</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">.</span><span class="s1">_boundTo</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">}</span>
<span class="s4">var </span><span class="s1">propagateFromFunction </span><span class="s3">= </span><span class="s1">bindingPropagateFrom</span><span class="s3">;</span>

<span class="s4">function </span><span class="s1">boundValueFunction</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_boundTo</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">ret </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">ret </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">ret</span><span class="s3">.</span><span class="s1">isFulfilled</span><span class="s3">()) {</span>
                <span class="s4">return </span><span class="s1">ret</span><span class="s3">.</span><span class="s1">value</span><span class="s3">();</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s4">return </span><span class="s1">undefined</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">longStackTracesCaptureStackTrace</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_trace </span><span class="s3">= </span><span class="s4">new </span><span class="s1">CapturedTrace</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_peekContext</span><span class="s3">());</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">longStackTracesAttachExtraTrace</span><span class="s3">(</span><span class="s1">error</span><span class="s3">, </span><span class="s1">ignoreSelf</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">canAttachTrace</span><span class="s3">(</span><span class="s1">error</span><span class="s3">)) {</span>
        <span class="s4">var </span><span class="s1">trace </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_trace</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">trace </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">ignoreSelf</span><span class="s3">) </span><span class="s1">trace </span><span class="s3">= </span><span class="s1">trace</span><span class="s3">.</span><span class="s1">_parent</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">trace </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
            <span class="s1">trace</span><span class="s3">.</span><span class="s1">attachExtraTrace</span><span class="s3">(</span><span class="s1">error</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(!</span><span class="s1">error</span><span class="s3">.</span><span class="s1">__stackCleaned__</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">parsed </span><span class="s3">= </span><span class="s1">parseStackAndMessage</span><span class="s3">(</span><span class="s1">error</span><span class="s3">);</span>
            <span class="s1">util</span><span class="s3">.</span><span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s1">error</span><span class="s3">, </span><span class="s5">&quot;stack&quot;</span><span class="s3">,</span>
                <span class="s1">parsed</span><span class="s3">.</span><span class="s1">message </span><span class="s3">+ </span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot; </span><span class="s3">+ </span><span class="s1">parsed</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">));</span>
            <span class="s1">util</span><span class="s3">.</span><span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s1">error</span><span class="s3">, </span><span class="s5">&quot;__stackCleaned__&quot;</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">longStackTracesDereferenceTrace</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_trace </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">checkForgottenReturns</span><span class="s3">(</span><span class="s1">returnValue</span><span class="s3">, </span><span class="s1">promiseCreated</span><span class="s3">, </span><span class="s1">name</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">,</span>
                               <span class="s1">parent</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">returnValue </span><span class="s3">=== </span><span class="s1">undefined </span><span class="s3">&amp;&amp; </span><span class="s1">promiseCreated </span><span class="s3">!== </span><span class="s4">null </span><span class="s3">&amp;&amp;</span>
        <span class="s1">wForgottenReturn</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">parent </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">_returnedNonUndefined</span><span class="s3">()) </span><span class="s4">return</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">((</span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">65535</span><span class="s3">) === </span><span class="s6">0</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">name</span><span class="s3">) </span><span class="s1">name </span><span class="s3">= </span><span class="s1">name </span><span class="s3">+ </span><span class="s5">&quot; &quot;</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">handlerLine </span><span class="s3">= </span><span class="s5">&quot;&quot;</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">creatorLine </span><span class="s3">= </span><span class="s5">&quot;&quot;</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">promiseCreated</span><span class="s3">.</span><span class="s1">_trace</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">traceLines </span><span class="s3">= </span><span class="s1">promiseCreated</span><span class="s3">.</span><span class="s1">_trace</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">);</span>
            <span class="s4">var </span><span class="s1">stack </span><span class="s3">= </span><span class="s1">cleanStack</span><span class="s3">(</span><span class="s1">traceLines</span><span class="s3">);</span>
            <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s1">stack</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s6">1</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&gt;= </span><span class="s6">0</span><span class="s3">; --</span><span class="s1">i</span><span class="s3">) {</span>
                <span class="s4">var </span><span class="s1">line </span><span class="s3">= </span><span class="s1">stack</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
                <span class="s4">if </span><span class="s3">(!</span><span class="s1">nodeFramePattern</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">line</span><span class="s3">)) {</span>
                    <span class="s4">var </span><span class="s1">lineMatches </span><span class="s3">= </span><span class="s1">line</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">parseLinePattern</span><span class="s3">);</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">lineMatches</span><span class="s3">) {</span>
                        <span class="s1">handlerLine  </span><span class="s3">= </span><span class="s5">&quot;at &quot; </span><span class="s3">+ </span><span class="s1">lineMatches</span><span class="s3">[</span><span class="s6">1</span><span class="s3">] +</span>
                            <span class="s5">&quot;:&quot; </span><span class="s3">+ </span><span class="s1">lineMatches</span><span class="s3">[</span><span class="s6">2</span><span class="s3">] + </span><span class="s5">&quot;:&quot; </span><span class="s3">+ </span><span class="s1">lineMatches</span><span class="s3">[</span><span class="s6">3</span><span class="s3">] + </span><span class="s5">&quot; &quot;</span><span class="s3">;</span>
                    <span class="s3">}</span>
                    <span class="s4">break</span><span class="s3">;</span>
                <span class="s3">}</span>
            <span class="s3">}</span>

            <span class="s4">if </span><span class="s3">(</span><span class="s1">stack</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s6">0</span><span class="s3">) {</span>
                <span class="s4">var </span><span class="s1">firstUserLine </span><span class="s3">= </span><span class="s1">stack</span><span class="s3">[</span><span class="s6">0</span><span class="s3">];</span>
                <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">traceLines</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>

                    <span class="s4">if </span><span class="s3">(</span><span class="s1">traceLines</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] === </span><span class="s1">firstUserLine</span><span class="s3">) {</span>
                        <span class="s4">if </span><span class="s3">(</span><span class="s1">i </span><span class="s3">&gt; </span><span class="s6">0</span><span class="s3">) {</span>
                            <span class="s1">creatorLine </span><span class="s3">= </span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot; </span><span class="s3">+ </span><span class="s1">traceLines</span><span class="s3">[</span><span class="s1">i </span><span class="s3">- </span><span class="s6">1</span><span class="s3">];</span>
                        <span class="s3">}</span>
                        <span class="s4">break</span><span class="s3">;</span>
                    <span class="s3">}</span>
                <span class="s3">}</span>

            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">var </span><span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;a promise was created in a &quot; </span><span class="s3">+ </span><span class="s1">name </span><span class="s3">+</span>
            <span class="s5">&quot;handler &quot; </span><span class="s3">+ </span><span class="s1">handlerLine </span><span class="s3">+ </span><span class="s5">&quot;but was not returned from it, &quot; </span><span class="s3">+</span>
            <span class="s5">&quot;see http://goo.gl/rRqMUw&quot; </span><span class="s3">+</span>
            <span class="s1">creatorLine</span><span class="s3">;</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_warn</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">, </span><span class="s4">true</span><span class="s3">, </span><span class="s1">promiseCreated</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">deprecated</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">replacement</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">message </span><span class="s3">= </span><span class="s1">name </span><span class="s3">+</span>
        <span class="s5">&quot; is deprecated and will be removed in a future version.&quot;</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">replacement</span><span class="s3">) </span><span class="s1">message </span><span class="s3">+= </span><span class="s5">&quot; Use &quot; </span><span class="s3">+ </span><span class="s1">replacement </span><span class="s3">+ </span><span class="s5">&quot; instead.&quot;</span><span class="s3">;</span>
    <span class="s4">return </span><span class="s1">warn</span><span class="s3">(</span><span class="s1">message</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">warn</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">shouldUseOwnTrace</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s1">config</span><span class="s3">.</span><span class="s1">warnings</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">warning </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Warning</span><span class="s3">(</span><span class="s1">message</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">ctx</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">shouldUseOwnTrace</span><span class="s3">) {</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_attachExtraTrace</span><span class="s3">(</span><span class="s1">warning</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">config</span><span class="s3">.</span><span class="s1">longStackTraces </span><span class="s3">&amp;&amp; (</span><span class="s1">ctx </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">_peekContext</span><span class="s3">())) {</span>
        <span class="s1">ctx</span><span class="s3">.</span><span class="s1">attachExtraTrace</span><span class="s3">(</span><span class="s1">warning</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">var </span><span class="s1">parsed </span><span class="s3">= </span><span class="s1">parseStackAndMessage</span><span class="s3">(</span><span class="s1">warning</span><span class="s3">);</span>
        <span class="s1">warning</span><span class="s3">.</span><span class="s1">stack </span><span class="s3">= </span><span class="s1">parsed</span><span class="s3">.</span><span class="s1">message </span><span class="s3">+ </span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot; </span><span class="s3">+ </span><span class="s1">parsed</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s4">if </span><span class="s3">(!</span><span class="s1">activeFireEvent</span><span class="s3">(</span><span class="s5">&quot;warning&quot;</span><span class="s3">, </span><span class="s1">warning</span><span class="s3">)) {</span>
        <span class="s1">formatAndLogError</span><span class="s3">(</span><span class="s1">warning</span><span class="s3">, </span><span class="s5">&quot;&quot;</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">reconstructStack</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">stacks</span><span class="s3">) {</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">stacks</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s6">1</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s1">stacks</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">push</span><span class="s3">(</span><span class="s5">&quot;From previous event:&quot;</span><span class="s3">);</span>
        <span class="s1">stacks</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">stacks</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">join</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">stacks</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
        <span class="s1">stacks</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">stacks</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">join</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">message </span><span class="s3">+ </span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot; </span><span class="s3">+ </span><span class="s1">stacks</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">removeDuplicateOrEmptyJumps</span><span class="s3">(</span><span class="s1">stacks</span><span class="s3">) {</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">stacks</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">stacks</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">length </span><span class="s3">=== </span><span class="s6">0 </span><span class="s3">||</span>
            <span class="s3">((</span><span class="s1">i </span><span class="s3">+ </span><span class="s6">1 </span><span class="s3">&lt; </span><span class="s1">stacks</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) &amp;&amp; </span><span class="s1">stacks</span><span class="s3">[</span><span class="s1">i</span><span class="s3">][</span><span class="s6">0</span><span class="s3">] === </span><span class="s1">stacks</span><span class="s3">[</span><span class="s1">i</span><span class="s3">+</span><span class="s6">1</span><span class="s3">][</span><span class="s6">0</span><span class="s3">])) {</span>
            <span class="s1">stacks</span><span class="s3">.</span><span class="s1">splice</span><span class="s3">(</span><span class="s1">i</span><span class="s3">, </span><span class="s6">1</span><span class="s3">);</span>
            <span class="s1">i</span><span class="s3">--;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">removeCommonRoots</span><span class="s3">(</span><span class="s1">stacks</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">current </span><span class="s3">= </span><span class="s1">stacks</span><span class="s3">[</span><span class="s6">0</span><span class="s3">];</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">1</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">stacks</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">prev </span><span class="s3">= </span><span class="s1">stacks</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
        <span class="s4">var </span><span class="s1">currentLastIndex </span><span class="s3">= </span><span class="s1">current</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s6">1</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">currentLastLine </span><span class="s3">= </span><span class="s1">current</span><span class="s3">[</span><span class="s1">currentLastIndex</span><span class="s3">];</span>
        <span class="s4">var </span><span class="s1">commonRootMeetPoint </span><span class="s3">= -</span><span class="s6">1</span><span class="s3">;</span>

        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">j </span><span class="s3">= </span><span class="s1">prev</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s6">1</span><span class="s3">; </span><span class="s1">j </span><span class="s3">&gt;= </span><span class="s6">0</span><span class="s3">; --</span><span class="s1">j</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">prev</span><span class="s3">[</span><span class="s1">j</span><span class="s3">] === </span><span class="s1">currentLastLine</span><span class="s3">) {</span>
                <span class="s1">commonRootMeetPoint </span><span class="s3">= </span><span class="s1">j</span><span class="s3">;</span>
                <span class="s4">break</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>

        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">j </span><span class="s3">= </span><span class="s1">commonRootMeetPoint</span><span class="s3">; </span><span class="s1">j </span><span class="s3">&gt;= </span><span class="s6">0</span><span class="s3">; --</span><span class="s1">j</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">line </span><span class="s3">= </span><span class="s1">prev</span><span class="s3">[</span><span class="s1">j</span><span class="s3">];</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">current</span><span class="s3">[</span><span class="s1">currentLastIndex</span><span class="s3">] === </span><span class="s1">line</span><span class="s3">) {</span>
                <span class="s1">current</span><span class="s3">.</span><span class="s1">pop</span><span class="s3">();</span>
                <span class="s1">currentLastIndex</span><span class="s3">--;</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s4">break</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s1">current </span><span class="s3">= </span><span class="s1">prev</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">cleanStack</span><span class="s3">(</span><span class="s1">stack</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= [];</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">stack</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">line </span><span class="s3">= </span><span class="s1">stack</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
        <span class="s4">var </span><span class="s1">isTraceLine </span><span class="s3">= </span><span class="s5">&quot;    (No stack trace)&quot; </span><span class="s3">=== </span><span class="s1">line </span><span class="s3">||</span>
            <span class="s1">stackFramePattern</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">line</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">isInternalFrame </span><span class="s3">= </span><span class="s1">isTraceLine </span><span class="s3">&amp;&amp; </span><span class="s1">shouldIgnore</span><span class="s3">(</span><span class="s1">line</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">isTraceLine </span><span class="s3">&amp;&amp; !</span><span class="s1">isInternalFrame</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">indentStackFrames </span><span class="s3">&amp;&amp; </span><span class="s1">line</span><span class="s3">.</span><span class="s1">charAt</span><span class="s3">(</span><span class="s6">0</span><span class="s3">) !== </span><span class="s5">&quot; &quot;</span><span class="s3">) {</span>
                <span class="s1">line </span><span class="s3">= </span><span class="s5">&quot;    &quot; </span><span class="s3">+ </span><span class="s1">line</span><span class="s3">;</span>
            <span class="s3">}</span>
            <span class="s1">ret</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">line</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">stackFramesAsArray</span><span class="s3">(</span><span class="s1">error</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">stack </span><span class="s3">= </span><span class="s1">error</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s7">/\s+$/g</span><span class="s3">, </span><span class="s5">&quot;&quot;</span><span class="s3">).</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">);</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">stack</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">line </span><span class="s3">= </span><span class="s1">stack</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s5">&quot;    (No stack trace)&quot; </span><span class="s3">=== </span><span class="s1">line </span><span class="s3">|| </span><span class="s1">stackFramePattern</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">line</span><span class="s3">)) {</span>
            <span class="s4">break</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">i </span><span class="s3">&gt; </span><span class="s6">0 </span><span class="s3">&amp;&amp; </span><span class="s1">error</span><span class="s3">.</span><span class="s1">name </span><span class="s3">!= </span><span class="s5">&quot;SyntaxError&quot;</span><span class="s3">) {</span>
        <span class="s1">stack </span><span class="s3">= </span><span class="s1">stack</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s1">i</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">stack</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">parseStackAndMessage</span><span class="s3">(</span><span class="s1">error</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">stack </span><span class="s3">= </span><span class="s1">error</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">message </span><span class="s3">= </span><span class="s1">error</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">();</span>
    <span class="s1">stack </span><span class="s3">= </span><span class="s4">typeof </span><span class="s1">stack </span><span class="s3">=== </span><span class="s5">&quot;string&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">stack</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s6">0</span>
                <span class="s3">? </span><span class="s1">stackFramesAsArray</span><span class="s3">(</span><span class="s1">error</span><span class="s3">) : [</span><span class="s5">&quot;    (No stack trace)&quot;</span><span class="s3">];</span>
    <span class="s4">return </span><span class="s3">{</span>
        <span class="s1">message</span><span class="s3">: </span><span class="s1">message</span><span class="s3">,</span>
        <span class="s1">stack</span><span class="s3">: </span><span class="s1">error</span><span class="s3">.</span><span class="s1">name </span><span class="s3">== </span><span class="s5">&quot;SyntaxError&quot; </span><span class="s3">? </span><span class="s1">stack </span><span class="s3">: </span><span class="s1">cleanStack</span><span class="s3">(</span><span class="s1">stack</span><span class="s3">)</span>
    <span class="s3">};</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">formatAndLogError</span><span class="s3">(</span><span class="s1">error</span><span class="s3">, </span><span class="s1">title</span><span class="s3">, </span><span class="s1">isSoft</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">console </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">message</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">isObject</span><span class="s3">(</span><span class="s1">error</span><span class="s3">)) {</span>
            <span class="s4">var </span><span class="s1">stack </span><span class="s3">= </span><span class="s1">error</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">;</span>
            <span class="s1">message </span><span class="s3">= </span><span class="s1">title </span><span class="s3">+ </span><span class="s1">formatStack</span><span class="s3">(</span><span class="s1">stack</span><span class="s3">, </span><span class="s1">error</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">message </span><span class="s3">= </span><span class="s1">title </span><span class="s3">+ </span><span class="s1">String</span><span class="s3">(</span><span class="s1">error</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">printWarning </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s1">printWarning</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">isSoft</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">console</span><span class="s3">.</span><span class="s1">log </span><span class="s3">=== </span><span class="s5">&quot;function&quot; </span><span class="s3">||</span>
            <span class="s4">typeof </span><span class="s1">console</span><span class="s3">.</span><span class="s1">log </span><span class="s3">=== </span><span class="s5">&quot;object&quot;</span><span class="s3">) {</span>
            <span class="s1">console</span><span class="s3">.</span><span class="s1">log</span><span class="s3">(</span><span class="s1">message</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">fireRejectionEvent</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">localHandler</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">localEventFired </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">try </span><span class="s3">{</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">localHandler </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s1">localEventFired </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">name </span><span class="s3">=== </span><span class="s5">&quot;rejectionHandled&quot;</span><span class="s3">) {</span>
                <span class="s1">localHandler</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">localHandler</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s1">async</span><span class="s3">.</span><span class="s1">throwLater</span><span class="s3">(</span><span class="s1">e</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">name </span><span class="s3">=== </span><span class="s5">&quot;unhandledRejection&quot;</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">activeFireEvent</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">) &amp;&amp; !</span><span class="s1">localEventFired</span><span class="s3">) {</span>
            <span class="s1">formatAndLogError</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">, </span><span class="s5">&quot;Unhandled rejection &quot;</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s1">activeFireEvent</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">formatNonError</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">str</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">obj </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s1">str </span><span class="s3">= </span><span class="s5">&quot;[function &quot; </span><span class="s3">+</span>
            <span class="s3">(</span><span class="s1">obj</span><span class="s3">.</span><span class="s1">name </span><span class="s3">|| </span><span class="s5">&quot;anonymous&quot;</span><span class="s3">) +</span>
            <span class="s5">&quot;]&quot;</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s1">str </span><span class="s3">= </span><span class="s1">obj </span><span class="s3">&amp;&amp; </span><span class="s4">typeof </span><span class="s1">obj</span><span class="s3">.</span><span class="s1">toString </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span>
            <span class="s3">? </span><span class="s1">obj</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">() : </span><span class="s1">util</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">ruselessToString </span><span class="s3">= </span><span class="s7">/\[object [a-zA-Z0-9$_]+\]/</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">ruselessToString</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">str</span><span class="s3">)) {</span>
            <span class="s4">try </span><span class="s3">{</span>
                <span class="s4">var </span><span class="s1">newStr </span><span class="s3">= </span><span class="s1">JSON</span><span class="s3">.</span><span class="s1">stringify</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">);</span>
                <span class="s1">str </span><span class="s3">= </span><span class="s1">newStr</span><span class="s3">;</span>
            <span class="s3">}</span>
            <span class="s4">catch</span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>

            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">str</span><span class="s3">.</span><span class="s1">length </span><span class="s3">=== </span><span class="s6">0</span><span class="s3">) {</span>
            <span class="s1">str </span><span class="s3">= </span><span class="s5">&quot;(empty array)&quot;</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s5">&quot;(&lt;&quot; </span><span class="s3">+ </span><span class="s1">snip</span><span class="s3">(</span><span class="s1">str</span><span class="s3">) + </span><span class="s5">&quot;&gt;, no stack trace)&quot;</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">snip</span><span class="s3">(</span><span class="s1">str</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">maxChars </span><span class="s3">= </span><span class="s6">41</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">str</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&lt; </span><span class="s1">maxChars</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">str</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">str</span><span class="s3">.</span><span class="s1">substr</span><span class="s3">(</span><span class="s6">0</span><span class="s3">, </span><span class="s1">maxChars </span><span class="s3">- </span><span class="s6">3</span><span class="s3">) + </span><span class="s5">&quot;...&quot;</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">longStackTracesIsSupported</span><span class="s3">() {</span>
    <span class="s4">return typeof </span><span class="s1">captureStackTrace </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">shouldIgnore </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() { </span><span class="s4">return false</span><span class="s3">; };</span>
<span class="s4">var </span><span class="s1">parseLineInfoRegex </span><span class="s3">= </span><span class="s7">/[\/&lt;\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/</span><span class="s3">;</span>
<span class="s4">function </span><span class="s1">parseLineInfo</span><span class="s3">(</span><span class="s1">line</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">matches </span><span class="s3">= </span><span class="s1">line</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">parseLineInfoRegex</span><span class="s3">);</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">matches</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s3">{</span>
            <span class="s1">fileName</span><span class="s3">: </span><span class="s1">matches</span><span class="s3">[</span><span class="s6">1</span><span class="s3">],</span>
            <span class="s1">line</span><span class="s3">: </span><span class="s1">parseInt</span><span class="s3">(</span><span class="s1">matches</span><span class="s3">[</span><span class="s6">2</span><span class="s3">], </span><span class="s6">10</span><span class="s3">)</span>
        <span class="s3">};</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">setBounds</span><span class="s3">(</span><span class="s1">firstLineError</span><span class="s3">, </span><span class="s1">lastLineError</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s1">longStackTracesIsSupported</span><span class="s3">()) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">firstStackLines </span><span class="s3">= (</span><span class="s1">firstLineError</span><span class="s3">.</span><span class="s1">stack </span><span class="s3">|| </span><span class="s5">&quot;&quot;</span><span class="s3">).</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">lastStackLines </span><span class="s3">= (</span><span class="s1">lastLineError</span><span class="s3">.</span><span class="s1">stack </span><span class="s3">|| </span><span class="s5">&quot;&quot;</span><span class="s3">).</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">firstIndex </span><span class="s3">= -</span><span class="s6">1</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">lastIndex </span><span class="s3">= -</span><span class="s6">1</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">firstFileName</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">lastFileName</span><span class="s3">;</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">firstStackLines</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">result </span><span class="s3">= </span><span class="s1">parseLineInfo</span><span class="s3">(</span><span class="s1">firstStackLines</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">result</span><span class="s3">) {</span>
            <span class="s1">firstFileName </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">fileName</span><span class="s3">;</span>
            <span class="s1">firstIndex </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">line</span><span class="s3">;</span>
            <span class="s4">break</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">lastStackLines</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">result </span><span class="s3">= </span><span class="s1">parseLineInfo</span><span class="s3">(</span><span class="s1">lastStackLines</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">result</span><span class="s3">) {</span>
            <span class="s1">lastFileName </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">fileName</span><span class="s3">;</span>
            <span class="s1">lastIndex </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">line</span><span class="s3">;</span>
            <span class="s4">break</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">firstIndex </span><span class="s3">&lt; </span><span class="s6">0 </span><span class="s3">|| </span><span class="s1">lastIndex </span><span class="s3">&lt; </span><span class="s6">0 </span><span class="s3">|| !</span><span class="s1">firstFileName </span><span class="s3">|| !</span><span class="s1">lastFileName </span><span class="s3">||</span>
        <span class="s1">firstFileName </span><span class="s3">!== </span><span class="s1">lastFileName </span><span class="s3">|| </span><span class="s1">firstIndex </span><span class="s3">&gt;= </span><span class="s1">lastIndex</span><span class="s3">) {</span>
        <span class="s4">return</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s1">shouldIgnore </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">line</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">bluebirdFramePattern</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">line</span><span class="s3">)) </span><span class="s4">return true</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">info </span><span class="s3">= </span><span class="s1">parseLineInfo</span><span class="s3">(</span><span class="s1">line</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">info</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">fileName </span><span class="s3">=== </span><span class="s1">firstFileName </span><span class="s3">&amp;&amp;</span>
                <span class="s3">(</span><span class="s1">firstIndex </span><span class="s3">&lt;= </span><span class="s1">info</span><span class="s3">.</span><span class="s1">line </span><span class="s3">&amp;&amp; </span><span class="s1">info</span><span class="s3">.</span><span class="s1">line </span><span class="s3">&lt;= </span><span class="s1">lastIndex</span><span class="s3">)) {</span>
                <span class="s4">return true</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">return false</span><span class="s3">;</span>
    <span class="s3">};</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">CapturedTrace</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_parent </span><span class="s3">= </span><span class="s1">parent</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_promisesCreated </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">length </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_length </span><span class="s3">= </span><span class="s6">1 </span><span class="s3">+ (</span><span class="s1">parent </span><span class="s3">=== </span><span class="s1">undefined </span><span class="s3">? </span><span class="s6">0 </span><span class="s3">: </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">_length</span><span class="s3">);</span>
    <span class="s1">captureStackTrace</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s1">CapturedTrace</span><span class="s3">);</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s6">32</span><span class="s3">) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">uncycle</span><span class="s3">();</span>
<span class="s3">}</span>
<span class="s1">util</span><span class="s3">.</span><span class="s1">inherits</span><span class="s3">(</span><span class="s1">CapturedTrace</span><span class="s3">, </span><span class="s1">Error</span><span class="s3">);</span>
<span class="s1">Context</span><span class="s3">.</span><span class="s1">CapturedTrace </span><span class="s3">= </span><span class="s1">CapturedTrace</span><span class="s3">;</span>

<span class="s1">CapturedTrace</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">uncycle </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">length </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_length</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">length </span><span class="s3">&lt; </span><span class="s6">2</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">nodes </span><span class="s3">= [];</span>
    <span class="s4">var </span><span class="s1">stackToIndex </span><span class="s3">= {};</span>

    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">node </span><span class="s3">= </span><span class="s4">this</span><span class="s3">; </span><span class="s1">node </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s1">nodes</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">node</span><span class="s3">);</span>
        <span class="s1">node </span><span class="s3">= </span><span class="s1">node</span><span class="s3">.</span><span class="s1">_parent</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s1">length </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_length </span><span class="s3">= </span><span class="s1">i</span><span class="s3">;</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s1">length </span><span class="s3">- </span><span class="s6">1</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&gt;= </span><span class="s6">0</span><span class="s3">; --</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">stack </span><span class="s3">= </span><span class="s1">nodes</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">stack</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">stackToIndex</span><span class="s3">[</span><span class="s1">stack</span><span class="s3">] === </span><span class="s1">undefined</span><span class="s3">) {</span>
            <span class="s1">stackToIndex</span><span class="s3">[</span><span class="s1">stack</span><span class="s3">] = </span><span class="s1">i</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">currentStack </span><span class="s3">= </span><span class="s1">nodes</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">stack</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">index </span><span class="s3">= </span><span class="s1">stackToIndex</span><span class="s3">[</span><span class="s1">currentStack</span><span class="s3">];</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">index </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">&amp;&amp; </span><span class="s1">index </span><span class="s3">!== </span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">index </span><span class="s3">&gt; </span><span class="s6">0</span><span class="s3">) {</span>
                <span class="s1">nodes</span><span class="s3">[</span><span class="s1">index </span><span class="s3">- </span><span class="s6">1</span><span class="s3">].</span><span class="s1">_parent </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
                <span class="s1">nodes</span><span class="s3">[</span><span class="s1">index </span><span class="s3">- </span><span class="s6">1</span><span class="s3">].</span><span class="s1">_length </span><span class="s3">= </span><span class="s6">1</span><span class="s3">;</span>
            <span class="s3">}</span>
            <span class="s1">nodes</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">_parent </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
            <span class="s1">nodes</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">_length </span><span class="s3">= </span><span class="s6">1</span><span class="s3">;</span>
            <span class="s4">var </span><span class="s1">cycleEdgeNode </span><span class="s3">= </span><span class="s1">i </span><span class="s3">&gt; </span><span class="s6">0 </span><span class="s3">? </span><span class="s1">nodes</span><span class="s3">[</span><span class="s1">i </span><span class="s3">- </span><span class="s6">1</span><span class="s3">] : </span><span class="s4">this</span><span class="s3">;</span>

            <span class="s4">if </span><span class="s3">(</span><span class="s1">index </span><span class="s3">&lt; </span><span class="s1">length </span><span class="s3">- </span><span class="s6">1</span><span class="s3">) {</span>
                <span class="s1">cycleEdgeNode</span><span class="s3">.</span><span class="s1">_parent </span><span class="s3">= </span><span class="s1">nodes</span><span class="s3">[</span><span class="s1">index </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">];</span>
                <span class="s1">cycleEdgeNode</span><span class="s3">.</span><span class="s1">_parent</span><span class="s3">.</span><span class="s1">uncycle</span><span class="s3">();</span>
                <span class="s1">cycleEdgeNode</span><span class="s3">.</span><span class="s1">_length </span><span class="s3">=</span>
                    <span class="s1">cycleEdgeNode</span><span class="s3">.</span><span class="s1">_parent</span><span class="s3">.</span><span class="s1">_length </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">;</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">cycleEdgeNode</span><span class="s3">.</span><span class="s1">_parent </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
                <span class="s1">cycleEdgeNode</span><span class="s3">.</span><span class="s1">_length </span><span class="s3">= </span><span class="s6">1</span><span class="s3">;</span>
            <span class="s3">}</span>
            <span class="s4">var </span><span class="s1">currentChildLength </span><span class="s3">= </span><span class="s1">cycleEdgeNode</span><span class="s3">.</span><span class="s1">_length </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">;</span>
            <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">j </span><span class="s3">= </span><span class="s1">i </span><span class="s3">- </span><span class="s6">2</span><span class="s3">; </span><span class="s1">j </span><span class="s3">&gt;= </span><span class="s6">0</span><span class="s3">; --</span><span class="s1">j</span><span class="s3">) {</span>
                <span class="s1">nodes</span><span class="s3">[</span><span class="s1">j</span><span class="s3">].</span><span class="s1">_length </span><span class="s3">= </span><span class="s1">currentChildLength</span><span class="s3">;</span>
                <span class="s1">currentChildLength</span><span class="s3">++;</span>
            <span class="s3">}</span>
            <span class="s4">return</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">CapturedTrace</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">attachExtraTrace </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">error</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">error</span><span class="s3">.</span><span class="s1">__stackCleaned__</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">uncycle</span><span class="s3">();</span>
    <span class="s4">var </span><span class="s1">parsed </span><span class="s3">= </span><span class="s1">parseStackAndMessage</span><span class="s3">(</span><span class="s1">error</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">message </span><span class="s3">= </span><span class="s1">parsed</span><span class="s3">.</span><span class="s1">message</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">stacks </span><span class="s3">= [</span><span class="s1">parsed</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">];</span>

    <span class="s4">var </span><span class="s1">trace </span><span class="s3">= </span><span class="s4">this</span><span class="s3">;</span>
    <span class="s4">while </span><span class="s3">(</span><span class="s1">trace </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
        <span class="s1">stacks</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">cleanStack</span><span class="s3">(</span><span class="s1">trace</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">)));</span>
        <span class="s1">trace </span><span class="s3">= </span><span class="s1">trace</span><span class="s3">.</span><span class="s1">_parent</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s1">removeCommonRoots</span><span class="s3">(</span><span class="s1">stacks</span><span class="s3">);</span>
    <span class="s1">removeDuplicateOrEmptyJumps</span><span class="s3">(</span><span class="s1">stacks</span><span class="s3">);</span>
    <span class="s1">util</span><span class="s3">.</span><span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s1">error</span><span class="s3">, </span><span class="s5">&quot;stack&quot;</span><span class="s3">, </span><span class="s1">reconstructStack</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">stacks</span><span class="s3">));</span>
    <span class="s1">util</span><span class="s3">.</span><span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s1">error</span><span class="s3">, </span><span class="s5">&quot;__stackCleaned__&quot;</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">captureStackTrace </span><span class="s3">= (</span><span class="s4">function </span><span class="s1">stackDetection</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">v8stackFramePattern </span><span class="s3">= </span><span class="s7">/^\s*at\s*/</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">v8stackFormatter </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">stack</span><span class="s3">, </span><span class="s1">error</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">stack </span><span class="s3">=== </span><span class="s5">&quot;string&quot;</span><span class="s3">) </span><span class="s4">return </span><span class="s1">stack</span><span class="s3">;</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">error</span><span class="s3">.</span><span class="s1">name </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
            <span class="s1">error</span><span class="s3">.</span><span class="s1">message </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
            <span class="s4">return </span><span class="s1">error</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s4">return </span><span class="s1">formatNonError</span><span class="s3">(</span><span class="s1">error</span><span class="s3">);</span>
    <span class="s3">};</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">Error</span><span class="s3">.</span><span class="s1">stackTraceLimit </span><span class="s3">=== </span><span class="s5">&quot;number&quot; </span><span class="s3">&amp;&amp;</span>
        <span class="s4">typeof </span><span class="s1">Error</span><span class="s3">.</span><span class="s1">captureStackTrace </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s1">Error</span><span class="s3">.</span><span class="s1">stackTraceLimit </span><span class="s3">+= </span><span class="s6">6</span><span class="s3">;</span>
        <span class="s1">stackFramePattern </span><span class="s3">= </span><span class="s1">v8stackFramePattern</span><span class="s3">;</span>
        <span class="s1">formatStack </span><span class="s3">= </span><span class="s1">v8stackFormatter</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">captureStackTrace </span><span class="s3">= </span><span class="s1">Error</span><span class="s3">.</span><span class="s1">captureStackTrace</span><span class="s3">;</span>

        <span class="s1">shouldIgnore </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">line</span><span class="s3">) {</span>
            <span class="s4">return </span><span class="s1">bluebirdFramePattern</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">line</span><span class="s3">);</span>
        <span class="s3">};</span>
        <span class="s4">return function</span><span class="s3">(</span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">ignoreUntil</span><span class="s3">) {</span>
            <span class="s1">Error</span><span class="s3">.</span><span class="s1">stackTraceLimit </span><span class="s3">+= </span><span class="s6">6</span><span class="s3">;</span>
            <span class="s1">captureStackTrace</span><span class="s3">(</span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">ignoreUntil</span><span class="s3">);</span>
            <span class="s1">Error</span><span class="s3">.</span><span class="s1">stackTraceLimit </span><span class="s3">-= </span><span class="s6">6</span><span class="s3">;</span>
        <span class="s3">};</span>
    <span class="s3">}</span>
    <span class="s4">var </span><span class="s1">err </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Error</span><span class="s3">();</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">err</span><span class="s3">.</span><span class="s1">stack </span><span class="s3">=== </span><span class="s5">&quot;string&quot; </span><span class="s3">&amp;&amp;</span>
        <span class="s1">err</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">)[</span><span class="s6">0</span><span class="s3">].</span><span class="s1">indexOf</span><span class="s3">(</span><span class="s5">&quot;stackDetection@&quot;</span><span class="s3">) &gt;= </span><span class="s6">0</span><span class="s3">) {</span>
        <span class="s1">stackFramePattern </span><span class="s3">= </span><span class="s7">/@/</span><span class="s3">;</span>
        <span class="s1">formatStack </span><span class="s3">= </span><span class="s1">v8stackFormatter</span><span class="s3">;</span>
        <span class="s1">indentStackFrames </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
        <span class="s4">return function </span><span class="s1">captureStackTrace</span><span class="s3">(</span><span class="s1">o</span><span class="s3">) {</span>
            <span class="s1">o</span><span class="s3">.</span><span class="s1">stack </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Error</span><span class="s3">().</span><span class="s1">stack</span><span class="s3">;</span>
        <span class="s3">};</span>
    <span class="s3">}</span>

    <span class="s4">var </span><span class="s1">hasStackAfterThrow</span><span class="s3">;</span>
    <span class="s4">try </span><span class="s3">{ </span><span class="s4">throw new </span><span class="s1">Error</span><span class="s3">(); }</span>
    <span class="s4">catch</span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s1">hasStackAfterThrow </span><span class="s3">= (</span><span class="s5">&quot;stack&quot; </span><span class="s4">in </span><span class="s1">e</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">(!(</span><span class="s5">&quot;stack&quot; </span><span class="s4">in </span><span class="s1">err</span><span class="s3">) &amp;&amp; </span><span class="s1">hasStackAfterThrow </span><span class="s3">&amp;&amp;</span>
        <span class="s4">typeof </span><span class="s1">Error</span><span class="s3">.</span><span class="s1">stackTraceLimit </span><span class="s3">=== </span><span class="s5">&quot;number&quot;</span><span class="s3">) {</span>
        <span class="s1">stackFramePattern </span><span class="s3">= </span><span class="s1">v8stackFramePattern</span><span class="s3">;</span>
        <span class="s1">formatStack </span><span class="s3">= </span><span class="s1">v8stackFormatter</span><span class="s3">;</span>
        <span class="s4">return function </span><span class="s1">captureStackTrace</span><span class="s3">(</span><span class="s1">o</span><span class="s3">) {</span>
            <span class="s1">Error</span><span class="s3">.</span><span class="s1">stackTraceLimit </span><span class="s3">+= </span><span class="s6">6</span><span class="s3">;</span>
            <span class="s4">try </span><span class="s3">{ </span><span class="s4">throw new </span><span class="s1">Error</span><span class="s3">(); }</span>
            <span class="s4">catch</span><span class="s3">(</span><span class="s1">e</span><span class="s3">) { </span><span class="s1">o</span><span class="s3">.</span><span class="s1">stack </span><span class="s3">= </span><span class="s1">e</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">; }</span>
            <span class="s1">Error</span><span class="s3">.</span><span class="s1">stackTraceLimit </span><span class="s3">-= </span><span class="s6">6</span><span class="s3">;</span>
        <span class="s3">};</span>
    <span class="s3">}</span>

    <span class="s1">formatStack </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">stack</span><span class="s3">, </span><span class="s1">error</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">stack </span><span class="s3">=== </span><span class="s5">&quot;string&quot;</span><span class="s3">) </span><span class="s4">return </span><span class="s1">stack</span><span class="s3">;</span>

        <span class="s4">if </span><span class="s3">((</span><span class="s4">typeof </span><span class="s1">error </span><span class="s3">=== </span><span class="s5">&quot;object&quot; </span><span class="s3">||</span>
            <span class="s4">typeof </span><span class="s1">error </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) &amp;&amp;</span>
            <span class="s1">error</span><span class="s3">.</span><span class="s1">name </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
            <span class="s1">error</span><span class="s3">.</span><span class="s1">message </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
            <span class="s4">return </span><span class="s1">error</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s4">return </span><span class="s1">formatNonError</span><span class="s3">(</span><span class="s1">error</span><span class="s3">);</span>
    <span class="s3">};</span>

    <span class="s4">return null</span><span class="s3">;</span>

<span class="s3">})([]);</span>

<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">console </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s3">&amp;&amp; </span><span class="s4">typeof </span><span class="s1">console</span><span class="s3">.</span><span class="s1">warn </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s3">) {</span>
    <span class="s1">printWarning </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">message</span><span class="s3">) {</span>
        <span class="s1">console</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span><span class="s1">message</span><span class="s3">);</span>
    <span class="s3">};</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">isNode </span><span class="s3">&amp;&amp; </span><span class="s1">process</span><span class="s3">.</span><span class="s1">stderr</span><span class="s3">.</span><span class="s1">isTTY</span><span class="s3">) {</span>
        <span class="s1">printWarning </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">isSoft</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">color </span><span class="s3">= </span><span class="s1">isSoft </span><span class="s3">? </span><span class="s5">&quot;</span><span class="s4">\u001b</span><span class="s5">[33m&quot; </span><span class="s3">: </span><span class="s5">&quot;</span><span class="s4">\u001b</span><span class="s5">[31m&quot;</span><span class="s3">;</span>
            <span class="s1">console</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span><span class="s1">color </span><span class="s3">+ </span><span class="s1">message </span><span class="s3">+ </span><span class="s5">&quot;</span><span class="s4">\u001b</span><span class="s5">[0m</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">);</span>
        <span class="s3">};</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(!</span><span class="s1">util</span><span class="s3">.</span><span class="s1">isNode </span><span class="s3">&amp;&amp; </span><span class="s4">typeof </span><span class="s3">(</span><span class="s4">new </span><span class="s1">Error</span><span class="s3">().</span><span class="s1">stack</span><span class="s3">) === </span><span class="s5">&quot;string&quot;</span><span class="s3">) {</span>
        <span class="s1">printWarning </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">isSoft</span><span class="s3">) {</span>
            <span class="s1">console</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span><span class="s5">&quot;%c&quot; </span><span class="s3">+ </span><span class="s1">message</span><span class="s3">,</span>
                        <span class="s1">isSoft </span><span class="s3">? </span><span class="s5">&quot;color: darkorange&quot; </span><span class="s3">: </span><span class="s5">&quot;color: red&quot;</span><span class="s3">);</span>
        <span class="s3">};</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">config </span><span class="s3">= {</span>
    <span class="s1">warnings</span><span class="s3">: </span><span class="s1">warnings</span><span class="s3">,</span>
    <span class="s1">longStackTraces</span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
    <span class="s1">cancellation</span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
    <span class="s1">monitoring</span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
    <span class="s1">asyncHooks</span><span class="s3">: </span><span class="s4">false</span>
<span class="s3">};</span>

<span class="s4">if </span><span class="s3">(</span><span class="s1">longStackTraces</span><span class="s3">) </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">longStackTraces</span><span class="s3">();</span>

<span class="s4">return </span><span class="s3">{</span>
    <span class="s1">asyncHooks</span><span class="s3">: </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s4">return </span><span class="s1">config</span><span class="s3">.</span><span class="s1">asyncHooks</span><span class="s3">;</span>
    <span class="s3">},</span>
    <span class="s1">longStackTraces</span><span class="s3">: </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s4">return </span><span class="s1">config</span><span class="s3">.</span><span class="s1">longStackTraces</span><span class="s3">;</span>
    <span class="s3">},</span>
    <span class="s1">warnings</span><span class="s3">: </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s4">return </span><span class="s1">config</span><span class="s3">.</span><span class="s1">warnings</span><span class="s3">;</span>
    <span class="s3">},</span>
    <span class="s1">cancellation</span><span class="s3">: </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s4">return </span><span class="s1">config</span><span class="s3">.</span><span class="s1">cancellation</span><span class="s3">;</span>
    <span class="s3">},</span>
    <span class="s1">monitoring</span><span class="s3">: </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s4">return </span><span class="s1">config</span><span class="s3">.</span><span class="s1">monitoring</span><span class="s3">;</span>
    <span class="s3">},</span>
    <span class="s1">propagateFromFunction</span><span class="s3">: </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s4">return </span><span class="s1">propagateFromFunction</span><span class="s3">;</span>
    <span class="s3">},</span>
    <span class="s1">boundValueFunction</span><span class="s3">: </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s4">return </span><span class="s1">boundValueFunction</span><span class="s3">;</span>
    <span class="s3">},</span>
    <span class="s1">checkForgottenReturns</span><span class="s3">: </span><span class="s1">checkForgottenReturns</span><span class="s3">,</span>
    <span class="s1">setBounds</span><span class="s3">: </span><span class="s1">setBounds</span><span class="s3">,</span>
    <span class="s1">warn</span><span class="s3">: </span><span class="s1">warn</span><span class="s3">,</span>
    <span class="s1">deprecated</span><span class="s3">: </span><span class="s1">deprecated</span><span class="s3">,</span>
    <span class="s1">CapturedTrace</span><span class="s3">: </span><span class="s1">CapturedTrace</span><span class="s3">,</span>
    <span class="s1">fireDomEvent</span><span class="s3">: </span><span class="s1">fireDomEvent</span><span class="s3">,</span>
    <span class="s1">fireGlobalEvent</span><span class="s3">: </span><span class="s1">fireGlobalEvent</span>
<span class="s3">};</span>
<span class="s3">};</span>

<span class="s3">},{</span><span class="s5">&quot;./errors&quot;</span><span class="s3">:</span><span class="s6">9</span><span class="s3">,</span><span class="s5">&quot;./es5&quot;</span><span class="s3">:</span><span class="s6">10</span><span class="s3">,</span><span class="s5">&quot;./util&quot;</span><span class="s3">:</span><span class="s6">21</span><span class="s3">}],</span><span class="s6">8</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">) {</span>
<span class="s4">function </span><span class="s1">returner</span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">;</span>
<span class="s3">}</span>
<span class="s4">function </span><span class="s1">thrower</span><span class="s3">() {</span>
    <span class="s4">throw this</span><span class="s3">.</span><span class="s1">reason</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">[</span><span class="s5">&quot;return&quot;</span><span class="s3">] =</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">thenReturn </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">value </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) </span><span class="s1">value</span><span class="s3">.</span><span class="s1">suppressUnhandledRejections</span><span class="s3">();</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span>
        <span class="s1">returner</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, {</span><span class="s1">value</span><span class="s3">: </span><span class="s1">value</span><span class="s3">}, </span><span class="s1">undefined</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">[</span><span class="s5">&quot;throw&quot;</span><span class="s3">] =</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">thenThrow </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">reason</span><span class="s3">) {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span>
        <span class="s1">thrower</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, {</span><span class="s1">reason</span><span class="s3">: </span><span class="s1">reason</span><span class="s3">}, </span><span class="s1">undefined</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">catchThrow </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">reason</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">arguments</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&lt;= </span><span class="s6">1</span><span class="s3">) {</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span>
            <span class="s1">undefined</span><span class="s3">, </span><span class="s1">thrower</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, {</span><span class="s1">reason</span><span class="s3">: </span><span class="s1">reason</span><span class="s3">}, </span><span class="s1">undefined</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">var </span><span class="s1">_reason </span><span class="s3">= </span><span class="s1">arguments</span><span class="s3">[</span><span class="s6">1</span><span class="s3">];</span>
        <span class="s4">var </span><span class="s1">handler </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span><span class="s4">throw </span><span class="s1">_reason</span><span class="s3">;};</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">caught</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">, </span><span class="s1">handler</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">catchReturn </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">arguments</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&lt;= </span><span class="s6">1</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">value </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) </span><span class="s1">value</span><span class="s3">.</span><span class="s1">suppressUnhandledRejections</span><span class="s3">();</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span>
            <span class="s1">undefined</span><span class="s3">, </span><span class="s1">returner</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, {</span><span class="s1">value</span><span class="s3">: </span><span class="s1">value</span><span class="s3">}, </span><span class="s1">undefined</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">var </span><span class="s1">_value </span><span class="s3">= </span><span class="s1">arguments</span><span class="s3">[</span><span class="s6">1</span><span class="s3">];</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">_value </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) </span><span class="s1">_value</span><span class="s3">.</span><span class="s1">suppressUnhandledRejections</span><span class="s3">();</span>
        <span class="s4">var </span><span class="s1">handler </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span><span class="s4">return </span><span class="s1">_value</span><span class="s3">;};</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">caught</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">handler</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>
<span class="s3">};</span>

<span class="s3">},{}],</span><span class="s6">9</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">es5 </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./es5&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">Objectfreeze </span><span class="s3">= </span><span class="s1">es5</span><span class="s3">.</span><span class="s1">freeze</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">util </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./util&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">inherits </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">inherits</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">notEnumerableProp </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">notEnumerableProp</span><span class="s3">;</span>

<span class="s4">function </span><span class="s1">subError</span><span class="s3">(</span><span class="s1">nameProperty</span><span class="s3">, </span><span class="s1">defaultMessage</span><span class="s3">) {</span>
    <span class="s4">function </span><span class="s1">SubError</span><span class="s3">(</span><span class="s1">message</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(!(</span><span class="s4">this instanceof </span><span class="s1">SubError</span><span class="s3">)) </span><span class="s4">return new </span><span class="s1">SubError</span><span class="s3">(</span><span class="s1">message</span><span class="s3">);</span>
        <span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s5">&quot;message&quot;</span><span class="s3">,</span>
            <span class="s4">typeof </span><span class="s1">message </span><span class="s3">=== </span><span class="s5">&quot;string&quot; </span><span class="s3">? </span><span class="s1">message </span><span class="s3">: </span><span class="s1">defaultMessage</span><span class="s3">);</span>
        <span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s5">&quot;name&quot;</span><span class="s3">, </span><span class="s1">nameProperty</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">Error</span><span class="s3">.</span><span class="s1">captureStackTrace</span><span class="s3">) {</span>
            <span class="s1">Error</span><span class="s3">.</span><span class="s1">captureStackTrace</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s4">this</span><span class="s3">.</span><span class="s1">constructor</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">Error</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s4">this</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s1">inherits</span><span class="s3">(</span><span class="s1">SubError</span><span class="s3">, </span><span class="s1">Error</span><span class="s3">);</span>
    <span class="s4">return </span><span class="s1">SubError</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">_TypeError</span><span class="s3">, </span><span class="s1">_RangeError</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">Warning </span><span class="s3">= </span><span class="s1">subError</span><span class="s3">(</span><span class="s5">&quot;Warning&quot;</span><span class="s3">, </span><span class="s5">&quot;warning&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">CancellationError </span><span class="s3">= </span><span class="s1">subError</span><span class="s3">(</span><span class="s5">&quot;CancellationError&quot;</span><span class="s3">, </span><span class="s5">&quot;cancellation error&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">TimeoutError </span><span class="s3">= </span><span class="s1">subError</span><span class="s3">(</span><span class="s5">&quot;TimeoutError&quot;</span><span class="s3">, </span><span class="s5">&quot;timeout error&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">AggregateError </span><span class="s3">= </span><span class="s1">subError</span><span class="s3">(</span><span class="s5">&quot;AggregateError&quot;</span><span class="s3">, </span><span class="s5">&quot;aggregate error&quot;</span><span class="s3">);</span>
<span class="s4">try </span><span class="s3">{</span>
    <span class="s1">_TypeError </span><span class="s3">= </span><span class="s1">TypeError</span><span class="s3">;</span>
    <span class="s1">_RangeError </span><span class="s3">= </span><span class="s1">RangeError</span><span class="s3">;</span>
<span class="s3">} </span><span class="s4">catch</span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
    <span class="s1">_TypeError </span><span class="s3">= </span><span class="s1">subError</span><span class="s3">(</span><span class="s5">&quot;TypeError&quot;</span><span class="s3">, </span><span class="s5">&quot;type error&quot;</span><span class="s3">);</span>
    <span class="s1">_RangeError </span><span class="s3">= </span><span class="s1">subError</span><span class="s3">(</span><span class="s5">&quot;RangeError&quot;</span><span class="s3">, </span><span class="s5">&quot;range error&quot;</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">methods </span><span class="s3">= (</span><span class="s5">&quot;join pop push shift unshift slice filter forEach some &quot; </span><span class="s3">+</span>
    <span class="s5">&quot;every map indexOf lastIndexOf reduce reduceRight sort reverse&quot;</span><span class="s3">).</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot; &quot;</span><span class="s3">);</span>

<span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">methods</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">Array</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">[</span><span class="s1">methods</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]] === </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s1">AggregateError</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">[</span><span class="s1">methods</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]] = </span><span class="s1">Array</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">[</span><span class="s1">methods</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]];</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s1">es5</span><span class="s3">.</span><span class="s1">defineProperty</span><span class="s3">(</span><span class="s1">AggregateError</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">, </span><span class="s5">&quot;length&quot;</span><span class="s3">, {</span>
    <span class="s1">value</span><span class="s3">: </span><span class="s6">0</span><span class="s3">,</span>
    <span class="s1">configurable</span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
    <span class="s1">writable</span><span class="s3">: </span><span class="s4">true</span><span class="s3">,</span>
    <span class="s1">enumerable</span><span class="s3">: </span><span class="s4">true</span>
<span class="s3">});</span>
<span class="s1">AggregateError</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">[</span><span class="s5">&quot;isOperational&quot;</span><span class="s3">] = </span><span class="s4">true</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">level </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
<span class="s1">AggregateError</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">toString </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">indent </span><span class="s3">= </span><span class="s1">Array</span><span class="s3">(</span><span class="s1">level </span><span class="s3">* </span><span class="s6">4 </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">).</span><span class="s1">join</span><span class="s3">(</span><span class="s5">&quot; &quot;</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot; </span><span class="s3">+ </span><span class="s1">indent </span><span class="s3">+ </span><span class="s5">&quot;AggregateError of:&quot; </span><span class="s3">+ </span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">;</span>
    <span class="s1">level</span><span class="s3">++;</span>
    <span class="s1">indent </span><span class="s3">= </span><span class="s1">Array</span><span class="s3">(</span><span class="s1">level </span><span class="s3">* </span><span class="s6">4 </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">).</span><span class="s1">join</span><span class="s3">(</span><span class="s5">&quot; &quot;</span><span class="s3">);</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s4">this</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">str </span><span class="s3">= </span><span class="s4">this</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] === </span><span class="s4">this </span><span class="s3">? </span><span class="s5">&quot;[Circular AggregateError]&quot; </span><span class="s3">: </span><span class="s4">this</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] + </span><span class="s5">&quot;&quot;</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">lines </span><span class="s3">= </span><span class="s1">str</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">);</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">j </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">j </span><span class="s3">&lt; </span><span class="s1">lines</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">j</span><span class="s3">) {</span>
            <span class="s1">lines</span><span class="s3">[</span><span class="s1">j</span><span class="s3">] = </span><span class="s1">indent </span><span class="s3">+ </span><span class="s1">lines</span><span class="s3">[</span><span class="s1">j</span><span class="s3">];</span>
        <span class="s3">}</span>
        <span class="s1">str </span><span class="s3">= </span><span class="s1">lines</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">);</span>
        <span class="s1">ret </span><span class="s3">+= </span><span class="s1">str </span><span class="s3">+ </span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s1">level</span><span class="s3">--;</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">function </span><span class="s1">OperationalError</span><span class="s3">(</span><span class="s1">message</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(!(</span><span class="s4">this instanceof </span><span class="s1">OperationalError</span><span class="s3">))</span>
        <span class="s4">return new </span><span class="s1">OperationalError</span><span class="s3">(</span><span class="s1">message</span><span class="s3">);</span>
    <span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s5">&quot;name&quot;</span><span class="s3">, </span><span class="s5">&quot;OperationalError&quot;</span><span class="s3">);</span>
    <span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s5">&quot;message&quot;</span><span class="s3">, </span><span class="s1">message</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">cause </span><span class="s3">= </span><span class="s1">message</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">[</span><span class="s5">&quot;isOperational&quot;</span><span class="s3">] = </span><span class="s4">true</span><span class="s3">;</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">message </span><span class="s4">instanceof </span><span class="s1">Error</span><span class="s3">) {</span>
        <span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s5">&quot;message&quot;</span><span class="s3">, </span><span class="s1">message</span><span class="s3">.</span><span class="s1">message</span><span class="s3">);</span>
        <span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s5">&quot;stack&quot;</span><span class="s3">, </span><span class="s1">message</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">Error</span><span class="s3">.</span><span class="s1">captureStackTrace</span><span class="s3">) {</span>
        <span class="s1">Error</span><span class="s3">.</span><span class="s1">captureStackTrace</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s4">this</span><span class="s3">.</span><span class="s1">constructor</span><span class="s3">);</span>
    <span class="s3">}</span>

<span class="s3">}</span>
<span class="s1">inherits</span><span class="s3">(</span><span class="s1">OperationalError</span><span class="s3">, </span><span class="s1">Error</span><span class="s3">);</span>

<span class="s4">var </span><span class="s1">errorTypes </span><span class="s3">= </span><span class="s1">Error</span><span class="s3">[</span><span class="s5">&quot;__BluebirdErrorTypes__&quot;</span><span class="s3">];</span>
<span class="s4">if </span><span class="s3">(!</span><span class="s1">errorTypes</span><span class="s3">) {</span>
    <span class="s1">errorTypes </span><span class="s3">= </span><span class="s1">Objectfreeze</span><span class="s3">({</span>
        <span class="s1">CancellationError</span><span class="s3">: </span><span class="s1">CancellationError</span><span class="s3">,</span>
        <span class="s1">TimeoutError</span><span class="s3">: </span><span class="s1">TimeoutError</span><span class="s3">,</span>
        <span class="s1">OperationalError</span><span class="s3">: </span><span class="s1">OperationalError</span><span class="s3">,</span>
        <span class="s1">RejectionError</span><span class="s3">: </span><span class="s1">OperationalError</span><span class="s3">,</span>
        <span class="s1">AggregateError</span><span class="s3">: </span><span class="s1">AggregateError</span>
    <span class="s3">});</span>
    <span class="s1">es5</span><span class="s3">.</span><span class="s1">defineProperty</span><span class="s3">(</span><span class="s1">Error</span><span class="s3">, </span><span class="s5">&quot;__BluebirdErrorTypes__&quot;</span><span class="s3">, {</span>
        <span class="s1">value</span><span class="s3">: </span><span class="s1">errorTypes</span><span class="s3">,</span>
        <span class="s1">writable</span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">enumerable</span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">configurable</span><span class="s3">: </span><span class="s4">false</span>
    <span class="s3">});</span>
<span class="s3">}</span>

<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= {</span>
    <span class="s1">Error</span><span class="s3">: </span><span class="s1">Error</span><span class="s3">,</span>
    <span class="s1">TypeError</span><span class="s3">: </span><span class="s1">_TypeError</span><span class="s3">,</span>
    <span class="s1">RangeError</span><span class="s3">: </span><span class="s1">_RangeError</span><span class="s3">,</span>
    <span class="s1">CancellationError</span><span class="s3">: </span><span class="s1">errorTypes</span><span class="s3">.</span><span class="s1">CancellationError</span><span class="s3">,</span>
    <span class="s1">OperationalError</span><span class="s3">: </span><span class="s1">errorTypes</span><span class="s3">.</span><span class="s1">OperationalError</span><span class="s3">,</span>
    <span class="s1">TimeoutError</span><span class="s3">: </span><span class="s1">errorTypes</span><span class="s3">.</span><span class="s1">TimeoutError</span><span class="s3">,</span>
    <span class="s1">AggregateError</span><span class="s3">: </span><span class="s1">errorTypes</span><span class="s3">.</span><span class="s1">AggregateError</span><span class="s3">,</span>
    <span class="s1">Warning</span><span class="s3">: </span><span class="s1">Warning</span>
<span class="s3">};</span>

<span class="s3">},{</span><span class="s5">&quot;./es5&quot;</span><span class="s3">:</span><span class="s6">10</span><span class="s3">,</span><span class="s5">&quot;./util&quot;</span><span class="s3">:</span><span class="s6">21</span><span class="s3">}],</span><span class="s6">10</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s4">var </span><span class="s1">isES5 </span><span class="s3">= (</span><span class="s4">function</span><span class="s3">(){</span>
    <span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
    <span class="s4">return this </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">;</span>
<span class="s3">})();</span>

<span class="s4">if </span><span class="s3">(</span><span class="s1">isES5</span><span class="s3">) {</span>
    <span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= {</span>
        <span class="s1">freeze</span><span class="s3">: </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">freeze</span><span class="s3">,</span>
        <span class="s1">defineProperty</span><span class="s3">: </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">defineProperty</span><span class="s3">,</span>
        <span class="s1">getDescriptor</span><span class="s3">: </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">getOwnPropertyDescriptor</span><span class="s3">,</span>
        <span class="s1">keys</span><span class="s3">: </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">,</span>
        <span class="s1">names</span><span class="s3">: </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">getOwnPropertyNames</span><span class="s3">,</span>
        <span class="s1">getPrototypeOf</span><span class="s3">: </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">getPrototypeOf</span><span class="s3">,</span>
        <span class="s1">isArray</span><span class="s3">: </span><span class="s1">Array</span><span class="s3">.</span><span class="s1">isArray</span><span class="s3">,</span>
        <span class="s1">isES5</span><span class="s3">: </span><span class="s1">isES5</span><span class="s3">,</span>
        <span class="s1">propertyIsWritable</span><span class="s3">: </span><span class="s4">function</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">prop</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">descriptor </span><span class="s3">= </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">getOwnPropertyDescriptor</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">prop</span><span class="s3">);</span>
            <span class="s4">return </span><span class="s3">!!(!</span><span class="s1">descriptor </span><span class="s3">|| </span><span class="s1">descriptor</span><span class="s3">.</span><span class="s1">writable </span><span class="s3">|| </span><span class="s1">descriptor</span><span class="s3">.</span><span class="s1">set</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">};</span>
<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
    <span class="s4">var </span><span class="s1">has </span><span class="s3">= {}.</span><span class="s1">hasOwnProperty</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">str </span><span class="s3">= {}.</span><span class="s1">toString</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">proto </span><span class="s3">= {}.</span><span class="s1">constructor</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">;</span>

    <span class="s4">var </span><span class="s1">ObjectKeys </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">o</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">ret </span><span class="s3">= [];</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">key </span><span class="s4">in </span><span class="s1">o</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">has</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">o</span><span class="s3">, </span><span class="s1">key</span><span class="s3">)) {</span>
                <span class="s1">ret</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">key</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
    <span class="s3">};</span>

    <span class="s4">var </span><span class="s1">ObjectGetDescriptor </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">o</span><span class="s3">, </span><span class="s1">key</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s3">{</span><span class="s1">value</span><span class="s3">: </span><span class="s1">o</span><span class="s3">[</span><span class="s1">key</span><span class="s3">]};</span>
    <span class="s3">};</span>

    <span class="s4">var </span><span class="s1">ObjectDefineProperty </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">o</span><span class="s3">, </span><span class="s1">key</span><span class="s3">, </span><span class="s1">desc</span><span class="s3">) {</span>
        <span class="s1">o</span><span class="s3">[</span><span class="s1">key</span><span class="s3">] = </span><span class="s1">desc</span><span class="s3">.</span><span class="s1">value</span><span class="s3">;</span>
        <span class="s4">return </span><span class="s1">o</span><span class="s3">;</span>
    <span class="s3">};</span>

    <span class="s4">var </span><span class="s1">ObjectFreeze </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">obj</span><span class="s3">;</span>
    <span class="s3">};</span>

    <span class="s4">var </span><span class="s1">ObjectGetPrototypeOf </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
        <span class="s4">try </span><span class="s3">{</span>
            <span class="s4">return </span><span class="s1">Object</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">).</span><span class="s1">constructor</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
            <span class="s4">return </span><span class="s1">proto</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">};</span>

    <span class="s4">var </span><span class="s1">ArrayIsArray </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
        <span class="s4">try </span><span class="s3">{</span>
            <span class="s4">return </span><span class="s1">str</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) === </span><span class="s5">&quot;[object Array]&quot;</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s4">catch</span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
            <span class="s4">return false</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">};</span>

    <span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= {</span>
        <span class="s1">isArray</span><span class="s3">: </span><span class="s1">ArrayIsArray</span><span class="s3">,</span>
        <span class="s1">keys</span><span class="s3">: </span><span class="s1">ObjectKeys</span><span class="s3">,</span>
        <span class="s1">names</span><span class="s3">: </span><span class="s1">ObjectKeys</span><span class="s3">,</span>
        <span class="s1">defineProperty</span><span class="s3">: </span><span class="s1">ObjectDefineProperty</span><span class="s3">,</span>
        <span class="s1">getDescriptor</span><span class="s3">: </span><span class="s1">ObjectGetDescriptor</span><span class="s3">,</span>
        <span class="s1">freeze</span><span class="s3">: </span><span class="s1">ObjectFreeze</span><span class="s3">,</span>
        <span class="s1">getPrototypeOf</span><span class="s3">: </span><span class="s1">ObjectGetPrototypeOf</span><span class="s3">,</span>
        <span class="s1">isES5</span><span class="s3">: </span><span class="s1">isES5</span><span class="s3">,</span>
        <span class="s1">propertyIsWritable</span><span class="s3">: </span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">};</span>
<span class="s3">}</span>

<span class="s3">},{}],</span><span class="s6">11</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">tryConvertToPromise</span><span class="s3">, </span><span class="s1">NEXT_FILTER</span><span class="s3">) {</span>
<span class="s4">var </span><span class="s1">util </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./util&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">CancellationError </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">CancellationError</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">errorObj </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">errorObj</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">catchFilter </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./catch_filter&quot;</span><span class="s3">)(</span><span class="s1">NEXT_FILTER</span><span class="s3">);</span>

<span class="s4">function </span><span class="s1">PassThroughHandlerContext</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">, </span><span class="s1">type</span><span class="s3">, </span><span class="s1">handler</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">promise </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">type </span><span class="s3">= </span><span class="s1">type</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">handler </span><span class="s3">= </span><span class="s1">handler</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">called </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">cancelPromise </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s1">PassThroughHandlerContext</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isFinallyHandler </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">type </span><span class="s3">=== </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">function </span><span class="s1">FinallyHandlerCancelReaction</span><span class="s3">(</span><span class="s1">finallyHandler</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">finallyHandler </span><span class="s3">= </span><span class="s1">finallyHandler</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s1">FinallyHandlerCancelReaction</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_resultCancelled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s1">checkCancel</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">finallyHandler</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s4">function </span><span class="s1">checkCancel</span><span class="s3">(</span><span class="s1">ctx</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">cancelPromise </span><span class="s3">!= </span><span class="s4">null</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">arguments</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s6">1</span><span class="s3">) {</span>
            <span class="s1">ctx</span><span class="s3">.</span><span class="s1">cancelPromise</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">ctx</span><span class="s3">.</span><span class="s1">cancelPromise</span><span class="s3">.</span><span class="s1">_cancel</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s1">ctx</span><span class="s3">.</span><span class="s1">cancelPromise </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
        <span class="s4">return true</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">return false</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">succeed</span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s1">finallyHandler</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s4">this</span><span class="s3">.</span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">().</span><span class="s1">_settledValue</span><span class="s3">());</span>
<span class="s3">}</span>
<span class="s4">function </span><span class="s1">fail</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">checkCancel</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">)) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s1">errorObj</span><span class="s3">.</span><span class="s1">e </span><span class="s3">= </span><span class="s1">reason</span><span class="s3">;</span>
    <span class="s4">return </span><span class="s1">errorObj</span><span class="s3">;</span>
<span class="s3">}</span>
<span class="s4">function </span><span class="s1">finallyHandler</span><span class="s3">(</span><span class="s1">reasonOrValue</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">promise</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">handler </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">handler</span><span class="s3">;</span>

    <span class="s4">if </span><span class="s3">(!</span><span class="s4">this</span><span class="s3">.</span><span class="s1">called</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">called </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">isFinallyHandler</span><span class="s3">()</span>
            <span class="s3">? </span><span class="s1">handler</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_boundValue</span><span class="s3">())</span>
            <span class="s3">: </span><span class="s1">handler</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_boundValue</span><span class="s3">(), </span><span class="s1">reasonOrValue</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">ret </span><span class="s3">=== </span><span class="s1">NEXT_FILTER</span><span class="s3">) {</span>
            <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">ret </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
            <span class="s1">promise</span><span class="s3">.</span><span class="s1">_setReturnedNonUndefined</span><span class="s3">();</span>
            <span class="s4">var </span><span class="s1">maybePromise </span><span class="s3">= </span><span class="s1">tryConvertToPromise</span><span class="s3">(</span><span class="s1">ret</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">);</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">maybePromise </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) {</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">cancelPromise </span><span class="s3">!= </span><span class="s4">null</span><span class="s3">) {</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_isCancelled</span><span class="s3">()) {</span>
                        <span class="s4">var </span><span class="s1">reason </span><span class="s3">=</span>
                            <span class="s4">new </span><span class="s1">CancellationError</span><span class="s3">(</span><span class="s5">&quot;late cancellation observer&quot;</span><span class="s3">);</span>
                        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_attachExtraTrace</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">);</span>
                        <span class="s1">errorObj</span><span class="s3">.</span><span class="s1">e </span><span class="s3">= </span><span class="s1">reason</span><span class="s3">;</span>
                        <span class="s4">return </span><span class="s1">errorObj</span><span class="s3">;</span>
                    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">isPending</span><span class="s3">()) {</span>
                        <span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_attachCancellationCallback</span><span class="s3">(</span>
                            <span class="s4">new </span><span class="s1">FinallyHandlerCancelReaction</span><span class="s3">(</span><span class="s4">this</span><span class="s3">));</span>
                    <span class="s3">}</span>
                <span class="s3">}</span>
                <span class="s4">return </span><span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span>
                    <span class="s1">succeed</span><span class="s3">, </span><span class="s1">fail</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s4">this</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">}</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">promise</span><span class="s3">.</span><span class="s1">isRejected</span><span class="s3">()) {</span>
        <span class="s1">checkCancel</span><span class="s3">(</span><span class="s4">this</span><span class="s3">);</span>
        <span class="s1">errorObj</span><span class="s3">.</span><span class="s1">e </span><span class="s3">= </span><span class="s1">reasonOrValue</span><span class="s3">;</span>
        <span class="s4">return </span><span class="s1">errorObj</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s1">checkCancel</span><span class="s3">(</span><span class="s4">this</span><span class="s3">);</span>
        <span class="s4">return </span><span class="s1">reasonOrValue</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_passThrough </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">handler</span><span class="s3">, </span><span class="s1">type</span><span class="s3">, </span><span class="s1">success</span><span class="s3">, </span><span class="s1">fail</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">handler </span><span class="s3">!== </span><span class="s5">&quot;function&quot;</span><span class="s3">) </span><span class="s4">return this</span><span class="s3">.</span><span class="s1">then</span><span class="s3">();</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span><span class="s1">success</span><span class="s3">,</span>
                      <span class="s1">fail</span><span class="s3">,</span>
                      <span class="s1">undefined</span><span class="s3">,</span>
                      <span class="s4">new </span><span class="s1">PassThroughHandlerContext</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s1">type</span><span class="s3">, </span><span class="s1">handler</span><span class="s3">),</span>
                      <span class="s1">undefined</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">lastly </span><span class="s3">=</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">[</span><span class="s5">&quot;finally&quot;</span><span class="s3">] = </span><span class="s4">function </span><span class="s3">(</span><span class="s1">handler</span><span class="s3">) {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_passThrough</span><span class="s3">(</span><span class="s1">handler</span><span class="s3">,</span>
                             <span class="s6">0</span><span class="s3">,</span>
                             <span class="s1">finallyHandler</span><span class="s3">,</span>
                             <span class="s1">finallyHandler</span><span class="s3">);</span>
<span class="s3">};</span>


<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">tap </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">handler</span><span class="s3">) {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_passThrough</span><span class="s3">(</span><span class="s1">handler</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s1">finallyHandler</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">tapCatch </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">handlerOrPredicate</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">len </span><span class="s3">= </span><span class="s1">arguments</span><span class="s3">.</span><span class="s1">length</span><span class="s3">;</span>
    <span class="s4">if</span><span class="s3">(</span><span class="s1">len </span><span class="s3">=== </span><span class="s6">1</span><span class="s3">) {</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">_passThrough</span><span class="s3">(</span><span class="s1">handlerOrPredicate</span><span class="s3">,</span>
                                 <span class="s6">1</span><span class="s3">,</span>
                                 <span class="s1">undefined</span><span class="s3">,</span>
                                 <span class="s1">finallyHandler</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
         <span class="s4">var </span><span class="s1">catchInstances </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Array</span><span class="s3">(</span><span class="s1">len </span><span class="s3">- </span><span class="s6">1</span><span class="s3">),</span>
            <span class="s1">j </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">i</span><span class="s3">;</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">len </span><span class="s3">- </span><span class="s6">1</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">item </span><span class="s3">= </span><span class="s1">arguments</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">isObject</span><span class="s3">(</span><span class="s1">item</span><span class="s3">)) {</span>
                <span class="s1">catchInstances</span><span class="s3">[</span><span class="s1">j</span><span class="s3">++] = </span><span class="s1">item</span><span class="s3">;</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s4">return </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">reject</span><span class="s3">(</span><span class="s4">new </span><span class="s1">TypeError</span><span class="s3">(</span>
                    <span class="s5">&quot;tapCatch statement predicate: &quot;</span>
                    <span class="s3">+ </span><span class="s5">&quot;expecting an object but got &quot; </span><span class="s3">+ </span><span class="s1">util</span><span class="s3">.</span><span class="s1">classString</span><span class="s3">(</span><span class="s1">item</span><span class="s3">)</span>
                <span class="s3">));</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s1">catchInstances</span><span class="s3">.</span><span class="s1">length </span><span class="s3">= </span><span class="s1">j</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">handler </span><span class="s3">= </span><span class="s1">arguments</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">_passThrough</span><span class="s3">(</span><span class="s1">catchFilter</span><span class="s3">(</span><span class="s1">catchInstances</span><span class="s3">, </span><span class="s1">handler</span><span class="s3">, </span><span class="s4">this</span><span class="s3">),</span>
                                 <span class="s6">1</span><span class="s3">,</span>
                                 <span class="s1">undefined</span><span class="s3">,</span>
                                 <span class="s1">finallyHandler</span><span class="s3">);</span>
    <span class="s3">}</span>

<span class="s3">};</span>

<span class="s4">return </span><span class="s1">PassThroughHandlerContext</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s3">},{</span><span class="s5">&quot;./catch_filter&quot;</span><span class="s3">:</span><span class="s6">5</span><span class="s3">,</span><span class="s5">&quot;./util&quot;</span><span class="s3">:</span><span class="s6">21</span><span class="s3">}],</span><span class="s6">12</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">=</span>
<span class="s4">function</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">PromiseArray</span><span class="s3">, </span><span class="s1">tryConvertToPromise</span><span class="s3">, </span><span class="s1">INTERNAL</span><span class="s3">, </span><span class="s1">async</span><span class="s3">) {</span>
<span class="s4">var </span><span class="s1">util </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./util&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">canEvaluate </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">canEvaluate</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">tryCatch </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">tryCatch</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">errorObj </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">errorObj</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">reject</span><span class="s3">;</span>

<span class="s4">if </span><span class="s3">(!</span><span class="s4">true</span><span class="s3">) {</span>
<span class="s4">if </span><span class="s3">(</span><span class="s1">canEvaluate</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">thenCallback </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s4">return new </span><span class="s1">Function</span><span class="s3">(</span><span class="s5">&quot;value&quot;</span><span class="s3">, </span><span class="s5">&quot;holder&quot;</span><span class="s3">, </span><span class="s5">&quot;                             </span><span class="s4">\n\ 
            </span><span class="s5">'use strict';                                                    </span><span class="s4">\n\ 
            </span><span class="s5">holder.pIndex = value;                                           </span><span class="s4">\n\ 
            </span><span class="s5">holder.checkFulfillment(this);                                   </span><span class="s4">\n\ 
            </span><span class="s5">&quot;</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s7">/Index/g</span><span class="s3">, </span><span class="s1">i</span><span class="s3">));</span>
    <span class="s3">};</span>

    <span class="s4">var </span><span class="s1">promiseSetter </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s4">return new </span><span class="s1">Function</span><span class="s3">(</span><span class="s5">&quot;promise&quot;</span><span class="s3">, </span><span class="s5">&quot;holder&quot;</span><span class="s3">, </span><span class="s5">&quot;                           </span><span class="s4">\n\ 
            </span><span class="s5">'use strict';                                                    </span><span class="s4">\n\ 
            </span><span class="s5">holder.pIndex = promise;                                         </span><span class="s4">\n\ 
            </span><span class="s5">&quot;</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s7">/Index/g</span><span class="s3">, </span><span class="s1">i</span><span class="s3">));</span>
    <span class="s3">};</span>

    <span class="s4">var </span><span class="s1">generateHolderClass </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">total</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">props </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Array</span><span class="s3">(</span><span class="s1">total</span><span class="s3">);</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">props</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s1">props</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s5">&quot;this.p&quot; </span><span class="s3">+ (</span><span class="s1">i</span><span class="s3">+</span><span class="s6">1</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">var </span><span class="s1">assignment </span><span class="s3">= </span><span class="s1">props</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s5">&quot; = &quot;</span><span class="s3">) + </span><span class="s5">&quot; = null;&quot;</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">cancellationCode</span><span class="s3">= </span><span class="s5">&quot;var promise;</span><span class="s4">\n</span><span class="s5">&quot; </span><span class="s3">+ </span><span class="s1">props</span><span class="s3">.</span><span class="s1">map</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">prop</span><span class="s3">) {</span>
            <span class="s4">return </span><span class="s5">&quot;                                                         </span><span class="s4">\n\ 
                </span><span class="s5">promise = &quot; </span><span class="s3">+ </span><span class="s1">prop </span><span class="s3">+ </span><span class="s5">&quot;;                                      </span><span class="s4">\n\ 
                </span><span class="s5">if (promise instanceof Promise) {                            </span><span class="s4">\n\ 
                    </span><span class="s5">promise.cancel();                                        </span><span class="s4">\n\ 
                </span><span class="s5">}                                                            </span><span class="s4">\n\ 
            </span><span class="s5">&quot;</span><span class="s3">;</span>
        <span class="s3">}).</span><span class="s1">join</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s4">\n</span><span class="s5">&quot;</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">passedArguments </span><span class="s3">= </span><span class="s1">props</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s5">&quot;, &quot;</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">name </span><span class="s3">= </span><span class="s5">&quot;Holder$&quot; </span><span class="s3">+ </span><span class="s1">total</span><span class="s3">;</span>


        <span class="s4">var </span><span class="s1">code </span><span class="s3">= </span><span class="s5">&quot;return function(tryCatch, errorObj, Promise, async) {    </span><span class="s4">\n\ 
            </span><span class="s5">'use strict';                                                    </span><span class="s4">\n\ 
            </span><span class="s5">function [TheName](fn) {                                         </span><span class="s4">\n\ 
                </span><span class="s5">[TheProperties]                                              </span><span class="s4">\n\ 
                </span><span class="s5">this.fn = fn;                                                </span><span class="s4">\n\ 
                </span><span class="s5">this.asyncNeeded = true;                                     </span><span class="s4">\n\ 
                </span><span class="s5">this.now = 0;                                                </span><span class="s4">\n\ 
            </span><span class="s5">}                                                                </span><span class="s4">\n\ 
                                                                             \n\ 
            </span><span class="s5">[TheName].prototype._callFunction = function(promise) {          </span><span class="s4">\n\ 
                </span><span class="s5">promise._pushContext();                                      </span><span class="s4">\n\ 
                </span><span class="s5">var ret = tryCatch(this.fn)([ThePassedArguments]);           </span><span class="s4">\n\ 
                </span><span class="s5">promise._popContext();                                       </span><span class="s4">\n\ 
                </span><span class="s5">if (ret === errorObj) {                                      </span><span class="s4">\n\ 
                    </span><span class="s5">promise._rejectCallback(ret.e, false);                   </span><span class="s4">\n\ 
                </span><span class="s5">} else {                                                     </span><span class="s4">\n\ 
                    </span><span class="s5">promise._resolveCallback(ret);                           </span><span class="s4">\n\ 
                </span><span class="s5">}                                                            </span><span class="s4">\n\ 
            </span><span class="s5">};                                                               </span><span class="s4">\n\ 
                                                                             \n\ 
            </span><span class="s5">[TheName].prototype.checkFulfillment = function(promise) {       </span><span class="s4">\n\ 
                </span><span class="s5">var now = ++this.now;                                        </span><span class="s4">\n\ 
                </span><span class="s5">if (now === [TheTotal]) {                                    </span><span class="s4">\n\ 
                    </span><span class="s5">if (this.asyncNeeded) {                                  </span><span class="s4">\n\ 
                        </span><span class="s5">async.invoke(this._callFunction, this, promise);     </span><span class="s4">\n\ 
                    </span><span class="s5">} else {                                                 </span><span class="s4">\n\ 
                        </span><span class="s5">this._callFunction(promise);                         </span><span class="s4">\n\ 
                    </span><span class="s5">}                                                        </span><span class="s4">\n\ 
                                                                             \n\ 
                </span><span class="s5">}                                                            </span><span class="s4">\n\ 
            </span><span class="s5">};                                                               </span><span class="s4">\n\ 
                                                                             \n\ 
            </span><span class="s5">[TheName].prototype._resultCancelled = function() {              </span><span class="s4">\n\ 
                </span><span class="s5">[CancellationCode]                                           </span><span class="s4">\n\ 
            </span><span class="s5">};                                                               </span><span class="s4">\n\ 
                                                                             \n\ 
            </span><span class="s5">return [TheName];                                                </span><span class="s4">\n\ 
        </span><span class="s5">}(tryCatch, errorObj, Promise, async);                               </span><span class="s4">\n\ 
        </span><span class="s5">&quot;</span><span class="s3">;</span>

        <span class="s1">code </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s7">/\[TheName\]/g</span><span class="s3">, </span><span class="s1">name</span><span class="s3">)</span>
            <span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s7">/\[TheTotal\]/g</span><span class="s3">, </span><span class="s1">total</span><span class="s3">)</span>
            <span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s7">/\[ThePassedArguments\]/g</span><span class="s3">, </span><span class="s1">passedArguments</span><span class="s3">)</span>
            <span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s7">/\[TheProperties\]/g</span><span class="s3">, </span><span class="s1">assignment</span><span class="s3">)</span>
            <span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s7">/\[CancellationCode\]/g</span><span class="s3">, </span><span class="s1">cancellationCode</span><span class="s3">);</span>

        <span class="s4">return new </span><span class="s1">Function</span><span class="s3">(</span><span class="s5">&quot;tryCatch&quot;</span><span class="s3">, </span><span class="s5">&quot;errorObj&quot;</span><span class="s3">, </span><span class="s5">&quot;Promise&quot;</span><span class="s3">, </span><span class="s5">&quot;async&quot;</span><span class="s3">, </span><span class="s1">code</span><span class="s3">)</span>
                           <span class="s3">(</span><span class="s1">tryCatch</span><span class="s3">, </span><span class="s1">errorObj</span><span class="s3">, </span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">async</span><span class="s3">);</span>
    <span class="s3">};</span>

    <span class="s4">var </span><span class="s1">holderClasses </span><span class="s3">= [];</span>
    <span class="s4">var </span><span class="s1">thenCallbacks </span><span class="s3">= [];</span>
    <span class="s4">var </span><span class="s1">promiseSetters </span><span class="s3">= [];</span>

    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s6">8</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s1">holderClasses</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">generateHolderClass</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">));</span>
        <span class="s1">thenCallbacks</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">thenCallback</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">));</span>
        <span class="s1">promiseSetters</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">promiseSetter</span><span class="s3">(</span><span class="s1">i </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">));</span>
    <span class="s3">}</span>

    <span class="s1">reject </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">reason</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">);</span>
    <span class="s3">};</span>
<span class="s3">}}</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">join </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">last </span><span class="s3">= </span><span class="s1">arguments</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s6">1</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">fn</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">last </span><span class="s3">&gt; </span><span class="s6">0 </span><span class="s3">&amp;&amp; </span><span class="s4">typeof </span><span class="s1">arguments</span><span class="s3">[</span><span class="s1">last</span><span class="s3">] === </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s1">fn </span><span class="s3">= </span><span class="s1">arguments</span><span class="s3">[</span><span class="s1">last</span><span class="s3">];</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s4">true</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">last </span><span class="s3">&lt;= </span><span class="s6">8 </span><span class="s3">&amp;&amp; </span><span class="s1">canEvaluate</span><span class="s3">) {</span>
                <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">);</span>
                <span class="s1">ret</span><span class="s3">.</span><span class="s1">_captureStackTrace</span><span class="s3">();</span>
                <span class="s4">var </span><span class="s1">HolderClass </span><span class="s3">= </span><span class="s1">holderClasses</span><span class="s3">[</span><span class="s1">last </span><span class="s3">- </span><span class="s6">1</span><span class="s3">];</span>
                <span class="s4">var </span><span class="s1">holder </span><span class="s3">= </span><span class="s4">new </span><span class="s1">HolderClass</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">);</span>
                <span class="s4">var </span><span class="s1">callbacks </span><span class="s3">= </span><span class="s1">thenCallbacks</span><span class="s3">;</span>

                <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">last</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
                    <span class="s4">var </span><span class="s1">maybePromise </span><span class="s3">= </span><span class="s1">tryConvertToPromise</span><span class="s3">(</span><span class="s1">arguments</span><span class="s3">[</span><span class="s1">i</span><span class="s3">], </span><span class="s1">ret</span><span class="s3">);</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">maybePromise </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) {</span>
                        <span class="s1">maybePromise </span><span class="s3">= </span><span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">();</span>
                        <span class="s4">var </span><span class="s1">bitField </span><span class="s3">= </span><span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
                        <span class="s3">;</span>
                        <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">50397184</span><span class="s3">) === </span><span class="s6">0</span><span class="s3">)) {</span>
                            <span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">[</span><span class="s1">i</span><span class="s3">], </span><span class="s1">reject</span><span class="s3">,</span>
                                               <span class="s1">undefined</span><span class="s3">, </span><span class="s1">ret</span><span class="s3">, </span><span class="s1">holder</span><span class="s3">);</span>
                            <span class="s1">promiseSetters</span><span class="s3">[</span><span class="s1">i</span><span class="s3">](</span><span class="s1">maybePromise</span><span class="s3">, </span><span class="s1">holder</span><span class="s3">);</span>
                            <span class="s1">holder</span><span class="s3">.</span><span class="s1">asyncNeeded </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
                        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">33554432</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
                            <span class="s1">callbacks</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">call</span><span class="s3">(</span><span class="s1">ret</span><span class="s3">,</span>
                                              <span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_value</span><span class="s3">(), </span><span class="s1">holder</span><span class="s3">);</span>
                        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">16777216</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
                            <span class="s1">ret</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_reason</span><span class="s3">());</span>
                        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                            <span class="s1">ret</span><span class="s3">.</span><span class="s1">_cancel</span><span class="s3">();</span>
                        <span class="s3">}</span>
                    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                        <span class="s1">callbacks</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">call</span><span class="s3">(</span><span class="s1">ret</span><span class="s3">, </span><span class="s1">maybePromise</span><span class="s3">, </span><span class="s1">holder</span><span class="s3">);</span>
                    <span class="s3">}</span>
                <span class="s3">}</span>

                <span class="s4">if </span><span class="s3">(!</span><span class="s1">ret</span><span class="s3">.</span><span class="s1">_isFateSealed</span><span class="s3">()) {</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">holder</span><span class="s3">.</span><span class="s1">asyncNeeded</span><span class="s3">) {</span>
                        <span class="s4">var </span><span class="s1">context </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">_getContext</span><span class="s3">();</span>
                        <span class="s1">holder</span><span class="s3">.</span><span class="s1">fn </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">contextBind</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">holder</span><span class="s3">.</span><span class="s1">fn</span><span class="s3">);</span>
                    <span class="s3">}</span>
                    <span class="s1">ret</span><span class="s3">.</span><span class="s1">_setAsyncGuaranteed</span><span class="s3">();</span>
                    <span class="s1">ret</span><span class="s3">.</span><span class="s1">_setOnCancel</span><span class="s3">(</span><span class="s1">holder</span><span class="s3">);</span>
                <span class="s3">}</span>
                <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">var </span><span class="s1">args </span><span class="s3">= [].</span><span class="s1">slice</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">arguments</span><span class="s3">);;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) </span><span class="s1">args</span><span class="s3">.</span><span class="s1">pop</span><span class="s3">();</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s4">new </span><span class="s1">PromiseArray</span><span class="s3">(</span><span class="s1">args</span><span class="s3">).</span><span class="s1">promise</span><span class="s3">();</span>
    <span class="s4">return </span><span class="s1">fn </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">? </span><span class="s1">ret</span><span class="s3">.</span><span class="s1">spread</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) : </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s3">};</span>

<span class="s3">},{</span><span class="s5">&quot;./util&quot;</span><span class="s3">:</span><span class="s6">21</span><span class="s3">}],</span><span class="s6">13</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">=</span>
<span class="s4">function</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">INTERNAL</span><span class="s3">, </span><span class="s1">tryConvertToPromise</span><span class="s3">, </span><span class="s1">apiRejection</span><span class="s3">, </span><span class="s1">debug</span><span class="s3">) {</span>
<span class="s4">var </span><span class="s1">util </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./util&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">tryCatch </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">tryCatch</span><span class="s3">;</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">method </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">fn </span><span class="s3">!== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s4">throw new </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">TypeError</span><span class="s3">(</span><span class="s5">&quot;expecting a function but got &quot; </span><span class="s3">+ </span><span class="s1">util</span><span class="s3">.</span><span class="s1">classString</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">));</span>
    <span class="s3">}</span>
    <span class="s4">return function </span><span class="s3">() {</span>
        <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">);</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">_captureStackTrace</span><span class="s3">();</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">_pushContext</span><span class="s3">();</span>
        <span class="s4">var </span><span class="s1">value </span><span class="s3">= </span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">).</span><span class="s1">apply</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s1">arguments</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">promiseCreated </span><span class="s3">= </span><span class="s1">ret</span><span class="s3">.</span><span class="s1">_popContext</span><span class="s3">();</span>
        <span class="s1">debug</span><span class="s3">.</span><span class="s1">checkForgottenReturns</span><span class="s3">(</span>
            <span class="s1">value</span><span class="s3">, </span><span class="s1">promiseCreated</span><span class="s3">, </span><span class="s5">&quot;Promise.method&quot;</span><span class="s3">, </span><span class="s1">ret</span><span class="s3">);</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">_resolveFromSyncValue</span><span class="s3">(</span><span class="s1">value</span><span class="s3">);</span>
        <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
    <span class="s3">};</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">attempt </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">[</span><span class="s5">&quot;try&quot;</span><span class="s3">] = </span><span class="s4">function </span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">fn </span><span class="s3">!== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">apiRejection</span><span class="s3">(</span><span class="s5">&quot;expecting a function but got &quot; </span><span class="s3">+ </span><span class="s1">util</span><span class="s3">.</span><span class="s1">classString</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">));</span>
    <span class="s3">}</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">);</span>
    <span class="s1">ret</span><span class="s3">.</span><span class="s1">_captureStackTrace</span><span class="s3">();</span>
    <span class="s1">ret</span><span class="s3">.</span><span class="s1">_pushContext</span><span class="s3">();</span>
    <span class="s4">var </span><span class="s1">value</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">arguments</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s6">1</span><span class="s3">) {</span>
        <span class="s1">debug</span><span class="s3">.</span><span class="s1">deprecated</span><span class="s3">(</span><span class="s5">&quot;calling Promise.try with more than 1 argument&quot;</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">arg </span><span class="s3">= </span><span class="s1">arguments</span><span class="s3">[</span><span class="s6">1</span><span class="s3">];</span>
        <span class="s4">var </span><span class="s1">ctx </span><span class="s3">= </span><span class="s1">arguments</span><span class="s3">[</span><span class="s6">2</span><span class="s3">];</span>
        <span class="s1">value </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">isArray</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">) ? </span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">).</span><span class="s1">apply</span><span class="s3">(</span><span class="s1">ctx</span><span class="s3">, </span><span class="s1">arg</span><span class="s3">)</span>
                                  <span class="s3">: </span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">).</span><span class="s1">call</span><span class="s3">(</span><span class="s1">ctx</span><span class="s3">, </span><span class="s1">arg</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s1">value </span><span class="s3">= </span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">)();</span>
    <span class="s3">}</span>
    <span class="s4">var </span><span class="s1">promiseCreated </span><span class="s3">= </span><span class="s1">ret</span><span class="s3">.</span><span class="s1">_popContext</span><span class="s3">();</span>
    <span class="s1">debug</span><span class="s3">.</span><span class="s1">checkForgottenReturns</span><span class="s3">(</span>
        <span class="s1">value</span><span class="s3">, </span><span class="s1">promiseCreated</span><span class="s3">, </span><span class="s5">&quot;Promise.try&quot;</span><span class="s3">, </span><span class="s1">ret</span><span class="s3">);</span>
    <span class="s1">ret</span><span class="s3">.</span><span class="s1">_resolveFromSyncValue</span><span class="s3">(</span><span class="s1">value</span><span class="s3">);</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_resolveFromSyncValue </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">value </span><span class="s3">=== </span><span class="s1">util</span><span class="s3">.</span><span class="s1">errorObj</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_rejectCallback</span><span class="s3">(</span><span class="s1">value</span><span class="s3">.</span><span class="s1">e</span><span class="s3">, </span><span class="s4">false</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_resolveCallback</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>
<span class="s3">};</span>

<span class="s3">},{</span><span class="s5">&quot;./util&quot;</span><span class="s3">:</span><span class="s6">21</span><span class="s3">}],</span><span class="s6">14</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">util </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./util&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">maybeWrapAsError </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">maybeWrapAsError</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">errors </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./errors&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">OperationalError </span><span class="s3">= </span><span class="s1">errors</span><span class="s3">.</span><span class="s1">OperationalError</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">es5 </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./es5&quot;</span><span class="s3">);</span>

<span class="s4">function </span><span class="s1">isUntypedError</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s1">obj </span><span class="s4">instanceof </span><span class="s1">Error </span><span class="s3">&amp;&amp;</span>
        <span class="s1">es5</span><span class="s3">.</span><span class="s1">getPrototypeOf</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) === </span><span class="s1">Error</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">rErrorKey </span><span class="s3">= </span><span class="s7">/^(?:name|message|stack|cause)$/</span><span class="s3">;</span>
<span class="s4">function </span><span class="s1">wrapAsOperationalError</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">ret</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">isUntypedError</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">)) {</span>
        <span class="s1">ret </span><span class="s3">= </span><span class="s4">new </span><span class="s1">OperationalError</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">);</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">name </span><span class="s3">= </span><span class="s1">obj</span><span class="s3">.</span><span class="s1">name</span><span class="s3">;</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">message </span><span class="s3">= </span><span class="s1">obj</span><span class="s3">.</span><span class="s1">message</span><span class="s3">;</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">stack </span><span class="s3">= </span><span class="s1">obj</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">keys </span><span class="s3">= </span><span class="s1">es5</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">);</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">keys</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">key </span><span class="s3">= </span><span class="s1">keys</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
            <span class="s4">if </span><span class="s3">(!</span><span class="s1">rErrorKey</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)) {</span>
                <span class="s1">ret</span><span class="s3">[</span><span class="s1">key</span><span class="s3">] = </span><span class="s1">obj</span><span class="s3">[</span><span class="s1">key</span><span class="s3">];</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s1">util</span><span class="s3">.</span><span class="s1">markAsOriginatingFromRejection</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">);</span>
    <span class="s4">return </span><span class="s1">obj</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">nodebackForPromise</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">, </span><span class="s1">multiArgs</span><span class="s3">) {</span>
    <span class="s4">return function</span><span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s1">value</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">promise </span><span class="s3">=== </span><span class="s4">null</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">wrapped </span><span class="s3">= </span><span class="s1">wrapAsOperationalError</span><span class="s3">(</span><span class="s1">maybeWrapAsError</span><span class="s3">(</span><span class="s1">err</span><span class="s3">));</span>
            <span class="s1">promise</span><span class="s3">.</span><span class="s1">_attachExtraTrace</span><span class="s3">(</span><span class="s1">wrapped</span><span class="s3">);</span>
            <span class="s1">promise</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">wrapped</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(!</span><span class="s1">multiArgs</span><span class="s3">) {</span>
            <span class="s1">promise</span><span class="s3">.</span><span class="s1">_fulfill</span><span class="s3">(</span><span class="s1">value</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">var </span><span class="s1">args </span><span class="s3">= [].</span><span class="s1">slice</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">arguments</span><span class="s3">, </span><span class="s6">1</span><span class="s3">);;</span>
            <span class="s1">promise</span><span class="s3">.</span><span class="s1">_fulfill</span><span class="s3">(</span><span class="s1">args</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s1">promise </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
    <span class="s3">};</span>
<span class="s3">}</span>

<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s1">nodebackForPromise</span><span class="s3">;</span>

<span class="s3">},{</span><span class="s5">&quot;./errors&quot;</span><span class="s3">:</span><span class="s6">9</span><span class="s3">,</span><span class="s5">&quot;./es5&quot;</span><span class="s3">:</span><span class="s6">10</span><span class="s3">,</span><span class="s5">&quot;./util&quot;</span><span class="s3">:</span><span class="s6">21</span><span class="s3">}],</span><span class="s6">15</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
<span class="s4">var </span><span class="s1">makeSelfResolutionError </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s5">&quot;circular promise resolution chain</span><span class="s4">\u000a\u000a    </span><span class="s5">See http://goo.gl/MqrFmX</span><span class="s4">\u000a</span><span class="s5">&quot;</span><span class="s3">);</span>
<span class="s3">};</span>
<span class="s4">var </span><span class="s1">reflectHandler </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return new </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">PromiseInspection</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">());</span>
<span class="s3">};</span>
<span class="s4">var </span><span class="s1">apiRejection </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">reject</span><span class="s3">(</span><span class="s4">new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">));</span>
<span class="s3">};</span>
<span class="s4">function </span><span class="s1">Proxyable</span><span class="s3">() {}</span>
<span class="s4">var </span><span class="s1">UNDEFINED_BINDING </span><span class="s3">= {};</span>
<span class="s4">var </span><span class="s1">util </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./util&quot;</span><span class="s3">);</span>
<span class="s1">util</span><span class="s3">.</span><span class="s1">setReflectHandler</span><span class="s3">(</span><span class="s1">reflectHandler</span><span class="s3">);</span>

<span class="s4">var </span><span class="s1">getDomain </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">domain </span><span class="s3">= </span><span class="s1">process</span><span class="s3">.</span><span class="s1">domain</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">domain </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) {</span>
        <span class="s4">return null</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">domain</span><span class="s3">;</span>
<span class="s3">};</span>
<span class="s4">var </span><span class="s1">getContextDefault </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return null</span><span class="s3">;</span>
<span class="s3">};</span>
<span class="s4">var </span><span class="s1">getContextDomain </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">{</span>
        <span class="s1">domain</span><span class="s3">: </span><span class="s1">getDomain</span><span class="s3">(),</span>
        <span class="s1">async</span><span class="s3">: </span><span class="s4">null</span>
    <span class="s3">};</span>
<span class="s3">};</span>
<span class="s4">var </span><span class="s1">AsyncResource </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">isNode </span><span class="s3">&amp;&amp; </span><span class="s1">util</span><span class="s3">.</span><span class="s1">nodeSupportsAsyncResource </span><span class="s3">?</span>
    <span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;async_hooks&quot;</span><span class="s3">).</span><span class="s1">AsyncResource </span><span class="s3">: </span><span class="s4">null</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">getContextAsyncHooks </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">{</span>
        <span class="s1">domain</span><span class="s3">: </span><span class="s1">getDomain</span><span class="s3">(),</span>
        <span class="s1">async</span><span class="s3">: </span><span class="s4">new </span><span class="s1">AsyncResource</span><span class="s3">(</span><span class="s5">&quot;Bluebird::Promise&quot;</span><span class="s3">)</span>
    <span class="s3">};</span>
<span class="s3">};</span>
<span class="s4">var </span><span class="s1">getContext </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">isNode </span><span class="s3">? </span><span class="s1">getContextDomain </span><span class="s3">: </span><span class="s1">getContextDefault</span><span class="s3">;</span>
<span class="s1">util</span><span class="s3">.</span><span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s5">&quot;_getContext&quot;</span><span class="s3">, </span><span class="s1">getContext</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">enableAsyncHooks </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s1">getContext </span><span class="s3">= </span><span class="s1">getContextAsyncHooks</span><span class="s3">;</span>
    <span class="s1">util</span><span class="s3">.</span><span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s5">&quot;_getContext&quot;</span><span class="s3">, </span><span class="s1">getContextAsyncHooks</span><span class="s3">);</span>
<span class="s3">};</span>
<span class="s4">var </span><span class="s1">disableAsyncHooks </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s1">getContext </span><span class="s3">= </span><span class="s1">getContextDomain</span><span class="s3">;</span>
    <span class="s1">util</span><span class="s3">.</span><span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s5">&quot;_getContext&quot;</span><span class="s3">, </span><span class="s1">getContextDomain</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">es5 </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./es5&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">Async </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./async&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">async </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Async</span><span class="s3">();</span>
<span class="s1">es5</span><span class="s3">.</span><span class="s1">defineProperty</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s5">&quot;_async&quot;</span><span class="s3">, {</span><span class="s1">value</span><span class="s3">: </span><span class="s1">async</span><span class="s3">});</span>
<span class="s4">var </span><span class="s1">errors </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./errors&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">TypeError </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">TypeError </span><span class="s3">= </span><span class="s1">errors</span><span class="s3">.</span><span class="s1">TypeError</span><span class="s3">;</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">RangeError </span><span class="s3">= </span><span class="s1">errors</span><span class="s3">.</span><span class="s1">RangeError</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">CancellationError </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">CancellationError </span><span class="s3">= </span><span class="s1">errors</span><span class="s3">.</span><span class="s1">CancellationError</span><span class="s3">;</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">TimeoutError </span><span class="s3">= </span><span class="s1">errors</span><span class="s3">.</span><span class="s1">TimeoutError</span><span class="s3">;</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">OperationalError </span><span class="s3">= </span><span class="s1">errors</span><span class="s3">.</span><span class="s1">OperationalError</span><span class="s3">;</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">RejectionError </span><span class="s3">= </span><span class="s1">errors</span><span class="s3">.</span><span class="s1">OperationalError</span><span class="s3">;</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">AggregateError </span><span class="s3">= </span><span class="s1">errors</span><span class="s3">.</span><span class="s1">AggregateError</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">INTERNAL </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(){};</span>
<span class="s4">var </span><span class="s1">APPLY </span><span class="s3">= {};</span>
<span class="s4">var </span><span class="s1">NEXT_FILTER </span><span class="s3">= {};</span>
<span class="s4">var </span><span class="s1">tryConvertToPromise </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./thenables&quot;</span><span class="s3">)(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">INTERNAL</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">PromiseArray </span><span class="s3">=</span>
    <span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./promise_array&quot;</span><span class="s3">)(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">INTERNAL</span><span class="s3">,</span>
                               <span class="s1">tryConvertToPromise</span><span class="s3">, </span><span class="s1">apiRejection</span><span class="s3">, </span><span class="s1">Proxyable</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">Context </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./context&quot;</span><span class="s3">)(</span><span class="s1">Promise</span><span class="s3">);</span>
 <span class="s0">/*jshint unused:false*/</span>
<span class="s4">var </span><span class="s1">createContext </span><span class="s3">= </span><span class="s1">Context</span><span class="s3">.</span><span class="s1">create</span><span class="s3">;</span>

<span class="s4">var </span><span class="s1">debug </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./debuggability&quot;</span><span class="s3">)(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">Context</span><span class="s3">,</span>
    <span class="s1">enableAsyncHooks</span><span class="s3">, </span><span class="s1">disableAsyncHooks</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">CapturedTrace </span><span class="s3">= </span><span class="s1">debug</span><span class="s3">.</span><span class="s1">CapturedTrace</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">PassThroughHandlerContext </span><span class="s3">=</span>
    <span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./finally&quot;</span><span class="s3">)(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">tryConvertToPromise</span><span class="s3">, </span><span class="s1">NEXT_FILTER</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">catchFilter </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./catch_filter&quot;</span><span class="s3">)(</span><span class="s1">NEXT_FILTER</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">nodebackForPromise </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./nodeback&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">errorObj </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">errorObj</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">tryCatch </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">tryCatch</span><span class="s3">;</span>
<span class="s4">function </span><span class="s1">check</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">executor</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">self </span><span class="s3">== </span><span class="s4">null </span><span class="s3">|| </span><span class="s1">self</span><span class="s3">.</span><span class="s1">constructor </span><span class="s3">!== </span><span class="s1">Promise</span><span class="s3">) {</span>
        <span class="s4">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s5">&quot;the promise constructor cannot be invoked directly</span><span class="s4">\u000a\u000a    </span><span class="s5">See http://goo.gl/MqrFmX</span><span class="s4">\u000a</span><span class="s5">&quot;</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">executor </span><span class="s3">!== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s4">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s5">&quot;expecting a function but got &quot; </span><span class="s3">+ </span><span class="s1">util</span><span class="s3">.</span><span class="s1">classString</span><span class="s3">(</span><span class="s1">executor</span><span class="s3">));</span>
    <span class="s3">}</span>

<span class="s3">}</span>

<span class="s4">function </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">executor</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">executor </span><span class="s3">!== </span><span class="s1">INTERNAL</span><span class="s3">) {</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s1">executor</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_fulfillmentHandler0 </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_rejectionHandler0 </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_promise0 </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_receiver0 </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_resolveFromExecutor</span><span class="s3">(</span><span class="s1">executor</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_promiseCreated</span><span class="s3">();</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_fireEvent</span><span class="s3">(</span><span class="s5">&quot;promiseCreated&quot;</span><span class="s3">, </span><span class="s4">this</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">toString </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s5">&quot;[object Promise]&quot;</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">caught </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">[</span><span class="s5">&quot;catch&quot;</span><span class="s3">] = </span><span class="s4">function </span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">len </span><span class="s3">= </span><span class="s1">arguments</span><span class="s3">.</span><span class="s1">length</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">len </span><span class="s3">&gt; </span><span class="s6">1</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">catchInstances </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Array</span><span class="s3">(</span><span class="s1">len </span><span class="s3">- </span><span class="s6">1</span><span class="s3">),</span>
            <span class="s1">j </span><span class="s3">= </span><span class="s6">0</span><span class="s3">, </span><span class="s1">i</span><span class="s3">;</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">len </span><span class="s3">- </span><span class="s6">1</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">item </span><span class="s3">= </span><span class="s1">arguments</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">isObject</span><span class="s3">(</span><span class="s1">item</span><span class="s3">)) {</span>
                <span class="s1">catchInstances</span><span class="s3">[</span><span class="s1">j</span><span class="s3">++] = </span><span class="s1">item</span><span class="s3">;</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s4">return </span><span class="s1">apiRejection</span><span class="s3">(</span><span class="s5">&quot;Catch statement predicate: &quot; </span><span class="s3">+</span>
                    <span class="s5">&quot;expecting an object but got &quot; </span><span class="s3">+ </span><span class="s1">util</span><span class="s3">.</span><span class="s1">classString</span><span class="s3">(</span><span class="s1">item</span><span class="s3">));</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s1">catchInstances</span><span class="s3">.</span><span class="s1">length </span><span class="s3">= </span><span class="s1">j</span><span class="s3">;</span>
        <span class="s1">fn </span><span class="s3">= </span><span class="s1">arguments</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">fn </span><span class="s3">!== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s4">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s5">&quot;The last argument to .catch() &quot; </span><span class="s3">+</span>
                <span class="s5">&quot;must be a function, got &quot; </span><span class="s3">+ </span><span class="s1">util</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">));</span>
        <span class="s3">}</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">then</span><span class="s3">(</span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">catchFilter</span><span class="s3">(</span><span class="s1">catchInstances</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">, </span><span class="s4">this</span><span class="s3">));</span>
    <span class="s3">}</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">then</span><span class="s3">(</span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">reflect </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span><span class="s1">reflectHandler</span><span class="s3">,</span>
        <span class="s1">reflectHandler</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s4">this</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">then </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">didFulfill</span><span class="s3">, </span><span class="s1">didReject</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">debug</span><span class="s3">.</span><span class="s1">warnings</span><span class="s3">() &amp;&amp; </span><span class="s1">arguments</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s6">0 </span><span class="s3">&amp;&amp;</span>
        <span class="s4">typeof </span><span class="s1">didFulfill </span><span class="s3">!== </span><span class="s5">&quot;function&quot; </span><span class="s3">&amp;&amp;</span>
        <span class="s4">typeof </span><span class="s1">didReject </span><span class="s3">!== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;.then() only accepts functions but was passed: &quot; </span><span class="s3">+</span>
                <span class="s1">util</span><span class="s3">.</span><span class="s1">classString</span><span class="s3">(</span><span class="s1">didFulfill</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">arguments</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s6">1</span><span class="s3">) {</span>
            <span class="s1">msg </span><span class="s3">+= </span><span class="s5">&quot;, &quot; </span><span class="s3">+ </span><span class="s1">util</span><span class="s3">.</span><span class="s1">classString</span><span class="s3">(</span><span class="s1">didReject</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_warn</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span><span class="s1">didFulfill</span><span class="s3">, </span><span class="s1">didReject</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">done </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">didFulfill</span><span class="s3">, </span><span class="s1">didReject</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">promise </span><span class="s3">=</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span><span class="s1">didFulfill</span><span class="s3">, </span><span class="s1">didReject</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">);</span>
    <span class="s1">promise</span><span class="s3">.</span><span class="s1">_setIsFinal</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">spread </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">fn </span><span class="s3">!== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">apiRejection</span><span class="s3">(</span><span class="s5">&quot;expecting a function but got &quot; </span><span class="s3">+ </span><span class="s1">util</span><span class="s3">.</span><span class="s1">classString</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">));</span>
    <span class="s3">}</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">all</span><span class="s3">().</span><span class="s1">_then</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">APPLY</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">toJSON </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= {</span>
        <span class="s1">isFulfilled</span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">isRejected</span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">fulfillmentValue</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
        <span class="s1">rejectionReason</span><span class="s3">: </span><span class="s1">undefined</span>
    <span class="s3">};</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">isFulfilled</span><span class="s3">()) {</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">fulfillmentValue </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">();</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">isFulfilled </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">isRejected</span><span class="s3">()) {</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">rejectionReason </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">reason</span><span class="s3">();</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">isRejected </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">all </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">arguments</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s6">0</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_warn</span><span class="s3">(</span><span class="s5">&quot;.all() was passed arguments but it does not take any&quot;</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">return new </span><span class="s1">PromiseArray</span><span class="s3">(</span><span class="s4">this</span><span class="s3">).</span><span class="s1">promise</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">error </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">caught</span><span class="s3">(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">originatesFromRejection</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">getNewLibraryCopy </span><span class="s3">= </span><span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">;</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">is </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">val</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s1">val </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">fromNode </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">fromCallback </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">);</span>
    <span class="s1">ret</span><span class="s3">.</span><span class="s1">_captureStackTrace</span><span class="s3">();</span>
    <span class="s4">var </span><span class="s1">multiArgs </span><span class="s3">= </span><span class="s1">arguments</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s6">1 </span><span class="s3">? !!</span><span class="s1">Object</span><span class="s3">(</span><span class="s1">arguments</span><span class="s3">[</span><span class="s6">1</span><span class="s3">]).</span><span class="s1">multiArgs</span>
                                         <span class="s3">: </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">result </span><span class="s3">= </span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">)(</span><span class="s1">nodebackForPromise</span><span class="s3">(</span><span class="s1">ret</span><span class="s3">, </span><span class="s1">multiArgs</span><span class="s3">));</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">result </span><span class="s3">=== </span><span class="s1">errorObj</span><span class="s3">) {</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">_rejectCallback</span><span class="s3">(</span><span class="s1">result</span><span class="s3">.</span><span class="s1">e</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s1">ret</span><span class="s3">.</span><span class="s1">_isFateSealed</span><span class="s3">()) </span><span class="s1">ret</span><span class="s3">.</span><span class="s1">_setAsyncGuaranteed</span><span class="s3">();</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">all </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">promises</span><span class="s3">) {</span>
    <span class="s4">return new </span><span class="s1">PromiseArray</span><span class="s3">(</span><span class="s1">promises</span><span class="s3">).</span><span class="s1">promise</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">cast </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s1">tryConvertToPromise</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">);</span>
    <span class="s4">if </span><span class="s3">(!(</span><span class="s1">ret </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">)) {</span>
        <span class="s1">ret </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">);</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">_captureStackTrace</span><span class="s3">();</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">_setFulfilled</span><span class="s3">();</span>
        <span class="s1">ret</span><span class="s3">.</span><span class="s1">_rejectionHandler0 </span><span class="s3">= </span><span class="s1">obj</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">resolve </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">fulfilled </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">cast</span><span class="s3">;</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">reject </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">rejected </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">reason</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">);</span>
    <span class="s1">ret</span><span class="s3">.</span><span class="s1">_captureStackTrace</span><span class="s3">();</span>
    <span class="s1">ret</span><span class="s3">.</span><span class="s1">_rejectCallback</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">setScheduler </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">fn </span><span class="s3">!== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s4">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s5">&quot;expecting a function but got &quot; </span><span class="s3">+ </span><span class="s1">util</span><span class="s3">.</span><span class="s1">classString</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">));</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">async</span><span class="s3">.</span><span class="s1">setScheduler</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_then </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span>
    <span class="s1">didFulfill</span><span class="s3">,</span>
    <span class="s1">didReject</span><span class="s3">,</span>
    <span class="s1">_</span><span class="s3">,    </span><span class="s1">receiver</span><span class="s3">,</span>
    <span class="s1">internalData</span>
<span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">haveInternalData </span><span class="s3">= </span><span class="s1">internalData </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s1">haveInternalData </span><span class="s3">? </span><span class="s1">internalData </span><span class="s3">: </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">target </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">();</span>
    <span class="s4">var </span><span class="s1">bitField </span><span class="s3">= </span><span class="s1">target</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>

    <span class="s4">if </span><span class="s3">(!</span><span class="s1">haveInternalData</span><span class="s3">) {</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_propagateFrom</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s6">3</span><span class="s3">);</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_captureStackTrace</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">receiver </span><span class="s3">=== </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
            <span class="s3">((</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">2097152</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
            <span class="s4">if </span><span class="s3">(!((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">50397184</span><span class="s3">) === </span><span class="s6">0</span><span class="s3">)) {</span>
                <span class="s1">receiver </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_boundValue</span><span class="s3">();</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">receiver </span><span class="s3">= </span><span class="s1">target </span><span class="s3">=== </span><span class="s4">this </span><span class="s3">? </span><span class="s1">undefined </span><span class="s3">: </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_boundTo</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_fireEvent</span><span class="s3">(</span><span class="s5">&quot;promiseChained&quot;</span><span class="s3">, </span><span class="s4">this</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s4">var </span><span class="s1">context </span><span class="s3">= </span><span class="s1">getContext</span><span class="s3">();</span>
    <span class="s4">if </span><span class="s3">(!((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">50397184</span><span class="s3">) === </span><span class="s6">0</span><span class="s3">)) {</span>
        <span class="s4">var </span><span class="s1">handler</span><span class="s3">, </span><span class="s1">value</span><span class="s3">, </span><span class="s1">settler </span><span class="s3">= </span><span class="s1">target</span><span class="s3">.</span><span class="s1">_settlePromiseCtx</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">33554432</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
            <span class="s1">value </span><span class="s3">= </span><span class="s1">target</span><span class="s3">.</span><span class="s1">_rejectionHandler0</span><span class="s3">;</span>
            <span class="s1">handler </span><span class="s3">= </span><span class="s1">didFulfill</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">16777216</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
            <span class="s1">value </span><span class="s3">= </span><span class="s1">target</span><span class="s3">.</span><span class="s1">_fulfillmentHandler0</span><span class="s3">;</span>
            <span class="s1">handler </span><span class="s3">= </span><span class="s1">didReject</span><span class="s3">;</span>
            <span class="s1">target</span><span class="s3">.</span><span class="s1">_unsetRejectionIsUnhandled</span><span class="s3">();</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">settler </span><span class="s3">= </span><span class="s1">target</span><span class="s3">.</span><span class="s1">_settlePromiseLateCancellationObserver</span><span class="s3">;</span>
            <span class="s1">value </span><span class="s3">= </span><span class="s4">new </span><span class="s1">CancellationError</span><span class="s3">(</span><span class="s5">&quot;late cancellation observer&quot;</span><span class="s3">);</span>
            <span class="s1">target</span><span class="s3">.</span><span class="s1">_attachExtraTrace</span><span class="s3">(</span><span class="s1">value</span><span class="s3">);</span>
            <span class="s1">handler </span><span class="s3">= </span><span class="s1">didReject</span><span class="s3">;</span>
        <span class="s3">}</span>

        <span class="s1">async</span><span class="s3">.</span><span class="s1">invoke</span><span class="s3">(</span><span class="s1">settler</span><span class="s3">, </span><span class="s1">target</span><span class="s3">, {</span>
            <span class="s1">handler</span><span class="s3">: </span><span class="s1">util</span><span class="s3">.</span><span class="s1">contextBind</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">handler</span><span class="s3">),</span>
            <span class="s1">promise</span><span class="s3">: </span><span class="s1">promise</span><span class="s3">,</span>
            <span class="s1">receiver</span><span class="s3">: </span><span class="s1">receiver</span><span class="s3">,</span>
            <span class="s1">value</span><span class="s3">: </span><span class="s1">value</span>
        <span class="s3">});</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s1">target</span><span class="s3">.</span><span class="s1">_addCallbacks</span><span class="s3">(</span><span class="s1">didFulfill</span><span class="s3">, </span><span class="s1">didReject</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">,</span>
                <span class="s1">receiver</span><span class="s3">, </span><span class="s1">context</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s4">return </span><span class="s1">promise</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_length </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">65535</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_isFateSealed </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">117506048</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_isFollowing </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">67108864</span><span class="s3">) === </span><span class="s6">67108864</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setLength </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">len</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= (</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; -</span><span class="s6">65536</span><span class="s3">) |</span>
        <span class="s3">(</span><span class="s1">len </span><span class="s3">&amp; </span><span class="s6">65535</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setFulfilled </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">| </span><span class="s6">33554432</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_fireEvent</span><span class="s3">(</span><span class="s5">&quot;promiseFulfilled&quot;</span><span class="s3">, </span><span class="s4">this</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setRejected </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">| </span><span class="s6">16777216</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_fireEvent</span><span class="s3">(</span><span class="s5">&quot;promiseRejected&quot;</span><span class="s3">, </span><span class="s4">this</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setFollowing </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">| </span><span class="s6">67108864</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_fireEvent</span><span class="s3">(</span><span class="s5">&quot;promiseResolved&quot;</span><span class="s3">, </span><span class="s4">this</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setIsFinal </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">| </span><span class="s6">4194304</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_isFinal </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">4194304</span><span class="s3">) &gt; </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_unsetCancelled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; (~</span><span class="s6">65536</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setCancelled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">| </span><span class="s6">65536</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_fireEvent</span><span class="s3">(</span><span class="s5">&quot;promiseCancelled&quot;</span><span class="s3">, </span><span class="s4">this</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setWillBeCancelled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">| </span><span class="s6">8388608</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setAsyncGuaranteed </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">async</span><span class="s3">.</span><span class="s1">hasCustomScheduler</span><span class="s3">()) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s1">bitField </span><span class="s3">|</span>
        <span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">536870912</span><span class="s3">) &gt;&gt; </span><span class="s6">2</span><span class="s3">) ^</span>
        <span class="s6">134217728</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setNoAsyncGuarantee </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= (</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">| </span><span class="s6">536870912</span><span class="s3">) &amp;</span>
        <span class="s3">(~</span><span class="s6">134217728</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_receiverAt </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">index</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s1">index </span><span class="s3">=== </span><span class="s6">0 </span><span class="s3">? </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_receiver0 </span><span class="s3">: </span><span class="s4">this</span><span class="s3">[</span>
            <span class="s1">index </span><span class="s3">* </span><span class="s6">4 </span><span class="s3">- </span><span class="s6">4 </span><span class="s3">+ </span><span class="s6">3</span><span class="s3">];</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">ret </span><span class="s3">=== </span><span class="s1">UNDEFINED_BINDING</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">undefined</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">ret </span><span class="s3">=== </span><span class="s1">undefined </span><span class="s3">&amp;&amp; </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_isBound</span><span class="s3">()) {</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">_boundValue</span><span class="s3">();</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_promiseAt </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">index</span><span class="s3">) {</span>
    <span class="s4">return this</span><span class="s3">[</span>
            <span class="s1">index </span><span class="s3">* </span><span class="s6">4 </span><span class="s3">- </span><span class="s6">4 </span><span class="s3">+ </span><span class="s6">2</span><span class="s3">];</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_fulfillmentHandlerAt </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">index</span><span class="s3">) {</span>
    <span class="s4">return this</span><span class="s3">[</span>
            <span class="s1">index </span><span class="s3">* </span><span class="s6">4 </span><span class="s3">- </span><span class="s6">4 </span><span class="s3">+ </span><span class="s6">0</span><span class="s3">];</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_rejectionHandlerAt </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">index</span><span class="s3">) {</span>
    <span class="s4">return this</span><span class="s3">[</span>
            <span class="s1">index </span><span class="s3">* </span><span class="s6">4 </span><span class="s3">- </span><span class="s6">4 </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">];</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_boundValue </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_migrateCallback0 </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">follower</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">bitField </span><span class="s3">= </span><span class="s1">follower</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">fulfill </span><span class="s3">= </span><span class="s1">follower</span><span class="s3">.</span><span class="s1">_fulfillmentHandler0</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">reject </span><span class="s3">= </span><span class="s1">follower</span><span class="s3">.</span><span class="s1">_rejectionHandler0</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s1">follower</span><span class="s3">.</span><span class="s1">_promise0</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">receiver </span><span class="s3">= </span><span class="s1">follower</span><span class="s3">.</span><span class="s1">_receiverAt</span><span class="s3">(</span><span class="s6">0</span><span class="s3">);</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">receiver </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s1">receiver </span><span class="s3">= </span><span class="s1">UNDEFINED_BINDING</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_addCallbacks</span><span class="s3">(</span><span class="s1">fulfill</span><span class="s3">, </span><span class="s1">reject</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s4">null</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_migrateCallbackAt </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">follower</span><span class="s3">, </span><span class="s1">index</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">fulfill </span><span class="s3">= </span><span class="s1">follower</span><span class="s3">.</span><span class="s1">_fulfillmentHandlerAt</span><span class="s3">(</span><span class="s1">index</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">reject </span><span class="s3">= </span><span class="s1">follower</span><span class="s3">.</span><span class="s1">_rejectionHandlerAt</span><span class="s3">(</span><span class="s1">index</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s1">follower</span><span class="s3">.</span><span class="s1">_promiseAt</span><span class="s3">(</span><span class="s1">index</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">receiver </span><span class="s3">= </span><span class="s1">follower</span><span class="s3">.</span><span class="s1">_receiverAt</span><span class="s3">(</span><span class="s1">index</span><span class="s3">);</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">receiver </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">) </span><span class="s1">receiver </span><span class="s3">= </span><span class="s1">UNDEFINED_BINDING</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_addCallbacks</span><span class="s3">(</span><span class="s1">fulfill</span><span class="s3">, </span><span class="s1">reject</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s4">null</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_addCallbacks </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span>
    <span class="s1">fulfill</span><span class="s3">,</span>
    <span class="s1">reject</span><span class="s3">,</span>
    <span class="s1">promise</span><span class="s3">,</span>
    <span class="s1">receiver</span><span class="s3">,</span>
    <span class="s1">context</span>
<span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">index </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_length</span><span class="s3">();</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">index </span><span class="s3">&gt;= </span><span class="s6">65535 </span><span class="s3">- </span><span class="s6">4</span><span class="s3">) {</span>
        <span class="s1">index </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_setLength</span><span class="s3">(</span><span class="s6">0</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">index </span><span class="s3">=== </span><span class="s6">0</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_promise0 </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">;</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_receiver0 </span><span class="s3">= </span><span class="s1">receiver</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">fulfill </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_fulfillmentHandler0 </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">contextBind</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">fulfill</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">reject </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_rejectionHandler0 </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">contextBind</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">reject</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">var </span><span class="s1">base </span><span class="s3">= </span><span class="s1">index </span><span class="s3">* </span><span class="s6">4 </span><span class="s3">- </span><span class="s6">4</span><span class="s3">;</span>
        <span class="s4">this</span><span class="s3">[</span><span class="s1">base </span><span class="s3">+ </span><span class="s6">2</span><span class="s3">] = </span><span class="s1">promise</span><span class="s3">;</span>
        <span class="s4">this</span><span class="s3">[</span><span class="s1">base </span><span class="s3">+ </span><span class="s6">3</span><span class="s3">] = </span><span class="s1">receiver</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">fulfill </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s4">this</span><span class="s3">[</span><span class="s1">base </span><span class="s3">+ </span><span class="s6">0</span><span class="s3">] =</span>
                <span class="s1">util</span><span class="s3">.</span><span class="s1">contextBind</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">fulfill</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">reject </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s4">this</span><span class="s3">[</span><span class="s1">base </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">] =</span>
                <span class="s1">util</span><span class="s3">.</span><span class="s1">contextBind</span><span class="s3">(</span><span class="s1">context</span><span class="s3">, </span><span class="s1">reject</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_setLength</span><span class="s3">(</span><span class="s1">index </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">);</span>
    <span class="s4">return </span><span class="s1">index</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_proxy </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">proxyable</span><span class="s3">, </span><span class="s1">arg</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_addCallbacks</span><span class="s3">(</span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s1">arg</span><span class="s3">, </span><span class="s1">proxyable</span><span class="s3">, </span><span class="s4">null</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_resolveCallback </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">shouldBind</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(((</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">117506048</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">value </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">)</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">_rejectCallback</span><span class="s3">(</span><span class="s1">makeSelfResolutionError</span><span class="s3">(), </span><span class="s4">false</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">maybePromise </span><span class="s3">= </span><span class="s1">tryConvertToPromise</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s4">this</span><span class="s3">);</span>
    <span class="s4">if </span><span class="s3">(!(</span><span class="s1">maybePromise </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">)) </span><span class="s4">return this</span><span class="s3">.</span><span class="s1">_fulfill</span><span class="s3">(</span><span class="s1">value</span><span class="s3">);</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">shouldBind</span><span class="s3">) </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_propagateFrom</span><span class="s3">(</span><span class="s1">maybePromise</span><span class="s3">, </span><span class="s6">2</span><span class="s3">);</span>


    <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">();</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">promise </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">makeSelfResolutionError</span><span class="s3">());</span>
        <span class="s4">return</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">var </span><span class="s1">bitField </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">50397184</span><span class="s3">) === </span><span class="s6">0</span><span class="s3">)) {</span>
        <span class="s4">var </span><span class="s1">len </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_length</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">len </span><span class="s3">&gt; </span><span class="s6">0</span><span class="s3">) </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_migrateCallback0</span><span class="s3">(</span><span class="s4">this</span><span class="s3">);</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">1</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">len</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s1">promise</span><span class="s3">.</span><span class="s1">_migrateCallbackAt</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s1">i</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_setFollowing</span><span class="s3">();</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_setLength</span><span class="s3">(</span><span class="s6">0</span><span class="s3">);</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_setFollowee</span><span class="s3">(</span><span class="s1">maybePromise</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">33554432</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_fulfill</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_value</span><span class="s3">());</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">16777216</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_reason</span><span class="s3">());</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">var </span><span class="s1">reason </span><span class="s3">= </span><span class="s4">new </span><span class="s1">CancellationError</span><span class="s3">(</span><span class="s5">&quot;late cancellation observer&quot;</span><span class="s3">);</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_attachExtraTrace</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">);</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_rejectCallback </span><span class="s3">=</span>
<span class="s4">function</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">, </span><span class="s1">synchronous</span><span class="s3">, </span><span class="s1">ignoreNonErrorWarnings</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">trace </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">ensureErrorObject</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">hasStack </span><span class="s3">= </span><span class="s1">trace </span><span class="s3">=== </span><span class="s1">reason</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s1">hasStack </span><span class="s3">&amp;&amp; !</span><span class="s1">ignoreNonErrorWarnings </span><span class="s3">&amp;&amp; </span><span class="s1">debug</span><span class="s3">.</span><span class="s1">warnings</span><span class="s3">()) {</span>
        <span class="s4">var </span><span class="s1">message </span><span class="s3">= </span><span class="s5">&quot;a promise was rejected with a non-error: &quot; </span><span class="s3">+</span>
            <span class="s1">util</span><span class="s3">.</span><span class="s1">classString</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">);</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_warn</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_attachExtraTrace</span><span class="s3">(</span><span class="s1">trace</span><span class="s3">, </span><span class="s1">synchronous </span><span class="s3">? </span><span class="s1">hasStack </span><span class="s3">: </span><span class="s4">false</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_resolveFromExecutor </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">executor</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">executor </span><span class="s3">=== </span><span class="s1">INTERNAL</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s4">this</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_captureStackTrace</span><span class="s3">();</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_pushContext</span><span class="s3">();</span>
    <span class="s4">var </span><span class="s1">synchronous </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">r </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_execute</span><span class="s3">(</span><span class="s1">executor</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_resolveCallback</span><span class="s3">(</span><span class="s1">value</span><span class="s3">);</span>
    <span class="s3">}, </span><span class="s4">function </span><span class="s3">(</span><span class="s1">reason</span><span class="s3">) {</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_rejectCallback</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">, </span><span class="s1">synchronous</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">synchronous </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_popContext</span><span class="s3">();</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">r </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_rejectCallback</span><span class="s3">(</span><span class="s1">r</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_settlePromiseFromHandler </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span>
    <span class="s1">handler</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">value</span><span class="s3">, </span><span class="s1">promise</span>
<span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">bitField </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">65536</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s1">promise</span><span class="s3">.</span><span class="s1">_pushContext</span><span class="s3">();</span>
    <span class="s4">var </span><span class="s1">x</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">receiver </span><span class="s3">=== </span><span class="s1">APPLY</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">value </span><span class="s3">|| </span><span class="s4">typeof </span><span class="s1">value</span><span class="s3">.</span><span class="s1">length </span><span class="s3">!== </span><span class="s5">&quot;number&quot;</span><span class="s3">) {</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">errorObj</span><span class="s3">;</span>
            <span class="s1">x</span><span class="s3">.</span><span class="s1">e </span><span class="s3">= </span><span class="s4">new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s5">&quot;cannot .spread() a non-array: &quot; </span><span class="s3">+</span>
                                    <span class="s1">util</span><span class="s3">.</span><span class="s1">classString</span><span class="s3">(</span><span class="s1">value</span><span class="s3">));</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">handler</span><span class="s3">).</span><span class="s1">apply</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_boundValue</span><span class="s3">(), </span><span class="s1">value</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">handler</span><span class="s3">).</span><span class="s1">call</span><span class="s3">(</span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">value</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">var </span><span class="s1">promiseCreated </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_popContext</span><span class="s3">();</span>
    <span class="s1">bitField </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">65536</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) </span><span class="s4">return</span><span class="s3">;</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">x </span><span class="s3">=== </span><span class="s1">NEXT_FILTER</span><span class="s3">) {</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">value</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">x </span><span class="s3">=== </span><span class="s1">errorObj</span><span class="s3">) {</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_rejectCallback</span><span class="s3">(</span><span class="s1">x</span><span class="s3">.</span><span class="s1">e</span><span class="s3">, </span><span class="s4">false</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s1">debug</span><span class="s3">.</span><span class="s1">checkForgottenReturns</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">promiseCreated</span><span class="s3">, </span><span class="s5">&quot;&quot;</span><span class="s3">,  </span><span class="s1">promise</span><span class="s3">, </span><span class="s4">this</span><span class="s3">);</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_resolveCallback</span><span class="s3">(</span><span class="s1">x</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_target </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s4">this</span><span class="s3">;</span>
    <span class="s4">while </span><span class="s3">(</span><span class="s1">ret</span><span class="s3">.</span><span class="s1">_isFollowing</span><span class="s3">()) </span><span class="s1">ret </span><span class="s3">= </span><span class="s1">ret</span><span class="s3">.</span><span class="s1">_followee</span><span class="s3">();</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_followee </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_rejectionHandler0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_setFollowee </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_rejectionHandler0 </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_settlePromise </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">, </span><span class="s1">handler</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">value</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">isPromise </span><span class="s3">= </span><span class="s1">promise </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">asyncGuaranteed </span><span class="s3">= ((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">134217728</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">);</span>
    <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">65536</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">isPromise</span><span class="s3">) </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_invokeInternalOnCancel</span><span class="s3">();</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">receiver </span><span class="s4">instanceof </span><span class="s1">PassThroughHandlerContext </span><span class="s3">&amp;&amp;</span>
            <span class="s1">receiver</span><span class="s3">.</span><span class="s1">isFinallyHandler</span><span class="s3">()) {</span>
            <span class="s1">receiver</span><span class="s3">.</span><span class="s1">cancelPromise </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">;</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">handler</span><span class="s3">).</span><span class="s1">call</span><span class="s3">(</span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">value</span><span class="s3">) === </span><span class="s1">errorObj</span><span class="s3">) {</span>
                <span class="s1">promise</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">errorObj</span><span class="s3">.</span><span class="s1">e</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">handler </span><span class="s3">=== </span><span class="s1">reflectHandler</span><span class="s3">) {</span>
            <span class="s1">promise</span><span class="s3">.</span><span class="s1">_fulfill</span><span class="s3">(</span><span class="s1">reflectHandler</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">receiver</span><span class="s3">));</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">receiver </span><span class="s4">instanceof </span><span class="s1">Proxyable</span><span class="s3">) {</span>
            <span class="s1">receiver</span><span class="s3">.</span><span class="s1">_promiseCancelled</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">isPromise </span><span class="s3">|| </span><span class="s1">promise </span><span class="s4">instanceof </span><span class="s1">PromiseArray</span><span class="s3">) {</span>
            <span class="s1">promise</span><span class="s3">.</span><span class="s1">_cancel</span><span class="s3">();</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">receiver</span><span class="s3">.</span><span class="s1">cancel</span><span class="s3">();</span>
        <span class="s3">}</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">handler </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">isPromise</span><span class="s3">) {</span>
            <span class="s1">handler</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">value</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">asyncGuaranteed</span><span class="s3">) </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_setAsyncGuaranteed</span><span class="s3">();</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_settlePromiseFromHandler</span><span class="s3">(</span><span class="s1">handler</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">value</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">receiver </span><span class="s4">instanceof </span><span class="s1">Proxyable</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">receiver</span><span class="s3">.</span><span class="s1">_isResolved</span><span class="s3">()) {</span>
            <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">33554432</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
                <span class="s1">receiver</span><span class="s3">.</span><span class="s1">_promiseFulfilled</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">receiver</span><span class="s3">.</span><span class="s1">_promiseRejected</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">isPromise</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">asyncGuaranteed</span><span class="s3">) </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_setAsyncGuaranteed</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">33554432</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
            <span class="s1">promise</span><span class="s3">.</span><span class="s1">_fulfill</span><span class="s3">(</span><span class="s1">value</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">promise</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">value</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_settlePromiseLateCancellationObserver </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">ctx</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">handler </span><span class="s3">= </span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">handler</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">promise</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">receiver </span><span class="s3">= </span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">receiver</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">value </span><span class="s3">= </span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">value</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">handler </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(!(</span><span class="s1">promise </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">)) {</span>
            <span class="s1">handler</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">value</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_settlePromiseFromHandler</span><span class="s3">(</span><span class="s1">handler</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">value</span><span class="s3">, </span><span class="s1">promise</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">promise </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) {</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">value</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_settlePromiseCtx </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">ctx</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_settlePromise</span><span class="s3">(</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">promise</span><span class="s3">, </span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">handler</span><span class="s3">, </span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">value</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_settlePromise0 </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">handler</span><span class="s3">, </span><span class="s1">value</span><span class="s3">, </span><span class="s1">bitField</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_promise0</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">receiver </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_receiverAt</span><span class="s3">(</span><span class="s6">0</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_promise0 </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_receiver0 </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_settlePromise</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">, </span><span class="s1">handler</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">value</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_clearCallbackDataAtIndex </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">index</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">base </span><span class="s3">= </span><span class="s1">index </span><span class="s3">* </span><span class="s6">4 </span><span class="s3">- </span><span class="s6">4</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">[</span><span class="s1">base </span><span class="s3">+ </span><span class="s6">2</span><span class="s3">] =</span>
    <span class="s4">this</span><span class="s3">[</span><span class="s1">base </span><span class="s3">+ </span><span class="s6">3</span><span class="s3">] =</span>
    <span class="s4">this</span><span class="s3">[</span><span class="s1">base </span><span class="s3">+ </span><span class="s6">0</span><span class="s3">] =</span>
    <span class="s4">this</span><span class="s3">[</span><span class="s1">base </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">] = </span><span class="s1">undefined</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_fulfill </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">117506048</span><span class="s3">) &gt;&gt;&gt; </span><span class="s6">16</span><span class="s3">)) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">value </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">err </span><span class="s3">= </span><span class="s1">makeSelfResolutionError</span><span class="s3">();</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_attachExtraTrace</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">err</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_setFulfilled</span><span class="s3">();</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_rejectionHandler0 </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;</span>

    <span class="s4">if </span><span class="s3">((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">65535</span><span class="s3">) &gt; </span><span class="s6">0</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">134217728</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_settlePromises</span><span class="s3">();</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">async</span><span class="s3">.</span><span class="s1">settlePromises</span><span class="s3">(</span><span class="s4">this</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_dereferenceTrace</span><span class="s3">();</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_reject </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">reason</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">117506048</span><span class="s3">) &gt;&gt;&gt; </span><span class="s6">16</span><span class="s3">)) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_setRejected</span><span class="s3">();</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_fulfillmentHandler0 </span><span class="s3">= </span><span class="s1">reason</span><span class="s3">;</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_isFinal</span><span class="s3">()) {</span>
        <span class="s4">return </span><span class="s1">async</span><span class="s3">.</span><span class="s1">fatalError</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">, </span><span class="s1">util</span><span class="s3">.</span><span class="s1">isNode</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s4">if </span><span class="s3">((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">65535</span><span class="s3">) &gt; </span><span class="s6">0</span><span class="s3">) {</span>
        <span class="s1">async</span><span class="s3">.</span><span class="s1">settlePromises</span><span class="s3">(</span><span class="s4">this</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_ensurePossibleRejectionHandled</span><span class="s3">();</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_fulfillPromises </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">len</span><span class="s3">, </span><span class="s1">value</span><span class="s3">) {</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">1</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">len</span><span class="s3">; </span><span class="s1">i</span><span class="s3">++) {</span>
        <span class="s4">var </span><span class="s1">handler </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fulfillmentHandlerAt</span><span class="s3">(</span><span class="s1">i</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_promiseAt</span><span class="s3">(</span><span class="s1">i</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">receiver </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_receiverAt</span><span class="s3">(</span><span class="s1">i</span><span class="s3">);</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_clearCallbackDataAtIndex</span><span class="s3">(</span><span class="s1">i</span><span class="s3">);</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_settlePromise</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">, </span><span class="s1">handler</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">value</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_rejectPromises </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">len</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">) {</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">1</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">len</span><span class="s3">; </span><span class="s1">i</span><span class="s3">++) {</span>
        <span class="s4">var </span><span class="s1">handler </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_rejectionHandlerAt</span><span class="s3">(</span><span class="s1">i</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_promiseAt</span><span class="s3">(</span><span class="s1">i</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">receiver </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_receiverAt</span><span class="s3">(</span><span class="s1">i</span><span class="s3">);</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_clearCallbackDataAtIndex</span><span class="s3">(</span><span class="s1">i</span><span class="s3">);</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_settlePromise</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">, </span><span class="s1">handler</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_settlePromises </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">len </span><span class="s3">= (</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">65535</span><span class="s3">);</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">len </span><span class="s3">&gt; </span><span class="s6">0</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">16842752</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
            <span class="s4">var </span><span class="s1">reason </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fulfillmentHandler0</span><span class="s3">;</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_settlePromise0</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_rejectionHandler0</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">, </span><span class="s1">bitField</span><span class="s3">);</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_rejectPromises</span><span class="s3">(</span><span class="s1">len</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">var </span><span class="s1">value </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_rejectionHandler0</span><span class="s3">;</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_settlePromise0</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_fulfillmentHandler0</span><span class="s3">, </span><span class="s1">value</span><span class="s3">, </span><span class="s1">bitField</span><span class="s3">);</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_fulfillPromises</span><span class="s3">(</span><span class="s1">len</span><span class="s3">, </span><span class="s1">value</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_setLength</span><span class="s3">(</span><span class="s6">0</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_clearCancellationData</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_settledValue </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">bitField </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">33554432</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">_rejectionHandler0</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">16777216</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">_fulfillmentHandler0</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">Symbol </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">Symbol</span><span class="s3">.</span><span class="s1">toStringTag</span><span class="s3">) {</span>
    <span class="s1">es5</span><span class="s3">.</span><span class="s1">defineProperty</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">, </span><span class="s1">Symbol</span><span class="s3">.</span><span class="s1">toStringTag</span><span class="s3">, {</span>
        <span class="s1">get</span><span class="s3">: </span><span class="s4">function </span><span class="s3">() {</span>
            <span class="s4">return </span><span class="s5">&quot;Object&quot;</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">});</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">deferResolve</span><span class="s3">(</span><span class="s1">v</span><span class="s3">) {</span><span class="s4">this</span><span class="s3">.</span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_resolveCallback</span><span class="s3">(</span><span class="s1">v</span><span class="s3">);}</span>
<span class="s4">function </span><span class="s1">deferReject</span><span class="s3">(</span><span class="s1">v</span><span class="s3">) {</span><span class="s4">this</span><span class="s3">.</span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_rejectCallback</span><span class="s3">(</span><span class="s1">v</span><span class="s3">, </span><span class="s4">false</span><span class="s3">);}</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">defer </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">pending </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s1">debug</span><span class="s3">.</span><span class="s1">deprecated</span><span class="s3">(</span><span class="s5">&quot;Promise.defer&quot;</span><span class="s3">, </span><span class="s5">&quot;new Promise&quot;</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">);</span>
    <span class="s4">return </span><span class="s3">{</span>
        <span class="s1">promise</span><span class="s3">: </span><span class="s1">promise</span><span class="s3">,</span>
        <span class="s1">resolve</span><span class="s3">: </span><span class="s1">deferResolve</span><span class="s3">,</span>
        <span class="s1">reject</span><span class="s3">: </span><span class="s1">deferReject</span>
    <span class="s3">};</span>
<span class="s3">};</span>

<span class="s1">util</span><span class="s3">.</span><span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">,</span>
                       <span class="s5">&quot;_makeSelfResolutionError&quot;</span><span class="s3">,</span>
                       <span class="s1">makeSelfResolutionError</span><span class="s3">);</span>

<span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./method&quot;</span><span class="s3">)(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">INTERNAL</span><span class="s3">, </span><span class="s1">tryConvertToPromise</span><span class="s3">, </span><span class="s1">apiRejection</span><span class="s3">,</span>
    <span class="s1">debug</span><span class="s3">);</span>
<span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./bind&quot;</span><span class="s3">)(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">INTERNAL</span><span class="s3">, </span><span class="s1">tryConvertToPromise</span><span class="s3">, </span><span class="s1">debug</span><span class="s3">);</span>
<span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./cancel&quot;</span><span class="s3">)(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">PromiseArray</span><span class="s3">, </span><span class="s1">apiRejection</span><span class="s3">, </span><span class="s1">debug</span><span class="s3">);</span>
<span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./direct_resolve&quot;</span><span class="s3">)(</span><span class="s1">Promise</span><span class="s3">);</span>
<span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./synchronous_inspection&quot;</span><span class="s3">)(</span><span class="s1">Promise</span><span class="s3">);</span>
<span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./join&quot;</span><span class="s3">)(</span>
    <span class="s1">Promise</span><span class="s3">, </span><span class="s1">PromiseArray</span><span class="s3">, </span><span class="s1">tryConvertToPromise</span><span class="s3">, </span><span class="s1">INTERNAL</span><span class="s3">, </span><span class="s1">async</span><span class="s3">);</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">Promise </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">;</span>
<span class="s1">Promise</span><span class="s3">.</span><span class="s1">version </span><span class="s3">= </span><span class="s5">&quot;3.7.2&quot;</span><span class="s3">;</span>
                                                         
    <span class="s1">util</span><span class="s3">.</span><span class="s1">toFastProperties</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">);                                          </span>
    <span class="s1">util</span><span class="s3">.</span><span class="s1">toFastProperties</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">);                                </span>
    <span class="s4">function </span><span class="s1">fillTypes</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {                                              </span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">);                                       </span>
        <span class="s1">p</span><span class="s3">.</span><span class="s1">_fulfillmentHandler0 </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;                                      </span>
        <span class="s1">p</span><span class="s3">.</span><span class="s1">_rejectionHandler0 </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;                                        </span>
        <span class="s1">p</span><span class="s3">.</span><span class="s1">_promise0 </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;                                                 </span>
        <span class="s1">p</span><span class="s3">.</span><span class="s1">_receiver0 </span><span class="s3">= </span><span class="s1">value</span><span class="s3">;                                                </span>
    <span class="s3">}                                                                        </span>
    <span class="s0">// Complete slack tracking, opt out of field-type tracking and           </span>
    <span class="s0">// stabilize map                                                         </span>
    <span class="s1">fillTypes</span><span class="s3">({</span><span class="s1">a</span><span class="s3">: </span><span class="s6">1</span><span class="s3">});                                                       </span>
    <span class="s1">fillTypes</span><span class="s3">({</span><span class="s1">b</span><span class="s3">: </span><span class="s6">2</span><span class="s3">});                                                       </span>
    <span class="s1">fillTypes</span><span class="s3">({</span><span class="s1">c</span><span class="s3">: </span><span class="s6">3</span><span class="s3">});                                                       </span>
    <span class="s1">fillTypes</span><span class="s3">(</span><span class="s6">1</span><span class="s3">);                                                            </span>
    <span class="s1">fillTypes</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(){});                                                 </span>
    <span class="s1">fillTypes</span><span class="s3">(</span><span class="s1">undefined</span><span class="s3">);                                                    </span>
    <span class="s1">fillTypes</span><span class="s3">(</span><span class="s4">false</span><span class="s3">);                                                        </span>
    <span class="s1">fillTypes</span><span class="s3">(</span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">));                                        </span>
    <span class="s1">debug</span><span class="s3">.</span><span class="s1">setBounds</span><span class="s3">(</span><span class="s1">Async</span><span class="s3">.</span><span class="s1">firstLineError</span><span class="s3">, </span><span class="s1">util</span><span class="s3">.</span><span class="s1">lastLineError</span><span class="s3">);               </span>
    <span class="s4">return </span><span class="s1">Promise</span><span class="s3">;                                                          </span>

<span class="s3">};</span>

<span class="s3">},{</span><span class="s5">&quot;./async&quot;</span><span class="s3">:</span><span class="s6">1</span><span class="s3">,</span><span class="s5">&quot;./bind&quot;</span><span class="s3">:</span><span class="s6">2</span><span class="s3">,</span><span class="s5">&quot;./cancel&quot;</span><span class="s3">:</span><span class="s6">4</span><span class="s3">,</span><span class="s5">&quot;./catch_filter&quot;</span><span class="s3">:</span><span class="s6">5</span><span class="s3">,</span><span class="s5">&quot;./context&quot;</span><span class="s3">:</span><span class="s6">6</span><span class="s3">,</span><span class="s5">&quot;./debuggability&quot;</span><span class="s3">:</span><span class="s6">7</span><span class="s3">,</span><span class="s5">&quot;./direct_resolve&quot;</span><span class="s3">:</span><span class="s6">8</span><span class="s3">,</span><span class="s5">&quot;./errors&quot;</span><span class="s3">:</span><span class="s6">9</span><span class="s3">,</span><span class="s5">&quot;./es5&quot;</span><span class="s3">:</span><span class="s6">10</span><span class="s3">,</span><span class="s5">&quot;./finally&quot;</span><span class="s3">:</span><span class="s6">11</span><span class="s3">,</span><span class="s5">&quot;./join&quot;</span><span class="s3">:</span><span class="s6">12</span><span class="s3">,</span><span class="s5">&quot;./method&quot;</span><span class="s3">:</span><span class="s6">13</span><span class="s3">,</span><span class="s5">&quot;./nodeback&quot;</span><span class="s3">:</span><span class="s6">14</span><span class="s3">,</span><span class="s5">&quot;./promise_array&quot;</span><span class="s3">:</span><span class="s6">16</span><span class="s3">,</span><span class="s5">&quot;./synchronous_inspection&quot;</span><span class="s3">:</span><span class="s6">19</span><span class="s3">,</span><span class="s5">&quot;./thenables&quot;</span><span class="s3">:</span><span class="s6">20</span><span class="s3">,</span><span class="s5">&quot;./util&quot;</span><span class="s3">:</span><span class="s6">21</span><span class="s3">,</span><span class="s5">&quot;async_hooks&quot;</span><span class="s3">:</span><span class="s1">undefined</span><span class="s3">}],</span><span class="s6">16</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">INTERNAL</span><span class="s3">, </span><span class="s1">tryConvertToPromise</span><span class="s3">,</span>
    <span class="s1">apiRejection</span><span class="s3">, </span><span class="s1">Proxyable</span><span class="s3">) {</span>
<span class="s4">var </span><span class="s1">util </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./util&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">isArray </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">isArray</span><span class="s3">;</span>

<span class="s4">function </span><span class="s1">toResolutionValue</span><span class="s3">(</span><span class="s1">val</span><span class="s3">) {</span>
    <span class="s4">switch</span><span class="s3">(</span><span class="s1">val</span><span class="s3">) {</span>
    <span class="s4">case </span><span class="s3">-</span><span class="s6">2</span><span class="s3">: </span><span class="s4">return </span><span class="s3">[];</span>
    <span class="s4">case </span><span class="s3">-</span><span class="s6">3</span><span class="s3">: </span><span class="s4">return </span><span class="s3">{};</span>
    <span class="s4">case </span><span class="s3">-</span><span class="s6">6</span><span class="s3">: </span><span class="s4">return new </span><span class="s1">Map</span><span class="s3">();</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">PromiseArray</span><span class="s3">(</span><span class="s1">values</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_promise </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">);</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">values </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) {</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_propagateFrom</span><span class="s3">(</span><span class="s1">values</span><span class="s3">, </span><span class="s6">3</span><span class="s3">);</span>
        <span class="s1">values</span><span class="s3">.</span><span class="s1">suppressUnhandledRejections</span><span class="s3">();</span>
    <span class="s3">}</span>
    <span class="s1">promise</span><span class="s3">.</span><span class="s1">_setOnCancel</span><span class="s3">(</span><span class="s4">this</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_values </span><span class="s3">= </span><span class="s1">values</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_length </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_totalResolved </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_init</span><span class="s3">(</span><span class="s1">undefined</span><span class="s3">, -</span><span class="s6">2</span><span class="s3">);</span>
<span class="s3">}</span>
<span class="s1">util</span><span class="s3">.</span><span class="s1">inherits</span><span class="s3">(</span><span class="s1">PromiseArray</span><span class="s3">, </span><span class="s1">Proxyable</span><span class="s3">);</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">length </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_length</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">promise </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_promise</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_init </span><span class="s3">= </span><span class="s4">function </span><span class="s1">init</span><span class="s3">(</span><span class="s1">_</span><span class="s3">, </span><span class="s1">resolveValueIfEmpty</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">values </span><span class="s3">= </span><span class="s1">tryConvertToPromise</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_values</span><span class="s3">, </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_promise</span><span class="s3">);</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">values </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) {</span>
        <span class="s1">values </span><span class="s3">= </span><span class="s1">values</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">();</span>
        <span class="s4">var </span><span class="s1">bitField </span><span class="s3">= </span><span class="s1">values</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
        <span class="s3">;</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_values </span><span class="s3">= </span><span class="s1">values</span><span class="s3">;</span>

        <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">50397184</span><span class="s3">) === </span><span class="s6">0</span><span class="s3">)) {</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_promise</span><span class="s3">.</span><span class="s1">_setAsyncGuaranteed</span><span class="s3">();</span>
            <span class="s4">return </span><span class="s1">values</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span>
                <span class="s1">init</span><span class="s3">,</span>
                <span class="s4">this</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">,</span>
                <span class="s1">undefined</span><span class="s3">,</span>
                <span class="s4">this</span><span class="s3">,</span>
                <span class="s1">resolveValueIfEmpty</span>
           <span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">33554432</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
            <span class="s1">values </span><span class="s3">= </span><span class="s1">values</span><span class="s3">.</span><span class="s1">_value</span><span class="s3">();</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">16777216</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
            <span class="s4">return this</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">values</span><span class="s3">.</span><span class="s1">_reason</span><span class="s3">());</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">return this</span><span class="s3">.</span><span class="s1">_cancel</span><span class="s3">();</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s1">values </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">asArray</span><span class="s3">(</span><span class="s1">values</span><span class="s3">);</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">values </span><span class="s3">=== </span><span class="s4">null</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">err </span><span class="s3">= </span><span class="s1">apiRejection</span><span class="s3">(</span>
            <span class="s5">&quot;expecting an array or an iterable object but got &quot; </span><span class="s3">+ </span><span class="s1">util</span><span class="s3">.</span><span class="s1">classString</span><span class="s3">(</span><span class="s1">values</span><span class="s3">)).</span><span class="s1">reason</span><span class="s3">();</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_promise</span><span class="s3">.</span><span class="s1">_rejectCallback</span><span class="s3">(</span><span class="s1">err</span><span class="s3">, </span><span class="s4">false</span><span class="s3">);</span>
        <span class="s4">return</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">values</span><span class="s3">.</span><span class="s1">length </span><span class="s3">=== </span><span class="s6">0</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">resolveValueIfEmpty </span><span class="s3">=== -</span><span class="s6">5</span><span class="s3">) {</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_resolveEmptyArray</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s4">else </span><span class="s3">{</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">_resolve</span><span class="s3">(</span><span class="s1">toResolutionValue</span><span class="s3">(</span><span class="s1">resolveValueIfEmpty</span><span class="s3">));</span>
        <span class="s3">}</span>
        <span class="s4">return</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_iterate</span><span class="s3">(</span><span class="s1">values</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_iterate </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">values</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">len </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">getActualLength</span><span class="s3">(</span><span class="s1">values</span><span class="s3">.</span><span class="s1">length</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_length </span><span class="s3">= </span><span class="s1">len</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_values </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">shouldCopyValues</span><span class="s3">() ? </span><span class="s4">new </span><span class="s1">Array</span><span class="s3">(</span><span class="s1">len</span><span class="s3">) : </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_values</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">result </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_promise</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">isResolved </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">bitField </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">len</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">maybePromise </span><span class="s3">= </span><span class="s1">tryConvertToPromise</span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">], </span><span class="s1">result</span><span class="s3">);</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">maybePromise </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) {</span>
            <span class="s1">maybePromise </span><span class="s3">= </span><span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">();</span>
            <span class="s1">bitField </span><span class="s3">= </span><span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">bitField </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
        <span class="s3">}</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">isResolved</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">bitField </span><span class="s3">!== </span><span class="s4">null</span><span class="s3">) {</span>
                <span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">suppressUnhandledRejections</span><span class="s3">();</span>
            <span class="s3">}</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">bitField </span><span class="s3">!== </span><span class="s4">null</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">50397184</span><span class="s3">) === </span><span class="s6">0</span><span class="s3">)) {</span>
                <span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_proxy</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s1">i</span><span class="s3">);</span>
                <span class="s4">this</span><span class="s3">.</span><span class="s1">_values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">maybePromise</span><span class="s3">;</span>
            <span class="s3">} </span><span class="s4">else if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">33554432</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
                <span class="s1">isResolved </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_promiseFulfilled</span><span class="s3">(</span><span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_value</span><span class="s3">(), </span><span class="s1">i</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else if </span><span class="s3">(((</span><span class="s1">bitField </span><span class="s3">&amp; </span><span class="s6">16777216</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">)) {</span>
                <span class="s1">isResolved </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_promiseRejected</span><span class="s3">(</span><span class="s1">maybePromise</span><span class="s3">.</span><span class="s1">_reason</span><span class="s3">(), </span><span class="s1">i</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">isResolved </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_promiseCancelled</span><span class="s3">(</span><span class="s1">i</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">isResolved </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_promiseFulfilled</span><span class="s3">(</span><span class="s1">maybePromise</span><span class="s3">, </span><span class="s1">i</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s1">isResolved</span><span class="s3">) </span><span class="s1">result</span><span class="s3">.</span><span class="s1">_setAsyncGuaranteed</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_isResolved </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_values </span><span class="s3">=== </span><span class="s4">null</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_resolve </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_values </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_promise</span><span class="s3">.</span><span class="s1">_fulfill</span><span class="s3">(</span><span class="s1">value</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_cancel </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_isResolved</span><span class="s3">() || !</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_promise</span><span class="s3">.</span><span class="s1">_isCancellable</span><span class="s3">()) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_values </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_promise</span><span class="s3">.</span><span class="s1">_cancel</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_reject </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">reason</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_values </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_promise</span><span class="s3">.</span><span class="s1">_rejectCallback</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">, </span><span class="s4">false</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_promiseFulfilled </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">index</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_values</span><span class="s3">[</span><span class="s1">index</span><span class="s3">] = </span><span class="s1">value</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">totalResolved </span><span class="s3">= ++</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_totalResolved</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">totalResolved </span><span class="s3">&gt;= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_length</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_resolve</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_values</span><span class="s3">);</span>
        <span class="s4">return true</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">return false</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_promiseCancelled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_cancel</span><span class="s3">();</span>
    <span class="s4">return true</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_promiseRejected </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">reason</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_totalResolved</span><span class="s3">++;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">);</span>
    <span class="s4">return true</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_resultCancelled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_isResolved</span><span class="s3">()) </span><span class="s4">return</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">values </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_values</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_cancel</span><span class="s3">();</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">values </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) {</span>
        <span class="s1">values</span><span class="s3">.</span><span class="s1">cancel</span><span class="s3">();</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">values</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) {</span>
                <span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">cancel</span><span class="s3">();</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">shouldCopyValues </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return true</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">PromiseArray</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">getActualLength </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">len</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s1">len</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">return </span><span class="s1">PromiseArray</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s3">},{</span><span class="s5">&quot;./util&quot;</span><span class="s3">:</span><span class="s6">21</span><span class="s3">}],</span><span class="s6">17</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s4">function </span><span class="s1">arrayMove</span><span class="s3">(</span><span class="s1">src</span><span class="s3">, </span><span class="s1">srcIndex</span><span class="s3">, </span><span class="s1">dst</span><span class="s3">, </span><span class="s1">dstIndex</span><span class="s3">, </span><span class="s1">len</span><span class="s3">) {</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">j </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">j </span><span class="s3">&lt; </span><span class="s1">len</span><span class="s3">; ++</span><span class="s1">j</span><span class="s3">) {</span>
        <span class="s1">dst</span><span class="s3">[</span><span class="s1">j </span><span class="s3">+ </span><span class="s1">dstIndex</span><span class="s3">] = </span><span class="s1">src</span><span class="s3">[</span><span class="s1">j </span><span class="s3">+ </span><span class="s1">srcIndex</span><span class="s3">];</span>
        <span class="s1">src</span><span class="s3">[</span><span class="s1">j </span><span class="s3">+ </span><span class="s1">srcIndex</span><span class="s3">] = </span><span class="s4">void </span><span class="s6">0</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">Queue</span><span class="s3">(</span><span class="s1">capacity</span><span class="s3">) {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_capacity </span><span class="s3">= </span><span class="s1">capacity</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_length </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_front </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s1">Queue</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_willBeOverCapacity </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">size</span><span class="s3">) {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_capacity </span><span class="s3">&lt; </span><span class="s1">size</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Queue</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_pushOne </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">arg</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">length </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">length</span><span class="s3">();</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_checkCapacity</span><span class="s3">(</span><span class="s1">length </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">i </span><span class="s3">= (</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_front </span><span class="s3">+ </span><span class="s1">length</span><span class="s3">) &amp; (</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_capacity </span><span class="s3">- </span><span class="s6">1</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">arg</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_length </span><span class="s3">= </span><span class="s1">length </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Queue</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">push </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">fn</span><span class="s3">, </span><span class="s1">receiver</span><span class="s3">, </span><span class="s1">arg</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">length </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">length</span><span class="s3">() + </span><span class="s6">3</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_willBeOverCapacity</span><span class="s3">(</span><span class="s1">length</span><span class="s3">)) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_pushOne</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">);</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_pushOne</span><span class="s3">(</span><span class="s1">receiver</span><span class="s3">);</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_pushOne</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">);</span>
        <span class="s4">return</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">var </span><span class="s1">j </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_front </span><span class="s3">+ </span><span class="s1">length </span><span class="s3">- </span><span class="s6">3</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_checkCapacity</span><span class="s3">(</span><span class="s1">length</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">wrapMask </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_capacity </span><span class="s3">- </span><span class="s6">1</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">[(</span><span class="s1">j </span><span class="s3">+ </span><span class="s6">0</span><span class="s3">) &amp; </span><span class="s1">wrapMask</span><span class="s3">] = </span><span class="s1">fn</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">[(</span><span class="s1">j </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">) &amp; </span><span class="s1">wrapMask</span><span class="s3">] = </span><span class="s1">receiver</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">[(</span><span class="s1">j </span><span class="s3">+ </span><span class="s6">2</span><span class="s3">) &amp; </span><span class="s1">wrapMask</span><span class="s3">] = </span><span class="s1">arg</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_length </span><span class="s3">= </span><span class="s1">length</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Queue</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">shift </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">front </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_front</span><span class="s3">,</span>
        <span class="s1">ret </span><span class="s3">= </span><span class="s4">this</span><span class="s3">[</span><span class="s1">front</span><span class="s3">];</span>

    <span class="s4">this</span><span class="s3">[</span><span class="s1">front</span><span class="s3">] = </span><span class="s1">undefined</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_front </span><span class="s3">= (</span><span class="s1">front </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">) &amp; (</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_capacity </span><span class="s3">- </span><span class="s6">1</span><span class="s3">);</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_length</span><span class="s3">--;</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Queue</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">length </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_length</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Queue</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_checkCapacity </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">size</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_capacity </span><span class="s3">&lt; </span><span class="s1">size</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_resizeTo</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_capacity </span><span class="s3">&lt;&lt; </span><span class="s6">1</span><span class="s3">);</span>
    <span class="s3">}</span>
<span class="s3">};</span>

<span class="s1">Queue</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_resizeTo </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">capacity</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">oldCapacity </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_capacity</span><span class="s3">;</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_capacity </span><span class="s3">= </span><span class="s1">capacity</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">front </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_front</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">length </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_length</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">moveItemsCount </span><span class="s3">= (</span><span class="s1">front </span><span class="s3">+ </span><span class="s1">length</span><span class="s3">) &amp; (</span><span class="s1">oldCapacity </span><span class="s3">- </span><span class="s6">1</span><span class="s3">);</span>
    <span class="s1">arrayMove</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s4">this</span><span class="s3">, </span><span class="s1">oldCapacity</span><span class="s3">, </span><span class="s1">moveItemsCount</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s1">Queue</span><span class="s3">;</span>

<span class="s3">},{}],</span><span class="s6">18</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">util </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./util&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">schedule</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">noAsyncScheduler </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">throw new </span><span class="s1">Error</span><span class="s3">(</span><span class="s5">&quot;No async scheduler available</span><span class="s4">\u000a\u000a    </span><span class="s5">See http://goo.gl/MqrFmX</span><span class="s4">\u000a</span><span class="s5">&quot;</span><span class="s3">);</span>
<span class="s3">};</span>
<span class="s4">var </span><span class="s1">NativePromise </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">getNativePromise</span><span class="s3">();</span>
<span class="s4">if </span><span class="s3">(</span><span class="s1">util</span><span class="s3">.</span><span class="s1">isNode </span><span class="s3">&amp;&amp; </span><span class="s4">typeof </span><span class="s1">MutationObserver </span><span class="s3">=== </span><span class="s5">&quot;undefined&quot;</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">GlobalSetImmediate </span><span class="s3">= </span><span class="s1">global</span><span class="s3">.</span><span class="s1">setImmediate</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">ProcessNextTick </span><span class="s3">= </span><span class="s1">process</span><span class="s3">.</span><span class="s1">nextTick</span><span class="s3">;</span>
    <span class="s1">schedule </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">isRecentNode</span>
                <span class="s3">? </span><span class="s4">function</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) { </span><span class="s1">GlobalSetImmediate</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">global</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">); }</span>
                <span class="s3">: </span><span class="s4">function</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) { </span><span class="s1">ProcessNextTick</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">process</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">); };</span>
<span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">NativePromise </span><span class="s3">=== </span><span class="s5">&quot;function&quot; </span><span class="s3">&amp;&amp;</span>
           <span class="s4">typeof </span><span class="s1">NativePromise</span><span class="s3">.</span><span class="s1">resolve </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">nativePromise </span><span class="s3">= </span><span class="s1">NativePromise</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">();</span>
    <span class="s1">schedule </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
        <span class="s1">nativePromise</span><span class="s3">.</span><span class="s1">then</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">);</span>
    <span class="s3">};</span>
<span class="s3">} </span><span class="s4">else if </span><span class="s3">((</span><span class="s4">typeof </span><span class="s1">MutationObserver </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s3">) &amp;&amp;</span>
          <span class="s3">!(</span><span class="s4">typeof </span><span class="s1">window </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s3">&amp;&amp;</span>
            <span class="s1">window</span><span class="s3">.</span><span class="s1">navigator </span><span class="s3">&amp;&amp;</span>
            <span class="s3">(</span><span class="s1">window</span><span class="s3">.</span><span class="s1">navigator</span><span class="s3">.</span><span class="s1">standalone </span><span class="s3">|| </span><span class="s1">window</span><span class="s3">.</span><span class="s1">cordova</span><span class="s3">)) &amp;&amp;</span>
          <span class="s3">(</span><span class="s5">&quot;classList&quot; </span><span class="s4">in </span><span class="s1">document</span><span class="s3">.</span><span class="s1">documentElement</span><span class="s3">)) {</span>
    <span class="s1">schedule </span><span class="s3">= (</span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s4">var </span><span class="s1">div </span><span class="s3">= </span><span class="s1">document</span><span class="s3">.</span><span class="s1">createElement</span><span class="s3">(</span><span class="s5">&quot;div&quot;</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">opts </span><span class="s3">= {</span><span class="s1">attributes</span><span class="s3">: </span><span class="s4">true</span><span class="s3">};</span>
        <span class="s4">var </span><span class="s1">toggleScheduled </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">div2 </span><span class="s3">= </span><span class="s1">document</span><span class="s3">.</span><span class="s1">createElement</span><span class="s3">(</span><span class="s5">&quot;div&quot;</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">o2 </span><span class="s3">= </span><span class="s4">new </span><span class="s1">MutationObserver</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">div</span><span class="s3">.</span><span class="s1">classList</span><span class="s3">.</span><span class="s1">toggle</span><span class="s3">(</span><span class="s5">&quot;foo&quot;</span><span class="s3">);</span>
            <span class="s1">toggleScheduled </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
        <span class="s3">});</span>
        <span class="s1">o2</span><span class="s3">.</span><span class="s1">observe</span><span class="s3">(</span><span class="s1">div2</span><span class="s3">, </span><span class="s1">opts</span><span class="s3">);</span>

        <span class="s4">var </span><span class="s1">scheduleToggle </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">toggleScheduled</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
            <span class="s1">toggleScheduled </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
            <span class="s1">div2</span><span class="s3">.</span><span class="s1">classList</span><span class="s3">.</span><span class="s1">toggle</span><span class="s3">(</span><span class="s5">&quot;foo&quot;</span><span class="s3">);</span>
        <span class="s3">};</span>

        <span class="s4">return function </span><span class="s1">schedule</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">o </span><span class="s3">= </span><span class="s4">new </span><span class="s1">MutationObserver</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
                <span class="s1">o</span><span class="s3">.</span><span class="s1">disconnect</span><span class="s3">();</span>
                <span class="s1">fn</span><span class="s3">();</span>
            <span class="s3">});</span>
            <span class="s1">o</span><span class="s3">.</span><span class="s1">observe</span><span class="s3">(</span><span class="s1">div</span><span class="s3">, </span><span class="s1">opts</span><span class="s3">);</span>
            <span class="s1">scheduleToggle</span><span class="s3">();</span>
        <span class="s3">};</span>
    <span class="s3">})();</span>
<span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">setImmediate </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s3">) {</span>
    <span class="s1">schedule </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
        <span class="s1">setImmediate</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">);</span>
    <span class="s3">};</span>
<span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">setTimeout </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s3">) {</span>
    <span class="s1">schedule </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
        <span class="s1">setTimeout</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">, </span><span class="s6">0</span><span class="s3">);</span>
    <span class="s3">};</span>
<span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
    <span class="s1">schedule </span><span class="s3">= </span><span class="s1">noAsyncScheduler</span><span class="s3">;</span>
<span class="s3">}</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s1">schedule</span><span class="s3">;</span>

<span class="s3">},{</span><span class="s5">&quot;./util&quot;</span><span class="s3">:</span><span class="s6">21</span><span class="s3">}],</span><span class="s6">19</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">) {</span>
<span class="s4">function </span><span class="s1">PromiseInspection</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">promise </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
        <span class="s1">promise </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">();</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_bitField</span><span class="s3">;</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_settledValueField </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_isFateSealed</span><span class="s3">()</span>
            <span class="s3">? </span><span class="s1">promise</span><span class="s3">.</span><span class="s1">_settledValue</span><span class="s3">() : </span><span class="s1">undefined</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">else </span><span class="s3">{</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">= </span><span class="s6">0</span><span class="s3">;</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">_settledValueField </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s1">PromiseInspection</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_settledValue </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_settledValueField</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">value </span><span class="s3">= </span><span class="s1">PromiseInspection</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">value </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s4">this</span><span class="s3">.</span><span class="s1">isFulfilled</span><span class="s3">()) {</span>
        <span class="s4">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s5">&quot;cannot get fulfillment value of a non-fulfilled promise</span><span class="s4">\u000a\u000a    </span><span class="s5">See http://goo.gl/MqrFmX</span><span class="s4">\u000a</span><span class="s5">&quot;</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_settledValue</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">reason </span><span class="s3">= </span><span class="s1">PromiseInspection</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">error </span><span class="s3">=</span>
<span class="s1">PromiseInspection</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">reason </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s4">this</span><span class="s3">.</span><span class="s1">isRejected</span><span class="s3">()) {</span>
        <span class="s4">throw new </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s5">&quot;cannot get rejection reason of a non-rejected promise</span><span class="s4">\u000a\u000a    </span><span class="s5">See http://goo.gl/MqrFmX</span><span class="s4">\u000a</span><span class="s5">&quot;</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_settledValue</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">isFulfilled </span><span class="s3">= </span><span class="s1">PromiseInspection</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isFulfilled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">33554432</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">isRejected </span><span class="s3">= </span><span class="s1">PromiseInspection</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isRejected </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">16777216</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">isPending </span><span class="s3">= </span><span class="s1">PromiseInspection</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isPending </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">50397184</span><span class="s3">) === </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">var </span><span class="s1">isResolved </span><span class="s3">= </span><span class="s1">PromiseInspection</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isResolved </span><span class="s3">= </span><span class="s4">function </span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">50331648</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">PromiseInspection</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isCancelled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">8454144</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">__isCancelled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">65536</span><span class="s3">) === </span><span class="s6">65536</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_isCancelled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">().</span><span class="s1">__isCancelled</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isCancelled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">().</span><span class="s1">_bitField </span><span class="s3">&amp; </span><span class="s6">8454144</span><span class="s3">) !== </span><span class="s6">0</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isPending </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s1">isPending</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">());</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isRejected </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s1">isRejected</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">());</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isFulfilled </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s1">isFulfilled</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">());</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">isResolved </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s1">isResolved</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">());</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">value </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return </span><span class="s1">value</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">());</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">reason </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">target </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">_target</span><span class="s3">();</span>
    <span class="s1">target</span><span class="s3">.</span><span class="s1">_unsetRejectionIsUnhandled</span><span class="s3">();</span>
    <span class="s4">return </span><span class="s1">reason</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">target</span><span class="s3">);</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_value </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_settledValue</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_reason </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">this</span><span class="s3">.</span><span class="s1">_unsetRejectionIsUnhandled</span><span class="s3">();</span>
    <span class="s4">return this</span><span class="s3">.</span><span class="s1">_settledValue</span><span class="s3">();</span>
<span class="s3">};</span>

<span class="s1">Promise</span><span class="s3">.</span><span class="s1">PromiseInspection </span><span class="s3">= </span><span class="s1">PromiseInspection</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s3">},{}],</span><span class="s6">20</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">Promise</span><span class="s3">, </span><span class="s1">INTERNAL</span><span class="s3">) {</span>
<span class="s4">var </span><span class="s1">util </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./util&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">errorObj </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">errorObj</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">isObject </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">isObject</span><span class="s3">;</span>

<span class="s4">function </span><span class="s1">tryConvertToPromise</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">context</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">isObject</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">)) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">obj </span><span class="s4">instanceof </span><span class="s1">Promise</span><span class="s3">) </span><span class="s4">return </span><span class="s1">obj</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">then </span><span class="s3">= </span><span class="s1">getThen</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">then </span><span class="s3">=== </span><span class="s1">errorObj</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">context</span><span class="s3">) </span><span class="s1">context</span><span class="s3">.</span><span class="s1">_pushContext</span><span class="s3">();</span>
            <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s1">Promise</span><span class="s3">.</span><span class="s1">reject</span><span class="s3">(</span><span class="s1">then</span><span class="s3">.</span><span class="s1">e</span><span class="s3">);</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">context</span><span class="s3">) </span><span class="s1">context</span><span class="s3">.</span><span class="s1">_popContext</span><span class="s3">();</span>
            <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">then </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">isAnyBluebirdPromise</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">)) {</span>
                <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">);</span>
                <span class="s1">obj</span><span class="s3">.</span><span class="s1">_then</span><span class="s3">(</span>
                    <span class="s1">ret</span><span class="s3">.</span><span class="s1">_fulfill</span><span class="s3">,</span>
                    <span class="s1">ret</span><span class="s3">.</span><span class="s1">_reject</span><span class="s3">,</span>
                    <span class="s1">undefined</span><span class="s3">,</span>
                    <span class="s1">ret</span><span class="s3">,</span>
                    <span class="s4">null</span>
                <span class="s3">);</span>
                <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
            <span class="s3">}</span>
            <span class="s4">return </span><span class="s1">doThenable</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">then</span><span class="s3">, </span><span class="s1">context</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">obj</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">doGetThen</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s1">obj</span><span class="s3">.</span><span class="s1">then</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">getThen</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
    <span class="s4">try </span><span class="s3">{</span>
        <span class="s4">return </span><span class="s1">doGetThen</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s1">errorObj</span><span class="s3">.</span><span class="s1">e </span><span class="s3">= </span><span class="s1">e</span><span class="s3">;</span>
        <span class="s4">return </span><span class="s1">errorObj</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">hasProp </span><span class="s3">= {}.</span><span class="s1">hasOwnProperty</span><span class="s3">;</span>
<span class="s4">function </span><span class="s1">isAnyBluebirdPromise</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
    <span class="s4">try </span><span class="s3">{</span>
        <span class="s4">return </span><span class="s1">hasProp</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s5">&quot;_promise0&quot;</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s4">return false</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">doThenable</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">then</span><span class="s3">, </span><span class="s1">context</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">INTERNAL</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s1">promise</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">context</span><span class="s3">) </span><span class="s1">context</span><span class="s3">.</span><span class="s1">_pushContext</span><span class="s3">();</span>
    <span class="s1">promise</span><span class="s3">.</span><span class="s1">_captureStackTrace</span><span class="s3">();</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">context</span><span class="s3">) </span><span class="s1">context</span><span class="s3">.</span><span class="s1">_popContext</span><span class="s3">();</span>
    <span class="s4">var </span><span class="s1">synchronous </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">result </span><span class="s3">= </span><span class="s1">util</span><span class="s3">.</span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">then</span><span class="s3">).</span><span class="s1">call</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">resolve</span><span class="s3">, </span><span class="s1">reject</span><span class="s3">);</span>
    <span class="s1">synchronous </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">promise </span><span class="s3">&amp;&amp; </span><span class="s1">result </span><span class="s3">=== </span><span class="s1">errorObj</span><span class="s3">) {</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_rejectCallback</span><span class="s3">(</span><span class="s1">result</span><span class="s3">.</span><span class="s1">e</span><span class="s3">, </span><span class="s4">true</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
        <span class="s1">promise </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">promise</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_resolveCallback</span><span class="s3">(</span><span class="s1">value</span><span class="s3">);</span>
        <span class="s1">promise </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">reject</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">promise</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
        <span class="s1">promise</span><span class="s3">.</span><span class="s1">_rejectCallback</span><span class="s3">(</span><span class="s1">reason</span><span class="s3">, </span><span class="s1">synchronous</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
        <span class="s1">promise </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">return </span><span class="s1">tryConvertToPromise</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s3">},{</span><span class="s5">&quot;./util&quot;</span><span class="s3">:</span><span class="s6">21</span><span class="s3">}],</span><span class="s6">21</span><span class="s3">:[</span><span class="s4">function</span><span class="s3">(</span><span class="s1">_dereq_</span><span class="s3">,</span><span class="s1">module</span><span class="s3">,</span><span class="s1">exports</span><span class="s3">){</span>
<span class="s5">&quot;use strict&quot;</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">es5 </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;./es5&quot;</span><span class="s3">);</span>
<span class="s4">var </span><span class="s1">canEvaluate </span><span class="s3">= </span><span class="s4">typeof </span><span class="s1">navigator </span><span class="s3">== </span><span class="s5">&quot;undefined&quot;</span><span class="s3">;</span>

<span class="s4">var </span><span class="s1">errorObj </span><span class="s3">= {</span><span class="s1">e</span><span class="s3">: {}};</span>
<span class="s4">var </span><span class="s1">tryCatchTarget</span><span class="s3">;</span>
<span class="s4">var </span><span class="s1">globalObject </span><span class="s3">= </span><span class="s4">typeof </span><span class="s1">self </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s3">? </span><span class="s1">self </span><span class="s3">:</span>
    <span class="s4">typeof </span><span class="s1">window </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s3">? </span><span class="s1">window </span><span class="s3">:</span>
    <span class="s4">typeof </span><span class="s1">global </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s3">? </span><span class="s1">global </span><span class="s3">:</span>
    <span class="s4">this </span><span class="s3">!== </span><span class="s1">undefined </span><span class="s3">? </span><span class="s4">this </span><span class="s3">: </span><span class="s4">null</span><span class="s3">;</span>

<span class="s4">function </span><span class="s1">tryCatcher</span><span class="s3">() {</span>
    <span class="s4">try </span><span class="s3">{</span>
        <span class="s4">var </span><span class="s1">target </span><span class="s3">= </span><span class="s1">tryCatchTarget</span><span class="s3">;</span>
        <span class="s1">tryCatchTarget </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
        <span class="s4">return </span><span class="s1">target</span><span class="s3">.</span><span class="s1">apply</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s1">arguments</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s1">errorObj</span><span class="s3">.</span><span class="s1">e </span><span class="s3">= </span><span class="s1">e</span><span class="s3">;</span>
        <span class="s4">return </span><span class="s1">errorObj</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">}</span>
<span class="s4">function </span><span class="s1">tryCatch</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
    <span class="s1">tryCatchTarget </span><span class="s3">= </span><span class="s1">fn</span><span class="s3">;</span>
    <span class="s4">return </span><span class="s1">tryCatcher</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">inherits </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">Child</span><span class="s3">, </span><span class="s1">Parent</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">hasProp </span><span class="s3">= {}.</span><span class="s1">hasOwnProperty</span><span class="s3">;</span>

    <span class="s4">function </span><span class="s1">T</span><span class="s3">() {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">constructor </span><span class="s3">= </span><span class="s1">Child</span><span class="s3">;</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">constructor$ </span><span class="s3">= </span><span class="s1">Parent</span><span class="s3">;</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">propertyName </span><span class="s4">in </span><span class="s1">Parent</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">hasProp</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">Parent</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">, </span><span class="s1">propertyName</span><span class="s3">) &amp;&amp;</span>
                <span class="s1">propertyName</span><span class="s3">.</span><span class="s1">charAt</span><span class="s3">(</span><span class="s1">propertyName</span><span class="s3">.</span><span class="s1">length</span><span class="s3">-</span><span class="s6">1</span><span class="s3">) !== </span><span class="s5">&quot;$&quot;</span>
           <span class="s3">) {</span>
                <span class="s4">this</span><span class="s3">[</span><span class="s1">propertyName </span><span class="s3">+ </span><span class="s5">&quot;$&quot;</span><span class="s3">] = </span><span class="s1">Parent</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">[</span><span class="s1">propertyName</span><span class="s3">];</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
    <span class="s1">T</span><span class="s3">.</span><span class="s1">prototype </span><span class="s3">= </span><span class="s1">Parent</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">;</span>
    <span class="s1">Child</span><span class="s3">.</span><span class="s1">prototype </span><span class="s3">= </span><span class="s4">new </span><span class="s1">T</span><span class="s3">();</span>
    <span class="s4">return </span><span class="s1">Child</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">;</span>
<span class="s3">};</span>


<span class="s4">function </span><span class="s1">isPrimitive</span><span class="s3">(</span><span class="s1">val</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s1">val </span><span class="s3">== </span><span class="s4">null </span><span class="s3">|| </span><span class="s1">val </span><span class="s3">=== </span><span class="s4">true </span><span class="s3">|| </span><span class="s1">val </span><span class="s3">=== </span><span class="s4">false </span><span class="s3">||</span>
        <span class="s4">typeof </span><span class="s1">val </span><span class="s3">=== </span><span class="s5">&quot;string&quot; </span><span class="s3">|| </span><span class="s4">typeof </span><span class="s1">val </span><span class="s3">=== </span><span class="s5">&quot;number&quot;</span><span class="s3">;</span>

<span class="s3">}</span>

<span class="s4">function </span><span class="s1">isObject</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
    <span class="s4">return typeof </span><span class="s1">value </span><span class="s3">=== </span><span class="s5">&quot;function&quot; </span><span class="s3">||</span>
           <span class="s4">typeof </span><span class="s1">value </span><span class="s3">=== </span><span class="s5">&quot;object&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">value </span><span class="s3">!== </span><span class="s4">null</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">maybeWrapAsError</span><span class="s3">(</span><span class="s1">maybeError</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(!</span><span class="s1">isPrimitive</span><span class="s3">(</span><span class="s1">maybeError</span><span class="s3">)) </span><span class="s4">return </span><span class="s1">maybeError</span><span class="s3">;</span>

    <span class="s4">return new </span><span class="s1">Error</span><span class="s3">(</span><span class="s1">safeToString</span><span class="s3">(</span><span class="s1">maybeError</span><span class="s3">));</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">withAppended</span><span class="s3">(</span><span class="s1">target</span><span class="s3">, </span><span class="s1">appendee</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">len </span><span class="s3">= </span><span class="s1">target</span><span class="s3">.</span><span class="s1">length</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Array</span><span class="s3">(</span><span class="s1">len </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">);</span>
    <span class="s4">var </span><span class="s1">i</span><span class="s3">;</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">len</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s1">ret</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">target</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
    <span class="s3">}</span>
    <span class="s1">ret</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">appendee</span><span class="s3">;</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">getDataPropertyOrDefault</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">key</span><span class="s3">, </span><span class="s1">defaultValue</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">es5</span><span class="s3">.</span><span class="s1">isES5</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">desc </span><span class="s3">= </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">getOwnPropertyDescriptor</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">key</span><span class="s3">);</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">desc </span><span class="s3">!= </span><span class="s4">null</span><span class="s3">) {</span>
            <span class="s4">return </span><span class="s1">desc</span><span class="s3">.</span><span class="s1">get </span><span class="s3">== </span><span class="s4">null </span><span class="s3">&amp;&amp; </span><span class="s1">desc</span><span class="s3">.</span><span class="s1">set </span><span class="s3">== </span><span class="s4">null</span>
                    <span class="s3">? </span><span class="s1">desc</span><span class="s3">.</span><span class="s1">value</span>
                    <span class="s3">: </span><span class="s1">defaultValue</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">return </span><span class="s3">{}.</span><span class="s1">hasOwnProperty</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">key</span><span class="s3">) ? </span><span class="s1">obj</span><span class="s3">[</span><span class="s1">key</span><span class="s3">] : </span><span class="s1">undefined</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">name</span><span class="s3">, </span><span class="s1">value</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">isPrimitive</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">)) </span><span class="s4">return </span><span class="s1">obj</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">descriptor </span><span class="s3">= {</span>
        <span class="s1">value</span><span class="s3">: </span><span class="s1">value</span><span class="s3">,</span>
        <span class="s1">configurable</span><span class="s3">: </span><span class="s4">true</span><span class="s3">,</span>
        <span class="s1">enumerable</span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">writable</span><span class="s3">: </span><span class="s4">true</span>
    <span class="s3">};</span>
    <span class="s1">es5</span><span class="s3">.</span><span class="s1">defineProperty</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">name</span><span class="s3">, </span><span class="s1">descriptor</span><span class="s3">);</span>
    <span class="s4">return </span><span class="s1">obj</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">thrower</span><span class="s3">(</span><span class="s1">r</span><span class="s3">) {</span>
    <span class="s4">throw </span><span class="s1">r</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">inheritedDataKeys </span><span class="s3">= (</span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">excludedPrototypes </span><span class="s3">= [</span>
        <span class="s1">Array</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">,</span>
        <span class="s1">Object</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">,</span>
        <span class="s1">Function</span><span class="s3">.</span><span class="s1">prototype</span>
    <span class="s3">];</span>

    <span class="s4">var </span><span class="s1">isExcludedProto </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">val</span><span class="s3">) {</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">excludedPrototypes</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">excludedPrototypes</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] === </span><span class="s1">val</span><span class="s3">) {</span>
                <span class="s4">return true</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">return false</span><span class="s3">;</span>
    <span class="s3">};</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">es5</span><span class="s3">.</span><span class="s1">isES5</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">getKeys </span><span class="s3">= </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">getOwnPropertyNames</span><span class="s3">;</span>
        <span class="s4">return function</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">ret </span><span class="s3">= [];</span>
            <span class="s4">var </span><span class="s1">visitedKeys </span><span class="s3">= </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">create</span><span class="s3">(</span><span class="s4">null</span><span class="s3">);</span>
            <span class="s4">while </span><span class="s3">(</span><span class="s1">obj </span><span class="s3">!= </span><span class="s4">null </span><span class="s3">&amp;&amp; !</span><span class="s1">isExcludedProto</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">)) {</span>
                <span class="s4">var </span><span class="s1">keys</span><span class="s3">;</span>
                <span class="s4">try </span><span class="s3">{</span>
                    <span class="s1">keys </span><span class="s3">= </span><span class="s1">getKeys</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">);</span>
                <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
                    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
                <span class="s3">}</span>
                <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">keys</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
                    <span class="s4">var </span><span class="s1">key </span><span class="s3">= </span><span class="s1">keys</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">visitedKeys</span><span class="s3">[</span><span class="s1">key</span><span class="s3">]) </span><span class="s4">continue</span><span class="s3">;</span>
                    <span class="s1">visitedKeys</span><span class="s3">[</span><span class="s1">key</span><span class="s3">] = </span><span class="s4">true</span><span class="s3">;</span>
                    <span class="s4">var </span><span class="s1">desc </span><span class="s3">= </span><span class="s1">Object</span><span class="s3">.</span><span class="s1">getOwnPropertyDescriptor</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">key</span><span class="s3">);</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">desc </span><span class="s3">!= </span><span class="s4">null </span><span class="s3">&amp;&amp; </span><span class="s1">desc</span><span class="s3">.</span><span class="s1">get </span><span class="s3">== </span><span class="s4">null </span><span class="s3">&amp;&amp; </span><span class="s1">desc</span><span class="s3">.</span><span class="s1">set </span><span class="s3">== </span><span class="s4">null</span><span class="s3">) {</span>
                        <span class="s1">ret</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">key</span><span class="s3">);</span>
                    <span class="s3">}</span>
                <span class="s3">}</span>
                <span class="s1">obj </span><span class="s3">= </span><span class="s1">es5</span><span class="s3">.</span><span class="s1">getPrototypeOf</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">);</span>
            <span class="s3">}</span>
            <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
        <span class="s3">};</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">var </span><span class="s1">hasProp </span><span class="s3">= {}.</span><span class="s1">hasOwnProperty</span><span class="s3">;</span>
        <span class="s4">return function</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">isExcludedProto</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">)) </span><span class="s4">return </span><span class="s3">[];</span>
            <span class="s4">var </span><span class="s1">ret </span><span class="s3">= [];</span>

            <span class="s0">/*jshint forin:false */</span>
            <span class="s1">enumeration</span><span class="s3">: </span><span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">key </span><span class="s4">in </span><span class="s1">obj</span><span class="s3">) {</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">hasProp</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">key</span><span class="s3">)) {</span>
                    <span class="s1">ret</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">key</span><span class="s3">);</span>
                <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">excludedPrototypes</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
                        <span class="s4">if </span><span class="s3">(</span><span class="s1">hasProp</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">excludedPrototypes</span><span class="s3">[</span><span class="s1">i</span><span class="s3">], </span><span class="s1">key</span><span class="s3">)) {</span>
                            <span class="s4">continue </span><span class="s1">enumeration</span><span class="s3">;</span>
                        <span class="s3">}</span>
                    <span class="s3">}</span>
                    <span class="s1">ret</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">key</span><span class="s3">);</span>
                <span class="s3">}</span>
            <span class="s3">}</span>
            <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
        <span class="s3">};</span>
    <span class="s3">}</span>

<span class="s3">})();</span>

<span class="s4">var </span><span class="s1">thisAssignmentPattern </span><span class="s3">= </span><span class="s7">/this\s*\.\s*\S+\s*=/</span><span class="s3">;</span>
<span class="s4">function </span><span class="s1">isClass</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
    <span class="s4">try </span><span class="s3">{</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">fn </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">keys </span><span class="s3">= </span><span class="s1">es5</span><span class="s3">.</span><span class="s1">names</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">);</span>

            <span class="s4">var </span><span class="s1">hasMethods </span><span class="s3">= </span><span class="s1">es5</span><span class="s3">.</span><span class="s1">isES5 </span><span class="s3">&amp;&amp; </span><span class="s1">keys</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s6">1</span><span class="s3">;</span>
            <span class="s4">var </span><span class="s1">hasMethodsOtherThanConstructor </span><span class="s3">= </span><span class="s1">keys</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s6">0 </span><span class="s3">&amp;&amp;</span>
                <span class="s3">!(</span><span class="s1">keys</span><span class="s3">.</span><span class="s1">length </span><span class="s3">=== </span><span class="s6">1 </span><span class="s3">&amp;&amp; </span><span class="s1">keys</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] === </span><span class="s5">&quot;constructor&quot;</span><span class="s3">);</span>
            <span class="s4">var </span><span class="s1">hasThisAssignmentAndStaticMethods </span><span class="s3">=</span>
                <span class="s1">thisAssignmentPattern</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">fn </span><span class="s3">+ </span><span class="s5">&quot;&quot;</span><span class="s3">) &amp;&amp; </span><span class="s1">es5</span><span class="s3">.</span><span class="s1">names</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">).</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s6">0</span><span class="s3">;</span>

            <span class="s4">if </span><span class="s3">(</span><span class="s1">hasMethods </span><span class="s3">|| </span><span class="s1">hasMethodsOtherThanConstructor </span><span class="s3">||</span>
                <span class="s1">hasThisAssignmentAndStaticMethods</span><span class="s3">) {</span>
                <span class="s4">return true</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">return false</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s4">return false</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">toFastProperties</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
    <span class="s0">/*jshint -W027,-W055,-W031*/</span>
    <span class="s4">function </span><span class="s1">FakeConstructor</span><span class="s3">() {}</span>
    <span class="s1">FakeConstructor</span><span class="s3">.</span><span class="s1">prototype </span><span class="s3">= </span><span class="s1">obj</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">receiver </span><span class="s3">= </span><span class="s4">new </span><span class="s1">FakeConstructor</span><span class="s3">();</span>
    <span class="s4">function </span><span class="s1">ic</span><span class="s3">() {</span>
        <span class="s4">return typeof </span><span class="s1">receiver</span><span class="s3">.</span><span class="s1">foo</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s1">ic</span><span class="s3">();</span>
    <span class="s1">ic</span><span class="s3">();</span>
    <span class="s4">return </span><span class="s1">obj</span><span class="s3">;</span>
    <span class="s1">eval</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">rident </span><span class="s3">= </span><span class="s7">/^[a-z$_][a-z$_0-9]*$/i</span><span class="s3">;</span>
<span class="s4">function </span><span class="s1">isIdentifier</span><span class="s3">(</span><span class="s1">str</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s1">rident</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">str</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">filledRange</span><span class="s3">(</span><span class="s1">count</span><span class="s3">, </span><span class="s1">prefix</span><span class="s3">, </span><span class="s1">suffix</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Array</span><span class="s3">(</span><span class="s1">count</span><span class="s3">);</span>
    <span class="s4">for</span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">count</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s1">ret</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s1">prefix </span><span class="s3">+ </span><span class="s1">i </span><span class="s3">+ </span><span class="s1">suffix</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">safeToString</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
    <span class="s4">try </span><span class="s3">{</span>
        <span class="s4">return </span><span class="s1">obj </span><span class="s3">+ </span><span class="s5">&quot;&quot;</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s5">&quot;[no string representation]&quot;</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">isError</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s1">obj </span><span class="s4">instanceof </span><span class="s1">Error </span><span class="s3">||</span>
        <span class="s3">(</span><span class="s1">obj </span><span class="s3">!== </span><span class="s4">null </span><span class="s3">&amp;&amp;</span>
           <span class="s4">typeof </span><span class="s1">obj </span><span class="s3">=== </span><span class="s5">&quot;object&quot; </span><span class="s3">&amp;&amp;</span>
           <span class="s4">typeof </span><span class="s1">obj</span><span class="s3">.</span><span class="s1">message </span><span class="s3">=== </span><span class="s5">&quot;string&quot; </span><span class="s3">&amp;&amp;</span>
           <span class="s4">typeof </span><span class="s1">obj</span><span class="s3">.</span><span class="s1">name </span><span class="s3">=== </span><span class="s5">&quot;string&quot;</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">markAsOriginatingFromRejection</span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
    <span class="s4">try </span><span class="s3">{</span>
        <span class="s1">notEnumerableProp</span><span class="s3">(</span><span class="s1">e</span><span class="s3">, </span><span class="s5">&quot;isOperational&quot;</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">catch</span><span class="s3">(</span><span class="s1">ignore</span><span class="s3">) {}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">originatesFromRejection</span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">e </span><span class="s3">== </span><span class="s4">null</span><span class="s3">) </span><span class="s4">return false</span><span class="s3">;</span>
    <span class="s4">return </span><span class="s3">((</span><span class="s1">e </span><span class="s4">instanceof </span><span class="s1">Error</span><span class="s3">[</span><span class="s5">&quot;__BluebirdErrorTypes__&quot;</span><span class="s3">].</span><span class="s1">OperationalError</span><span class="s3">) ||</span>
        <span class="s1">e</span><span class="s3">[</span><span class="s5">&quot;isOperational&quot;</span><span class="s3">] === </span><span class="s4">true</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">canAttachTrace</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s1">isError</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) &amp;&amp; </span><span class="s1">es5</span><span class="s3">.</span><span class="s1">propertyIsWritable</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s5">&quot;stack&quot;</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">ensureErrorObject </span><span class="s3">= (</span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(!(</span><span class="s5">&quot;stack&quot; </span><span class="s4">in new </span><span class="s1">Error</span><span class="s3">())) {</span>
        <span class="s4">return function</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">canAttachTrace</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)) </span><span class="s4">return </span><span class="s1">value</span><span class="s3">;</span>
            <span class="s4">try </span><span class="s3">{</span><span class="s4">throw new </span><span class="s1">Error</span><span class="s3">(</span><span class="s1">safeToString</span><span class="s3">(</span><span class="s1">value</span><span class="s3">));}</span>
            <span class="s4">catch</span><span class="s3">(</span><span class="s1">err</span><span class="s3">) {</span><span class="s4">return </span><span class="s1">err</span><span class="s3">;}</span>
        <span class="s3">};</span>
    <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
        <span class="s4">return function</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">canAttachTrace</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)) </span><span class="s4">return </span><span class="s1">value</span><span class="s3">;</span>
            <span class="s4">return new </span><span class="s1">Error</span><span class="s3">(</span><span class="s1">safeToString</span><span class="s3">(</span><span class="s1">value</span><span class="s3">));</span>
        <span class="s3">};</span>
    <span class="s3">}</span>
<span class="s3">})();</span>

<span class="s4">function </span><span class="s1">classString</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s3">{}.</span><span class="s1">toString</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">);</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">copyDescriptors</span><span class="s3">(</span><span class="s1">from</span><span class="s3">, </span><span class="s1">to</span><span class="s3">, </span><span class="s1">filter</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">keys </span><span class="s3">= </span><span class="s1">es5</span><span class="s3">.</span><span class="s1">names</span><span class="s3">(</span><span class="s1">from</span><span class="s3">);</span>
    <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s6">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">keys</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">key </span><span class="s3">= </span><span class="s1">keys</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)) {</span>
            <span class="s4">try </span><span class="s3">{</span>
                <span class="s1">es5</span><span class="s3">.</span><span class="s1">defineProperty</span><span class="s3">(</span><span class="s1">to</span><span class="s3">, </span><span class="s1">key</span><span class="s3">, </span><span class="s1">es5</span><span class="s3">.</span><span class="s1">getDescriptor</span><span class="s3">(</span><span class="s1">from</span><span class="s3">, </span><span class="s1">key</span><span class="s3">));</span>
            <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">ignore</span><span class="s3">) {}</span>
        <span class="s3">}</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">asArray </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">v</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">es5</span><span class="s3">.</span><span class="s1">isArray</span><span class="s3">(</span><span class="s1">v</span><span class="s3">)) {</span>
        <span class="s4">return </span><span class="s1">v</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">return null</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">Symbol </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">Symbol</span><span class="s3">.</span><span class="s1">iterator</span><span class="s3">) {</span>
    <span class="s4">var </span><span class="s1">ArrayFrom </span><span class="s3">= </span><span class="s4">typeof </span><span class="s1">Array</span><span class="s3">.</span><span class="s1">from </span><span class="s3">=== </span><span class="s5">&quot;function&quot; </span><span class="s3">? </span><span class="s4">function</span><span class="s3">(</span><span class="s1">v</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">Array</span><span class="s3">.</span><span class="s1">from</span><span class="s3">(</span><span class="s1">v</span><span class="s3">);</span>
    <span class="s3">} : </span><span class="s4">function</span><span class="s3">(</span><span class="s1">v</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">ret </span><span class="s3">= [];</span>
        <span class="s4">var </span><span class="s1">it </span><span class="s3">= </span><span class="s1">v</span><span class="s3">[</span><span class="s1">Symbol</span><span class="s3">.</span><span class="s1">iterator</span><span class="s3">]();</span>
        <span class="s4">var </span><span class="s1">itResult</span><span class="s3">;</span>
        <span class="s4">while </span><span class="s3">(!((</span><span class="s1">itResult </span><span class="s3">= </span><span class="s1">it</span><span class="s3">.</span><span class="s1">next</span><span class="s3">()).</span><span class="s1">done</span><span class="s3">)) {</span>
            <span class="s1">ret</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">itResult</span><span class="s3">.</span><span class="s1">value</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
    <span class="s3">};</span>

    <span class="s1">asArray </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">v</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">es5</span><span class="s3">.</span><span class="s1">isArray</span><span class="s3">(</span><span class="s1">v</span><span class="s3">)) {</span>
            <span class="s4">return </span><span class="s1">v</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">v </span><span class="s3">!= </span><span class="s4">null </span><span class="s3">&amp;&amp; </span><span class="s4">typeof </span><span class="s1">v</span><span class="s3">[</span><span class="s1">Symbol</span><span class="s3">.</span><span class="s1">iterator</span><span class="s3">] === </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s4">return </span><span class="s1">ArrayFrom</span><span class="s3">(</span><span class="s1">v</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">return null</span><span class="s3">;</span>
    <span class="s3">};</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">isNode </span><span class="s3">= </span><span class="s4">typeof </span><span class="s1">process </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s3">&amp;&amp;</span>
        <span class="s1">classString</span><span class="s3">(</span><span class="s1">process</span><span class="s3">).</span><span class="s1">toLowerCase</span><span class="s3">() === </span><span class="s5">&quot;[object process]&quot;</span><span class="s3">;</span>

<span class="s4">var </span><span class="s1">hasEnvVariables </span><span class="s3">= </span><span class="s4">typeof </span><span class="s1">process </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s3">&amp;&amp;</span>
    <span class="s4">typeof </span><span class="s1">process</span><span class="s3">.</span><span class="s1">env </span><span class="s3">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s3">;</span>

<span class="s4">function </span><span class="s1">env</span><span class="s3">(</span><span class="s1">key</span><span class="s3">) {</span>
    <span class="s4">return </span><span class="s1">hasEnvVariables </span><span class="s3">? </span><span class="s1">process</span><span class="s3">.</span><span class="s1">env</span><span class="s3">[</span><span class="s1">key</span><span class="s3">] : </span><span class="s1">undefined</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">getNativePromise</span><span class="s3">() {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">Promise </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">) {</span>
        <span class="s4">try </span><span class="s3">{</span>
            <span class="s4">var </span><span class="s1">promise </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(){});</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">classString</span><span class="s3">(</span><span class="s1">promise</span><span class="s3">) === </span><span class="s5">&quot;[object Promise]&quot;</span><span class="s3">) {</span>
                <span class="s4">return </span><span class="s1">Promise</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {}</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">reflectHandler</span><span class="s3">;</span>
<span class="s4">function </span><span class="s1">contextBind</span><span class="s3">(</span><span class="s1">ctx</span><span class="s3">, </span><span class="s1">cb</span><span class="s3">) {</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">ctx </span><span class="s3">=== </span><span class="s4">null </span><span class="s3">||</span>
        <span class="s4">typeof </span><span class="s1">cb </span><span class="s3">!== </span><span class="s5">&quot;function&quot; </span><span class="s3">||</span>
        <span class="s1">cb </span><span class="s3">=== </span><span class="s1">reflectHandler</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">cb</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">domain </span><span class="s3">!== </span><span class="s4">null</span><span class="s3">) {</span>
        <span class="s1">cb </span><span class="s3">= </span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">domain</span><span class="s3">.</span><span class="s1">bind</span><span class="s3">(</span><span class="s1">cb</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s4">var </span><span class="s1">async </span><span class="s3">= </span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">async</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">async </span><span class="s3">!== </span><span class="s4">null</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">old </span><span class="s3">= </span><span class="s1">cb</span><span class="s3">;</span>
        <span class="s1">cb </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s4">var </span><span class="s1">args </span><span class="s3">= (</span><span class="s4">new </span><span class="s1">Array</span><span class="s3">(</span><span class="s6">2</span><span class="s3">)).</span><span class="s1">concat</span><span class="s3">([].</span><span class="s1">slice</span><span class="s3">.</span><span class="s1">call</span><span class="s3">(</span><span class="s1">arguments</span><span class="s3">));;</span>
            <span class="s1">args</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] = </span><span class="s1">old</span><span class="s3">;</span>
            <span class="s1">args</span><span class="s3">[</span><span class="s6">1</span><span class="s3">] = </span><span class="s4">this</span><span class="s3">;</span>
            <span class="s4">return </span><span class="s1">async</span><span class="s3">.</span><span class="s1">runInAsyncScope</span><span class="s3">.</span><span class="s1">apply</span><span class="s3">(</span><span class="s1">async</span><span class="s3">, </span><span class="s1">args</span><span class="s3">);</span>
        <span class="s3">};</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">cb</span><span class="s3">;</span>
<span class="s3">}</span>

<span class="s4">var </span><span class="s1">ret </span><span class="s3">= {</span>
    <span class="s1">setReflectHandler</span><span class="s3">: </span><span class="s4">function</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">) {</span>
        <span class="s1">reflectHandler </span><span class="s3">= </span><span class="s1">fn</span><span class="s3">;</span>
    <span class="s3">},</span>
    <span class="s1">isClass</span><span class="s3">: </span><span class="s1">isClass</span><span class="s3">,</span>
    <span class="s1">isIdentifier</span><span class="s3">: </span><span class="s1">isIdentifier</span><span class="s3">,</span>
    <span class="s1">inheritedDataKeys</span><span class="s3">: </span><span class="s1">inheritedDataKeys</span><span class="s3">,</span>
    <span class="s1">getDataPropertyOrDefault</span><span class="s3">: </span><span class="s1">getDataPropertyOrDefault</span><span class="s3">,</span>
    <span class="s1">thrower</span><span class="s3">: </span><span class="s1">thrower</span><span class="s3">,</span>
    <span class="s1">isArray</span><span class="s3">: </span><span class="s1">es5</span><span class="s3">.</span><span class="s1">isArray</span><span class="s3">,</span>
    <span class="s1">asArray</span><span class="s3">: </span><span class="s1">asArray</span><span class="s3">,</span>
    <span class="s1">notEnumerableProp</span><span class="s3">: </span><span class="s1">notEnumerableProp</span><span class="s3">,</span>
    <span class="s1">isPrimitive</span><span class="s3">: </span><span class="s1">isPrimitive</span><span class="s3">,</span>
    <span class="s1">isObject</span><span class="s3">: </span><span class="s1">isObject</span><span class="s3">,</span>
    <span class="s1">isError</span><span class="s3">: </span><span class="s1">isError</span><span class="s3">,</span>
    <span class="s1">canEvaluate</span><span class="s3">: </span><span class="s1">canEvaluate</span><span class="s3">,</span>
    <span class="s1">errorObj</span><span class="s3">: </span><span class="s1">errorObj</span><span class="s3">,</span>
    <span class="s1">tryCatch</span><span class="s3">: </span><span class="s1">tryCatch</span><span class="s3">,</span>
    <span class="s1">inherits</span><span class="s3">: </span><span class="s1">inherits</span><span class="s3">,</span>
    <span class="s1">withAppended</span><span class="s3">: </span><span class="s1">withAppended</span><span class="s3">,</span>
    <span class="s1">maybeWrapAsError</span><span class="s3">: </span><span class="s1">maybeWrapAsError</span><span class="s3">,</span>
    <span class="s1">toFastProperties</span><span class="s3">: </span><span class="s1">toFastProperties</span><span class="s3">,</span>
    <span class="s1">filledRange</span><span class="s3">: </span><span class="s1">filledRange</span><span class="s3">,</span>
    <span class="s1">toString</span><span class="s3">: </span><span class="s1">safeToString</span><span class="s3">,</span>
    <span class="s1">canAttachTrace</span><span class="s3">: </span><span class="s1">canAttachTrace</span><span class="s3">,</span>
    <span class="s1">ensureErrorObject</span><span class="s3">: </span><span class="s1">ensureErrorObject</span><span class="s3">,</span>
    <span class="s1">originatesFromRejection</span><span class="s3">: </span><span class="s1">originatesFromRejection</span><span class="s3">,</span>
    <span class="s1">markAsOriginatingFromRejection</span><span class="s3">: </span><span class="s1">markAsOriginatingFromRejection</span><span class="s3">,</span>
    <span class="s1">classString</span><span class="s3">: </span><span class="s1">classString</span><span class="s3">,</span>
    <span class="s1">copyDescriptors</span><span class="s3">: </span><span class="s1">copyDescriptors</span><span class="s3">,</span>
    <span class="s1">isNode</span><span class="s3">: </span><span class="s1">isNode</span><span class="s3">,</span>
    <span class="s1">hasEnvVariables</span><span class="s3">: </span><span class="s1">hasEnvVariables</span><span class="s3">,</span>
    <span class="s1">env</span><span class="s3">: </span><span class="s1">env</span><span class="s3">,</span>
    <span class="s1">global</span><span class="s3">: </span><span class="s1">globalObject</span><span class="s3">,</span>
    <span class="s1">getNativePromise</span><span class="s3">: </span><span class="s1">getNativePromise</span><span class="s3">,</span>
    <span class="s1">contextBind</span><span class="s3">: </span><span class="s1">contextBind</span>
<span class="s3">};</span>
<span class="s1">ret</span><span class="s3">.</span><span class="s1">isRecentNode </span><span class="s3">= </span><span class="s1">ret</span><span class="s3">.</span><span class="s1">isNode </span><span class="s3">&amp;&amp; (</span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">version</span><span class="s3">;</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">process</span><span class="s3">.</span><span class="s1">versions </span><span class="s3">&amp;&amp; </span><span class="s1">process</span><span class="s3">.</span><span class="s1">versions</span><span class="s3">.</span><span class="s1">node</span><span class="s3">) {</span>
        <span class="s1">version </span><span class="s3">= </span><span class="s1">process</span><span class="s3">.</span><span class="s1">versions</span><span class="s3">.</span><span class="s1">node</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;.&quot;</span><span class="s3">).</span><span class="s1">map</span><span class="s3">(</span><span class="s1">Number</span><span class="s3">);</span>
    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">process</span><span class="s3">.</span><span class="s1">version</span><span class="s3">) {</span>
        <span class="s1">version </span><span class="s3">= </span><span class="s1">process</span><span class="s3">.</span><span class="s1">version</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;.&quot;</span><span class="s3">).</span><span class="s1">map</span><span class="s3">(</span><span class="s1">Number</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s3">(</span><span class="s1">version</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] === </span><span class="s6">0 </span><span class="s3">&amp;&amp; </span><span class="s1">version</span><span class="s3">[</span><span class="s6">1</span><span class="s3">] &gt; </span><span class="s6">10</span><span class="s3">) || (</span><span class="s1">version</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] &gt; </span><span class="s6">0</span><span class="s3">);</span>
<span class="s3">})();</span>
<span class="s1">ret</span><span class="s3">.</span><span class="s1">nodeSupportsAsyncResource </span><span class="s3">= </span><span class="s1">ret</span><span class="s3">.</span><span class="s1">isNode </span><span class="s3">&amp;&amp; (</span><span class="s4">function</span><span class="s3">() {</span>
    <span class="s4">var </span><span class="s1">supportsAsync </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">try </span><span class="s3">{</span>
        <span class="s4">var </span><span class="s1">res </span><span class="s3">= </span><span class="s1">_dereq_</span><span class="s3">(</span><span class="s5">&quot;async_hooks&quot;</span><span class="s3">).</span><span class="s1">AsyncResource</span><span class="s3">;</span>
        <span class="s1">supportsAsync </span><span class="s3">= </span><span class="s4">typeof </span><span class="s1">res</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">runInAsyncScope </span><span class="s3">=== </span><span class="s5">&quot;function&quot;</span><span class="s3">;</span>
    <span class="s3">} </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span>
        <span class="s1">supportsAsync </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s3">}</span>
    <span class="s4">return </span><span class="s1">supportsAsync</span><span class="s3">;</span>
<span class="s3">})();</span>

<span class="s4">if </span><span class="s3">(</span><span class="s1">ret</span><span class="s3">.</span><span class="s1">isNode</span><span class="s3">) </span><span class="s1">ret</span><span class="s3">.</span><span class="s1">toFastProperties</span><span class="s3">(</span><span class="s1">process</span><span class="s3">);</span>

<span class="s4">try </span><span class="s3">{</span><span class="s4">throw new </span><span class="s1">Error</span><span class="s3">(); } </span><span class="s4">catch </span><span class="s3">(</span><span class="s1">e</span><span class="s3">) {</span><span class="s1">ret</span><span class="s3">.</span><span class="s1">lastLineError </span><span class="s3">= </span><span class="s1">e</span><span class="s3">;}</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= </span><span class="s1">ret</span><span class="s3">;</span>

<span class="s3">},{</span><span class="s5">&quot;./es5&quot;</span><span class="s3">:</span><span class="s6">10</span><span class="s3">,</span><span class="s5">&quot;async_hooks&quot;</span><span class="s3">:</span><span class="s1">undefined</span><span class="s3">}]},{},[</span><span class="s6">3</span><span class="s3">])(</span><span class="s6">3</span><span class="s3">)</span>
<span class="s3">});                    ;</span><span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">window </span><span class="s3">!== </span><span class="s5">'undefined' </span><span class="s3">&amp;&amp; </span><span class="s1">window </span><span class="s3">!== </span><span class="s4">null</span><span class="s3">) {                               </span><span class="s1">window</span><span class="s3">.</span><span class="s1">P </span><span class="s3">= </span><span class="s1">window</span><span class="s3">.</span><span class="s1">Promise</span><span class="s3">;                                                     } </span><span class="s4">else if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">self </span><span class="s3">!== </span><span class="s5">'undefined' </span><span class="s3">&amp;&amp; </span><span class="s1">self </span><span class="s3">!== </span><span class="s4">null</span><span class="s3">) {                             </span><span class="s1">self</span><span class="s3">.</span><span class="s1">P </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">Promise</span><span class="s3">;                                                         }</span></pre>
</body>
</html>