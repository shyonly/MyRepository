<html>
<head>
<title>tokenize.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6aab73;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #2aacb8;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #67a37c; font-style: italic;}
.s7 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
tokenize.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>

<span class="s2">exports</span><span class="s1">.</span><span class="s2">__esModule </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
<span class="s2">exports</span><span class="s1">.</span><span class="s2">FIELDS </span><span class="s1">= </span><span class="s3">void </span><span class="s4">0</span><span class="s1">;</span>
<span class="s2">exports</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">] = </span><span class="s2">tokenize</span><span class="s1">;</span>
<span class="s3">var </span><span class="s2">t </span><span class="s1">= </span><span class="s2">_interopRequireWildcard</span><span class="s1">(</span><span class="s2">require</span><span class="s1">(</span><span class="s0">&quot;./tokenTypes&quot;</span><span class="s1">));</span>
<span class="s3">var </span><span class="s2">_unescapable</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">;</span>
<span class="s3">function </span><span class="s2">_getRequireWildcardCache</span><span class="s1">(</span><span class="s2">nodeInterop</span><span class="s1">) { </span><span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">WeakMap </span><span class="s1">!== </span><span class="s0">&quot;function&quot;</span><span class="s1">) </span><span class="s3">return null</span><span class="s1">; </span><span class="s3">var </span><span class="s2">cacheBabelInterop </span><span class="s1">= </span><span class="s3">new </span><span class="s2">WeakMap</span><span class="s1">(); </span><span class="s3">var </span><span class="s2">cacheNodeInterop </span><span class="s1">= </span><span class="s3">new </span><span class="s2">WeakMap</span><span class="s1">(); </span><span class="s3">return </span><span class="s1">(</span><span class="s2">_getRequireWildcardCache </span><span class="s1">= </span><span class="s3">function </span><span class="s2">_getRequireWildcardCache</span><span class="s1">(</span><span class="s2">nodeInterop</span><span class="s1">) { </span><span class="s3">return </span><span class="s2">nodeInterop </span><span class="s1">? </span><span class="s2">cacheNodeInterop </span><span class="s1">: </span><span class="s2">cacheBabelInterop</span><span class="s1">; })(</span><span class="s2">nodeInterop</span><span class="s1">); }</span>
<span class="s3">function </span><span class="s2">_interopRequireWildcard</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">nodeInterop</span><span class="s1">) { </span><span class="s3">if </span><span class="s1">(!</span><span class="s2">nodeInterop </span><span class="s1">&amp;&amp; </span><span class="s2">obj </span><span class="s1">&amp;&amp; </span><span class="s2">obj</span><span class="s1">.</span><span class="s2">__esModule</span><span class="s1">) { </span><span class="s3">return </span><span class="s2">obj</span><span class="s1">; } </span><span class="s3">if </span><span class="s1">(</span><span class="s2">obj </span><span class="s1">=== </span><span class="s3">null </span><span class="s1">|| </span><span class="s3">typeof </span><span class="s2">obj </span><span class="s1">!== </span><span class="s0">&quot;object&quot; </span><span class="s1">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">obj </span><span class="s1">!== </span><span class="s0">&quot;function&quot;</span><span class="s1">) { </span><span class="s3">return </span><span class="s1">{ </span><span class="s0">&quot;default&quot;</span><span class="s1">: </span><span class="s2">obj </span><span class="s1">}; } </span><span class="s3">var </span><span class="s2">cache </span><span class="s1">= </span><span class="s2">_getRequireWildcardCache</span><span class="s1">(</span><span class="s2">nodeInterop</span><span class="s1">); </span><span class="s3">if </span><span class="s1">(</span><span class="s2">cache </span><span class="s1">&amp;&amp; </span><span class="s2">cache</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">)) { </span><span class="s3">return </span><span class="s2">cache</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">); } </span><span class="s3">var </span><span class="s2">newObj </span><span class="s1">= {}; </span><span class="s3">var </span><span class="s2">hasPropertyDescriptor </span><span class="s1">= </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty </span><span class="s1">&amp;&amp; </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">getOwnPropertyDescriptor</span><span class="s1">; </span><span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s2">key </span><span class="s3">in </span><span class="s2">obj</span><span class="s1">) { </span><span class="s3">if </span><span class="s1">(</span><span class="s2">key </span><span class="s1">!== </span><span class="s0">&quot;default&quot; </span><span class="s1">&amp;&amp; </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">hasOwnProperty</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">key</span><span class="s1">)) { </span><span class="s3">var </span><span class="s2">desc </span><span class="s1">= </span><span class="s2">hasPropertyDescriptor </span><span class="s1">? </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">getOwnPropertyDescriptor</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">key</span><span class="s1">) : </span><span class="s3">null</span><span class="s1">; </span><span class="s3">if </span><span class="s1">(</span><span class="s2">desc </span><span class="s1">&amp;&amp; (</span><span class="s2">desc</span><span class="s1">.</span><span class="s2">get </span><span class="s1">|| </span><span class="s2">desc</span><span class="s1">.</span><span class="s2">set</span><span class="s1">)) { </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">newObj</span><span class="s1">, </span><span class="s2">key</span><span class="s1">, </span><span class="s2">desc</span><span class="s1">); } </span><span class="s3">else </span><span class="s1">{ </span><span class="s2">newObj</span><span class="s1">[</span><span class="s2">key</span><span class="s1">] = </span><span class="s2">obj</span><span class="s1">[</span><span class="s2">key</span><span class="s1">]; } } } </span><span class="s2">newObj</span><span class="s1">[</span><span class="s0">&quot;default&quot;</span><span class="s1">] = </span><span class="s2">obj</span><span class="s1">; </span><span class="s3">if </span><span class="s1">(</span><span class="s2">cache</span><span class="s1">) { </span><span class="s2">cache</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">newObj</span><span class="s1">); } </span><span class="s3">return </span><span class="s2">newObj</span><span class="s1">; }</span>
<span class="s3">var </span><span class="s2">unescapable </span><span class="s1">= (</span><span class="s2">_unescapable </span><span class="s1">= {}, </span><span class="s2">_unescapable</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">tab</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_unescapable</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">newline</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_unescapable</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">cr</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_unescapable</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">feed</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_unescapable</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">wordDelimiters </span><span class="s1">= (</span><span class="s2">_wordDelimiters </span><span class="s1">= {}, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">space</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">tab</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">newline</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">cr</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">feed</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">ampersand</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">asterisk</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">bang</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">comma</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">colon</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">semicolon</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">openParenthesis</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">closeParenthesis</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">openSquare</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">closeSquare</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">singleQuote</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">doubleQuote</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">plus</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">pipe</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">tilde</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">greaterThan</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">equals</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">dollar</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">caret</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">slash</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">, </span><span class="s2">_wordDelimiters</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">hex </span><span class="s1">= {};</span>
<span class="s3">var </span><span class="s2">hexChars </span><span class="s1">= </span><span class="s0">&quot;0123456789abcdefABCDEF&quot;</span><span class="s1">;</span>
<span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s2">i </span><span class="s1">= </span><span class="s4">0</span><span class="s1">; </span><span class="s2">i </span><span class="s1">&lt; </span><span class="s2">hexChars</span><span class="s1">.</span><span class="s2">length</span><span class="s1">; </span><span class="s2">i</span><span class="s1">++) {</span>
  <span class="s2">hex</span><span class="s1">[</span><span class="s2">hexChars</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)] = </span><span class="s3">true</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s5">/**</span>
 <span class="s5">*  Returns the last index of the bar css word</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} css The string in which the word begins</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{number} start The index into the string where word's first letter occurs</span>
 <span class="s5">*/</span>
<span class="s3">function </span><span class="s2">consumeWord</span><span class="s1">(</span><span class="s2">css</span><span class="s1">, </span><span class="s2">start</span><span class="s1">) {</span>
  <span class="s3">var </span><span class="s2">next </span><span class="s1">= </span><span class="s2">start</span><span class="s1">;</span>
  <span class="s3">var </span><span class="s2">code</span><span class="s1">;</span>
  <span class="s3">do </span><span class="s1">{</span>
    <span class="s2">code </span><span class="s1">= </span><span class="s2">css</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">next</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">wordDelimiters</span><span class="s1">[</span><span class="s2">code</span><span class="s1">]) {</span>
      <span class="s3">return </span><span class="s2">next </span><span class="s1">- </span><span class="s4">1</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">backslash</span><span class="s1">) {</span>
      <span class="s2">next </span><span class="s1">= </span><span class="s2">consumeEscape</span><span class="s1">(</span><span class="s2">css</span><span class="s1">, </span><span class="s2">next</span><span class="s1">) + </span><span class="s4">1</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s7">// All other characters are part of the word</span>
      <span class="s2">next</span><span class="s1">++;</span>
    <span class="s1">}</span>
  <span class="s1">} </span><span class="s3">while </span><span class="s1">(</span><span class="s2">next </span><span class="s1">&lt; </span><span class="s2">css</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span>
  <span class="s3">return </span><span class="s2">next </span><span class="s1">- </span><span class="s4">1</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s5">/**</span>
 <span class="s5">*  Returns the last index of the escape sequence</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{string} css The string in which the sequence begins</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{number} start The index into the string where escape character (`\`) occurs.</span>
 <span class="s5">*/</span>
<span class="s3">function </span><span class="s2">consumeEscape</span><span class="s1">(</span><span class="s2">css</span><span class="s1">, </span><span class="s2">start</span><span class="s1">) {</span>
  <span class="s3">var </span><span class="s2">next </span><span class="s1">= </span><span class="s2">start</span><span class="s1">;</span>
  <span class="s3">var </span><span class="s2">code </span><span class="s1">= </span><span class="s2">css</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">next </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">);</span>
  <span class="s3">if </span><span class="s1">(</span><span class="s2">unescapable</span><span class="s1">[</span><span class="s2">code</span><span class="s1">]) {</span>
    <span class="s7">// just consume the escape char</span>
  <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s2">hex</span><span class="s1">[</span><span class="s2">code</span><span class="s1">]) {</span>
    <span class="s3">var </span><span class="s2">hexDigits </span><span class="s1">= </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s7">// consume up to 6 hex chars</span>
    <span class="s3">do </span><span class="s1">{</span>
      <span class="s2">next</span><span class="s1">++;</span>
      <span class="s2">hexDigits</span><span class="s1">++;</span>
      <span class="s2">code </span><span class="s1">= </span><span class="s2">css</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">next </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">while </span><span class="s1">(</span><span class="s2">hex</span><span class="s1">[</span><span class="s2">code</span><span class="s1">] &amp;&amp; </span><span class="s2">hexDigits </span><span class="s1">&lt; </span><span class="s4">6</span><span class="s1">);</span>
    <span class="s7">// if fewer than 6 hex chars, a trailing space ends the escape</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">hexDigits </span><span class="s1">&lt; </span><span class="s4">6 </span><span class="s1">&amp;&amp; </span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">space</span><span class="s1">) {</span>
      <span class="s2">next</span><span class="s1">++;</span>
    <span class="s1">}</span>
  <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
    <span class="s7">// the next char is part of the current word</span>
    <span class="s2">next</span><span class="s1">++;</span>
  <span class="s1">}</span>
  <span class="s3">return </span><span class="s2">next</span><span class="s1">;</span>
<span class="s1">}</span>
<span class="s3">var </span><span class="s2">FIELDS </span><span class="s1">= {</span>
  <span class="s2">TYPE</span><span class="s1">: </span><span class="s4">0</span><span class="s1">,</span>
  <span class="s2">START_LINE</span><span class="s1">: </span><span class="s4">1</span><span class="s1">,</span>
  <span class="s2">START_COL</span><span class="s1">: </span><span class="s4">2</span><span class="s1">,</span>
  <span class="s2">END_LINE</span><span class="s1">: </span><span class="s4">3</span><span class="s1">,</span>
  <span class="s2">END_COL</span><span class="s1">: </span><span class="s4">4</span><span class="s1">,</span>
  <span class="s2">START_POS</span><span class="s1">: </span><span class="s4">5</span><span class="s1">,</span>
  <span class="s2">END_POS</span><span class="s1">: </span><span class="s4">6</span>
<span class="s1">};</span>
<span class="s2">exports</span><span class="s1">.</span><span class="s2">FIELDS </span><span class="s1">= </span><span class="s2">FIELDS</span><span class="s1">;</span>
<span class="s3">function </span><span class="s2">tokenize</span><span class="s1">(</span><span class="s2">input</span><span class="s1">) {</span>
  <span class="s3">var </span><span class="s2">tokens </span><span class="s1">= [];</span>
  <span class="s3">var </span><span class="s2">css </span><span class="s1">= </span><span class="s2">input</span><span class="s1">.</span><span class="s2">css</span><span class="s1">.</span><span class="s2">valueOf</span><span class="s1">();</span>
  <span class="s3">var </span><span class="s2">_css </span><span class="s1">= </span><span class="s2">css</span><span class="s1">,</span>
    <span class="s2">length </span><span class="s1">= </span><span class="s2">_css</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span>
  <span class="s3">var </span><span class="s2">offset </span><span class="s1">= -</span><span class="s4">1</span><span class="s1">;</span>
  <span class="s3">var </span><span class="s2">line </span><span class="s1">= </span><span class="s4">1</span><span class="s1">;</span>
  <span class="s3">var </span><span class="s2">start </span><span class="s1">= </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s3">var </span><span class="s2">end </span><span class="s1">= </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s3">var </span><span class="s2">code</span><span class="s1">, </span><span class="s2">content</span><span class="s1">, </span><span class="s2">endColumn</span><span class="s1">, </span><span class="s2">endLine</span><span class="s1">, </span><span class="s2">escaped</span><span class="s1">, </span><span class="s2">escapePos</span><span class="s1">, </span><span class="s2">last</span><span class="s1">, </span><span class="s2">lines</span><span class="s1">, </span><span class="s2">next</span><span class="s1">, </span><span class="s2">nextLine</span><span class="s1">, </span><span class="s2">nextOffset</span><span class="s1">, </span><span class="s2">quote</span><span class="s1">, </span><span class="s2">tokenType</span><span class="s1">;</span>
  <span class="s3">function </span><span class="s2">unclosed</span><span class="s1">(</span><span class="s2">what</span><span class="s1">, </span><span class="s2">fix</span><span class="s1">) {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">input</span><span class="s1">.</span><span class="s2">safe</span><span class="s1">) {</span>
      <span class="s7">// fyi: this is never set to true.</span>
      <span class="s2">css </span><span class="s1">+= </span><span class="s2">fix</span><span class="s1">;</span>
      <span class="s2">next </span><span class="s1">= </span><span class="s2">css</span><span class="s1">.</span><span class="s2">length </span><span class="s1">- </span><span class="s4">1</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">throw </span><span class="s2">input</span><span class="s1">.</span><span class="s2">error</span><span class="s1">(</span><span class="s0">'Unclosed ' </span><span class="s1">+ </span><span class="s2">what</span><span class="s1">, </span><span class="s2">line</span><span class="s1">, </span><span class="s2">start </span><span class="s1">- </span><span class="s2">offset</span><span class="s1">, </span><span class="s2">start</span><span class="s1">);</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
  <span class="s3">while </span><span class="s1">(</span><span class="s2">start </span><span class="s1">&lt; </span><span class="s2">length</span><span class="s1">) {</span>
    <span class="s2">code </span><span class="s1">= </span><span class="s2">css</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">start</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">newline</span><span class="s1">) {</span>
      <span class="s2">offset </span><span class="s1">= </span><span class="s2">start</span><span class="s1">;</span>
      <span class="s2">line </span><span class="s1">+= </span><span class="s4">1</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">switch </span><span class="s1">(</span><span class="s2">code</span><span class="s1">) {</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">space</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">tab</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">newline</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">cr</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">feed</span><span class="s1">:</span>
        <span class="s2">next </span><span class="s1">= </span><span class="s2">start</span><span class="s1">;</span>
        <span class="s3">do </span><span class="s1">{</span>
          <span class="s2">next </span><span class="s1">+= </span><span class="s4">1</span><span class="s1">;</span>
          <span class="s2">code </span><span class="s1">= </span><span class="s2">css</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">next</span><span class="s1">);</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">newline</span><span class="s1">) {</span>
            <span class="s2">offset </span><span class="s1">= </span><span class="s2">next</span><span class="s1">;</span>
            <span class="s2">line </span><span class="s1">+= </span><span class="s4">1</span><span class="s1">;</span>
          <span class="s1">}</span>
        <span class="s1">} </span><span class="s3">while </span><span class="s1">(</span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">space </span><span class="s1">|| </span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">newline </span><span class="s1">|| </span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">tab </span><span class="s1">|| </span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">cr </span><span class="s1">|| </span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">feed</span><span class="s1">);</span>
        <span class="s2">tokenType </span><span class="s1">= </span><span class="s2">t</span><span class="s1">.</span><span class="s2">space</span><span class="s1">;</span>
        <span class="s2">endLine </span><span class="s1">= </span><span class="s2">line</span><span class="s1">;</span>
        <span class="s2">endColumn </span><span class="s1">= </span><span class="s2">next </span><span class="s1">- </span><span class="s2">offset </span><span class="s1">- </span><span class="s4">1</span><span class="s1">;</span>
        <span class="s2">end </span><span class="s1">= </span><span class="s2">next</span><span class="s1">;</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">plus</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">greaterThan</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">tilde</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">pipe</span><span class="s1">:</span>
        <span class="s2">next </span><span class="s1">= </span><span class="s2">start</span><span class="s1">;</span>
        <span class="s3">do </span><span class="s1">{</span>
          <span class="s2">next </span><span class="s1">+= </span><span class="s4">1</span><span class="s1">;</span>
          <span class="s2">code </span><span class="s1">= </span><span class="s2">css</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">next</span><span class="s1">);</span>
        <span class="s1">} </span><span class="s3">while </span><span class="s1">(</span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">plus </span><span class="s1">|| </span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">greaterThan </span><span class="s1">|| </span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">tilde </span><span class="s1">|| </span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">pipe</span><span class="s1">);</span>
        <span class="s2">tokenType </span><span class="s1">= </span><span class="s2">t</span><span class="s1">.</span><span class="s2">combinator</span><span class="s1">;</span>
        <span class="s2">endLine </span><span class="s1">= </span><span class="s2">line</span><span class="s1">;</span>
        <span class="s2">endColumn </span><span class="s1">= </span><span class="s2">start </span><span class="s1">- </span><span class="s2">offset</span><span class="s1">;</span>
        <span class="s2">end </span><span class="s1">= </span><span class="s2">next</span><span class="s1">;</span>
        <span class="s3">break</span><span class="s1">;</span>

      <span class="s7">// Consume these characters as single tokens.</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">asterisk</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">ampersand</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">bang</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">comma</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">equals</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">dollar</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">caret</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">openSquare</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">closeSquare</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">colon</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">semicolon</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">openParenthesis</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">closeParenthesis</span><span class="s1">:</span>
        <span class="s2">next </span><span class="s1">= </span><span class="s2">start</span><span class="s1">;</span>
        <span class="s2">tokenType </span><span class="s1">= </span><span class="s2">code</span><span class="s1">;</span>
        <span class="s2">endLine </span><span class="s1">= </span><span class="s2">line</span><span class="s1">;</span>
        <span class="s2">endColumn </span><span class="s1">= </span><span class="s2">start </span><span class="s1">- </span><span class="s2">offset</span><span class="s1">;</span>
        <span class="s2">end </span><span class="s1">= </span><span class="s2">next </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">;</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">singleQuote</span><span class="s1">:</span>
      <span class="s3">case </span><span class="s2">t</span><span class="s1">.</span><span class="s2">doubleQuote</span><span class="s1">:</span>
        <span class="s2">quote </span><span class="s1">= </span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">singleQuote </span><span class="s1">? </span><span class="s0">&quot;'&quot; </span><span class="s1">: </span><span class="s0">'&quot;'</span><span class="s1">;</span>
        <span class="s2">next </span><span class="s1">= </span><span class="s2">start</span><span class="s1">;</span>
        <span class="s3">do </span><span class="s1">{</span>
          <span class="s2">escaped </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
          <span class="s2">next </span><span class="s1">= </span><span class="s2">css</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">quote</span><span class="s1">, </span><span class="s2">next </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">);</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">next </span><span class="s1">=== -</span><span class="s4">1</span><span class="s1">) {</span>
            <span class="s2">unclosed</span><span class="s1">(</span><span class="s0">'quote'</span><span class="s1">, </span><span class="s2">quote</span><span class="s1">);</span>
          <span class="s1">}</span>
          <span class="s2">escapePos </span><span class="s1">= </span><span class="s2">next</span><span class="s1">;</span>
          <span class="s3">while </span><span class="s1">(</span><span class="s2">css</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">escapePos </span><span class="s1">- </span><span class="s4">1</span><span class="s1">) === </span><span class="s2">t</span><span class="s1">.</span><span class="s2">backslash</span><span class="s1">) {</span>
            <span class="s2">escapePos </span><span class="s1">-= </span><span class="s4">1</span><span class="s1">;</span>
            <span class="s2">escaped </span><span class="s1">= !</span><span class="s2">escaped</span><span class="s1">;</span>
          <span class="s1">}</span>
        <span class="s1">} </span><span class="s3">while </span><span class="s1">(</span><span class="s2">escaped</span><span class="s1">);</span>
        <span class="s2">tokenType </span><span class="s1">= </span><span class="s2">t</span><span class="s1">.</span><span class="s2">str</span><span class="s1">;</span>
        <span class="s2">endLine </span><span class="s1">= </span><span class="s2">line</span><span class="s1">;</span>
        <span class="s2">endColumn </span><span class="s1">= </span><span class="s2">start </span><span class="s1">- </span><span class="s2">offset</span><span class="s1">;</span>
        <span class="s2">end </span><span class="s1">= </span><span class="s2">next </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">;</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s3">default</span><span class="s1">:</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">slash </span><span class="s1">&amp;&amp; </span><span class="s2">css</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">start </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">) === </span><span class="s2">t</span><span class="s1">.</span><span class="s2">asterisk</span><span class="s1">) {</span>
          <span class="s2">next </span><span class="s1">= </span><span class="s2">css</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s0">'*/'</span><span class="s1">, </span><span class="s2">start </span><span class="s1">+ </span><span class="s4">2</span><span class="s1">) + </span><span class="s4">1</span><span class="s1">;</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">next </span><span class="s1">=== </span><span class="s4">0</span><span class="s1">) {</span>
            <span class="s2">unclosed</span><span class="s1">(</span><span class="s0">'comment'</span><span class="s1">, </span><span class="s0">'*/'</span><span class="s1">);</span>
          <span class="s1">}</span>
          <span class="s2">content </span><span class="s1">= </span><span class="s2">css</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">start</span><span class="s1">, </span><span class="s2">next </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">);</span>
          <span class="s2">lines </span><span class="s1">= </span><span class="s2">content</span><span class="s1">.</span><span class="s2">split</span><span class="s1">(</span><span class="s0">'</span><span class="s3">\n</span><span class="s0">'</span><span class="s1">);</span>
          <span class="s2">last </span><span class="s1">= </span><span class="s2">lines</span><span class="s1">.</span><span class="s2">length </span><span class="s1">- </span><span class="s4">1</span><span class="s1">;</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">last </span><span class="s1">&gt; </span><span class="s4">0</span><span class="s1">) {</span>
            <span class="s2">nextLine </span><span class="s1">= </span><span class="s2">line </span><span class="s1">+ </span><span class="s2">last</span><span class="s1">;</span>
            <span class="s2">nextOffset </span><span class="s1">= </span><span class="s2">next </span><span class="s1">- </span><span class="s2">lines</span><span class="s1">[</span><span class="s2">last</span><span class="s1">].</span><span class="s2">length</span><span class="s1">;</span>
          <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
            <span class="s2">nextLine </span><span class="s1">= </span><span class="s2">line</span><span class="s1">;</span>
            <span class="s2">nextOffset </span><span class="s1">= </span><span class="s2">offset</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s2">tokenType </span><span class="s1">= </span><span class="s2">t</span><span class="s1">.</span><span class="s2">comment</span><span class="s1">;</span>
          <span class="s2">line </span><span class="s1">= </span><span class="s2">nextLine</span><span class="s1">;</span>
          <span class="s2">endLine </span><span class="s1">= </span><span class="s2">nextLine</span><span class="s1">;</span>
          <span class="s2">endColumn </span><span class="s1">= </span><span class="s2">next </span><span class="s1">- </span><span class="s2">nextOffset</span><span class="s1">;</span>
        <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s2">code </span><span class="s1">=== </span><span class="s2">t</span><span class="s1">.</span><span class="s2">slash</span><span class="s1">) {</span>
          <span class="s2">next </span><span class="s1">= </span><span class="s2">start</span><span class="s1">;</span>
          <span class="s2">tokenType </span><span class="s1">= </span><span class="s2">code</span><span class="s1">;</span>
          <span class="s2">endLine </span><span class="s1">= </span><span class="s2">line</span><span class="s1">;</span>
          <span class="s2">endColumn </span><span class="s1">= </span><span class="s2">start </span><span class="s1">- </span><span class="s2">offset</span><span class="s1">;</span>
          <span class="s2">end </span><span class="s1">= </span><span class="s2">next </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">;</span>
        <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
          <span class="s2">next </span><span class="s1">= </span><span class="s2">consumeWord</span><span class="s1">(</span><span class="s2">css</span><span class="s1">, </span><span class="s2">start</span><span class="s1">);</span>
          <span class="s2">tokenType </span><span class="s1">= </span><span class="s2">t</span><span class="s1">.</span><span class="s2">word</span><span class="s1">;</span>
          <span class="s2">endLine </span><span class="s1">= </span><span class="s2">line</span><span class="s1">;</span>
          <span class="s2">endColumn </span><span class="s1">= </span><span class="s2">next </span><span class="s1">- </span><span class="s2">offset</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">end </span><span class="s1">= </span><span class="s2">next </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">;</span>
        <span class="s3">break</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s7">// Ensure that the token structure remains consistent</span>
    <span class="s2">tokens</span><span class="s1">.</span><span class="s2">push</span><span class="s1">([</span><span class="s2">tokenType</span><span class="s1">,</span>
    <span class="s7">// [0] Token type</span>
    <span class="s2">line</span><span class="s1">,</span>
    <span class="s7">// [1] Starting line</span>
    <span class="s2">start </span><span class="s1">- </span><span class="s2">offset</span><span class="s1">,</span>
    <span class="s7">// [2] Starting column</span>
    <span class="s2">endLine</span><span class="s1">,</span>
    <span class="s7">// [3] Ending line</span>
    <span class="s2">endColumn</span><span class="s1">,</span>
    <span class="s7">// [4] Ending column</span>
    <span class="s2">start</span><span class="s1">,</span>
    <span class="s7">// [5] Start position / Source index</span>
    <span class="s2">end </span><span class="s7">// [6] End position</span>
    <span class="s1">]);</span>

    <span class="s7">// Reset offset for the next token</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">nextOffset</span><span class="s1">) {</span>
      <span class="s2">offset </span><span class="s1">= </span><span class="s2">nextOffset</span><span class="s1">;</span>
      <span class="s2">nextOffset </span><span class="s1">= </span><span class="s3">null</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">start </span><span class="s1">= </span><span class="s2">end</span><span class="s1">;</span>
  <span class="s1">}</span>
  <span class="s3">return </span><span class="s2">tokens</span><span class="s1">;</span>
<span class="s1">}</span></pre>
</body>
</html>