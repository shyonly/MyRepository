<html>
<head>
<title>tests.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6aab73;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
tests.js</font>
</center></td></tr></table>
<pre><span class="s0">'use strict'</span><span class="s1">;</span>

<span class="s3">var </span><span class="s2">hasSymbols </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'has-symbols/shams'</span><span class="s1">)();</span>
<span class="s3">var </span><span class="s2">forEach </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'for-each'</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">has </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'has'</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">mockProperty </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'mock-property'</span><span class="s1">);</span>

<span class="s2">module</span><span class="s1">.</span><span class="s2">exports </span><span class="s1">= </span><span class="s3">function </span><span class="s1">(</span><span class="s2">assign</span><span class="s1">, </span><span class="s2">t</span><span class="s1">) {</span>
	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'error cases'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s2">st</span><span class="s1">[</span><span class="s0">'throws'</span><span class="s1">](</span><span class="s3">function </span><span class="s1">() { </span><span class="s2">assign</span><span class="s1">(</span><span class="s3">null</span><span class="s1">); }, </span><span class="s2">TypeError</span><span class="s1">, </span><span class="s0">'target must be an object'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">[</span><span class="s0">'throws'</span><span class="s1">](</span><span class="s3">function </span><span class="s1">() { </span><span class="s2">assign</span><span class="s1">(</span><span class="s2">undefined</span><span class="s1">); }, </span><span class="s2">TypeError</span><span class="s1">, </span><span class="s0">'target must be an object'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">[</span><span class="s0">'throws'</span><span class="s1">](</span><span class="s3">function </span><span class="s1">() { </span><span class="s2">assign</span><span class="s1">(</span><span class="s3">null</span><span class="s1">, {}); }, </span><span class="s2">TypeError</span><span class="s1">, </span><span class="s0">'target must be an object'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">[</span><span class="s0">'throws'</span><span class="s1">](</span><span class="s3">function </span><span class="s1">() { </span><span class="s2">assign</span><span class="s1">(</span><span class="s2">undefined</span><span class="s1">, {}); }, </span><span class="s2">TypeError</span><span class="s1">, </span><span class="s0">'target must be an object'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'non-object target, no sources'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s3">var </span><span class="s2">bool </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">(</span><span class="s3">true</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">bool</span><span class="s1">, </span><span class="s0">'object'</span><span class="s1">, </span><span class="s0">'bool is object'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">Boolean</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">valueOf</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">bool</span><span class="s1">), </span><span class="s3">true</span><span class="s1">, </span><span class="s0">'bool coerces to `true`'</span><span class="s1">);</span>

		<span class="s3">var </span><span class="s2">number </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">(</span><span class="s4">1</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">number</span><span class="s1">, </span><span class="s0">'object'</span><span class="s1">, </span><span class="s0">'number is object'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">Number</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">valueOf</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">number</span><span class="s1">), </span><span class="s4">1</span><span class="s1">, </span><span class="s0">'number coerces to `1`'</span><span class="s1">);</span>

		<span class="s3">var </span><span class="s2">string </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">(</span><span class="s0">'1'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">string</span><span class="s1">, </span><span class="s0">'object'</span><span class="s1">, </span><span class="s0">'number is object'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">String</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">valueOf</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">string</span><span class="s1">), </span><span class="s0">'1'</span><span class="s1">, </span><span class="s0">'number coerces to `&quot;1&quot;`'</span><span class="s1">);</span>

		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'non-object target, with sources'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s3">var </span><span class="s2">signal </span><span class="s1">= {};</span>

		<span class="s2">st</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'boolean'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st2</span><span class="s1">) {</span>
			<span class="s3">var </span><span class="s2">bool </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">(</span><span class="s3">true</span><span class="s1">, { </span><span class="s2">a</span><span class="s1">: </span><span class="s2">signal </span><span class="s1">});</span>
			<span class="s2">st2</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">bool</span><span class="s1">, </span><span class="s0">'object'</span><span class="s1">, </span><span class="s0">'bool is object'</span><span class="s1">);</span>
			<span class="s2">st2</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">Boolean</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">valueOf</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">bool</span><span class="s1">), </span><span class="s3">true</span><span class="s1">, </span><span class="s0">'bool coerces to `true`'</span><span class="s1">);</span>
			<span class="s2">st2</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">bool</span><span class="s1">.</span><span class="s2">a</span><span class="s1">, </span><span class="s2">signal</span><span class="s1">, </span><span class="s0">'source properties copied'</span><span class="s1">);</span>
			<span class="s2">st2</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
		<span class="s1">});</span>

		<span class="s2">st</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'number'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st2</span><span class="s1">) {</span>
			<span class="s3">var </span><span class="s2">number </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">(</span><span class="s4">1</span><span class="s1">, { </span><span class="s2">a</span><span class="s1">: </span><span class="s2">signal </span><span class="s1">});</span>
			<span class="s2">st2</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">number</span><span class="s1">, </span><span class="s0">'object'</span><span class="s1">, </span><span class="s0">'number is object'</span><span class="s1">);</span>
			<span class="s2">st2</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">Number</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">valueOf</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">number</span><span class="s1">), </span><span class="s4">1</span><span class="s1">, </span><span class="s0">'number coerces to `1`'</span><span class="s1">);</span>
			<span class="s2">st2</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">number</span><span class="s1">.</span><span class="s2">a</span><span class="s1">, </span><span class="s2">signal</span><span class="s1">, </span><span class="s0">'source properties copied'</span><span class="s1">);</span>
			<span class="s2">st2</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
		<span class="s1">});</span>

		<span class="s2">st</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'string'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st2</span><span class="s1">) {</span>
			<span class="s3">var </span><span class="s2">string </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">(</span><span class="s0">'1'</span><span class="s1">, { </span><span class="s2">a</span><span class="s1">: </span><span class="s2">signal </span><span class="s1">});</span>
			<span class="s2">st2</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s3">typeof </span><span class="s2">string</span><span class="s1">, </span><span class="s0">'object'</span><span class="s1">, </span><span class="s0">'number is object'</span><span class="s1">);</span>
			<span class="s2">st2</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">String</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">valueOf</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">string</span><span class="s1">), </span><span class="s0">'1'</span><span class="s1">, </span><span class="s0">'number coerces to `&quot;1&quot;`'</span><span class="s1">);</span>
			<span class="s2">st2</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">string</span><span class="s1">.</span><span class="s2">a</span><span class="s1">, </span><span class="s2">signal</span><span class="s1">, </span><span class="s0">'source properties copied'</span><span class="s1">);</span>
			<span class="s2">st2</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
		<span class="s1">});</span>

		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'non-object sources'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">(</span><span class="s2">assign</span><span class="s1">({ </span><span class="s2">a</span><span class="s1">: </span><span class="s4">1 </span><span class="s1">}, </span><span class="s3">null</span><span class="s1">, { </span><span class="s2">b</span><span class="s1">: </span><span class="s4">2 </span><span class="s1">}), { </span><span class="s2">a</span><span class="s1">: </span><span class="s4">1</span><span class="s1">, </span><span class="s2">b</span><span class="s1">: </span><span class="s4">2 </span><span class="s1">}, </span><span class="s0">'ignores null source'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">(</span><span class="s2">assign</span><span class="s1">({ </span><span class="s2">a</span><span class="s1">: </span><span class="s4">1 </span><span class="s1">}, { </span><span class="s2">b</span><span class="s1">: </span><span class="s4">2 </span><span class="s1">}, </span><span class="s2">undefined</span><span class="s1">), { </span><span class="s2">a</span><span class="s1">: </span><span class="s4">1</span><span class="s1">, </span><span class="s2">b</span><span class="s1">: </span><span class="s4">2 </span><span class="s1">}, </span><span class="s0">'ignores undefined source'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'returns the modified target object'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s3">var </span><span class="s2">target </span><span class="s1">= {};</span>
		<span class="s3">var </span><span class="s2">returned </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">(</span><span class="s2">target</span><span class="s1">, { </span><span class="s2">a</span><span class="s1">: </span><span class="s4">1 </span><span class="s1">});</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">returned</span><span class="s1">, </span><span class="s2">target</span><span class="s1">, </span><span class="s0">'returned object is the same reference as the target object'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'has the right length'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">assign</span><span class="s1">.</span><span class="s2">length</span><span class="s1">, </span><span class="s4">2</span><span class="s1">, </span><span class="s0">'length is 2 =&gt; 2 required arguments'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'merge two objects'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s3">var </span><span class="s2">target </span><span class="s1">= { </span><span class="s2">a</span><span class="s1">: </span><span class="s4">1 </span><span class="s1">};</span>
		<span class="s3">var </span><span class="s2">returned </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">(</span><span class="s2">target</span><span class="s1">, { </span><span class="s2">b</span><span class="s1">: </span><span class="s4">2 </span><span class="s1">});</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">(</span><span class="s2">returned</span><span class="s1">, { </span><span class="s2">a</span><span class="s1">: </span><span class="s4">1</span><span class="s1">, </span><span class="s2">b</span><span class="s1">: </span><span class="s4">2 </span><span class="s1">}, </span><span class="s0">'returned object has properties from both'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'works with functions'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s3">var </span><span class="s2">target </span><span class="s1">= </span><span class="s3">function </span><span class="s1">() {};</span>
		<span class="s2">target</span><span class="s1">.</span><span class="s2">a </span><span class="s1">= </span><span class="s4">1</span><span class="s1">;</span>
		<span class="s3">var </span><span class="s2">returned </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">(</span><span class="s2">target</span><span class="s1">, { </span><span class="s2">b</span><span class="s1">: </span><span class="s4">2 </span><span class="s1">});</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">target</span><span class="s1">, </span><span class="s2">returned</span><span class="s1">, </span><span class="s0">'returned object is target'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">returned</span><span class="s1">.</span><span class="s2">a</span><span class="s1">, </span><span class="s4">1</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">returned</span><span class="s1">.</span><span class="s2">b</span><span class="s1">, </span><span class="s4">2</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'works with primitives'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s3">var </span><span class="s2">target </span><span class="s1">= </span><span class="s4">2</span><span class="s1">;</span>
		<span class="s3">var </span><span class="s2">source </span><span class="s1">= { </span><span class="s2">b</span><span class="s1">: </span><span class="s4">42 </span><span class="s1">};</span>
		<span class="s3">var </span><span class="s2">returned </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">(</span><span class="s2">target</span><span class="s1">, </span><span class="s2">source</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">toString</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">returned</span><span class="s1">), </span><span class="s0">'[object Number]'</span><span class="s1">, </span><span class="s0">'returned is object form of number primitive'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">Number</span><span class="s1">(</span><span class="s2">returned</span><span class="s1">), </span><span class="s2">target</span><span class="s1">, </span><span class="s0">'returned and target have same valueOf'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">returned</span><span class="s1">.</span><span class="s2">b</span><span class="s1">, </span><span class="s2">source</span><span class="s1">.</span><span class="s2">b</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s5">/* globals window */</span>
	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'works with window.location'</span><span class="s1">, { </span><span class="s2">skip</span><span class="s1">: </span><span class="s3">typeof </span><span class="s2">window </span><span class="s1">=== </span><span class="s0">'undefined' </span><span class="s1">}, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s3">var </span><span class="s2">target </span><span class="s1">= {};</span>
		<span class="s2">assign</span><span class="s1">(</span><span class="s2">target</span><span class="s1">, </span><span class="s2">window</span><span class="s1">.</span><span class="s2">location</span><span class="s1">);</span>
		<span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s2">prop </span><span class="s3">in </span><span class="s2">window</span><span class="s1">.</span><span class="s2">location</span><span class="s1">) {</span>
			<span class="s3">if </span><span class="s1">(</span><span class="s2">has</span><span class="s1">(</span><span class="s2">window</span><span class="s1">.</span><span class="s2">location</span><span class="s1">, </span><span class="s2">prop</span><span class="s1">)) {</span>
				<span class="s2">st</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">(</span><span class="s2">target</span><span class="s1">[</span><span class="s2">prop</span><span class="s1">], </span><span class="s2">window</span><span class="s1">.</span><span class="s2">location</span><span class="s1">[</span><span class="s2">prop</span><span class="s1">], </span><span class="s2">prop </span><span class="s1">+ </span><span class="s0">' is copied'</span><span class="s1">);</span>
			<span class="s1">}</span>
		<span class="s1">}</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'merge N objects'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s3">var </span><span class="s2">target </span><span class="s1">= { </span><span class="s2">a</span><span class="s1">: </span><span class="s4">1 </span><span class="s1">};</span>
		<span class="s3">var </span><span class="s2">source1 </span><span class="s1">= { </span><span class="s2">b</span><span class="s1">: </span><span class="s4">2 </span><span class="s1">};</span>
		<span class="s3">var </span><span class="s2">source2 </span><span class="s1">= { </span><span class="s2">c</span><span class="s1">: </span><span class="s4">3 </span><span class="s1">};</span>
		<span class="s3">var </span><span class="s2">returned </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">(</span><span class="s2">target</span><span class="s1">, </span><span class="s2">source1</span><span class="s1">, </span><span class="s2">source2</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">(</span><span class="s2">returned</span><span class="s1">, { </span><span class="s2">a</span><span class="s1">: </span><span class="s4">1</span><span class="s1">, </span><span class="s2">b</span><span class="s1">: </span><span class="s4">2</span><span class="s1">, </span><span class="s2">c</span><span class="s1">: </span><span class="s4">3 </span><span class="s1">}, </span><span class="s0">'returned object has properties from all sources'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'only iterates over own keys'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s3">var </span><span class="s2">Foo </span><span class="s1">= </span><span class="s3">function </span><span class="s1">() {};</span>
		<span class="s2">Foo</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">bar </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
		<span class="s3">var </span><span class="s2">foo </span><span class="s1">= </span><span class="s3">new </span><span class="s2">Foo</span><span class="s1">();</span>
		<span class="s2">foo</span><span class="s1">.</span><span class="s2">baz </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
		<span class="s3">var </span><span class="s2">target </span><span class="s1">= { </span><span class="s2">a</span><span class="s1">: </span><span class="s4">1 </span><span class="s1">};</span>
		<span class="s3">var </span><span class="s2">returned </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">(</span><span class="s2">target</span><span class="s1">, </span><span class="s2">foo</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">returned</span><span class="s1">, </span><span class="s2">target</span><span class="s1">, </span><span class="s0">'returned object is the same reference as the target object'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">(</span><span class="s2">target</span><span class="s1">, { </span><span class="s2">a</span><span class="s1">: </span><span class="s4">1</span><span class="s1">, </span><span class="s2">baz</span><span class="s1">: </span><span class="s3">true </span><span class="s1">}, </span><span class="s0">'returned object has only own properties from both'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'includes enumerable symbols, after keys'</span><span class="s1">, { </span><span class="s2">skip</span><span class="s1">: !</span><span class="s2">hasSymbols </span><span class="s1">}, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s3">var </span><span class="s2">visited </span><span class="s1">= [];</span>
		<span class="s3">var </span><span class="s2">obj </span><span class="s1">= {};</span>
		<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s0">'a'</span><span class="s1">, { </span><span class="s2">enumerable</span><span class="s1">: </span><span class="s3">true</span><span class="s1">, </span><span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s1">() { </span><span class="s2">visited</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s0">'a'</span><span class="s1">); </span><span class="s3">return </span><span class="s4">42</span><span class="s1">; } });</span>
		<span class="s3">var </span><span class="s2">symbol </span><span class="s1">= </span><span class="s2">Symbol</span><span class="s1">(</span><span class="s0">'enumerable'</span><span class="s1">);</span>
		<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">symbol</span><span class="s1">, {</span>
			<span class="s2">enumerable</span><span class="s1">: </span><span class="s3">true</span><span class="s1">,</span>
			<span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s1">() { </span><span class="s2">visited</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">symbol</span><span class="s1">); </span><span class="s3">return </span><span class="s2">Infinity</span><span class="s1">; }</span>
		<span class="s1">});</span>
		<span class="s3">var </span><span class="s2">nonEnumSymbol </span><span class="s1">= </span><span class="s2">Symbol</span><span class="s1">(</span><span class="s0">'non-enumerable'</span><span class="s1">);</span>
		<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">nonEnumSymbol</span><span class="s1">, {</span>
			<span class="s2">enumerable</span><span class="s1">: </span><span class="s3">false</span><span class="s1">,</span>
			<span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s1">() { </span><span class="s2">visited</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">nonEnumSymbol</span><span class="s1">); </span><span class="s3">return </span><span class="s1">-</span><span class="s2">Infinity</span><span class="s1">; }</span>
		<span class="s1">});</span>
		<span class="s3">var </span><span class="s2">target </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">({}, </span><span class="s2">obj</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">(</span><span class="s2">visited</span><span class="s1">, [</span><span class="s0">'a'</span><span class="s1">, </span><span class="s2">symbol</span><span class="s1">], </span><span class="s0">'key is visited first, then symbol'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">target</span><span class="s1">.</span><span class="s2">a</span><span class="s1">, </span><span class="s4">42</span><span class="s1">, </span><span class="s0">'target.a is 42'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">target</span><span class="s1">[</span><span class="s2">symbol</span><span class="s1">], </span><span class="s2">Infinity</span><span class="s1">, </span><span class="s0">'target[symbol] is Infinity'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">notEqual</span><span class="s1">(</span><span class="s2">target</span><span class="s1">[</span><span class="s2">nonEnumSymbol</span><span class="s1">], -</span><span class="s2">Infinity</span><span class="s1">, </span><span class="s0">'target[nonEnumSymbol] is not -Infinity'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'does not fail when symbols are not present'</span><span class="s1">, { </span><span class="s2">skip</span><span class="s1">: !</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">isFrozen </span><span class="s1">|| </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">isFrozen</span><span class="s1">(</span><span class="s2">Object</span><span class="s1">) }, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">teardown</span><span class="s1">(</span><span class="s2">mockProperty</span><span class="s1">(</span><span class="s2">Object</span><span class="s1">, </span><span class="s0">'getOwnPropertySymbols'</span><span class="s1">, { </span><span class="s0">'delete'</span><span class="s1">: </span><span class="s3">true </span><span class="s1">}));</span>

		<span class="s3">var </span><span class="s2">visited </span><span class="s1">= [];</span>
		<span class="s3">var </span><span class="s2">obj </span><span class="s1">= {};</span>
		<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s0">'a'</span><span class="s1">, { </span><span class="s2">enumerable</span><span class="s1">: </span><span class="s3">true</span><span class="s1">, </span><span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s1">() { </span><span class="s2">visited</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s0">'a'</span><span class="s1">); </span><span class="s3">return </span><span class="s4">42</span><span class="s1">; } });</span>
		<span class="s3">var </span><span class="s2">keys </span><span class="s1">= [</span><span class="s0">'a'</span><span class="s1">];</span>
		<span class="s3">if </span><span class="s1">(</span><span class="s2">hasSymbols</span><span class="s1">) {</span>
			<span class="s3">var </span><span class="s2">symbol </span><span class="s1">= </span><span class="s2">Symbol</span><span class="s1">(</span><span class="s0">'sym'</span><span class="s1">);</span>
			<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">symbol</span><span class="s1">, {</span>
				<span class="s2">enumerable</span><span class="s1">: </span><span class="s3">true</span><span class="s1">,</span>
				<span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s1">() { </span><span class="s2">visited</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">symbol</span><span class="s1">); </span><span class="s3">return </span><span class="s2">Infinity</span><span class="s1">; }</span>
			<span class="s1">});</span>
			<span class="s2">keys</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">symbol</span><span class="s1">);</span>
		<span class="s1">}</span>
		<span class="s3">var </span><span class="s2">target </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">({}, </span><span class="s2">obj</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">(</span><span class="s2">visited</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">'assign visits expected keys'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">target</span><span class="s1">.</span><span class="s2">a</span><span class="s1">, </span><span class="s4">42</span><span class="s1">, </span><span class="s0">'target.a is 42'</span><span class="s1">);</span>

		<span class="s3">if </span><span class="s1">(</span><span class="s2">hasSymbols</span><span class="s1">) {</span>
			<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">target</span><span class="s1">[</span><span class="s2">symbol</span><span class="s1">], </span><span class="s2">Infinity</span><span class="s1">);</span>
		<span class="s1">}</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'preserves correct property enumeration order'</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s3">var </span><span class="s2">str </span><span class="s1">= </span><span class="s0">'abcdefghijklmnopqrst'</span><span class="s1">;</span>
		<span class="s3">var </span><span class="s2">letters </span><span class="s1">= {};</span>
		<span class="s2">forEach</span><span class="s1">(</span><span class="s2">str</span><span class="s1">.</span><span class="s2">split</span><span class="s1">(</span><span class="s0">''</span><span class="s1">), </span><span class="s3">function </span><span class="s1">(</span><span class="s2">letter</span><span class="s1">) {</span>
			<span class="s2">letters</span><span class="s1">[</span><span class="s2">letter</span><span class="s1">] = </span><span class="s2">letter</span><span class="s1">;</span>
		<span class="s1">});</span>

		<span class="s3">var </span><span class="s2">n </span><span class="s1">= </span><span class="s4">5</span><span class="s1">;</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">comment</span><span class="s1">(</span><span class="s0">'run the next test ' </span><span class="s1">+ </span><span class="s2">n </span><span class="s1">+ </span><span class="s0">' times'</span><span class="s1">);</span>
		<span class="s3">var </span><span class="s2">object </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">({}, </span><span class="s2">letters</span><span class="s1">);</span>
		<span class="s3">var </span><span class="s2">actual </span><span class="s1">= </span><span class="s0">''</span><span class="s1">;</span>
		<span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s2">k </span><span class="s3">in </span><span class="s2">object</span><span class="s1">) {</span>
			<span class="s2">actual </span><span class="s1">+= </span><span class="s2">k</span><span class="s1">;</span>
		<span class="s1">}</span>
		<span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s2">i </span><span class="s1">= </span><span class="s4">0</span><span class="s1">; </span><span class="s2">i </span><span class="s1">&lt; </span><span class="s2">n</span><span class="s1">; ++</span><span class="s2">i</span><span class="s1">) {</span>
			<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">actual</span><span class="s1">, </span><span class="s2">str</span><span class="s1">, </span><span class="s0">'property enumeration order should be followed'</span><span class="s1">);</span>
		<span class="s1">}</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>

	<span class="s2">t</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s0">'checks enumerability and existence, in case of modification during [[Get]]'</span><span class="s1">, { </span><span class="s2">skip</span><span class="s1">: !</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty </span><span class="s1">}, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">st</span><span class="s1">) {</span>
		<span class="s3">var </span><span class="s2">targetBvalue </span><span class="s1">= {};</span>
		<span class="s3">var </span><span class="s2">targetCvalue </span><span class="s1">= {};</span>
		<span class="s3">var </span><span class="s2">target </span><span class="s1">= { </span><span class="s2">b</span><span class="s1">: </span><span class="s2">targetBvalue</span><span class="s1">, </span><span class="s2">c</span><span class="s1">: </span><span class="s2">targetCvalue </span><span class="s1">};</span>
		<span class="s3">var </span><span class="s2">source </span><span class="s1">= {};</span>
		<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">source</span><span class="s1">, </span><span class="s0">'a'</span><span class="s1">, {</span>
			<span class="s2">enumerable</span><span class="s1">: </span><span class="s3">true</span><span class="s1">,</span>
			<span class="s2">get</span><span class="s1">: </span><span class="s3">function </span><span class="s1">() {</span>
				<span class="s3">delete this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">;</span>
				<span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s0">'c'</span><span class="s1">, { </span><span class="s2">enumerable</span><span class="s1">: </span><span class="s3">false </span><span class="s1">});</span>
				<span class="s3">return </span><span class="s0">'a'</span><span class="s1">;</span>
			<span class="s1">}</span>
		<span class="s1">});</span>
		<span class="s3">var </span><span class="s2">sourceBvalue </span><span class="s1">= {};</span>
		<span class="s3">var </span><span class="s2">sourceCvalue </span><span class="s1">= {};</span>
		<span class="s2">source</span><span class="s1">.</span><span class="s2">b </span><span class="s1">= </span><span class="s2">sourceBvalue</span><span class="s1">;</span>
		<span class="s2">source</span><span class="s1">.</span><span class="s2">c </span><span class="s1">= </span><span class="s2">sourceCvalue</span><span class="s1">;</span>
		<span class="s3">var </span><span class="s2">result </span><span class="s1">= </span><span class="s2">assign</span><span class="s1">(</span><span class="s2">target</span><span class="s1">, </span><span class="s2">source</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">result</span><span class="s1">, </span><span class="s2">target</span><span class="s1">, </span><span class="s0">'sanity check: result is === target'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">result</span><span class="s1">.</span><span class="s2">b</span><span class="s1">, </span><span class="s2">targetBvalue</span><span class="s1">, </span><span class="s0">'target key not overwritten by deleted source key'</span><span class="s1">);</span>
		<span class="s2">st</span><span class="s1">.</span><span class="s2">equal</span><span class="s1">(</span><span class="s2">result</span><span class="s1">.</span><span class="s2">c</span><span class="s1">, </span><span class="s2">targetCvalue</span><span class="s1">, </span><span class="s0">'target key not overwritten by non-enumerable source key'</span><span class="s1">);</span>

		<span class="s2">st</span><span class="s1">.</span><span class="s2">end</span><span class="s1">();</span>
	<span class="s1">});</span>
<span class="s1">};</span>
</pre>
</body>
</html>