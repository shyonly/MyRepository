<html>
<head>
<title>semver.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #42c3d4;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
semver.js</font>
</center></td></tr></table>
<pre><span class="s0">exports </span><span class="s1">= </span><span class="s0">module</span><span class="s1">.</span><span class="s0">exports </span><span class="s1">= </span><span class="s0">SemVer</span>

<span class="s2">var </span><span class="s0">debug</span>
<span class="s3">/* istanbul ignore next */</span>
<span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s0">process </span><span class="s1">=== </span><span class="s4">'object' </span><span class="s1">&amp;&amp;</span>
    <span class="s0">process</span><span class="s1">.</span><span class="s0">env </span><span class="s1">&amp;&amp;</span>
    <span class="s0">process</span><span class="s1">.</span><span class="s0">env</span><span class="s1">.</span><span class="s0">NODE_DEBUG </span><span class="s1">&amp;&amp;</span>
    <span class="s5">/\bsemver\b/i</span><span class="s1">.</span><span class="s0">test</span><span class="s1">(</span><span class="s0">process</span><span class="s1">.</span><span class="s0">env</span><span class="s1">.</span><span class="s0">NODE_DEBUG</span><span class="s1">)) {</span>
  <span class="s0">debug </span><span class="s1">= </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">var </span><span class="s0">args </span><span class="s1">= </span><span class="s0">Array</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">slice</span><span class="s1">.</span><span class="s0">call</span><span class="s1">(</span><span class="s0">arguments</span><span class="s1">, </span><span class="s6">0</span><span class="s1">)</span>
    <span class="s0">args</span><span class="s1">.</span><span class="s0">unshift</span><span class="s1">(</span><span class="s4">'SEMVER'</span><span class="s1">)</span>
    <span class="s0">console</span><span class="s1">.</span><span class="s0">log</span><span class="s1">.</span><span class="s0">apply</span><span class="s1">(</span><span class="s0">console</span><span class="s1">, </span><span class="s0">args</span><span class="s1">)</span>
  <span class="s1">}</span>
<span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
  <span class="s0">debug </span><span class="s1">= </span><span class="s2">function </span><span class="s1">() {}</span>
<span class="s1">}</span>

<span class="s3">// Note: this is the semver.org version of the spec that it implements</span>
<span class="s3">// Not necessarily the package version of this code.</span>
<span class="s0">exports</span><span class="s1">.</span><span class="s0">SEMVER_SPEC_VERSION </span><span class="s1">= </span><span class="s4">'2.0.0'</span>

<span class="s2">var </span><span class="s0">MAX_LENGTH </span><span class="s1">= </span><span class="s6">256</span>
<span class="s2">var </span><span class="s0">MAX_SAFE_INTEGER </span><span class="s1">= </span><span class="s0">Number</span><span class="s1">.</span><span class="s0">MAX_SAFE_INTEGER </span><span class="s1">||</span>
  <span class="s3">/* istanbul ignore next */ </span><span class="s6">9007199254740991</span>

<span class="s3">// Max safe segment length for coercion.</span>
<span class="s2">var </span><span class="s0">MAX_SAFE_COMPONENT_LENGTH </span><span class="s1">= </span><span class="s6">16</span>

<span class="s2">var </span><span class="s0">MAX_SAFE_BUILD_LENGTH </span><span class="s1">= </span><span class="s0">MAX_LENGTH </span><span class="s1">- </span><span class="s6">6</span>

<span class="s3">// The actual regexps go on exports.re</span>
<span class="s2">var </span><span class="s0">re </span><span class="s1">= </span><span class="s0">exports</span><span class="s1">.</span><span class="s0">re </span><span class="s1">= []</span>
<span class="s2">var </span><span class="s0">safeRe </span><span class="s1">= </span><span class="s0">exports</span><span class="s1">.</span><span class="s0">safeRe </span><span class="s1">= []</span>
<span class="s2">var </span><span class="s0">src </span><span class="s1">= </span><span class="s0">exports</span><span class="s1">.</span><span class="s0">src </span><span class="s1">= []</span>
<span class="s2">var </span><span class="s0">R </span><span class="s1">= </span><span class="s6">0</span>

<span class="s2">var </span><span class="s0">LETTERDASHNUMBER </span><span class="s1">= </span><span class="s4">'[a-zA-Z0-9-]'</span>

<span class="s3">// Replace some greedy regex tokens to prevent regex dos issues. These regex are</span>
<span class="s3">// used internally via the safeRe object since all inputs in this library get</span>
<span class="s3">// normalized first to trim and collapse all extra whitespace. The original</span>
<span class="s3">// regexes are exported for userland consumption and lower level usage. A</span>
<span class="s3">// future breaking change could export the safer regex only with a note that</span>
<span class="s3">// all input should have extra whitespace removed.</span>
<span class="s2">var </span><span class="s0">safeRegexReplacements </span><span class="s1">= [</span>
  <span class="s1">[</span><span class="s4">'</span><span class="s2">\\</span><span class="s4">s'</span><span class="s1">, </span><span class="s6">1</span><span class="s1">],</span>
  <span class="s1">[</span><span class="s4">'</span><span class="s2">\\</span><span class="s4">d'</span><span class="s1">, </span><span class="s0">MAX_LENGTH</span><span class="s1">],</span>
  <span class="s1">[</span><span class="s0">LETTERDASHNUMBER</span><span class="s1">, </span><span class="s0">MAX_SAFE_BUILD_LENGTH</span><span class="s1">],</span>
<span class="s1">]</span>

<span class="s2">function </span><span class="s0">makeSafeRe </span><span class="s1">(</span><span class="s0">value</span><span class="s1">) {</span>
  <span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s0">i </span><span class="s1">= </span><span class="s6">0</span><span class="s1">; </span><span class="s0">i </span><span class="s1">&lt; </span><span class="s0">safeRegexReplacements</span><span class="s1">.</span><span class="s0">length</span><span class="s1">; </span><span class="s0">i</span><span class="s1">++) {</span>
    <span class="s2">var </span><span class="s0">token </span><span class="s1">= </span><span class="s0">safeRegexReplacements</span><span class="s1">[</span><span class="s0">i</span><span class="s1">][</span><span class="s6">0</span><span class="s1">]</span>
    <span class="s2">var </span><span class="s0">max </span><span class="s1">= </span><span class="s0">safeRegexReplacements</span><span class="s1">[</span><span class="s0">i</span><span class="s1">][</span><span class="s6">1</span><span class="s1">]</span>
    <span class="s0">value </span><span class="s1">= </span><span class="s0">value</span>
      <span class="s1">.</span><span class="s0">split</span><span class="s1">(</span><span class="s0">token </span><span class="s1">+ </span><span class="s4">'*'</span><span class="s1">).</span><span class="s0">join</span><span class="s1">(</span><span class="s0">token </span><span class="s1">+ </span><span class="s4">'{0,' </span><span class="s1">+ </span><span class="s0">max </span><span class="s1">+ </span><span class="s4">'}'</span><span class="s1">)</span>
      <span class="s1">.</span><span class="s0">split</span><span class="s1">(</span><span class="s0">token </span><span class="s1">+ </span><span class="s4">'+'</span><span class="s1">).</span><span class="s0">join</span><span class="s1">(</span><span class="s0">token </span><span class="s1">+ </span><span class="s4">'{1,' </span><span class="s1">+ </span><span class="s0">max </span><span class="s1">+ </span><span class="s4">'}'</span><span class="s1">)</span>
  <span class="s1">}</span>
  <span class="s2">return </span><span class="s0">value</span>
<span class="s1">}</span>

<span class="s3">// The following Regular Expressions can be used for tokenizing,</span>
<span class="s3">// validating, and parsing SemVer version strings.</span>

<span class="s3">// ## Numeric Identifier</span>
<span class="s3">// A single `0`, or a non-zero digit followed by zero or more digits.</span>

<span class="s2">var </span><span class="s0">NUMERICIDENTIFIER </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">NUMERICIDENTIFIER</span><span class="s1">] = </span><span class="s4">'0|[1-9]</span><span class="s2">\\</span><span class="s4">d*'</span>
<span class="s2">var </span><span class="s0">NUMERICIDENTIFIERLOOSE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">NUMERICIDENTIFIERLOOSE</span><span class="s1">] = </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">d+'</span>

<span class="s3">// ## Non-numeric Identifier</span>
<span class="s3">// Zero or more digits, followed by a letter or hyphen, and then zero or</span>
<span class="s3">// more letters, digits, or hyphens.</span>

<span class="s2">var </span><span class="s0">NONNUMERICIDENTIFIER </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">NONNUMERICIDENTIFIER</span><span class="s1">] = </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">d*[a-zA-Z-]' </span><span class="s1">+ </span><span class="s0">LETTERDASHNUMBER </span><span class="s1">+ </span><span class="s4">'*'</span>

<span class="s3">// ## Main Version</span>
<span class="s3">// Three dot-separated numeric identifiers.</span>

<span class="s2">var </span><span class="s0">MAINVERSION </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">MAINVERSION</span><span class="s1">] = </span><span class="s4">'(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">NUMERICIDENTIFIER</span><span class="s1">] + </span><span class="s4">')</span><span class="s2">\\</span><span class="s4">.' </span><span class="s1">+</span>
                   <span class="s4">'(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">NUMERICIDENTIFIER</span><span class="s1">] + </span><span class="s4">')</span><span class="s2">\\</span><span class="s4">.' </span><span class="s1">+</span>
                   <span class="s4">'(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">NUMERICIDENTIFIER</span><span class="s1">] + </span><span class="s4">')'</span>

<span class="s2">var </span><span class="s0">MAINVERSIONLOOSE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">MAINVERSIONLOOSE</span><span class="s1">] = </span><span class="s4">'(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">NUMERICIDENTIFIERLOOSE</span><span class="s1">] + </span><span class="s4">')</span><span class="s2">\\</span><span class="s4">.' </span><span class="s1">+</span>
                        <span class="s4">'(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">NUMERICIDENTIFIERLOOSE</span><span class="s1">] + </span><span class="s4">')</span><span class="s2">\\</span><span class="s4">.' </span><span class="s1">+</span>
                        <span class="s4">'(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">NUMERICIDENTIFIERLOOSE</span><span class="s1">] + </span><span class="s4">')'</span>

<span class="s3">// ## Pre-release Version Identifier</span>
<span class="s3">// A numeric identifier, or a non-numeric identifier.</span>

<span class="s2">var </span><span class="s0">PRERELEASEIDENTIFIER </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">PRERELEASEIDENTIFIER</span><span class="s1">] = </span><span class="s4">'(?:' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">NUMERICIDENTIFIER</span><span class="s1">] +</span>
                            <span class="s4">'|' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">NONNUMERICIDENTIFIER</span><span class="s1">] + </span><span class="s4">')'</span>

<span class="s2">var </span><span class="s0">PRERELEASEIDENTIFIERLOOSE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">PRERELEASEIDENTIFIERLOOSE</span><span class="s1">] = </span><span class="s4">'(?:' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">NUMERICIDENTIFIERLOOSE</span><span class="s1">] +</span>
                                 <span class="s4">'|' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">NONNUMERICIDENTIFIER</span><span class="s1">] + </span><span class="s4">')'</span>

<span class="s3">// ## Pre-release Version</span>
<span class="s3">// Hyphen, followed by one or more dot-separated pre-release version</span>
<span class="s3">// identifiers.</span>

<span class="s2">var </span><span class="s0">PRERELEASE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">PRERELEASE</span><span class="s1">] = </span><span class="s4">'(?:-(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">PRERELEASEIDENTIFIER</span><span class="s1">] +</span>
                  <span class="s4">'(?:</span><span class="s2">\\</span><span class="s4">.' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">PRERELEASEIDENTIFIER</span><span class="s1">] + </span><span class="s4">')*))'</span>

<span class="s2">var </span><span class="s0">PRERELEASELOOSE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">PRERELEASELOOSE</span><span class="s1">] = </span><span class="s4">'(?:-?(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">PRERELEASEIDENTIFIERLOOSE</span><span class="s1">] +</span>
                       <span class="s4">'(?:</span><span class="s2">\\</span><span class="s4">.' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">PRERELEASEIDENTIFIERLOOSE</span><span class="s1">] + </span><span class="s4">')*))'</span>

<span class="s3">// ## Build Metadata Identifier</span>
<span class="s3">// Any combination of digits, letters, or hyphens.</span>

<span class="s2">var </span><span class="s0">BUILDIDENTIFIER </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">BUILDIDENTIFIER</span><span class="s1">] = </span><span class="s0">LETTERDASHNUMBER </span><span class="s1">+ </span><span class="s4">'+'</span>

<span class="s3">// ## Build Metadata</span>
<span class="s3">// Plus sign, followed by one or more period-separated build metadata</span>
<span class="s3">// identifiers.</span>

<span class="s2">var </span><span class="s0">BUILD </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">BUILD</span><span class="s1">] = </span><span class="s4">'(?:</span><span class="s2">\\</span><span class="s4">+(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">BUILDIDENTIFIER</span><span class="s1">] +</span>
             <span class="s4">'(?:</span><span class="s2">\\</span><span class="s4">.' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">BUILDIDENTIFIER</span><span class="s1">] + </span><span class="s4">')*))'</span>

<span class="s3">// ## Full Version String</span>
<span class="s3">// A main version, followed optionally by a pre-release version and</span>
<span class="s3">// build metadata.</span>

<span class="s3">// Note that the only major, minor, patch, and pre-release sections of</span>
<span class="s3">// the version string are capturing groups.  The build metadata is not a</span>
<span class="s3">// capturing group, because it should not ever be used in version</span>
<span class="s3">// comparison.</span>

<span class="s2">var </span><span class="s0">FULL </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s2">var </span><span class="s0">FULLPLAIN </span><span class="s1">= </span><span class="s4">'v?' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">MAINVERSION</span><span class="s1">] +</span>
                <span class="s0">src</span><span class="s1">[</span><span class="s0">PRERELEASE</span><span class="s1">] + </span><span class="s4">'?' </span><span class="s1">+</span>
                <span class="s0">src</span><span class="s1">[</span><span class="s0">BUILD</span><span class="s1">] + </span><span class="s4">'?'</span>

<span class="s0">src</span><span class="s1">[</span><span class="s0">FULL</span><span class="s1">] = </span><span class="s4">'^' </span><span class="s1">+ </span><span class="s0">FULLPLAIN </span><span class="s1">+ </span><span class="s4">'$'</span>

<span class="s3">// like full, but allows v1.2.3 and =1.2.3, which people do sometimes.</span>
<span class="s3">// also, 1.0.0alpha1 (prerelease without the hyphen) which is pretty</span>
<span class="s3">// common in the npm registry.</span>
<span class="s2">var </span><span class="s0">LOOSEPLAIN </span><span class="s1">= </span><span class="s4">'[v=</span><span class="s2">\\</span><span class="s4">s]*' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">MAINVERSIONLOOSE</span><span class="s1">] +</span>
                 <span class="s0">src</span><span class="s1">[</span><span class="s0">PRERELEASELOOSE</span><span class="s1">] + </span><span class="s4">'?' </span><span class="s1">+</span>
                 <span class="s0">src</span><span class="s1">[</span><span class="s0">BUILD</span><span class="s1">] + </span><span class="s4">'?'</span>

<span class="s2">var </span><span class="s0">LOOSE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">LOOSE</span><span class="s1">] = </span><span class="s4">'^' </span><span class="s1">+ </span><span class="s0">LOOSEPLAIN </span><span class="s1">+ </span><span class="s4">'$'</span>

<span class="s2">var </span><span class="s0">GTLT </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">GTLT</span><span class="s1">] = </span><span class="s4">'((?:&lt;|&gt;)?=?)'</span>

<span class="s3">// Something like &quot;2.*&quot; or &quot;1.2.x&quot;.</span>
<span class="s3">// Note that &quot;x.x&quot; is a valid xRange identifer, meaning &quot;any version&quot;</span>
<span class="s3">// Only the first item is strictly required.</span>
<span class="s2">var </span><span class="s0">XRANGEIDENTIFIERLOOSE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEIDENTIFIERLOOSE</span><span class="s1">] = </span><span class="s0">src</span><span class="s1">[</span><span class="s0">NUMERICIDENTIFIERLOOSE</span><span class="s1">] + </span><span class="s4">'|x|X|</span><span class="s2">\\</span><span class="s4">*'</span>
<span class="s2">var </span><span class="s0">XRANGEIDENTIFIER </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEIDENTIFIER</span><span class="s1">] = </span><span class="s0">src</span><span class="s1">[</span><span class="s0">NUMERICIDENTIFIER</span><span class="s1">] + </span><span class="s4">'|x|X|</span><span class="s2">\\</span><span class="s4">*'</span>

<span class="s2">var </span><span class="s0">XRANGEPLAIN </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEPLAIN</span><span class="s1">] = </span><span class="s4">'[v=</span><span class="s2">\\</span><span class="s4">s]*(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEIDENTIFIER</span><span class="s1">] + </span><span class="s4">')' </span><span class="s1">+</span>
                   <span class="s4">'(?:</span><span class="s2">\\</span><span class="s4">.(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEIDENTIFIER</span><span class="s1">] + </span><span class="s4">')' </span><span class="s1">+</span>
                   <span class="s4">'(?:</span><span class="s2">\\</span><span class="s4">.(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEIDENTIFIER</span><span class="s1">] + </span><span class="s4">')' </span><span class="s1">+</span>
                   <span class="s4">'(?:' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">PRERELEASE</span><span class="s1">] + </span><span class="s4">')?' </span><span class="s1">+</span>
                   <span class="s0">src</span><span class="s1">[</span><span class="s0">BUILD</span><span class="s1">] + </span><span class="s4">'?' </span><span class="s1">+</span>
                   <span class="s4">')?)?'</span>

<span class="s2">var </span><span class="s0">XRANGEPLAINLOOSE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEPLAINLOOSE</span><span class="s1">] = </span><span class="s4">'[v=</span><span class="s2">\\</span><span class="s4">s]*(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEIDENTIFIERLOOSE</span><span class="s1">] + </span><span class="s4">')' </span><span class="s1">+</span>
                        <span class="s4">'(?:</span><span class="s2">\\</span><span class="s4">.(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEIDENTIFIERLOOSE</span><span class="s1">] + </span><span class="s4">')' </span><span class="s1">+</span>
                        <span class="s4">'(?:</span><span class="s2">\\</span><span class="s4">.(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEIDENTIFIERLOOSE</span><span class="s1">] + </span><span class="s4">')' </span><span class="s1">+</span>
                        <span class="s4">'(?:' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">PRERELEASELOOSE</span><span class="s1">] + </span><span class="s4">')?' </span><span class="s1">+</span>
                        <span class="s0">src</span><span class="s1">[</span><span class="s0">BUILD</span><span class="s1">] + </span><span class="s4">'?' </span><span class="s1">+</span>
                        <span class="s4">')?)?'</span>

<span class="s2">var </span><span class="s0">XRANGE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGE</span><span class="s1">] = </span><span class="s4">'^' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">GTLT</span><span class="s1">] + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">s*' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEPLAIN</span><span class="s1">] + </span><span class="s4">'$'</span>
<span class="s2">var </span><span class="s0">XRANGELOOSE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGELOOSE</span><span class="s1">] = </span><span class="s4">'^' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">GTLT</span><span class="s1">] + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">s*' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEPLAINLOOSE</span><span class="s1">] + </span><span class="s4">'$'</span>

<span class="s3">// Coercion.</span>
<span class="s3">// Extract anything that could conceivably be a part of a valid semver</span>
<span class="s2">var </span><span class="s0">COERCE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">COERCE</span><span class="s1">] = </span><span class="s4">'(?:^|[^</span><span class="s2">\\</span><span class="s4">d])' </span><span class="s1">+</span>
              <span class="s4">'(</span><span class="s2">\\</span><span class="s4">d{1,' </span><span class="s1">+ </span><span class="s0">MAX_SAFE_COMPONENT_LENGTH </span><span class="s1">+ </span><span class="s4">'})' </span><span class="s1">+</span>
              <span class="s4">'(?:</span><span class="s2">\\</span><span class="s4">.(</span><span class="s2">\\</span><span class="s4">d{1,' </span><span class="s1">+ </span><span class="s0">MAX_SAFE_COMPONENT_LENGTH </span><span class="s1">+ </span><span class="s4">'}))?' </span><span class="s1">+</span>
              <span class="s4">'(?:</span><span class="s2">\\</span><span class="s4">.(</span><span class="s2">\\</span><span class="s4">d{1,' </span><span class="s1">+ </span><span class="s0">MAX_SAFE_COMPONENT_LENGTH </span><span class="s1">+ </span><span class="s4">'}))?' </span><span class="s1">+</span>
              <span class="s4">'(?:$|[^</span><span class="s2">\\</span><span class="s4">d])'</span>

<span class="s3">// Tilde ranges.</span>
<span class="s3">// Meaning is &quot;reasonably at or greater than&quot;</span>
<span class="s2">var </span><span class="s0">LONETILDE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">LONETILDE</span><span class="s1">] = </span><span class="s4">'(?:~&gt;?)'</span>

<span class="s2">var </span><span class="s0">TILDETRIM </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">TILDETRIM</span><span class="s1">] = </span><span class="s4">'(</span><span class="s2">\\</span><span class="s4">s*)' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">LONETILDE</span><span class="s1">] + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">s+'</span>
<span class="s0">re</span><span class="s1">[</span><span class="s0">TILDETRIM</span><span class="s1">] = </span><span class="s2">new </span><span class="s0">RegExp</span><span class="s1">(</span><span class="s0">src</span><span class="s1">[</span><span class="s0">TILDETRIM</span><span class="s1">], </span><span class="s4">'g'</span><span class="s1">)</span>
<span class="s0">safeRe</span><span class="s1">[</span><span class="s0">TILDETRIM</span><span class="s1">] = </span><span class="s2">new </span><span class="s0">RegExp</span><span class="s1">(</span><span class="s0">makeSafeRe</span><span class="s1">(</span><span class="s0">src</span><span class="s1">[</span><span class="s0">TILDETRIM</span><span class="s1">]), </span><span class="s4">'g'</span><span class="s1">)</span>
<span class="s2">var </span><span class="s0">tildeTrimReplace </span><span class="s1">= </span><span class="s4">'$1~'</span>

<span class="s2">var </span><span class="s0">TILDE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">TILDE</span><span class="s1">] = </span><span class="s4">'^' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">LONETILDE</span><span class="s1">] + </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEPLAIN</span><span class="s1">] + </span><span class="s4">'$'</span>
<span class="s2">var </span><span class="s0">TILDELOOSE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">TILDELOOSE</span><span class="s1">] = </span><span class="s4">'^' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">LONETILDE</span><span class="s1">] + </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEPLAINLOOSE</span><span class="s1">] + </span><span class="s4">'$'</span>

<span class="s3">// Caret ranges.</span>
<span class="s3">// Meaning is &quot;at least and backwards compatible with&quot;</span>
<span class="s2">var </span><span class="s0">LONECARET </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">LONECARET</span><span class="s1">] = </span><span class="s4">'(?:</span><span class="s2">\\</span><span class="s4">^)'</span>

<span class="s2">var </span><span class="s0">CARETTRIM </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">CARETTRIM</span><span class="s1">] = </span><span class="s4">'(</span><span class="s2">\\</span><span class="s4">s*)' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">LONECARET</span><span class="s1">] + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">s+'</span>
<span class="s0">re</span><span class="s1">[</span><span class="s0">CARETTRIM</span><span class="s1">] = </span><span class="s2">new </span><span class="s0">RegExp</span><span class="s1">(</span><span class="s0">src</span><span class="s1">[</span><span class="s0">CARETTRIM</span><span class="s1">], </span><span class="s4">'g'</span><span class="s1">)</span>
<span class="s0">safeRe</span><span class="s1">[</span><span class="s0">CARETTRIM</span><span class="s1">] = </span><span class="s2">new </span><span class="s0">RegExp</span><span class="s1">(</span><span class="s0">makeSafeRe</span><span class="s1">(</span><span class="s0">src</span><span class="s1">[</span><span class="s0">CARETTRIM</span><span class="s1">]), </span><span class="s4">'g'</span><span class="s1">)</span>
<span class="s2">var </span><span class="s0">caretTrimReplace </span><span class="s1">= </span><span class="s4">'$1^'</span>

<span class="s2">var </span><span class="s0">CARET </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">CARET</span><span class="s1">] = </span><span class="s4">'^' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">LONECARET</span><span class="s1">] + </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEPLAIN</span><span class="s1">] + </span><span class="s4">'$'</span>
<span class="s2">var </span><span class="s0">CARETLOOSE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">CARETLOOSE</span><span class="s1">] = </span><span class="s4">'^' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">LONECARET</span><span class="s1">] + </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEPLAINLOOSE</span><span class="s1">] + </span><span class="s4">'$'</span>

<span class="s3">// A simple gt/lt/eq thing, or just &quot;&quot; to indicate &quot;any version&quot;</span>
<span class="s2">var </span><span class="s0">COMPARATORLOOSE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">COMPARATORLOOSE</span><span class="s1">] = </span><span class="s4">'^' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">GTLT</span><span class="s1">] + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">s*(' </span><span class="s1">+ </span><span class="s0">LOOSEPLAIN </span><span class="s1">+ </span><span class="s4">')$|^$'</span>
<span class="s2">var </span><span class="s0">COMPARATOR </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">COMPARATOR</span><span class="s1">] = </span><span class="s4">'^' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">GTLT</span><span class="s1">] + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">s*(' </span><span class="s1">+ </span><span class="s0">FULLPLAIN </span><span class="s1">+ </span><span class="s4">')$|^$'</span>

<span class="s3">// An expression to strip any whitespace between the gtlt and the thing</span>
<span class="s3">// it modifies, so that `&gt; 1.2.3` ==&gt; `&gt;1.2.3`</span>
<span class="s2">var </span><span class="s0">COMPARATORTRIM </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">COMPARATORTRIM</span><span class="s1">] = </span><span class="s4">'(</span><span class="s2">\\</span><span class="s4">s*)' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">GTLT</span><span class="s1">] +</span>
                      <span class="s4">'</span><span class="s2">\\</span><span class="s4">s*(' </span><span class="s1">+ </span><span class="s0">LOOSEPLAIN </span><span class="s1">+ </span><span class="s4">'|' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEPLAIN</span><span class="s1">] + </span><span class="s4">')'</span>

<span class="s3">// this one has to use the /g flag</span>
<span class="s0">re</span><span class="s1">[</span><span class="s0">COMPARATORTRIM</span><span class="s1">] = </span><span class="s2">new </span><span class="s0">RegExp</span><span class="s1">(</span><span class="s0">src</span><span class="s1">[</span><span class="s0">COMPARATORTRIM</span><span class="s1">], </span><span class="s4">'g'</span><span class="s1">)</span>
<span class="s0">safeRe</span><span class="s1">[</span><span class="s0">COMPARATORTRIM</span><span class="s1">] = </span><span class="s2">new </span><span class="s0">RegExp</span><span class="s1">(</span><span class="s0">makeSafeRe</span><span class="s1">(</span><span class="s0">src</span><span class="s1">[</span><span class="s0">COMPARATORTRIM</span><span class="s1">]), </span><span class="s4">'g'</span><span class="s1">)</span>
<span class="s2">var </span><span class="s0">comparatorTrimReplace </span><span class="s1">= </span><span class="s4">'$1$2$3'</span>

<span class="s3">// Something like `1.2.3 - 1.2.4`</span>
<span class="s3">// Note that these all use the loose form, because they'll be</span>
<span class="s3">// checked against either the strict or loose comparator form</span>
<span class="s3">// later.</span>
<span class="s2">var </span><span class="s0">HYPHENRANGE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">HYPHENRANGE</span><span class="s1">] = </span><span class="s4">'^</span><span class="s2">\\</span><span class="s4">s*(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEPLAIN</span><span class="s1">] + </span><span class="s4">')' </span><span class="s1">+</span>
                   <span class="s4">'</span><span class="s2">\\</span><span class="s4">s+-</span><span class="s2">\\</span><span class="s4">s+' </span><span class="s1">+</span>
                   <span class="s4">'(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEPLAIN</span><span class="s1">] + </span><span class="s4">')' </span><span class="s1">+</span>
                   <span class="s4">'</span><span class="s2">\\</span><span class="s4">s*$'</span>

<span class="s2">var </span><span class="s0">HYPHENRANGELOOSE </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">HYPHENRANGELOOSE</span><span class="s1">] = </span><span class="s4">'^</span><span class="s2">\\</span><span class="s4">s*(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEPLAINLOOSE</span><span class="s1">] + </span><span class="s4">')' </span><span class="s1">+</span>
                        <span class="s4">'</span><span class="s2">\\</span><span class="s4">s+-</span><span class="s2">\\</span><span class="s4">s+' </span><span class="s1">+</span>
                        <span class="s4">'(' </span><span class="s1">+ </span><span class="s0">src</span><span class="s1">[</span><span class="s0">XRANGEPLAINLOOSE</span><span class="s1">] + </span><span class="s4">')' </span><span class="s1">+</span>
                        <span class="s4">'</span><span class="s2">\\</span><span class="s4">s*$'</span>

<span class="s3">// Star ranges basically just allow anything at all.</span>
<span class="s2">var </span><span class="s0">STAR </span><span class="s1">= </span><span class="s0">R</span><span class="s1">++</span>
<span class="s0">src</span><span class="s1">[</span><span class="s0">STAR</span><span class="s1">] = </span><span class="s4">'(&lt;|&gt;)?=?</span><span class="s2">\\</span><span class="s4">s*</span><span class="s2">\\</span><span class="s4">*'</span>

<span class="s3">// Compile to actual regexp objects.</span>
<span class="s3">// All are flag-free, unless they were created above with a flag.</span>
<span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s0">i </span><span class="s1">= </span><span class="s6">0</span><span class="s1">; </span><span class="s0">i </span><span class="s1">&lt; </span><span class="s0">R</span><span class="s1">; </span><span class="s0">i</span><span class="s1">++) {</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s0">i</span><span class="s1">, </span><span class="s0">src</span><span class="s1">[</span><span class="s0">i</span><span class="s1">])</span>
  <span class="s2">if </span><span class="s1">(!</span><span class="s0">re</span><span class="s1">[</span><span class="s0">i</span><span class="s1">]) {</span>
    <span class="s0">re</span><span class="s1">[</span><span class="s0">i</span><span class="s1">] = </span><span class="s2">new </span><span class="s0">RegExp</span><span class="s1">(</span><span class="s0">src</span><span class="s1">[</span><span class="s0">i</span><span class="s1">])</span>

    <span class="s3">// Replace all greedy whitespace to prevent regex dos issues. These regex are</span>
    <span class="s3">// used internally via the safeRe object since all inputs in this library get</span>
    <span class="s3">// normalized first to trim and collapse all extra whitespace. The original</span>
    <span class="s3">// regexes are exported for userland consumption and lower level usage. A</span>
    <span class="s3">// future breaking change could export the safer regex only with a note that</span>
    <span class="s3">// all input should have extra whitespace removed.</span>
    <span class="s0">safeRe</span><span class="s1">[</span><span class="s0">i</span><span class="s1">] = </span><span class="s2">new </span><span class="s0">RegExp</span><span class="s1">(</span><span class="s0">makeSafeRe</span><span class="s1">(</span><span class="s0">src</span><span class="s1">[</span><span class="s0">i</span><span class="s1">]))</span>
  <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">parse </span><span class="s1">= </span><span class="s0">parse</span>
<span class="s2">function </span><span class="s0">parse </span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">if </span><span class="s1">(!</span><span class="s0">options </span><span class="s1">|| </span><span class="s2">typeof </span><span class="s0">options </span><span class="s1">!== </span><span class="s4">'object'</span><span class="s1">) {</span>
    <span class="s0">options </span><span class="s1">= {</span>
      <span class="s0">loose</span><span class="s1">: !!</span><span class="s0">options</span><span class="s1">,</span>
      <span class="s0">includePrerelease</span><span class="s1">: </span><span class="s2">false</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s0">version </span><span class="s2">instanceof </span><span class="s0">SemVer</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s0">version</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s0">version </span><span class="s1">!== </span><span class="s4">'string'</span><span class="s1">) {</span>
    <span class="s2">return null</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s0">version</span><span class="s1">.</span><span class="s0">length </span><span class="s1">&gt; </span><span class="s0">MAX_LENGTH</span><span class="s1">) {</span>
    <span class="s2">return null</span>
  <span class="s1">}</span>

  <span class="s2">var </span><span class="s0">r </span><span class="s1">= </span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose </span><span class="s1">? </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">LOOSE</span><span class="s1">] : </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">FULL</span><span class="s1">]</span>
  <span class="s2">if </span><span class="s1">(!</span><span class="s0">r</span><span class="s1">.</span><span class="s0">test</span><span class="s1">(</span><span class="s0">version</span><span class="s1">)) {</span>
    <span class="s2">return null</span>
  <span class="s1">}</span>

  <span class="s2">try </span><span class="s1">{</span>
    <span class="s2">return new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">} </span><span class="s2">catch </span><span class="s1">(</span><span class="s0">er</span><span class="s1">) {</span>
    <span class="s2">return null</span>
  <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">valid </span><span class="s1">= </span><span class="s0">valid</span>
<span class="s2">function </span><span class="s0">valid </span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">var </span><span class="s0">v </span><span class="s1">= </span><span class="s0">parse</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s2">return </span><span class="s0">v </span><span class="s1">? </span><span class="s0">v</span><span class="s1">.</span><span class="s0">version </span><span class="s1">: </span><span class="s2">null</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">clean </span><span class="s1">= </span><span class="s0">clean</span>
<span class="s2">function </span><span class="s0">clean </span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">var </span><span class="s0">s </span><span class="s1">= </span><span class="s0">parse</span><span class="s1">(</span><span class="s0">version</span><span class="s1">.</span><span class="s0">trim</span><span class="s1">().</span><span class="s0">replace</span><span class="s1">(</span><span class="s5">/^[=v]+/</span><span class="s1">, </span><span class="s4">''</span><span class="s1">), </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s2">return </span><span class="s0">s </span><span class="s1">? </span><span class="s0">s</span><span class="s1">.</span><span class="s0">version </span><span class="s1">: </span><span class="s2">null</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">SemVer </span><span class="s1">= </span><span class="s0">SemVer</span>

<span class="s2">function </span><span class="s0">SemVer </span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">if </span><span class="s1">(!</span><span class="s0">options </span><span class="s1">|| </span><span class="s2">typeof </span><span class="s0">options </span><span class="s1">!== </span><span class="s4">'object'</span><span class="s1">) {</span>
    <span class="s0">options </span><span class="s1">= {</span>
      <span class="s0">loose</span><span class="s1">: !!</span><span class="s0">options</span><span class="s1">,</span>
      <span class="s0">includePrerelease</span><span class="s1">: </span><span class="s2">false</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
  <span class="s2">if </span><span class="s1">(</span><span class="s0">version </span><span class="s2">instanceof </span><span class="s0">SemVer</span><span class="s1">) {</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s0">version</span><span class="s1">.</span><span class="s0">loose </span><span class="s1">=== </span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose</span><span class="s1">) {</span>
      <span class="s2">return </span><span class="s0">version</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s0">version </span><span class="s1">= </span><span class="s0">version</span><span class="s1">.</span><span class="s0">version</span>
    <span class="s1">}</span>
  <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s0">version </span><span class="s1">!== </span><span class="s4">'string'</span><span class="s1">) {</span>
    <span class="s2">throw new </span><span class="s0">TypeError</span><span class="s1">(</span><span class="s4">'Invalid Version: ' </span><span class="s1">+ </span><span class="s0">version</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s0">version</span><span class="s1">.</span><span class="s0">length </span><span class="s1">&gt; </span><span class="s0">MAX_LENGTH</span><span class="s1">) {</span>
    <span class="s2">throw new </span><span class="s0">TypeError</span><span class="s1">(</span><span class="s4">'version is longer than ' </span><span class="s1">+ </span><span class="s0">MAX_LENGTH </span><span class="s1">+ </span><span class="s4">' characters'</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(!(</span><span class="s2">this instanceof </span><span class="s0">SemVer</span><span class="s1">)) {</span>
    <span class="s2">return new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'SemVer'</span><span class="s1">, </span><span class="s0">version</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">options </span><span class="s1">= </span><span class="s0">options</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">loose </span><span class="s1">= !!</span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose</span>

  <span class="s2">var </span><span class="s0">m </span><span class="s1">= </span><span class="s0">version</span><span class="s1">.</span><span class="s0">trim</span><span class="s1">().</span><span class="s0">match</span><span class="s1">(</span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose </span><span class="s1">? </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">LOOSE</span><span class="s1">] : </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">FULL</span><span class="s1">])</span>

  <span class="s2">if </span><span class="s1">(!</span><span class="s0">m</span><span class="s1">) {</span>
    <span class="s2">throw new </span><span class="s0">TypeError</span><span class="s1">(</span><span class="s4">'Invalid Version: ' </span><span class="s1">+ </span><span class="s0">version</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">this</span><span class="s1">.</span><span class="s0">raw </span><span class="s1">= </span><span class="s0">version</span>

  <span class="s3">// these are actually numbers</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">major </span><span class="s1">= +</span><span class="s0">m</span><span class="s1">[</span><span class="s6">1</span><span class="s1">]</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">minor </span><span class="s1">= +</span><span class="s0">m</span><span class="s1">[</span><span class="s6">2</span><span class="s1">]</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">patch </span><span class="s1">= +</span><span class="s0">m</span><span class="s1">[</span><span class="s6">3</span><span class="s1">]</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">major </span><span class="s1">&gt; </span><span class="s0">MAX_SAFE_INTEGER </span><span class="s1">|| </span><span class="s2">this</span><span class="s1">.</span><span class="s0">major </span><span class="s1">&lt; </span><span class="s6">0</span><span class="s1">) {</span>
    <span class="s2">throw new </span><span class="s0">TypeError</span><span class="s1">(</span><span class="s4">'Invalid major version'</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">minor </span><span class="s1">&gt; </span><span class="s0">MAX_SAFE_INTEGER </span><span class="s1">|| </span><span class="s2">this</span><span class="s1">.</span><span class="s0">minor </span><span class="s1">&lt; </span><span class="s6">0</span><span class="s1">) {</span>
    <span class="s2">throw new </span><span class="s0">TypeError</span><span class="s1">(</span><span class="s4">'Invalid minor version'</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">patch </span><span class="s1">&gt; </span><span class="s0">MAX_SAFE_INTEGER </span><span class="s1">|| </span><span class="s2">this</span><span class="s1">.</span><span class="s0">patch </span><span class="s1">&lt; </span><span class="s6">0</span><span class="s1">) {</span>
    <span class="s2">throw new </span><span class="s0">TypeError</span><span class="s1">(</span><span class="s4">'Invalid patch version'</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s3">// numberify any prerelease numeric ids</span>
  <span class="s2">if </span><span class="s1">(!</span><span class="s0">m</span><span class="s1">[</span><span class="s6">4</span><span class="s1">]) {</span>
    <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease </span><span class="s1">= []</span>
  <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
    <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease </span><span class="s1">= </span><span class="s0">m</span><span class="s1">[</span><span class="s6">4</span><span class="s1">].</span><span class="s0">split</span><span class="s1">(</span><span class="s4">'.'</span><span class="s1">).</span><span class="s0">map</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">id</span><span class="s1">) {</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s5">/^[0-9]+$/</span><span class="s1">.</span><span class="s0">test</span><span class="s1">(</span><span class="s0">id</span><span class="s1">)) {</span>
        <span class="s2">var </span><span class="s0">num </span><span class="s1">= +</span><span class="s0">id</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s0">num </span><span class="s1">&gt;= </span><span class="s6">0 </span><span class="s1">&amp;&amp; </span><span class="s0">num </span><span class="s1">&lt; </span><span class="s0">MAX_SAFE_INTEGER</span><span class="s1">) {</span>
          <span class="s2">return </span><span class="s0">num</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
      <span class="s2">return </span><span class="s0">id</span>
    <span class="s1">})</span>
  <span class="s1">}</span>

  <span class="s2">this</span><span class="s1">.</span><span class="s0">build </span><span class="s1">= </span><span class="s0">m</span><span class="s1">[</span><span class="s6">5</span><span class="s1">] ? </span><span class="s0">m</span><span class="s1">[</span><span class="s6">5</span><span class="s1">].</span><span class="s0">split</span><span class="s1">(</span><span class="s4">'.'</span><span class="s1">) : []</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">format</span><span class="s1">()</span>
<span class="s1">}</span>

<span class="s0">SemVer</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">format </span><span class="s1">= </span><span class="s2">function </span><span class="s1">() {</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">version </span><span class="s1">= </span><span class="s2">this</span><span class="s1">.</span><span class="s0">major </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s2">this</span><span class="s1">.</span><span class="s0">minor </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s2">this</span><span class="s1">.</span><span class="s0">patch</span>
  <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length</span><span class="s1">) {</span>
    <span class="s2">this</span><span class="s1">.</span><span class="s0">version </span><span class="s1">+= </span><span class="s4">'-' </span><span class="s1">+ </span><span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">join</span><span class="s1">(</span><span class="s4">'.'</span><span class="s1">)</span>
  <span class="s1">}</span>
  <span class="s2">return this</span><span class="s1">.</span><span class="s0">version</span>
<span class="s1">}</span>

<span class="s0">SemVer</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">toString </span><span class="s1">= </span><span class="s2">function </span><span class="s1">() {</span>
  <span class="s2">return this</span><span class="s1">.</span><span class="s0">version</span>
<span class="s1">}</span>

<span class="s0">SemVer</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">compare </span><span class="s1">= </span><span class="s2">function </span><span class="s1">(</span><span class="s0">other</span><span class="s1">) {</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'SemVer.compare'</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">version</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">, </span><span class="s0">other</span><span class="s1">)</span>
  <span class="s2">if </span><span class="s1">(!(</span><span class="s0">other </span><span class="s2">instanceof </span><span class="s0">SemVer</span><span class="s1">)) {</span>
    <span class="s0">other </span><span class="s1">= </span><span class="s2">new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">other</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">return this</span><span class="s1">.</span><span class="s0">compareMain</span><span class="s1">(</span><span class="s0">other</span><span class="s1">) || </span><span class="s2">this</span><span class="s1">.</span><span class="s0">comparePre</span><span class="s1">(</span><span class="s0">other</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s0">SemVer</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">compareMain </span><span class="s1">= </span><span class="s2">function </span><span class="s1">(</span><span class="s0">other</span><span class="s1">) {</span>
  <span class="s2">if </span><span class="s1">(!(</span><span class="s0">other </span><span class="s2">instanceof </span><span class="s0">SemVer</span><span class="s1">)) {</span>
    <span class="s0">other </span><span class="s1">= </span><span class="s2">new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">other</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">return </span><span class="s0">compareIdentifiers</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">major</span><span class="s1">, </span><span class="s0">other</span><span class="s1">.</span><span class="s0">major</span><span class="s1">) ||</span>
         <span class="s0">compareIdentifiers</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">minor</span><span class="s1">, </span><span class="s0">other</span><span class="s1">.</span><span class="s0">minor</span><span class="s1">) ||</span>
         <span class="s0">compareIdentifiers</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">patch</span><span class="s1">, </span><span class="s0">other</span><span class="s1">.</span><span class="s0">patch</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s0">SemVer</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">comparePre </span><span class="s1">= </span><span class="s2">function </span><span class="s1">(</span><span class="s0">other</span><span class="s1">) {</span>
  <span class="s2">if </span><span class="s1">(!(</span><span class="s0">other </span><span class="s2">instanceof </span><span class="s0">SemVer</span><span class="s1">)) {</span>
    <span class="s0">other </span><span class="s1">= </span><span class="s2">new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">other</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s3">// NOT having a prerelease is &gt; having one</span>
  <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">&amp;&amp; !</span><span class="s0">other</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s1">-</span><span class="s6">1</span>
  <span class="s1">} </span><span class="s2">else if </span><span class="s1">(!</span><span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">&amp;&amp; </span><span class="s0">other</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s6">1</span>
  <span class="s1">} </span><span class="s2">else if </span><span class="s1">(!</span><span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">&amp;&amp; !</span><span class="s0">other</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s6">0</span>
  <span class="s1">}</span>

  <span class="s2">var </span><span class="s0">i </span><span class="s1">= </span><span class="s6">0</span>
  <span class="s2">do </span><span class="s1">{</span>
    <span class="s2">var </span><span class="s0">a </span><span class="s1">= </span><span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">[</span><span class="s0">i</span><span class="s1">]</span>
    <span class="s2">var </span><span class="s0">b </span><span class="s1">= </span><span class="s0">other</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">[</span><span class="s0">i</span><span class="s1">]</span>
    <span class="s0">debug</span><span class="s1">(</span><span class="s4">'prerelease compare'</span><span class="s1">, </span><span class="s0">i</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s0">a </span><span class="s1">=== </span><span class="s0">undefined </span><span class="s1">&amp;&amp; </span><span class="s0">b </span><span class="s1">=== </span><span class="s0">undefined</span><span class="s1">) {</span>
      <span class="s2">return </span><span class="s6">0</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">b </span><span class="s1">=== </span><span class="s0">undefined</span><span class="s1">) {</span>
      <span class="s2">return </span><span class="s6">1</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">a </span><span class="s1">=== </span><span class="s0">undefined</span><span class="s1">) {</span>
      <span class="s2">return </span><span class="s1">-</span><span class="s6">1</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">a </span><span class="s1">=== </span><span class="s0">b</span><span class="s1">) {</span>
      <span class="s2">continue</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s2">return </span><span class="s0">compareIdentifiers</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">)</span>
    <span class="s1">}</span>
  <span class="s1">} </span><span class="s2">while </span><span class="s1">(++</span><span class="s0">i</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s3">// preminor will bump the version up to the next minor release, and immediately</span>
<span class="s3">// down to pre-release. premajor and prepatch work the same way.</span>
<span class="s0">SemVer</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">inc </span><span class="s1">= </span><span class="s2">function </span><span class="s1">(</span><span class="s0">release</span><span class="s1">, </span><span class="s0">identifier</span><span class="s1">) {</span>
  <span class="s2">switch </span><span class="s1">(</span><span class="s0">release</span><span class="s1">) {</span>
    <span class="s2">case </span><span class="s4">'premajor'</span><span class="s1">:</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">= </span><span class="s6">0</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">patch </span><span class="s1">= </span><span class="s6">0</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">minor </span><span class="s1">= </span><span class="s6">0</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">major</span><span class="s1">++</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">inc</span><span class="s1">(</span><span class="s4">'pre'</span><span class="s1">, </span><span class="s0">identifier</span><span class="s1">)</span>
      <span class="s2">break</span>
    <span class="s2">case </span><span class="s4">'preminor'</span><span class="s1">:</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">= </span><span class="s6">0</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">patch </span><span class="s1">= </span><span class="s6">0</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">minor</span><span class="s1">++</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">inc</span><span class="s1">(</span><span class="s4">'pre'</span><span class="s1">, </span><span class="s0">identifier</span><span class="s1">)</span>
      <span class="s2">break</span>
    <span class="s2">case </span><span class="s4">'prepatch'</span><span class="s1">:</span>
      <span class="s3">// If this is already a prerelease, it will bump to the next version</span>
      <span class="s3">// drop any prereleases that might already exist, since they are not</span>
      <span class="s3">// relevant at this point.</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">= </span><span class="s6">0</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">inc</span><span class="s1">(</span><span class="s4">'patch'</span><span class="s1">, </span><span class="s0">identifier</span><span class="s1">)</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">inc</span><span class="s1">(</span><span class="s4">'pre'</span><span class="s1">, </span><span class="s0">identifier</span><span class="s1">)</span>
      <span class="s2">break</span>
    <span class="s3">// If the input is a non-prerelease version, this acts the same as</span>
    <span class="s3">// prepatch.</span>
    <span class="s2">case </span><span class="s4">'prerelease'</span><span class="s1">:</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">=== </span><span class="s6">0</span><span class="s1">) {</span>
        <span class="s2">this</span><span class="s1">.</span><span class="s0">inc</span><span class="s1">(</span><span class="s4">'patch'</span><span class="s1">, </span><span class="s0">identifier</span><span class="s1">)</span>
      <span class="s1">}</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">inc</span><span class="s1">(</span><span class="s4">'pre'</span><span class="s1">, </span><span class="s0">identifier</span><span class="s1">)</span>
      <span class="s2">break</span>

    <span class="s2">case </span><span class="s4">'major'</span><span class="s1">:</span>
      <span class="s3">// If this is a pre-major version, bump up to the same major version.</span>
      <span class="s3">// Otherwise increment major.</span>
      <span class="s3">// 1.0.0-5 bumps to 1.0.0</span>
      <span class="s3">// 1.1.0 bumps to 2.0.0</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">minor </span><span class="s1">!== </span><span class="s6">0 </span><span class="s1">||</span>
          <span class="s2">this</span><span class="s1">.</span><span class="s0">patch </span><span class="s1">!== </span><span class="s6">0 </span><span class="s1">||</span>
          <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">=== </span><span class="s6">0</span><span class="s1">) {</span>
        <span class="s2">this</span><span class="s1">.</span><span class="s0">major</span><span class="s1">++</span>
      <span class="s1">}</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">minor </span><span class="s1">= </span><span class="s6">0</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">patch </span><span class="s1">= </span><span class="s6">0</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease </span><span class="s1">= []</span>
      <span class="s2">break</span>
    <span class="s2">case </span><span class="s4">'minor'</span><span class="s1">:</span>
      <span class="s3">// If this is a pre-minor version, bump up to the same minor version.</span>
      <span class="s3">// Otherwise increment minor.</span>
      <span class="s3">// 1.2.0-5 bumps to 1.2.0</span>
      <span class="s3">// 1.2.1 bumps to 1.3.0</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">patch </span><span class="s1">!== </span><span class="s6">0 </span><span class="s1">|| </span><span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">=== </span><span class="s6">0</span><span class="s1">) {</span>
        <span class="s2">this</span><span class="s1">.</span><span class="s0">minor</span><span class="s1">++</span>
      <span class="s1">}</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">patch </span><span class="s1">= </span><span class="s6">0</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease </span><span class="s1">= []</span>
      <span class="s2">break</span>
    <span class="s2">case </span><span class="s4">'patch'</span><span class="s1">:</span>
      <span class="s3">// If this is not a pre-release version, it will increment the patch.</span>
      <span class="s3">// If it is a pre-release it will bump up to the same patch version.</span>
      <span class="s3">// 1.2.0-5 patches to 1.2.0</span>
      <span class="s3">// 1.2.0 patches to 1.2.1</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">=== </span><span class="s6">0</span><span class="s1">) {</span>
        <span class="s2">this</span><span class="s1">.</span><span class="s0">patch</span><span class="s1">++</span>
      <span class="s1">}</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease </span><span class="s1">= []</span>
      <span class="s2">break</span>
    <span class="s3">// This probably shouldn't be used publicly.</span>
    <span class="s3">// 1.0.0 &quot;pre&quot; would become 1.0.0-0 which is the wrong direction.</span>
    <span class="s2">case </span><span class="s4">'pre'</span><span class="s1">:</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">=== </span><span class="s6">0</span><span class="s1">) {</span>
        <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease </span><span class="s1">= [</span><span class="s6">0</span><span class="s1">]</span>
      <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s2">var </span><span class="s0">i </span><span class="s1">= </span><span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length</span>
        <span class="s2">while </span><span class="s1">(--</span><span class="s0">i </span><span class="s1">&gt;= </span><span class="s6">0</span><span class="s1">) {</span>
          <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">[</span><span class="s0">i</span><span class="s1">] === </span><span class="s4">'number'</span><span class="s1">) {</span>
            <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">[</span><span class="s0">i</span><span class="s1">]++</span>
            <span class="s0">i </span><span class="s1">= -</span><span class="s6">2</span>
          <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s0">i </span><span class="s1">=== -</span><span class="s6">1</span><span class="s1">) {</span>
          <span class="s3">// didn't increment anything</span>
          <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">push</span><span class="s1">(</span><span class="s6">0</span><span class="s1">)</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s0">identifier</span><span class="s1">) {</span>
        <span class="s3">// 1.2.0-beta.1 bumps to 1.2.0-beta.2,</span>
        <span class="s3">// 1.2.0-beta.fooblz or 1.2.0-beta bumps to 1.2.0-beta.0</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">[</span><span class="s6">0</span><span class="s1">] === </span><span class="s0">identifier</span><span class="s1">) {</span>
          <span class="s2">if </span><span class="s1">(</span><span class="s0">isNaN</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">[</span><span class="s6">1</span><span class="s1">])) {</span>
            <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease </span><span class="s1">= [</span><span class="s0">identifier</span><span class="s1">, </span><span class="s6">0</span><span class="s1">]</span>
          <span class="s1">}</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
          <span class="s2">this</span><span class="s1">.</span><span class="s0">prerelease </span><span class="s1">= [</span><span class="s0">identifier</span><span class="s1">, </span><span class="s6">0</span><span class="s1">]</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
      <span class="s2">break</span>

    <span class="s2">default</span><span class="s1">:</span>
      <span class="s2">throw new </span><span class="s0">Error</span><span class="s1">(</span><span class="s4">'invalid increment argument: ' </span><span class="s1">+ </span><span class="s0">release</span><span class="s1">)</span>
  <span class="s1">}</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">format</span><span class="s1">()</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">raw </span><span class="s1">= </span><span class="s2">this</span><span class="s1">.</span><span class="s0">version</span>
  <span class="s2">return this</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">inc </span><span class="s1">= </span><span class="s0">inc</span>
<span class="s2">function </span><span class="s0">inc </span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">release</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">, </span><span class="s0">identifier</span><span class="s1">) {</span>
  <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">(</span><span class="s0">loose</span><span class="s1">) === </span><span class="s4">'string'</span><span class="s1">) {</span>
    <span class="s0">identifier </span><span class="s1">= </span><span class="s0">loose</span>
    <span class="s0">loose </span><span class="s1">= </span><span class="s0">undefined</span>
  <span class="s1">}</span>

  <span class="s2">try </span><span class="s1">{</span>
    <span class="s2">return new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">).</span><span class="s0">inc</span><span class="s1">(</span><span class="s0">release</span><span class="s1">, </span><span class="s0">identifier</span><span class="s1">).</span><span class="s0">version</span>
  <span class="s1">} </span><span class="s2">catch </span><span class="s1">(</span><span class="s0">er</span><span class="s1">) {</span>
    <span class="s2">return null</span>
  <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">diff </span><span class="s1">= </span><span class="s0">diff</span>
<span class="s2">function </span><span class="s0">diff </span><span class="s1">(</span><span class="s0">version1</span><span class="s1">, </span><span class="s0">version2</span><span class="s1">) {</span>
  <span class="s2">if </span><span class="s1">(</span><span class="s0">eq</span><span class="s1">(</span><span class="s0">version1</span><span class="s1">, </span><span class="s0">version2</span><span class="s1">)) {</span>
    <span class="s2">return null</span>
  <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
    <span class="s2">var </span><span class="s0">v1 </span><span class="s1">= </span><span class="s0">parse</span><span class="s1">(</span><span class="s0">version1</span><span class="s1">)</span>
    <span class="s2">var </span><span class="s0">v2 </span><span class="s1">= </span><span class="s0">parse</span><span class="s1">(</span><span class="s0">version2</span><span class="s1">)</span>
    <span class="s2">var </span><span class="s0">prefix </span><span class="s1">= </span><span class="s4">''</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s0">v1</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">|| </span><span class="s0">v2</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length</span><span class="s1">) {</span>
      <span class="s0">prefix </span><span class="s1">= </span><span class="s4">'pre'</span>
      <span class="s2">var </span><span class="s0">defaultResult </span><span class="s1">= </span><span class="s4">'prerelease'</span>
    <span class="s1">}</span>
    <span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s0">key </span><span class="s2">in </span><span class="s0">v1</span><span class="s1">) {</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s0">key </span><span class="s1">=== </span><span class="s4">'major' </span><span class="s1">|| </span><span class="s0">key </span><span class="s1">=== </span><span class="s4">'minor' </span><span class="s1">|| </span><span class="s0">key </span><span class="s1">=== </span><span class="s4">'patch'</span><span class="s1">) {</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s0">v1</span><span class="s1">[</span><span class="s0">key</span><span class="s1">] !== </span><span class="s0">v2</span><span class="s1">[</span><span class="s0">key</span><span class="s1">]) {</span>
          <span class="s2">return </span><span class="s0">prefix </span><span class="s1">+ </span><span class="s0">key</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s0">defaultResult </span><span class="s3">// may be undefined</span>
  <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">compareIdentifiers </span><span class="s1">= </span><span class="s0">compareIdentifiers</span>

<span class="s2">var </span><span class="s0">numeric </span><span class="s1">= </span><span class="s5">/^[0-9]+$/</span>
<span class="s2">function </span><span class="s0">compareIdentifiers </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">) {</span>
  <span class="s2">var </span><span class="s0">anum </span><span class="s1">= </span><span class="s0">numeric</span><span class="s1">.</span><span class="s0">test</span><span class="s1">(</span><span class="s0">a</span><span class="s1">)</span>
  <span class="s2">var </span><span class="s0">bnum </span><span class="s1">= </span><span class="s0">numeric</span><span class="s1">.</span><span class="s0">test</span><span class="s1">(</span><span class="s0">b</span><span class="s1">)</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s0">anum </span><span class="s1">&amp;&amp; </span><span class="s0">bnum</span><span class="s1">) {</span>
    <span class="s0">a </span><span class="s1">= +</span><span class="s0">a</span>
    <span class="s0">b </span><span class="s1">= +</span><span class="s0">b</span>
  <span class="s1">}</span>

  <span class="s2">return </span><span class="s0">a </span><span class="s1">=== </span><span class="s0">b </span><span class="s1">? </span><span class="s6">0</span>
    <span class="s1">: (</span><span class="s0">anum </span><span class="s1">&amp;&amp; !</span><span class="s0">bnum</span><span class="s1">) ? -</span><span class="s6">1</span>
    <span class="s1">: (</span><span class="s0">bnum </span><span class="s1">&amp;&amp; !</span><span class="s0">anum</span><span class="s1">) ? </span><span class="s6">1</span>
    <span class="s1">: </span><span class="s0">a </span><span class="s1">&lt; </span><span class="s0">b </span><span class="s1">? -</span><span class="s6">1</span>
    <span class="s1">: </span><span class="s6">1</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">rcompareIdentifiers </span><span class="s1">= </span><span class="s0">rcompareIdentifiers</span>
<span class="s2">function </span><span class="s0">rcompareIdentifiers </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">compareIdentifiers</span><span class="s1">(</span><span class="s0">b</span><span class="s1">, </span><span class="s0">a</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">major </span><span class="s1">= </span><span class="s0">major</span>
<span class="s2">function </span><span class="s0">major </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">return new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">).</span><span class="s0">major</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">minor </span><span class="s1">= </span><span class="s0">minor</span>
<span class="s2">function </span><span class="s0">minor </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">return new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">).</span><span class="s0">minor</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">patch </span><span class="s1">= </span><span class="s0">patch</span>
<span class="s2">function </span><span class="s0">patch </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">return new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">).</span><span class="s0">patch</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">compare </span><span class="s1">= </span><span class="s0">compare</span>
<span class="s2">function </span><span class="s0">compare </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">return new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">).</span><span class="s0">compare</span><span class="s1">(</span><span class="s2">new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">))</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">compareLoose </span><span class="s1">= </span><span class="s0">compareLoose</span>
<span class="s2">function </span><span class="s0">compareLoose </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">compare</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s2">true</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">rcompare </span><span class="s1">= </span><span class="s0">rcompare</span>
<span class="s2">function </span><span class="s0">rcompare </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">compare</span><span class="s1">(</span><span class="s0">b</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">sort </span><span class="s1">= </span><span class="s0">sort</span>
<span class="s2">function </span><span class="s0">sort </span><span class="s1">(</span><span class="s0">list</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">list</span><span class="s1">.</span><span class="s0">sort</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s0">exports</span><span class="s1">.</span><span class="s0">compare</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">)</span>
  <span class="s1">})</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">rsort </span><span class="s1">= </span><span class="s0">rsort</span>
<span class="s2">function </span><span class="s0">rsort </span><span class="s1">(</span><span class="s0">list</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">list</span><span class="s1">.</span><span class="s0">sort</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s0">exports</span><span class="s1">.</span><span class="s0">rcompare</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">)</span>
  <span class="s1">})</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">gt </span><span class="s1">= </span><span class="s0">gt</span>
<span class="s2">function </span><span class="s0">gt </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">compare</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) &gt; </span><span class="s6">0</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">lt </span><span class="s1">= </span><span class="s0">lt</span>
<span class="s2">function </span><span class="s0">lt </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">compare</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) &lt; </span><span class="s6">0</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">eq </span><span class="s1">= </span><span class="s0">eq</span>
<span class="s2">function </span><span class="s0">eq </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">compare</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) === </span><span class="s6">0</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">neq </span><span class="s1">= </span><span class="s0">neq</span>
<span class="s2">function </span><span class="s0">neq </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">compare</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) !== </span><span class="s6">0</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">gte </span><span class="s1">= </span><span class="s0">gte</span>
<span class="s2">function </span><span class="s0">gte </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">compare</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) &gt;= </span><span class="s6">0</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">lte </span><span class="s1">= </span><span class="s0">lte</span>
<span class="s2">function </span><span class="s0">lte </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">compare</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) &lt;= </span><span class="s6">0</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">cmp </span><span class="s1">= </span><span class="s0">cmp</span>
<span class="s2">function </span><span class="s0">cmp </span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">op</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s2">switch </span><span class="s1">(</span><span class="s0">op</span><span class="s1">) {</span>
    <span class="s2">case </span><span class="s4">'==='</span><span class="s1">:</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s0">a </span><span class="s1">=== </span><span class="s4">'object'</span><span class="s1">)</span>
        <span class="s0">a </span><span class="s1">= </span><span class="s0">a</span><span class="s1">.</span><span class="s0">version</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s0">b </span><span class="s1">=== </span><span class="s4">'object'</span><span class="s1">)</span>
        <span class="s0">b </span><span class="s1">= </span><span class="s0">b</span><span class="s1">.</span><span class="s0">version</span>
      <span class="s2">return </span><span class="s0">a </span><span class="s1">=== </span><span class="s0">b</span>

    <span class="s2">case </span><span class="s4">'!=='</span><span class="s1">:</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s0">a </span><span class="s1">=== </span><span class="s4">'object'</span><span class="s1">)</span>
        <span class="s0">a </span><span class="s1">= </span><span class="s0">a</span><span class="s1">.</span><span class="s0">version</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s0">b </span><span class="s1">=== </span><span class="s4">'object'</span><span class="s1">)</span>
        <span class="s0">b </span><span class="s1">= </span><span class="s0">b</span><span class="s1">.</span><span class="s0">version</span>
      <span class="s2">return </span><span class="s0">a </span><span class="s1">!== </span><span class="s0">b</span>

    <span class="s2">case </span><span class="s4">''</span><span class="s1">:</span>
    <span class="s2">case </span><span class="s4">'='</span><span class="s1">:</span>
    <span class="s2">case </span><span class="s4">'=='</span><span class="s1">:</span>
      <span class="s2">return </span><span class="s0">eq</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">)</span>

    <span class="s2">case </span><span class="s4">'!='</span><span class="s1">:</span>
      <span class="s2">return </span><span class="s0">neq</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">)</span>

    <span class="s2">case </span><span class="s4">'&gt;'</span><span class="s1">:</span>
      <span class="s2">return </span><span class="s0">gt</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">)</span>

    <span class="s2">case </span><span class="s4">'&gt;='</span><span class="s1">:</span>
      <span class="s2">return </span><span class="s0">gte</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">)</span>

    <span class="s2">case </span><span class="s4">'&lt;'</span><span class="s1">:</span>
      <span class="s2">return </span><span class="s0">lt</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">)</span>

    <span class="s2">case </span><span class="s4">'&lt;='</span><span class="s1">:</span>
      <span class="s2">return </span><span class="s0">lte</span><span class="s1">(</span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">)</span>

    <span class="s2">default</span><span class="s1">:</span>
      <span class="s2">throw new </span><span class="s0">TypeError</span><span class="s1">(</span><span class="s4">'Invalid operator: ' </span><span class="s1">+ </span><span class="s0">op</span><span class="s1">)</span>
  <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">Comparator </span><span class="s1">= </span><span class="s0">Comparator</span>
<span class="s2">function </span><span class="s0">Comparator </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">if </span><span class="s1">(!</span><span class="s0">options </span><span class="s1">|| </span><span class="s2">typeof </span><span class="s0">options </span><span class="s1">!== </span><span class="s4">'object'</span><span class="s1">) {</span>
    <span class="s0">options </span><span class="s1">= {</span>
      <span class="s0">loose</span><span class="s1">: !!</span><span class="s0">options</span><span class="s1">,</span>
      <span class="s0">includePrerelease</span><span class="s1">: </span><span class="s2">false</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s0">comp </span><span class="s2">instanceof </span><span class="s0">Comparator</span><span class="s1">) {</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">.</span><span class="s0">loose </span><span class="s1">=== !!</span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose</span><span class="s1">) {</span>
      <span class="s2">return </span><span class="s0">comp</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s0">comp </span><span class="s1">= </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">value</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(!(</span><span class="s2">this instanceof </span><span class="s0">Comparator</span><span class="s1">)) {</span>
    <span class="s2">return new </span><span class="s0">Comparator</span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s0">comp </span><span class="s1">= </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">trim</span><span class="s1">().</span><span class="s0">split</span><span class="s1">(</span><span class="s5">/\s+/</span><span class="s1">).</span><span class="s0">join</span><span class="s1">(</span><span class="s4">' '</span><span class="s1">)</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'comparator'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">options </span><span class="s1">= </span><span class="s0">options</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">loose </span><span class="s1">= !!</span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">parse</span><span class="s1">(</span><span class="s0">comp</span><span class="s1">)</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">semver </span><span class="s1">=== </span><span class="s0">ANY</span><span class="s1">) {</span>
    <span class="s2">this</span><span class="s1">.</span><span class="s0">value </span><span class="s1">= </span><span class="s4">''</span>
  <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
    <span class="s2">this</span><span class="s1">.</span><span class="s0">value </span><span class="s1">= </span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">+ </span><span class="s2">this</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">.</span><span class="s0">version</span>
  <span class="s1">}</span>

  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'comp'</span><span class="s1">, </span><span class="s2">this</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s2">var </span><span class="s0">ANY </span><span class="s1">= {}</span>
<span class="s0">Comparator</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">parse </span><span class="s1">= </span><span class="s2">function </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">) {</span>
  <span class="s2">var </span><span class="s0">r </span><span class="s1">= </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose </span><span class="s1">? </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">COMPARATORLOOSE</span><span class="s1">] : </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">COMPARATOR</span><span class="s1">]</span>
  <span class="s2">var </span><span class="s0">m </span><span class="s1">= </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">match</span><span class="s1">(</span><span class="s0">r</span><span class="s1">)</span>

  <span class="s2">if </span><span class="s1">(!</span><span class="s0">m</span><span class="s1">) {</span>
    <span class="s2">throw new </span><span class="s0">TypeError</span><span class="s1">(</span><span class="s4">'Invalid comparator: ' </span><span class="s1">+ </span><span class="s0">comp</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">= </span><span class="s0">m</span><span class="s1">[</span><span class="s6">1</span><span class="s1">]</span>
  <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'='</span><span class="s1">) {</span>
    <span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">= </span><span class="s4">''</span>
  <span class="s1">}</span>

  <span class="s3">// if it literally is just '&gt;' or '' then allow anything.</span>
  <span class="s2">if </span><span class="s1">(!</span><span class="s0">m</span><span class="s1">[</span><span class="s6">2</span><span class="s1">]) {</span>
    <span class="s2">this</span><span class="s1">.</span><span class="s0">semver </span><span class="s1">= </span><span class="s0">ANY</span>
  <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
    <span class="s2">this</span><span class="s1">.</span><span class="s0">semver </span><span class="s1">= </span><span class="s2">new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">m</span><span class="s1">[</span><span class="s6">2</span><span class="s1">], </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose</span><span class="s1">)</span>
  <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">Comparator</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">toString </span><span class="s1">= </span><span class="s2">function </span><span class="s1">() {</span>
  <span class="s2">return this</span><span class="s1">.</span><span class="s0">value</span>
<span class="s1">}</span>

<span class="s0">Comparator</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">test </span><span class="s1">= </span><span class="s2">function </span><span class="s1">(</span><span class="s0">version</span><span class="s1">) {</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'Comparator.test'</span><span class="s1">, </span><span class="s0">version</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose</span><span class="s1">)</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">semver </span><span class="s1">=== </span><span class="s0">ANY</span><span class="s1">) {</span>
    <span class="s2">return true</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s0">version </span><span class="s1">=== </span><span class="s4">'string'</span><span class="s1">) {</span>
    <span class="s0">version </span><span class="s1">= </span><span class="s2">new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">return </span><span class="s0">cmp</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s0">Comparator</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">intersects </span><span class="s1">= </span><span class="s2">function </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">if </span><span class="s1">(!(</span><span class="s0">comp </span><span class="s2">instanceof </span><span class="s0">Comparator</span><span class="s1">)) {</span>
    <span class="s2">throw new </span><span class="s0">TypeError</span><span class="s1">(</span><span class="s4">'a Comparator is required'</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(!</span><span class="s0">options </span><span class="s1">|| </span><span class="s2">typeof </span><span class="s0">options </span><span class="s1">!== </span><span class="s4">'object'</span><span class="s1">) {</span>
    <span class="s0">options </span><span class="s1">= {</span>
      <span class="s0">loose</span><span class="s1">: !!</span><span class="s0">options</span><span class="s1">,</span>
      <span class="s0">includePrerelease</span><span class="s1">: </span><span class="s2">false</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">var </span><span class="s0">rangeTmp</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">''</span><span class="s1">) {</span>
    <span class="s0">rangeTmp </span><span class="s1">= </span><span class="s2">new </span><span class="s0">Range</span><span class="s1">(</span><span class="s0">comp</span><span class="s1">.</span><span class="s0">value</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s0">satisfies</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">value</span><span class="s1">, </span><span class="s0">rangeTmp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">''</span><span class="s1">) {</span>
    <span class="s0">rangeTmp </span><span class="s1">= </span><span class="s2">new </span><span class="s0">Range</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">value</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s0">satisfies</span><span class="s1">(</span><span class="s0">comp</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">, </span><span class="s0">rangeTmp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">var </span><span class="s0">sameDirectionIncreasing </span><span class="s1">=</span>
    <span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&gt;=' </span><span class="s1">|| </span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&gt;'</span><span class="s1">) &amp;&amp;</span>
    <span class="s1">(</span><span class="s0">comp</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&gt;=' </span><span class="s1">|| </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&gt;'</span><span class="s1">)</span>
  <span class="s2">var </span><span class="s0">sameDirectionDecreasing </span><span class="s1">=</span>
    <span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&lt;=' </span><span class="s1">|| </span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&lt;'</span><span class="s1">) &amp;&amp;</span>
    <span class="s1">(</span><span class="s0">comp</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&lt;=' </span><span class="s1">|| </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&lt;'</span><span class="s1">)</span>
  <span class="s2">var </span><span class="s0">sameSemVer </span><span class="s1">= </span><span class="s2">this</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">.</span><span class="s0">version </span><span class="s1">=== </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">.</span><span class="s0">version</span>
  <span class="s2">var </span><span class="s0">differentDirectionsInclusive </span><span class="s1">=</span>
    <span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&gt;=' </span><span class="s1">|| </span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&lt;='</span><span class="s1">) &amp;&amp;</span>
    <span class="s1">(</span><span class="s0">comp</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&gt;=' </span><span class="s1">|| </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&lt;='</span><span class="s1">)</span>
  <span class="s2">var </span><span class="s0">oppositeDirectionsLessThan </span><span class="s1">=</span>
    <span class="s0">cmp</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">, </span><span class="s4">'&lt;'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) &amp;&amp;</span>
    <span class="s1">((</span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&gt;=' </span><span class="s1">|| </span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&gt;'</span><span class="s1">) &amp;&amp;</span>
    <span class="s1">(</span><span class="s0">comp</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&lt;=' </span><span class="s1">|| </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&lt;'</span><span class="s1">))</span>
  <span class="s2">var </span><span class="s0">oppositeDirectionsGreaterThan </span><span class="s1">=</span>
    <span class="s0">cmp</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">, </span><span class="s4">'&gt;'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) &amp;&amp;</span>
    <span class="s1">((</span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&lt;=' </span><span class="s1">|| </span><span class="s2">this</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&lt;'</span><span class="s1">) &amp;&amp;</span>
    <span class="s1">(</span><span class="s0">comp</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&gt;=' </span><span class="s1">|| </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s4">'&gt;'</span><span class="s1">))</span>

  <span class="s2">return </span><span class="s0">sameDirectionIncreasing </span><span class="s1">|| </span><span class="s0">sameDirectionDecreasing </span><span class="s1">||</span>
    <span class="s1">(</span><span class="s0">sameSemVer </span><span class="s1">&amp;&amp; </span><span class="s0">differentDirectionsInclusive</span><span class="s1">) ||</span>
    <span class="s0">oppositeDirectionsLessThan </span><span class="s1">|| </span><span class="s0">oppositeDirectionsGreaterThan</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">Range </span><span class="s1">= </span><span class="s0">Range</span>
<span class="s2">function </span><span class="s0">Range </span><span class="s1">(</span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">if </span><span class="s1">(!</span><span class="s0">options </span><span class="s1">|| </span><span class="s2">typeof </span><span class="s0">options </span><span class="s1">!== </span><span class="s4">'object'</span><span class="s1">) {</span>
    <span class="s0">options </span><span class="s1">= {</span>
      <span class="s0">loose</span><span class="s1">: !!</span><span class="s0">options</span><span class="s1">,</span>
      <span class="s0">includePrerelease</span><span class="s1">: </span><span class="s2">false</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s0">range </span><span class="s2">instanceof </span><span class="s0">Range</span><span class="s1">) {</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s0">range</span><span class="s1">.</span><span class="s0">loose </span><span class="s1">=== !!</span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose </span><span class="s1">&amp;&amp;</span>
        <span class="s0">range</span><span class="s1">.</span><span class="s0">includePrerelease </span><span class="s1">=== !!</span><span class="s0">options</span><span class="s1">.</span><span class="s0">includePrerelease</span><span class="s1">) {</span>
      <span class="s2">return </span><span class="s0">range</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s2">return new </span><span class="s0">Range</span><span class="s1">(</span><span class="s0">range</span><span class="s1">.</span><span class="s0">raw</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s0">range </span><span class="s2">instanceof </span><span class="s0">Comparator</span><span class="s1">) {</span>
    <span class="s2">return new </span><span class="s0">Range</span><span class="s1">(</span><span class="s0">range</span><span class="s1">.</span><span class="s0">value</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(!(</span><span class="s2">this instanceof </span><span class="s0">Range</span><span class="s1">)) {</span>
    <span class="s2">return new </span><span class="s0">Range</span><span class="s1">(</span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">this</span><span class="s1">.</span><span class="s0">options </span><span class="s1">= </span><span class="s0">options</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">loose </span><span class="s1">= !!</span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">includePrerelease </span><span class="s1">= !!</span><span class="s0">options</span><span class="s1">.</span><span class="s0">includePrerelease</span>

  <span class="s3">// First reduce all whitespace as much as possible so we do not have to rely</span>
  <span class="s3">// on potentially slow regexes like \s*. This is then stored and used for</span>
  <span class="s3">// future error messages as well.</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">raw </span><span class="s1">= </span><span class="s0">range</span>
    <span class="s1">.</span><span class="s0">trim</span><span class="s1">()</span>
    <span class="s1">.</span><span class="s0">split</span><span class="s1">(</span><span class="s5">/\s+/</span><span class="s1">)</span>
    <span class="s1">.</span><span class="s0">join</span><span class="s1">(</span><span class="s4">' '</span><span class="s1">)</span>

  <span class="s3">// First, split based on boolean or ||</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">set </span><span class="s1">= </span><span class="s2">this</span><span class="s1">.</span><span class="s0">raw</span><span class="s1">.</span><span class="s0">split</span><span class="s1">(</span><span class="s4">'||'</span><span class="s1">).</span><span class="s0">map</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">range</span><span class="s1">) {</span>
    <span class="s2">return this</span><span class="s1">.</span><span class="s0">parseRange</span><span class="s1">(</span><span class="s0">range</span><span class="s1">.</span><span class="s0">trim</span><span class="s1">())</span>
  <span class="s1">}, </span><span class="s2">this</span><span class="s1">).</span><span class="s0">filter</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">c</span><span class="s1">) {</span>
    <span class="s3">// throw out any that are not relevant for whatever reason</span>
    <span class="s2">return </span><span class="s0">c</span><span class="s1">.</span><span class="s0">length</span>
  <span class="s1">})</span>

  <span class="s2">if </span><span class="s1">(!</span><span class="s2">this</span><span class="s1">.</span><span class="s0">set</span><span class="s1">.</span><span class="s0">length</span><span class="s1">) {</span>
    <span class="s2">throw new </span><span class="s0">TypeError</span><span class="s1">(</span><span class="s4">'Invalid SemVer Range: ' </span><span class="s1">+ </span><span class="s2">this</span><span class="s1">.</span><span class="s0">raw</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">this</span><span class="s1">.</span><span class="s0">format</span><span class="s1">()</span>
<span class="s1">}</span>

<span class="s0">Range</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">format </span><span class="s1">= </span><span class="s2">function </span><span class="s1">() {</span>
  <span class="s2">this</span><span class="s1">.</span><span class="s0">range </span><span class="s1">= </span><span class="s2">this</span><span class="s1">.</span><span class="s0">set</span><span class="s1">.</span><span class="s0">map</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">comps</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s0">comps</span><span class="s1">.</span><span class="s0">join</span><span class="s1">(</span><span class="s4">' '</span><span class="s1">).</span><span class="s0">trim</span><span class="s1">()</span>
  <span class="s1">}).</span><span class="s0">join</span><span class="s1">(</span><span class="s4">'||'</span><span class="s1">).</span><span class="s0">trim</span><span class="s1">()</span>
  <span class="s2">return this</span><span class="s1">.</span><span class="s0">range</span>
<span class="s1">}</span>

<span class="s0">Range</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">toString </span><span class="s1">= </span><span class="s2">function </span><span class="s1">() {</span>
  <span class="s2">return this</span><span class="s1">.</span><span class="s0">range</span>
<span class="s1">}</span>

<span class="s0">Range</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">parseRange </span><span class="s1">= </span><span class="s2">function </span><span class="s1">(</span><span class="s0">range</span><span class="s1">) {</span>
  <span class="s2">var </span><span class="s0">loose </span><span class="s1">= </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose</span>
  <span class="s3">// `1.2.3 - 1.2.4` =&gt; `&gt;=1.2.3 &lt;=1.2.4`</span>
  <span class="s2">var </span><span class="s0">hr </span><span class="s1">= </span><span class="s0">loose </span><span class="s1">? </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">HYPHENRANGELOOSE</span><span class="s1">] : </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">HYPHENRANGE</span><span class="s1">]</span>
  <span class="s0">range </span><span class="s1">= </span><span class="s0">range</span><span class="s1">.</span><span class="s0">replace</span><span class="s1">(</span><span class="s0">hr</span><span class="s1">, </span><span class="s0">hyphenReplace</span><span class="s1">)</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'hyphen replace'</span><span class="s1">, </span><span class="s0">range</span><span class="s1">)</span>
  <span class="s3">// `&gt; 1.2.3 &lt; 1.2.5` =&gt; `&gt;1.2.3 &lt;1.2.5`</span>
  <span class="s0">range </span><span class="s1">= </span><span class="s0">range</span><span class="s1">.</span><span class="s0">replace</span><span class="s1">(</span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">COMPARATORTRIM</span><span class="s1">], </span><span class="s0">comparatorTrimReplace</span><span class="s1">)</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'comparator trim'</span><span class="s1">, </span><span class="s0">range</span><span class="s1">, </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">COMPARATORTRIM</span><span class="s1">])</span>

  <span class="s3">// `~ 1.2.3` =&gt; `~1.2.3`</span>
  <span class="s0">range </span><span class="s1">= </span><span class="s0">range</span><span class="s1">.</span><span class="s0">replace</span><span class="s1">(</span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">TILDETRIM</span><span class="s1">], </span><span class="s0">tildeTrimReplace</span><span class="s1">)</span>

  <span class="s3">// `^ 1.2.3` =&gt; `^1.2.3`</span>
  <span class="s0">range </span><span class="s1">= </span><span class="s0">range</span><span class="s1">.</span><span class="s0">replace</span><span class="s1">(</span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">CARETTRIM</span><span class="s1">], </span><span class="s0">caretTrimReplace</span><span class="s1">)</span>

  <span class="s3">// At this point, the range is completely trimmed and</span>
  <span class="s3">// ready to be split into comparators.</span>
  <span class="s2">var </span><span class="s0">compRe </span><span class="s1">= </span><span class="s0">loose </span><span class="s1">? </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">COMPARATORLOOSE</span><span class="s1">] : </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">COMPARATOR</span><span class="s1">]</span>
  <span class="s2">var </span><span class="s0">set </span><span class="s1">= </span><span class="s0">range</span><span class="s1">.</span><span class="s0">split</span><span class="s1">(</span><span class="s4">' '</span><span class="s1">).</span><span class="s0">map</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s0">parseComparator</span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}, </span><span class="s2">this</span><span class="s1">).</span><span class="s0">join</span><span class="s1">(</span><span class="s4">' '</span><span class="s1">).</span><span class="s0">split</span><span class="s1">(</span><span class="s5">/\s+/</span><span class="s1">)</span>
  <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose</span><span class="s1">) {</span>
    <span class="s3">// in loose mode, throw out any that are not valid comparators</span>
    <span class="s0">set </span><span class="s1">= </span><span class="s0">set</span><span class="s1">.</span><span class="s0">filter</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">) {</span>
      <span class="s2">return </span><span class="s1">!!</span><span class="s0">comp</span><span class="s1">.</span><span class="s0">match</span><span class="s1">(</span><span class="s0">compRe</span><span class="s1">)</span>
    <span class="s1">})</span>
  <span class="s1">}</span>
  <span class="s0">set </span><span class="s1">= </span><span class="s0">set</span><span class="s1">.</span><span class="s0">map</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">) {</span>
    <span class="s2">return new </span><span class="s0">Comparator</span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}, </span><span class="s2">this</span><span class="s1">)</span>

  <span class="s2">return </span><span class="s0">set</span>
<span class="s1">}</span>

<span class="s0">Range</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">intersects </span><span class="s1">= </span><span class="s2">function </span><span class="s1">(</span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">if </span><span class="s1">(!(</span><span class="s0">range </span><span class="s2">instanceof </span><span class="s0">Range</span><span class="s1">)) {</span>
    <span class="s2">throw new </span><span class="s0">TypeError</span><span class="s1">(</span><span class="s4">'a Range is required'</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">return this</span><span class="s1">.</span><span class="s0">set</span><span class="s1">.</span><span class="s0">some</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">thisComparators</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s0">thisComparators</span><span class="s1">.</span><span class="s0">every</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">thisComparator</span><span class="s1">) {</span>
      <span class="s2">return </span><span class="s0">range</span><span class="s1">.</span><span class="s0">set</span><span class="s1">.</span><span class="s0">some</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">rangeComparators</span><span class="s1">) {</span>
        <span class="s2">return </span><span class="s0">rangeComparators</span><span class="s1">.</span><span class="s0">every</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">rangeComparator</span><span class="s1">) {</span>
          <span class="s2">return </span><span class="s0">thisComparator</span><span class="s1">.</span><span class="s0">intersects</span><span class="s1">(</span><span class="s0">rangeComparator</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
        <span class="s1">})</span>
      <span class="s1">})</span>
    <span class="s1">})</span>
  <span class="s1">})</span>
<span class="s1">}</span>

<span class="s3">// Mostly just for testing and legacy API reasons</span>
<span class="s0">exports</span><span class="s1">.</span><span class="s0">toComparators </span><span class="s1">= </span><span class="s0">toComparators</span>
<span class="s2">function </span><span class="s0">toComparators </span><span class="s1">(</span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">return new </span><span class="s0">Range</span><span class="s1">(</span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">).</span><span class="s0">set</span><span class="s1">.</span><span class="s0">map</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">map</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">c</span><span class="s1">) {</span>
      <span class="s2">return </span><span class="s0">c</span><span class="s1">.</span><span class="s0">value</span>
    <span class="s1">}).</span><span class="s0">join</span><span class="s1">(</span><span class="s4">' '</span><span class="s1">).</span><span class="s0">trim</span><span class="s1">().</span><span class="s0">split</span><span class="s1">(</span><span class="s4">' '</span><span class="s1">)</span>
  <span class="s1">})</span>
<span class="s1">}</span>

<span class="s3">// comprised of xranges, tildes, stars, and gtlt's at this point.</span>
<span class="s3">// already replaced the hyphen ranges</span>
<span class="s3">// turn into a set of JUST comparators.</span>
<span class="s2">function </span><span class="s0">parseComparator </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'comp'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s0">comp </span><span class="s1">= </span><span class="s0">replaceCarets</span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'caret'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">)</span>
  <span class="s0">comp </span><span class="s1">= </span><span class="s0">replaceTildes</span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'tildes'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">)</span>
  <span class="s0">comp </span><span class="s1">= </span><span class="s0">replaceXRanges</span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'xrange'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">)</span>
  <span class="s0">comp </span><span class="s1">= </span><span class="s0">replaceStars</span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'stars'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">)</span>
  <span class="s2">return </span><span class="s0">comp</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s0">isX </span><span class="s1">(</span><span class="s0">id</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s1">!</span><span class="s0">id </span><span class="s1">|| </span><span class="s0">id</span><span class="s1">.</span><span class="s0">toLowerCase</span><span class="s1">() === </span><span class="s4">'x' </span><span class="s1">|| </span><span class="s0">id </span><span class="s1">=== </span><span class="s4">'*'</span>
<span class="s1">}</span>

<span class="s3">// ~, ~&gt; --&gt; * (any, kinda silly)</span>
<span class="s3">// ~2, ~2.x, ~2.x.x, ~&gt;2, ~&gt;2.x ~&gt;2.x.x --&gt; &gt;=2.0.0 &lt;3.0.0</span>
<span class="s3">// ~2.0, ~2.0.x, ~&gt;2.0, ~&gt;2.0.x --&gt; &gt;=2.0.0 &lt;2.1.0</span>
<span class="s3">// ~1.2, ~1.2.x, ~&gt;1.2, ~&gt;1.2.x --&gt; &gt;=1.2.0 &lt;1.3.0</span>
<span class="s3">// ~1.2.3, ~&gt;1.2.3 --&gt; &gt;=1.2.3 &lt;1.3.0</span>
<span class="s3">// ~1.2.0, ~&gt;1.2.0 --&gt; &gt;=1.2.0 &lt;1.3.0</span>
<span class="s2">function </span><span class="s0">replaceTildes </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">trim</span><span class="s1">().</span><span class="s0">split</span><span class="s1">(</span><span class="s5">/\s+/</span><span class="s1">).</span><span class="s0">map</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s0">replaceTilde</span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}).</span><span class="s0">join</span><span class="s1">(</span><span class="s4">' '</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s0">replaceTilde </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">var </span><span class="s0">r </span><span class="s1">= </span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose </span><span class="s1">? </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">TILDELOOSE</span><span class="s1">] : </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">TILDE</span><span class="s1">]</span>
  <span class="s2">return </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">replace</span><span class="s1">(</span><span class="s0">r</span><span class="s1">, </span><span class="s2">function </span><span class="s1">(</span><span class="s0">_</span><span class="s1">, </span><span class="s0">M</span><span class="s1">, </span><span class="s0">m</span><span class="s1">, </span><span class="s0">p</span><span class="s1">, </span><span class="s0">pr</span><span class="s1">) {</span>
    <span class="s0">debug</span><span class="s1">(</span><span class="s4">'tilde'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">, </span><span class="s0">_</span><span class="s1">, </span><span class="s0">M</span><span class="s1">, </span><span class="s0">m</span><span class="s1">, </span><span class="s0">p</span><span class="s1">, </span><span class="s0">pr</span><span class="s1">)</span>
    <span class="s2">var </span><span class="s0">ret</span>

    <span class="s2">if </span><span class="s1">(</span><span class="s0">isX</span><span class="s1">(</span><span class="s0">M</span><span class="s1">)) {</span>
      <span class="s0">ret </span><span class="s1">= </span><span class="s4">''</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">isX</span><span class="s1">(</span><span class="s0">m</span><span class="s1">)) {</span>
      <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.0.0 &lt;' </span><span class="s1">+ (+</span><span class="s0">M </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0.0'</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">isX</span><span class="s1">(</span><span class="s0">p</span><span class="s1">)) {</span>
      <span class="s3">// ~1.2 == &gt;=1.2.0 &lt;1.3.0</span>
      <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.0 &lt;' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ (+</span><span class="s0">m </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0'</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">pr</span><span class="s1">) {</span>
      <span class="s0">debug</span><span class="s1">(</span><span class="s4">'replaceTilde pr'</span><span class="s1">, </span><span class="s0">pr</span><span class="s1">)</span>
      <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">p </span><span class="s1">+ </span><span class="s4">'-' </span><span class="s1">+ </span><span class="s0">pr </span><span class="s1">+</span>
            <span class="s4">' &lt;' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ (+</span><span class="s0">m </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0'</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s3">// ~1.2.3 == &gt;=1.2.3 &lt;1.3.0</span>
      <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">p </span><span class="s1">+</span>
            <span class="s4">' &lt;' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ (+</span><span class="s0">m </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0'</span>
    <span class="s1">}</span>

    <span class="s0">debug</span><span class="s1">(</span><span class="s4">'tilde return'</span><span class="s1">, </span><span class="s0">ret</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s0">ret</span>
  <span class="s1">})</span>
<span class="s1">}</span>

<span class="s3">// ^ --&gt; * (any, kinda silly)</span>
<span class="s3">// ^2, ^2.x, ^2.x.x --&gt; &gt;=2.0.0 &lt;3.0.0</span>
<span class="s3">// ^2.0, ^2.0.x --&gt; &gt;=2.0.0 &lt;3.0.0</span>
<span class="s3">// ^1.2, ^1.2.x --&gt; &gt;=1.2.0 &lt;2.0.0</span>
<span class="s3">// ^1.2.3 --&gt; &gt;=1.2.3 &lt;2.0.0</span>
<span class="s3">// ^1.2.0 --&gt; &gt;=1.2.0 &lt;2.0.0</span>
<span class="s2">function </span><span class="s0">replaceCarets </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">trim</span><span class="s1">().</span><span class="s0">split</span><span class="s1">(</span><span class="s5">/\s+/</span><span class="s1">).</span><span class="s0">map</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s0">replaceCaret</span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}).</span><span class="s0">join</span><span class="s1">(</span><span class="s4">' '</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s0">replaceCaret </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'caret'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s2">var </span><span class="s0">r </span><span class="s1">= </span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose </span><span class="s1">? </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">CARETLOOSE</span><span class="s1">] : </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">CARET</span><span class="s1">]</span>
  <span class="s2">return </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">replace</span><span class="s1">(</span><span class="s0">r</span><span class="s1">, </span><span class="s2">function </span><span class="s1">(</span><span class="s0">_</span><span class="s1">, </span><span class="s0">M</span><span class="s1">, </span><span class="s0">m</span><span class="s1">, </span><span class="s0">p</span><span class="s1">, </span><span class="s0">pr</span><span class="s1">) {</span>
    <span class="s0">debug</span><span class="s1">(</span><span class="s4">'caret'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">, </span><span class="s0">_</span><span class="s1">, </span><span class="s0">M</span><span class="s1">, </span><span class="s0">m</span><span class="s1">, </span><span class="s0">p</span><span class="s1">, </span><span class="s0">pr</span><span class="s1">)</span>
    <span class="s2">var </span><span class="s0">ret</span>

    <span class="s2">if </span><span class="s1">(</span><span class="s0">isX</span><span class="s1">(</span><span class="s0">M</span><span class="s1">)) {</span>
      <span class="s0">ret </span><span class="s1">= </span><span class="s4">''</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">isX</span><span class="s1">(</span><span class="s0">m</span><span class="s1">)) {</span>
      <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.0.0 &lt;' </span><span class="s1">+ (+</span><span class="s0">M </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0.0'</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">isX</span><span class="s1">(</span><span class="s0">p</span><span class="s1">)) {</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s0">M </span><span class="s1">=== </span><span class="s4">'0'</span><span class="s1">) {</span>
        <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.0 &lt;' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ (+</span><span class="s0">m </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0'</span>
      <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.0 &lt;' </span><span class="s1">+ (+</span><span class="s0">M </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0.0'</span>
      <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">pr</span><span class="s1">) {</span>
      <span class="s0">debug</span><span class="s1">(</span><span class="s4">'replaceCaret pr'</span><span class="s1">, </span><span class="s0">pr</span><span class="s1">)</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s0">M </span><span class="s1">=== </span><span class="s4">'0'</span><span class="s1">) {</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s0">m </span><span class="s1">=== </span><span class="s4">'0'</span><span class="s1">) {</span>
          <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">p </span><span class="s1">+ </span><span class="s4">'-' </span><span class="s1">+ </span><span class="s0">pr </span><span class="s1">+</span>
                <span class="s4">' &lt;' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ (+</span><span class="s0">p </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">)</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
          <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">p </span><span class="s1">+ </span><span class="s4">'-' </span><span class="s1">+ </span><span class="s0">pr </span><span class="s1">+</span>
                <span class="s4">' &lt;' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ (+</span><span class="s0">m </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0'</span>
        <span class="s1">}</span>
      <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">p </span><span class="s1">+ </span><span class="s4">'-' </span><span class="s1">+ </span><span class="s0">pr </span><span class="s1">+</span>
              <span class="s4">' &lt;' </span><span class="s1">+ (+</span><span class="s0">M </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0.0'</span>
      <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s0">debug</span><span class="s1">(</span><span class="s4">'no pr'</span><span class="s1">)</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s0">M </span><span class="s1">=== </span><span class="s4">'0'</span><span class="s1">) {</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s0">m </span><span class="s1">=== </span><span class="s4">'0'</span><span class="s1">) {</span>
          <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">p </span><span class="s1">+</span>
                <span class="s4">' &lt;' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ (+</span><span class="s0">p </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">)</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
          <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">p </span><span class="s1">+</span>
                <span class="s4">' &lt;' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ (+</span><span class="s0">m </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0'</span>
        <span class="s1">}</span>
      <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">p </span><span class="s1">+</span>
              <span class="s4">' &lt;' </span><span class="s1">+ (+</span><span class="s0">M </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0.0'</span>
      <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s0">debug</span><span class="s1">(</span><span class="s4">'caret return'</span><span class="s1">, </span><span class="s0">ret</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s0">ret</span>
  <span class="s1">})</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s0">replaceXRanges </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'replaceXRanges'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s2">return </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">split</span><span class="s1">(</span><span class="s5">/\s+/</span><span class="s1">).</span><span class="s0">map</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s0">replaceXRange</span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}).</span><span class="s0">join</span><span class="s1">(</span><span class="s4">' '</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s0">replaceXRange </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s0">comp </span><span class="s1">= </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">trim</span><span class="s1">()</span>
  <span class="s2">var </span><span class="s0">r </span><span class="s1">= </span><span class="s0">options</span><span class="s1">.</span><span class="s0">loose </span><span class="s1">? </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">XRANGELOOSE</span><span class="s1">] : </span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">XRANGE</span><span class="s1">]</span>
  <span class="s2">return </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">replace</span><span class="s1">(</span><span class="s0">r</span><span class="s1">, </span><span class="s2">function </span><span class="s1">(</span><span class="s0">ret</span><span class="s1">, </span><span class="s0">gtlt</span><span class="s1">, </span><span class="s0">M</span><span class="s1">, </span><span class="s0">m</span><span class="s1">, </span><span class="s0">p</span><span class="s1">, </span><span class="s0">pr</span><span class="s1">) {</span>
    <span class="s0">debug</span><span class="s1">(</span><span class="s4">'xRange'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">, </span><span class="s0">ret</span><span class="s1">, </span><span class="s0">gtlt</span><span class="s1">, </span><span class="s0">M</span><span class="s1">, </span><span class="s0">m</span><span class="s1">, </span><span class="s0">p</span><span class="s1">, </span><span class="s0">pr</span><span class="s1">)</span>
    <span class="s2">var </span><span class="s0">xM </span><span class="s1">= </span><span class="s0">isX</span><span class="s1">(</span><span class="s0">M</span><span class="s1">)</span>
    <span class="s2">var </span><span class="s0">xm </span><span class="s1">= </span><span class="s0">xM </span><span class="s1">|| </span><span class="s0">isX</span><span class="s1">(</span><span class="s0">m</span><span class="s1">)</span>
    <span class="s2">var </span><span class="s0">xp </span><span class="s1">= </span><span class="s0">xm </span><span class="s1">|| </span><span class="s0">isX</span><span class="s1">(</span><span class="s0">p</span><span class="s1">)</span>
    <span class="s2">var </span><span class="s0">anyX </span><span class="s1">= </span><span class="s0">xp</span>

    <span class="s2">if </span><span class="s1">(</span><span class="s0">gtlt </span><span class="s1">=== </span><span class="s4">'=' </span><span class="s1">&amp;&amp; </span><span class="s0">anyX</span><span class="s1">) {</span>
      <span class="s0">gtlt </span><span class="s1">= </span><span class="s4">''</span>
    <span class="s1">}</span>

    <span class="s2">if </span><span class="s1">(</span><span class="s0">xM</span><span class="s1">) {</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s0">gtlt </span><span class="s1">=== </span><span class="s4">'&gt;' </span><span class="s1">|| </span><span class="s0">gtlt </span><span class="s1">=== </span><span class="s4">'&lt;'</span><span class="s1">) {</span>
        <span class="s3">// nothing is allowed</span>
        <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&lt;0.0.0'</span>
      <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s3">// nothing is forbidden</span>
        <span class="s0">ret </span><span class="s1">= </span><span class="s4">'*'</span>
      <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">gtlt </span><span class="s1">&amp;&amp; </span><span class="s0">anyX</span><span class="s1">) {</span>
      <span class="s3">// we know patch is an x, because we have any x at all.</span>
      <span class="s3">// replace X with 0</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s0">xm</span><span class="s1">) {</span>
        <span class="s0">m </span><span class="s1">= </span><span class="s6">0</span>
      <span class="s1">}</span>
      <span class="s0">p </span><span class="s1">= </span><span class="s6">0</span>

      <span class="s2">if </span><span class="s1">(</span><span class="s0">gtlt </span><span class="s1">=== </span><span class="s4">'&gt;'</span><span class="s1">) {</span>
        <span class="s3">// &gt;1 =&gt; &gt;=2.0.0</span>
        <span class="s3">// &gt;1.2 =&gt; &gt;=1.3.0</span>
        <span class="s3">// &gt;1.2.3 =&gt; &gt;= 1.2.4</span>
        <span class="s0">gtlt </span><span class="s1">= </span><span class="s4">'&gt;='</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s0">xm</span><span class="s1">) {</span>
          <span class="s0">M </span><span class="s1">= +</span><span class="s0">M </span><span class="s1">+ </span><span class="s6">1</span>
          <span class="s0">m </span><span class="s1">= </span><span class="s6">0</span>
          <span class="s0">p </span><span class="s1">= </span><span class="s6">0</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
          <span class="s0">m </span><span class="s1">= +</span><span class="s0">m </span><span class="s1">+ </span><span class="s6">1</span>
          <span class="s0">p </span><span class="s1">= </span><span class="s6">0</span>
        <span class="s1">}</span>
      <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">gtlt </span><span class="s1">=== </span><span class="s4">'&lt;='</span><span class="s1">) {</span>
        <span class="s3">// &lt;=0.7.x is actually &lt;0.8.0, since any 0.7.x should</span>
        <span class="s3">// pass.  Similarly, &lt;=7.x is actually &lt;8.0.0, etc.</span>
        <span class="s0">gtlt </span><span class="s1">= </span><span class="s4">'&lt;'</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s0">xm</span><span class="s1">) {</span>
          <span class="s0">M </span><span class="s1">= +</span><span class="s0">M </span><span class="s1">+ </span><span class="s6">1</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
          <span class="s0">m </span><span class="s1">= +</span><span class="s0">m </span><span class="s1">+ </span><span class="s6">1</span>
        <span class="s1">}</span>
      <span class="s1">}</span>

      <span class="s0">ret </span><span class="s1">= </span><span class="s0">gtlt </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">p</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">xm</span><span class="s1">) {</span>
      <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.0.0 &lt;' </span><span class="s1">+ (+</span><span class="s0">M </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0.0'</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">xp</span><span class="s1">) {</span>
      <span class="s0">ret </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">m </span><span class="s1">+ </span><span class="s4">'.0 &lt;' </span><span class="s1">+ </span><span class="s0">M </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ (+</span><span class="s0">m </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0'</span>
    <span class="s1">}</span>

    <span class="s0">debug</span><span class="s1">(</span><span class="s4">'xRange return'</span><span class="s1">, </span><span class="s0">ret</span><span class="s1">)</span>

    <span class="s2">return </span><span class="s0">ret</span>
  <span class="s1">})</span>
<span class="s1">}</span>

<span class="s3">// Because * is AND-ed with everything else in the comparator,</span>
<span class="s3">// and '' means &quot;any version&quot;, just remove the *s entirely.</span>
<span class="s2">function </span><span class="s0">replaceStars </span><span class="s1">(</span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s0">debug</span><span class="s1">(</span><span class="s4">'replaceStars'</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s3">// Looseness is ignored here.  star is always as loose as it gets!</span>
  <span class="s2">return </span><span class="s0">comp</span><span class="s1">.</span><span class="s0">trim</span><span class="s1">().</span><span class="s0">replace</span><span class="s1">(</span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">STAR</span><span class="s1">], </span><span class="s4">''</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s3">// This function is passed to string.replace(safeRe[HYPHENRANGE])</span>
<span class="s3">// M, m, patch, prerelease, build</span>
<span class="s3">// 1.2 - 3.4.5 =&gt; &gt;=1.2.0 &lt;=3.4.5</span>
<span class="s3">// 1.2.3 - 3.4 =&gt; &gt;=1.2.0 &lt;3.5.0 Any 3.4.x will do</span>
<span class="s3">// 1.2 - 3.4 =&gt; &gt;=1.2.0 &lt;3.5.0</span>
<span class="s2">function </span><span class="s0">hyphenReplace </span><span class="s1">(</span><span class="s0">$0</span><span class="s1">,</span>
  <span class="s0">from</span><span class="s1">, </span><span class="s0">fM</span><span class="s1">, </span><span class="s0">fm</span><span class="s1">, </span><span class="s0">fp</span><span class="s1">, </span><span class="s0">fpr</span><span class="s1">, </span><span class="s0">fb</span><span class="s1">,</span>
  <span class="s0">to</span><span class="s1">, </span><span class="s0">tM</span><span class="s1">, </span><span class="s0">tm</span><span class="s1">, </span><span class="s0">tp</span><span class="s1">, </span><span class="s0">tpr</span><span class="s1">, </span><span class="s0">tb</span><span class="s1">) {</span>
  <span class="s2">if </span><span class="s1">(</span><span class="s0">isX</span><span class="s1">(</span><span class="s0">fM</span><span class="s1">)) {</span>
    <span class="s0">from </span><span class="s1">= </span><span class="s4">''</span>
  <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">isX</span><span class="s1">(</span><span class="s0">fm</span><span class="s1">)) {</span>
    <span class="s0">from </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">fM </span><span class="s1">+ </span><span class="s4">'.0.0'</span>
  <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">isX</span><span class="s1">(</span><span class="s0">fp</span><span class="s1">)) {</span>
    <span class="s0">from </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">fM </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">fm </span><span class="s1">+ </span><span class="s4">'.0'</span>
  <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
    <span class="s0">from </span><span class="s1">= </span><span class="s4">'&gt;=' </span><span class="s1">+ </span><span class="s0">from</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s0">isX</span><span class="s1">(</span><span class="s0">tM</span><span class="s1">)) {</span>
    <span class="s0">to </span><span class="s1">= </span><span class="s4">''</span>
  <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">isX</span><span class="s1">(</span><span class="s0">tm</span><span class="s1">)) {</span>
    <span class="s0">to </span><span class="s1">= </span><span class="s4">'&lt;' </span><span class="s1">+ (+</span><span class="s0">tM </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0.0'</span>
  <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">isX</span><span class="s1">(</span><span class="s0">tp</span><span class="s1">)) {</span>
    <span class="s0">to </span><span class="s1">= </span><span class="s4">'&lt;' </span><span class="s1">+ </span><span class="s0">tM </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ (+</span><span class="s0">tm </span><span class="s1">+ </span><span class="s6">1</span><span class="s1">) + </span><span class="s4">'.0'</span>
  <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">tpr</span><span class="s1">) {</span>
    <span class="s0">to </span><span class="s1">= </span><span class="s4">'&lt;=' </span><span class="s1">+ </span><span class="s0">tM </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">tm </span><span class="s1">+ </span><span class="s4">'.' </span><span class="s1">+ </span><span class="s0">tp </span><span class="s1">+ </span><span class="s4">'-' </span><span class="s1">+ </span><span class="s0">tpr</span>
  <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
    <span class="s0">to </span><span class="s1">= </span><span class="s4">'&lt;=' </span><span class="s1">+ </span><span class="s0">to</span>
  <span class="s1">}</span>

  <span class="s2">return </span><span class="s1">(</span><span class="s0">from </span><span class="s1">+ </span><span class="s4">' ' </span><span class="s1">+ </span><span class="s0">to</span><span class="s1">).</span><span class="s0">trim</span><span class="s1">()</span>
<span class="s1">}</span>

<span class="s3">// if ANY of the sets match ALL of its comparators, then pass</span>
<span class="s0">Range</span><span class="s1">.</span><span class="s0">prototype</span><span class="s1">.</span><span class="s0">test </span><span class="s1">= </span><span class="s2">function </span><span class="s1">(</span><span class="s0">version</span><span class="s1">) {</span>
  <span class="s2">if </span><span class="s1">(!</span><span class="s0">version</span><span class="s1">) {</span>
    <span class="s2">return false</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s0">version </span><span class="s1">=== </span><span class="s4">'string'</span><span class="s1">) {</span>
    <span class="s0">version </span><span class="s1">= </span><span class="s2">new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s0">i </span><span class="s1">= </span><span class="s6">0</span><span class="s1">; </span><span class="s0">i </span><span class="s1">&lt; </span><span class="s2">this</span><span class="s1">.</span><span class="s0">set</span><span class="s1">.</span><span class="s0">length</span><span class="s1">; </span><span class="s0">i</span><span class="s1">++) {</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s0">testSet</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s0">set</span><span class="s1">[</span><span class="s0">i</span><span class="s1">], </span><span class="s0">version</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.</span><span class="s0">options</span><span class="s1">)) {</span>
      <span class="s2">return true</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
  <span class="s2">return false</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s0">testSet </span><span class="s1">(</span><span class="s0">set</span><span class="s1">, </span><span class="s0">version</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s0">i </span><span class="s1">= </span><span class="s6">0</span><span class="s1">; </span><span class="s0">i </span><span class="s1">&lt; </span><span class="s0">set</span><span class="s1">.</span><span class="s0">length</span><span class="s1">; </span><span class="s0">i</span><span class="s1">++) {</span>
    <span class="s2">if </span><span class="s1">(!</span><span class="s0">set</span><span class="s1">[</span><span class="s0">i</span><span class="s1">].</span><span class="s0">test</span><span class="s1">(</span><span class="s0">version</span><span class="s1">)) {</span>
      <span class="s2">return false</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s0">version</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">&amp;&amp; !</span><span class="s0">options</span><span class="s1">.</span><span class="s0">includePrerelease</span><span class="s1">) {</span>
    <span class="s3">// Find the set of versions that are allowed to have prereleases</span>
    <span class="s3">// For example, ^1.2.3-pr.1 desugars to &gt;=1.2.3-pr.1 &lt;2.0.0</span>
    <span class="s3">// That should allow `1.2.3-pr.2` to pass.</span>
    <span class="s3">// However, `1.2.4-alpha.notready` should NOT be allowed,</span>
    <span class="s3">// even though it's within the range set by the comparators.</span>
    <span class="s2">for </span><span class="s1">(</span><span class="s0">i </span><span class="s1">= </span><span class="s6">0</span><span class="s1">; </span><span class="s0">i </span><span class="s1">&lt; </span><span class="s0">set</span><span class="s1">.</span><span class="s0">length</span><span class="s1">; </span><span class="s0">i</span><span class="s1">++) {</span>
      <span class="s0">debug</span><span class="s1">(</span><span class="s0">set</span><span class="s1">[</span><span class="s0">i</span><span class="s1">].</span><span class="s0">semver</span><span class="s1">)</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s0">set</span><span class="s1">[</span><span class="s0">i</span><span class="s1">].</span><span class="s0">semver </span><span class="s1">=== </span><span class="s0">ANY</span><span class="s1">) {</span>
        <span class="s2">continue</span>
      <span class="s1">}</span>

      <span class="s2">if </span><span class="s1">(</span><span class="s0">set</span><span class="s1">[</span><span class="s0">i</span><span class="s1">].</span><span class="s0">semver</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">&gt; </span><span class="s6">0</span><span class="s1">) {</span>
        <span class="s2">var </span><span class="s0">allowed </span><span class="s1">= </span><span class="s0">set</span><span class="s1">[</span><span class="s0">i</span><span class="s1">].</span><span class="s0">semver</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s0">allowed</span><span class="s1">.</span><span class="s0">major </span><span class="s1">=== </span><span class="s0">version</span><span class="s1">.</span><span class="s0">major </span><span class="s1">&amp;&amp;</span>
            <span class="s0">allowed</span><span class="s1">.</span><span class="s0">minor </span><span class="s1">=== </span><span class="s0">version</span><span class="s1">.</span><span class="s0">minor </span><span class="s1">&amp;&amp;</span>
            <span class="s0">allowed</span><span class="s1">.</span><span class="s0">patch </span><span class="s1">=== </span><span class="s0">version</span><span class="s1">.</span><span class="s0">patch</span><span class="s1">) {</span>
          <span class="s2">return true</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s3">// Version has a -pre, but it's not one of the ones we like.</span>
    <span class="s2">return false</span>
  <span class="s1">}</span>

  <span class="s2">return true</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">satisfies </span><span class="s1">= </span><span class="s0">satisfies</span>
<span class="s2">function </span><span class="s0">satisfies </span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">try </span><span class="s1">{</span>
    <span class="s0">range </span><span class="s1">= </span><span class="s2">new </span><span class="s0">Range</span><span class="s1">(</span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">} </span><span class="s2">catch </span><span class="s1">(</span><span class="s0">er</span><span class="s1">) {</span>
    <span class="s2">return false</span>
  <span class="s1">}</span>
  <span class="s2">return </span><span class="s0">range</span><span class="s1">.</span><span class="s0">test</span><span class="s1">(</span><span class="s0">version</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">maxSatisfying </span><span class="s1">= </span><span class="s0">maxSatisfying</span>
<span class="s2">function </span><span class="s0">maxSatisfying </span><span class="s1">(</span><span class="s0">versions</span><span class="s1">, </span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">var </span><span class="s0">max </span><span class="s1">= </span><span class="s2">null</span>
  <span class="s2">var </span><span class="s0">maxSV </span><span class="s1">= </span><span class="s2">null</span>
  <span class="s2">try </span><span class="s1">{</span>
    <span class="s2">var </span><span class="s0">rangeObj </span><span class="s1">= </span><span class="s2">new </span><span class="s0">Range</span><span class="s1">(</span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">} </span><span class="s2">catch </span><span class="s1">(</span><span class="s0">er</span><span class="s1">) {</span>
    <span class="s2">return null</span>
  <span class="s1">}</span>
  <span class="s0">versions</span><span class="s1">.</span><span class="s0">forEach</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">v</span><span class="s1">) {</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s0">rangeObj</span><span class="s1">.</span><span class="s0">test</span><span class="s1">(</span><span class="s0">v</span><span class="s1">)) {</span>
      <span class="s3">// satisfies(v, range, options)</span>
      <span class="s2">if </span><span class="s1">(!</span><span class="s0">max </span><span class="s1">|| </span><span class="s0">maxSV</span><span class="s1">.</span><span class="s0">compare</span><span class="s1">(</span><span class="s0">v</span><span class="s1">) === -</span><span class="s6">1</span><span class="s1">) {</span>
        <span class="s3">// compare(max, v, true)</span>
        <span class="s0">max </span><span class="s1">= </span><span class="s0">v</span>
        <span class="s0">maxSV </span><span class="s1">= </span><span class="s2">new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">max</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">})</span>
  <span class="s2">return </span><span class="s0">max</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">minSatisfying </span><span class="s1">= </span><span class="s0">minSatisfying</span>
<span class="s2">function </span><span class="s0">minSatisfying </span><span class="s1">(</span><span class="s0">versions</span><span class="s1">, </span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">var </span><span class="s0">min </span><span class="s1">= </span><span class="s2">null</span>
  <span class="s2">var </span><span class="s0">minSV </span><span class="s1">= </span><span class="s2">null</span>
  <span class="s2">try </span><span class="s1">{</span>
    <span class="s2">var </span><span class="s0">rangeObj </span><span class="s1">= </span><span class="s2">new </span><span class="s0">Range</span><span class="s1">(</span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s1">} </span><span class="s2">catch </span><span class="s1">(</span><span class="s0">er</span><span class="s1">) {</span>
    <span class="s2">return null</span>
  <span class="s1">}</span>
  <span class="s0">versions</span><span class="s1">.</span><span class="s0">forEach</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">v</span><span class="s1">) {</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s0">rangeObj</span><span class="s1">.</span><span class="s0">test</span><span class="s1">(</span><span class="s0">v</span><span class="s1">)) {</span>
      <span class="s3">// satisfies(v, range, options)</span>
      <span class="s2">if </span><span class="s1">(!</span><span class="s0">min </span><span class="s1">|| </span><span class="s0">minSV</span><span class="s1">.</span><span class="s0">compare</span><span class="s1">(</span><span class="s0">v</span><span class="s1">) === </span><span class="s6">1</span><span class="s1">) {</span>
        <span class="s3">// compare(min, v, true)</span>
        <span class="s0">min </span><span class="s1">= </span><span class="s0">v</span>
        <span class="s0">minSV </span><span class="s1">= </span><span class="s2">new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">min</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">})</span>
  <span class="s2">return </span><span class="s0">min</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">minVersion </span><span class="s1">= </span><span class="s0">minVersion</span>
<span class="s2">function </span><span class="s0">minVersion </span><span class="s1">(</span><span class="s0">range</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">) {</span>
  <span class="s0">range </span><span class="s1">= </span><span class="s2">new </span><span class="s0">Range</span><span class="s1">(</span><span class="s0">range</span><span class="s1">, </span><span class="s0">loose</span><span class="s1">)</span>

  <span class="s2">var </span><span class="s0">minver </span><span class="s1">= </span><span class="s2">new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s4">'0.0.0'</span><span class="s1">)</span>
  <span class="s2">if </span><span class="s1">(</span><span class="s0">range</span><span class="s1">.</span><span class="s0">test</span><span class="s1">(</span><span class="s0">minver</span><span class="s1">)) {</span>
    <span class="s2">return </span><span class="s0">minver</span>
  <span class="s1">}</span>

  <span class="s0">minver </span><span class="s1">= </span><span class="s2">new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s4">'0.0.0-0'</span><span class="s1">)</span>
  <span class="s2">if </span><span class="s1">(</span><span class="s0">range</span><span class="s1">.</span><span class="s0">test</span><span class="s1">(</span><span class="s0">minver</span><span class="s1">)) {</span>
    <span class="s2">return </span><span class="s0">minver</span>
  <span class="s1">}</span>

  <span class="s0">minver </span><span class="s1">= </span><span class="s2">null</span>
  <span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s0">i </span><span class="s1">= </span><span class="s6">0</span><span class="s1">; </span><span class="s0">i </span><span class="s1">&lt; </span><span class="s0">range</span><span class="s1">.</span><span class="s0">set</span><span class="s1">.</span><span class="s0">length</span><span class="s1">; ++</span><span class="s0">i</span><span class="s1">) {</span>
    <span class="s2">var </span><span class="s0">comparators </span><span class="s1">= </span><span class="s0">range</span><span class="s1">.</span><span class="s0">set</span><span class="s1">[</span><span class="s0">i</span><span class="s1">]</span>

    <span class="s0">comparators</span><span class="s1">.</span><span class="s0">forEach</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">comparator</span><span class="s1">) {</span>
      <span class="s3">// Clone to avoid manipulating the comparator's semver object.</span>
      <span class="s2">var </span><span class="s0">compver </span><span class="s1">= </span><span class="s2">new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">comparator</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">.</span><span class="s0">version</span><span class="s1">)</span>
      <span class="s2">switch </span><span class="s1">(</span><span class="s0">comparator</span><span class="s1">.</span><span class="s0">operator</span><span class="s1">) {</span>
        <span class="s2">case </span><span class="s4">'&gt;'</span><span class="s1">:</span>
          <span class="s2">if </span><span class="s1">(</span><span class="s0">compver</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length </span><span class="s1">=== </span><span class="s6">0</span><span class="s1">) {</span>
            <span class="s0">compver</span><span class="s1">.</span><span class="s0">patch</span><span class="s1">++</span>
          <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s0">compver</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">push</span><span class="s1">(</span><span class="s6">0</span><span class="s1">)</span>
          <span class="s1">}</span>
          <span class="s0">compver</span><span class="s1">.</span><span class="s0">raw </span><span class="s1">= </span><span class="s0">compver</span><span class="s1">.</span><span class="s0">format</span><span class="s1">()</span>
          <span class="s3">/* fallthrough */</span>
        <span class="s2">case </span><span class="s4">''</span><span class="s1">:</span>
        <span class="s2">case </span><span class="s4">'&gt;='</span><span class="s1">:</span>
          <span class="s2">if </span><span class="s1">(!</span><span class="s0">minver </span><span class="s1">|| </span><span class="s0">gt</span><span class="s1">(</span><span class="s0">minver</span><span class="s1">, </span><span class="s0">compver</span><span class="s1">)) {</span>
            <span class="s0">minver </span><span class="s1">= </span><span class="s0">compver</span>
          <span class="s1">}</span>
          <span class="s2">break</span>
        <span class="s2">case </span><span class="s4">'&lt;'</span><span class="s1">:</span>
        <span class="s2">case </span><span class="s4">'&lt;='</span><span class="s1">:</span>
          <span class="s3">/* Ignore maximum versions */</span>
          <span class="s2">break</span>
        <span class="s3">/* istanbul ignore next */</span>
        <span class="s2">default</span><span class="s1">:</span>
          <span class="s2">throw new </span><span class="s0">Error</span><span class="s1">(</span><span class="s4">'Unexpected operation: ' </span><span class="s1">+ </span><span class="s0">comparator</span><span class="s1">.</span><span class="s0">operator</span><span class="s1">)</span>
      <span class="s1">}</span>
    <span class="s1">})</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s0">minver </span><span class="s1">&amp;&amp; </span><span class="s0">range</span><span class="s1">.</span><span class="s0">test</span><span class="s1">(</span><span class="s0">minver</span><span class="s1">)) {</span>
    <span class="s2">return </span><span class="s0">minver</span>
  <span class="s1">}</span>

  <span class="s2">return null</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">validRange </span><span class="s1">= </span><span class="s0">validRange</span>
<span class="s2">function </span><span class="s0">validRange </span><span class="s1">(</span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">try </span><span class="s1">{</span>
    <span class="s3">// Return '*' instead of '' so that truthiness works.</span>
    <span class="s3">// This will throw if it's invalid anyway</span>
    <span class="s2">return new </span><span class="s0">Range</span><span class="s1">(</span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">).</span><span class="s0">range </span><span class="s1">|| </span><span class="s4">'*'</span>
  <span class="s1">} </span><span class="s2">catch </span><span class="s1">(</span><span class="s0">er</span><span class="s1">) {</span>
    <span class="s2">return null</span>
  <span class="s1">}</span>
<span class="s1">}</span>

<span class="s3">// Determine if version is less than all the versions possible in the range</span>
<span class="s0">exports</span><span class="s1">.</span><span class="s0">ltr </span><span class="s1">= </span><span class="s0">ltr</span>
<span class="s2">function </span><span class="s0">ltr </span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">outside</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">range</span><span class="s1">, </span><span class="s4">'&lt;'</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s3">// Determine if version is greater than all the versions possible in the range.</span>
<span class="s0">exports</span><span class="s1">.</span><span class="s0">gtr </span><span class="s1">= </span><span class="s0">gtr</span>
<span class="s2">function </span><span class="s0">gtr </span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">return </span><span class="s0">outside</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">range</span><span class="s1">, </span><span class="s4">'&gt;'</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">outside </span><span class="s1">= </span><span class="s0">outside</span>
<span class="s2">function </span><span class="s0">outside </span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">range</span><span class="s1">, </span><span class="s0">hilo</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s0">version </span><span class="s1">= </span><span class="s2">new </span><span class="s0">SemVer</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s0">range </span><span class="s1">= </span><span class="s2">new </span><span class="s0">Range</span><span class="s1">(</span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>

  <span class="s2">var </span><span class="s0">gtfn</span><span class="s1">, </span><span class="s0">ltefn</span><span class="s1">, </span><span class="s0">ltfn</span><span class="s1">, </span><span class="s0">comp</span><span class="s1">, </span><span class="s0">ecomp</span>
  <span class="s2">switch </span><span class="s1">(</span><span class="s0">hilo</span><span class="s1">) {</span>
    <span class="s2">case </span><span class="s4">'&gt;'</span><span class="s1">:</span>
      <span class="s0">gtfn </span><span class="s1">= </span><span class="s0">gt</span>
      <span class="s0">ltefn </span><span class="s1">= </span><span class="s0">lte</span>
      <span class="s0">ltfn </span><span class="s1">= </span><span class="s0">lt</span>
      <span class="s0">comp </span><span class="s1">= </span><span class="s4">'&gt;'</span>
      <span class="s0">ecomp </span><span class="s1">= </span><span class="s4">'&gt;='</span>
      <span class="s2">break</span>
    <span class="s2">case </span><span class="s4">'&lt;'</span><span class="s1">:</span>
      <span class="s0">gtfn </span><span class="s1">= </span><span class="s0">lt</span>
      <span class="s0">ltefn </span><span class="s1">= </span><span class="s0">gte</span>
      <span class="s0">ltfn </span><span class="s1">= </span><span class="s0">gt</span>
      <span class="s0">comp </span><span class="s1">= </span><span class="s4">'&lt;'</span>
      <span class="s0">ecomp </span><span class="s1">= </span><span class="s4">'&lt;='</span>
      <span class="s2">break</span>
    <span class="s2">default</span><span class="s1">:</span>
      <span class="s2">throw new </span><span class="s0">TypeError</span><span class="s1">(</span><span class="s4">'Must provide a hilo val of &quot;&lt;&quot; or &quot;&gt;&quot;'</span><span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s3">// If it satisifes the range it is not outside</span>
  <span class="s2">if </span><span class="s1">(</span><span class="s0">satisfies</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">range</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)) {</span>
    <span class="s2">return false</span>
  <span class="s1">}</span>

  <span class="s3">// From now on, variable terms are as if we're in &quot;gtr&quot; mode.</span>
  <span class="s3">// but note that everything is flipped for the &quot;ltr&quot; function.</span>

  <span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s0">i </span><span class="s1">= </span><span class="s6">0</span><span class="s1">; </span><span class="s0">i </span><span class="s1">&lt; </span><span class="s0">range</span><span class="s1">.</span><span class="s0">set</span><span class="s1">.</span><span class="s0">length</span><span class="s1">; ++</span><span class="s0">i</span><span class="s1">) {</span>
    <span class="s2">var </span><span class="s0">comparators </span><span class="s1">= </span><span class="s0">range</span><span class="s1">.</span><span class="s0">set</span><span class="s1">[</span><span class="s0">i</span><span class="s1">]</span>

    <span class="s2">var </span><span class="s0">high </span><span class="s1">= </span><span class="s2">null</span>
    <span class="s2">var </span><span class="s0">low </span><span class="s1">= </span><span class="s2">null</span>

    <span class="s0">comparators</span><span class="s1">.</span><span class="s0">forEach</span><span class="s1">(</span><span class="s2">function </span><span class="s1">(</span><span class="s0">comparator</span><span class="s1">) {</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s0">comparator</span><span class="s1">.</span><span class="s0">semver </span><span class="s1">=== </span><span class="s0">ANY</span><span class="s1">) {</span>
        <span class="s0">comparator </span><span class="s1">= </span><span class="s2">new </span><span class="s0">Comparator</span><span class="s1">(</span><span class="s4">'&gt;=0.0.0'</span><span class="s1">)</span>
      <span class="s1">}</span>
      <span class="s0">high </span><span class="s1">= </span><span class="s0">high </span><span class="s1">|| </span><span class="s0">comparator</span>
      <span class="s0">low </span><span class="s1">= </span><span class="s0">low </span><span class="s1">|| </span><span class="s0">comparator</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s0">gtfn</span><span class="s1">(</span><span class="s0">comparator</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">, </span><span class="s0">high</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)) {</span>
        <span class="s0">high </span><span class="s1">= </span><span class="s0">comparator</span>
      <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">ltfn</span><span class="s1">(</span><span class="s0">comparator</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">, </span><span class="s0">low</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)) {</span>
        <span class="s0">low </span><span class="s1">= </span><span class="s0">comparator</span>
      <span class="s1">}</span>
    <span class="s1">})</span>

    <span class="s3">// If the edge version comparator has a operator then our version</span>
    <span class="s3">// isn't outside it</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s0">high</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s0">comp </span><span class="s1">|| </span><span class="s0">high</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s0">ecomp</span><span class="s1">) {</span>
      <span class="s2">return false</span>
    <span class="s1">}</span>

    <span class="s3">// If the lowest version comparator has an operator and our version</span>
    <span class="s3">// is less than it then it isn't higher than the range</span>
    <span class="s2">if </span><span class="s1">((!</span><span class="s0">low</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">|| </span><span class="s0">low</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s0">comp</span><span class="s1">) &amp;&amp;</span>
        <span class="s0">ltefn</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">low</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">)) {</span>
      <span class="s2">return false</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">low</span><span class="s1">.</span><span class="s0">operator </span><span class="s1">=== </span><span class="s0">ecomp </span><span class="s1">&amp;&amp; </span><span class="s0">ltfn</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">low</span><span class="s1">.</span><span class="s0">semver</span><span class="s1">)) {</span>
      <span class="s2">return false</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
  <span class="s2">return true</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">prerelease </span><span class="s1">= </span><span class="s0">prerelease</span>
<span class="s2">function </span><span class="s0">prerelease </span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s2">var </span><span class="s0">parsed </span><span class="s1">= </span><span class="s0">parse</span><span class="s1">(</span><span class="s0">version</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s2">return </span><span class="s1">(</span><span class="s0">parsed </span><span class="s1">&amp;&amp; </span><span class="s0">parsed</span><span class="s1">.</span><span class="s0">prerelease</span><span class="s1">.</span><span class="s0">length</span><span class="s1">) ? </span><span class="s0">parsed</span><span class="s1">.</span><span class="s0">prerelease </span><span class="s1">: </span><span class="s2">null</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">intersects </span><span class="s1">= </span><span class="s0">intersects</span>
<span class="s2">function </span><span class="s0">intersects </span><span class="s1">(</span><span class="s0">r1</span><span class="s1">, </span><span class="s0">r2</span><span class="s1">, </span><span class="s0">options</span><span class="s1">) {</span>
  <span class="s0">r1 </span><span class="s1">= </span><span class="s2">new </span><span class="s0">Range</span><span class="s1">(</span><span class="s0">r1</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s0">r2 </span><span class="s1">= </span><span class="s2">new </span><span class="s0">Range</span><span class="s1">(</span><span class="s0">r2</span><span class="s1">, </span><span class="s0">options</span><span class="s1">)</span>
  <span class="s2">return </span><span class="s0">r1</span><span class="s1">.</span><span class="s0">intersects</span><span class="s1">(</span><span class="s0">r2</span><span class="s1">)</span>
<span class="s1">}</span>

<span class="s0">exports</span><span class="s1">.</span><span class="s0">coerce </span><span class="s1">= </span><span class="s0">coerce</span>
<span class="s2">function </span><span class="s0">coerce </span><span class="s1">(</span><span class="s0">version</span><span class="s1">) {</span>
  <span class="s2">if </span><span class="s1">(</span><span class="s0">version </span><span class="s2">instanceof </span><span class="s0">SemVer</span><span class="s1">) {</span>
    <span class="s2">return </span><span class="s0">version</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s0">version </span><span class="s1">!== </span><span class="s4">'string'</span><span class="s1">) {</span>
    <span class="s2">return null</span>
  <span class="s1">}</span>

  <span class="s2">var </span><span class="s0">match </span><span class="s1">= </span><span class="s0">version</span><span class="s1">.</span><span class="s0">match</span><span class="s1">(</span><span class="s0">safeRe</span><span class="s1">[</span><span class="s0">COERCE</span><span class="s1">])</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s0">match </span><span class="s1">== </span><span class="s2">null</span><span class="s1">) {</span>
    <span class="s2">return null</span>
  <span class="s1">}</span>

  <span class="s2">return </span><span class="s0">parse</span><span class="s1">(</span><span class="s0">match</span><span class="s1">[</span><span class="s6">1</span><span class="s1">] +</span>
    <span class="s4">'.' </span><span class="s1">+ (</span><span class="s0">match</span><span class="s1">[</span><span class="s6">2</span><span class="s1">] || </span><span class="s4">'0'</span><span class="s1">) +</span>
    <span class="s4">'.' </span><span class="s1">+ (</span><span class="s0">match</span><span class="s1">[</span><span class="s6">3</span><span class="s1">] || </span><span class="s4">'0'</span><span class="s1">))</span>
<span class="s1">}</span>
</pre>
</body>
</html>